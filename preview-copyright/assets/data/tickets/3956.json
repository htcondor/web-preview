{"id": 3956, "title": "Ticket #3956: some schedd ads have a blank Name attr, make malformed GlobalJobIds", "description": "<blockquote>\nI first discovered this due to malformed <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GlobalJobIds\" title=\"Global Job Ids\">GlobalJobIds</a></span> (no submit machine name before the first hash):\n<div class=\"verbatim\">\n<pre>[root@sugar-dev3 ~]# condor_q 9901434.0 -autof GlobalJobId\n#9901434.0#1380570695\n</pre></div>\n\n\n<p>Note that sugar-dev3 and sugar1 have machine names but no schedd names:\n</p><div class=\"verbatim\">\n<pre>[root@sugar-dev3 ~]# condor_status -schedd -autof:h machine name\nmachine                name\nsugar-dev1.phy.syr.edu sugar-dev1.phy.syr.edu\nsugar-dev2.phy.syr.edu sugar-dev2.phy.syr.edu\nsugar-dev3.phy.syr.edu\nsugar.phy.syr.edu      sugar.phy.syr.edu\nsugar1.phy.syr.edu\n</pre></div>\n\n\n<p>And yet:\n</p><div class=\"verbatim\">\n<pre>[root@sugar-dev3 ~]# hostname\nsugar-dev3.phy.syr.edu\n\n[root@sugar-dev2 ~]# hostname\nsugar-dev2.phy.syr.edu\n</pre></div>\n\n...and...\n<div class=\"verbatim\">\n<pre>[root@sugar-dev3 ~]# condor_config_val -schedd -dump | fgrep -i sugar-dev3\n# Configuration from machine: sugar-dev3.phy.syr.edu\nFULL_HOSTNAME = sugar-dev3.phy.syr.edu\nHOSTNAME = sugar-dev3\nUTSNAME_NODENAME = sugar-dev3.phy.syr.edu\n</pre></div>\n\nLooks exactly like the config of sugar-dev2, which does have a name:\n<div class=\"verbatim\">\n<pre>[root@sugar-dev2 ~]# condor_config_val -schedd -dump | fgrep -i sugar-dev2\n# Configuration from machine: sugar-dev2.phy.syr.edu\nFULL_HOSTNAME = sugar-dev2.phy.syr.edu\nHOSTNAME = sugar-dev2\nUTSNAME_NODENAME = sugar-dev2.phy.syr.edu\n</pre></div>\n\nBoth machines are running v8.0.2.  What's going on?</blockquote>", "remarks": "<blockquote>\n<em>2013-Sep-30 16:55:55 by gthain:</em> <br/>\n\nWell, this is odd.\n\n<p></p><div class=\"code\">\n<pre class=\"code\">condor_status -schedd -direct sugar-dev3.phy.syr.edu -l | egrep 'Name|Machine'\nMachine = \"sugar-dev3.phy.syr.edu\"\nName = \"\"\nPrivateNetworkName = \"public\"\n\n</pre></div>\n\n\n<p></p><hr/>\n<em>2013-Sep-30 17:07:57 by gthain:</em> <br/>\n\nAnd if you condor_reconfig it, does the name remain the same?\n\n<p></p><hr/>\n<em>2013-Oct-02 14:13:54 by gthain:</em> <br/>\n\nTo document what happened on a long phone call, we restarted one of the machines where this was happening, and the problem resolved itself.  Therefore, the suspicion is that DNS is intermittently failing.  Perhaps HTCondor should retry if it gets a zero length string back from DNS?\n\n<p></p><hr/>\n<em>2013-Oct-02 15:49:19 by gthain:</em> <br/>\n\nLooking at the code, it appears this can happen when a condor daemon tries to figure out it's own NAME attribute, calls getaddrinfo(), and DNS returns EAI_AGAIN.  This error code means there's some transient error talking to the DNS system.  I'm going to add a better error message and a retry, and we'll see if that helps LIGO.\n\n<p></p><hr/>\n<em>2013-Oct-17 11:54:59 by pfc:</em> <br/>\n\nFWIW, this has happened again, on sugar.phy.syr.edu:\n<div class=\"verbatim\">\n<pre>[root@sugar-dev3 ~]# condor_status -schedd -const 'Machine==\"sugar.phy.syr.edu\"' -l | egrep 'Name|Machine'\nMachine = \"sugar.phy.syr.edu\"\nName = \"\"\nPrivateNetworkName = \"sugar\"\n</pre></div>\n\n\n<p></p><hr/>\n<em>2013-Oct-29 08:50:29 by pfc:</em> <br/>\n\nFYI, I need to bump the priority of this, as it's happening a lot, and causes our opportunistic grid's VM factory to stop making VMs when it can't contact our schedd by name.\n\n<p></p><hr/>\n<em>2013-Oct-29 14:58:41 by pfc:</em> <br/>\n\nWe also see this bug affecting the checkpoint server, so the fix/workaround will need to be duplicated there too, since it's non-DaemonCore (right?)...\n\n<p></p><div class=\"verbatim\">\n<pre>% condor_status -ckpt -const 'name==\"\"' -autof machine\n10.20.5.33\n</pre></div>\n\n\n<p></p><hr/>\n<em>2013-Nov-12 14:45:26 by gthain:</em> <br/>\n\nDouble checking the commit, this is a common function which both daemon core and the checkpoint server call directly, so it may be fixed in both.\n\n<p></p><hr/>\n<em>2013-Nov-25 14:05:07 by pfc:</em> <br/>\n\nI have not seen this recur since upgrading to 8.0.4.  Thanks!</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Oct-16 15:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4b94a5640ad1c9e66dcb201834ac1d279508e9f0\">[37896]</a></span>: edit of 8.0.4 version history item <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=3956\" onclick=\"get_ticket_and_populate_wrapper('3956'); return false;\" title=\"some schedd ads have a blank Name attr, make malformed GlobalJobIds\">#3956</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Oct-15 11:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b56bf38ece7d0459cc9d6282c4bffa3103a9c16f\">[37870]</a></span>: Document <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=3956\" onclick=\"get_ticket_and_populate_wrapper('3956'); return false;\" title=\"some schedd ads have a blank Name attr, make malformed GlobalJobIds\">#3956</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Oct-02 16:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/88c1a0005e224738c5f1ee6beeacda17a7529cd1\">[37747]</a></span>: If DNS returns EAI_AGAIN, try again <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=3956\" onclick=\"get_ticket_and_populate_wrapper('3956'); return false;\" title=\"some schedd ads have a blank Name attr, make malformed GlobalJobIds\">#3956</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Aug-05 07:16", "status": "defer", "created": "2013-Sep-30 15:00", "fixed_version": "2013-Sep-30 15:00", "broken_version": "v080002", "priority": "5", "subsystem": "DaemonsSubmitNode", "assigned_to": "adesmet", "derived_from": "", "creator": "pfc", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pfcouvar@syr.edu,pcouvare@caltech.edu", "due_date": ""}