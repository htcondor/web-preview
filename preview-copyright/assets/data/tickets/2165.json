{"id": 2165, "title": "Ticket #2165: Rescue DAGs should not be a complete DAG file?", "description": "<blockquote>\nIn today's discussion with the botany people, one of the things we talked about is why they don't use rescue DAGs more.  It turns out that at least one reason is that when they fix things up after a failure, they often want to make slight changes to the DAG file itself (renaming the DAG file of a subdag external, for example).  But you can't really do this in a clean way, because if you edit the original DAG file, the change won't take effect when the rescue DAG is run; and, of course, if you edit the rescue DAG, you lose the change if the original DAG is re-run from scratch.\n\n<p>So I think the solution to this is that the rescue DAG file should no longer be an actual DAG file; rather, it should just be a list of which nodes are marked as done.  So then, when you run a rescue DAG, the original DAG file would be parsed, and then the appropriate (latest) rescue DAG file would be read, and the nodes would be marked as done appropriately.\n\n</p><p>Note that if we do this, it would probably mean eliminating the -oldrescue option that we currently support.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-May-20 09:28:16 by wenger:</em> <br/>\n\nOh, yeah -- the rescue DAG would also have to contain updated retry counts.  Maybe it should have the number of retries already used, rather than the number of retries left?\n\n<p></p><hr/>\n<em>2011-May-20 09:40:13 by nwp:</em> <br/>\n\nDoesn't it keep the state more localized if we just write out the number of retries left?  If you count the ones already used, then you have to do some accounting to find the number left, whereas if you write the number of retries left into the rescue dag, you don't need to do the same bookkeeping.\n\n<p></p><hr/>\n<em>2011-May-20 10:04:33 by wenger:</em> <br/>\n\nWell, the main reason I was thinking of writing out the number of retries used is in case the user changes the retry count in the \"main\" DAG file before re-running the DAG.  But I think this is a fairly minor consideration -- the main thing is that the \"new\" rescue DAG would have to have something about retries, as well as which nodes are done.\n\n<p></p><hr/>\n<em>2011-Jun-10 14:15:42 by wenger:</em> <br/>\n\nCreated V7_7-new_rescue_dag-branch for this.\n\n<p></p><hr/>\n<em>2011-Aug-24 09:37:29 by wenger:</em> <br/>\n\nOkay, I think the code for this is all set (on the  V7_7-new_rescue_dag-branch branch).  I'm going to assign it over to Nathan for review.  Nathan -- if you think the code is okay, you should set the status to \"documentation\", not \"resolved\", because I don't have the documentation done yet.\n\n<p></p><hr/>\n<em>2011-Aug-24 11:18:29 by nwp:</em> <br/>\n\nReviewed patch. Everything looks good, except for some stylistic quibbles idiosyncratic to the reviewer.\n\n<p></p><hr/>\n<em>2011-Aug-25 11:04:02 by wenger:</em> <br/>\n\nI fixed the things Nathan pointed out in his review, and merged this to the master (after fixing some really nasty conflicts where git did a bad job with the merge).\n\n<p>This still needs documentation...\n\n</p><p></p><hr/>\n<em>2011-Aug-31 13:16:45 by wenger:</em> <br/>\n\nOkay, I've finished the documentation (pending any fixes from Karen) so I am going to resolve this ticket.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-02 09:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f12d4c586e6f70703edb1dd57131f2feaa812dff\">[27079]</a></span>: Last documentation detail of <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2165\" onclick=\"get_ticket_and_populate_wrapper('2165'); return false;\" title=\"Rescue DAGs should not be a complete DAG file?\">#2165</a></span>: changes to Rescue DAG implementation; removed no-longer-present command line arguments from condor_dagman and condor_submit_dag man pages. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2165\" onclick=\"get_ticket_and_populate_wrapper('2165'); return false;\" title=\"Rescue DAGs should not be a complete DAG file?\">#2165</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-01 11:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6c6f18cdbac0b6a1ecd7bd2f7d353c7f1d266324\">[27054]</a></span>: edits of new partial Rescue DAG implementation documentation ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2165\" onclick=\"get_ticket_and_populate_wrapper('2165'); return false;\" title=\"Rescue DAGs should not be a complete DAG file?\">#2165</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-31 13:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b0037560347b6a134af8ef0967bf58565041f962\">[27043]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2165\" onclick=\"get_ticket_and_populate_wrapper('2165'); return false;\" title=\"Rescue DAGs should not be a complete DAG file?\">#2165</a></span>: documented this (partial rescue DAG files). Also added documentation for the DAGMAN_RESET_RETRIES_UPON_RESCUE configuration variable, which was missing for some reason. Fixed some errors in documentation of the -debug option to condor_dagman and condor_submit_dag.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-31 09:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/05a980fac4b20baac6e3e57aecb4e51d3ef2b55d\">[27037]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2165\" onclick=\"get_ticket_and_populate_wrapper('2165'); return false;\" title=\"Rescue DAGs should not be a complete DAG file?\">#2165</a></span>: the version information in the rescue DAG now includes whether the DAG is a full or partial DAG file.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-30 14:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/736a019410da4626b509801db21822920b87dcd7\">[27032]</a></span>: Remove these tests from master The always-run-post-script code in <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2057\" onclick=\"get_ticket_and_populate_wrapper('2057'); return false;\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> has not been merged yet. This was changed in work for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2165\" onclick=\"get_ticket_and_populate_wrapper('2165'); return false;\" title=\"Rescue DAGs should not be a complete DAG file?\">#2165</a></span> also.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-30 14:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8ed4340f53f704d5b827154f0ea5d1808ad1ec7b\">[27028]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2165\" onclick=\"get_ticket_and_populate_wrapper('2165'); return false;\" title=\"Rescue DAGs should not be a complete DAG file?\">#2165</a></span>: added the DAGMAN_WRITE_PARTIAL_RESCUE config macro, which allows me to fix job_dagman_pre_skip-C (which was job_dagman_pre_skip-D) and job_dagman_retry (re-enabled job_dagman_retry as a result).  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-25 10:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f6a56f5f15ef5e7b1cb71db17e195462ba4f047c\">[26974]</a></span>: Merged <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/33105e5d9dd27ba8889d83673f80427adea611cb\">[22152]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/270d7422e890b98f37cd08c1fa3079eec12a520d\">[22153]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3110bba0f7aeb441ff71e6a831585348004fcc2c\">[22155]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7b544d264f8f4d11cfb508da2e6145426592eceb\">[22159]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9895108c5d0e495e2b108508b5656fb6114a1e4f\">[22160]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0382b7b607bf793e03b3bd0d8459bc0a8e3069b6\">[22165]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/05a83f9c201f4f89f7096085513f7cf1115de627\">[22166]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5e83a73b90f5f3099706f8b9d0485971eb07b6cd\">[22167]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/de927dfe87ec49afa5da97920483acdcead1e450\">[22219]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d44632d5d4ab5dba94e027201379e3b928c9d7c9\">[22231]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/98c426539b100c795e390db67bfe735ea980444f\">[22368]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bfe98727bc775bd11c148c7207946a9f53444804\">[22371]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f0ff27afd98dac1c143b8012675a77f0f2e48dff\">[26716]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d3fc45d49b119d676b4bdaa8650b56a2f621129a\">[26734]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8fa8d768836193e7a7ac6a97ed9635c4a7ae5418\">[26735]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1a702022e51180d098a97333257928c559be1d54\">[26742]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9513b31da636e20e49ba37d9b416fa5d905d8f8d\">[26924]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9145ca0d82b623f0b029effcfb77462b8a54278a\">[26925]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/388fcb9a2a6af57c017ae573aae20034f4bfad95\">[26938]</a></span>, Merge branch 'V7_7-new_rescue_dag-branch'\u00a0[...]\n (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-24 13:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/388fcb9a2a6af57c017ae573aae20034f4bfad95\">[26938]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2165\" onclick=\"get_ticket_and_populate_wrapper('2165'); return false;\" title=\"Rescue DAGs should not be a complete DAG file?\">#2165</a></span>: slight changes based on review by Nathan.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-24 09:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9145ca0d82b623f0b029effcfb77462b8a54278a\">[26925]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2165\" onclick=\"get_ticket_and_populate_wrapper('2165'); return false;\" title=\"Rescue DAGs should not be a complete DAG file?\">#2165</a></span>: DAGMan now passes all tests (except for job_dagman_retry, and I can't even figure out what that's supposed to be doing, except that it relies on old-style rescue DAGs, so I'm disabling it).  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-10 17:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d3fc45d49b119d676b4bdaa8650b56a2f621129a\">[26734]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2165\" onclick=\"get_ticket_and_populate_wrapper('2165'); return false;\" title=\"Rescue DAGs should not be a complete DAG file?\">#2165</a></span>: partly done getting things to work with splices.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-10 15:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f0ff27afd98dac1c143b8012675a77f0f2e48dff\">[26716]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2165\" onclick=\"get_ticket_and_populate_wrapper('2165'); return false;\" title=\"Rescue DAGs should not be a complete DAG file?\">#2165</a></span>: DONE line for a non-existant node is now a warning, in case the user removes nodes from the original DAG; extra tokens on a DONE line are now an error; manually tested -DumpRescue and rescue DAG with multiple DAGs.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Aug-31 13:17", "status": "resolved", "created": "2011-May-17 16:51", "fixed_version": "2011-May-17 16:51", "broken_version": "v070600", "priority": "2", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "wenger@cs.wisc.edu, psilord@cs.wisc.edu", "due_date": "20110826"}