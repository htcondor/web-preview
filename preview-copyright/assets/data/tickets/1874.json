{"id": 1874, "title": "Ticket #1874: Use OS-provided security libraries", "description": "<blockquote>\nThere are several advantages to dynamically linking to 3rd-party libraries. See <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1135\" onclick=\"get_ticket_and_populate_wrapper('1135'); return false;\" title='\"Real\" dynamic binary releases'>#1135</a></span> for some discussion. This is particularly true for security libraries that the OS vendor provides.\n\n<p>An additional benefit to dynamically linking the vendor's OpenSSL library is that we automatically use the vendor-provided list of trusted CA certificates for SSL authentication. Otherwise, some additional configuration steps are required to submit EC2 jobs to Amazon.\n\n</p><p><span class=\"subsection\"></span></p><h3>Milestones </h3>\n<ul>\n<li>Finish code to conditionally link against vendor-provided OpenSSL and Kerberos libraries. <strong>[DONE]</strong>\n</li><li>Decide whether to commit code or make further changes. <strong>[DONE]</strong>\n</li><li>Decide how to handle link failure on Mac OS 10.4. <strong>[DONE]</strong></li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Jan-31 12:11:11 by jfrey:</em> <br/>\n\nOn x86 Mac OS 10.4, the following symbols are are duplicated between the system's libkrb5 and libglobus_gssapi_gsi_gcc32dbg.a, causing the build to fail:\n\n<p></p><ul>\n<li>_GSS_C_NT_ANONYMOUS\n</li><li>_GSS_C_NT_EXPORT_NAME\n</li><li>_GSS_C_NT_HOSTBASED_SERVICE\n</li><li>_GSS_C_NT_HOSTBASED_SERVICE_X\n</li><li>_GSS_C_NT_MACHINE_UID_NAME\n</li><li>_GSS_C_NT_STRING_UID_NAME\n</li><li>_GSS_C_NT_USER_NAME\n</li><li>_gss_add_oid_set_member\n</li><li>_gss_create_empty_oid_set\n</li><li>_gss_indicate_mechs\n</li><li>_gss_nt_machine_uid_name\n</li><li>_gss_nt_service_name\n</li><li>_gss_nt_string_uid_name\n</li><li>_gss_nt_user_name\n</li><li>_gss_release_oid_set\n</li><li>_gss_test_oid_set_member\n</li><li>_gss_compare_name\n</li></ul>\n\n<p>Mac OS 10.5 and 10.6 are not affected. We are considering dropping 10.4 as a supported platform, which would neatly solve this problem.\n\n</p><p></p><hr/>\n<em>2011-Feb-01 11:37:09 by jfrey:</em> <br/>\n\nAs a result of using the vendor-provided security libraries, our linux binaries are less portable. Here is a list of our current cross-platform tests that no longer work due to differing versions of the libraries:\n\n<p></p><ul>\n<li>x86_rhap_5 -&gt; x86_ubuntu_10.04\n<ul>\n<li>differing openssl versions: libssl.so.6 vs. libssl.so.0.9.8\n</li></ul>\n</li><li>x86_64_rhap_5 -&gt; x86_64_ubuntu_10.04\n<ul>\n<li>differing openssl versions: libssl.so.6 vs. libssl.so.0.9.8\n</li></ul>\n</li><li>x86_64_rhap_5 -&gt; x86_64_fedora_13[-updated]\n<ul>\n<li>differing openssl versions: libssl.so.6 vs. libssl.so.10,libssl.so.1.0.0\n</li></ul>\n</li><li>x86_64_rhap_5 -&gt; x86_64_fedora_12[-updated]\n<ul>\n<li>differing openssl versions: libssl.so.6 vs. libssl.so.10,libssl.so.1.0.0\n</li></ul>\n</li><li>x86_64_rhap_5 -&gt; x86_64_fedora_11\n<ul>\n<li>differing openssl versions: libssl.so.6 vs. libssl.so.8,libssl.so.0.9.8k\n</li></ul>\n</li><li>ia64_rhas_3 -&gt; ia64_sles_9\n<ul>\n<li>differing openssl versions: libssl.so.4 vs. libssl.so.0.9.7\n</li><li>differing kerberos versions: libkrb5.so.3 vs. libkrb5.so.17\n</li></ul>\n</li><li>ppc64_sles_9 -&gt; ps3_fedora_9\n<ul>\n<li>differing openssl versions: libssl.so.0.9.7 vs. libssl.so.7,libssl.so.0.9.8g\n</li></ul>\n</li><li>x86_64_rhas_3 -&gt; x86_64_sles_9\n<ul>\n<li>differing openssl versions: libssl.so.4 vs. libssl.so.0.9.7\n</li><li>differing kerberos versions: libkrb5.so.3 vs. libkrb5.so.17\n</li></ul>\n</li><li>x86_rhas_3 -&gt; x86_64_sles_9\n<ul>\n<li>differing openssl versions: libssl.so.4 vs. libssl.so.0.9.7\n</li><li>differing kerberos versions: libkrb5.so.3 vs. libkrb5.so.17\n</li></ul>\n</li><li>x86_rhas_3 -&gt; x86_suse_10.2\n<ul>\n<li>differing openssl versions: libssl.so.4 vs. libssl.so.0.9.7,libssl.so.0.9.8\n</li></ul>\n</li><li>x86_rhas_3 -&gt; x86_sles_9\n<ul>\n<li>differing openssl versions: libssl.so.4 vs. libssl.so.0.9.7\n</li><li>differing kerberos versions: libkrb5.so.3 vs. libkrb5.so.17\n</li></ul>\n</li></ul>\n<hr/>\n<em>2011-Feb-01 16:20:02 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2011-Mar-10 10:56:38 by jfrey:</em> <br/>\n\nFor rhel3 binaries, bringing all of the vendor openssl and kerberos libraries to the execution platform allows the Condor binaries to run on all of our cross-test machines. Here are the files:\n\n<p></p><pre>  libssl.so.4 -&gt; libssl.so.0.9.7a\n  libssl.so.0.9.7a\n  libcrypto.so.0.9.7a\n  libcrypto.so.4 -&gt; libcrypto.so.0.9.7a\n  libkrb5.so.3.1\n  libkrb5.so.3 -&gt; libkrb5.so.3.1\n  libk5crypto.so.3.0\n  libk5crypto.so.3 -&gt; libk5crypto.so.3.0\n  libcom_err.so.3.0\n  libcom_err.so.3 -&gt; libcom_err.so.3.0\n  libgssapi_krb5.so.2.2\n  libgssapi_krb5.so.2 -&gt; libgssapi_krb5.so.2.2\n</pre>\n\n<p>For rhel5 binaries, bringing all of the vendor openssl libraries to the execution platform allows the Condor binaries to run on all of our cross-test machines. Here are the files:\n\n</p><p></p><pre>  libcrypto.so.0.9.8b\n  libcrypto.so.6 -&gt; libcrypto.so.0.9.8b\n  libssl.so.0.9.8b\n  libssl.so.6 -&gt; libssl.so.0.9.8b\n</pre>\n\n<p></p><hr/>\n<em>2011-Mar-10 17:02:50 by jfrey:</em> <br/>\n\nInstructing cmake to set RPATH for Condor binaries is easily done by adding these lines to CondorConfigure.cmake:\n\n<p></p><pre>  set(CMAKE_SKIP_RPATH FALSE)\n  set(CMAKE_INSTALL_RPATH \"$ORIGIN/../lib/condor\")\n  set(CMAKE_BUILD_WITH_INSTALL_RPATH TRUE)\n</pre>\n\n<p>Setting RPATH for binaries in the externals is proving a little more challenging. For the gridftp server, I try setting <code>LDFLAGS=-Wl,-rpath=$ORIGIN/../lib/condor</code>, but something keeps eating the <code>$O</code>. I can't find a way to escape it properly.\n\n</p><p>For the blahp, we'll need a different relative path.\n\n</p><p></p><hr/>\n<em>2011-Aug-08 17:38:28 by jfrey:</em> <br/>\n\nWe'll drop Mac OS 10.4 in favor of Mac OS 10.5 for the 7.7 series.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-09 13:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d6c4ebfe5f3bc8059e104c405a9b96f60c96c347\">[27152]</a></span>: Modify and make prominent (with ordering) version history item about dynamic linking to security libraries. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1874\" onclick=\"get_ticket_and_populate_wrapper('1874'); return false;\" title=\"Use OS-provided security libraries\">#1874</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-12 14:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1d794f32e608910de1c53154f6e30ade8924048d\">[26750]</a></span>: Document Condor dynamically linking OpenSSL and Kerberos. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1874\" onclick=\"get_ticket_and_populate_wrapper('1874'); return false;\" title=\"Use OS-provided security libraries\">#1874</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-01 13:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/27624e517fd6d920681365d907404439c6133306\">[26607]</a></span>: Bump version for externals that link with security libraries. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1874\" onclick=\"get_ticket_and_populate_wrapper('1874'); return false;\" title=\"Use OS-provided security libraries\">#1874</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-01 11:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ff0af2edee1c3dbc41cbbf5f062c5d69f8aacdac\">[26605]</a></span>: Dynamically link OS-provided security libaries in UW builds. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1874\" onclick=\"get_ticket_and_populate_wrapper('1874'); return false;\" title=\"Use OS-provided security libraries\">#1874</a></span> If we don't find OS-provided libraries, we still build our own.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Aug-08 17:38", "status": "resolved", "created": "2011-Jan-25 13:35", "fixed_version": "2011-Jan-25 13:35", "broken_version": "v070400", "priority": "2", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "#1135", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": "20110808"}