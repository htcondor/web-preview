{"id": 2710, "title": "Ticket #2710: Need a way to turn off pss grepping through /proc/pid/smaps", "description": "<blockquote>\nThe procd (via procapi) reads through every process's /proc/pid/smaps entry on every snapshot.  This is very slow.  Add a knob REPORT_PSS, defaulting to false\nto control this.</blockquote>", "remarks": "<blockquote>\n<em>2011-Dec-13 16:02:44 by gthain:</em> <br/>\n\nTurns out procd doesn't link with param.  I'm just turning this off in the build for now.\n\n<p></p><hr/>\n<em>2011-Dec-13 16:19:52 by bbockelm:</em> <br/>\n\nAny reason why it can't just read from the relevant monitored processes?\n\n<p>When cgroups are enabled, can we just report RSS the same as PSS (as the semantics of RSS from cgroups are a bit closer to PSS)?\n\n</p><p></p><hr/>\n<em>2012-Jan-06 19:47:58 by bbockelm:</em> <br/>\n\nThis seems to be the wrong way to go about this.  Why not separate the PSS calculation out of getProcInfo, so this is only called for monitored processes, not all processes on the system?\n\n<p>PSS is very useful and the lack of reliable calculation is hurting CMS at our site right now.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/520/pss_on_demand.patch\">pss_on_demand.patch</a>\n3511 bytes added by bbockelm on 2012-Jan-07 19:27:57 UTC.\n<br/>\nThe following patch only computes PSS for processes the procd cares about, as opposed to the entire system.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Feb-01 10:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b2fe788fa4b3a897ec26bc4aadc064b960ecad9c\">[30065]</a></span>: Only read pss when needed, as it is slow <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2710\" onclick=\"get_ticket_and_populate_wrapper('2710'); return false;\" title=\"Need a way to turn off pss grepping through /proc/pid/smaps\">#2710</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-18 11:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a9f897562387b6a313e92d1593dbf3f138e70f56\">[29141]</a></span>: edit of version history items ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2710\" onclick=\"get_ticket_and_populate_wrapper('2710'); return false;\" title=\"Need a way to turn off pss grepping through /proc/pid/smaps\">#2710</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2725\" onclick=\"get_ticket_and_populate_wrapper('2725'); return false;\" title=\"ResidentSetSize appears to get reset when job is put on hold\">#2725</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-23 11:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/165693da8ec6a35bad0864705d0e329b61cf0867\">[28907]</a></span>: document/edit version history item for USE_PSS knob ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2710\" onclick=\"get_ticket_and_populate_wrapper('2710'); return false;\" title=\"Need a way to turn off pss grepping through /proc/pid/smaps\">#2710</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-14 16:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b7c93fa7464de407ddab75d4f0e37888e5c91590\">[28790]</a></span>: Document USE_PSS <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2710\" onclick=\"get_ticket_and_populate_wrapper('2710'); return false;\" title=\"Need a way to turn off pss grepping through /proc/pid/smaps\">#2710</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-14 14:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3b06936aeeeb5839c8bf543c936b460b13cf753d\">[28778]</a></span>: Add USE_PSS knob to temporarily work around procd performance issues. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2710\" onclick=\"get_ticket_and_populate_wrapper('2710'); return false;\" title=\"Need a way to turn off pss grepping through /proc/pid/smaps\">#2710</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-May-03 09:15", "status": "resolved", "created": "2011-Dec-13 15:30", "fixed_version": "2011-Dec-13 15:30", "broken_version": "v070701", "priority": "2", "subsystem": "", "assigned_to": "gthain", "derived_from": "#2652", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com", "due_date": ""}