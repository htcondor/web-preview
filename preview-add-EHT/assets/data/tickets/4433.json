{"id": 4433, "title": "Ticket #4433: Add syntax to allow users to append to configuration arrays", "description": "<blockquote>\nIn the HTCondor-CE, we set JOB_ROUTER_DEFAULTS for our users but they can't append additional values to those defaults. Currently, they're adding the default values they wanted to each individual route, which is tedious and annoying. We would like to see something like the following so that our users can write clearer configs:\n\n<p>JOB_ROUTER_DEFAULTS = ($JOB_ROUTER_DEFAULT), [AccountingGroup = undefined;]</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Sep-03 21:21:47 by bbockelm:</em> <br/>\n\nProposed implementation pushed to branch V8_3-gt4433.  Tested on a local job router but needs review.\n\n<p></p><hr/>\n<em>2014-Sep-10 14:55:02 by johnkn:</em> <br/>\n\n\n<p>for <code>JOB_ROUTER_DEFAULTS</code> all we have to do to fix the problem is make the outer [] optional, but parse as if the were there.\n\n</p><p>For <code>JOB_ROUTER_ENTRIES</code> we should allow multiple knobs, one per router, with the outer [] once again being impled.\n\n</p><p>I also propose that we switch to a better naming scheme.\n\n</p><p></p><pre>    JOB_ROUTER_ENTRY_1 = a=1; b=2;\n    JOB_ROUTER_ENTRY_TWO = a=2; b=3;\n</pre>\n\n<p>Once again, outer [] are optional to facilitate appending. but in this case, all knobs matching the <code>JOB_ROUTER_ENTRY</code> pattern are parsed, and each knob defines exactly one ad.\n\n</p><p></p><hr/>\n<em>2014-Sep-16 10:57:02 by johnkn:</em> <br/>\n\npatch <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3baf8290c8cd06133d4db32cc7ea8a95496491c9\">[41164]</a></span> makes the square braces around the classad value optional for <code>JOB_ROUTER_DEFAULTS</code> knob.\n\n<p></p><hr/>\n<em>2014-Sep-17 15:44:21 by bbockelm:</em> <br/>\n\nHi TJ,\n\n<p>Can we hold off on the JOB_ROUTER_ENTRY change?  I'd like to think a little bit bigger picture (separate ticket at least), as we already have three ways to specify routes.  Seems like we should maybe have a slightly higher threshold to add a fourth mechanism.\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2014-Sep-18 09:34:15 by johnkn:</em> <br/>\n\nAgreed.  Looks like the JOB_ROUTER_ENTRY change isn't needed at this time.\n\n<p></p><hr/>\n<em>2014-Nov-17 20:30:09 by bbockelm:</em> <br/>\n\nHi,\n\n<p>Returning to this one -\n\n</p><p>I don't consider this resolved because, due to backward compatibility issues, I don't see how OSG could utilize the provided solution.\n\n</p><p>Right now, since HTCondor-CE doesn't know the underlying HTCondor version, we have to keep the brackets on JOB_ROUTER_DEFAULTS.  In order to compose multiple JOB_ROUTER_DEFAULTS entries, you have to remove the brackets from all.\n\n</p><p>The originally posted  patch didn't have this problem.\n\n</p><p>For record keeping - should we reopen this ticket or file a new one?\n\n</p><p>Brian\n\n</p><p><em>ToddT: we are reopening this ticket</em>\n\n</p><p></p><hr/>\n<em>2014-Nov-21 10:08:44 by bbockelm:</em> <br/>\n\nThanks TJ!\n\n<p>Looking at the code - should we default this to off:\n\n</p><p>MERGE_JOB_ROUTER_DEFAULT_AD\n\n</p><p>and put the onus on HTCondor-CE to enable it?  This would mean, by default, there is only one way to do this.\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2014-Nov-21 10:32:57 by johnkn:</em> <br/>\n\nYou don't need to know the client version.\n\n<p></p><pre>    JOB_ROUTER_DEFAULTS = A=B; C=D;\n    if version &lt; 8.2.4\n      JOB_ROUTER_DEFAULTS = [ $(JOB_ROUTER_DEFAULTS) ]\n    endif\n</pre>\n\n<p></p><hr/>\n<em>2014-Nov-21 11:22:17 by johnkn:</em> <br/>\n\nfinal result of all of the commits is that if\n\n<p></p><pre>    MERGE_JOB_ROUTER_DEFAULT_ADS = true\n</pre>\n\n<p>then the way to append to <code>JOB_ROUTER_DEFAULTS</code> is to append a full new-classad like this:\n\n</p><p></p><pre>    MERGE_JOB_ROUTER_DEFAULT_ADS = true\n    JOB_ROUTER_DEFAULTS = [ A=Z; ]\n    JOB_ROUTER_DEFAULTS = $(JOB_ROUTER_DEFAULTS) [ A=B; c=d; ]\n</pre>\n\n<p>If <code>MERGE_JOB_ROUTER_DEFAULT_ADS</code> is false, (which is the default value) the the way to append to the default ad is to just add ; terminated statements like this.\n\n</p><p></p><pre>    MERGE_JOB_ROUTER_DEFAULT_ADS = false\n    JOB_ROUTER_DEFAULTS = A=Z;\n    JOB_ROUTER_DEFAULTS = $(JOB_ROUTER_DEFAULTS) A=B; c=d;\n</pre>\n\n<p></p><hr/>\n<em>2014-Dec-01 13:36:15 by tim:</em> <br/>\n\nWe will release this without documentation. It is turned off by default. It is something requested by OSG that may turn out to be a temporary issue.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6128\" onclick=\"get_ticket_and_populate_wrapper('6128'); return false;\" title=\"Job Router defaults sensitive to leading whitespace\">#6128</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nJob Router defaults sensitive to leading whitespace</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-21 10:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/74c4586d406ad79aca01efbc38757e32fb958c9e\">[41739]</a></span>: change default for MERGE_JOB_ROUTER_DEFAULT_ADS to false <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4433\" onclick=\"get_ticket_and_populate_wrapper('4433'); return false;\" title=\"Add syntax to allow users to append to configuration arrays\">#4433</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-21 09:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cefc3d7cbdd719e680a54d8005cb8719e6293f4c\">[41736]</a></span>: merge muiltiple JOB_ROUTER_DEFAULT ads into a single ad <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4433\" onclick=\"get_ticket_and_populate_wrapper('4433'); return false;\" title=\"Add syntax to allow users to append to configuration arrays\">#4433</a></span> this behavior is enabled if MERGE_JOB_ROUTER_DEFAULT_ADS is true and if the value of JOB_ROUTER_DEFAULT begins with [  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Sep-30 16:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d3b3eb08261ff8f4b43e6199503d60d502a86ca5\">[41287]</a></span>: document change to parsing of knob JOB_ROUTER_DEFAULTS <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4433\" onclick=\"get_ticket_and_populate_wrapper('4433'); return false;\" title=\"Add syntax to allow users to append to configuration arrays\">#4433</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Sep-15 16:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3baf8290c8cd06133d4db32cc7ea8a95496491c9\">[41164]</a></span>: allow appending to JOB_ROUTER_DEFAULTS config knob by having outer [] be implied <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4433\" onclick=\"get_ticket_and_populate_wrapper('4433'); return false;\" title=\"Add syntax to allow users to append to configuration arrays\">#4433</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Sep-03 21:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ae9643816d37edda5e02f794b5ad134b3c4f5706\">[41093]</a></span>: Allow the JOB_ROUTER_DEFAULTS to be a list of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. This provides a simpler way to compose several sets of defaults together (for example, one from the application developer and one from the sysadmin). <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4433\" onclick=\"get_ticket_and_populate_wrapper('4433'); return false;\" title=\"Add syntax to allow users to append to configuration arrays\">#4433</a></span> The resulting idea looks something like this:\u00a0[...]\n (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Dec-01 13:36", "status": "resolved", "created": "2014-Jul-01 09:19", "fixed_version": "2014-Jul-01 09:19", "broken_version": "", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "johnkn", "derived_from": "#4555", "creator": "blin", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "blin@cs.wisc.edu, johnkn@cs.wisc.edu, marian.zvada@cern.ch", "due_date": ""}