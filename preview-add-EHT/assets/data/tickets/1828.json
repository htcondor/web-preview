{"id": 1828, "title": "Ticket #1828: schedd does not fork if condor_q authenticates", "description": "<blockquote>\nWhen condor_q authenticates, the schedd never forks when processing the query, no matter what the setting of SCHEDD_QUERY_WORKERS.  This is because the client does not call InitializeReadOnlyConnection().  This affects glideinWMS, because the frontend requires integrity (and therefore authentication) when running condor_q.\n\n<p>I am fixing this in the 7.5 branch, because in 7.5 we have a separate CEDAR command for read-only connections, so there is no need to rely on an additional message from the client to indicate that the connection is read-only.  This means that the fix will work for 7.5.5 schedds talking to condor_q from 7.5.0 and beyond.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Dec-30 09:38:38 by danb:</em> <br/>\n\nIt turns out that forking on all QMGMT_READ_CMDs doesn't work.  The problem is that clients older than 7.5.0 always send QMGMT_READ_CMD, even when they are intending to do write operations.  Also, even newer versions of condor_qedit were using QMGMT_READ_CMD (fixed for 7.5.5).\n\n<p>So instead of fixing things in the schedd, I am fixing things on the client side.  As of 7.5.5, qmgmt cleints that want a read-only session will always call InitializeReadOnlyConnection(), regardless of whether they are using an authenticated security session or not.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Dec-30 09:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/62778151f1ef768255be40c5989ac6253a2cd287\">[19834]</a></span>: condor_qedit uses QMGMT_WRITE_CMD now when the schedd version permits. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1828\" onclick=\"get_ticket_and_populate_wrapper('1828'); return false;\" title=\"schedd does not fork if condor_q authenticates\">#1828</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Dec-30 09:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/43dde4aa7be973cfb784f597c557b9417a02397f\">[19833]</a></span>: Fix for schedd not forking when condor_q is authenticated. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1828\" onclick=\"get_ticket_and_populate_wrapper('1828'); return false;\" title=\"schedd does not fork if condor_q authenticates\">#1828</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Dec-30 09:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7d8b9b5bc0653444f6aab916de3743c58b83bf4d\">[19832]</a></span>: Revert \"Fix for schedd not forking when condor_q authenticates. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1828\" onclick=\"get_ticket_and_populate_wrapper('1828'); return false;\" title=\"schedd does not fork if condor_q authenticates\">#1828</a></span>\" This reverts commit 32c6c3ba1d283396298aecf0e025f2cad0cb32fa.\u00a0[...]\n (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Dec-29 17:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/32c6c3ba1d283396298aecf0e025f2cad0cb32fa\">[19830]</a></span>: Fix for schedd not forking when condor_q authenticates. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1828\" onclick=\"get_ticket_and_populate_wrapper('1828'); return false;\" title=\"schedd does not fork if condor_q authenticates\">#1828</a></span> If the qmgmt connection was authenticated, the schedd never forked to process the request, no matter what the setting of SCHEDD_QUERY_WORKERS.  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Dec-30 09:38", "status": "resolved", "created": "2010-Dec-29 17:22", "fixed_version": "2010-Dec-29 17:22", "broken_version": "v070000", "priority": "4", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "sfiligoi@fnal.gov", "due_date": ""}