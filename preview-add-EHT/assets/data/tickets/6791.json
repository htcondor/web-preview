{"id": 6791, "title": "Ticket #6791: Chained spooling of job sandbox between schedds fails", "description": "<blockquote>\nATLAS reported a failure when attempting to submit a Condor-C job using condor_submit -spool. The job goes on hold in the second schedd with a complaint that it can't access job files under a path within the first schedd's spool directory. This is a bug between how the gridmanager constructs the new job ad for a Condor-C job and how the schedd rewrites the job ad when the job sandbox is spooled.\n\n<p>When a job's sandbox is spooled to the schedd, the schedd rewrites the job ad to change file paths so that they point to the files' new locations under the SPOOL directory. The original values of the modified attributes are saved under new attribute names with a <code>SUBMIT_</code> prefix. These are used when the output sandbox is transferred back to the submitter. If the attribute <code>SUBMIT_Iwd</code> is already set, then the schedd skips the rewriting process, under the assumption that it has already done the rewriting.\n\n</p><p>When the gridmanager submits a Condor-C job to a remote schedd, it doesn't remove attributes with a <code>SUBMIT_</code> prefix in the job ad that it sends to the remote schedd. If the local schedd has rewritten the job ad, then the remote schedd will not rewrite, even though it should. Thus, the remote schedd will attempt to access files using paths that are relevant to the local schedd.</p></blockquote>", "remarks": "<blockquote>\n<em>2018-Oct-17 16:23:55 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Looks good.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-09 11:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/076fdbd04c13175486f93dd0bc2c7f6d3a2b02f2\">[55537]</a></span>: Docs for Condor-C chained file spooling bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6791\" onclick=\"get_ticket_and_populate_wrapper('6791'); return false;\" title=\"Chained spooling of job sandbox between schedds fails\">#6791</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-09 11:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/231c864d6f3638c13d139ea281bccca58b15d96e\">[55536]</a></span>: Chained spooling of job sandbox between schedds fails <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6791\" onclick=\"get_ticket_and_populate_wrapper('6791'); return false;\" title=\"Chained spooling of job sandbox between schedds fails\">#6791</a></span> When the gridmanager submits a Condor-C job to a remote schedd, it needs to remove attributes starting with SUBMIT_ from the job ad that it sends. Otherwise, the remote schedd won't rewrite file paths in the ad to refer to its own SPOOL directory,\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2018-Oct-22 13:04", "status": "resolved", "created": "2018-Oct-08 16:44", "fixed_version": "2018-Oct-08 16:44", "broken_version": "", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "atlas", "visibility": "public", "notify": "", "due_date": ""}