{"id": 3170, "title": "Ticket #3170: Fixed length buffers", "description": "<blockquote>\nFrom Florian Weimer -\n\n<p><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>:: LookupString(const char *, char *) cannot be used securely\n\n</p><p>This variant of ClassAd::LookupString() copies a string of undetermined length (whose contents is potentially controlled by an attacker) into a buffer with a fixed, but unknown size.  Such an interface cannot be used in a secure fashion, much like the stdio function gets().  This LookupString() variant must be removed.\n\n</p><p>On a related note, ClassAd::LookupString(const char *, char *, int) fails to NUL-terminate long strings and should probably take a size_t argument, not an int.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Jul-31 14:29:32 by jfrey:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>I reviewed the following patches forwarded by Matt. They look good, but it appears they were made against a branch with Red Hat-specific code in queue.cpp. This will prevent them from applying cleanly to the UW codebase.\n\n</p><p></p><ul>\n<li>0002-Remove-ClassAd-EvalString-const-char-classad-ClassAd.patch\n</li><li>0005-Fix-up-for-Remove-ClassAd-EvalString-s-change-of-for.patch\n</li><li>0009-Make-ClassAd-LookupString-const-char-char-int-termin.patch\n</li><li>0010-Update-ClassAd-LookupString-const-char-char-int-call.patch\n</li><li>0011-Remove-uses-of-unsafe-LookupString-const-char-char-3.patch\n</li><li>0012-Remove-unsafe-LookupString-const-char-char-3170.patch</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-18 14:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/37385d6a3355a0f1584cadaa4169b011f6aa2482\">[33414]</a></span>: Remove unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span>  (By Zach Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-18 10:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3ba0a900f8a5df59098cdbc60462c11c891de257\">[33408]</a></span>: Remove unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span>  (By Zach Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-17 19:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0c72397cbd5c9cf8b7ca6635a33ffcd0c736c101\">[33404]</a></span>: Fix for string manipulation mods, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Erik Erlandson &lt;eerlands@redhat.com&gt; Committer: Matthew Farrellee  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-17 19:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3371521c57b2263e32717066aec261e2674c1bf9\">[33402]</a></span>: 7.6 only -- remove more uses of unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span>  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-17 19:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c3988b85eba5e354cd6196a87318075eb8c9fdbe\">[33401]</a></span>: Remove unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span>  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-17 19:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e81fa6465ab22c089280db57d99b54450cae4ea7\">[33400]</a></span>: Remove uses of unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt; Conflicts: src/condor_negotiator.V6/matchmaker.cpp src/condor_submit.V6/submit.cpp src/condor_utils/file_transfer.cpp  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-17 19:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/163009c5fa20880547fc87c4e758d9b4cdbfa797\">[33399]</a></span>: Update ClassAd::LookupString(const char *, char *, int) call sites to take advantage of terminating from <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LookupString\" title=\"Lookup String\">LookupString</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt; Conflicts: src/condor_gridmanager/ec2job.cpp  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-17 19:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6cc6fa320d36d9b7a579bb9410b42113b9bfbc46\">[33398]</a></span>: Make ClassAd::LookupString(const char *, char *, int) terminate theresulting string with '\\0', <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt;  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/826aca549a9d317db053b60c9fbfd6f0eb9f3c28\">[33373]</a></span>: Fix for string manipulation mods, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Erik Erlandson &lt;eerlands@redhat.com&gt; Committer: Matthew Farrellee  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/29cc57a52edeb1a5d716aa1a423b59efef3c1c5c\">[33363]</a></span>: Remove unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span>  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b0a57918397661a2a0a8c83a6b82749beb4fc8a4\">[33356]</a></span>: Fix up for \"Remove ClassAd::EvalString\"'s change of format_owner, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt;  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4a07dad3b622ba3a3b0c73490ea691d492d178b4\">[33360]</a></span>: Make ClassAd::LookupString(const char *, char *, int) terminate theresulting string with '\\0', <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt;  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/38da787cfa6b490e984867c73caf9697a23a5116\">[33361]</a></span>: Update ClassAd::LookupString(const char *, char *, int) call sites to take advantage of terminating from <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LookupString\" title=\"Lookup String\">LookupString</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt;  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5079887ab271b910c4dbed60e1aa96ae6bf5ee75\">[33362]</a></span>: Remove uses of unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt; Conflicts: src/condor_utils/classad_support.cpp classad_support.cpp has been removed from master. Conflict resolved by removing classad_support.cpp from this patch.  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/79b8d14b6973c83e1f709528713edebc63cf6184\">[33353]</a></span>: Remove ClassAd::EvalString(const char *, classad::ClassAd *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3170\" onclick=\"get_ticket_and_populate_wrapper('3170'); return false;\" title=\"Fixed length buffers\">#3170</a></span> This is an inherently unsafe, gets()-style interface. Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt; Committer: Matthew Farrellee  (By Florian Weimer )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Dec-17 12:51", "status": "resolved", "created": "2012-Jul-30 14:57", "fixed_version": "2012-Jul-30 14:57", "broken_version": "v070600", "priority": "2", "subsystem": "Daemons", "assigned_to": "zmiller", "derived_from": "", "creator": "matt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu", "due_date": ""}