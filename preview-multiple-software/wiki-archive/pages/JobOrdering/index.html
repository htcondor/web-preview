<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="HTCondor Homepage">
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/web-preview/preview-multiple-software/assets/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/web-preview/preview-multiple-software/assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/web-preview/preview-multiple-software/assets/images/favicons/favicon-16x16.png">
    <link rel="manifest" href="/web-preview/preview-multiple-software/assets/images/favicons/site.webmanifest">
    <link rel="mask-icon" href="/web-preview/preview-multiple-software/assets/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/web-preview/preview-multiple-software/assets/images/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/web-preview/preview-multiple-software/assets/images/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <!-- Primary Meta Tags -->
    <meta name="title" content="HTCondor">
    <meta name="description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://htcondor.org/">
    <meta property="og:title" content="HTCondor">
    <meta property="og:description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">
    <meta property="og:image" content="https://htcondor.org/assets/images/HTC.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://htcondor.org/">
    <meta property="twitter:title" content="HTCondor">
    <meta property="twitter:description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">
    <meta property="twitter:image" content="https://htcondor.org/assets/images/HTC.png">

    <title>Job Ordering</title>

    <script src="/web-preview/preview-multiple-software/assets/js/sitewide.js" type="text/javascript" defer></script>
    <script src="/web-preview/preview-multiple-software/assets/js/bootstrap.js" type="text/javascript"></script>
    

    

    <meta name="robots" content="noindex">

    

    <link href="/web-preview/preview-multiple-software/assets/css/style-v1.css" media="screen, tv, projection" title="Default" rel="stylesheet">
    

</head>
<body class="vh-100 d-flex flex-column">

<!-- For non-visual user agents: -->
<a id="skip-link" href="#main-copy">Skip to main content.</a>

<header id="header">
    <div class="mb-4 container">
        <div class="row">
            <div class="col-12">
                <nav class="navbar navBar navbar-expand-lg navbar-light w-100">
                    <a href="/web-preview/preview-multiple-software/index.html" class="d-none d-md-inline"><img height="75" alt="Condor High Throughput Computing" src="/web-preview/preview-multiple-software/assets/images/CondorTitle.png" style="border:0"></a>
                    <a href="/web-preview/preview-multiple-software/index.html" class="d-inline d-md-none"><img height="65" alt="Condor High Throughput Computing" src="/web-preview/preview-multiple-software/assets/images/HTCondor_red_blk.svg" style="border:0"></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mb-2 mb-lg-0 ms-auto mt-auto">
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-multiple-software/">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-multiple-software/new">News</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="software-toggle" role="button" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
                                    Software
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="software-toggle">
                                    <li class="dropstart">
                                        <a class="nav-link dropdown-item dropdown-toggle" href="#" id="htcondor-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            HTCondor
                                        </a>
                                        <ul class="dropdown-menu" aria-labelledby="htcondor-toggle">
                                            <li><a class="dropdown-item" href="/web-preview/preview-multiple-software/htcondor/overview/">Overview</a></li>
                                            <li><a class="dropdown-item" href="/web-preview/preview-multiple-software/htcondor/download/">Download</a></li>
                                            <li><a class="dropdown-item" href="/web-preview/preview-multiple-software/htcondor/documentation/">Documentation</a></li>
                                            <li><a class="dropdown-item" href="https://htcondor.readthedocs.io/en/latest/version-history/index.html">Release Notes&#11023;</a></li>
                                        </ul>
                                    </li>
                                    <li class="dropstart">
                                        <a class="nav-link dropdown-item dropdown-toggle" href="#" id="htcondor-ce-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            HTCondor-CE
                                        </a>
                                        <ul class="dropdown-menu" aria-labelledby="htcondor-ce-toggle">
                                            <li><a class="dropdown-item" href="/web-preview/preview-multiple-software/htcondor-ce/overview/">Overview</a></li>
                                            <li><a class="dropdown-item" href="/web-preview/preview-multiple-software/htcondor-ce/download/">Download</a></li>
                                            <li><a class="dropdown-item" href="/web-preview/preview-multiple-software/htcondor-ce/documentation/">Documentation</a></li>
                                            <li><a class="dropdown-item" href="https://htcondor.com/htcondor-ce/v5/releases/#htcondor-ce-5-version-history">Release Notes&#11023;</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="documentation-toggle" role="button" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
                                    Documentation
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="documentation-toggle">
                                    <li class="dropstart">
                                        <a class="nav-link dropdown-item" href="/web-preview/preview-multiple-software/htcondor/documentation">
                                            HTCondor
                                        </a>
                                    </li>
                                    <li>
                                        <a class="nav-link dropdown-item" href="/web-preview/preview-multiple-software/htcondor-ce/documentation" >
                                            HTCondor-CE
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="mailto:htcondor-admin@cs.wisc.edu">Contact Us</a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        <div class="row" style="height:40px">
            

<script async src="https://cse.google.com/cse.js?cx=1056a9a876b1d1474"></script>
<div class="gcse-searchbox-only"></div>


        </div>
    </div>
</header>
<main id="main-copy" tabindex="-1">
    <div class="container mb-4">
    <h1>Job Ordering</h1>
<div id="content">
 Note: not yet complete!
 <p>
  The way this is handled in the code is probably not as clean as it could be, because PRE and POST scripts got added to DAGMan after the initial code was written.  Because of that, I guess, PRE scripts are handled outside of the ready queue data structure, which is kind of awkward.
 </p>
 <p>
  There are a number of important data structures relating to job ordering:
 </p>
 <ul>
  <li>
   <code>
    Dag::_jobs
   </code>
   : a list of all Job objects (nodes) in the DAG.
  </li>
  <li>
   <code>
    Dag::_readyQ
   </code>
   : a queue of all jobs that are ready to be submitted (all of their parent nodes have finished, and their PRE scripts, if any, have also finished).
  </li>
  <li>
   <code>
    Job::_queues[Q_WAITING]
   </code>
   : a list of Job objects (nodes) that this Job is waiting on (Jobs are removed from this queue as they finish).  (The Job object also has parents and children queues.)
  </li>
 </ul>
 <p>
  When DAGMan starts up, the ready queue is empty.
  <code>
   Dag::Bootstrap()
  </code>
  calls
  <code>
   Dag::StartNode()
  </code>
  on all jobs with empty waiting queues.
  <code>
   Dag::StartNode()
  </code>
  either runs the node's PRE script (if there is one) or puts the node into the ready queue.  If a job does have a PRE script, and the PRE script succeeds,
  <code>
   Dag::PreScriptReaper()
  </code>
  puts the job into the ready queue.  (If the PRE script fails,
  <code>
   Dag::PreScriptReaper()
  </code>
  marks the job as failed, except in special cases.)
 </p>
 <p>
  Once a job is in the ready queue, it will eventually get submitted by
  <code>
   Dag::SubmitReadyJobs()
  </code>
  , which is called from
  <code>
   condor_event_timer()
  </code>
  in
  <em>
   dagman_main.cpp
  </em>
  ;
  <code>
   condor_event_timer()
  </code>
  is called by daemoncore (every 5 seconds by default).  Note that
  <code>
   Dag::SubmitReadyJobs()
  </code>
  will only submit a certain number of jobs each time it is called (that number is configurable).  If the attempt to submit the job fails,
  <code>
   Dag::SubmitReadyJobs()
  </code>
  calls
  <code>
   Dag::ProcessFailedSubmit()
  </code>
  , which puts the job back into the ready queue.
 </p>
 <p>
  When a job finishes, DAGMan sees the job's terminated event in the appropriate log file, and calls
  <code>
   Dag::ProcessTerminatedEvent()
  </code>
  .  If the job failed,
  <code>
   Dag::ProcessTerminatedEvent()
  </code>
  calls
  <code>
   Job::TerminateFailure()
  </code>
  , which marks the job as failed.
  <code>
   Dag::ProcessTerminatedEvent()
  </code>
  then calls
  <code>
   Dag::ProcessJobProcEnd()
  </code>
  , whether the job succeeded or failed.
  <code>
   Dag::ProcessJobProcEnd()
  </code>
  takes a number of possible actions, such as initiating a retry for the node, starting the node's POST script, waiting for other job procs to finish if the cluster contains more than one proc, or marking the node as successful.
 </p>
 <p>
  TEMPTEMP -- talk about post script
 </p>
 <p>
  When a node finishes, we call
  <code>
   Dag::TerminateJob()
  </code>
  on it; that method goes through the list of this node's children and removes the just-finished node from the children's waiting queues.  For each child whose waiting queue becomes empty, it calls
  <code>
   Dag::StartNode()
  </code>
  , and the cycle continues.
 </p>
 <p>
  <code>
   condor_event_timer()
  </code>
  in
  <em>
   dagman_main.cpp
  </em>
  gets called every five (by default) seconds.  In that function, we call
  <code>
   Dag::SubmitReadyJobs()
  </code>
  to submit any jobs that are ready; ready any new node job events (see ???); output the status of the DAG; and check whether the DAG is finished.
 </p>
 <p>
 </p>
 <ul>
  <li>
   Submission/event reading loop -- every 5 sec (default) via daemoncore
  </li>
  <li>
   ready queue -- Job objects go into it when ready to submit
  </li>
  <li>
   pre scripts are handled kind of kludgily -- might make more sense for Job objects to go into the ready queue when the PRE script should be submitted
  </li>
  <li>
   document list of parents, not done parents in Job objects
  </li>
  <li>
   Jobs have lists of parents, pending parents, etc.
  </li>
  <li>
   Each job has parents, waiting, and children lists (parents and children lists don't change during run; waiting does)
  </li>
  <li>
   submit failure puts job back into ready queue
  </li>
  <li>
   pre scripts are handled separately from ready queue -- kind of goofs things up...
  </li>
  <li>
   maybe explain how things work w/o pre/post scripts, then add in that info
  </li>
 </ul>
</div>

</div>
</main>
<footer id="footer" class="border-top bg-light pt-4 mt-auto">
    <div class="container">
        <div class="row">
            <div class="col-2 d-none d-lg-flex">
                <img class="my-auto" height="65" alt="Condor High Throughput Computing" src="/web-preview/preview-multiple-software/assets/images/HTCondor_red_blk.svg" />
            </div>
            <div class="col-1 d-none d-lg-flex"></div>
            <div class="col-12 col-lg-9">
                <div class="row justify-content-between my-2">
                    <div class="col-auto m-2">
                        <table>
                            <tr><th>Suite</th></tr>
                            <tr><td><a href="/web-preview/preview-multiple-software/htcondor/">HTCondor</a></td></tr>
                            <tr><td><a href="/web-preview/preview-multiple-software/htcondor-ce/">HTCondor-CE</a></td></tr>
                        </table>
                    </div>
                    <div class="col-auto m-2">
                        <table>
                            <tr><th>Software</th></tr>
                            <tr><td><a href="/web-preview/preview-multiple-software/manual/">Documentation</a></td></tr>
                            <tr><td><a href="/web-preview/preview-multiple-software/downloads/">Download</a></td></tr>
                            <tr><td><a href="/web-preview/preview-multiple-software/security/">Security</a></td></tr>
                            <tr><td><a href="/web-preview/preview-multiple-software/license/">License</a></td></tr>
                        </table>
                    </div>
                    <div class="col-auto m-2">
                        <table>
                            <tr><th>Community</th></tr>
                            <tr><td><a href="/web-preview/preview-multiple-software/mail-lists/">Email Lists</a></td></tr>
                            <tr><td><a href="/web-preview/preview-multiple-software/past_condor_weeks.html/">HTCondor Week</a></td></tr>
                            <tr><td><a href="/web-preview/preview-multiple-software/release-notes/">Contribute</a></td></tr>
                        </table>
                    </div>
                    <div class="col-auto m-2">
                        <table>
                            <tr><th>Support</th></tr>
                            <tr><td><a href="mailto:htcondor-admin@cs.wisc.edu">Support Email</a></td></tr>
                            <tr><td><a href="/web-preview/preview-multiple-software/mail-lists/">Email Lists</a></td></tr>
                            <tr><td><a href="/web-preview/preview-multiple-software/uw-support/">Contract Support</a></td></tr>
                            <tr><td><a href="/web-preview/preview-multiple-software/htcondor-support#external-support/">Outside Support</a></td></tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <hr>
        <div class="row py-4">
            <div class="col text-center">
                For comments or questions about this website, please email
                <a href="mailto:htcondor-admin@cs.wisc.edu">htcondor-admin@cs.wisc.edu</a><br />
                This work is supported by <a href="https://www.nsf.gov/div/index.jsp?div=OAC">NSF</a> under Cooperative Agreement <a href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=2030508">OAC-2030508</a> as part of the <a href="https://path-cc.io/">PATh Project</a>. <br />
                <script type="text/javascript">
                    document.write("Updated &raquo; "+lastMod(document.lastModified))
                </script>
            </div>
        </div>
    </div>
</footer>



</body>
</html>
