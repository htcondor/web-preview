{"id": 4138, "title": "Ticket #4138: Globus authz callout should be cached", "description": "<blockquote>\nThe GSI authz callout can be quite heavyweight, especially if it has to contact an external service to get the mapping.\n\n<p>However, the mapping tends to be very simple.  The function of \"(DN, VOMS FQAN) -&gt; username\" covers nearly all use cases and changes very slowly in time.\n\n</p><p>I propose we cache this mapping within the HTCondor daemon itself.</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Jul-08 14:13:16 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p></p><ol>\n<li>Looks like you want to pass the updateDuplicateKeys flag in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=HashTable\" title=\"Hash Table\">HashTable</a></span> ctor, as it looks like the code right now is inserting multiple elements into the hashtable with the same key.  Don't think you intended that.\n\n<p></p></li><li>Right now the name of the config knob is <code>GSI_MAPPING_CACHE_EXPIRATION</code>, think it would make more sense if it was called <code>GSS_ASSIST_GRIDMAP_CACHE_EXPIRATION</code> to match up with the keyword used in the htcondor map file.\n\n<p></p></li><li>The default for the above knob is 300.  Seems like we must have the default at 0 (disable cache), since we have no way of knowing which attributes the callout looks at in order to make the mapping.  Since we are talking about security authorization, would like the default to error on the side of correctness over performance.\n\n<p></p></li><li>Add blurb about the new knob in the version history.\n</li></ol>\n\n<p></p><hr/>\n<em>2014-Jul-15 10:44:01 by tannenba:</em> <br/>\n\nCouple issues with this ticket :\n\n<p></p><ol>\n<li>It was marked as resolved, but <code>Fixed Version</code> field was never filled in.  Doing this is important because to our release process.\n\n<p></p></li><li>This patch does more than the ticket talks about; specifically, looks like it has an important patch to work around a bug in LCMAPS. Should the LCMAPS part of the patch be in a separate ticket and go into the stable series? For now I just updated the ticket description.\n</li></ol>\n\n<p>Thanks\n\n</p><p></p><hr/>\n<em>2014-Jul-15 10:51:21 by bbockelm:</em> <br/>\n\nHi Todd,\n\n<p>Added the fixed version.\n\n</p><p>The code for the LCMAPS bug was already present from a prior release (I just merged things forward).  There are no additions in this ticket.\n\n</p><p>(Updated ticket description back to original)\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2014-Jul-15 11:01:07 by tannenba:</em> <br/>\n\nLooks good, thanks Brian.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jul-22 10:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e2a00c7abf5d73c64d9ffeadb1d0c0735d4639fa\">[40717]</a></span>: edit doc for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4138\" onclick=\"get_ticket_and_populate_wrapper('4138'); return false;\" title=\"Globus authz callout should be cached\">#4138</a></span>, and add a couple of index entries, when I could not find what I wanted to understand this ticket.  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jul-10 21:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0f7d567080c57b35adbe4191b75561fb310ed005\">[40612]</a></span>: Cache results of Globus authz callouts. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4138\" onclick=\"get_ticket_and_populate_wrapper('4138'); return false;\" title=\"Globus authz callout should be cached\">#4138</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jul-10 21:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/74ff7ac52f3325831aa895128fa5bd649580a756\">[40613]</a></span>: Fixes from code review. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4138\" onclick=\"get_ticket_and_populate_wrapper('4138'); return false;\" title=\"Globus authz callout should be cached\">#4138</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Jul-15 11:01", "status": "resolved", "created": "2013-Dec-27 09:12", "fixed_version": "2013-Dec-27 09:12", "broken_version": "", "priority": "4", "subsystem": "Security", "assigned_to": "bbockelm", "derived_from": "#4136", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu, jfrey@cs.wisc.edu", "due_date": ""}