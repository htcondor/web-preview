{"id": 5301, "title": "Ticket #5301: Shared Port and HAD don't work together", "description": "<blockquote>\nThe HAD daemons don't work properly when Shared Port is enabled. The standard configuration for them to listen on their own well-known port, but they believe their primary address is behind the shared port daemon.\n\n<p>For an immediate fix, we can force the HAD daemons to always ignore shared port. One way to do this is to add daemon-specific entries in the param defaults table, like this:\n</p><div class=\"verbatim\">\n<pre>HAD.USE_SHARED_PORT = False\nREPLICATION.USE_SHARED_PORT = False\n</pre></div>\n\n\n<p>Another way to do this is to modify SharedPortEndpoint::UseSharedPort() to always return False inside the HAD and REPLICATION daemons, like it does inside the SHARED_PORT daemon.\n\n</p><p>Long term, we should investigate how to have the HAD daemons work with shared port. This could mean allowing shared port ids to be specified in the current HAD configuration. Or it could mean developing a new way for the HAD daemons to find each other, say via ads in the collectors.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Oct-14 15:38:37 by jfrey:</em> <br/>\n\nThe sample configuration in the manual for HAD also should be updated.\n\n<p></p><hr/>\n<em>2015-Oct-23 09:50:34 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Lots of small, simple changes.  I approve. :)</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-23 14:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/60b74ca987bc444d7f8a7816e455bc2688ae19d3\">[46087]</a></span>: Version history for HAD plus shared port fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5301\" onclick=\"get_ticket_and_populate_wrapper('5301'); return false;\" title=\"Shared Port and HAD don't work together\">#5301</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-19 15:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/16aa6ef9739fe96129005367d77ebc1f602f95bd\">[46010]</a></span>: Add note about HAD and shared port in the manual. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5301\" onclick=\"get_ticket_and_populate_wrapper('5301'); return false;\" title=\"Shared Port and HAD don't work together\">#5301</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-19 15:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6a5e84cf744f9f2411b30b518861e4f9cc908912\">[46008]</a></span>: Fix a mis-named HAD param name. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5301\" onclick=\"get_ticket_and_populate_wrapper('5301'); return false;\" title=\"Shared Port and HAD don't work together\">#5301</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-19 15:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8a3950935a5513062354306a6e59d694c5ee7083\">[46009]</a></span>: Never use shared port in the HAD and Replication daemons. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5301\" onclick=\"get_ticket_and_populate_wrapper('5301'); return false;\" title=\"Shared Port and HAD don't work together\">#5301</a></span> At the moment, the HAD and Replication daemons don't know how to handle shared port for themselves or their peers. They need their own dedicated port.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-19 15:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0d20e9b65b1a6f67fc227df46a73c7e90cb1d24e\">[46006]</a></span>: Update the param table for HAD-related knobs. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5301\" onclick=\"get_ticket_and_populate_wrapper('5301'); return false;\" title=\"Shared Port and HAD don't work together\">#5301</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-19 15:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ccb19660e6d1dfd3034d806c30c85d19c6c41283\">[46007]</a></span>: Update the sample HAD configuration files. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5301\" onclick=\"get_ticket_and_populate_wrapper('5301'); return false;\" title=\"Shared Port and HAD don't work together\">#5301</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-19 15:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fa3204814c48ce477f90dbc8fdb38565d7fb080b\">[46005]</a></span>: Fix minor config-related problems in the HAD daemons. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5301\" onclick=\"get_ticket_and_populate_wrapper('5301'); return false;\" title=\"Shared Port and HAD don't work together\">#5301</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-19 15:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/41a964fc09e0c673a74a7c866b2ef2258fb1973f\">[46004]</a></span>: Fix ad invalidation for the Replication daemon. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5301\" onclick=\"get_ticket_and_populate_wrapper('5301'); return false;\" title=\"Shared Port and HAD don't work together\">#5301</a></span>  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Oct-23 14:05", "status": "resolved", "created": "2015-Oct-12 10:58", "fixed_version": "2015-Oct-12 10:58", "broken_version": "v080200", "priority": "4", "subsystem": "DaemonsCM", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "a28903", "customer_group": "cern", "visibility": "public", "notify": "", "due_date": ""}