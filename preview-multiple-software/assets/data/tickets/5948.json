{"id": 5948, "title": "Ticket #5948: Permissions on subdirectories not properly preserved by file transfer", "description": "<blockquote>\nAt least on Linux/Mac platforms, for non-directory files, the output transfer process preserves the file permissions while ignoring the umask.\n\n<p>Unfortunately, the code to preserve file permissions on subdirectories applies the umask of the HTCondor daemon (which is typically 022).  There does not appear to be a knob to override this.  This is surprising; permissions on transferred subdirectories should work the same way as transferred files.\n\n</p><p>In addition, if file transfer is occurring from a Windows machine to a Linux machine, the subdirectory will end up with permission 000 on the Linux machine.\n\n</p><p>Reported by Michael Pelletier on htcondor-users <a class=\"external\" href=\"https://www-auth.cs.wisc.edu/lists/htcondor-users/2016-September/msg00100.shtml\">in this post</a>.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Oct-19 11:14:27 by mvpelletier:</em> <br/>\n\nSorry I didn't flag this to you guys sooner, I first puzzled over it a couple of years ago, and didn't look closely enough at it to realize it wasn't my own fault.\n\n<p>In my current project, it would be very helpful to have a patched binary for 8.4.9 on RHEL6 if possible, to avoid the need for a post-output-transfer chmod in a DAG node or some such.\n\n</p><p></p><hr/>\n<em>2016-Nov-03 11:20:26 by tannenba:</em> <br/>\n\n<strong>Testing Notes</strong>\n\n<p>Given a job and submit file that look like this -\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">[tannenba@localhost mkd]$ cat mkd.sh\n#!/bin/sh\nmkdir outdir\ntouch outdir/smell\nchmod 777 outdir\nchmod 777 outdir/smell\n\n[tannenba@localhost mkd]$ cat mkd.sub\nexecutable = mkd.sh\nshould_transfer_files = YES\ntransfer_output_files = outdir\nqueue\n</pre></div>\n\n\n<p>Here are the results submitting the job <em>before</em> the patches in this ticket; note the permissions on directory <code>outdir</code> are not 0777:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">[tannenba@localhost mkd]$ condor_submit mkd.sub\nSubmitting job(s).\n1 job(s) submitted to cluster 2.\n[tannenba@localhost mkd]$ umask\n0002\n[tannenba@localhost mkd]$ ls -ld outdir/\ndrwxr-xr-x. 2 tannenba tannenba 4096 Oct 19 19:14 outdir/\n[tannenba@localhost mkd]$ ls -l outdir/\ntotal 0\n-rwxrwxrwx. 1 tannenba tannenba 0 Oct 19 19:14 smell\n</pre></div>\n\n\n<p>And here are the results submitting the job <em>after</em> the patches in this ticket; note the permissions on directory <code>outdir</code> are now 0777 as expected:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">[tannenba@localhost mkd]$ condor_submit mkd.sub\nSubmitting job(s).\n1 job(s) submitted to cluster 3.\n[tannenba@localhost mkd]$ umask\n0002\n[tannenba@localhost mkd]$ ls -ld outdir/\ndrwxrwxrwx. 2 tannenba tannenba 4096 Nov  3 10:32 outdir/\n[tannenba@localhost mkd]$ ls -l outdir/\ntotal 0\n-rwxrwxrwx. 1 tannenba tannenba 0 Nov  3 10:32 smell\n</pre></div>\n\n\n<p></p><hr/>\n<em>2016-Nov-23 11:18:18 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p></p><ul>\n<li>Shouldn't the default permissons for a directory be 0700? With 0600, the user can't access the files inside the directory.\n</li></ul>\n\n<p></p><hr/>\n<em>2016-Dec-01 17:19:21 by tannenba:</em> <br/>\n\nIndeed, changed default perm to 0700.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Dec-06 15:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/12e55f7719de4f9fc02b02016c2a52bd17bb2b3c\">[49744]</a></span>: Docs for subdirectory permissions fix in file transfer. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5948\" onclick=\"get_ticket_and_populate_wrapper('5948'); return false;\" title=\"Permissions on subdirectories not properly preserved by file transfer\">#5948</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Dec-01 17:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3fa04ae1a47f3779006c8c50e2493779ab6ce7c6\">[49708]</a></span>: Default perms for transferred directory should be 0700, not 0600. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5948\" onclick=\"get_ticket_and_populate_wrapper('5948'); return false;\" title=\"Permissions on subdirectories not properly preserved by file transfer\">#5948</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Nov-03 11:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c4f4e472834cd50edec87c7867bf109838dc13e9\">[49534]</a></span>: Preserve permissions on subdirectories moved via file transfer. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5948\" onclick=\"get_ticket_and_populate_wrapper('5948'); return false;\" title=\"Permissions on subdirectories not properly preserved by file transfer\">#5948</a></span> This patch fixes a bug whereby the code to preserve file permissions on subdirectories applies the umask of the HTCondor daemon (which is typically 022). This is surprising; with this patch, now permissions on transferred subdirectories\u00a0[...]\n (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Oct-19 19:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/52ba6b6a6377f0d6de11c105bf7a6960a89e2071\">[49532]</a></span>: Use mode 022, not 000, when moving subdir from Win32 to Linux. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5948\" onclick=\"get_ticket_and_populate_wrapper('5948'); return false;\" title=\"Permissions on subdirectories not properly preserved by file transfer\">#5948</a></span>  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Dec-06 15:31", "status": "resolved", "created": "2016-Oct-05 17:18", "fixed_version": "2016-Oct-05 17:18", "broken_version": "v080200", "priority": "3", "subsystem": "FileTransfer", "assigned_to": "jfrey", "derived_from": "", "creator": "tannenba", "rust": "", "customer_group": "users", "visibility": "public", "notify": "", "due_date": ""}