{"id": 4987, "title": "Ticket #4987: DAGMan shouldn't open a command socket?", "description": "<blockquote>\nWe think that DAGMan opens a command socket via daemoncore, and it probably shouldn't do that, at least on Linux.  (There's a way to tell daemoncore to not do this.)  ToddT says that \"signals\" on Windows get passed via the command socket, so we may need to keep the socket on Windows (but we're not sure that DAGMan responds correctly to, say, condor_rm on Windows, so it may not matter).</blockquote>", "remarks": "<blockquote>\n<em>2015-Apr-27 13:13:34 by wenger:</em> <br/>\n\nOkay, it's pretty easy to get DAGMan to not open a command socket by prepending\n'-p 0' to the command-line arguments.  But then I get this error when trying to run a PRE script:\n\n<p></p><pre>  ERROR \"Assertion ERROR on (mysin.Length() &gt; 0)\" at line 6596 in file /u/w/e/wenger/cb/git9/CONDOR_SRC/src/condor_daemon_core.V6/daemon_core.cpp\n</pre>\n\n<p></p><hr/>\n<em>2015-Apr-27 13:24:34 by tannenba:</em> <br/>\n\nRe the above assertion, git blame points to Alan <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DeSmet\" title=\"De Smet\">DeSmet</a></span> with this commit <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b671a0199b868fdf169f71cb7d33e5438766ee81\">[27857]</a></span>.  Alan, please fix - apparently to reproduce just pass \"-p 0\" to any daemon core daemon.... \"-p 0\" is supposed to mean run without a command port.\n\n<p></p><hr/>\n<em>2015-Apr-27 15:15:27 by wenger:</em> <br/>\n\nArgh -- sorry about the double update of the notify list -- I think ToddT had added Alan, but I hadn't updated the copy in my browser.\n\n<p>Anyhow, Alan, when I just comment out that assertion things seem to work okay, but I don't want to just take it out without understanding better what's going on in that code...\n\n</p><p></p><hr/>\n<em>2015-Apr-28 09:31:31 by wenger:</em> <br/>\n\nHow to reproduce this:\n<ul>\n<li>condor_submit_dag -f -no_submit job_dagman_basic.dag\n</li><li>edit job_dagman_basic.dag.condor.sub and prepend '-p 0' to the arguments\n</li><li>condor_submit job_dagman_basic.dag.condor.sub\n</li></ul>\n\n<p>(See job_dagman_basic.dag.dagman.out)\n\n</p><p></p><hr/>\n<em>2015-Apr-28 14:55:16 by adesmet:</em> <br/>\n\nDealing with the ASSERT will take more time than I can justify right now.  I've punted it off to <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=5031\" onclick=\"get_ticket_and_populate_wrapper('5031'); return false;\" title=\"DaemonCore::CreateProcess ASSERT empty InfoCommandSinfulStringMyself\">#5031</a></span>.  For now can you just delete or comment out the ASSERT?</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=5031\" onclick=\"get_ticket_and_populate_wrapper('5031'); return false;\" title=\"DaemonCore::CreateProcess ASSERT empty InfoCommandSinfulStringMyself\">#5031</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDaemonCore::CreateProcess ASSERT empty <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=InfoCommandSinfulStringMyself\" title=\"Info Command Sinful String Myself\">InfoCommandSinfulStringMyself</a></span></td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-30 10:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/84f3750a8dcd40e0d94c579691a291c27c9532e8\">[44763]</a></span>: minor edit of 8.3.6 version history item. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4987\" onclick=\"get_ticket_and_populate_wrapper('4987'); return false;\" title=\"DAGMan shouldn't open a command socket?\">#4987</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-29 13:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8529e6f7830e34fd05d929cca438ebcef96eb4e3\">[44746]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4987\" onclick=\"get_ticket_and_populate_wrapper('4987'); return false;\" title=\"DAGMan shouldn't open a command socket?\">#4987</a></span>: condor_submit_dag adds '-p 0' to arguments to have DAGMan not create a command port; changed assertion in daemoncore to a warning so it will work...  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Jun-02 16:16", "status": "resolved", "created": "2015-Apr-06 14:22", "fixed_version": "2015-Apr-06 14:22", "broken_version": "v080305", "priority": "4", "subsystem": "Dag", "assigned_to": "", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, zmiller@cs.wisc.edu, tannenba@cs.wisc.edu adesmet@cs.wisc.edu tlmiller@cs.wisc.edu", "due_date": ""}