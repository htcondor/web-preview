{"id": 5103, "title": "Ticket #5103: USE_SHARED_PORT should be on by default in 8.5 series", "description": "<blockquote>\nEarly in the 8.5 series (8.5.0) <code>USE_SHARED_PORT</code> should be enabled by default on non-windows platforms (Windows also if it works).</blockquote>", "remarks": "<blockquote>\n<em>2015-Sep-15 17:11:30 by tlmiller:</em> <br/>\n\nSee run ID 341645.  The CCB tests are a known delay with HTCondor starting up when the shared port daemon is using the CCB of a collector behind it; we have code in unit_test_sinful.run to work around it.\n\n<p></p><hr/>\n<em>2015-Sep-15 17:24:37 by tlmiller:</em> <br/>\n\nThe cmd_status_shows-absent test seems to be failing because of a failure to condor_advertise:\n\n<p></p><div class=\"verbatim\">\n<pre>+ CMD[14:39:24]: _condor_TOOL_TIMEOUT_MULTIPLIER=4 condor_advertise -multiple UPDATE_STARTD_AD cmd_status_shows-absent.classads.10966\n....\nProblem error return from condor_advertise:1\n</pre></div>\n\n\n<p>with the following the collector log, which may be relevant:\n\n</p><p></p><div class=\"verbatim\">\n<pre>09/15/15 14:39:28 DaemonCore: Can't receive command request from 128.104.103.9 (perhaps a timeout?)\n09/15/15 14:39:28 DaemonCore: Can't receive command request from 128.104.103.9 (perhaps a timeout?)\n</pre></div>\n\n\n<p>The shared log records a failure to connect to the collector, but that well after the collector begins shutting down.\n\n</p><p></p><hr/>\n<em>2015-Sep-17 14:36:37 by tlmiller:</em> <br/>\n\nThere's actually a more-subtle problem in the CCB tests (I think) -- they activate CCB only for a small subset of the daemons.  In particular, the shared port daemon is not configured to use CCB, which I think means that no daemon using it will get CCB addresses.  The test then correctly fails if CCB was not used.\n\n<p>After discussion with TimT and TJ, the idea is a follows: make the current CCB tests specifically CCB-without-SP, so that we can turn SP on by default for 8.5.1; and add additional CCB tests later, for which SP is explicitly turned on.\n\n</p><p></p><hr/>\n<em>2015-Sep-17 14:48:57 by tlmiller:</em> <br/>\n\nWhile lib_ccb_startd and lib_ccb_schedd both failed, we would expect lib_ccb_schedd_privnet to also fail.  However, it succeeds.  The problem is that the schedd isn't advertising its private network at all (since it has no CCB address), so the \"test\" doesn't actually check to make sure that matching private networks cause a CCB bypass.  This test will also be mad explicitly not-SP, and will need to be adjusted for a SP world.\n\n<p></p><hr/>\n<em>2015-Sep-24 17:47:36 by tlmiller:</em> <br/>\n\nAlso failing as a result of using shared port by default is the job router (lib_job_router_local) on Windows.  Since we don't particularly care -- and the work-around should be trivial -- that's what we'll do.\n\n<p></p><hr/>\n<em>2015-Sep-29 15:23:08 by tlmiller:</em> <br/>\n\njob_dagman_submit_parse also fails.  It looks like it's failing because of <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5283\" title=\"Shared port deadlock on Windows?\">#5283</a></span>, so I'll be turning off shared port for this test as well, and creating a ticket to turn it back on (or test it both ways) when ticket <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5283\" title=\"Shared port deadlock on Windows?\">#5283</a></span> is resolved.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5209\" title=\"cannot shutdown condor_shared_port on Windows\">#5209</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\ncannot shutdown condor_shared_port on Windows</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5283\" title=\"Shared port deadlock on Windows?\">#5283</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nShared port deadlock on Windows?</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-28 15:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=46130\">[46130]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5103\" title=\"USE_SHARED_PORT should be on by default in 8.5 series\">#5103</a></span>) Mention in the release notes and the gotchas that 8.5.1 enables/d shared port by default.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-28 12:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=46126\">[46126]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5103\" title=\"USE_SHARED_PORT should be on by default in 8.5 series\">#5103</a></span>) Mention in the release notes and the gotchas that 8.5.1 enables/d shared port by default.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-05 16:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=45927\">[45927]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5103\" title=\"USE_SHARED_PORT should be on by default in 8.5 series\">#5103</a></span>) Update the manual to indicate shared port is the default configuration  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-01 13:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=45910\">[45910]</a></span>: Squashed commit of the following: commit 9145bb0498500b34d83ac00a193183980fffd4ab Author: Todd L Miller &lt;tlmiller@cs.wisc.edu&gt; Date: Thu Oct 1 09:59:18 2015 -0500\u00a0[...]\n (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Oct-28 12:54", "status": "resolved", "created": "2015-Jun-18 09:48", "fixed_version": "2015-Jun-18 09:48", "broken_version": "", "priority": "2", "subsystem": "Libs", "assigned_to": "tlmiller", "derived_from": "#4988", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}