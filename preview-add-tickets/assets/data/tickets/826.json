{"id": 826, "title": "Ticket #826: Expected job lease duration != measured", "description": "<blockquote>\nThe expected job_lease_duration from reading the manual was 20 minutes yet measured = 30 minutes.\n\n<p>To repro:\n\n</p><p>1.) Start up a couple of sleep jobs\n\n</p><p>2.) condor_off -master\n\n</p><p>3.) wait 30 minutes\n\n</p><p>4.) scan the master, and starter logs timestamps\n\n</p><p>= exactly 30 minutes.\n\n</p><p>nothing is special about condor_config or submission</p></blockquote>", "remarks": "<blockquote>\nupon further investigation the setting the job_lease_duration during submission does not affect the test scenario at all, and it will always wait 30 minutes.\n\n<p>To add to the weirdness, sometimes the startd does not cleanly exit and segfaults.  Traces and logs will be attached.\n\n</p><p></p><hr/>\n<em>2009-Oct-08 15:23:59 by tstclair:</em> <br/>\n\nAlso, you can't restart using condor_master in the attempt to recover.  You will need to send a QUIT (fast) then try again.  Which means that condor will need to rerun those jobs, even though they may have finished.\n\n<p></p><hr/>\n<em>2009-Oct-13 09:39:42 by danb:</em> <br/>\n\nThanks for the careful detective work, Tim!\n\n<p>How about just getting rid of the call to cancelLeaseTimer() from ResState::leave_action()?  The Claim object cancels the timer when the claim is destructed.  It seems overly complicated to me to cancel it from within the startd state machine.\n\n</p><p>Also, this patch appears to touch a completely unrelated file <code>condor_master.V6/masterDaemon.cpp</code>.\n\n</p><p></p><hr/>\n<em>2009-Oct-13 10:24:01 by tstclair:</em> <br/>\n\nI've added a TODO for future evaluation.\n\n<p>I've also verified that the commit only contains the relevant changes, I'm still getting used to a clean workflow with git when I'm working on multiple changes, my apologies about the patch.</p></blockquote>", "derived_tickets": "", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/110/MasterLog\">MasterLog</a>\n4245 bytes added by tstclair on 2009-Oct-08 19:43:49 UTC.\n<br/>\nMaster Log of run<br/>\n</li><li><a href=\"attach_get/111/StartLog\">StartLog</a>\n2303 bytes added by tstclair on 2009-Oct-08 19:44:22 UTC.\n<br/>\nStartd of log with segfault stacktrace.  <br/>\n</li><li><a href=\"attach_get/113/graceful_exit.jpeg\">graceful_exit.jpeg</a>\n33641 bytes added by tstclair on 2009-Oct-09 18:31:26 UTC.\n<br/>\nsequence diagram from debugging and analysing the logs.  <br/>\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-13 10:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=16032\">[16032]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=826\" onclick=\"get_ticket_and_populate_wrapper('826'); return false;\" title=\"Expected job lease duration != measured\">#826</a></span> Expected job lease duration != measured do not cancel lease when vacating.  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-13 10:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=16029\">[16029]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=826\" onclick=\"get_ticket_and_populate_wrapper('826'); return false;\" title=\"Expected job lease duration != measured\">#826</a></span> Expected job lease duration != measured do not cancel lease when vacating.  (By Timothy St. Clair )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-04 09:17", "status": "resolved", "created": "2009-Oct-08 13:32", "fixed_version": "2009-Oct-08 13:32", "broken_version": "v070302", "priority": "3", "subsystem": "Daemons", "assigned_to": "tstclair", "derived_from": "", "creator": "tstclair", "rust": "", "customer_group": "users", "visibility": "public", "notify": "matt@cs.wisc.edu", "due_date": ""}