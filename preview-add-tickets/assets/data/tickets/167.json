{"id": 167, "title": "Ticket #167: GitTrac: Diff fails for new files", "description": "<blockquote>\nSee <span class=\"chng\"><a href=\"chngview?cn=13632\">[13632]</a></span>, observe that the HTML is busted.\n\n<p>Problem: <a href=\"/setup_diff\">/setup_diff</a> claims:\n\n</p><p>\"If you leave the above entry blank, the following command is used:\n  GIT_DIR='%RP' git-diff --full-index -t -p -r '%V1' '%V2' -- '%F' 2&gt;/dev/null\"\n\n</p><p>Lies.\n\n</p><p>If the file is new (or probably deleted), it merrily passes an empty string as V1 (or probably V1 on deletion).  This causes git-diff anguish and it complains, \"fatal: bad revision ''\" and trashes the HTML as a side effect.  So in reality, for new (and probably deleted) files, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> doesn't do anything at all.  But, if you set the entry, it always calls it.\n\n</p><p>Fix:\n\n</p><p>Instead of calling\n\n</p><p></p><pre>  GIT_DIR='%RP' git diff --full-index -t -p -r '%V1' '%V2' -- '%F' | /scratch.2/gittrac/bin/diff2html.py 2&gt;/dev/null\n</pre>\n\n<p>we should call a wrapper script that detects an empty V1 or V2 and instead just spits back something more useful.  Perhaps a simple\n\n</p><p></p><pre>  &lt;p&gt;%F was added&lt;/p&gt;\n</pre>\n\n<p>or\n\n</p><p></p><pre>  &lt;p&gt;%F was deleted&lt;/p&gt;\n</pre>\n\n<p>Of course, if V1 and V2 are both present, call the above command as usual.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "todo", "last_change": "2010-Jan-21 11:03", "status": "new", "created": "2009-Jan-30 10:42", "fixed_version": "2009-Jan-30 10:42", "broken_version": "", "priority": "2", "subsystem": "", "assigned_to": "PitS", "derived_from": "#3", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}