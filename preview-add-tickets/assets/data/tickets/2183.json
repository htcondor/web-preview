{"id": 2183, "title": "Ticket #2183: fetch-work changes advertised ClaimId", "description": "<blockquote>\nThe following situation has been observed in the startd log:\n\n<p></p><div class=\"verbatim\">\n<pre>05/16 06:52:55 State change: Finished fetching work successfully\n05/16 06:52:55 slot4: Changing state: Unclaimed -&gt; Claimed\n05/16 06:52:55 slot4: Warning: starting ClaimLease timer before lease duration set.\n05/16 06:52:55 slot4: Got universe \"VANILLA\" (5) from request classad\n05/16 06:52:55 slot4: Changing activity: Idle -&gt; Busy\n...\n05/16 06:53:04 Received UDP command 440 (MATCH_INFO) from  &lt;10.9.2.120:39783&gt;, access level NEGOTIATOR\n05/16 06:53:04 Calling HandleReq &lt;command_match_info&gt; (0)\n05/16 06:53:04 Error: can't find resource with ClaimId (&lt;10.9.2.120:55421&gt;#1305060839#656#...)\n</pre></div>\n\n\n<p>So first a fetch-work job started on slot4 and then shortly after that, a match to this slot was rejected because it presented the wrong <code>ClaimId</code>.  I have not dug into the code, but I suspect that this happened because fetch-work caused the slot's <code>ClaimId</code> to be changed, thus creating a race condition between fetch-work and the negotiation cycle.\n\n</p><p>This problem was particularly bad because of <span class=\"ticket\"><a class=\"defer\" href=\"tktview?tn=2170\" title=\"assertion fails in dedicated scheduler when claim request is rejected\">#2170</a></span>.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Jan-13 15:20:01 by matt:</em> <br/>\n\nIIRC, this is by design, and maybe not optimal. The fetch-work (pull) and negotiation-cycle (push) work are on the same footing. The push'd work should not trump the pull'd. That's up to the RANK policy. Possibly preemption policy should be taken into account in these situations.\n\n<p></p><hr/>\n<em>2012-Feb-10 14:43:26 by pfc:</em> <br/>\n\nTodd claims that this is only an issue when fetch-work jobs run for less than ~1 minute before exiting.\n\n<p>If that's true, then this is a lower-priority issue (but still an issue).  If that's <em>not</em> true, then this is important.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "incident", "last_change": "2015-Sep-21 11:28", "status": "defer", "created": "2011-May-20 17:10", "fixed_version": "2011-May-20 17:10", "broken_version": "v070600", "priority": "5", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "danb", "rust": "a22161", "customer_group": "ligo", "visibility": "public", "notify": "tstclair@redhat.com, tannenba@cs.wisc.edu,pcouvare@caltech.edu", "due_date": ""}