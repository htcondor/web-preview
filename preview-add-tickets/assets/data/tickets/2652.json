{"id": 2652, "title": "Ticket #2652: procd pegging cpu when running a lot of short lived jobs.", "description": "<blockquote>\nWhen submitting a series of sleep 1 jobs, in recent editions of condor (compiled w/libcgroups on F15) the procd can peg the cpu.\n\n<p>It appears from strace that it's checking the full file list for a proc entry over and over.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Dec-08 09:34:54 by gthain:</em> <br/>\n\nAre you sure this is a regression?  I see the procd take about 20 cpus seconds on my rhel5 machine when running 100 1 seconds jobs, with or without cgroup support compiled in.\n\n<p></p><hr/>\n<em>2011-Dec-08 09:39:53 by tstclair:</em> <br/>\n\nYes it's a regression I do not see this on 7.6 series.\n\n<p></p><hr/>\n<em>2011-Dec-09 10:18:31 by gthain:</em> <br/>\n\nSo, the problem isn't with cgroups, it's with the PSS code.  Can you try running a build with HAVE_PSS undefined?\n\n<p>What's happening is that everytime we snapshot, we parse all the /proc/*/smaps files, which are large.  We read this file for every process because the same pass is then used to discover the parent child relationships.  So, we end up parsing /proc/pid/smaps for every process on the system, which is slow.  Most of the smaps files are in the area of 50kbytes, so it adds up.\n\n</p><p>I don't see an easy way around this, without rejiggering most of procapi.\n\n</p><p></p><hr/>\n<em>2011-Dec-13 15:28:11 by gthain:</em> <br/>\n\nAfter discussion in fw, the decision is to rewrite procapi to make two passes through the entire process table.  This will not be done for 7.7</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2710\" onclick=\"get_ticket_and_populate_wrapper('2710'); return false;\" title=\"Need a way to turn off pss grepping through /proc/pid/smaps\">#2710</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nNeed a way to turn off pss grepping through /proc/pid/smaps</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "", "type": "defect", "last_change": "2011-Dec-13 15:28", "status": "resolved", "created": "2011-Nov-21 15:49", "fixed_version": "2011-Nov-21 15:49", "broken_version": "v070702", "priority": "2", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "#1831", "creator": "tstclair", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com, eje@cs.wisc.edu, gthain@cs.wisc.edu", "due_date": ""}