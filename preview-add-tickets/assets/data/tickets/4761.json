{"id": 4761, "title": "Ticket #4761: Cloned children shouldn't rotate daemon log", "description": "<blockquote>\nThe fixes for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3106\" title=\"Rotation of shared daemon log can result in writing to old file\">#3106</a></span> and <span class=\"ticket\"><a class=\"defer\" href=\"tktview?tn=4753\" title=\"Daemon log rotation broken when using clone()\">#4753</a></span> still leave a race condition where a cloned child process can decide to rotate the daemon log file and mess up the parent's logging data structures. To eliminate the problem, the child should disable log rotation and the parent should re-enable log rotation when it resumes executing.</blockquote>", "remarks": "<blockquote>\n<em>2015-Jan-26 10:17:44 by johnkn:</em> <br/>\n\nCODE_REVIEW: change looks good.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-26 13:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=42382\">[42382]</a></span>: super minor 8.2.7 version history item edits <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4832\" title=\"GCE instances not cleaned up properly\">#4832</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4761\" title=\"Cloned children shouldn't rotate daemon log\">#4761</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-26 11:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=42374\">[42374]</a></span>: Docs for cloned child log rotation bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4761\" title=\"Cloned children shouldn't rotate daemon log\">#4761</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-23 10:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=42343\">[42343]</a></span>: Fix warning about unused function parameter. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4761\" title=\"Cloned children shouldn't rotate daemon log\">#4761</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-22 15:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=42325\">[42325]</a></span>: Remove empty if-block and clean up comments. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4761\" title=\"Cloned children shouldn't rotate daemon log\">#4761</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-09 10:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41858\">[41858]</a></span>: Cloned children shouldn't rotate daemon log. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4761\" title=\"Cloned children shouldn't rotate daemon log\">#4761</a></span> Any opening or closing of log files in a clone child can mess up the parent process. So disable file rotation in the child, and have the parent ensure that rotation is re-enabled when it resumes execution.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Jan-26 11:03", "status": "resolved", "created": "2014-Dec-09 10:34", "fixed_version": "2014-Dec-09 10:34", "broken_version": "v080206", "priority": "3", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "#4753", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}