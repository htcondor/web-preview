{"id": 7051, "title": "Ticket #7051: GSI authentication protocol bug", "description": "<blockquote>\nWe've diagnosed a long-standing bug in the GSI authentication protocol. Condor's CEDAR layer had a workaround dating back 17 years, but it causes problems in some cases (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7024\" onclick=\"get_ticket_and_populate_wrapper('7024'); return false;\" title=\"GSI authentication failure can lead to skipping other auth methods\">#7024</a></span>). On certain authentication failures, the client doesn't send data expected by the server. For most use cases (non-Condor), the client will then close the connection. But Condor CEDAR may want to try other authentication methods on the same connection. In this case, the GSI bug leaves the two sides out of sync. Since this bug only occurs on some types of GSI authentication failures, it's difficult for CEDAR to compensate for the possible out-of-sync problems.\n\n<p>The problem is in gss_init_sec_context() in libglobus_gssapi_gsi. If globus_i_gsi_gss_handshake() returns failure, then globus_i_gsi_gss_get_token() is called to extract any reply for the server (stored in <code>output_token</code>), and then the code jumps to the error_exit label. There, gss_delete_sec_context() is called, which discards the previous reply for the server and makes its own call to globus_i_gsi_gss_get_token(). This second call indicates no additional data to send (again in <code>output_token</code>). The fix is to not pass <code>output_token</code> to gss_delete_sec_context() if it already contains data.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Jul-25 11:19:07 by jfrey:</em> <br/>\n\nA patch was submitted to the gridcf/gct repository on <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitHub\" title=\"Git Hub\">GitHub</a></span> as pull request 82 (<a class=\"external\" href=\"https://github.com/gridcf/gct/pull/82\">https://github.com/gridcf/gct/pull/82</a>) and subsequently merged.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "incident", "last_change": "2020-Apr-13 09:42", "status": "resolved", "created": "2019-May-13 22:10", "fixed_version": "2019-May-13 22:10", "broken_version": "", "priority": "3", "subsystem": "Security", "assigned_to": "jfrey", "derived_from": "#7024", "creator": "jfrey", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}