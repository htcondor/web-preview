{"id": 1877, "title": "Ticket #1877: A job can use DACLs to deny condor the ability to clean up execute dir", "description": "<blockquote>\nIf a job denies delete permission to SYSTEM for a file or folder that it creates in its execute directory, and the path is longer than 255 characters,  condor will not delete that file or folder after the job exits.  Condor should be modified to take ownership of files and folders in the execute directory when it cleans up after the job.\n\n<p>It might be a good idea to write a recursive directory delete program for windows that automatically takes ownership and modifies ACLs as necessary.\n\n</p><p>Alternatively, if there is a windows command line tool to recursively set ACLs that is available in all versions of windows, we could call that before calling \"rd /s/q\".</p></blockquote>", "remarks": "<blockquote>\nThe problem turns out to be a combination of very deep paths (greater than 260 chars) and ACLs in the directories.  The ACLs prevent rd /s/q from working, and the deep paths prevent the directory object from removing the ACLs.\n\n<p>It would be better to fix directory object to handle deep paths rather than using the condor_rmdir.exe to delete the directory.  although condor_rmdir is more efficient at modifying ACLs than the directory object would be because it knows that the goal is deletion.</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"tktview?tn=2969\" title=\"The Directory object can't handle long paths on Windows\">#2969</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nThe Directory object can't handle long paths on Windows</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-12 15:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27164\">[27164]</a></span>: Completed documentation for condor_rmdir. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1877\" title=\"A job can use DACLs to deny condor the ability to clean up execute dir\">#1877</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-12 14:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27163\">[27163]</a></span>: Corrections to condor_rmdir man page. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1877\" title=\"A job can use DACLs to deny condor the ability to clean up execute dir\">#1877</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-09 12:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27149\">[27149]</a></span>: First draft of man page for condor_rmdir ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1877\" title=\"A job can use DACLs to deny condor the ability to clean up execute dir\">#1877</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-05 11:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21267\">[21267]</a></span>: add WINDOWS_RMDIR default param back into condor_config.generic and change the directory object to default the value of WINDOWS_RMDIR_OPTIONS when WINDOWS_RMDIR points to condor_rmdir.exe, part of <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1877\" title=\"A job can use DACLs to deny condor the ability to clean up execute dir\">#1877</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-01 12:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21226\">[21226]</a></span>: start of better fix for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1877\" title=\"A job can use DACLs to deny condor the ability to clean up execute dir\">#1877</a></span>. add code directly into directory object that can recursively delete diretories in windows  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-01 11:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21223\">[21223]</a></span>: start of better fix for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1877\" title=\"A job can use DACLs to deny condor the ability to clean up execute dir\">#1877</a></span>. new windows function that does recursive directory delete with DACL removal, current not used.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Mar-10 12:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21013\">[21013]</a></span>: add example to condor_config.generic for WINDOWS_RMDIR. part of <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1877\" title=\"A job can use DACLs to deny condor the ability to clean up execute dir\">#1877</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Mar-10 11:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21011\">[21011]</a></span>: add WINDOWS_RMDIR param for the directory object so that it can be told to use condor_rmdir instead of the built-in rmdir on windows. patch is part of <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1877\" title=\"A job can use DACLs to deny condor the ability to clean up execute dir\">#1877</a></span>.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Mar-08 17:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=20991\">[20991]</a></span>: Add condor_rmdir a new windows utility program that behaves more like the linux rm -rf tool. This is in support of <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1877\" title=\"A job can use DACLs to deny condor the ability to clean up execute dir\">#1877</a></span>.\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-May-03 12:12", "status": "resolved", "created": "2011-Jan-26 11:48", "fixed_version": "2011-Jan-26 11:48", "broken_version": "v070504", "priority": "3", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "tstclair@redhat.com", "due_date": ""}