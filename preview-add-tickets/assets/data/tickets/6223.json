{"id": 6223, "title": "Ticket #6223: Use a location lookup collector query by default", "description": "<blockquote>\nIn <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5150\" onclick=\"get_ticket_and_populate_wrapper('5150'); return false;\" title=\"Tools should apply reasonable projection for daemon location\">#5150</a></span>, the HTCondor Daemon::locate() method was enhanced so the caller could specify LOCATE_FOR_LOOKUP (with a small projection), or LOCATE_FULL (send back the full classad).  The default locate() method was set to LOCATE_FULL, and just a few surgical locations were specified as LOCATE_FOR_LOOKUP.\n\n<p>Most of the call sites do not specify which type of lookup to perform, and thus resulted in receiving the full classad with no projection. In this ticket, we flip the default for locate() to be LOCATE_FOR_LOOKUP.  To locate call sites that needed changing and to prevent future land-mines, we remove the public method Daemon::daemonAd() which is used to retrieve the full classad after LOCATE_FULL.  Call sites that want to invoke the daemonAd() method must now instantiate a child class <code>DaemonAllowLocateFull</code> instead of using class <code>Daemon</code>.  <code>DaemonAllowLocateFull</code> operates just like <code>Daemon</code>, except it includes a daemonAd() method and the locate() method must be specified. This way, the code is future-proofed in that if someone edits the code to invoke method daemonAd() on a Daemon object, they will end up with a compile-time error.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Apr-12 12:51:18 by tannenba:</em> <br/>\n\nLooks like there are about 82 places in the code where we call Daemon::locate() without specifying what type of lookup to perform.  In other words, by changing the default to LOOKUP_FOR_LOCATE, this patch will convert 82 call sites.\n\n<p>Behold:\n\n</p><p></p><pre>   C:\\home\\tannenba\\CONDOR_SRC\\src&gt;git grep \"locate(\" | grep -v tests | grep -v \"daemon.h\" | grep -v \"daemon.cpp\" | grep -v \"daemon.t.cpp\" | grep -v LOCATE_ | wc -l\n     82\n</pre>\n\n<p>As for the places that are left which actually need a full lookup, see remark 2 by Jaime in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5150\" onclick=\"get_ticket_and_populate_wrapper('5150'); return false;\" title=\"Tools should apply reasonable projection for daemon location\">#5150</a></span>.  All of the places Jaime identified will now have to use the <code>DaemonAllowLocateFull</code> object instead of the <code>Daemon</code> object.\n\n</p><p></p><hr/>\n<em>2017-Jun-20 15:12:50 by tannenba:</em> <br/>\n\nAdded version history, but note that no other documentation is required as this patch, from the user standpoint, just improves performance.  Resolving.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-20 15:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51768\">[51768]</a></span>: Version history entry for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6223\" onclick=\"get_ticket_and_populate_wrapper('6223'); return false;\" title=\"Use a location lookup collector query by default\">#6223</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-12 13:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50458\">[50458]</a></span>: Change default locate() method from LOCATE_FULL to LOCATE_FOR_LOOKUP. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6223\" onclick=\"get_ticket_and_populate_wrapper('6223'); return false;\" title=\"Use a location lookup collector query by default\">#6223</a></span> To locate call sites that needed changing and to prevent future land-mines, we remove the public method Daemon::daemonAd() which is used to retrieve the full classad after LOCATE_FULL. Call sites that want to invoke the daemonAd()\u00a0[...]\n (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Jun-20 15:13", "status": "resolved", "created": "2017-Apr-12 10:59", "fixed_version": "2017-Apr-12 10:59", "broken_version": "", "priority": "3", "subsystem": "Tools", "assigned_to": "tannenba", "derived_from": "#5150", "creator": "tannenba", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "bbockelm@cse.unl.edu diego.davila@cern.ch jfrey@cs.wisc.edu", "due_date": ""}