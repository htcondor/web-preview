{"id": 2282, "title": "Ticket #2282: Automatic TransferOutputRemaps broken when transfer IF_NEEDED -> NO", "description": "<blockquote>\nFailure -\n\n<p></p><div class=\"code\">\n<pre class=\"code\">$ cat &gt; remap_transfer_not_needed.sub\n#NUM_CPUS = 1\n#FILESYSTEM_DOMAIN = A\n#STARTD.FILESYSTEM_DOMAIN = A\n#STARTER.FILESYSTEM_DOMAIN = A\n#STARTER_DEBUG = D_FULLDEBUG\n\ncmd=/bin/echo\nargs=OK\n\nshould_transfer_files=if_needed\nwhen_to_transfer_output=on_exit\n\noutput=out/remap_if_needed_transfer_needed\n\nqueue\n^D\n\n$ mkdir out\n\n$ condor_status -format \"%s\\n\" FileSystemDomain\nA\n\n$ condor_submit remap_transfer_not_needed.sub\nSubmitting job(s).\n1 job(s) submitted to cluster 1300.\n\n$ condor_history 1300 -l | grep -e Out -e Transfer\nOut = \"_condor_stdout\"\nWhenToTransferOutput = \"ON_EXIT\"\nTransferErr = false\nStreamOut = false\nTransferFiles = \"ONEXIT\"\nShouldTransferFiles = \"IF_NEEDED\"\nTransferOutputRemaps = \"_condor_stdout=out/remap_if_needed_transfer_needed\"\nRequirements = ( TARGET.Arch == \"X86_64\" ) &amp;&amp; ( TARGET.OpSys == \"LINUX\" ) &amp;&amp; ( TARGET.Disk &gt;= DiskUsage ) &amp;&amp; ( ( TARGET.Memory * 1024 ) &gt;= ImageSize ) &amp;&amp; ( ( RequestMemory * 1024 ) &gt;= ImageSize ) &amp;&amp; ( ( TARGET.HasFileTransfer ) || ( TARGET.FileSystemDomain == MY.FileSystemDomain ) )\nTransferIn = false\n\n$ ls -al out\ntotal 0\n0 -rw-------. 1 matt matt 0 Jun 30 11:25 remap_if_needed_transfer_needed\n\n$ ls -al _condor_stdout\n4.0K -rw-r--r--. 1 matt matt 3 Jun 30 11:25 _condor_stdout\n</pre></div>\n\n\n<p>Accidental success -\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">$ cat &gt; remap_transfer_needed.sub\n#NUM_CPUS = 1\n#FILESYSTEM_DOMAIN = A\n#STARTD.FILESYSTEM_DOMAIN = B\n#STARTER.FILESYSTEM_DOMAIN = B\n#STARTER_DEBUG = D_FULLDEBUG\n\ncmd=/bin/echo\nargs=OK\n\nshould_transfer_files=if_needed\nwhen_to_transfer_output=on_exit\n\noutput=out/remap_if_needed_transfer_needed\n\nqueue\n^D\n\n$ mkdir out\n\n$ condor_status -format \"%s\\n\" FileSystemDomain\nB\n\n$ condor_submit remap_transfer_needed.sub\nSubmitting job(s).\n1 job(s) submitted to cluster 1301.\n\n$ condor_history 1301 -l | grep -e Out -e Transfer\nOut = \"_condor_stdout\"\nWhenToTransferOutput = \"ON_EXIT\"\nTransferErr = false\nStreamOut = false\nSpooledOutputFiles = \"_condor_stdout\"\nTransferFiles = \"ONEXIT\"\nShouldTransferFiles = \"IF_NEEDED\"\nTransferOutputRemaps = \"_condor_stdout=out/remap_if_needed_transfer_needed\"\nRequirements = ( TARGET.Arch == \"X86_64\" ) &amp;&amp; ( TARGET.OpSys == \"LINUX\" ) &amp;&amp; ( TARGET.Disk &gt;= DiskUsage ) &amp;&amp; ( ( TARGET.Memory * 1024 ) &gt;= ImageSize ) &amp;&amp; ( ( RequestMemory * 1024 ) &gt;= ImageSize ) &amp;&amp; ( ( TARGET.HasFileTransfer ) || ( TARGET.FileSystemDomain == MY.FileSystemDomain ) )\nTransferIn = false\n\n$ ls -al out\ntotal 4.0K\n4.0K -rw-r--r--. 1 matt matt 3 Jun 30 11:32 remap_if_needed_transfer_needed\n\n$ ls -al _condor_stdout\nls: cannot access _condor_stdout: No such file or directory\n</pre></div>\n\n\n<p>From the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StartLog\" title=\"Start Log\">StartLog</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StarterLog\" title=\"Starter Log\">StarterLog</a></span> -\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">$ grep \"Remote job ID\" /var/log/condor/StartLog\n06/30/11 11:25:50 Remote job ID is 1300.0\n06/30/11 11:32:11 Remote job ID is 1301.0\n\n$ grep -e FsDomain -e IF_NEEDED /var/log/condor/StarterLog\n06/30/11 11:25:50 Submit FsDomain: \"A\"\n06/30/11 11:25:50  Local FsDomain: \"A\"\n06/30/11 11:25:50 ShouldTransferFiles is \"IF_NEEDED\" and job's FileSystemDomain matches local value, NOT transfering files\n06/30/11 11:32:11 Submit FsDomain: \"A\"\n06/30/11 11:32:11  Local FsDomain: \"B\"\n06/30/11 11:32:11 ShouldTransferFiles is \"IF_NEEDED\" but job's FileSystemDomain does NOT match local value, transfering files\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Jun-30 10:56:12 by matt:</em> <br/>\n\nNote, it is not sufficient to skip the automatic remaps when IF_NEEDED is specified, because if IF_NEEDED -&gt; YES the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransferObject\" title=\"File Transfer Object\">FileTransferObject</a></span> will not honor the output location (output will go to PWD not the specified \"out/\" directory).\n\n<p>Possibly solutions include teaching the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransferObject\" title=\"File Transfer Object\">FileTransferObject</a></span> about paths and ensuring remaps occur when transfer does not.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-16 14:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27257\">[27257]</a></span>: Revert \"<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2273\" onclick=\"get_ticket_and_populate_wrapper('2273'); return false;\" title=\"provide defaults for should_transfer_files &amp; when_to_transfer_output\">#2273</a></span> uncovered (provide defaults for should_transfer_files &amp; when_to_transfer_output, IF_NEEDED &amp; ON_EXIT) <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=2282\" onclick=\"get_ticket_and_populate_wrapper('2282'); return false;\" title=\"Automatic TransferOutputRemaps broken when transfer IF_NEEDED -&gt; NO\">#2282</a></span> (Automatic <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TransferOutputRemaps\" title=\"Transfer Output Remaps\">TransferOutputRemaps</a></span> broken when transfer IF_NEEDED -&gt; NO), the dagman_splice-L and N tests happened to trip over <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=2282\" onclick=\"get_ticket_and_populate_wrapper('2282'); return false;\" title=\"Automatic TransferOutputRemaps broken when transfer IF_NEEDED -&gt; NO\">#2282</a></span>, this commit papers over the dagman failures by\u00a0[...]\n (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-05 09:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=22361\">[22361]</a></span>: <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2273\" onclick=\"get_ticket_and_populate_wrapper('2273'); return false;\" title=\"provide defaults for should_transfer_files &amp; when_to_transfer_output\">#2273</a></span> uncovered (provide defaults for should_transfer_files &amp; when_to_transfer_output, IF_NEEDED &amp; ON_EXIT) <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=2282\" onclick=\"get_ticket_and_populate_wrapper('2282'); return false;\" title=\"Automatic TransferOutputRemaps broken when transfer IF_NEEDED -&gt; NO\">#2282</a></span> (Automatic <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TransferOutputRemaps\" title=\"Transfer Output Remaps\">TransferOutputRemaps</a></span> broken when transfer IF_NEEDED -&gt; NO), the dagman_splice-L and N tests happened to trip over <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=2282\" onclick=\"get_ticket_and_populate_wrapper('2282'); return false;\" title=\"Automatic TransferOutputRemaps broken when transfer IF_NEEDED -&gt; NO\">#2282</a></span>, this commit papers over the dagman failures by making their\u00a0[...]\n (By Matthew Farrellee )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Aug-01 15:18", "status": "new", "created": "2011-Jun-30 10:42", "fixed_version": "2011-Jun-30 10:42", "broken_version": "v070000", "priority": "2", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "matt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu, tstclair@redhat.com", "due_date": ""}