{"id": 3440, "title": "Ticket #3440: shadow and schedd deadlock", "description": "<blockquote>\nThe schedd and the shadow appear to be deadlocking for extended periods of time, and when this deadlock occurs the schedd can't be contacted.  Deadlocks as long as 30 minutes and numerous 15+ minute deadlocks have been witnessed.  The SPOOL, EVENT_LOG, and job logs all on shared storage.\n\n<p>To reproduce, use the following job:\n\n</p><p></p><pre>  # torture.job\n  universe = local\n  cmd = pain\n  args = $(duration) $(count) $(log_dir)\n  output = pain_$(duration)_$(count).job.out\n  error = pain_$(duration)_$(count).job.err\n  log = pain_$(duration)_$(count).job.log\n  queue\n</pre>\n\n<p></p><pre>  # pain\n  #!/bin/sh\n  DURATION=${1:-15s}\n  COUNT=${2:-100}\n  LOG_DIR=${3:-$PWD}\n  echo $DURATION $COUNT $LOG_DIR\n  while [ true ]; do\n  (\n   echo \"cmd = /bin/sleep\"\n   echo \"transfer_executable = false\"\n   echo \"args = $DURATION\"\n   echo \"log = $LOG_DIR/\\$RANDOM_CHOICE(0,1,2,3,4,5,6,7,8,9)\\$RANDOM_CHOICE(0,1,2,3,4,5,6,7,8,9)\\$RANDOM_CHOICE(0,1,2,3,4,5,6,7,8,9).log\"\n   echo \"request_memory = 10\"\n   echo \"notification = error\"\n   echo \"requirements = TARGET.Arch=!=UNDEFINED\"\n   echo \"queue $COUNT\"\n  ) | time condor_submit -name perf56.perf.lab.eng.bos.redhat.com\n  sleep $DURATION\n  done\n</pre>\n\n<p>Submit the job multiple times.  This has been reliably seen on a system with 2400 slots with 7 or 8 torture.job jobs running at the same time.  Userlog locking is enabled with lock files created on local disk.</p></blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2013-Mar-28 17:16:00 by johnkn:</em> <br/>\n\nBulk change of target version from v070808 to v070809 using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "defect", "last_change": "2013-Mar-28 17:16", "status": "new", "created": "2013-Jan-14 13:22", "fixed_version": "2013-Jan-14 13:22", "broken_version": "v070806", "priority": "2", "subsystem": "Daemons", "assigned_to": "", "derived_from": "", "creator": "rrati", "rust": "", "customer_group": "other", "visibility": "public", "notify": "rrati@redhat.com, tstclair@redhat.com", "due_date": ""}