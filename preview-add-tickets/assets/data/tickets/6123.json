{"id": 6123, "title": "Ticket #6123: add collector stats to show query and fork time", "description": "<blockquote>\nIn order to scale the collector even further, we need to know where it is spending its time during queries, how much time we spend forking, and how much time we spend handling an existing query inline because we ran out of fork workers.\n\n<p>We will do this by adding 6 new Miron probes, and 2 additional new attributes:\n\n</p><p></p><ul>\n<li><code>HandleQuery</code> Miron probe for time spent handling query commands where Fork was not attempted.\n</li><li><code>HandleLocate</code> Miron probe for time spent handling locate query commands where Fork was not attempted.\n</li><li><code>HandleQueryForked</code> Miron probe for time spent forking to handle query commands\n</li><li><code>HandleLocateForked</code> Miron probe for time spent forking to handle locate query commands\n</li><li><code>HandleQueryMissedFork</code> Miron probe for time spent handling queries the the main Collector because we could not fork\n</li><li><code>HandleLocateMissedFork</code> Miron probe for time spent handling locate queries in the main Collector because we could not fork\n</li><li><code>PeakForkWorkers</code> The largest number of active fork workers in the lifetime of the collector\n</li><li><code>CurrentForkWorkers</code> The number of active fork workers.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Feb-28 10:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50217\">[50217]</a></span>: Documentation for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6123\" title=\"add collector stats to show query and fork time\">#6123</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Feb-28 09:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50214\">[50214]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6105\" title=\"Make use of classad cache be more explicit and cheaper\">#6105</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6030\" title=\"DEFAULT_JOB_MAX_RETRIES is not in param table\">#6030</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6123\" title=\"add collector stats to show query and fork time\">#6123</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Feb-08 11:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50121\">[50121]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6123\" title=\"add collector stats to show query and fork time\">#6123</a></span>, add stats for collector query and local runtime, also status for fork time, current forks and peak forks ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Feb-28 20:15", "status": "resolved", "created": "2017-Feb-02 14:03", "fixed_version": "2017-Feb-02 14:03", "broken_version": "", "priority": "4", "subsystem": "DaemonsCM", "assigned_to": "johnkn", "derived_from": "#6093", "creator": "johnkn", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}