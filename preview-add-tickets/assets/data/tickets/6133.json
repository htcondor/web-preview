{"id": 6133, "title": "Ticket #6133: Improve syntax of remote_cerequirements", "description": "<blockquote>\n<code>remote_cerequirements</code> is used in the OSG by sysadmins of non-condor backends to control job attributes that aren't in the list of first class attributes like <code>mem</code>, <code>cpu</code>, <code>disk</code>, <code>queue</code>. For example, our current <code>JOB_ROUTER_DEFAULTS</code> has the following expression:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">eval_set_remote_cerequirements = strcat(ifThenElse(default_remote_cerequirements isnt undefined, strcat(string(default_remote_cerequirements), \" &amp;&amp; \"), \"\"), \\\\\n      ifThenElse(maxWallTime isnt undefined, strcat(\"Walltime == \", string(60*maxWallTime), \" &amp;&amp; CondorCE == 1\"), \\\\\n          ifThenElse(default_maxWallTime isnt undefined, strcat(\"Walltime == \", string(60*default_maxWallTime), \" &amp;&amp; CondorCE == 1\"), \\\\\n            \"CondorCE == 1\")))\n</pre></div>\n\n\n<p>And the blahp uses the evaluated definition of <code>Walltime</code> as the value for the <code>$Walltime</code> variable for a shell script, whose output is included in the JDL that the blahp produces:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">if [ -n \"$Walltime\" ]; then\n  echo \"#PBS -l walltime=$Walltime\"\n#else\n#  echo \"#PBS -l walltime=24:00:00\"\nfi\n</pre></div>\n\n\n<p>You can see above that the <code>remote_cerequirements</code> expression above is painful with just two variables. Adding more variables to the expression quickly becomes unmanageable.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Feb-08 11:21:14 by blin:</em> <br/>\n\nThis is more relevant today because of ANL's interest in HTCondor-CE and the customizations that they will require.\n\n<p></p><hr/>\n<em>2017-Feb-08 16:28:46 by jfrey:</em> <br/>\n\nInstead of the goofy <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> expression in CERequirements, we'd like a simple list of name,value pairs that get passed to the blahp batch submit script. We'd probably use a new attribute name in the job ad for this list.\n\n<p>There are a few ideas for how this attribute's value would be formatted:\n</p><ol>\n<li>String containing name/value pairs, formatted similarly to the Environment attribute\n</li><li>A nested <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> whose attributes and evaluated values are the name/value pairs\n</li><li>A list of attribute names, identifying job ad attributes whose names and evaluated values should be used.\n</li></ol>\n\n<p>During the OSG-FW 2/8/17 call, it should be noted that the Brians were in favor of option 3.\n\n</p><p></p><hr/>\n<em>2017-Sep-08 12:00:21 by jfrey:</em> <br/>\n\nTicket <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=5047\" onclick=\"get_ticket_and_populate_wrapper('5047'); return false;\" title=\"Improve CE requirements for blahp\">#5047</a></span> (now abandoned)  proposes option 2 in preceding list of formats for a new attribute.\n\n<p></p><hr/>\n<em>2017-Oct-04 16:13:15 by jfrey:</em> <br/>\n\nI've committed code that supports both option 2 (nested ad with name/value pairs) and option 3 (string list of names to be looked up in job ad). Along with the changes in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6422\" onclick=\"get_ticket_and_populate_wrapper('6422'); return false;\" title=\"Simplify setting of blahp-specific job attributes\">#6422</a></span>, the example in this ticket can be replaced with one of the following sets of Job Router rules:\n\n<p>String form:\n</p><div class=\"code\">\n<pre class=\"code\">set_CondorCE = 1\nset_WallTime = maxWalltime\nset_CERequirements = \"Walltime,CondorCE\"\n</pre></div>\n\n\n<p>Nested <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> form:\n</p><div class=\"code\">\n<pre class=\"code\">set_CERequirements = [ CondorCE = 1; Walltime = maxWalltime ]\n</pre></div>\n\n\n<p>Note: I'm exploiting that in the blahp, if a value in CERequirements isn't a string or integer, it's left out of the local_submit_attributes.sh file.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Oct-31 13:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52737\">[52737]</a></span>: Fix typo in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6133\" onclick=\"get_ticket_and_populate_wrapper('6133'); return false;\" title=\"Improve syntax of remote_cerequirements\">#6133</a></span> version history  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Oct-28 23:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52706\">[52706]</a></span>: Add version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6405\" onclick=\"get_ticket_and_populate_wrapper('6405'); return false;\" title=\"Report grid-type boinc jobs that are IN_PROGRESS as running\">#6405</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6133\" onclick=\"get_ticket_and_populate_wrapper('6133'); return false;\" title=\"Improve syntax of remote_cerequirements\">#6133</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6413\" onclick=\"get_ticket_and_populate_wrapper('6413'); return false;\" title=\"Make HAD replication work with shared port and IPv6\">#6413</a></span>  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Oct-04 15:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52484\">[52484]</a></span>: Allow CERequirements to be specified in a simpler way. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6133\" onclick=\"get_ticket_and_populate_wrapper('6133'); return false;\" title=\"Improve syntax of remote_cerequirements\">#6133</a></span> The gridmanager now understands two simpler ways to specify name/value pairs in the CERequirements job attribute used by the blahp. The gridmanager will translate these forms into the goofy <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> expression that the blahp expects.\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Nov-01 13:57", "status": "resolved", "created": "2017-Feb-08 11:16", "fixed_version": "2017-Feb-08 11:16", "broken_version": "", "priority": "3", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "#4555", "creator": "blin", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "blin@cs.wisc.edu", "due_date": ""}