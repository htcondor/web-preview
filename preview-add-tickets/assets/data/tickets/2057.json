{"id": 2057, "title": "Ticket #2057: Always run POST script, even if PRE script fails", "description": "<blockquote>\nTo be more consistent, we should probably <strong>always</strong> run a POST script for a node if a POST script exists -- a motivating scenario is a PRE script that untars and/or creates a bunch of input files, and the POST script cleans up afterwards.  Right now we do not run the POST script if the PRE script fails.  We <strong>do</strong> run the POST script if the node job fails.\n\n<p>There should also be a config setting to get the old behavior, in case the new behavior would break some people's DAGs.\n\n</p><p><em>2011-Sep-5 by nwp:</em> <br/>\n\nWith respect to <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2122\" title=\"Allow PRE script to skip node job\">#2122</a></span>, we do not run the POST script if the PRE script returns\nthe <code>PRE_SKIP</code> value.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Apr-12 12:28:35 by matt:</em> <br/>\n\nNote: Failure of PRE (non-zero return) followed by success of POST (zero return) would properly result in the job being skipped.\n\n<p></p><hr/>\n<em>2011-May-18 09:23:11 by nwp:</em> <br/>\n\nDoes this include the case from <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2122\" title=\"Allow PRE script to skip node job\">#2122</a></span>?\n\n<p></p><hr/>\n<em>2011-May-18 11:54:18 by matt:</em> <br/>\n\nI believe it does, in Logan's case his PRE script would simply fail, meaning the job is not run. The POST script would then check for the output and succeed (skip) or fail the node. The solution here does not require extending the DAGMan language.\n\n<p></p><hr/>\n<em>2011-May-26 21:07:43 by nwp:</em> <br/>\n\nThe patch attached to this ticket now implements a config option to restore the current behavior of skipping the POST script if the PRE script fails.\n\n<p></p><hr/>\n<em>2011-Jun-06 06:29:29 by nwp:</em> <br/>\n\nNew attachment 2057-patch-2 should be used, as there is a conflict with <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1755\" title=\"Have a -strict flag that turns some warnings into fatal errors\">#1755</a></span> in the former patch.\n\n<p></p><hr/>\n<em>2011-Jun-14 22:13:38 by nwp:</em> <br/>\n\nPushed my development branch to the central repository, at branch <code>V7_7-always_run_post_script_even_if_pre_script_fails-branch</code>.\n\n<p></p><hr/>\n<em>2011-Jul-14 17:29:07 by wenger:</em> <br/>\n\nI haven't looked at everything yet, but here are comments on what I've reviewed so far:\n\n<p>Retries should not short-circuit the POST script!  (In Dag::PreScriptReaper()\nthe check for whether to run the POST script if the PRE script failed\nhas to come before the check for node retries.)\n\n</p><p>When running the POST script, I don't think that job-&gt;_scriptPost-&gt;_retValJob\nshould be set to DAG_ERROR_CONDOR_SUBMIT_FAILED (that means that\nthe condor_submit command itself failed).  I think that\njob-&gt;_scriptPost-&gt;_retValJob should be set to the return value of the\nPRE script.\n\n</p><p>The A test should delete the dagman.out file at the beginning.\n\n</p><p>The B test should check to make sure POST script was not run (in the\nfailure subroutine).\n\n</p><p>There should probably be a test that combines this functionality with\nnode retries.\n\n</p><p>I don't like the name 'NoPostRun' for the command-line argument -- it makes\nit sound like the post script will never be run.  How about 'PostIgnorePre'?\n\n</p><p>Dag::ProcessJobProcEnd(), Dag::ProcessFailedSubmit() and\nDag::PreScriptReaper() have pretty much duplicated code for running the\nPOST script -- this could be broken out into a little method to avoid\nduplication.\n\n</p><p>This is a pretty important change, so it needs to be well documented.  I\ncan think of at least four places that need changes:\n\n</p><p></p><pre>  * The version history.\n  * The configuration section.\n  * The condor_dagman and condor_submit_dag man pages.\n  * The main DAGMan manual section.\n</pre>\n\n<p></p><hr/>\n<em>2011-Jul-14 17:42:23 by wenger:</em> <br/>\n\nOkay, I've finished checking -- no more comments...\n\n<p></p><hr/>\n<em>2011-Aug-01 20:48:23 by nwp:</em> <br/>\n\nThis is probably not going to get into 7.7.1, as Kent will not be around this week to review it.  Thus I am marking it for 7.7.2.\n\n<p></p><hr/>\n<em>2011-Aug-08 16:40:17 by nwp:</em> <br/>\n\nDocumentation completed, and tests run successfully for me. Pushed onto <code>V7_7-always_run_post_script_even_if_pre_script_fails-branch</code>.\n\n<p></p><hr/>\n<em>2011-Aug-09 08:18:56 by nwp:</em> <br/>\n\nThis last commit breaks job_dagman_pre_skip-C, for obvious reasons.\n\n<p></p><hr/>\n<em>2011-Aug-10 15:21:26 by nwp:</em> <br/>\n\nI am sending this to Kent for review.  This commit <strong>fails</strong> the NMI tests <code>job_dagman_jobstate_log</code> and on <code>job_dagman_noop_node</code> tests, but I cannot decide whether the test is broken or if my code is broken.  Hopefully, Kent will be able to point me in the right direction. Pushed onto <code>V7_7-always_run_post_script_even_if_pre_script_fails-branch</code>.\n\n<p></p><hr/>\n<em>2011-Aug-11 16:36:50 by wenger:</em> <br/>\n\nWell, something is definitely wrong in DAGMan.  If you look at job_dagman_jobstate_log.dag.dagman.out, you can see the following:\n\n<p></p><pre>  ...\n  08/11/11 16:34:23 ...done with RECOVERY mode &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;\n  08/11/11 16:34:23 Of 5 nodes total:\n  08/11/11 16:34:23  Done     Pre   Queued    Post   Ready   Un-Ready   Failed\n  08/11/11 16:34:23   ===     ===      ===     ===     ===        ===      ===\n  08/11/11 16:34:23     3       0        0      -4       0          5        1\n</pre>\n\n<p>That -4 for the number of nodes in the Post state is a problem...  I haven't tracked down the details yet.\n\n</p><p></p><hr/>\n<em>2011-Aug-12 11:15:10 by nwp:</em> <br/>\n\nLatest commit fixes the POST field having negative numbers, but getting negatives in \"Un-Ready\" state.\n\n<p></p><hr/>\n<em>2011-Aug-15 06:26:48 by nwp:</em> <br/>\n\nAll tests now pass---sorry about the delay. Pushed onto <code>V7_7-always_run_post_script_even_if_pre_script_fails-branch</code>.\n\n<p></p><hr/>\n<em>2011-Aug-15 16:13:58 by tannenba:</em> <br/>\n\nWow, a lot of commits for one relatively small conceptual change...  are the guidelines in <span class=\"wiki\"><a href=\"wiki?p=GitPushChecklist\" title=\"Git Push Checklist\">GitPushChecklist</a></span> being followed, esp the part that talks about <em>Check to see if you should combine multiple commits</em> before pushing?\n\n<p></p><hr/>\n<em>2011-Aug-18 16:09:21 by wenger:</em> <br/>\n\njob_dagman_always_run_post-A and job_dagman_always_run_post-E fail for me; haven't dug into the cause yet.\n\n<p></p><hr/>\n<em>2011-Aug-19 16:16:57 by wenger:</em> <br/>\n\nOkay, I was seeing the test failures because I had _CONDOR_DAGMAN_POST_IGNORE_PRE set to 0 in my environment(!).  When I unset that, the tests succeed.\n\n<p>However, it looks like when _CONDOR_DAGMAN_POST_IGNORE_PRE is set to 0 and the tests fail, the PRE script failure in job_dagman_always_run_post-E is short-circuiting the node retries.  (I'm in the process of making a test to check this out.)\n\n</p><p></p><hr/>\n<em>2011-Aug-31 15:42:49 by wenger:</em> <br/>\n\nJust talked with Nathan about this.  Given this feature, we think it doesn't make much sense for PRE_SKIP to run the POST script -- so I'm going to change that, and also do some hacking to try to clean up Dag::PreScriptReaper(), which has become pretty messy.\n\n<p></p><hr/>\n<em>2011-Sep-01 14:07:44 by wenger:</em> <br/>\n\nJust found a new bug in this branch: If you have a node with a POST script, and DAGMan is then held while the POST script is running, when DAGMan is released and goes into recovery mode, it doesn't correctly deal with things and thinks the DAG is finished even though the node is not complete!  I tested things with the 7.7.2 master, and that works okay, so it's definitely something in this branch.\n\n<p></p><hr/>\n<em>2011-Sep-01 22:29:35 by wenger:</em> <br/>\n\nYeah, I should have squashed today's commits before pushing.  But I was having trouble getting the squashing to work, and it's 10pm, and I didn't want to mess things up, so I pushed w/o squashing...\n\n<p></p><hr/>\n<em>2011-Sep-06 by nwp:</em> <br/>\n\nMerged to master at <code>f46645a</code>.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2402\" title=\"Improve the DAGMan node retry test\">#2402</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nImprove the DAGMan node retry test</td></tr>\n</tbody></table>", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/360/2057-test.tgz\">2057-test.tgz</a>\n465 bytes added by nwp on 2011-May-27 02:06:05 UTC.\n<br/>\nTest case for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span><br/>\n</li><li><a href=\"attach_get/361/2057-patch\">2057-patch</a>\n6194 bytes added by nwp on 2011-May-27 02:41:39 UTC.\n<br/>\nThis version implements a config file option for the new behavior in <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span><br/>\n</li><li><a href=\"attach_get/369/2057-patch-2\">2057-patch-2</a>\n6230 bytes added by nwp on 2011-Jun-06 11:30:21 UTC.\n<br/>\nUnconditionally run POST script<br/>\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-09 22:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=31997\">[31997]</a></span>: Fix a couple typos in documentation This is for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> From Kent: -AlwaysRunPost should be -DontAlwaysRunPost in the version history item about the new default for running the POST script if the PRE script fails.\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-09 16:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=31990\">[31990]</a></span>: Fix a couple typos in documentation This is for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> From Kent: -AlwaysRunPost should be -DontAlwaysRunPost in the version history item about the new default for running the POST script if the PRE script fails.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-07 13:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27115\">[27115]</a></span>: Fix ambiguous documentation for DAGman ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Also, I noticed that some code got overwritten in a merge, which made the code wrong.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-07 13:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27114\">[27114]</a></span>: editing changes for documentation of <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-06 16:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27105\">[27105]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=26888\">[26888]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26890\">[26890]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26898\">[26898]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=27046\">[27046]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=27069\">[27069]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=27070\">[27070]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=27071\">[27071]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=27072\">[27072]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=27073\">[27073]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=27074\">[27074]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=27075\">[27075]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=27076\">[27076]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=27095\">[27095]</a></span>, Merge branch 'V7_7-always_run_post_script_even_if_pre_script_fails-branch'\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-03 08:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27095\">[27095]</a></span>: Insert PRE_SCRIPT_RETURN as a SCRIPT variable ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> The _retValScript was already a member of the Script class, but was not being used. So I appropriated it to use as the return value from the PRE script. This can be passed to the POST script by making reference to PRE_SCRIPT_RETURN in the DAGman\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-01 21:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27075\">[27075]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>: cleaned up a bunch of the comments with to-dos.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-01 21:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27074\">[27074]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>: \"good\" fix to the recovery/POSTRUN problem.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-01 20:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27073\">[27073]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>: kludgily fixed problem with recovery mode failing if a job is in the POSTRUN state (need to fix it better, probably by incrementing _postRunNodeCount in the same places the \"old\" (pre pre-skip/always run post) code does.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-01 17:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27072\">[27072]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>: got rid of Job::GetPreStatus() and Job::SetPreStatus() because they're no longer used.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-01 16:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27071\">[27071]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>: major refactoring of Dag::PreScriptReaper; also changed the -AlwaysRunPost to -DontAlwaysRunPost to match the way it actually works (including changing the manual); added jobstate.log files to some of the related tests (the test scripts don't actually check them yet).  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-01 15:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27070\">[27070]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> (also kind of <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2122\" title=\"Allow PRE script to skip node job\">#2122</a></span>): changed PRE_SKIP to skip the POST script, if any, since with the new \"always run the POST script\" feature there isn't much point to PRE_SKIP otherwise; changed job_dagman_pre_skip-B to make sure the POST script really <strong>is</strong> skipped.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-01 14:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27069\">[27069]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>: cleaned things up a bit by taking more advantage of the fact that Dag::RunPostScript() monitors the log file (note that the recovery mode change needs testing, but recovery mode is already failing if a node is in POSTRUN).  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-31 21:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27049\">[27049]</a></span>: Changes from code review of gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>, part 3 Nathan, * It looks like if the PRE script fails but the POST script is run, the POST script will get 0 for the $RETURN value. That doesn't seem like a good idea to me. I'm thinking that maybe we should set it to something like const int Dag::DAG_ERROR_JOB_SKIPPED\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-30 14:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27032\">[27032]</a></span>: Remove these tests from master The always-run-post-script code in <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> has not been merged yet. This was changed in work for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2165\" title=\"Rescue DAGs should not be a complete DAG file?\">#2165</a></span> also.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-30 13:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27027\">[27027]</a></span>: Cherry-picking bdb12c225d7f49fdcf1cd4396861cf630e8e76fc over to the trunk so I can fix the problem -- the tests were changed on the V7_7-always_run_post_script_even_if_pre_script_fails-branch, but the changes that break job_dagman_pre_skip-C are on the trunk.\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-27 08:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27046\">[27046]</a></span>: Changes based on Kent's comments For <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> A few notes here: * In the version history entry, it would be nice to make a link to the appropriate configuration entry.\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-19 22:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26890\">[26890]</a></span>: This fixes the retry bug ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> This fixes a bug wherein if DAGMAN_POST_IGNORE_PRE were false, we would short-circuit retries and fail the node prematurely.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-19 16:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26885\">[26885]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> code review/cleanup: improved messages from test A and test E when they fail.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-15 09:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26763\">[26763]</a></span>: Revert the incorrect documentation in commit 4464783 This is for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-15 06:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26762\">[26762]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=26669\">[26669]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26673\">[26673]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26674\">[26674]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26702\">[26702]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26703\">[26703]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26704\">[26704]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26705\">[26705]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26717\">[26717]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26718\">[26718]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26719\">[26719]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26745\">[26745]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26746\">[26746]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26759\">[26759]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26760\">[26760]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26761\">[26761]</a></span>, Merge branch 'V7_7-always_run_post_script_even_if_pre_script_fails-branch' Update version history for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Conflicts: doc/version-history/7-7.history.tex  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-15 06:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26761\">[26761]</a></span>: Document in table that POST script can determine success of node ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-15 06:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26760\">[26760]</a></span>: Fix tests so that they are actually testing for correct semantics ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Had the wrong semantics here; the POST script, if there is one, determines the success of a node.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-15 05:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26759\">[26759]</a></span>: Fix RETRY and jobstate ===GT===#2057 Had the wrong semantics, where all parts of node would have to succeed for the node to succeed. Also need to set retval before writing the jobstate log.\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-12 13:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26746\">[26746]</a></span>: job_dagman_jobstate_log test succeeds after this commit ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-12 10:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26745\">[26745]</a></span>: Solves the bug of having negative numbers of nodes in POST state ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-10 15:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26719\">[26719]</a></span>: Condor submit files should point to better named files ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> For errors and output, prefix the name with 'job_dagman_always_run_post-'  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-10 15:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26718\">[26718]</a></span>: Remove job_dagman_pre_skip-C and rename job_dagman_pre_skip-D ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> The test in job_dagman_pre_skip-C is no longer valid, as we will be running the POST script regardless of the return status of the PRE script node.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-10 15:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26717\">[26717]</a></span>: Make sure we account for POST scripts running ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-10 09:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26705\">[26705]</a></span>: Make sure <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserLog\" title=\"User Log\">UserLog</a></span> is set up before we run POST script ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Causes segfaults in job_dagman_always_run_post-A (at least!) if this is not done.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-09 22:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26704\">[26704]</a></span>: Really make retries work properly ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Now retries must wait until after the POST script completes to run.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-09 22:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26703\">[26703]</a></span>: Add encapsulated <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=PreStatus\" title=\"Pre Status\">PreStatus</a></span> methods to Job class ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Methods to set and check the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=PreStatus\" title=\"Pre Status\">PreStatus</a></span> of a Node  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-09 22:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26702\">[26702]</a></span>: Explain that the POST script will always run ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Even though the POST script runs, the node fails if the PRE script fails.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-08 20:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26674\">[26674]</a></span>: Add tests to CMakeLists.txt ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-08 20:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26673\">[26673]</a></span>: Check that assigning to _pre_status makes sense ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-08 16:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26669\">[26669]</a></span>: Add test job_dagman_always_run_post-E ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> We want to make sure that always running POST does not mess up RETRY  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-08 16:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26668\">[26668]</a></span>: Create test job_dagman_always_run_post-D ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Test running the POST script in the presence of a PRE_SKIP directive.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-08 16:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26667\">[26667]</a></span>: Add test job_dagman_always_run_post-C ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Tests the configuration file directive DAGMAN_POST_IGNORE_PRE  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-08 16:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26666\">[26666]</a></span>: Clean up test job_dagman_always_run_post-B ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-08 16:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26665\">[26665]</a></span>: Fix test job_dagman_always_run_post-A ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-08 16:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26664\">[26664]</a></span>: Fix LaTeX formatting error ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-08 16:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26663\">[26663]</a></span>: Use _pre_status and fix RETRY for DAGman ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Make sure PRE_SKIP and our new POST code works. Also, make sure RETRY does not fall over.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-08 16:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26662\">[26662]</a></span>: Add _pre_status and its initializer to Job class ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-02 15:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26584\">[26584]</a></span>: Remove .dagman.out file for job_dagman_always_run_post-A test ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-02 15:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26583\">[26583]</a></span>: Add documentation for new feature of ignoreing PRE SCRIPT return value ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-02 14:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26582\">[26582]</a></span>: Do not short circuit running the POST script in a retry ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Indicated by Kent's review  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-01 22:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26581\">[26581]</a></span>: Previous commit does not compile ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-01 21:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26578\">[26578]</a></span>: Comment out version history unlikely to get into 7.7.1 ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-01 21:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26577\">[26577]</a></span>: Factor out a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RunPostScript\" title=\"Run Post Script\">RunPostScript</a></span> method for Dag ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-01 13:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26576\">[26576]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=26154\">[26154]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26574\">[26574]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26575\">[26575]</a></span>, This merge is basically to clean up conflicts as I work on <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Conflicts: src/condor_tests/CMakeLists.txt  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-01 12:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26575\">[26575]</a></span>: Fix version history comment ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-01 12:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26574\">[26574]</a></span>: Use -PostIgnorePre instead of -NoPostRun Kent suggested the name change in his review. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> ===VersionHistory=== The default behavior of condor_dagman has changed. The default behavior previously was that when a PRE script fails, the node job and the POST script are not executed. Now the behavior\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-30 22:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26154\">[26154]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=25828\">[25828]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=25853\">[25853]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=25854\">[25854]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=25855\">[25855]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=25856\">[25856]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=25900\">[25900]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=25901\">[25901]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=25912\">[25912]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=25913\">[25913]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=25914\">[25914]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=25915\">[25915]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=25916\">[25916]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26080\">[26080]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26081\">[26081]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26082\">[26082]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26083\">[26083]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26084\">[26084]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26085\">[26085]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26086\">[26086]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26087\">[26087]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26088\">[26088]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26089\">[26089]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26090\">[26090]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26091\">[26091]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26092\">[26092]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26093\">[26093]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26094\">[26094]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26095\">[26095]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26096\">[26096]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26097\">[26097]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26098\">[26098]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26099\">[26099]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=26100\">[26100]</a></span>,\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-16 14:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26126\">[26126]</a></span>: Revert \"Documented new PRE/POST behavior in the Version History\" This reverts commit 3381c7a45edb032eafa8b4bd2b4bce00af723f61. This behavior probably will not make it into 7.7.0; revert it now and put it in the corresponding place for 7.7.1 <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-16 08:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=22207\">[22207]</a></span>: Add tests to CMakeLists.txt ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Forgot to insert the tests into CMakeLists  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-14 22:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26121\">[26121]</a></span>: Documented new PRE/POST behavior in the Version History <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-14 22:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=22183\">[22183]</a></span>: Add test cases for always running POST ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Test A here is supposed to succeed: the PRE Script fails, so the node job is not run; but the POST script runs anyway.\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-14 12:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=22182\">[22182]</a></span>: Add configuration knob for turning off new POST behavior ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> ===VersionHistory=== Add DAGMAN_POST_IGNORE_PRE, which defaults to true. If false, then DAGman will revert to the old behavior, where a POST script does not run if the PRE script fails.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-14 12:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=22179\">[22179]</a></span>: Run POST script regardless of PRE status ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> Add a boolean flag and methods to access it. When running the dag, run the POST scripts unconditionally. Boolean flag that controls this behavior defaults to true (so default is to ignore PRE status value).  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-14 12:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=22180\">[22180]</a></span>: Add a -NoPostRun flag to condor_dagman ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> This flag changes the default behavior so that the POST script is <em>not</em> run if the PRE script fails.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-14 12:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=22181\">[22181]</a></span>: Add -no_postrun to condor_submit_dag ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2057\" title=\"Always run POST script, even if PRE script fails\">#2057</a></span> If user specifies -no_postrun on the command line, the POST script will not run if the PRE skip fails in the child condor_dagman execution.  (By Nathan W. Panike )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Sep-06 16:16", "status": "resolved", "created": "2011-Apr-12 12:11", "fixed_version": "2011-Apr-12 12:11", "broken_version": "v070600", "priority": "2", "subsystem": "Dag", "assigned_to": "nwp", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, matt@cs.wisc.edu, tstclair@redhat.com", "due_date": "20110826"}