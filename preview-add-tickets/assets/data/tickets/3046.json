{"id": 3046, "title": "Ticket #3046: create a condor_who tool.", "description": "<blockquote>\nadd condor_who as a new tool for use by glide-in hosts to find out what users and jobs are making use of the local machine.\n\n<p>It is intended to run on an execute node and provide information on jobs\nrunning on that node.  Ideally, condor_who would be able to return useful output even when the node that it is querying is running an earlier version of Condor.\nTo facilitate this, the initial version of condor_who should be developed without any changes to code outside of the tool itself.  It should be able to gather useful information from address files in the LOG directory and by scraping the log files themselves.\nIt should also be able to directly interrogate STARTDs to get information from the Machine Ad, and then merge that with information from system calls and log files to produce a picture of running jobs.\n\n</p><p>The output might look something like this\n\n</p><p></p><div class=\"verbatim\">\n<pre>OWNER   SUBMIT-HOST          SLOT PID   RUNTIME  MEMORY  COMMAND\njohnkn  submit1.chtc.wisc.edu   1 2345  2:00:00   20 Mb  sleep 30\n</pre></div>\n\n\n<p>condor_who needs to know the command port of each STARTD or STARTER that it wants to talk to, in order to make this tool useful to administrators in glide-in scenarios, condor_who will accept a variety of command line arguments that tell it were to look for STARTD/STARTER addresses.\n\n</p><p></p><ul>\n<li><code>-pid &lt;pid&gt;</code> find the condor daemon that owns this PID\n</li><li><code>-addr &lt;addr:port&gt;</code> use the given addr:port to talk to the STARTD or STARTER\n</li><li><code>-logdir &lt;dir&gt;</code> look in address files in the given directory to find STARTD or STARTER\n</li></ul>\n\n<p>Idea:\n</p><ul>\nIn order for -pid option to be possible without a great deal of disk scanning, daemon core will be modified so that when an ephemeral port is used for the command port, the value of the port will be passed on the command line as an argument intended to be used by viewers of ps.  <code>--ephemeral_port=NNN</code>\n</ul>\n\n<p>Idea:\n</p><ul>\nIf condor_who is running as root, it can correlate the output of <code>lsof</code> and <code>ps</code> to locate condor daemons and their listen ports, then query for machine and job ads.\n</ul>\n\n<p>In phase 2, the MASTER, STARTD and STARTER can be ehanced to have new query commands for condor_who to use.\n\n</p><p></p><ul>\n<li>The MASTER should be enhanced to return a list of daemons that is managing and which ones are currently running.  For glide-ins It should also return an indication of who created the master, we can possible use DC_CONFIG_VAL for this.\n\n<p></p></li><li>The STARTD and/or STARTER should be enhanced to provide more information about running jobs.  In particular they should provide information from the ProcD about the job&amp;#65533;s process family tree and resource usage.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Aug-06 14:01:13 by bbockelm:</em> <br/>\n\nI just took this for a whirl on my site, and gave TJ the following feedback via #distcomp.  Recorded here for posterity (and, TJ would note that this is mostly repeating things already planned):\n<ul>\n<li>The output should truncate at screen width by default.  gWMS has 2k command lines for its arguments.\n</li><li>Our local site has two starters writing to the same address file, and it picked up the \"wrong one\" by default.  Would be nice to have a better way of handling this (talking to the master?)\n</li><li>-logdir should default to the LOG config parameter.\n</li><li>SlotID is useless in the face of d-slots.\n</li><li>Default output should include the name of the remote schedd.</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Oct-17 11:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33687\">[33687]</a></span>: align text left in condor_who output <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-20 12:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33118\">[33118]</a></span>: completion of the condor_who man page ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-17 13:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33111\">[33111]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>) several minor corrections to useage output of condor_who ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-17 13:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33110\">[33110]</a></span>: incomplete first pass at a condor_who man page ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-14 10:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33043\">[33043]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>) change arg for scanning all pids in condor_who to -allpids. add warning if -allpids used by a non-root user on *nix, since only root can use lsof to figure out the command port of any condor daemon.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-13 11:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33036\">[33036]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>) add ps/tasklist and lsof/netstat parsing to condor_who. also default to scanning the the $(LOG) directory if one is defined. This version of condor_who will query all of the STARTDs that it finds via ps/tasklist if the -ps argument is specified.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-07 13:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32977\">[32977]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>) fix g++ warnings in previous condor_who commit.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-06 17:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32972\">[32972]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>) truncate output to width of console by default, display dynamic slot names Display <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClientMachine\" title=\"Client Machine\">ClientMachine</a></span> attribute in default output. Add support for printing data scraped from log files (i.e. the PID &amp; PROGRAM) in -autoformat mode.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-06 11:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32960\">[32960]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>) modify condor_who so it won't except if no condor_config file is found on the local machine. It will instead use default values for everything and still attempt to query the local startd.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-24 10:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32893\">[32893]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>) condor_who now scrapes exit codes out of the master log file, and continues on even if no condor_config file is found or if running as root. condor_config.cpp now has a module-static variable that can be set by function call to tell it to continue on if no config file is found. ===VersionHistory:None===\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-24 10:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32892\">[32892]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>) condor_who now scrapes exit codes out of the master log file, and continues on even if no condor_config file is found or if running as root. condor_config.cpp now has a module-static variable that can be set by function call to tell it to continue on if no config file is found. ===VersionHistory:None===\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-06 11:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32607\">[32607]</a></span>: split backward reader class out of who.cpp and move it into condor_utils <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-05 13:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32589\">[32589]</a></span>: fix backward reader in condor_who to handle case of \\n at end of buffer <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-03 17:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32585\">[32585]</a></span>: fix backward reader in condor_who to handle case of \\n at end of buffer <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-27 16:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32500\">[32500]</a></span>: generalize condor_who scanning code, add program path and args. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-26 09:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32479\">[32479]</a></span>: condor_who scan schedlog for info. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-26 09:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32476\">[32476]</a></span>: condor_who scan schedlog for info. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-21 17:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32453\">[32453]</a></span>: make condor who log scanning tolerate different name for condor_master (for CS pool) <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-19 16:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32416\">[32416]</a></span>: changes to make warn=errors on fedora16 happy <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-18 17:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32385\">[32385]</a></span>: change std::string indexes to size_t and pids to pid_t <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-18 11:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32366\">[32366]</a></span>: Changes to make condor_who build with gcc <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-18 11:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32365\">[32365]</a></span>: basic implentation of condor_who <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>. capable of producing output from the machine ad if -logdir argument is supplied.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-18 10:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32340\">[32340]</a></span>: Changes to make condor_who build with gcc <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-06 18:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32226\">[32226]</a></span>: basic implentation of condor_who <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3046\" onclick=\"get_ticket_and_populate_wrapper('3046'); return false;\" title=\"create a condor_who tool.\">#3046</a></span>. capable of producing output from the machine ad if -logdir argument is supplied.  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-Dec-17 11:28", "status": "resolved", "created": "2012-Jun-06 18:05", "fixed_version": "2012-Jun-06 18:05", "broken_version": "v070800", "priority": "2", "subsystem": "", "assigned_to": "johnkn", "derived_from": "#2961", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}