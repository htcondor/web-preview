{"id": 6360, "title": "Ticket #6360: per-thread keyring sessions not supported in pre 3.0.0 kernel", "description": "<blockquote>\nIf we are using clone() to spawn shadows, kernel versions before 3.0.0 do not support creating a new session within the clone.  If we detect this configuration, we should EXCEPT right away.  The sysadmin can set\n<div class=\"code\">\n<pre class=\"code\">USE_CLONE_TO_CREATE_PROCESSES = false</pre></div>\n\nto workaround the issue.  Although that does impact performance on heavily-loaded schedds, the alternative is not being able to spawn shadows at all.\n\n<p>The proposed patch will not allow HTCondor to start if we detect an invalid combination of kernel version, USE_KEYRING_SESSIONS, and USE_CLONE_TO_CREATE_PROCESSES.\n\n</p><p>All in all, it seems like setting USE_KEYRING_SESSIONS=True on anything older than a v3.x Linux Kernel (i.e. anything older than RHEL7) is just a bad idea for several reasons, including both this ticket and the fact that creating a new session on RHEL6 is several orders of slower than on RHEL7 (on RHEL6 creating a new session takes ~7.5ms!).</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Aug-03 13:46:38 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Patch looks fine.  I am thinking we do not need a version history entry, so resolving this ticket...</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-08 10:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52031\">[52031]</a></span>: condor_sysapi isn't a cmake build target. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6360\" title=\"per-thread keyring sessions not supported in pre 3.0.0 kernel\">#6360</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-03 15:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51997\">[51997]</a></span>: Although the \"real binaries\" build fine, the tests broke. CMake hackery to fix. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6360\" title=\"per-thread keyring sessions not supported in pre 3.0.0 kernel\">#6360</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-03 12:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51989\">[51989]</a></span>: Don't allow HTCondor to start if we detect an invalid combination of kernel version, USE_KEYRING_SESSIONS, and USE_CLONE_TO_CREATE_PROCESSES. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6360\" title=\"per-thread keyring sessions not supported in pre 3.0.0 kernel\">#6360</a></span>  (By zmiller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Aug-03 13:51", "status": "resolved", "created": "2017-Aug-03 12:22", "fixed_version": "2017-Aug-03 12:22", "broken_version": "v080700", "priority": "2", "subsystem": "Security", "assigned_to": "zmiller", "derived_from": "", "creator": "zmiller", "rust": "", "customer_group": "cern", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": "20170804"}