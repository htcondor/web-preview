{"id": 4891, "title": "Ticket #4891: RPATH is used in the unified RPM build", "description": "<blockquote>\nRPATH is needed for tarball installs and glideins, but we can do without it for the RPM builds, right?\n\n<p>It looks like RPATH may have been removed for the package builds in <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1135\" title='\"Real\" dynamic binary releases'>#1135</a></span> and then re-added in <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2389\" title=\"Dynamically link Globus and VOMS libraries in UW builds\">#2389</a></span> (related to linking against Globus and VOMS libraries).\n\n</p><p>For the RPM / package build, can we get away without RPATH?\n\n</p><p>This is a follow-up for <a class=\"external\" href=\"https://jira.opensciencegrid.org/browse/SOFTWARE-1393\">https://jira.opensciencegrid.org/browse/SOFTWARE-1393</a>.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Feb-16 18:07:47 by edquist:</em> <br/>\n\nNote that for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2389\" title=\"Dynamically link Globus and VOMS libraries in UW builds\">#2389</a></span>, this commit:\n\n<p><a class=\"external\" href=\"https://htcondor-wiki.cs.wisc.edu/index.cgi/chngview?cn=26944\">https://htcondor-wiki.cs.wisc.edu/index.cgi/chngview?cn=26944</a>\n\n</p><p>apparently was only supposed to use RPATH for non-proper builds, but we still see RPATH getting used in the proper builds also.\n\n</p><p></p><hr/>\n<em>2015-Mar-13 15:42:18 by jfrey:</em> <br/>\n\nYes, it appears the RPATH is unnecessary for proper builds.\n\n<p>If I recall correctly, years ago we were advised to put the libcondor_utils_X_X_X.so library under /usr/lib[64]/condor, since it doesn't have an SO version number and thus shouldn't appear in the public library directories. I believe that came from a Red Hat collaborator, but it could have been from official packaging guidelines. That would require an RPATH even for proper builds.\nBut I see that both Fedora and OSG put libcondor_utils_X_X_X.so in /usr/lib[64], making the RPATH unnecessary for proper builds. We still need it for UW builds with externals.\n\n</p><p></p><hr/>\n<em>2015-Mar-13 15:45:17 by jfrey:</em> <br/>\n\nWe define a cmake option called CMAKE_SKIP_RPATH to control whether to set the RPATH. It defaults to setting the RPATH on linux. We could change the default to not set the RPATH for proper builds. And the OSG build could set it explicitly to not set the RPATH.\n\n<p></p><hr/>\n<em>2015-Apr-22 15:16:03 by bbockelm:</em> <br/>\n\nPer TimT on OSG/HTCondor call: should easily make it to 8.3.6.\n\n<p></p><hr/>\n<em>2015-May-06 15:14:36 by bbockelm:</em> <br/>\n\nPer TimT, this should be finished before code freeze.\n\n<p></p><hr/>\n<em>2015-May-08 11:44:29 by tim:</em> <br/>\n\nNo version needed. Only affects downstream builds.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-08 11:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44806\">[44806]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4891\" title=\"RPATH is used in the unified RPM build\">#4891</a></span>) Don't include RPATH in PROPER builds  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-07 15:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44803\">[44803]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4891\" title=\"RPATH is used in the unified RPM build\">#4891</a></span>) Don't include RPATH in PROPER builds  (By Tim Theisen )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-May-08 11:45", "status": "resolved", "created": "2015-Feb-16 17:59", "fixed_version": "2015-Feb-16 17:59", "broken_version": "", "priority": "3", "subsystem": "Packaging", "assigned_to": "tim", "derived_from": "#4882", "creator": "edquist", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "edquist@cs.wisc.edu", "due_date": ""}