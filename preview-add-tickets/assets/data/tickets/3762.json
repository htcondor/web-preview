{"id": 3762, "title": "Ticket #3762: Suspend creates unpredictable results", "description": "<blockquote>\nIf the <code>SUSPEND</code> expression in the startd becomes true, it is possible for the starter and shadow to become disconnected with a vanilla job.  Once this happens, reconnects also fail, and the job will go back to idle. This happens about 30% of the time in testing.\n\n<p>A suspend will cause unpredictable results. In the test we have to do suspend and then continues until the job complete, we get some success and some failure. I have seen shadow exceptions. I have also seen it be taken by a disconnect by the shadow which then focusses on trying to reconnect without success.\n\n</p><p></p><pre>  07/09/13 11:34:16 Entering JICShadow::updateShadow()\n  07/09/13 11:34:16 In VanillaProc::PublishUpdateAd()\n  07/09/13 11:34:16 Inside OsProc::PublishUpdateAd()\n  07/09/13 11:34:16 Inside UserProc::PublishUpdateAd()07/09/13 11:34:16 In VanillaProc::PublishUpdateAd()\n  07/09/13 11:34:16 Inside OsProc::PublishUpdateAd()\n  07/09/13 11:34:16 Inside UserProc::PublishUpdateAd()07/09/13 11:34:16 Sent job ClassAd update to startd.\n  07/09/13 11:34:16 Leaving JICShadow::updateShadow(): success\n  07/09/13 11:34:32 Suspending all jobs. 07/09/13 11:34:32 in VanillaProc::Suspend()\n  07/09/13 11:34:32 In VanillaProc::PublishUpdateAd()\n</pre>\n\n<p>Here is sample log output from the shadow\n\n</p><p></p><pre>  07/09/13 11:34:32 (2.0) (10866): condor_read(): Socket closed when trying to read 5 bytes from startd slot5@ingwe.cs.wisc.edu\n  07/09/13 11:34:32 (2.0) (10866): IO: EOF reading packet header\n  07/09/13 11:34:32 (2.0) (10866): Can no longer talk to condor_starter &lt;128.105.121.64:41723&gt;\n  07/09/13 11:34:32 (2.0) (10866): FileLock::obtain(1) - @1373387672.031265 lock on /tmp/condorLocks/17/73/02219024403982.lockc now WRITE\n  07/09/13 11:34:32 (2.0) (10866): FileLock::obtain(2) - @1373387672.031324 lock on /tmp/condorLocks/17/73/02219024403982.lockc now UNLOCKED\n  07/09/13 11:34:32 (2.0) (10866): Trying to reconnect job schedd10644suspendandcontinue@ingwe.cs.wisc.edu#2.0#1373387630\n  07/09/13 11:34:32 (2.0) (10866): Trying to reconnect to disconnected job\n  07/09/13 11:34:32 (2.0) (10866): LastJobLeaseRenewal: 1373387656 Tue Jul 9 11:34:16 2013 07/09/13 11:34:32 (2.0) (10866): JobLeaseDuration: 1200 seconds\n  07/09/13 11:34:32 (2.0) (10866): Resource slot5@ingwe.cs.wisc.edu changing state from EXECUTING to RECONNECT\n  07/09/13 11:34:32 (2.0) (10866): JobLeaseDuration remaining: 1184\n  07/09/13 11:34:32 (2.0) (10866): Attempting to locate disconnected starter\n  07/09/13 11:34:32 (2.0) (10866): gjid is schedd10644suspendandcontinue@ingwe.cs.wisc.edu#2.0#1373387630 claimid is &lt;128.105.121.64:41723&gt;#1373387607#10#...\n  07/09/13 11:34:32 (2.0) (10866): attempt to connect to &lt;128.105.121.64:41723&gt; failed: Connection refused (connect errno = 111).\n  07/09/13 11:34:32 (2.0) (10866): locateStarter(): Failed to connect to startd &lt;128.105.121.64:41723&gt;\n  07/09/13 11:34:32 (2.0) (10866): JobLeaseDuration remaining: 1200 0\n  7/09/13 11:34:32 (2.0) (10866): Scheduling another attempt to reconnect in 8 seconds</pre>\n</blockquote>", "remarks": "<blockquote>\nThe test job_basic_suspend_continue_test.run has been turned off till this gets fixed. To run it see instructions in wiki under \"testing HKCondor on unix\". Take note of the changes to your build location specified in second example, Testing from the GIT repo. Inparticular from the \"make tests\" down.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "defect", "last_change": "2014-May-29 16:01", "status": "new", "created": "2013-Jul-10 10:20", "fixed_version": "2013-Jul-10 10:20", "broken_version": "v080001", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "tannenba", "derived_from": "", "creator": "bt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bt@cs.wisc.edu,tstclair@redhat.com, tannenba@cs.wisc.edu, johnkn@cs.wisc.edu", "due_date": ""}