{"id": 7504, "title": "Ticket #7504: Expose version comparison in ClassAds", "description": "<blockquote>\nDoing version comparisons in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> is a pain (see <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=2395\" onclick=\"get_ticket_and_populate_wrapper('2395'); return false;\" title=\"New ClassAd functions: versioncmp, versionokay\">#2395</a></span> for examples), so let's provide some functions to make them easier:\n\n<p></p><ul>\n<li><code>versioncmp(left, right)</code> for consistency with <code>strcmp()</code>\n</li><li><code>versionXY(left, right)</code> for <code>LT</code>, <code>LE</code>, <code>EQ</code>, <code>GE</code>, and <code>GT</code>, for completeness\n</li><li><code>version_in_range(version, min, max)</code> for convenience\n</li></ul>\n\n<p>These will be implemented with our existing <code>natural_cmp()</code> function.\n\n</p><p><em>original description</em>\n</p><hr/>\nWe should add one or more version comparison function(s) to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>.  We have a C function, <code>natural_cmp</code>, which does the job, so it's only a question of determining the right function names.\n\n<p>Attached to this ticket is a first-pass implementation.  It implements <code>versioncmp()</code> for consistency with <code>strcmp()</code>.  It implements <code>versionXY()</code> for <code>LT</code>, <code>LE</code>, <code>EQ</code>, <code>GE</code>, and <code>GT</code>, for completeness.\n\n</p><p>It has been suggested that we add a range-comparison function, for additional convenience.  Something like <code>version_in_range( low, version, high )</code> seems reasonable to me (assuming the other functions exist).\n\n</p><p>The first-pass implementation is in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> proper, rather than compat classads, so that the function is universally available.  However, since <code>libclassad</code> should not depend on <code>libcondor_utils</code>, the <code>natural_cmp()</code> function is -- in this patch -- simply copied into <code>fnCall.cpp</code>, which is kind of evil.  We should either move the new function(s) into compat classads, or do something saner than code duplication.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Feb-25 10:50:27 by tlmiller:</em> <br/>\n\nGiven the direction Jaime is taking the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> implementation in Condor, he thinks (and thinks that Greg would agree) that the new functions should be implemented in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> library, even if that means some code duplication (because making a joint library that <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> and HTCondor both call sounds like a terrible idea).  Or maybe just move the C function into the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> library and call it there from condor-utils.\n\n<p></p><hr/>\n<em>2020-Aug-21 14:13:18 by tlmiller:</em> <br/>\n\nSee also <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=2395\" onclick=\"get_ticket_and_populate_wrapper('2395'); return false;\" title=\"New ClassAd functions: versioncmp, versionokay\">#2395</a></span>.\n\n<p></p><hr/>\n<em>2020-Aug-24 11:31:24 by tlmiller:</em> <br/>\n\nMerged to master.  Needs tests and documentation.\n\n<p></p><hr/>\n<em>2020-Aug-28 15:01:58 by tlmiller:</em> <br/>\n\nNeeds documentation.</blockquote>", "derived_tickets": "", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/1042/versioncmp.diff\">versioncmp.diff</a>\n5462 bytes added by tlmiller on 2020-Feb-13 23:32:33 UTC.\n<br/>\nImplements the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> function <code>versioncmp()</code> and friends.<br/>\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-28 12:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61565\">[61565]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7504\" onclick=\"get_ticket_and_populate_wrapper('7504'); return false;\" title=\"Expose version comparison in ClassAds\">#7504</a></span>) Documentation.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-28 12:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61564\">[61564]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7504\" onclick=\"get_ticket_and_populate_wrapper('7504'); return false;\" title=\"Expose version comparison in ClassAds\">#7504</a></span>) Add <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> function version_in_range().  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-28 12:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61563\">[61563]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7504\" onclick=\"get_ticket_and_populate_wrapper('7504'); return false;\" title=\"Expose version comparison in ClassAds\">#7504</a></span>) Add the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> function versioncmp() and friends.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-11 09:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61277\">[61277]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7504\" onclick=\"get_ticket_and_populate_wrapper('7504'); return false;\" title=\"Expose version comparison in ClassAds\">#7504</a></span>) Documentation and release note. Committer: Tim Theisen  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-09 15:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61252\">[61252]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7504\" onclick=\"get_ticket_and_populate_wrapper('7504'); return false;\" title=\"Expose version comparison in ClassAds\">#7504</a></span>) Documentation and release note.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-28 17:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61156\">[61156]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7504\" onclick=\"get_ticket_and_populate_wrapper('7504'); return false;\" title=\"Expose version comparison in ClassAds\">#7504</a></span>) No extensions in the CMakeLists.txt for tests, right.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-28 14:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61152\">[61152]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7504\" onclick=\"get_ticket_and_populate_wrapper('7504'); return false;\" title=\"Expose version comparison in ClassAds\">#7504</a></span>) Add extensive testing.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-24 14:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60519\">[60519]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7504\" onclick=\"get_ticket_and_populate_wrapper('7504'); return false;\" title=\"Expose version comparison in ClassAds\">#7504</a></span>) Add natural_cmp.h file to classad-devel RPM  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-21 14:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60501\">[60501]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7504\" onclick=\"get_ticket_and_populate_wrapper('7504'); return false;\" title=\"Expose version comparison in ClassAds\">#7504</a></span>) Add <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> function version_in_range().  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-21 14:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60498\">[60498]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7504\" onclick=\"get_ticket_and_populate_wrapper('7504'); return false;\" title=\"Expose version comparison in ClassAds\">#7504</a></span>) Move natural_cmp() from condor_utils to the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> library to eliminate duplicated code.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-21 14:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60497\">[60497]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7504\" onclick=\"get_ticket_and_populate_wrapper('7504'); return false;\" title=\"Expose version comparison in ClassAds\">#7504</a></span>) Add the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> function versioncmp() and friends.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Sep-09 15:51", "status": "resolved", "created": "2020-Feb-13 17:30", "fixed_version": "2020-Feb-13 17:30", "broken_version": "", "priority": "3", "subsystem": "Unknown", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, johnkn@cs.wisc.edu, matyas@cs.wisc.edu", "due_date": ""}