{"id": 3601, "title": "Ticket #3601: autofs doesn't work with 7.9", "description": "<blockquote>\nAs of <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3505\" title=\"Leaking mount points, on filesystems originally mounted w/shared prop.\">#3505</a></span>, we unconditionally unshare the root filesystem namespace in the job.  This is needed for MOUNT_UNDER_SCRATCH, fuse mounts, and file system remaps.  Unfortuantely, this breaks autofs, because autofs lives in the root namespace.  Propose adding a knob to turn off unsharing.</blockquote>", "remarks": "<blockquote>\n<em>2013-Apr-29 16:03:00 by tstclair:</em> <br/>\n\nApplying a knob and defaulting to off is the simplest solution but this may affect others who rely on the unshare. (MOUNT_UNDER_SCRATCH, NAMED_CHROOT, etc.)\n\n<p></p><hr/>\n<em>2013-Apr-29 16:05:09 by tstclair:</em> <br/>\n\nMaybe default it on and selectively disable.?.?  That seems like a wiser choice.\n\n<p></p><hr/>\n<em>2013-Apr-29 16:29:08 by bbockelm:</em> <br/>\n\nHi,\n\n<p>These were all working prior to <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3505\" title=\"Leaking mount points, on filesystems originally mounted w/shared prop.\">#3505</a></span>.  I think we regressed in 7.9.5.\n\n</p><p>UNL uses autofs fairly extensively and didn't hit issues when using MOUNT_UNDER_SCRATCH.\n\n</p><p>I'd propose fixing the underlying bug rather than add a knob.\n\n</p><p>Brian</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-20 14:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35768\">[35768]</a></span>: defn of new knob PER_JOB_NAMESPACES in manual ===GT=== <span class=\"ticket\"><a class=\"review\" href=\"tktview?tn=3601\" title=\"autofs doesn't work with 7.9\">#3601</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-07 17:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35641\">[35641]</a></span>: Edit many 7.9.6 version history items, including those for tickets (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3539\" title=\"change recommended configuration for disabling preemption\">#3539</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3586\" title=\"move python bindings out of contrib\">#3586</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3398\" title=\"Batch GAHP cannot set remote memory or walltime requests\">#3398</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3560\" title=\"improve dprintf code to support audit logs (time based rotation)\">#3560</a></span>, <span class=\"ticket\"><a class=\"defer\" href=\"tktview?tn=2949\" title=\"peaceful shutdown cannot be escalated to graceful\">#2949</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3493\" title=\"Audit Log for Condor schedds\">#3493</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3496\" title=\"monitor file transfer i/o activity\">#3496</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3597\" title=\"CPU affinity enforcement broken with partitionable slots\">#3597</a></span>, <span class=\"ticket\"><a class=\"review\" href=\"tktview?tn=3601\" title=\"autofs doesn't work with 7.9\">#3601</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3579\" title=\"condor_updates_stats doesn't work anymore\">#3579</a></span>,) and (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3570\" title=\"Starter leaks FDs to file transfer plugin\">#3570</a></span>, <span class=\"ticket\"><a class=\"new\" href=\"tktview?tn=3588\" title=\"DHCPREQUEST doesn't have the ending 0xff byte to mark end of options f\">#3588</a></span>)  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-06 14:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35608\">[35608]</a></span>: Document <span class=\"ticket\"><a class=\"review\" href=\"tktview?tn=3601\" title=\"autofs doesn't work with 7.9\">#3601</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-29 16:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35577\">[35577]</a></span>: Ticket <span class=\"ticket\"><a class=\"review\" href=\"tktview?tn=3601\" title=\"autofs doesn't work with 7.9\">#3601</a></span> Selectively use unshare only on remap and knob.  (By Timothy St. Clair )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Jun-03 15:42", "status": "review", "created": "2013-Apr-29 15:51", "fixed_version": "2013-Apr-29 15:51", "broken_version": "v070905", "priority": "2", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "a25445", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com, bbockelm@cse.unl.edu", "due_date": "20130613"}