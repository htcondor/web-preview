{"id": 3774, "title": "Ticket #3774: ATTR_TOTAL_CLAIM_RUN_TIME not always in startd ad", "description": "<blockquote>\n<div class=\"code\">\n<pre class=\"code\">07/12/13 11:19:25 slot1: Can't evaluate PREEMPT in the context of following ads\nTotalCondorLoadAvg = 0.0\nIsValidCheckpointPlatform = ( TARGET.JobUniverse =!= 1 || ( ( MY.CheckpointPlatform =!= undefined ) &amp;&amp; ( ( TARGET.LastCheckpointPlatform =?= MY.CheckpointPlatform ) || ( TARGET.NumCkpts == 0 ) ) ) )\nJavaSpecificationVersion = \"1.6\"\nRemoteAutoregroup = false\nJavaVendor = \"Apple Inc.\"\nMonitorSelfTime = 1373645945\nOpSys = \"OSX\"\nRecentTotalPreemptions = 0\nLastFetchWorkSpawned = 0\nTotalRankPreemptions = 0\nRunBenchmarks = false\nHibernationState = \"NONE\"\nTotalLoadAvg = 2.600000\nHasMPI = true\nJobId = \"1.0\"\nOpSysAndVer = \"MacOSX8\"\nRecentTotalJobStarts = 0\nMyType = \"Machine\"\nRank = 0.0\nTotalUserPrioPreemptions = 0\nWANT_VACATE = ( ifThenElse(JobStart =!= undefined,( time() - JobStart ),0) &gt; 10 * 60 || ( TARGET.JobUniverse == 5 ) )\nLoadAvg = 0.0\nVirtualMemory = 265325\nMachineResources = \"cpus memory disk swap\"\nSlotWeight = Cpus\nCheckpointPlatform = \"OSX X86_64 12.4.0 normal N/A none\"\nHasJobDeferral = true\nTotalSlots = 4\nTotalDisk = 480288264\nJobUniverse = 5\nHasJICLocalStdin = true\nTotalSlotDisk = 120073639\nHasFileTransferPluginMethods = \"file,ftp,http,data\"\nRequirements = ( START ) &amp;&amp; ( IsValidCheckpointPlatform )\nPublicClaimId = \"&lt;128.104.103.18:9616&gt;#1373645944#1#...\"\nNumPids = 0\nClockMin = 679\nCpuIsBusy = false\nHasJICLocalConfig = true\nUtsnameVersion = \"Darwin Kernel Version 12.4.0: Wed May  1 17:57:12 PDT 2013; root:xnu-2050.24.15~1/RELEASE_X86_64\"\nCpuBusy = ( ( LoadAvg - CondorLoadAvg ) &gt;= 0.500000 )\nUidDomain = \"exec-18.batlab.org\"\nArch = \"X86_64\"\nExpectedMachineQuickDrainingCompletion = 1373646565\nTargetType = \"Job\"\nHasFileTransfer = true\nKeyboardIdle = 2398032\nCondorPlatform = \"$CondorPlatform: x86_64_MacOSX8 $\"\nSlotType = \"Static\"\nSUSPEND = false\nOpSysVer = 804\nCpuBusyTime = 0\nStartdIpAddr = \"&lt;128.104.103.18:9616&gt;\"\nRecentDaemonCoreDutyCycle = 0.010263\nStarterAbilityList = \"HasTDP,HasFileTransferPluginMethods,HasJobDeferral,HasJICLocalConfig,HasJICLocalStdin,HasPerFileEncryption,HasFileTransfer,HasVM,HasReconnect,HasMPI,HasJava\"\nHasReconnect = true\nDaemonCoreDutyCycle = 0.010263\nCanHibernate = false\nGlobalJobId = \"schedd2221basicpreempt@exec-18.batlab.org#1.0#1373645953\"\nTotalMemory = 4096\nMachine = \"exec-18.batlab.org\"\nRecentTotalUserPrioPreemptions = 0\nJobStart = 1373645964\nRetirementTimeRemaining = 0\nPERIODIC_CHECKPOINT = ( time() - LastPeriodicCheckpoint ) &gt; ( 3 * ( 60 * 60 ) + 10 * 60 )\nMonitorSelfAge = 1\nMaxJobRetirementTime = 0\nDisk = 120072066\nUnhibernate = MY.MachineLastMatchTime =!= undefined\nhas_none = true\nIsLocalStartd = false\nCondorVersion = \"$CondorVersion: 8.1.1 Jul 11 2013 BuildID: 147681 PRE-RELEASE-UWCS $\"\nExpectedMachineGracefulDrainingBadput = 600\nHasJava = true\nActivity = \"Busy\"\nTotalSlotMemory = 1024\nTotalVirtualMemory = 1061300\nOpSysName = \"MountainLion\"\nTotalTimeClaimedIdle = 1\nTotalCpus = 4\nHasVM = false\nTotalSlotCpus = 1\nName = \"slot1@exec-18.batlab.org\"\nHibernationSupportedStates = \"\"\nSlotID = 1\nMonitorSelfRegisteredSocketCount = 1\nIsOwner = ( START =?= false )\nMonitorSelfSecuritySessions = 1\nUtsnameRelease = \"12.4.0\"\nCONTINUE = ( ( ( LoadAvg - CondorLoadAvg ) &lt;= 0.300000 ) &amp;&amp; ( ( time() - EnteredCurrentActivity ) &gt; 10 ) &amp;&amp; ( KeyboardIdle &gt; 5 * 60 ) )\nOpSysShortName = \"MacOSX\"\nOpSysMajorVer = 8\nFileSystemDomain = \"exec-18.batlab.org\"\nWANT_SUSPEND = false\nImageSize = 0\nEnteredCurrentState = 1373645964\nCondorLoadAvg = 0.0\nMonitorSelfImageSize = 2441852.000000\nConsoleIdle = 2398032\nState = \"Claimed\"\nKILL = false\nUtsnameSysname = \"Darwin\"\nMonitorSelfResidentSetSize = 6108\nUtsnameMachine = \"x86_64\"\nSTART = true\nTotalTimeUnclaimedIdle = 19\nTotalJobStarts = 1\nHasTDP = true\nCurrentRank = 0.0\nRecentTotalRankPreemptions = 0\nUtsnameNodename = \"exec-18.batlab.org\"\nWANT_HOLD = false\nRemoteOwner = \"slot1@exec-18.batlab.org\"\nCpus = 1\nHasIOProxy = true\nMemory = 1024\nTimeToLive = 2147483647\nOpSysLegacy = \"OSX\"\nJavaVersion = \"1.6.0_51\"\nLastFetchWorkCompleted = 0\nMyCurrentTime = 1373645945\nNextFetchWorkDelay = -1\nMachineMaxVacateTime = 10 * 60\nExecutableSize = 1\nExpectedMachineQuickDrainingBadput = 600\nTotalPreemptions = 0\nRemoteNegotiatingGroup = \"&lt;none&gt;\"\nMonitorSelfCPUUsage = 0.0\nLastBenchmark = 0\nExpectedMachineGracefulDrainingCompletion = 1373646565\nPREEMPT = TotalClaimRunTime &gt; 20\nCurrentTime = time()\nCOLLECTOR_HOST_STRING = \"exec-18.batlab.org:0\"\nNiceUser = false\nSlotTypeID = 0\nOpSysLongName = \"MacOSX 8.4\"\nRemoteUser = \"slot1@exec-18.batlab.org\"\nClockDay = 5\nMyAddress = \"&lt;128.104.103.18:9616&gt;\"\nHibernationLevel = 0\nClientMachine = \"exec-18.batlab.org\"\nEnteredCurrentActivity = 1373645965\nHasPerFileEncryption = true\n07/12/13 11:19:25 slot1: =============================\nMaxHosts = 1\nUser = \"slot1@exec-18.batlab.org\"\nOnExitHold = false\nCoreSize = 100000000\nMachineAttrCpus0 = 1\nWantRemoteSyscalls = false\nMyType = \"Job\"\nRank = 0.0\nCumulativeSuspensionTime = 0\nMinHosts = 1\nPeriodicHold = false\nPeriodicRemove = false\nErr = \"/dev/null\"\nProcId = 0\nEnteredCurrentStatus = 1373645964\nTransferOut = false\nUserLog = \"/Volumes/MacintoshHD2/condor/slot1/dir_75007/userdir/condor_tests/job_basic_preempt.user_log.2221\"\nNumJobStarts = 0\nAutoClusterAttrs = \"JobUniverse,LastCheckpointPlatform,NumCkpts,RemoteGroup,SubmitterGroup,SubmitterUserPrio,FileSystemDomain,DiskUsage,ImageSize,RequestDisk,RequestMemory,Requirements,NiceUser,ConcurrencyLimits\"\nJobUniverse = 5\nAutoClusterId = 1\nIn = \"/dev/null\"\nRequirements = ( TARGET.Arch == \"X86_64\" ) &amp;&amp; ( TARGET.OpSys == \"OSX\" ) &amp;&amp; ( TARGET.Disk &gt;= RequestDisk ) &amp;&amp; ( TARGET.Memory &gt;= RequestMemory ) &amp;&amp; ( ( TARGET.HasFileTransfer ) || ( TARGET.FileSystemDomain == MY.FileSystemDomain ) )\nClusterId = 1\nPublicClaimId = \"&lt;128.104.103.18:9616&gt;#1373645944#1#...\"\nProvisionedResources = \"cpus memory disk swap\"\nWhenToTransferOutput = \"ON_EXIT\"\nLastMatchTime = 1373645964\nCompletionDate = 0\nBufferSize = 524288\nEnvironment = \"\"\nStartdPrincipal = \"unauthenticated@unmapped/128.104.103.18\"\nCpusProvisioned = 1\nTargetType = \"Machine\"\nLeaveJobInQueue = false\nJobNotification = 0\nOwner = \"slot1\"\nCondorPlatform = \"$CondorPlatform: x86_64_MacOSX8 $\"\nCommittedTime = 0\nQDate = 1373645953\nJobLeaseDuration = 1200\nTransferIn = false\nExitStatus = 0\nStartdIpAddr = \"&lt;128.104.103.18:9616&gt;\"\nRootDir = \"/\"\nNumJobMatches = 1\nJobCurrentStartDate = 1373645964\nCurrentHosts = 1\nGlobalJobId = \"schedd2221basicpreempt@exec-18.batlab.org#1.0#1373645953\"\nRemoteSysCpu = 0.0\nTotalSuspensions = 0\nWantCheckpoint = false\nLastJobLeaseRenewal = 1373645964\nPeriodicRelease = false\nNumCkpts_RAW = 0\nCondorVersion = \"$CondorVersion: 8.1.1 Jul 11 2013 BuildID: 147681 PRE-RELEASE-UWCS $\"\nOut = \"/dev/null\"\nShouldTransferFiles = \"IF_NEEDED\"\nDiskUsage = 1\nJobRunCount = 1\nCumulativeSlotTime = 0\nCommittedSlotTime = 0\nLocalUserCpu = 0.0\nJobStartDate = 1373645964\nExitBySignal = false\nNumSystemHolds = 0\nNumRestarts = 0\nRequestDisk = 1\nOrigMaxHosts = 1\nFileSystemDomain = \"exec-18.batlab.org\"\nJobPrio = 0\nNumCkpts = 0\nBufferBlockSize = 32768\nImageSize = 1\nDiskUsage_RAW = 1\nRemoteHost = \"slot1@exec-18.batlab.org\"\nCommittedSuspensionTime = 0\nCmd = \"/Volumes/MacintoshHD2/condor/slot1/dir_75007/userdir/condor_tests/x_sleep.pl\"\nLocalSysCpu = 0.0\nIwd = \"/Volumes/MacintoshHD2/condor/slot1/dir_75007/userdir/condor_tests\"\nTransferInputSizeMB = 0\nMemoryProvisioned = 1024\nLastSuspensionTime = 0\nExecutableSize_RAW = 1\nTransferErr = false\nDiskProvisioned = 120072164\nJobStatus = 2\nExecutableSize = 1\nShadowBday = 1373645964\nMachineAttrSlotWeight0 = 1\nImageSize_RAW = 1\nRemoteWallClockTime = 0.0\nOnExitRemove = true\nArguments = \"1\"\nRemoteSlotID = 1\nCurrentTime = time()\nRequestMemory = 1\nRemoteUserCpu = 0.0\nNiceUser = false\nNumShadowStarts = 1\nRequestCpus = 1\nMyAddress = \"&lt;128.104.103.18:55932?noUDP&gt;\"\nWantRemoteIO = true\nLastJobStatus = 1\n07/12/13 11:19:25 ERROR \"Can't evaluate PREEMPT\" at line 1649 in file /usr/local/condor/local/execute/slot2/dir_90080/userdir/src/condor_startd.V6/Resource.cpp\n07/12/13 11:19:25 CronJobMgr: 0 jobs alive\n07/12/13 11:19:25 CronJobMgr: 0 jobs alive\n07/12/13 11:19:25 slot1: Canceled ClaimLease timer (23)\n07/12/13 11:19:25 slot1: Changing state and activity: Claimed/Busy -&gt; Preempting/Killing\n07/12/13 11:19:25 slot1: In Starter::kill() with pid 4728, sig 3 (SIGQUIT)\n07/12/13 11:19:25 Send_Signal(): Doing kill(4728,3) [SIGQUIT]\n07/12/13 11:19:25 slot1: in starter:killHard starting kill timer\n07/12/13 11:19:25 startd exiting because of fatal exception.\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\nLooks like a race condition, where we don't set ATTR_TOTAL_CLAIM_RUN_TIME if it has been running for zero seconds when we publish the ad.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "defect", "last_change": "2014-Sep-29 14:24", "status": "abandoned", "created": "2013-Jul-12 13:23", "fixed_version": "2013-Jul-12 13:23", "broken_version": "v080001", "priority": "4", "subsystem": "DaemonsExecNode", "assigned_to": "johnkn", "derived_from": "", "creator": "bt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "johnkn@cs.wisc.edu", "due_date": ""}