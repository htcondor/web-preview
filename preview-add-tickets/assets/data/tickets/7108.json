{"id": 7108, "title": "Ticket #7108: Allow DAGMan to untangle dense graphs with join nodes", "description": "<blockquote>\nLIGO approached us with a problem where some dags were executing very slowly. On inspection, we realized their graph structure was enormous with 660,000,000+ edges. The reason it got so dense was because of PARENT ... CHILD ... statements with large numbers of both parents are children. Default behavior in DAGMan is to put an edge between every parent and every child. However if there are 10,000 of each (as was the case with some of LIGO's statements) this results in 100,000,000 edges.\n\n<p>In <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7054\" title=\"LIGO gstlal DAG scaling problem\">#7054</a></span> we provided a simple script to reorganize their .dag files by introducing a \"join node\": a single node in the middle which all parents and all children connect to. This reduces the number of edges from m*n to m+n. In LIGO's case it reduced the number of edges from ~660M to ~1.5M and improved the parse time, submit time and memory footprint by two orders of magnitude.\n\n</p><p>Now we want to implement join nodes as a feature directly in DAGMan, to be added at parse time while condor_dagman is building the graph. They will be disabled by default, can be enabled by setting the <code>DAGMAN_USE_JOIN_NODES</code> configuration knob to true.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Jun-13 11:11:05 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong>  I think it's premature to have the knob in the param table (in stable)  also I think this\n<div class=\"code\">\n<pre class=\"code\">std::string joinNodeName = \"_condor_join_node\" + std::to_string(static_cast\u200b&lt;long long&gt;(++numJoinNodes));</pre></div>\n\nwould be clearer if written to use formatstr like this:\n<div class=\"code\">\n<pre class=\"code\">std::string name;\nformatstr(name, \"_condor_join_node%d\", ++numJoinNodes);\n</pre></div>\n\n\n<p><em>2019-Jun-24 11:39:05 by coatsworth:</em> <br/>\n\nUpdated as per code review. Still need version history + documentation.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-27 13:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57239\">[57239]</a></span>: Added documentation + version history (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7108\" title=\"Allow DAGMan to untangle dense graphs with join nodes\">#7108</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-18 12:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57163\">[57163]</a></span>: Removed obsolete comment (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7108\" title=\"Allow DAGMan to untangle dense graphs with join nodes\">#7108</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-17 16:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57160\">[57160]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=57159\">[57159]</a></span>, Merge branch 'V8_8-branch' (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7108\" title=\"Allow DAGMan to untangle dense graphs with join nodes\">#7108</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-17 16:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57159\">[57159]</a></span>: Small join node changes as per code review (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7108\" title=\"Allow DAGMan to untangle dense graphs with join nodes\">#7108</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-12 15:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57151\">[57151]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=57068\">[57068]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=57075\">[57075]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=57110\">[57110]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=57111\">[57111]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=57123\">[57123]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=57149\">[57149]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=57150\">[57150]</a></span>, Merge branch 'V8_8-branch' (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7108\" title=\"Allow DAGMan to untangle dense graphs with join nodes\">#7108</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-12 15:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57150\">[57150]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=57130\">[57130]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=57136\">[57136]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=57141\">[57141]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=57142\">[57142]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=57145\">[57145]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=57146\">[57146]</a></span>, Merge branch 'V8_8-branch' of /p/condor/repository/CONDOR_SRC into V8_8-branch (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7108\" title=\"Allow DAGMan to untangle dense graphs with join nodes\">#7108</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-12 15:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57149\">[57149]</a></span>: Implemented join nodes into condor_dagman parser (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7108\" title=\"Allow DAGMan to untangle dense graphs with join nodes\">#7108</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Jun-27 13:06", "status": "resolved", "created": "2019-Jun-12 15:23", "fixed_version": "2019-Jun-12 15:23", "broken_version": "", "priority": "2", "subsystem": "Dag", "assigned_to": "coatsworth", "derived_from": "#7054", "creator": "coatsworth", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "", "due_date": ""}