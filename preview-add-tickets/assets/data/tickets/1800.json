{"id": 1800, "title": "Ticket #1800: NETWORK_INTERFACE should accept wildcards", "description": "<blockquote>\nBen Cotton and Preston Smith at Purdue have requested that there be a way to specify which IP address to use as something like 128.210.*, because in some cases, it is awkward to have to specify an exact IP address.\n\n<p>Also, it seems odd that NETWORK_INTERFACE cannot accept the name of an interface rather than an IP address.\n\n</p><p>Previously, we relied on DNS to tell us the IP addresses associated with our hostname.  This makes Condor more dependent on DNS than it needs to be and has been a source of trouble in many cases.\n\n</p><p>To address the items above, I propose that the IP address be determined by iterating through the network devices.  If there are multiple options, the algorithm for choosing one will be similar to the one used before: prefer public IPs over private IPs and private IPs over loopback.  In case of a tie, choose the first one in the list.  The default should be NETWORK_INTERFACE=*.  When BIND_ALL_INTERFACES is true and NETWORK_INTERFACE matches more than one IP address, the existing mechanism that rewrites the published IP address to match the IP address used to talk to the collector will still be used (providing that the latter IP address matches NETWORK_INTERFACE).\n\n</p><p>On platforms where we don't know how to iterate through the network devices, we could rely on the old method of doing a DNS lookup of the hostname.\n\n</p><p>This ticket is somewhat related to <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=386\" onclick=\"get_ticket_and_populate_wrapper('386'); return false;\" title=\"BIND_ALL_INTERFACES always trumps NETWORK_INTERFACE\">#386</a></span>, but I'm not proposing any change to how BIND_ALL_INTERFACES works in this ticket.  That can be done separately if desired.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Dec-20 13:44:07 by jfrey:</em> <br/>\n\nCondor binaries now fail on Solaris and AIX with this error:\n\n<p>ERROR \"Failed to determine my IP address using NETWORK_INTERFACE=*\" at line 273 in file /home/condor/execute/dir_124754/userdir/src/condor_utils/my_hostname.cpp\n</p><hr/>\n<em>2011-Feb-01 16:20:02 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Dec-29 15:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=19829\">[19829]</a></span>: Fix for Solaris implementation of sysapi_get_network_device_info_raw(). <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1800\" onclick=\"get_ticket_and_populate_wrapper('1800'); return false;\" title=\"NETWORK_INTERFACE should accept wildcards\">#1800</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Dec-20 20:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=19737\">[19737]</a></span>: Fix for crash in sysapi_get_network_device_info_raw. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1800\" onclick=\"get_ticket_and_populate_wrapper('1800'); return false;\" title=\"NETWORK_INTERFACE should accept wildcards\">#1800</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Dec-17 09:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=19691\">[19691]</a></span>: Remove warnings about multiple network interfaces in condor_configure. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1800\" onclick=\"get_ticket_and_populate_wrapper('1800'); return false;\" title=\"NETWORK_INTERFACE should accept wildcards\">#1800</a></span> Multiple interfaces simply aren't as problematic as they once were, primarily because BIND_ALL_INTERFACES=true by default and also now because we don't rely on DNS to determine our IP address.  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Dec-16 20:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25819\">[25819]</a></span>: Documented change to NETWORK_INTERFACE. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1800\" onclick=\"get_ticket_and_populate_wrapper('1800'); return false;\" title=\"NETWORK_INTERFACE should accept wildcards\">#1800</a></span> Also fixed some incorrect statements in the section on multiple interfaces.  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Dec-16 19:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=19686\">[19686]</a></span>: NETWORK_INTERFACE accepts wildcards and interface names. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1800\" onclick=\"get_ticket_and_populate_wrapper('1800'); return false;\" title=\"NETWORK_INTERFACE should accept wildcards\">#1800</a></span> Condor no longer relies on DNS to figure out its IP address. Instead, it lists the network interfaces and chooses one using a similar algorithm to the one previously used to choose an IP from the IPs listed by DNS for the hostname.  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Feb-01 16:42", "status": "resolved", "created": "2010-Dec-09 16:23", "fixed_version": "2010-Dec-09 16:23", "broken_version": "v070500", "priority": "4", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "purdue", "visibility": "public", "notify": "dan@hep.wisc.edu", "due_date": ""}