{"id": 7741, "title": "Ticket #7741: Merge OAuth Credmon", "description": "<blockquote>\nNow that the code has matured and because upgrading with a separate credmon package is annoying (at best), let's merge the OAuth Credmon in to the main source tree and release it as a condor package.\n\n<p>To do:\n</p><ol>\n<li>Merge code under <code>src/condor_credd/condor_credmon_oauth</code>\n</li><li>Merge examples under <code>src/condor_examples</code>\n</li><li>Figure out how we want to run library code shared between the WSGI application and <code>condor_credmon_oauth</code> (put in <code>libexec</code> and modify <code>PYTHONPATH</code>?)\n</li><li>Add <code>CMakeLists.txt</code>\n</li><li>Update RPM/DEB specs\n</li></ol>\n\n<p><a class=\"external\" href=\"https://docs.google.com/document/d/1HQyfKIcG2Y209GgpdkhCzaZ2uMuWNMPCYkTmbxzwMcY/edit?usp=sharing\">Link to design doc</a></p></blockquote>", "remarks": "<blockquote>\n<em>2020-Aug-17 09:11:23 by jpatton:</em> <br/>\n\nThe code has been merged into <code>master</code> now, the biggest caveat right now being that it's only natively packaged in CentOS 7 (as \"condor-credmon-oauth\"). The necessary scripts and examples to get it running are still in the tarball (mostly under <code>$(LIBEXEC)</code>), at least with how we generate the tarball now.\n\n<p>Next steps are to document and figure out how to package for other systems. The latter will require figuring out how to test the credmon using Python 3.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-23 14:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61331\">[61331]</a></span>: Fix a couple of bugs related to the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LocalCredmon\" title=\"Local Credmon\">LocalCredmon</a></span> <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-09 06:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61244\">[61244]</a></span>: Add a ton of credmon docs for <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-31 10:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61172\">[61172]</a></span>: Fix stalled oauth credmon after condor_off <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span> The subprocess that held the scan_tokens loop now returns when SIGTERM/SIGINT/SIGQUIT is caught by the parent process rather than keep running and keeping the parent process alive.\u00a0[...]\n (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-28 07:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61141\">[61141]</a></span>: Fix credmon to work with Python 3 <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-25 07:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60525\">[60525]</a></span>: Fix OAuthCredmonWebserver for newer requests-oauthlib <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-17 08:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60466\">[60466]</a></span>: Merge the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span> OAuth <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CredMon\" title=\"Cred Mon\">CredMon</a></span> into HTCondor <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span> - Currently hardcoded to use Python 2 in the daemon scripts - Shared Python code is now stored in $(LIBEXEC)/credmon - Daemon scripts are now installed to $(SBIN) - RPM (builds on CentOS 7 only at the moment) is called \"condor-credmon-oauth\" - RPM\u00a0[...]\n (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-14 14:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60461\">[60461]</a></span>: Typoed the version comparison <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-14 11:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60459\">[60459]</a></span>: Remove oauth credmon from buildroot for non-EL7 <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-14 06:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60449\">[60449]</a></span>: Don't move files to buildroot unless packaging <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-13 15:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60448\">[60448]</a></span>: Force python2 in shebang for condor_credmon_oauth for now <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-13 07:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60445\">[60445]</a></span>: More package naming fixes <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-13 07:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60444\">[60444]</a></span>: Do not use -n for credmon package <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-13 07:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60443\">[60443]</a></span>: Fix ordering of symlink args <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-13 06:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60442\">[60442]</a></span>: Point symlinks to installed paths, not buildroot <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-12 10:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60434\">[60434]</a></span>: Fix another typo <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-12 08:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60432\">[60432]</a></span>: Fix example directory path <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-11 16:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60423\">[60423]</a></span>: Standardize credmon naming and support previous configs <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span> - Dropped scitokens and other naming of files (except for local issuer) in favor of \"condor_credmon_oauth\" everywhere. - Updated SRPM spec to support previous configurations of the credmon  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-04 07:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60332\">[60332]</a></span>: Fix rpm spec <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-04 07:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60331\">[60331]</a></span>: Fix cmake/rpm spec <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-04 05:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60329\">[60329]</a></span>: Remove redundant oauth credmon spec file <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-03 07:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60307\">[60307]</a></span>: Add condor-credmon-oauth to RPM <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span> Created new RPM package: condor-credmon-oauth This package installs: - the Python credmon package into LIBEXEC - the WSGI script into /var/www/wsgi-scripts/scitokens-credmon - the credmon script into SBIN - a readme file into /var/lib/condor/oauth_credentials/README.credentials\u00a0[...]\n (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-03 06:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60306\">[60306]</a></span>: Update example credmon config to use metaknob <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-03 06:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60304\">[60304]</a></span>: Install oauth credmon, use libexec <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span> Added CMakeLists.txt to install condor_credmon_oauth and scitokens_credential_producer to SBIN and put everything else in LIBEXEC. Updated Python scripts to use credmon library out of LIBEXEC.  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-20 16:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60158\">[60158]</a></span>: Initial copy of oauth credmon into src <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7741\" title=\"Merge OAuth Credmon\">#7741</a></span>  (By Jason Patton )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Oct-12 14:47", "status": "docpending", "created": "2020-Jul-20 07:32", "fixed_version": "2020-Jul-20 07:32", "broken_version": "", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "zmiller", "derived_from": "", "creator": "jpatton", "rust": "", "customer_group": "scitokens", "visibility": "public", "notify": "", "due_date": ""}