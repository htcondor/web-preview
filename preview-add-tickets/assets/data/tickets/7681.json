{"id": 7681, "title": "Ticket #7681: Use externals from EPEL for RPMs", "description": "<blockquote>\nStreamline the build process. Currently, we build HTCondor twice during the build process. Once, for the tarballs and once for the packaged build. The externals are also built twice during this process. Reorganize the build process for Linux builds. (MacOSX and Windows builds should be untouched.)\n\n<p></p><ul>\n<li>Split out the externals and have them built separately and available to the build via the package manager\n</li><li>Build HTCondor packages\n</li><li>Extract HTCondor binaries from the packages for the tarball\n</li><li>Use patchelf to set RPATHs as appropriate\n</li><li>Create the tarball\n</li><li>The tarball is tested\n</li></ul>\n\n<p>In this scenario, HTCondor is built once. The externals are pre-built. We only have 1 set of binaries to test.\n\n</p><p>Design Document: <a class=\"external\" href=\"https://docs.google.com/document/d/1GYNf_Hiya-dwWgGuVxeAQcBm--6psTmP9Vwxek9woQw/edit\">https://docs.google.com/document/d/1GYNf_Hiya-dwWgGuVxeAQcBm--6psTmP9Vwxek9woQw/edit</a></p></blockquote>", "remarks": "<blockquote>\n<em>2020-Jul-21 15:58:12 by tannenba:</em> <br/>\n\n<strong>Design Review</strong>\n\n<p>Questions / issues inserted into the above linked design document.  Please edit design doc to address these, thanks.\n\n</p><p></p><hr/>\n<em>2020-Aug-07 16:47:13 by tim:</em> <br/>\n\nSee <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7430\" title=\"Update condor.spec file to be able to build on Amazon Linux 2\">#7430</a></span> for review comments to implement\n\n<p></p><hr/>\n<em>2020-Oct-21 13:16:29 by tim:</em> <br/>\n\nNeed to document new dependencies on EPEL.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"abandoned\" href=\"tktview?tn=7876\" title=\"Add explicit dependencies for shadow on Debian and Ubuntu\">#7876</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd explicit dependencies for shadow on Debian and Ubuntu</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-25 13:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61558\">[61558]</a></span>: Final build for 8.9.9 Includes version history for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>, <span class=\"ticket\"><a class=\"docpending\" href=\"tktview?tn=7557\" title=\"Log mapping failures when the URL contains a trailing slash\">#7557</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7843\" title=\"Add the ability to specify a custom remote Bosco install dir\">#7843</a></span>  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-09 08:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61456\">[61456]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) List dependencies for libraries that we dlopen on Debian/Ubuntu  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-08 18:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61453\">[61453]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) explicitly list all required libraries that we dlopen()  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-03 09:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61413\">[61413]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) /var/lock/condor/local needs special treatment too  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-03 08:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61412\">[61412]</a></span>: Revert \"(<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Ensure /var/lock/condor has right ownership when it exists\" This reverts commit 1edfff21e3e6f3fe5e483bcb5fe961647b0682ed.  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-02 17:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61407\">[61407]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Get rid of condor-external-libs  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-02 14:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61399\">[61399]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Ensure /var/lock/condor has right ownership when it exists  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-01 15:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61390\">[61390]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Only create condor_shadow_s on CentOS7  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-01 13:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61388\">[61388]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) small-shadow only needed for CentOS7  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-01 08:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61383\">[61383]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Provide small-shadow package for compatibility  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-28 21:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61359\">[61359]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Adjustments to build for OSG  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-25 16:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61340\">[61340]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) condor-boinc is just a UW thing  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-24 08:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61334\">[61334]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Let's not modify configure_uw just yet  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-24 05:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61333\">[61333]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Fix up shared libraries that we dlopen  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-22 19:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61330\">[61330]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Need empty condor-externals for seamless upgrade  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-22 15:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61328\">[61328]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Adjust Ubuntu20 build  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-22 15:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61327\">[61327]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) condor.spec file adjustments - Add obsoletes for discountinued packages (cream, small-shadow, externals) - Add requirement for python36-requests on EL7 for file transfer plugins - Add requirement for condor-boinc package  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-22 14:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61326\">[61326]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Add dummy externals package to help yum find the blahp  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-21 22:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61325\">[61325]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Add cmake3 to AmazonLinux2 container  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-21 22:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61324\">[61324]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Debian and Ubuntu adjustments  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-21 22:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61323\">[61323]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) clean up spec, build on CentOS8 and Fedora  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-11 17:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61281\">[61281]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) This franks on CentOS7  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-09 18:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61256\">[61256]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Drop 32-bit CentOS build  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-26 10:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61161\">[61161]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Remove cgroup conditional  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-26 09:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61160\">[61160]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Remove systemd conditional  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-25 16:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60546\">[60546]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Add patchelf into build containers  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-14 13:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60462\">[60462]</a></span>: Revert \"(<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Fix RPM warning interactive.sub execute bit\" This reverts commit c970fde5a8a4e03159789957b47174af508a20e3.  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-04 08:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60335\">[60335]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Fix RPM warning interactive.sub execute bit  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-04 08:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60333\">[60333]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Build proper RPMs  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jun-26 05:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60003\">[60003]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7681\" title=\"Use externals from EPEL for RPMs\">#7681</a></span>) Clean up some warnings from rpmbuild  (By Tim Theisen )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Oct-25 10:54", "status": "resolved", "created": "2020-Jun-12 08:14", "fixed_version": "2020-Jun-12 08:14", "broken_version": "", "priority": "1", "subsystem": "Packaging", "assigned_to": "tim", "derived_from": "", "creator": "tim", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}