{"id": 933, "title": "Ticket #933: PER_JOB_HISTORY_DIR semantics changed inappropriately in 7.4.0", "description": "<blockquote>\n<span class=\"subsection\"><h3>Summary </h3></span>\nIn 7.4.0 (or 7.3.x I suppose), the semantics of PER_JOB_HISTORY_DIR was inappropriately changed in a way that could easily result in all disk space on a worker node filling up, and it causes problems for OSG's Gratia accounting service.\n\n<p><span class=\"subsection\"></span></p><h3>Details </h3>\nIn Condor 7.2.x and 7.4.x, PER_JOB_HISTORY_DIR was defined specifically as affecting the schedd. From the manual in 7.4.0:\n\n<p></p><div class=\"blockquote\">\n<table width=\"95%\"><tbody><tr><td>\u00a0</td><td>\n  \nPER_JOB_HISTORY_DIR\n\nIf set to a directory writable by the Condor user, when a job leaves the condor_schedd's queue, a copy of its ClassAd will be written in that directory. The files are named ``history.'' with the job's cluster and process number appended. For example, job 35.2 will result in a file named ``history.35.2''. Condor does not rotate or delete the files, so without an external entity to clean the directory it can grow very large. This option defaults to being unset. When not set, no such files are written.\n</td></tr></tbody></table></div>\n\n\n<p>It's reasonable to think that this could be in a configuration file shared across a site since it only affects the schedd--it has no effect on a startd.\n\n</p><p>Unfortunately, when this is set in Condor 7.4.0, it will also make the startd leave job classads in the PER_JOB_HISTORY_DIR. A site is unlikely to expect this, and it will eventually fill up the disk on an execute node with job classads. This change in the semantics of PER_JOB_HISTORY_DIR is bad and undocumented.\n\n</p><p>I'm not quite sure what should be done, but I think that when 7.4.1 is released, PER_JOB_HISTORY_DIR shouldn't affect the startd by default. That is, we should revert this change in semantics as soon as possible. Perhaps there should be a STARTD_PER_JOB_HISTORY_DIR instead?\n\n</p><p>This affects OSG sites because we use PER_JOB_HISTORY_DIR to collect job accounting data for our Gratia accounting service, and we are now getting extra history files that are not cleaned up.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Nov-11 19:37:34 by matt:</em> <br/>\n\nSeems a better solution would be to specify SCHEDD.PER_JOB_HISTORY_DIR when you just want a per job history dir from only the Schedd.\n\n<p></p><hr/>\n<em>2009-Dec-03 16:54:04 by gthain:</em> <br/>\n\nFor 7.4.1 and on, I've changed it so you must set STARTD_PER_JOB_HISTORY_DIR to get this.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Dec-03 16:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=16483\">[16483]</a></span>: Add STARTD_PER_JOB_HISTORY knob, per <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=933\" title=\"PER_JOB_HISTORY_DIR semantics changed inappropriately in 7.4.0\">#933</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-31 13:41", "status": "resolved", "created": "2009-Nov-11 15:29", "fixed_version": "2009-Nov-11 15:29", "broken_version": "v070400", "priority": "2", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "", "creator": "roy", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "matt@cs.wisc.edu", "due_date": ""}