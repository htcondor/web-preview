{"id": 3390, "title": "Ticket #3390: MPI Parallel Universe jobs fail when USE_NFS=True - Developer Series", "description": "<blockquote>\nThis is the developer series version of Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3361\" onclick=\"get_ticket_and_populate_wrapper('3361'); return false;\" title=\"MPI Parallel Universe jobs fail when USE_NFS=True\">#3361</a></span>. We already have a quick fix for the stable series.\n\n<p>From Todd in <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3361\" onclick=\"get_ticket_and_populate_wrapper('3361'); return false;\" title=\"MPI Parallel Universe jobs fail when USE_NFS=True\">#3361</a></span>\n</p><div class=\"blockquote\">\n<table width=\"95%\"><tbody><tr><td>\u00a0</td><td>\n  \nThe problem is a protocol mismatch: the remote I/O client in the vanilla starter does not understand all the potential file mappings that the remote I/O server in the shadow may return.  Behold from /src/condor_starter.V6.1/io_proxy_handler.cpp:\n</td></tr></tbody></table></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">result = REMOTE_CONDOR_get_file_info_new(path,url);\nif(result==0) {\n  dprintf(D_SYSCALLS,\"Directed to use url %s\\n\",url);\n  ASSERT( strlen(url) &lt; CHIRP_LINE_MAX );\n  if(!strncmp(url,\"remote:\",7)) {\n  strncpy(path,url+7,CHIRP_LINE_MAX);\n} else if(!strncmp(url,\"buffer:remote:\",14)) {\n  strncpy(path,url+14,CHIRP_LINE_MAX);\n} else {\n  EXCEPT(\"File %s maps to url %s, which I don't know how to open.\\n\",path,url);\n}\n</pre></div>\n\n\n<p></p><div class=\"blockquote\">\n<table width=\"95%\"><tbody><tr><td>\u00a0</td><td>\n  \nSo if USE_NFS=True, the remote I/O server in the shadow will return a mapping URL that starts with local:, and the remote I/O client in the starter only understands remote: and buffer:remote.\n\nPlan for developer series fix: For the development branch moving forward, we should either teach the remote I/O client how to handle all the possible server responses such as local:, or rip out the possibility for local: responses from the server.\n</td></tr></tbody></table></div>\n</blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2013-Mar-05 10:58:27 by johnkn:</em> <br/>\n\nBulk change of target version from v070904 to v070905 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2013-Apr-15 11:27:00 by samf:</em> <br/>\n\nI went down the route of ripping stuff out of the code, so I removed a lot of functionality that is completely useless in non-Standard Universe. I would have had to teach the code how to handle <code>local</code>, <code>special</code>, <code>fetch</code>, <code>compress</code>, and <code>append</code>. That would have entailed prepending a string to the file path (in <code>pseudo_ops.cpp</code>) and then removing it (in <code>io_proxy_handler.cpp</code>). So instead of adding strings just to remove them, I removed the code that does so. Since the code already added <code>buffer:remote:</code> and then removed it (without doing anything else), I removed that part of the code. The code did pass the tests in BaTLab.\n\n<p></p><hr/>\n<em>2013-Apr-15 14:25:19 by tlmiller:</em> <br/>\n\nThis looks safe to me, as long as you note that the output from 'lookup' will change.  (Would be good to check, first, although it seems like it's handling 'condor_chirp lookup'.)</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3735\" onclick=\"get_ticket_and_populate_wrapper('3735'); return false;\" title=\"chirp wire protocol incompatible between 7.8.x and 8.0.x\">#3735</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nchirp wire protocol incompatible between 7.8.x and 8.0.x</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-18 11:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35455\">[35455]</a></span>: edit of 7.9.6 version history item for <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3390\" onclick=\"get_ticket_and_populate_wrapper('3390'); return false;\" title=\"MPI Parallel Universe jobs fail when USE_NFS=True - Developer Series\">#3390</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-17 15:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35445\">[35445]</a></span>: Updated Version History formatting. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3390\" onclick=\"get_ticket_and_populate_wrapper('3390'); return false;\" title=\"MPI Parallel Universe jobs fail when USE_NFS=True - Developer Series\">#3390</a></span>.  (By Samuel Friedman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-17 15:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35444\">[35444]</a></span>: Updating Version History file for Tickets <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3535\" onclick=\"get_ticket_and_populate_wrapper('3535'); return false;\" title=\"Fetching user priorities from negotiator takes a long time\">#3535</a></span> and <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3390\" onclick=\"get_ticket_and_populate_wrapper('3390'); return false;\" title=\"MPI Parallel Universe jobs fail when USE_NFS=True - Developer Series\">#3390</a></span>.  (By Samuel Friedman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-29 15:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35292\">[35292]</a></span>: Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3390\" onclick=\"get_ticket_and_populate_wrapper('3390'); return false;\" title=\"MPI Parallel Universe jobs fail when USE_NFS=True - Developer Series\">#3390</a></span>. Removed calls to unneeded functionality in the non-Standard Universe that was copied over from Standard Universe. Now, USE_NFS=True is safe to use for non-Standard Universe jobs. ===VersionHistory:Pending===  (By Samuel Friedman )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Aug-04 14:54", "status": "defer", "created": "2012-Dec-19 11:15", "fixed_version": "2012-Dec-19 11:15", "broken_version": "v070902", "priority": "5", "subsystem": "Daemons", "assigned_to": "samf", "derived_from": "#3361", "creator": "samf", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "samf@cs.wisc.edu, tannenba@cs.wisc.edu, tstclair@redhat.com, matt@cs.wisc.edu,pcouvare@caltech.edu", "due_date": ""}