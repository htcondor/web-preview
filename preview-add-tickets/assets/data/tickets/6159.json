{"id": 6159, "title": "Ticket #6159: Keep GridJobId in in job ad on completion and removal", "description": "<blockquote>\nFor many scheduler types, when a grid universe job enters a terminal state (COMPLETED or REMOVED), the gridmanager clears the <span class=\"quote\">GridJobId</span> attribute in the job ad. This makes it impossible to know where the job ran by looking at the history file. We should change it so that <span class=\"quote\">GridJobId</span> is preserved when a job leaves the queue.\n\n<p><span class=\"subsection\"></span></p><h3>Original Feature Request</h3>\n\n<p>Currently, when the Gridmanager sees that a job it's been tracking has completed, it clears out the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GridJobId\" title=\"Grid Job Id\">GridJobId</a></span> attribute. This makes it difficult to troubleshoot issues that have occurred with jobs in the past. Could we store the previous <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GridJobId\" title=\"Grid Job Id\">GridJobId</a></span> in a classad attribute, say <code>LastGridJobId</code>?</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Aug-18 16:05:01 by jfrey:</em> <br/>\n\nThere's also a bug in <code>mark_idle()</code> (executed on schedd startup) that can cause the schedd to not remove a REMOVED grid job from the queue if <code>GridJobId</code> is set. The function needs to also check whether <code>Managed</code> is set to <code>ScheddDone</code>. The effects of this are minor, as the job will leave the queue the next time job policy expressions are evaluated.\n\n<p></p><hr/>\n<em>2020-Oct-13 16:15:39 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Looks good to me.\n\n</p><p></p><hr/>\n<em>2020-Oct-13 16:17:27 by tlmiller:</em> <br/>\n\nI don't know that <span class=\"chng\"><a href=\"chngview?cn=60482\">[60482]</a></span> warrants a mention in the release notes, but <span class=\"chng\"><a href=\"chngview?cn=60481\">[60481]</a></span> might.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-19 22:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61525\">[61525]</a></span>: Docs for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GridJobId\" title=\"Grid Job Id\">GridJobId</a></span> remaining in job ad on completion. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6159\" onclick=\"get_ticket_and_populate_wrapper('6159'); return false;\" title=\"Keep GridJobId in in job ad on completion and removal\">#6159</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-19 09:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60482\">[60482]</a></span>: In mark_idle(), don't wait for gridmanager when it'll ignore the job <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6159\" onclick=\"get_ticket_and_populate_wrapper('6159'); return false;\" title=\"Keep GridJobId in in job ad on completion and removal\">#6159</a></span> The gridmanager ignores jobs with Managed=\"ScheddDone\", and the jobs may have <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GridJobId\" title=\"Grid Job Id\">GridJobId</a></span> set. So the schedd shouldn't wait for the gridmanager to do anything further with these jobs.\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-19 09:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60481\">[60481]</a></span>: Keep <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GridJobId\" title=\"Grid Job Id\">GridJobId</a></span> for completed and removed grid jobs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6159\" onclick=\"get_ticket_and_populate_wrapper('6159'); return false;\" title=\"Keep GridJobId in in job ad on completion and removal\">#6159</a></span> Don't clear <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GridJobId\" title=\"Grid Job Id\">GridJobId</a></span> from the job ad when a grid job enters COMPLETED or REMOVED status. This makes it easier for people to track where the job ran after it leaves the queue. We already did this for some grid job types.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Oct-19 23:04", "status": "resolved", "created": "2017-Feb-23 09:54", "fixed_version": "2017-Feb-23 09:54", "broken_version": "", "priority": "2", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "#4555", "creator": "blin", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "blin@cs.wisc.edu", "due_date": ""}