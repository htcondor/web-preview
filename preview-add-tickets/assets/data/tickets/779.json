{"id": 779, "title": "Ticket #779: CMake and Directory restructuring Port", "description": "<blockquote>\nThe following bug is used for tracking updates and changes made for CMake port, and directory restructuring.\n\n<p>For more details see: <span class=\"wiki\"><a href=\"wiki?p=BuildModernization\" title=\"Build Modernization\">BuildModernization</a></span>\n\n</p><p><span class=\"section\"></span></p><h2>Goals and Objectives </h2>\nThe goal of updating the condor build mechanism is far more reaching then using the latest wiz-bang tool to build code, and is meant to address the following issues:\n\n<p></p><ul>\n<li><em>Build consistency across platforms (Including Windows):</em> Currently Imake does a good job for build consistency across *nix variants, however there is an entirely different set of mechanics for dealing with builds on Windows, which few people really understand.  To make matters a bit more confusing, is that the mechanism by which we build &amp; test on Windows is quite non-standard which presents an issue as condor becomes a more open source project. This plurality causes several issues in maintaining two desperate build files, with completely different mechanisms.  It would be in the best interests for the group in the long run to employ a single build mechanism which has support on all condor platforms.\n\n<p></p></li><li><em>Support for unit testing within the build:</em> For the purposes of testing it is advantageous to have a build tool which supports running automated unit tests as part of a \"unit\" build, with a minimal amount of external overhead.\n\n<p></p></li><li><em>Packaging:</em> Many build systems provide automated packaging for it's native environment.  This can be highly useful as it eliminates and automates custom build steps and scripts and makes it easier to maintain.  Having this requirement can reduce the overhead on condor developers and allow them to focus on bug fixes and new features.  It also allows flight worthy to get out of the packaging business and simplifies the consumption for downstream folks.\n</li></ul>\n\n<p><span class=\"section\"></span></p><h2>Milestones </h2>\n\n<p><strong>[Completed]</strong> Stage 1: Feasibility 9/25/09\n\n</p><p></p><pre>\tEstimated: \t~1 Month - likely less\n\tTime Elapsed: \t~1.2 Months\n</pre>\n\n<p></p><pre>\tX - Setup existing environment build and analyze.\n\tX - Create full configuration (auhtmlonf-cmake)\n\tX - Build for linux and Windows\n\tX - Simplify build files (done through cmake macros and updated file extensions .unix .linux .window)\n\tX - Develop plan for dealing with externals\n\t\t- Currently the plan is to stage uw-externals prior to building and update include and link paths to this loc by default.  (everything is external)\n\t\t- This greatly simplifies the build process and cleans up the questions of who does \"what\" \"when\"\n\tX - Build all code with c++ compiler cleanup non-ansi C-code\n\tX - Analyze packaging options\n\t    CPack will likely meet our needs and eliminate separate steps\n\tX - Eliminate unnecessary linkage where possible.\n</pre>\n\n<p></p><pre>    tools\n        &lt;tbd&gt;...\n    daemons\n        procd ...\n    libs\n        ccb\n\tcedar\n\tclassad_analysis\n\tclassad.old\n\tdaemon_client\n\tdaemon_core\n\tprivsep\n\tprocapi\n\tsysapi\n\ttt\n\tutils\n    tests\n        &lt;tbd&gt;\n    include\n        &lt;previous condor_include&gt;\n    scripts\n        &lt;tbd&gt;\n    examples\n        &lt;tbd&gt;\n    &lt;release_dir&gt;\n        ...\n</pre>\n\n<p></p><pre>\tAnalysis:\n</pre>\n\n<p></p><pre>\tI was surprised at the levels of \"over complexity\" within the builds and code dependencies.  So in my work going forwards, my primary goal is to simplify.\n</pre>\n\n<p></p><pre>\tI believe that a cleaner structure would help for future open source progress.  IMHO it should easy for a developer / researcher to obtain the source, build, and install a package.  Also the directory structure\nshould be easily to follow and navigate.\n</pre>\n\n<p></p><hr/>\n<strong>[In Progress as of 11/14/09] Stage 2: Evaluation, Adoption, &amp; Continuation</strong>\n\n<p></p><pre>\tEstimated: \t~1 - ? Months\n\tTime Elapsed: \t2 Months (Near completion)\n</pre>\n\n<p></p><pre>\tX - Cleanup and cruft and provide tracking branch for UW. (origin/CMAKE)\n\tX - Setup an wiki page ticket\n\tX - Have an evaluation with RedHat folks\n        X - Cleanup windows build, build against the latest sdk.\n        X - Full Parallel Build including externals [Windows]\n        - Setup Initial Packaging [In Progress]\n        - Have an eval with UW Folks [Next Week? 1/25/10]\n        - add checks for perl, awk, and flex (right now I believe it is assumed)\n</pre>\n\n<p></p><hr/>\n<strong>Stage 3: Full Parallel Build, Test, and Packaging (Last Month)</strong>\n\n<p></p><pre>        - Establish NMI auto-builds\n        - Verify all tests build and pass on all platforms (including windows)\n\t- Establish packaging using CPack for all platforms\n        - Setup Unit Testing w/CTest</pre>\n</blockquote>", "remarks": "<blockquote>\n<em>2009-Dec-12 00:00:44 by burnett:</em> <br/>\n\n&gt;&gt;&gt; X - Cleanup windows build, build against the latest sdk.\n\n<p>No more Windows 2000 support then?\n\n</p><p></p><hr/>\n<em>2009-Dec-14 07:35:04 by tstclair:</em> <br/>\n\nFrom emails which were sent around Win 2k will be punted for 7.5, as MSFT doesn't even support it any more.\n<hr/>\n<em>2010-Oct-20 15:59:08 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1041\" onclick=\"get_ticket_and_populate_wrapper('1041'); return false;\" title=\"Add *tools to cmake build\">#1041</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd *tools to cmake build</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=1042\" onclick=\"get_ticket_and_populate_wrapper('1042'); return false;\" title=\"Add config style packaging support cpack-&gt;cmake\">#1042</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd config style packaging support cpack-&gt;cmake</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1064\" onclick=\"get_ticket_and_populate_wrapper('1064'); return false;\" title=\"Convert *gahps to cmake build\">#1064</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nConvert *gahps to cmake build</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1065\" onclick=\"get_ticket_and_populate_wrapper('1065'); return false;\" title=\"Parallelize the externals Builds (cmake branch)\">#1065</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nParallelize the externals Builds (cmake branch)</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1080\" onclick=\"get_ticket_and_populate_wrapper('1080'); return false;\" title=\"Handle * packaging using CPack for cmake branch\">#1080</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nHandle * packaging using CPack for cmake branch</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1241\" onclick=\"get_ticket_and_populate_wrapper('1241'); return false;\" title=\"Cleanup stduniv to be linux only\">#1241</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nCleanup stduniv to be linux only</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1248\" onclick=\"get_ticket_and_populate_wrapper('1248'); return false;\" title=\"CMake staging\">#1248</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nCMake staging</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1373\" onclick=\"get_ticket_and_populate_wrapper('1373'); return false;\" title=\"ifndef WANT_LEASE_MANAGER don't run those tests.\">#1373</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nifndef WANT_LEASE_MANAGER don't run those tests.</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Nov-21 21:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=19479\">[19479]</a></span>: Squashed commit of the following: commit be871d84f7972ee4fc84e6298c30089eb89e466d Author: Timothy St. Clair &lt;tstclair@redhat.com&gt; Date: Sun Nov 21 16:09:54 2010 -0600\u00a0[...]\n (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Nov-15 14:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=19404\">[19404]</a></span>: Separate projects into solution folders. Currently all executables are in one folder. May be separated into daemons and tools in the future. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=779\" onclick=\"get_ticket_and_populate_wrapper('779'); return false;\" title=\"CMake and Directory restructuring Port\">#779</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Sep-20 14:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=19005\">[19005]</a></span>: Initial implementation of the WiX MSI dialogs to match old makemsi generated installer. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=779\" onclick=\"get_ticket_and_populate_wrapper('779'); return false;\" title=\"CMake and Directory restructuring Port\">#779</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Dec-10 15:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=16643\">[16643]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=779\" onclick=\"get_ticket_and_populate_wrapper('779'); return false;\" title=\"CMake and Directory restructuring Port\">#779</a></span>: Fix for auto-generated code dependencies.  (By Tim St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Dec-10 13:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=16640\">[16640]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=779\" onclick=\"get_ticket_and_populate_wrapper('779'); return false;\" title=\"CMake and Directory restructuring Port\">#779</a></span> Fixed last remaining windows build issues  (By Tim St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-30 15:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=16463\">[16463]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=998\" onclick=\"get_ticket_and_populate_wrapper('998'); return false;\" title=\"Removal of *_fix_*.h's and subsequent deps.\">#998</a></span> - removal of symbol poisoning code for open calls. This includes cleanup of namespace std issues, and updates to include standard headers.  (By Timothy St. Clair )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Nov-21 21:33", "status": "resolved", "created": "2009-Sep-25 13:47", "fixed_version": "2009-Sep-25 13:47", "broken_version": "v070500", "priority": "3", "subsystem": "Packaging", "assigned_to": "tstclair", "derived_from": "", "creator": "tstclair", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu, gthain@cs.wisc.edu", "due_date": "PARENT"}