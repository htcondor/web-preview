{"id": 293, "title": "Ticket #293: Boot script for Mac OS X", "description": "<blockquote>\nWe should distribute sample files for launching Condor at boot time under Mac OS X using the launchd service. This the the preferred why to start and stop daemons on Mac OS 10.4 and above. The files should take advantage of launchd features when appropriate, like automatic relaunching of condor_master if it doesn't exit cleanly.\n\n<p>Details on handling daemons in Mac OS X can be found at <a class=\"external\" href=\"http://developer.apple.com/technotes/tn2005/tn2083.html\">http://developer.apple.com/technotes/tn2005/tn2083.html</a></p></blockquote>", "remarks": "<blockquote>\n<em>2009-Aug-31 16:54:15 by cstruble:</em> <br/>\n\nUsing launchd with Condor is problematic with <code>condor_master</code> 's current behavior. According to the <code>launchd.plist</code> manual page:\n\n<p></p><div class=\"verbatim\">\n<pre>     A daemon or agent launched by launchd MUST NOT do the following in the\n     process directly launched by launchd:\n\n           o   Call daemon(3).\n           o   Do the moral equivalent of daemon(3) by calling fork(2) and\n               have the parent process exit(3) or _exit(2).\n\n     A daemon or agent launched by launchd SHOULD NOT do the following as a\n     part of their startup initialization:\n\n           o   Setup the user ID or group ID.\n           o   Setup the working directory.\n           o   chroot(2)\n           o   setsid(2)\n           o   Close \"stray\" file descriptors.\n           o   Change stdio(3) to /dev/null.\n           o   Setup resource limits with setrusage(2).\n           o   Setup priority with setpriority(2).\n           o   Ignore the SIGTERM signal.\n</pre></div>\n\n\n<p>When placing the relatively simple launchd description in <code>/Library/LaunchDaemons/condor.plist</code>\n\n</p><p></p><div class=\"verbatim\">\n<pre>\t&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n\t&lt;!DOCTYPE plist PUBLIC \"-//Apple Computer//DTD PLIST 1.0//EN\"\n\t\t\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;\n\t&lt;plist version=\"1.0\"&gt;\n\t&lt;dict&gt;\n\t\t&lt;key&gt;Label&lt;/key&gt;\n\t\t&lt;string&gt;condor&lt;/string&gt;\n\t\t&lt;key&gt;ProgramArguments&lt;/key&gt;\n\t\t&lt;array&gt;\n\t\t\t&lt;string&gt;/usr/local/condor/sbin/condor_master&lt;/string&gt;\n\t\t&lt;/array&gt;\n\t\t&lt;key&gt;RunAtLoad&lt;/key&gt;\n\t\t&lt;true/&gt;\n                &lt;key&gt;KeepAlive&lt;/key&gt;\n                &lt;true/&gt;\n\t&lt;/dict&gt;\n\t&lt;/plist&gt;\n</pre></div>\n\n\n<p>The <code>condor_master</code> is repeatedly terminated with SIGTERM shortly after spawning off other daemons.\n\n</p><p></p><hr/>\n<em>2009-Sep-18 10:40:12 by cstruble:</em> <br/>\n\nAfter reading the Condor documentation a bit more, changing <code>condor_master</code> to run in foreground mode (adding -f) seems to do the trick initially. A successful <code>/Library/LaunchDaemons/condor.plist</code> file on OS X 10.5 is\n\n<p></p><div class=\"verbatim\">\n<pre>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!DOCTYPE plist PUBLIC \"-//Apple Computer//DTD PLIST 1.0//EN\"\n        \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;\n    &lt;plist version=\"1.0\"&gt;\n    &lt;dict&gt;\n        &lt;key&gt;EnvironmentVariables&lt;/key&gt;\n        &lt;dict&gt;\n            &lt;key&gt;CONDOR_CONFIG&lt;/key&gt;\n            &lt;string&gt;/usr/local/condor/etc/condor_config&lt;/string&gt;\n        &lt;/dict&gt;\n        &lt;key&gt;Label&lt;/key&gt;\n        &lt;string&gt;condor&lt;/string&gt;\n        &lt;key&gt;ProgramArguments&lt;/key&gt;\n        &lt;array&gt;\n            &lt;string&gt;/usr/local/condor/sbin/condor_master&lt;/string&gt;\n            &lt;string&gt;-f&lt;/string&gt;\n        &lt;/array&gt;\n        &lt;key&gt;RunAtLoad&lt;/key&gt;\n        &lt;true/&gt;\n        &lt;key&gt;KeepAlive&lt;/key&gt;\n        &lt;true/&gt;\n    &lt;/dict&gt;\n    &lt;/plist&gt;\n</pre></div>\n\n\n<p>Note that the <code>CONDOR_CONFIG</code> environment variable needs to be set unless <code>condor_config</code> is in the <code>condor</code> user's home directory.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "todo", "last_change": "2010-Jan-31 13:21", "status": "new", "created": "2009-Mar-03 14:14", "fixed_version": "2009-Mar-03 14:14", "broken_version": "", "priority": "4", "subsystem": "Daemons", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}