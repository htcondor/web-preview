{"id": 6622, "title": "Ticket #6622: Configuration language conditionals behaving oddly?", "description": "<blockquote>\nGiven the following configuration fragment, the subsequent console log seems like it should not happen:\n\n<p></p><div class=\"verbatim\">\n<pre>CUDA_VISIBLE_DEVICES=$ENV(CUDA_VISIBLE_DEVICES:)\nif defined CUDA_VISIBLE_DEVICES\n    VALUE = \"defined\"\n    MACHINE_RESOURCE_INVENTORY_GPUs = /tmp/condor_gpu_discovery -device-list ...\nelse\n    VALUE = \"not-defined\"\n    MACHINE_RESOURCE_INVENTORY_GPUs = /tmp/condor_gpu_discovery -properties ...\n</pre></div>\n\n\n<p></p><hr/>\n<div class=\"verbatim\">\n<pre>[root@ip-172-31-1-111 config.d]# condor_config_val -v CUDA_VISIBLE_DEVICES VALUE\nNot defined: CUDA_VISIBLE_DEVICES\n # at: /etc/condor/config.d/01gpus.config, line 3\n # raw: CUDA_VISIBLE_DEVICES = $ENV(CUDA_VISIBLE_DEVICES:)\n\nVALUE = \"defined\"\n # at: /etc/condor/config.d/01gpus.config, line 5\n # raw: VALUE = \"defined\"\n\n[root@ip-172-31-1-111 config.d]# CUDA_VISIBLE_DEVICES=foo condor_config_val -v CUDA_VISIBLE_DEVICES VALUE\nCUDA_VISIBLE_DEVICES = foo\n # at: /etc/condor/config.d/01gpus.config, line 3\n # raw: CUDA_VISIBLE_DEVICES = $ENV(CUDA_VISIBLE_DEVICES:)\n\nVALUE = \"defined\"\n # at: /etc/condor/config.d/01gpus.config, line 5\n # raw: VALUE = \"defined\"\n</pre></div>\n\n\n<p></p><hr/>\nWe'd like to understand this behaviour.  It appears to be checking if CUDA_VISIBLE_DEVICES is in the hashtable, not if it's empty.  TJ suspects there's a whitespace trimming issue.\n\n<p></p><ul>\n<li><code>empty</code> as a conditional that either (a) is what we expect <code>defined = to be or (b) like =defined</code>, but succeeds on whitespace-only variables.\n</li><li><code>environment</code> as a conditional that combines the call to <code>$ENV()</code> -- with the unexpectedly required trailing colon -- with the <code>defined</code> / <code>empty</code> conditional.\n</li><li>Changing <code>$ENV()</code> to not return UNDEFINED (but rather the empty string), or adding another expansion that behaves that way.\n</li><li>something else I don't recall right ATM.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "incident", "last_change": "2018-Mar-23 11:30", "status": "new", "created": "2018-Mar-23 11:30", "fixed_version": "2018-Mar-23 11:30", "broken_version": "v080609", "priority": "2", "subsystem": "Libs", "assigned_to": "johnkn", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, johnkn@cs.wisc.edu", "due_date": ""}