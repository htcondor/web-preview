{"id": 2447, "title": "Ticket #2447: EC2_GAHP fails to scale.", "description": "<blockquote>\nFrom Seo-Young Noh:\n\n<p></p><pre>  I am just writing to let you know what we have found at Fermilab while\n  submitting vms using condor-7.7.0-1.x86_64. condor-7.7.0-prelease given\n  to us a few months ago has some issue.\n</pre>\n\n<p></p><pre>  I tried to submit 20 vms to fermicloud using condor-7.7.0. At certain\n  point, all jobs shown in condor_q were turning their states from\n  \"running\" to \"held\". The log message shows that it is because of \"Unable\n  to read from accesskey file\". Accesskey file is of course readable;\n  otherwise vms could not be launched. Below are text captures for this\n  symptoms.\n</pre>\n\n<p></p><pre>  [rsyoung@fermicloud125 vm-submit]$ condor_q\n  -- Submitter: fermicloud125.fnal.gov\n</pre>\n\n<p></p><pre>   ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE\n   1.0   rsyoung         8/4  14:26   0+01:36:39 R  0   0.0\n   2.0   rsyoung         8/4  14:32   0+01:30:23 R  0   0.0\n   3.0   rsyoung         8/4  14:40   0+01:22:28 R  0   0.0\n   4.0   rsyoung         8/4  14:40   0+01:22:28 R  0   0.0\n   5.0   rsyoung         8/4  14:49   0+01:13:30 R  0   0.0\n   6.0   rsyoung         8/4  14:49   0+01:13:30 R  0   0.0\n   7.0   rsyoung         8/4  14:57   0+01:04:59 R  0   0.0\n   8.0   rsyoung         8/4  14:57   0+01:04:59 R  0   0.0\n   9.0   rsyoung         8/4  15:08   0+00:53:12 R  0   0.0\n  10.0   rsyoung         8/4  15:08   0+00:52:56 R  0   0.0\n  11.0   rsyoung         8/4  15:21   0+00:41:00 R  0   0.0\n  12.0   rsyoung         8/4  15:21   0+00:41:00 R  0   0.0\n  13.0   rsyoung         8/4  15:25   0+00:36:45 R  0   0.0\n  14.0   rsyoung         8/4  15:25   0+00:36:45 R  0   0.0\n  15.0   rsyoung         8/4  16:06   0+00:00:00 I  0   0.0\n  16.0   rsyoung         8/4  16:06   0+00:00:00 I  0   0.0\n</pre>\n\n<p></p><pre>  16 jobs; 2 idle, 14 running, 0 held\n  [rsyoung@fermicloud125 vm-submit]$\n</pre>\n\n<p></p><pre>  - I submitted some more, then they begun to turn their states to \"held\".\n</pre>\n\n<p></p><pre>  rsyoung@fermicloud125 vm-submit]$ condor_q\n</pre>\n\n<p></p><pre>   ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE\n   1.0   rsyoung         8/4  14:26   0+01:40:56 H  0   0.0\n   2.0   rsyoung         8/4  14:32   0+01:35:30 H  0   0.0\n   3.0   rsyoung         8/4  14:40   0+01:30:33 H  0   0.0\n   4.0   rsyoung         8/4  14:40   0+01:30:28 H  0   0.0\n   5.0   rsyoung         8/4  14:49   0+01:20:34 H  0   0.0\n   6.0   rsyoung         8/4  14:49   0+01:20:34 H  0   0.0\n   7.0   rsyoung         8/4  14:57   0+01:10:36 H  0   0.0\n   8.0   rsyoung         8/4  14:57   0+01:10:36 H  0   0.0\n   9.0   rsyoung         8/4  15:08   0+01:00:24 H  0   0.0\n  10.0   rsyoung         8/4  15:08   0+01:00:25 H  0   0.0\n  11.0   rsyoung         8/4  15:21   0+00:45:26 H  0   0.0\n  12.0   rsyoung         8/4  15:21   0+00:45:26 H  0   0.0\n  13.0   rsyoung         8/4  15:25   0+00:45:22 H  0   0.0\n  14.0   rsyoung         8/4  15:25   0+00:45:22 H  0   0.0\n  15.0   rsyoung         8/4  16:06   0+00:00:00 H  0   0.0\n  16.0   rsyoung         8/4  16:06   0+00:00:00 H  0   0.0\n  17.0   rsyoung         8/4  16:15   0+00:00:00 H  0   0.0\n  18.0   rsyoung         8/4  16:15   0+00:00:00 H  0   0.0\n</pre>\n\n<p></p><pre>  18 jobs; 0 idle, 0 running, 18 held\n  [rsyoung@fermicloud125 vm-submit]$\n</pre>\n\n<p></p><pre>  - The reason is same except one.\n</pre>\n\n<p></p><pre>  [rsyoung@fermicloud125 vm-submit]$ condor_q -held\n</pre>\n\n<p></p><pre>  -- Submitter: fermicloud125.fnal.gov : &lt;131.225.155.72:45210&gt; :\n  fermicloud125.fnal.gov\n   ID      OWNER           HELD_SINCE HOLD_REASON\n   1.0   rsyoung   8/4  16:12 Unable to read from accesskey file\n   2.0   rsyoung         8/4  16:12 Unable to read from accesskey file\n   3.0   rsyoung         8/4  16:15 Unable to read from accesskey file\n   4.0   rsyoung         8/4  16:15 Unable to read from accesskey file\n   5.0   rsyoung         8/4  16:14 Unable to read from accesskey file\n   6.0   rsyoung         8/4  16:14 Unable to read from accesskey file\n   7.0   rsyoung         8/4  16:13 Unable to read from accesskey file\n   8.0   rsyoung         8/4  16:13 Unable to read from accesskey file\n   9.0   rsyoung         8/4  16:15 Unable to read from accesskey file\n  10.0   rsyoung         8/4  16:15 Unable to read from accesskey file\n  11.0   rsyoung         8/4  16:12 Unable to read from accesskey file\n  12.0   rsyoung         8/4  16:12 Unable to read from accesskey file\n  13.0   rsyoung         8/4  16:16 Unable to read from accesskey file\n  14.0   rsyoung         8/4  16:16 Unable to read from accesskey file\n  15.0   rsyoung         8/4  16:11 curl_easy_perform() failed (6):\n  16.0   rsyoung         8/4  16:11 Unable to read from accesskey file\n  17.0   rsyoung         8/4  16:15 Unable to read from accesskey file\n  18.0   rsyoung         8/4  16:15 Unable to read from accesskey file\n</pre>\n\n<p></p><pre>  18 jobs; 0 idle, 0 running, 18 held\n  [rsyoung@fermicloud125 vm-submit]$\n</pre>\n\n<p></p><pre>  Please let me know if you need further more information.\n</pre>\n\n<p></p><hr/>\nThere were a few additional mails back and forth, which can be summarized as \"logging in the EC2 GAHP was broken\".  That should /not/ be true for the build from the head of V7_7-ec2_x509-branch that I just sent Fermi, cc'ing JaimeF.\n\n<p></p><hr/>\n<span class=\"subsection\"><h3>Milestones </h3></span>\n\n<p></p><ul>\n<li>Jaime will investigate to see how serious a problem this is. <strong>[DONE]</strong>\n</li><li>Fix problem. <strong>[DONE]</strong>\n</li><li>Give updated binaries to Fermi for testing</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Sep-12 11:32:56 by jfrey:</em> <br/>\n\nThere's a file descriptor leak in readShortFile() and writeShortFile(). These functions never close the fd they open.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-12 12:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27159\">[27159]</a></span>: Fix file descriptor leak in ec2_gahp. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2447\" onclick=\"get_ticket_and_populate_wrapper('2447'); return false;\" title=\"EC2_GAHP fails to scale.\">#2447</a></span> ===VersionHistory:Complete===  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Sep-12 13:34", "status": "resolved", "created": "2011-Sep-08 14:52", "fixed_version": "2011-Sep-08 14:52", "broken_version": "v070700", "priority": "2", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "#2150", "creator": "tlmiller", "rust": "", "customer_group": "fermi", "visibility": "public", "notify": "tlmiller@cs.wisc.edu matt@cs.wisc.edu tstclair@redhat.com", "due_date": "20110909"}