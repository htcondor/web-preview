{"id": 1469, "title": "Ticket #1469: On Windows, Condor does not always correctly identify file types", "description": "<blockquote>\nReported by \"Rob de Graaf &lt;r.degraaf@erasmusmc.nl&gt;\" on \"Condor-Users Mail List &lt;condor-users@cs.wisc.edu&gt;\" as a problem when running condor-g jobs.\n\n<p></p><div class=\"verbatim\">\n<pre>I'm having some problems running jobs on a remote windows pool..\n\nThe setup: Condor-G -&gt; GT5 resource w/ Condor LRMS -&gt; WinXP startd\n\nThe remote pool doesn't have a shared filesystem, so I use globusrsl in the condor-g submit file to tell the remote pool it has to use its own file transfer mechanism. It has separate queues (globus jobmanagers) for linux and windows jobs. The linux queue works well, but in the windows queue, jobs fail to execute at the startd:\n\n===============================================================\n06/18 22:22:08 Starting a VANILLA universe job with ID: 37.0\n06/18 22:22:09 Tracking process family by login \"condor-reuse-slot1\"\n06/18 22:22:09 IWD: C:\\Progra~1\\Condor\\execute\\dir_428\n06/18 22:22:09 Output file: C:\\Progra~1\\Condor\\execute\\dir_428\\_condor_stdout\n06/18 22:22:10 Error file: C:\\Progra~1\\Condor\\execute\\dir_428\\_condor_stderr\n06/18 22:22:10 Renice expr \"10\" evaluated to 10\n06/18 22:22:10 About to exec C:\\Progra~1\\Condor\\execute\\dir_428\\condor_exec.gass_cache/local/md5/32/4a5afa0e96a19fa2244e8dd70116ce/md5/f4/91c2ba79ec192a3e127340f8999f71/data\n06/18 22:22:10 GetExecutableAndArgumentsByExtention: failed to find extension *.gass_cache/local/md5/32/4a5afa0e96a19fa2244e8dd70116ce/md5/f4/91c2ba79ec192a3e127340f8999f71/data in the registry (last-error =\n2).\n06/18 22:22:10 Create_Process(): Failed to find an executable for extension *.gass_cache/local/md5/32/4a5afa0e96a19fa2244e8dd70116ce/md5/f4/91c2ba79ec192a3e127340f8999f71/data\n06/18 22:22:10 ERROR: C:\\Progra~1\\Condor\\execute\\dir_428\\condor_exec.gass_cache\\local\\md5\\32\\4a5afa0e96a19fa2244e8dd70116ce\\md5\\f4\\91c2ba79ec192a3e127340f8999f71\\data.exe is not a valid Windows executable\n06/18 22:22:10 ERROR \"Create_Process(C:\\Progra~1\\Condor\\execute\\dir_428\\condor_exec.gass_cache/local/md5/32/4a5afa0e96a19fa2244e8dd70116ce/md5/f4/91c2ba79ec192a3e127340f8999f71/data,, ...) failed: \" at line\n530 in file ..\\src\\condor_starter.V6.1\\os_proc.cpp\n06/18 22:22:10 ShutdownFast all jobs.\n===============================================================\n\nThe gass_cache part should not be there.. if I understand correctly, condor-g uses gass internally to transfer files to the gt5 resource, but once they are there and a condor_submit is generated, condor's own file transfer mechanism kicks in and the startd should never see the cache url? I've checked to make sure the executable is transferred to Condor\\execute\\dir_pid\\condor_exec.exe on the WinXP startd, and it is.\n\nHow can I make this work?\n\nTIA, Rob\n</pre></div>\n\n\n<p>Part of the problem, as far as the Windows file name handling part is concerned, is that the way in which the file's extension is extracted, does not properly check for invalid characters in the file extension itself.  For instance '/' is not a valid character in a file extension (or filename, for that matter).\n\n</p><p>The proper fix for this part would be to check for the following reserved characters:\n\n</p><p></p><ul>\n<li>&lt; (less than)\n</li><li>&gt; (greater than)\n</li><li>: (colon)\n</li><li>\" (double quote)\n</li><li>/ (forward slash)\n</li><li>\\ (backslash)\n</li><li>| (vertical bar or pipe)\n</li><li>? (question mark)\n</li><li>* (asterisk)\n</li><li>Integer value zero, sometimes referred to as the ASCII NUL character.\n</li><li>Characters whose integer representations are in the range from 1 through 31.\n</li><li>Any other character that the target file system does not allow.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Jun-19 04:29:41 by burnett:</em> <br/>\n\nAs a temporary solution is setting <code>ALLOW_SCRIPTS_TO_RUN_AS_EXECUTABLES</code> to <code>FALSE</code> on the Windows machines will tell Condor to ignore it's ability to detect a file type, and just treat it as a blain old Windows binary.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "defect", "last_change": "2013-Jan-28 15:29", "status": "new", "created": "2010-Jun-19 04:25", "fixed_version": "2010-Jun-19 04:25", "broken_version": "v070500", "priority": "5", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "burnett", "rust": "", "customer_group": "users", "visibility": "public", "notify": "ben.burnett@uleth.ca", "due_date": ""}