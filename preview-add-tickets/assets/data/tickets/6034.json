{"id": 6034, "title": "Ticket #6034: Work around my_popenv error sensitivity.", "description": "<blockquote>\nWhen <code>condor_submit_dag</code> calls <code>condor_submit</code>, it logs the error stream.  One of users noticed a new warning in this log, which came from the following new line in the new default base Condor config:\n\n<p></p><div class=\"verbatim\">\n<pre>include ifexist command into $(LOCAL_CONFIG_DIR)/49ec2-instance.config : \\\n        /etc/condor/config.d/49ec2-instance.sh\n</pre></div>\n\n\n<p>The include-command syntax invokes my_popenv(), which will print the warning; the <code>ifexist</code> does not suppress warning messages (as you might expect).  Although we suspect checking for existing won't have any false negatives (that a command which doesn't exist can still be executed), rather than worry about that and redo the my_popenv() plumbing, we decided it would better if we could move this line out of the base condor config and into a config file supplied by the EC2 package.\n\n</p><p>The reason for not doing that in the first place was that <code>49ec2-instance.config</code> may download new configuration files, which would be ignored if they appear after processing of the config directory began.  TJ pointed out an escape hatch: the config directories, plural, are processed one at a time, so that a script run from, say, <code>/etc/condor/config.d/49ec2-instance.config</code> could populate <code>/etc/condor/config.d/dynamic</code> and the config system would pay attention.  However, we can't change the config directories list from a config directory file.\n\n</p><p>Therefore, the plan is to remove the problematic line from the default base config file, but change the default config directories to include config.d/dynamic (the config directories aren't searched recursively).  To avoid warnings, we'll also alter the packages (or condor_install, for the tarballs) to ensure that directory exists at install time.  Finally, the EC2 RPM (no deb yet, IIRC) will be adjusted to include the problematic line in config.d/49ec2-instance.config.\n\n</p><p>See <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5787\" onclick=\"get_ticket_and_populate_wrapper('5787'); return false;\" title=\"Create condor-ec2 package to simplify use of HTCondor in the cloud.\">#5787</a></span>.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Dec-01 14:37:14 by tlmiller:</em> <br/>\n\nTJ points out that the hard-coded path to the script in the problematic config line should /also/ be <code>$(LOCAL_CONFIG_DIR)</code>.\n\n<p>However, since that will be a list in this solution, some additional cleverness may be required.\n\n</p><p></p><hr/>\n<em>2016-Dec-01 14:38:52 by tlmiller:</em> <br/>\n\nThe first thing that comes to mind is to add a new variable in the root config when we add the dynamic directory to LOCAL_CONFIG_DIR, say, DYNAMIC_CONFIG_DIR, which we know will be singular.\n\n<p></p><hr/>\n<em>2016-Dec-01 16:26:24 by tlmiller:</em> <br/>\n\nNew plan, after discussion:\n\n<p>Immediately -- for 8.5.8 -- remove the line in question from the default root config and stop distributing the EC2 RPM.\n\n</p><p>Later -- consider rewriting the EC2 RPM as something which installs an extra initscript (which configures HTCondor with the instance-specific data (unconditionally/ignoring cache) and (re-; see previous parenthetical remark) downloads the new configuration.\n\n</p><p></p><hr/>\n<em>2016-Dec-02 14:15:12 by tlmiller:</em> <br/>\n\nReverting the previous two commit seemed safer than partial removal, and reversions don't require code review.\n\n<p></p><hr/>\n<em>2016-Dec-02 14:17:48 by tlmiller:</em> <br/>\n\nWe also don't appear to have documented the EC2 package anywhere yet, so I guess this doesn't need documentation changes.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=6038\" onclick=\"get_ticket_and_populate_wrapper('6038'); return false;\" title=\"Reimplement EC2 package.\">#6038</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nReimplement EC2 package.</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Dec-02 14:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49714\">[49714]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6034\" onclick=\"get_ticket_and_populate_wrapper('6034'); return false;\" title=\"Work around my_popenv error sensitivity.\">#6034</a></span>) Revert \"(<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5787\" onclick=\"get_ticket_and_populate_wrapper('5787'); return false;\" title=\"Create condor-ec2 package to simplify use of HTCondor in the cloud.\">#5787</a></span>) Bugfixes.\" This reverts commit a3df3e9d0f548691309a9cd253d0607cdc70ec75.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Dec-02 14:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49715\">[49715]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6034\" onclick=\"get_ticket_and_populate_wrapper('6034'); return false;\" title=\"Work around my_popenv error sensitivity.\">#6034</a></span>) Revert \"(<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5787\" onclick=\"get_ticket_and_populate_wrapper('5787'); return false;\" title=\"Create condor-ec2 package to simplify use of HTCondor in the cloud.\">#5787</a></span>) Construct the condor-ec2 RPM.\" This reverts commit 64a2713b029c9348f6f886faf4ce0d35e448ccdb.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Dec-02 11:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49713\">[49713]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6034\" onclick=\"get_ticket_and_populate_wrapper('6034'); return false;\" title=\"Work around my_popenv error sensitivity.\">#6034</a></span>) Revert \"(<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5787\" onclick=\"get_ticket_and_populate_wrapper('5787'); return false;\" title=\"Create condor-ec2 package to simplify use of HTCondor in the cloud.\">#5787</a></span>) Construct the condor-ec2 RPM.\" This reverts commit 64a2713b029c9348f6f886faf4ce0d35e448ccdb.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Dec-02 11:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49712\">[49712]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6034\" onclick=\"get_ticket_and_populate_wrapper('6034'); return false;\" title=\"Work around my_popenv error sensitivity.\">#6034</a></span>) Revert \"(<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5787\" onclick=\"get_ticket_and_populate_wrapper('5787'); return false;\" title=\"Create condor-ec2 package to simplify use of HTCondor in the cloud.\">#5787</a></span>) Bugfixes.\" This reverts commit a3df3e9d0f548691309a9cd253d0607cdc70ec75.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "incident", "last_change": "2016-Dec-02 14:19", "status": "resolved", "created": "2016-Dec-01 14:24", "fixed_version": "2016-Dec-01 14:24", "broken_version": "v080507", "priority": "4", "subsystem": "DaemonMaster", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, tannenba@cs.wisc.edu, johnkn@cs.wisc.edu, tim@cs.wisc.edu", "due_date": ""}