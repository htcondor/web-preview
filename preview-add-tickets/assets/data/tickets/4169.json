{"id": 4169, "title": "Ticket #4169: Speed up schedd restart time by eliminating uneeded fsyncs", "description": "<blockquote>\nCMS <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AnaOps\" title=\"Ana Ops\">AnaOps</a></span> reported to htcondor-support:\n\n<p></p><div class=\"blockquote\">\n<table width=\"95%\"><tbody><tr><td>\u00a0</td><td>\n  \nDear HTCondor team.\n\n I just restarted the schedd on a node that was handling 7k running jobs.\n At start time, the schedd wasted ~3mins printing out the remaining job lease\n times!\n\n The CPU usage during that time was in the ~2% range.\n\n That's a lot of wasted time!\n I expect a non-negligible fraction of the job leases expired due to this :(\n\n Is the schedd at least doing anything useful in that time,\n or is it really just waiting on log file being written to disk?\n</td></tr></tbody></table></div>\n\n\n<p>Upon investigation, the problem was not so much the printing of remaining lease times into the <span class=\"quote\">SchedLog</span>, but that the schedd does one fsync during recovery for every job that was running at the time of the crash in order to reconcile committed run times.  The proposed patch will\n</p><ol>\n<li>fsync just once after correcting committed run times for all jobs (instead of an fsync per job), and\n</li><li>move the dprintf mentioned from D_ALWAYS to D_FULLDEBUG.</li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2014-Jan-23 14:53:02 by adesmet:</em> <br/>\n\n<strong>Code Review</strong> of <span class=\"chng\"><a href=\"chngview?cn=39214\">[39214]</a></span>: Passed. No changes required or recommended.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jan-23 10:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39218\">[39218]</a></span>: minor 8.1.4 version history item edit <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4169\" onclick=\"get_ticket_and_populate_wrapper('4169'); return false;\" title=\"Speed up schedd restart time by eliminating uneeded fsyncs\">#4169</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jan-22 17:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39214\">[39214]</a></span>: Speed up schedd restart time by reducing fsyncs and dprintfs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4169\" onclick=\"get_ticket_and_populate_wrapper('4169'); return false;\" title=\"Speed up schedd restart time by eliminating uneeded fsyncs\">#4169</a></span>  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Jan-23 15:24", "status": "resolved", "created": "2014-Jan-22 16:25", "fixed_version": "2014-Jan-22 16:25", "broken_version": "v080000", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "tannenba", "derived_from": "", "creator": "tannenba", "rust": "s8365", "customer_group": "cms", "visibility": "public", "notify": "isfiligoi@ucsd.edu, burt@fnal.gov, tannenba@cs.wisc.edu", "due_date": ""}