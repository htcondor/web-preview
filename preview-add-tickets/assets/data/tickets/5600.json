{"id": 5600, "title": "Ticket #5600: Keep supplemental groups in my_popen()", "description": "<blockquote>\nWhen my_popen() or my_spawnv() is invoked and told that the child process should have no root privileges, it also removes all supplemental groups in the child process. Nowhere else in HTCondor do we do this. When acting as a non-privileged user, we always ensure that user's supplemental groups are in place. We should do the same for my_popen()/my_spawnv().\n\n<p>This bit the SWAMP folks, who tried to configure a filetransfer plugin that needed to run a binary accessible only via a supplemental group of the user.\n\n</p><p>The fix for this consists of removing the call to setgroups() in my_popen() and my_spawnv(). These functions require that the process already has the desired UID set as the effective UID. This change assumes that Condor's privilege switching code always sets the user groups properly and no callers bypass Condor's privilege switching code to call seteuid() directly.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Apr-04 16:38:44 by zmiller:</em> <br/>\n\n<strong>DESIGN REVIEW</strong>:  Looks good.  I think this can be classified as a bug and committed for V8_4-branch.  Please reassign to me after committing for code review.\n\n<p></p><hr/>\n<em>2017-Jun-26 15:10:57 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>:  I approved of the changes before they were made, and now I'm approving them again (well) after they were made.  Resolving.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Apr-05 10:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48174\">[48174]</a></span>: Docs for supplemental groups with my_popen(). <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5600\" onclick=\"get_ticket_and_populate_wrapper('5600'); return false;\" title=\"Keep supplemental groups in my_popen()\">#5600</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Apr-05 10:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48173\">[48173]</a></span>: Keep supplemental groups in my_popen() and my_spawnv(). <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5600\" onclick=\"get_ticket_and_populate_wrapper('5600'); return false;\" title=\"Keep supplemental groups in my_popen()\">#5600</a></span> The supplemental groups are already set appropriately for the current effective user by the set_priv() code and the child process may rely on them for proper execution.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Jun-26 15:11", "status": "resolved", "created": "2016-Apr-04 13:19", "fixed_version": "2016-Apr-04 13:19", "broken_version": "v080000", "priority": "3", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "#4437", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "zmiller@cs.wisc.edu", "due_date": ""}