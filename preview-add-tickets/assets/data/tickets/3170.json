{"id": 3170, "title": "Ticket #3170: Fixed length buffers", "description": "<blockquote>\nFrom Florian Weimer -\n\n<p><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>:: LookupString(const char *, char *) cannot be used securely\n\n</p><p>This variant of ClassAd::LookupString() copies a string of undetermined length (whose contents is potentially controlled by an attacker) into a buffer with a fixed, but unknown size.  Such an interface cannot be used in a secure fashion, much like the stdio function gets().  This LookupString() variant must be removed.\n\n</p><p>On a related note, ClassAd::LookupString(const char *, char *, int) fails to NUL-terminate long strings and should probably take a size_t argument, not an int.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Jul-31 14:29:32 by jfrey:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>I reviewed the following patches forwarded by Matt. They look good, but it appears they were made against a branch with Red Hat-specific code in queue.cpp. This will prevent them from applying cleanly to the UW codebase.\n\n</p><p></p><ul>\n<li>0002-Remove-ClassAd-EvalString-const-char-classad-ClassAd.patch\n</li><li>0005-Fix-up-for-Remove-ClassAd-EvalString-s-change-of-for.patch\n</li><li>0009-Make-ClassAd-LookupString-const-char-char-int-termin.patch\n</li><li>0010-Update-ClassAd-LookupString-const-char-char-int-call.patch\n</li><li>0011-Remove-uses-of-unsafe-LookupString-const-char-char-3.patch\n</li><li>0012-Remove-unsafe-LookupString-const-char-char-3170.patch</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-18 14:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33414\">[33414]</a></span>: Remove unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span>  (By Zach Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-18 10:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33408\">[33408]</a></span>: Remove unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span>  (By Zach Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-17 19:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33404\">[33404]</a></span>: Fix for string manipulation mods, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Erik Erlandson &lt;eerlands@redhat.com&gt; Committer: Matthew Farrellee  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-17 19:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33402\">[33402]</a></span>: 7.6 only -- remove more uses of unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span>  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-17 19:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33401\">[33401]</a></span>: Remove unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span>  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-17 19:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33400\">[33400]</a></span>: Remove uses of unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt; Conflicts: src/condor_negotiator.V6/matchmaker.cpp src/condor_submit.V6/submit.cpp src/condor_utils/file_transfer.cpp  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-17 19:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33399\">[33399]</a></span>: Update ClassAd::LookupString(const char *, char *, int) call sites to take advantage of terminating from <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LookupString\" title=\"Lookup String\">LookupString</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt; Conflicts: src/condor_gridmanager/ec2job.cpp  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-17 19:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33398\">[33398]</a></span>: Make ClassAd::LookupString(const char *, char *, int) terminate theresulting string with '\\0', <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt;  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33373\">[33373]</a></span>: Fix for string manipulation mods, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Erik Erlandson &lt;eerlands@redhat.com&gt; Committer: Matthew Farrellee  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33363\">[33363]</a></span>: Remove unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span>  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33356\">[33356]</a></span>: Fix up for \"Remove ClassAd::EvalString\"'s change of format_owner, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt;  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33360\">[33360]</a></span>: Make ClassAd::LookupString(const char *, char *, int) terminate theresulting string with '\\0', <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt;  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33361\">[33361]</a></span>: Update ClassAd::LookupString(const char *, char *, int) call sites to take advantage of terminating from <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LookupString\" title=\"Lookup String\">LookupString</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt;  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33362\">[33362]</a></span>: Remove uses of unsafe LookupString(const char *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span> Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt; Conflicts: src/condor_utils/classad_support.cpp classad_support.cpp has been removed from master. Conflict resolved by removing classad_support.cpp from this patch.  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-13 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33353\">[33353]</a></span>: Remove ClassAd::EvalString(const char *, classad::ClassAd *, char *), <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3170\" title=\"Fixed length buffers\">#3170</a></span> This is an inherently unsafe, gets()-style interface. Signed-off-by: Jaime Frey &lt;jfrey@cs.wisc.edu&gt; Committer: Matthew Farrellee  (By Florian Weimer )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Dec-17 12:51", "status": "resolved", "created": "2012-Jul-30 14:57", "fixed_version": "2012-Jul-30 14:57", "broken_version": "v070600", "priority": "2", "subsystem": "Daemons", "assigned_to": "zmiller", "derived_from": "", "creator": "matt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu", "due_date": ""}