{"id": 5338, "title": "Ticket #5338: Deal with reacquiring creds after a SchedD (daemon or machine) restart", "description": "<blockquote>\nIf a machine is rebooted, existing jobs will still be in the queue but will initially have no AFS tokens on schedd startup.  We need a way to reacquire the necessary credentials before jobs can be started (or job logs be written).\n\n<p>Possibly the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CredMon\" title=\"Cred Mon\">CredMon</a></span> needs to be started first, signal that it has iterated the SEC_CRED_DIR, and only then the master starts the schedd.  Or the schedd could start normally but at the very least has to know not to do anything until it hears from the master.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6418\" title=\"Master isn't deleting CREDMON_COMPLETE file\">#6418</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nMaster isn't deleting CREDMON_COMPLETE file</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Nov-23 11:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49630\">[49630]</a></span>: Fix windows compilation problem in <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5338\" title=\"Deal with reacquiring creds after a SchedD (daemon or machine) restart\">#5338</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Nov-23 09:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49625\">[49625]</a></span>: Have the master clear the CREDMON_COMPLETE file so credentials will be refreshed on startup. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5338\" title=\"Deal with reacquiring creds after a SchedD (daemon or machine) restart\">#5338</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Oct-17 14:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49443\">[49443]</a></span>: Decrement retries counter so that schedd will give up eventually. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5338\" title=\"Deal with reacquiring creds after a SchedD (daemon or machine) restart\">#5338</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Nov-02 15:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=46187\">[46187]</a></span>: Have the schedd start as long as it finds the magic file. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5338\" title=\"Deal with reacquiring creds after a SchedD (daemon or machine) restart\">#5338</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-26 18:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=46120\">[46120]</a></span>: Make the credmon_signal_and_poll slightly more versatile <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5338\" title=\"Deal with reacquiring creds after a SchedD (daemon or machine) restart\">#5338</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-25 23:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=46104\">[46104]</a></span>: Check return value of credmon_signal_and_poll and propagate to classad. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5338\" title=\"Deal with reacquiring creds after a SchedD (daemon or machine) restart\">#5338</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-25 23:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=46103\">[46103]</a></span>: Add temporary hack to SchedD to not do anything until it succesfully reacquires user creds <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5338\" title=\"Deal with reacquiring creds after a SchedD (daemon or machine) restart\">#5338</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-25 23:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=46102\">[46102]</a></span>: Add a command handler in the CredD to refresh ALL credentials. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5338\" title=\"Deal with reacquiring creds after a SchedD (daemon or machine) restart\">#5338</a></span>  (By zmiller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Apr-26 20:56", "status": "resolved", "created": "2015-Oct-22 16:58", "fixed_version": "2015-Oct-22 16:58", "broken_version": "", "priority": "1", "subsystem": "Security", "assigned_to": "zmiller", "derived_from": "#5272", "creator": "zmiller", "rust": "", "customer_group": "cern", "visibility": "public", "notify": "zmiller@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": "20151103"}