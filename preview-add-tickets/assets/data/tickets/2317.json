{"id": 2317, "title": "Ticket #2317: Parallel Universe jobs get preempted upon renewal of job lease", "description": "<blockquote>\nThe telling lines from the startd log are:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">07/12/11 21:08:54 Calling Handler &lt;Alive to schedd &lt;10.14.0.18:54531&gt;&gt; (4)\n07/12/11 21:08:54 slot1: State change: claim no longer recognized by the schedd - removing claim\n07/12/11 21:08:54 slot1: Changing state and activity: Claimed/Busy -&gt; Preempting/Killing\n</pre></div>\n\n\n<p>Condor's keep-alive protocol, which is used between a schedd and claimed startds so that a startd knows when a schedd disappears and vice versa, changed between v7.4.x and v7.6.x. Back in v7.4.x, the schedd sent alive packets via UDP to the startds. In v7.6.x, in order to improve scalability/reliability and to be nicer to firewalls, the startd sends alive data via a roundtrip TCP connection to the schedd. Unfortunately, it looks like this new alive protocol and parallel universe jobs do not play together nicely.  :( .\n\n</p><p>We have an immediate work-around available - we can explicitly tell the schedd to use the old-style protocol by putting the following in the condor_config file seen by all schedds that will be submitting parallel universe jobs:\n\n</p><p></p><pre>   STARTD_SENDS_ALIVES = False\n</pre>\n\n<p>This simple config entry should hold the fort until we get this bug fixed.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-17 16:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26836\">[26836]</a></span>: Version history entry for parallel universe job lease bug. <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=2317\" onclick=\"get_ticket_and_populate_wrapper('2317'); return false;\" title=\"Parallel Universe jobs get preempted upon renewal of job lease\">#2317</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-17 16:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26835\">[26835]</a></span>: Fix bug where parallel jobs got preempted on job lease renewal. ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=2317\" onclick=\"get_ticket_and_populate_wrapper('2317'); return false;\" title=\"Parallel Universe jobs get preempted upon renewal of job lease\">#2317</a></span> ===VersionHistory:Complete===  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-19 12:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26073\">[26073]</a></span>: known bug and work around version history item added: parallel univ jobs preempted as job lease expires at 20 minutes ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=2317\" onclick=\"get_ticket_and_populate_wrapper('2317'); return false;\" title=\"Parallel Universe jobs get preempted upon renewal of job lease\">#2317</a></span>  (By Karen Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Aug-22 12:27", "status": "defer", "created": "2011-Jul-19 12:37", "fixed_version": "2011-Jul-19 12:37", "broken_version": "v070600", "priority": "5", "subsystem": "Parallel", "assigned_to": "gthain", "derived_from": "", "creator": "tannenba", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "tstclair@redhat.com, tannenba@cs.wisc.edu,pcouvare@caltech.edu", "due_date": "20110816"}