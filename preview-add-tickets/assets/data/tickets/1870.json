{"id": 1870, "title": "Ticket #1870: Make the starter able to spawn jobs under parrot", "description": "<blockquote>\nNow that Condor's Chirp protocol is up to date with the Notre Dame implementation, parrot can be used for remote IO between the starter and shadow. Currently parrot, <a class=\"external\" href=\"http://www.cse.nd.edu/~ccl/software/parrot/\">http://www.cse.nd.edu/~ccl/software/parrot/</a> has to be run as a submit job with the actual user job supplied in the arguments  It would be convenient to have the starter spawn the user job under parrot.\n\n<p>To achieve this:\n</p><ul>\n<li>The full path to the parrot executable would need to be specified in the condor_config file.\n</li><li>A flag in the submit file would have to be specified, something like \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UseParrot\" title=\"Use Parrot\">UseParrot</a></span> = true\"</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Jan-25 11:56:45 by slauson:</em> <br/>\n\n<div class=\"verbatim\">\n<pre>diff --git a/src/condor_includes/condor_attributes.h b/src/condor_includes/condor_attributes.h\nindex 59ad63d..d0160cf 100644\n--- a/src/condor_includes/condor_attributes.h\n+++ b/src/condor_includes/condor_attributes.h\n@@ -551,6 +551,7 @@ extern const char * const  ATTR_CLASSAD_LIFETIME;\n extern const char * const  ATTR_UPDATE_PRIO;\n extern const char * const  ATTR_UPDATE_SEQUENCE_NUMBER;\n extern const char * const  ATTR_USE_GRID_SHELL;\n+extern const char * const  ATTR_USE_PARROT;\n extern const char * const  ATTR_USER;\n extern const char * const  ATTR_VACATE;\n extern const char * const  ATTR_VACATE_TYPE;\ndiff --git a/src/condor_starter.V6.1/os_proc.cpp b/src/condor_starter.V6.1/os_proc.cpp\nindex 8c50a62..03669b1 100644\n--- a/src/condor_starter.V6.1/os_proc.cpp\n+++ b/src/condor_starter.V6.1/os_proc.cpp\n@@ -170,7 +170,31 @@ OsProc::StartJob(FamilyInfo* family_info)\n        args.AppendArg(JobName.Value());\n        JobName = wrapper;\n        free(wrapper);\n-   }\n+   }\n+\n+       // Support USE_PARROT\n+   bool use_parrot = false;\n+   if( JobAd-&gt;LookupBool( ATTR_USE_PARROT, use_parrot) ) {\n+           // Check for parrot executable\n+       char *parrot = NULL;\n+       if( (parrot=param(\"PARROT\")) ) {\n+           if( access(parrot,X_OK) &lt; 0 ) {\n+               dprintf( D_ALWAYS, \"Unable to use parrot(Cannot find/execute \"\n+                   \"at %s(%s)).\\n\", parrot, strerror(errno) );\n+               free( parrot );\n+               return 0;\n+           } else {\n+               args.AppendArg(JobName.Value());\n+               JobName = parrot;\n+               free( parrot );\n+           }\n+       } else {\n+           dprintf( D_ALWAYS, \"Unable to use parrot(Undefined path in config\"\n+           \" file)\" );\n+           return 0;\n+       }\n+   }\n+\n        // Either way, we now have to add the user-specified args as\n        // the rest of the Args string.\n    MyString args_error;\ndiff --git a/src/condor_utils/condor_attributes.cpp b/src/condor_utils/condor_attributes.cpp\nindex c89cda1..0ac2fb9 100644\n--- a/src/condor_utils/condor_attributes.cpp\n+++ b/src/condor_utils/condor_attributes.cpp\n@@ -614,6 +614,7 @@ const char * const ATTR_CLASSAD_LIFETIME         = \"ClassAdLifetime\";\n const char * const ATTR_UPDATE_PRIO              = \"UpdatePrio\";\n const char * const ATTR_UPDATE_SEQUENCE_NUMBER   = \"UpdateSequenceNumber\";\n const char * const ATTR_USE_GRID_SHELL           = \"UseGridShell\";\n+const char * const ATTR_USE_PARROT               = \"UseParrot\";\n const char * const ATTR_USER                    = \"User\";\n const char * const ATTR_VACATE                   = \"Vacate\";\n const char * const ATTR_VACATE_TYPE              = \"VacateType\";\ndiff --git a/src/condor_utils/param_info.in b/src/condor_utils/param_info.in\nindex 0d21b87..722b6bf 100644\n--- a/src/condor_utils/param_info.in\n+++ b/src/condor_utils/param_info.in\n@@ -9975,3 +9975,19 @@ usage=\n url=\n tags=c++_util,condor_config\n id=601\n+\n+[PARROT]\n+aliases=\n+default=\n+version=0.0.0\n+range=.*\n+state=default\n+type=string\n+is_macro=false\n+reconfig=true\n+customization=seldom\n+friendly_name=Parrot\n+usage=run job within parrot\n+url=\n+tags=parrot\n+id=602\n\n</pre></div>\n\n\n<p></p><hr/>\n<em>2011-Jan-25 12:25:08 by slauson:</em> <br/>\n\nThere was one issue I ran into when testing this. In the submit file getenv must be set to true, otherwise parrot gets a NULL PATH variable and segfaults. I made a quick fix to parrot that resolves the issue, so I'll talk to Doug about adding the fix to the next parrot release.\n\n<p></p><hr/>\n<em>2011-Jan-28 10:00:18 by slauson:</em> <br/>\n\nPushed commit to master for 7.5.6.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-05 15:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=20298\">[20298]</a></span>: Removed leftover args passed to parrot that I was using for debugging. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1870\" title=\"Make the starter able to spawn jobs under parrot\">#1870</a></span>  (By Josh Slauson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jan-28 09:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=20161\">[20161]</a></span>: Made the starter able to run jobs under parrot when specified in the submit file. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1870\" title=\"Make the starter able to spawn jobs under parrot\">#1870</a></span>  (By Josh Slauson )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Feb-05 13:15", "status": "resolved", "created": "2011-Jan-24 15:23", "fixed_version": "2011-Jan-24 15:23", "broken_version": "v070506", "priority": "3", "subsystem": "", "assigned_to": "slauson", "derived_from": "#1628", "creator": "slauson", "rust": "", "customer_group": "other", "visibility": "public", "notify": "gthain@cs.wisc.edu jslauson@wisc.edu matt@cs.wisc.edu", "due_date": ""}