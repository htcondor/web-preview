{"id": 2428, "title": "Ticket #2428: allow macros in dagman log files to assist templating", "description": "<blockquote>\nMentioned on condor-users:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">Universe   = standard\nrequirements = (Arch == \"X86_64\")&amp;&amp;  (OpSys == \"LINUX\")\nExecutable = /path/to/binary\ntransfer_executable = TRUE\nshould_transfer_files = IF_NEEDED\nwhen_to_transfer_output = ON_EXIT\nArguments  = $(param)\nOutput     = $(id).stdout\nError      = $(id).stderr\nLog        = $(id).condor_log\nQueue\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">NODE_STATUS_FILE dag_status\nJOBSTATE_LOG     dag_log\nJOB   RT000-rt0.01 itersave.condor_job\nVARS  RT000-rt0.01 param=\"000 GT\"\nVARS  RT000-rt0.01 id=\"RT000-rt0.01\"\nRETRY RT000-rt0.01 3\nJOB   RT001-rt0.01 itersave.condor_job\nVARS  RT001-rt0.01 param=\"001 GT\"\nVARS  RT001-rt0.01 id=\"RT001-rt0.01\"\nRETRY RT001-rt0.01 3\n(and more)\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">MultiLogFiles: macros ('$(...') not allowed in log file name\n($(id).condor_log) in DAG node submit files\n</pre></div>\n\n\n<p>DAGMan strictly protects against possibly changing <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserLog\" title=\"User Log\">UserLog</a></span> files because of the presence of macros. This covers $(Cluster) and $(Process). However, it also covers against VARS ID=ABC, as in this example, a macro that is not variable and instead allows for template submit files.\n\n</p><p>Proposal is to more narrowly disallow macros (nix Process/Cluster/anything-that-evals-at-submit-time-with-Process-or-Cluster-or-Time-etc) or give users who know what they are doing an escape hatch, a way to say \"yes, i'm using macros properly, trust me\"</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Nov-17 12:56:19 by wenger:</em> <br/>\n\nI'm marking this as stalled because if we actually implement <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2645\" onclick=\"get_ticket_and_populate_wrapper('2645'); return false;\" title=\"Maintain DAGMan state in a better way\">#2645</a></span>, this ticket will become irrelevant.\n\n<p></p><hr/>\n<em>2011-Nov-21 16:20:02 by wenger:</em> <br/>\n\nDeferring this because of the ideas in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2645\" onclick=\"get_ticket_and_populate_wrapper('2645'); return false;\" title=\"Maintain DAGMan state in a better way\">#2645</a></span> -- if we implement some of those things, DAGMan may no longer have to parse the log file names.\n\n<p></p><hr/>\n<em>2012-Oct-04 14:23:07 by wenger:</em> <br/>\n\nThis is pretty much no longer an issue because of <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=2807\" onclick=\"get_ticket_and_populate_wrapper('2807'); return false;\" title=\"Have DAGMan use a single node job user log file\">#2807</a></span> being done.  I'm going to leave it unresolved for now, but move it down to priority 5.  I can probably be abandoned once the new \"one log file\" feature is widely used.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2772\" onclick=\"get_ticket_and_populate_wrapper('2772'); return false;\" title=\"Macro in node job log file name should be fatal error\">#2772</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nMacro in node job log file name should be fatal error</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-12 12:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32747\">[32747]</a></span>: edits of version history items and defn of knob DAGMAN_ALWAYS_USE_NODE_LOG ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2428\" onclick=\"get_ticket_and_populate_wrapper('2428'); return false;\" title=\"allow macros in dagman log files to assist templating\">#2428</a></span> ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=2807\" onclick=\"get_ticket_and_populate_wrapper('2807'); return false;\" title=\"Have DAGMan use a single node job user log file\">#2807</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-02 22:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=31904\">[31904]</a></span>: Let submit use recursive macros ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=2807\" onclick=\"get_ticket_and_populate_wrapper('2807'); return false;\" title=\"Have DAGMan use a single node job user log file\">#2807</a></span> This has been suggested a lot. This is a partial solution to <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=406\" onclick=\"get_ticket_and_populate_wrapper('406'); return false;\" title=\"Recursive $(macro) expansion causes condor_submit to hang\">#406</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2428\" onclick=\"get_ticket_and_populate_wrapper('2428'); return false;\" title=\"allow macros in dagman log files to assist templating\">#2428</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-02 22:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=31907\">[31907]</a></span>: Use new macro capability in DAGman DAGman now requests the schedd and shadow to write each event to the default log, i.e., &lt;DAG file&gt;.nodes.log, along with whatever log is specified by the user.\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-29 16:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28312\">[28312]</a></span>: Working on gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2428\" onclick=\"get_ticket_and_populate_wrapper('2428'); return false;\" title=\"allow macros in dagman log files to assist templating\">#2428</a></span>: cleaned up the VARS code in preparation for allowing macros in the log file specifications; also started on the first test for this.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-Oct-18 14:29", "status": "resolved", "created": "2011-Aug-29 09:11", "fixed_version": "2011-Aug-29 09:11", "broken_version": "v070000", "priority": "5", "subsystem": "Dag", "assigned_to": "nwp", "derived_from": "", "creator": "matt", "rust": "", "customer_group": "users", "visibility": "public", "notify": "wenger@cs.wisc.edu, matt@cs.wisc.edu,tstclair@redhat.com", "due_date": ""}