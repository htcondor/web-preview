{"id": 6664, "title": "Ticket #6664: condor_drain -start ... broken?", "description": "<blockquote>\nTesting <strong>condor_drain -start ...</strong> on e500.chtc.wisc.edu appeared to work well until it was time to finish draining, at which point it didn't.\n\n<p>First step: check if the version of e500 (<code>$CondorVersion: 8.7.8 May 02 2018 BuildID: 439756 $</code>) includes <span class=\"chng\"><a href=\"chngview?cn=54682\">[54682]</a></span>.  It should (that commit went in on April 10), but check the stupid stuff first, right?\n\n</p><p></p><hr/>\nMoate writes:\n\n<p></p><div class=\"verbatim\">\n<pre>May  9 17:02:12 e500 sudo:  condor : TTY=unknown ; PWD=/var/log/condor ; USER=root ; COMMAND=/etc/condor/bin/dns_domain_name.sh /etc/condor/ephemeral/dns_domain_name.conf\nMay  9 17:02:12 e500 sudo:  condor : TTY=unknown ; PWD=/var/log/condor ; USER=root ; COMMAND=/etc/condor/bin/htcondor_config_pull.sh -d /etc/condor\nMay 10 11:15:58 e500 sudo:  condor : TTY=unknown ; PWD=/var/log/condor ; USER=root ; COMMAND=/etc/condor/bin/dns_domain_name.sh /etc/condor/ephemeral/dns_domain_name.conf\nMay 10 11:15:58 e500 sudo:  condor : TTY=unknown ; PWD=/var/log/condor ; USER=root ; COMMAND=/etc/condor/bin/htcondor_config_pull.sh -d /etc/condor\n\nThese entries indicate a git checkout triggered by\nhtcondor_reconfig.  A diff of the git changes to the\nchtc_htcondor_config repository is attached.\n</pre></div>\n\n\n<p></p><hr/>\nSecond step: the attached diff looks unlikely to be the problem, but the <strong>condor_reconfig</strong> may have been; check to see if we lost the eviction timer there.</blockquote>", "remarks": "<blockquote>\n<em>2018-May-18 13:21:39 by tlmiller:</em> <br/>\n\nPrior release notes:\n\n<p></p><div class=\"verbatim\">\n<pre>\\item Added the machine attribute \\Attr{AcceptedWhileDraining}\n(see page~\\pageref{acceptedwhiledraining-machine-attribute}),\nconfiguration macro \\Macro{DEFRAG\\_DRAINING\\_START\\_EXPR}\n(see page~\\pageref{param:DefragDrainingStartExpr}),\nand command-line option \\Opt{-start} to \\Condor{drain}\n(see page~\\pageref{man-condor-drain})\nto support running jobs on draining resources.  See\nsection \\ref{sec:SMP-defrag} for details.\n\\Ticket{6628}\n</pre></div>\n\n\n<p>And from the RPM .spec file:\n\n</p><p></p><div class=\"verbatim\">\n<pre>- HTCondor can run preemptable jobs on machines that are draining\n</pre></div>\n\n\n<p></p><hr/>\n<em>2018-May-21 16:31:01 by tlmiller:</em> <br/>\n\nIt looks like that version of HTCondor includes the commit in question.\n\n<p></p><hr/>\n<em>2018-May-30 13:26:25 by tlmiller:</em> <br/>\n\nNeed to test this in the BaTLab before documenting.\n\n<p></p><hr/>\n<em>2018-Jun-06 16:46:16 by tlmiller:</em> <br/>\n\nTest of \"don't test the streams\" commit looks good.\n\n<p></p><hr/>\n<em>2018-Jun-06 16:51:34 by tlmiller:</em> <br/>\n\nShould do more extensive testing at some point; discuss that with Moate and also determine when the doc commits should go in.\n\n<p></p><hr/>\n<em>2018-Jun-12 12:36:53 by tlmiller:</em> <br/>\n\nIt looks like <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6697\" title=\"coordinated retirement while draining breaks HOLD_IF_MEMORY_EXCEEDED\">#6697</a></span> won't be resolved by the release, so we can consider documenting / announcing this feature when ToddT returns.\n\n<p></p><hr/>\n<em>2018-Jun-14 11:33:17 by tlmiller:</em> <br/>\n\nToddT observed that the remaining set of breakage is all old breakage (dating back to when we added retirement), so we should announce this new feature, document it, and then document the existing bugs and that we'll (try to) fix them in the next release.\n\n<p>\"Known bugs\" should then include <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6701\" title=\"condor_off -peaceful disrespects max job length\">#6701</a></span>.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jun-14 14:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55064\">[55064]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6659\" title=\"High Priority Jobs\">#6659</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6664\" title=\"condor_drain -start ... broken?\">#6664</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6697\" title=\"coordinated retirement while draining breaks HOLD_IF_MEMORY_EXCEEDED\">#6697</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6701\" title=\"condor_off -peaceful disrespects max job length\">#6701</a></span>) Release notes.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jun-01 15:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55000\">[55000]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6664\" title=\"condor_drain -start ... broken?\">#6664</a></span>) Don't cross the streams.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-30 13:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54978\">[54978]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6664\" title=\"condor_drain -start ... broken?\">#6664</a></span>) Check only jobs which which /aren't/ backfill for their retirement times when computing it. (Not sure we actually want to coordinate retirement times during draining if backfill is active, but that's another ticket.)  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2018-Jul-27 11:21", "status": "resolved", "created": "2018-Apr-27 13:18", "fixed_version": "2018-Apr-27 13:18", "broken_version": "v080708", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "tlmiller", "derived_from": "#6628", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}