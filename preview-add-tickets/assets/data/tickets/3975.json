{"id": 3975, "title": "Ticket #3975: 8.1.2 condorc van windows failure to transfer executable", "description": "<blockquote>\ncondor_ab_van fails on windows.\n\n<p>Failure to send executable for job\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">10/09/13 19:22:18 (pid:49784) entering FileTransfer::SimpleInit\n10/09/13 19:22:18 (pid:49784) perm::init() starting up for account (bt) domain (btthinkpad)\n10/09/13 19:22:18 (pid:49784) perm::init: Found Account Name bt\n10/09/13 19:22:18 (pid:49784) my_popen: CreateProcess failed\n10/09/13 19:22:18 (pid:49784) FILETRANSFER: Failed to execute C:/condor//bin/curl_plugin, ignoring\n10/09/13 19:22:18 (pid:49784) FILETRANSFER: failed to add plugin \"C:/condor//bin/curl_plugin\" because: FILETRANSFER:1:Failed to execute C:/condor//bin/curl_plugin, ignoring\n10/09/13 19:22:18 (pid:49784) FILETRANSFER: protocol \"data\" handled by \"C:/condor//bin/data_plugin\"\n10/09/13 19:22:18 (pid:49784) entering FileTransfer::DownloadFiles\n10/09/13 19:22:18 (pid:49784) entering FileTransfer::Download\n10/09/13 19:22:18 (pid:49784) entering FileTransfer::DoDownload sync=1\n10/09/13 19:22:18 (pid:49784) Sending GoAhead for 128.105.136.28 to send C:/condor_tests/job_condorc_ab_van.saveme/49448/49448poolB/spool\\1\\0\\cluster1.proc0.subproc0.tmp\\x_sleep.pl and all further files.\n10/09/13 19:22:18 (pid:49784) Received GoAhead from peer to receive C:/condor_tests/job_condorc_ab_van.saveme/49448/49448poolB/spool\\1\\0\\cluster1.proc0.subproc0.tmp\\x_sleep.pl and all further files.\n10/09/13 19:22:18 (pid:49784) get_file(): going to write to filename C:/condor_tests/job_condorc_ab_van.saveme/49448/49448poolB/spool\\1\\0\\cluster1.proc0.subproc0.tmp\\x_sleep.pl\n10/09/13 19:22:18 (pid:49784) get_file: Receiving 0 bytes\n10/09/13 19:22:18 (pid:49784) get_file: wrote 0 bytes to file\n10/09/13 19:22:18 (pid:49784) ReliSock::get_file_with_permissions(): received null permissions from peer, not setting\n10/09/13 19:22:18 (pid:49784) DoDownload: C_GAHP_WORKER_THREAD at 128.105.136.28 failed to send file(s) to &lt;128.105.136.28:59136&gt;: error reading from C:\\condor_tests\\C:\\condor_tests\\x_sleep.pl: (errno 22) Invalid argument; SCHEDD failed to receive file(s) from &lt;128.105.136.28:59329&gt;\n10/09/13 19:22:18 (pid:49784) DoDownload: exiting with upload errors\n10/09/13 19:22:18 (pid:49784) generalJobFilesWorkerThread(): failed to transfer files for job 1.0\n10/09/13 19:22:18 (pid:49784) Scheduler::spoolJobFilesWorkerThread(void *arg, Stream* s) NAP TIME\n10/09/13 19:22:19 (pid:49784) QMGR Connection closed\n10/09/13 19:22:19 (pid:49784) spoolJobFilesReaper tid=17 status=0\n10/09/13 19:22:19 (pid:49784) ERROR - Staging of job files failed!\n10/09/13 19:22:19 (pid:49784) abort_job_myself: 1.0 action:Remove log_hold:true notify:true\n10/09/13 19:22:19 (pid:49784) Cleared dirty attributes for job 1.0\n10/09/13 19:22:19 (pid:49784) Added data to SelfDrainingQueue job_is_finished_queue, now has 1 element(s)\n10/09/13 19:22:19 (pid:49784) Registered timer for SelfDrainingQueue job_is_finished_queue, period: 0 (id: 19)\n10/09/13 19:22:19 (pid:49784) Job 1.0 is finished\n\n</pre></div>\n\n\n<p>From the gahpworker with the local schedd, I see:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\"> entering FileTransfer::SimpleInit\n10/09/13 19:22:18 [52176] Input files:\n10/09/13 19:22:18 [52176] my_popen: CreateProcess failed\n10/09/13 19:22:18 [52176] FILETRANSFER: Failed to execute C:/condor//bin/curl_plugin, ignoring\n10/09/13 19:22:18 [52176] FILETRANSFER: failed to add plugin \"C:/condor//bin/curl_plugin\" because: FILETRANSFER:1:Failed to execute C:/condor//bin/curl_plugin, ignoring\n10/09/13 19:22:18 [52176] FILETRANSFER: protocol \"data\" handled by \"C:/condor//bin/data_plugin\"\n10/09/13 19:22:18 [52176] entering FileTransfer::UploadFiles (final_transfer=0)\n10/09/13 19:22:18 [52176] entering FileTransfer::Upload\n10/09/13 19:22:18 [52176] entering FileTransfer::DoUpload\n10/09/13 19:22:18 [52176] DoUpload: sending file C:\\condor_tests\\C:\\condor_tests\\x_sleep.pl\n10/09/13 19:22:18 [52176] FILETRANSFER: outgoing file_command is 1 for C:\\condor_tests\\C:\\condor_tests\\x_sleep.pl\n10/09/13 19:22:18 [52176] Received GoAhead from peer to send C:\\condor_tests\\C:\\condor_tests\\x_sleep.pl and all further files.\n10/09/13 19:22:18 [52176] Sending GoAhead for 128.105.136.28 to receive C:\\condor_tests\\C:\\condor_tests\\x_sleep.pl and all further files.\n10/09/13 19:22:18 [52176] ReliSock::put_file_with_permissions(): going to send permissions 0\n10/09/13 19:22:18 [52176] ReliSock: put_file: Failed to open file C:\\condor_tests\\C:\\condor_tests\\x_sleep.pl, errno = 22.\n10/09/13 19:22:18 [52176] DoUpload: exiting at 3260\n10/09/13 19:22:18 [52176] DoUpload: (Condor error code 13, subcode 22) C_GAHP_WORKER_THREAD at 128.105.136.28 failed to send file(s) to &lt;128.105.136.28:59136&gt;: error reading from C:\\condor_tests\\C:\\condor_tests\\x_sleep.pl: (errno 22) Invalid argument; SCHEDD failed to receive file(s) from &lt;128.105.136.28:59329&gt;\n10/09/13 19:22:18 [52176] Error sending files to schedd schedd49448poolB@btthinkpad: DCSchedd::spoolJobFiles:7002:File transfer failed for target job 1.0: C_GAHP_WORKER_THREAD at 128.105.136.28 failed to send file(s) to &lt;128.105.136.28:59136&gt;: error reading from C:\\condor_tests\\C:\\condor_tests\\x_sleep.pl: (errno 22) Invalid argument; SCHEDD failed to receive file(s) from &lt;128.105.136.28:59329&gt;\n10/09/13 19:22:18 [52176] Processing JOB_STAGE_OUT requests\n10/09/13 19:22:18 [52176] Processing JOB_REFRESH_PROXY requests\n\n</pre></div>\n\n\n<p>** Job add from **\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\"> 1 CreationTimestamp 1381342908\n101 0.0 Job Machine\n103 0.0 NextClusterNum 1\n105\n103 0.0 NextClusterNum 2\n101 01.-1 Job Machine\n101 1.0 Job Machine\n103 1.0 GlobalJobId \"schedd49448poolA@btthinkpad#1.0#1381342915\"\n103 01.-1 ClusterId 1\n103 01.-1 WantClaiming false\n103 01.-1 NumCkpts_RAW 0\n103 01.-1 NumCkpts 0\n103 01.-1 CondorVersion \"$CondorVersion: 8.1.2 Sep 19 2013 BuildID: 174986 PRE-RELEASE-UWCS $\"\n103 01.-1 GridResource \"condor schedd49448poolB@btthinkpad 128.105.136.28:59132\"\n103 01.-1 Requirements true\n103 01.-1 RequestDisk DiskUsage\n103 01.-1 RequestMemory ifthenelse(MemoryUsage =!= undefined,MemoryUsage,( ImageSize + 1023 ) / 1024)\n103 01.-1 BufferSize 524288\n103 01.-1 TransferInputSizeMB 0\n103 01.-1 WhenToTransferOutput \"ON_EXIT\"\n103 01.-1 TransferErr false\n103 01.-1 CompletionDate 0\n103 01.-1 Err \"/dev/null\"\n103 01.-1 ImageSize_RAW 1\n103 01.-1 ImageSize 1\n103 01.-1 CumulativeSlotTime 0\n103 01.-1 TransferOut false\n103 01.-1 TransferIn false\n103 01.-1 PeriodicRelease false\n103 01.-1 User \"bt@btthinkpad\"\n103 01.-1 Owner \"bt\"\n103 01.-1 In \"/dev/null\"\n103 01.-1 WantCheckpoint false\n103 01.-1 UserLog \"C:\\condor_tests\\job_condorc_ab_van.user_log.49448\"\n103 01.-1 RemoteWallClockTime 0.0\n103 01.-1 JobNotification 0\n103 01.-1 User \"bt@btthinkpad\"\n103 01.-1 NiceUser false\n103 01.-1 PeriodicRemove false\n103 1.0 LastJobStatus 0\n103 1.0 JobStatus 1\n103 01.-1 WantRemoteIO true\n103 01.-1 CommittedTime 0\n103 01.-1 CoreSize 0\n103 01.-1 JobPrio 0\n103 01.-1 LocalSysCpu 0.0\n103 01.-1 CondorPlatform \"$CondorPlatform: x86_64_Windows7 $\"\n103 01.-1 BufferBlockSize 32768\n103 01.-1 Iwd \"C:\\condor_tests\"\n103 01.-1 WindowsServicePackMinorVersion 0\n103 01.-1 WindowsBuildNumber 7601\n103 01.-1 MyType \"Job\"\n103 01.-1 CommittedSuspensionTime 0\n103 01.-1 Rank 0.0\n103 01.-1 Environment \"\"\n103 01.-1 FileSystemDomain \"btthinkpad\"\n103 01.-1 NumSystemHolds 0\n103 01.-1 OnExitHold false\n103 01.-1 RequestCpus 1\n103 01.-1 EnteredCurrentStatus 1381342915\n103 01.-1 ExitBySignal false\n103 01.-1 LocalUserCpu 0.0\n103 01.-1 ExitStatus 0\n103 01.-1 NumRestarts 0\n103 01.-1 NumJobStarts 0\n103 01.-1 RemoteSysCpu 0.0\n103 01.-1 ExecutableSize_RAW 1\n103 01.-1 ExecutableSize 1\n103 01.-1 WantRemoteSyscalls false\n103 01.-1 JobUniverse 9\n103 01.-1 WindowsMajorVersion 6\n103 01.-1 OnExitRemove true\n103 01.-1 PeriodicHold false\n103 01.-1 WindowsServicePackMajorVersion 1\n103 01.-1 LastSuspensionTime 0\n103 01.-1 Args \"1\"\n103 01.-1 QDate 1381342915\n103 01.-1 LeaveJobInQueue false\n103 01.-1 MaxHosts 1\n103 01.-1 RemoteUserCpu 0.0\n103 01.-1 NTDomain \"btthinkpad\"\n103 01.-1 WindowsProductType 1\n103 01.-1 TotalSuspensions 0\n103 01.-1 Cmd \"C:\\condor_tests\\x_sleep.pl\"\n103 01.-1 TargetType \"Machine\"\n103 01.-1 CurrentHosts 0\n103 01.-1 Out \"/dev/null\"\n103 01.-1 DiskUsage_RAW 1\n103 01.-1 DiskUsage 1\n103 01.-1 CumulativeSuspensionTime 0\n103 01.-1 ShouldTransferFiles \"IF_NEEDED\"\n103 01.-1 CommittedSlotTime 0\n103 01.-1 WindowsMinorVersion 1\n103 01.-1 MinHosts 1\n103 01.-1 CurrentTime time()\n103 1.0 ProcId 0\n106\n105\n103 1.0 Managed \"External\"\n106\n105\n103 1.0 GridJobId \"condor schedd49448poolB@btthinkpad 128.105.136.28:59132 1.0\"\n103 1.0 LastRemoteStatusUpdate 1381342934\n106\n105\n103 1.0 GridResourceUnavailableTime 1381342961\n106\n105\n103 1.0 GridResourceUnavailableTime undefined\n106\n105\n103 1.0 GridResourceUnavailableTime 1381343284\n106\n105\n103 1.0 GridResourceUnavailableTime undefined\n106\n105\n103 1.0 EnteredCurrentStatus 1381343593\n103 1.0 HoldReason \"Error sending files to schedd schedd49448poolB@btthinkpad: DCSchedd::spoolJobFiles:7002:File transfer failed for target job 1.0: Failed to receive GoAhead message from 128.105.136.28.\"\n103 1.0 HoldReasonCode 0\n103 1.0 HoldReasonSubCode 0\n103 1.0 LastJobStatus 1\n103 1.0 JobStatus 5\n103 1.0 Managed \"Schedd\"\n103 1.0 NumSystemHolds 1\n103 1.0 ReleaseReason undefined\n</pre></div>\n\n\n<p>** Rest of the logs both pools**\n\n</p><p>~bt/public/49448poola and poolb</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Oct-10 15:05:40 by ziliang:</em> <br/>\n\nI think I fixed this with <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3979\" onclick=\"get_ticket_and_populate_wrapper('3979'); return false;\" title=\"curl plugin does not work on Windows\">#3979</a></span>.\n\n<p></p><hr/>\n<em>2013-Oct-16 14:23:36 by johnkn:</em> <br/>\n\nThis bug is fixed by a commit in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3589\" onclick=\"get_ticket_and_populate_wrapper('3589'); return false;\" title=\"Gridmanager doesn't use spooled executable for cream jobs\">#3589</a></span>. note that this bug never shipped.\n\n<p></p><hr/>\n<em>2013-Oct-18 12:11:02 by tannenba:</em> <br/>\n\nTJ, you say \"fixed by a commit\"... which commit?  Also, you resolved this ticket saying it is fixed in v8.0.x, but all the commits in the ticket you reference are in v8.1.x, so how can this bug possibly be resolved in v8.0.x ?\n\n<p>Please correct the comments and meta-information in this ticket.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Oct-09 15:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37805\">[37805]</a></span>: Fix GetJobExecutable() for Windows full pathnames. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3589\" onclick=\"get_ticket_and_populate_wrapper('3589'); return false;\" title=\"Gridmanager doesn't use spooled executable for cream jobs\">#3589</a></span> Use fullpath(), which has a better check for whether a filename is an absolute path. this fixes <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3975\" onclick=\"get_ticket_and_populate_wrapper('3975'); return false;\" title=\"8.1.2 condorc van windows failure to transfer executable\">#3975</a></span>  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Oct-18 13:16", "status": "resolved", "created": "2013-Oct-09 13:56", "fixed_version": "2013-Oct-09 13:56", "broken_version": "v080102", "priority": "2", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "bt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bt@cs.wisc.edu tannenba@cs.wisc.edu", "due_date": ""}