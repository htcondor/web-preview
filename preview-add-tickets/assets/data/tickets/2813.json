{"id": 2813, "title": "Ticket #2813: negotiator rejecting jobs because of insufficient priority", "description": "<blockquote>\nThe problems encountered below at a site running Condor v7.6.6 were apparently resolved by downgrading the negotiator to v7.6.4. The 7.6.4\nnegotiator immediately accepted jobs that the 7.6.6 version had been\nrejecting.\n\n<p>Worried that the negotiator changes <span class=\"ticket\"><a class=\"pending\" href=\"tktview?tn=2679\" title=\"RFE: Alter semantic of GROUP_AUTOREGROUP to replicate legacy behavior\">#2679</a></span> or <span class=\"ticket\"><a class=\"pending\" href=\"tktview?tn=2678\" title=\"RFE: expose accounting group negotiation-ordering to configuration\">#2678</a></span> pushed in v7.6.5 had some unintended side effect.\n\n</p><p></p><hr/>\n<strong>Incident Description</strong>\n\n<p>All head and compute nodes at LHO, as well as the Condor central\nmanager, were rebooted this morning to apply a kernel security patch.\nPrior to that, the cluster had been fully loaded, while now it is\nrunning at just under 10% of capacity.  Jobs are being rejected by the\nnegotiatior:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">[root@condor ~]# tail -f /var/log/condor/NegotiatorLog\n01/27/12 15:39:30 (fd:7)     Got NO_MORE_JOBS;  done negotiating\n01/27/12 15:39:30 (fd:7)   Negotiating with\nmagathos@xxx.xxx.xxx.xxx at &lt;y.y.y.y:45385&gt;\n01/27/12 15:39:30 (fd:7) 0 seconds so far\n01/27/12 15:39:30 (fd:7)     Request 12907655.00000:\n01/27/12 15:39:31 (fd:7)       Rejected 12907655.0\nmagathos@xxx.xxx.xxx.xxx &lt;y.y.y.y:45385&gt;: insufficient priority\n01/27/12 15:39:31 (fd:7)     Request 12908931.00000:\n01/27/12 15:39:31 (fd:7)       Rejected 12908931.0\nmagathos@xxx.xxx.xxx.xxx &lt;y.y.y.y:45385&gt;: insufficient priority\n01/27/12 15:39:31 (fd:7)     Got NO_MORE_JOBS;  done negotiating\n01/27/12 15:39:31 (fd:7)  negotiateWithGroup resources used scheddAds\nlength 0\n01/27/12 15:39:31 (fd:7) ---------- Finished Negotiation Cycle ----------\n</pre></div>\n\n\n<p>Resetting a user's priority to 0 using <code>condor_userprio -setprio</code> did\nnot help;  neither did clearing <code>/var/lib/condor/spool/Accountantnew.log</code>\non the central manager and restarting Condor, or setting\n'NEGOTIATOR_IGNORE_USER_PRIORITIES = True'.  However, new jobs in both\nvanilla and standard universes are accepted and execute normally. Attempts with <code>condor_q -analyze</code> just report <em>Reason for last match failure: insufficient priority</em>.\n\n</p><p>A possibly related issue is that user priorities reported by user_prio\nare nowhere near in line with the resources used.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Feb-08 15:31:41 by eje:</em> <br/>\n\nIs there a repro for this that can be posted on this ticket?\n\n<p></p><hr/>\n<em>2012-Feb-08 15:33:45 by eje:</em> <br/>\n\nAlso, am I correctly reading that is this a problem only with jobs that were submitted prior to the upgrade, and encountered problems on restart?\n\n<p></p><hr/>\n<em>2012-Feb-10 14:26:04 by pfc:</em> <br/>\n\nUpdated priority to match Todd's new scheme (1=fire, 2=soon, 3=time permitting, 4=not yet prioritized, 5=wishlist/ideas).\n\n<p></p><hr/>\n<em>2012-Feb-15 13:05:48 by nwp:</em> <br/>\n\nI tried to reproduce this in a personal condor:  Things worked as expected in 7.6.6 and 7.6.4 (there was no difference).  Shadows attempted to reconnect; matches were made.\n\n<p></p><hr/>\n<em>2012-Mar-09 00:45:47 by pfc:</em> <br/>\n\nGiven that it's working now, and we can't reproduce it easily, I think we've decided to punt on this for now and reopen if it happens again.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "incident", "last_change": "2012-Mar-09 00:46", "status": "defer", "created": "2012-Feb-08 14:20", "fixed_version": "2012-Feb-08 14:20", "broken_version": "v070606", "priority": "5", "subsystem": "Daemons", "assigned_to": "tannenba", "derived_from": "", "creator": "tannenba", "rust": "s8129", "customer_group": "ligo", "visibility": "public", "notify": "eje@redhat.com, pfcouvar@syr.edu, tstclair@redhat.com,pcouvare@caltech.edu", "due_date": ""}