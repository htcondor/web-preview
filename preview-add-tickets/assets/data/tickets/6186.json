{"id": 6186, "title": "Ticket #6186: Fix [HAD|REPLICATION]_SOCKET_NAME default", "description": "<blockquote>\nAndrea Sartirana writes:\n\n<p></p><div class=\"verbatim\">\n<pre>at GRIF we are currently testing HAD and Replication.\nThings work just fine when declaring special ports for HAD and REPLICATION.\nBut, when setting REPLICATION_USE_SHARED_PORT to TRUE, the replication\nservice refuses to start and I see errors like these in the Master log of\nthe 2 master servers\n\n03/10/17 17:01:26 ERROR: SharedPortEndpoint: failed to bind to 15f287e5db818c2dbce9638b70a6dc044992f0be80d2dc43848c983c1fc43fa5/MASTER: Address already in use\n03/10/17 17:01:26 ERROR: Create_Process failed trying to start /usr/sbin/condor_replication\n</pre></div>\n\n\n<p>It looks like the master is attempting to rebind its own shared port endpoint, which is senseless.  However, the master creates shared port endpoints for its children (by inspecting the <code>-sock</code> argument) and <code>REPLICATION_SOCKET_NAME</code> is used in <code>REPLICATION_ARGS</code>.  By default, <code>REPLICATION_SOCKET_NAME</code> is <code>$(LOCALNAME:replication)</code>; this will never be <code>replication</code> now that LOCALNAME, it unset, defaults to SUBSYS.  (See ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5965\" onclick=\"get_ticket_and_populate_wrapper('5965'); return false;\" title=\"Add metaknobs at end of 8.5 series\">#5965</a></span>.)</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Mar-13 15:33:00 by tlmiller:</em> <br/>\n\nThe right fix is probably just to eliminate the default to LOCALNAME, since that couldn't have ever done what we wanted anyway, and leave the default as the string constant.  Documentation will have to be updated, though.\n\n<p></p><hr/>\n<em>2017-Mar-14 11:26:15 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong> : looks good.\n\n<p></p><hr/>\n<em>2017-Apr-17 17:05:38 by tim:</em> <br/>\n\n<strong>DOC REVIEW:</strong> Looks good</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-14 10:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50310\">[50310]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6186\" onclick=\"get_ticket_and_populate_wrapper('6186'); return false;\" title=\"Fix [HAD|REPLICATION]_SOCKET_NAME default\">#6186</a></span>) Change default values for [HAD|REPLICATION]_SOCKET_NAME, document.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Apr-17 17:05", "status": "resolved", "created": "2017-Mar-13 13:40", "fixed_version": "2017-Mar-13 13:40", "broken_version": "v080508", "priority": "2", "subsystem": "DaemonsCM", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}