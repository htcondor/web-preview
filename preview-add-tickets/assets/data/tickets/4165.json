{"id": 4165, "title": "Ticket #4165: Invalid use of MyString class when compiled with Quill", "description": "<blockquote>\nIt seems that the function MyString::sprintf(...) has been renamed to MyString::formatstr(...). Thus, the calls to MyString::sprintf(...) in dbms_urils.cpp cause a build failure. This happens only if you configure condor with \"WITH_POSTGRESQL=true\".</blockquote>", "remarks": "<blockquote>\n<em>2014-Jan-21 16:34:42 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Thanks for the patch.  The majority of the patch looks good, but a couple blurbs seem unrelated to this issue (ie. fixed in other tickets) and/or I disagree with (such as why replace a std::string with a static char buffer?).  But the bulk of the patch indeed addresses the issue and looks good, so I am pushing it.\n\n</p><p>The blurbs that from the attached patch that I am <em>not</em> pushing appear below.  Feel free to leave remarks in this ticket if you have reason to really want these changes to go into the code; thanks.\n</p><div class=\"code\">\n<pre class=\"code\">diff -r -u condor-8.0.5.orig/src/condor_tools/history.cpp condor-8.0.5/src/condor_tools/history.cpp\n--- condor-8.0.5.orig/src/condor_tools/history.cpp\t2013-12-02 20:25:26.000000000 +0100\n+++ condor-8.0.5/src/condor_tools/history.cpp\t2014-01-02 09:23:54.000000000 +0100\n@@ -136,12 +136,11 @@\n   char *dbIpAddr=NULL, *dbName=NULL,*queryPassword=NULL;\n   const char * pcolon=NULL;\n\n+  char tmp[1000];\n\n   std::string constraint;\n   ExprTree *constraintExpr=NULL;\n\n-  std::string tmp;\n-\n   int i;\n   parameters = (void **) malloc(NUM_PARAMETERS * sizeof(void *));\n   myDistro-&gt;Init( argc, argv );\n@@ -224,9 +223,9 @@\n\n */\n \t\tquillName = argv[i];\n-\n+\n \t\tsprintf (tmp, \"%s == \\\"%s\\\"\", ATTR_SCHEDD_NAME, quillName);\n-\t\tquillQuery.addORConstraint (tmp.c_str());\n+\t\tquillQuery.addORConstraint (tmp);\n\n \t\tremotequill = false;\n \t\treadfromfile = false;\ndiff -r -u condor-8.0.5.orig/src/condor_utils/history_utils.h condor-8.0.5/src/condor_utils/history_utils.h\n--- condor-8.0.5.orig/src/condor_utils/history_utils.h\t2013-12-02 20:25:26.000000000 +0100\n+++ condor-8.0.5/src/condor_utils/history_utils.h\t2014-01-02 09:23:55.000000000 +0100\n@@ -27,8 +27,8 @@\n\n //------------------------------------------------------------------------\n\n-void displayJobShort(AttrList* ad);\n-void short_header(void);\n+static void displayJobShort(AttrList* ad);\n+static void short_header(void);\n static void short_print(int,int,const char*,int,int,int,int,int,int,const char *);\n static void shorten (char *, int);\n static const char* format_date( time_t date );\ndiff -r -u condor-8.0.5.orig/src/condor_utils/user_job_policy.cpp condor-8.0.5/src/condor_utils/user_job_policy.cpp\n--- condor-8.0.5.orig/src/condor_utils/user_job_policy.cpp\t2013-12-02 20:25:26.000000000 +0100\n+++ condor-8.0.5/src/condor_utils/user_job_policy.cpp\t2014-01-02 09:23:55.000000000 +0100\n@@ -314,7 +314,7 @@\n \t\tenabled. */\n \tExprTree *ph_expr = suspect-&gt;LookupExpr(ATTR_PERIODIC_HOLD_CHECK);\n \tExprTree *pr_expr = suspect-&gt;LookupExpr(ATTR_PERIODIC_REMOVE_CHECK);\n-\tExprTree *pl_expr = suspect-&gt;LookupExpr(ATTR_PERIODIC_REMOVE_CHECK);\n+\tExprTree *pl_expr = suspect-&gt;LookupExpr(ATTR_PERIODIC_RELEASE_CHECK);\n \tExprTree *oeh_expr = suspect-&gt;LookupExpr(ATTR_ON_EXIT_HOLD_CHECK);\n \tExprTree *oer_expr = suspect-&gt;LookupExpr(ATTR_ON_EXIT_REMOVE_CHECK);\n</pre></div>\n\n\n<p></p><hr/>\n<em>2014-Jan-21 17:02:16 by tannenba:</em> <br/>\n\nNote the second rejected blurb above was pushed in <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4164\" title=\"small bug in support of backwards compatibility for job policy exprs\">#4164</a></span></blockquote>", "derived_tickets": "", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/818/quill.patch\">quill.patch</a>\n83327 bytes added by f.wolfheimer on 2014-Jan-17 10:15:33 UTC.\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jan-21 17:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39209\">[39209]</a></span>: Fix invalid use of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyString\" title=\"My String\">MyString</a></span> that breaks Quill compilation. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4165\" title=\"Invalid use of MyString class when compiled with Quill\">#4165</a></span> Committer: Todd Tannenbaum  (By Felix Wolfheimer )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jan-21 16:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39208\">[39208]</a></span>: Fix invalid use of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyString\" title=\"My String\">MyString</a></span> that breaks Quill compilation. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4165\" title=\"Invalid use of MyString class when compiled with Quill\">#4165</a></span> Committer: Todd Tannenbaum  (By Felix Wolfheimer )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Jan-21 17:02", "status": "resolved", "created": "2014-Jan-17 04:15", "fixed_version": "2014-Jan-17 04:15", "broken_version": "v080005", "priority": "2", "subsystem": "Quill", "assigned_to": "tannenba", "derived_from": "", "creator": "f.wolfheimer", "rust": "", "customer_group": "other", "visibility": "public", "notify": "f.wolfheimer@googlemail.com", "due_date": ""}