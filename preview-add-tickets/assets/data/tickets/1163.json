{"id": 1163, "title": "Ticket #1163: Build without old ClassAds on Windows", "description": "<blockquote>\nAs part of the work to replace old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> with new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> in Condor, we need to update the Windows Visual Studio project files. All of the files under <code>src/classad.old/</code> should no longer be built. Replacing them is a compatibility API layer over new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>, contained in the files <code>src/condor_c++_util/compat_classad*</code>.\n\n<p>The <code>condor_classad</code> module should be modified to build the new <code>compat_classad*</code> files, or merged into the <code>condor_cpp</code> module. The <code>condor_api</code> module will have to be modified to include the object files for <code>compat_classad*</code> instead of those from <code>src/classad.old/</code>. It may also have to include the object files from the <code>condor_classad_new</code> module.\n\n</p><p>The following lines should be removed from <code>src/condor_includes/condor_sys_nt.h</code>:\n</p><div class=\"code\">\n<pre class=\"code\">// For now, always use old ClassAds\n#if !defined( WANT_OLD_CLASSADS )\n# define WANT_OLD_CLASSADS 1\n#endif\n</pre></div>\n\n\n<p>The work should be done on <code>V7_5-new_classads-branch</code>.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Jan-29 17:41:23 by ziliang:</em> <br/>\n\nInitial run through saw several condor_common.h includes in other header files.  Moved them out to their respective .cpp files.  New issue is Visual Studio is not liking us passing in a compat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> pointer as an old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> pointer.  This might be either due to VS' much stricter casting constraints.</blockquote>", "derived_tickets": "", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/136/win.patch\">win.patch</a>\n5483 bytes added by jfrey on 2010-Jan-29 22:19:42 UTC.\n<br/>\nMy initial attempt at modifying the Windows project files.<br/>\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-03 17:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17093\">[17093]</a></span>: Redo Visual Studio solution file so that msbuild will build the projects in the correct order according to project dependencies. Add new classad objects to condor_api project. Add compat classad files to condor_cpp and additional dependencies to condor_io. Fix set_vars to include another location for\u00a0[...]\n (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-03 17:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17092\">[17092]</a></span>: Update compat classad files to compile on Windows and remove WANT_OLD_CLASSADS macro. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1163\" title=\"Build without old ClassAds on Windows\">#1163</a></span>  (By Ziliang Guo )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Feb-05 16:24", "status": "resolved", "created": "2010-Jan-29 13:56", "fixed_version": "2010-Jan-29 13:56", "broken_version": "v070500", "priority": "3", "subsystem": "Packaging", "assigned_to": "ziliang", "derived_from": "#1109", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}