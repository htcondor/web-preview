{"id": 1482, "title": "Ticket #1482: Allow a cleanup/final DAG node that is always run", "description": "<blockquote>\nPegasus would like to be able to have a \"cleanup\" or \"final\" DAG node that is always run, even if the DAG fails.  There should probably be macros defined for this node that can pass along whether the DAG succeeded or failed (to both the node job and the POST script).</blockquote>", "remarks": "<blockquote>\n<em>2010-Jul-01 10:33:10 by psilord:</em> <br/>\n\nunwind-protect for the win!\n\n<p></p><hr/>\n<em>2011-Mar-29 17:20:10 by wenger:</em> <br/>\n\nThe Pegasus people would like this.\n\n<p></p><hr/>\n<em>2011-Mar-30 12:52:58 by wenger:</em> <br/>\n\nI think that this node should also have a special, pre-defined VARS value that specifies whether the DAG succeeded or failed.  The user should be able to pass this value to the Condor job of the node, and also to the PRE and POST scripts.\n\n<p></p><hr/>\n<em>2011-Mar-31 09:07:05 by wenger:</em> <br/>\n\nI'm also thinking that we should have a config knob for whether the final node is run if DAGMan is condor_rm'ed.\n\n<p></p><hr/>\n<em>2011-Mar-31 13:01:29 by psilord:</em> <br/>\n\nI'd rather specify the aforementioned config knob in the job description line for that specific job.... by default it is always run.\n\n<p></p><hr/>\n<em>2011-Mar-31 13:05:13 by wenger:</em> <br/>\n\nAnother issue is, what if a splice, and the upper-level DAG both have final nodes?  I'm thinking this should probably be an error, but I haven't thought through all of the ramifications yet.\n\n<p></p><hr/>\n<em>2011-Mar-31 16:31:40 by wenger:</em> <br/>\n\nI had originally said that the final node doesn't need a name (because it can't be a parent or child), but that's wrong, because the final node should be able to have PRE and POST scripts.  But it <strong>should</strong> be illegal to specify any parent or child relationships for it.\n\n<p>Another question is, if everything in the DAG works, except that the final node fails, is the DAG considered failed?  My initial thought is that in that case the DAG should be considered failed.  On the other hand, if other stuff fails, but the final node succeeds, I think the DAG should probably still be considered failed.\n\n</p><p></p><hr/>\n<em>2011-Apr-05 13:46:02 by nwp:</em> <br/>\n\nThis is probably a dumb question, but can a subdag be a final node?\n\n<p></p><hr/>\n<em>2011-Apr-05 13:59:47 by wenger:</em> <br/>\n\nHmm, that's actually kind of an interesting question.  My initial reaction is that a final node probably shouldn't be a subdag (but even if we don't allow the subdag keyword, a user could still \"manually\" set things up to run a DAG as the final node).\n\n<p>Anyhow, my reaction comes from two things:\n1) I just kind of don't like the idea of encouraging people to do something too complex for the final node -- especially if they set things up so that the final node will be run on condor_rm of DAGMan.\n2) It would be more syntactically complex.\n\n</p><p>My views on this aren't set in stone, if someone has counter-arguments...\n\n</p><p></p><hr/>\n<em>2011-Apr-19 13:34:27 by nwp:</em> <br/>\n\nI pushed changes for a final dag node up to master.  You can retrieve the changes\nfrom the branch <code>V7_7-allow_cleanup_final_dag_node-branch</code> at <code>origin</code>.\n\n<p></p><hr/>\n<em>2011-Apr-21 14:33:20 by wenger:</em> <br/>\n\nI think we'll need at least two tests for this -- one where the DAG succeeds, and one where the DAG fails.  The tests need to make sure that the final node is run <strong>after</strong> all other nodes, and also that if some other node fails and the final node succeeds, the whole DAG still fails.  (Hmm -- if the DAG succeeds and the final node fails, it kind of seems like the whole DAG should fail; but on the other hand, that's inconsistent with the DAG failure case...)\n\n<p></p><hr/>\n<em>2011-Apr-26 16:05:18 by nwp:</em> <br/>\n\nJust sent in a testing patch.  I am going to send this back to Kent for review.\n\n<p></p><hr/>\n<em>2011-May-13 09:11:50 by nwp:</em> <br/>\n\nPushed a patch to write out the final node for the rescue dag\n\n<p></p><hr/>\n<em>2011-May-19 09:54:57 by wenger:</em> <br/>\n\nAnother case to deal with:  if DAGMan itself is condor_rm'ed, I think it should write the rescue DAG and then run the final node;  if it's condor_rm'ed again while running the final node, I think it should remove that job and exit.\n\n<p></p><hr/>\n<em>2011-Jun-03 10:54:51 by wenger:</em> <br/>\n\nLogan just emailed me today with the request that he be able to have the overall DAG report success even if some nodes fail.  So I guess the way to do that would be to allow the \"final\" node to override DAG failure.  I have to think a bit about how to do that -- I'm a little reluctant to just take the exit code of the final node job and have that be the DAG result -- I think that would end up with a lot of people overriding the DAG result without meaning to.  At any rate, we should have some special macro that allows the DAG result to be passed to the final node job and scripts.\n\n<p></p><hr/>\n<em>2011-Jun-03 11:04:21 by psilord:</em> <br/>\n\nHow about a \"DAG return value expression\"? THis would be a classad expression where it would be evaluated in the context of another ad built from the return values of each node. Suppose we have this diamond dag (in a slightly smaller format for this remark):\n\n<p>a -&gt; b -&gt; c\n\n</p><p>b, c -&gt; d\n\n</p><p>Then, when the dag is finished, an ad is constructed like this (suppose b's job exited with 42, other jobs exited normally):\n\n</p><p></p><div class=\"verbatim\">\n<pre>[\n dag_attributes = [\n   num_total_jobs = 4\n ];\n a = 0;\n b = 42;\n c = 0;\n d = 0\n]\n</pre></div>\n\n\n<p>And then the dag expression can be something like:\n\n</p><p></p><div class=\"verbatim\">\n<pre>DagResultExpression = a == 0 || d == 0\n</pre></div>\n\n\n<p>When <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DagResultExpression\" title=\"Dag Result Expression\">DagResultExpression</a></span> gets evaluated in terms of the completed Dag ad describing how each node succeeded or failed, it can do whatever it wants.\n\n</p><p></p><hr/>\n<em>2011-Nov-28 17:03:22 by wenger:</em> <br/>\n\nThings to document:\n<ul>\n<li>DAG_STATUS macro\n</li><li>FAILED_COUNT macro\n</li><li>FINAL nodes not allowed in splices?\n</li><li>retry, category, priority, abort-dag-on, parent, child not allowed for FINAL nodes\n</li></ul>\n\n<p></p><hr/>\n<em>2011-Dec-01 09:57:11 by wenger:</em> <br/>\n\nNotes about some of the changes I made:\n<ul>\n<li>Added the new STATUS_NOT_READY node status, which means that the final node can be part of the same list as all of the \"regular\" nodes.  This simplifies things for a bunch of cases in the code.\n</li><li>Made a bunch of improvements to the tests.\n</li><li>Implemented PRE and POST scripts for final nodes.\n</li><li>Added code to disallow a number of features for final nodes (e.g., retries and priority).\n</li><li>The final node now controls the overall success or failure of the DAG, regardless of whether any other nodes failed.  Added new macros (DAG_STATUS and FAILED_COUNT) so the final node can figure out what happened with the rest of the DAG, and exit with an appropriate value.\n</li><li>Added code to run the final node if the DAG is condor_rm'ed.\n</li></ul>\n\n<p>Note that there isn't any documentation of this yet, because the branch for this code was created back when the manual was not in CONDOR_SRC -- I'll create documentation after the code gets merged.\n\n</p><p></p><hr/>\n<em>2011-Dec-02 15:40:44 by wenger:</em> <br/>\n\nHmm -- something that just occurred to me -- merging this back to the master may be kind of tricky, because of other changes that have happened, such as the \"always run POST script\" feature.  I think merging will require some careful checking at the functional level, not just the code/textual level.\n\n<p></p><hr/>\n<em>2011-Dec-06 17:50:01 by wenger:</em> <br/>\n\nI created the branch V7_7-allow_cleanup_final_dag_node-merge-branch to merge the \"final node\" stuff with all of the other changes that have happened since the V7_7-allow_cleanup_final_dag_node-branch was created.  I'm glad I made a special branch for doing the merge -- the conflicts are looking really gnarly.\n\n<p></p><hr/>\n<em>2011-Dec-06 22:26:23 by nwp:</em> <br/>\n\nYep. It looks pretty bad.  Do you want to split up the merge work between us?\n\n<p></p><hr/>\n<em>2011-Dec-15 19:49:13 by wenger:</em> <br/>\n\nMore tests to add:\n<ul>\n<li>DAG halt with final node\n</li><li>DAG with cycle and final node\n</li><li>DAG that is empty except for final node\n</li></ul>\n\n<p></p><hr/>\n<em>2011-Dec-20 08:16:06 by wenger:</em> <br/>\n\nNotes for review:\n<ul>\n<li>This isn't documented yet, so after the actual code review the ticket should go into the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DocPending\" title=\"Doc Pending\">DocPending</a></span> state.\n</li><li>Also, I haven't run a full build/test of the branch on all platforms.\n</li><li>One of the things to look at closely when reviewing is the logic in condor_event_timer() (in dagman_main.cpp) that decides when the DAG is finished, when to run the final node, etc.\n</li><li>Changes to be reviewed are on V7_7-allow_cleanup_final_dag_node-merge-branch.\n</li></ul>\n\n<p></p><hr/>\n<em>2011-Dec-20 09:15:37 by wenger:</em> <br/>\n\nOh, yeah -- just a note here on how this worked out.  It really ended up getting more complex than I wanted (or expected).  Most of the complexity is in dealing with DAG abort, DAG halt, and cycles in combination with final nodes.\n\n<p>Something else we didn't really think about ahead of time was the issue of the DAG final node overriding the success or failure of the rest of the DAG.  I don't think that added too much complexity, but I did end up adding some code to enable the user to pass a bunch of status information to the final node, so that it can properly decide what to do in various combinations of conditions.\n\n</p><p></p><hr/>\n<em>2011-Dec-20 13:17:44 by nwp:</em> <br/>\n\nLooks good.  Write up the documentation.\n\n<p></p><hr/>\n<em>2011-Dec-22 11:19:47 by wenger:</em> <br/>\n\nThis is now merged to the master (with a version history entry, but not full documentation).\n\n<p>One note about the implementation -- if you have startup cycle detection turned on, and a cycle is found at that point, the final node is not run.  It would be more consistent to run it at that point, but it seemed like a pain in terms of implementation, and things were getting complex enough as they were...\n\n</p><p></p><hr/>\n<em>2011-Dec-30 17:14:56 by wenger:</em> <br/>\n\nFinished documentation -- I'm going to resolve this.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2867\" onclick=\"get_ticket_and_populate_wrapper('2867'); return false;\" title=\"condor_submit makes noise about final node variables\">#2867</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\ncondor_submit makes noise about final node variables</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-20 13:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=29168\">[29168]</a></span>: Edit of new documentation of new DAGMan FINAL node feature. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-30 17:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28962\">[28962]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: documented the new \"DAG FINAL node\" feature; slightly changed comments in one test DAG.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-22 11:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28896\">[28896]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=28526\">[28526]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28527\">[28527]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28529\">[28529]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28530\">[28530]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28531\">[28531]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28534\">[28534]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28535\">[28535]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28538\">[28538]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28542\">[28542]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28543\">[28543]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28550\">[28550]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28551\">[28551]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28552\">[28552]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28554\">[28554]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28555\">[28555]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28556\">[28556]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28560\">[28560]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28563\">[28563]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28564\">[28564]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28565\">[28565]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28567\">[28567]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28568\">[28568]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28569\">[28569]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28570\">[28570]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28571\">[28571]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28576\">[28576]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28577\">[28577]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28584\">[28584]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28585\">[28585]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28586\">[28586]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28588\">[28588]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28589\">[28589]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28590\">[28590]</a></span>,\u00a0[...]\n (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-22 10:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28895\">[28895]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: added version history item about this so at least something is there for the merge -- still needs full docs.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-20 08:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28863\">[28863]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: hopefully final pre-review cleanup.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-19 22:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28861\">[28861]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: all tests now pass.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-19 18:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28855\">[28855]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: TEMPTEMP -- cleaned up the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FinishedRunning\" title=\"Finished Running\">FinishedRunning</a></span> methods; added tests for DAG that's empty other than final node, cycle + final node (currently fails) and DAG halt + final node; found an error in the DAG abort test, and fixed a problem in the abort/final node implementation found by the fixed\u00a0[...]\n (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-15 17:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28826\">[28826]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: finished manual merge of rescue-DAG-writing code -- found one small error.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-15 15:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28825\">[28825]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: fixed DoneCycle() method in Dag class; added a warning if a final node is marked as done; various other minor cleanups.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-15 12:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28822\">[28822]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: added 'always run post' and 'pre skip' to the final node tests.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-13 19:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28755\">[28755]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: cleaned up dagman_main.cpp after merge.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-09 18:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28707\">[28707]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=28608\">[28608]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28639\">[28639]</a></span>, Merge branch 'V7_7-allow_cleanup_final_dag_node-branch' into V7_7-allow_cleanup_final_dag_node-merge-branch Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: in the process of combining the final node implementation with the latest version of the master -- lots of bad merge conflicts, but I have it compiling and\u00a0[...]\n (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-06 17:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28639\">[28639]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: we now generate a rescue DAG if the \"main\" part of the DAG fails, even if the final node subsequently succeeds; also, if we write the rescue DAG twice (before and after the final node) we overwrite the same file the second time.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-05 19:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28608\">[28608]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: oops! Forgot to git add most of the job_dagman_final-F test stuff...  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-05 18:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28594\">[28594]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: got job_dagman_final-E working except that I think we should get a rescue DAG; minor cleanups to other tests.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-03 15:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28566\">[28566]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: job_dagman_final-F now working (tests with abort); job_dagman_final-E in progress (tests with condor_rm); minor fixes to some of the other tests.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Nov-28 16:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28456\">[28456]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: added the FAILED_COUNT macro (so a final node can tell whether other nodes failed if the DAG is condor_rm'ed ) and updated the tests accordingly; also added check to disallow ABORT-DAG-ON for a final node.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Nov-28 13:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28455\">[28455]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: most of the way to having the final node determine overall DAG success or failure, but lots of cleanup is still needed.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-08 11:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26115\">[26115]</a></span>: remove version history note; <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span> not ready for release in 7.7.0  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-19 14:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21914\">[21914]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>: made a bunch of cleanups to the implementation so far (mainly eliminating a lot of duplicate code), and started working on getting the tests to actually test things. We still need to fix a bunch of stuff, like actually running PRE and POST scripts for the final node, or else disallowing\u00a0[...]\n (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-12 22:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21857\">[21857]</a></span>: Try to address the comments from Kent First fix the rescue dag for FINAL node This is for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span> (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-12 15:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21855\">[21855]</a></span>: Cleaned up the 'final DAG node' tests to make them match the existing test conventions (both tests fail for me, though -- I haven't fixed that). Also, the final node does not get written to the rescue DAG. This is for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span> (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-12 11:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21846\">[21846]</a></span>: Typo in test script ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-26 15:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21579\">[21579]</a></span>: Create tests for Dagman final node ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span> A couple tests for the Dagman final node stuff. This is the first time I have written a Condor test, so I am sure I made a mistake here. Will probably need to check this later, after I find out what goes wrong.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-21 14:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21475\">[21475]</a></span>: Add a test case for a cleanup final dag node These tests are pretty weak. We just run a final node whether or not the dag succeeds. To improve this, we might want to have the test harness condor_rm the dag, to make sure the job still runs, or make a dag run to completion. The ticket is <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-19 13:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21440\">[21440]</a></span>: Use a Final job on exit from a DAG The ticket is <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-19 13:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21439\">[21439]</a></span>: Have the parser recognize a Final job The ticket is <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-19 13:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21438\">[21438]</a></span>: Add methods to the Job class in support of Final jobs The ticket is <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-19 13:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21437\">[21437]</a></span>: Factor out adding a node so that we can add a final node The ticket is <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-19 13:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21436\">[21436]</a></span>: Add methods to the Dag class to handle a Final job The ticket is <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1482\" onclick=\"get_ticket_and_populate_wrapper('1482'); return false;\" title=\"Allow a cleanup/final DAG node that is always run\">#1482</a></span>  (By Nathan W. Panike )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Dec-30 17:15", "status": "resolved", "created": "2010-Jul-01 10:22", "fixed_version": "2010-Jul-01 10:22", "broken_version": "v070503", "priority": "1", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu", "due_date": "20111202"}