{"id": 4308, "title": "Ticket #4308: child failed because PRIV_USER_FINAL process was still root before exe", "description": "<blockquote>\nOn the LIGO CIT cluster running version,\n\n<p></p><div class=\"verbatim\">\n<pre>[root@ldas-pcdev1 ~]# condor_version\n$CondorVersion: 8.0.6 Feb 01 2014 BuildID: 225363 $\n$CondorPlatform: x86_64_RedHat6 $\n</pre></div>\n\n\n<p>when tracking down errno=666666 for the following job,\n\n</p><p></p><div class=\"verbatim\">\n<pre>[root@ldas-pcdev1 ~]# condor_q -analyze 61402915.0\n\n\n-- Submitter: ldas-pcdev1.ligo.caltech.edu : &lt;10.14.0.18:59465&gt; : ldas-pcdev1.ligo.caltech.edu\n---\n61402915.000:  Request is held.\n\nHold reason: Error from slot8@node509.cluster.ldas.cit: Failed to execute '/home/gstlalcbc/profile/bin/gstlal_inspiral' with arguments --control-peak-time 0 --job-tag 0001 --ht-gate-threshold 15.0 --svd-bank V1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0000-V1_split_bank-H1-TMPLTBANK-871147516-2048.xml,H1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0000-H1_split_bank-H1-TMPLTBANK-871147516-2048.xml,L1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0000-L1_split_bank-H1-TMPLTBANK-871147516-2048.xml,V1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0001-V1_split_bank-H1-TMPLTBANK-871147516-2048.xml,H1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0001-H1_split_bank-H1-TMPLTBANK-871147516-2048.xml,L1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0001-L1_split_bank-H1-TMPLTBANK-871147516-2048.xml,V1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0002-V1_split_bank-H1-TMPLTBANK-871147516-2048.xml,H1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0002-H1_split_bank-H1-TMPLTBANK-871147516-2048.xml,L1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0002-L1_split_bank-H1-TMPLTBANK-871147516-2048.xml,V1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0003-V1_split_bank-H1-TMPLTBANK-871147516-2048.xml,H1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0003-H1_split_bank-H1-TMPLTBANK-871147516-2048.xml,L1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0003-L1_split_bank-H1-TMPLTBANK-871147516-2048.xml,V1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0004-V1_split_bank-H1-TMPLTBANK-871147516-2048.xml,H1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0004-H1_split_bank-H1-TMPLTBANK-871147516-2048.xml,L1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0004-L1_split_bank-H1-TMPLTBANK-871147516-2048.xml,V1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0005-V1_split_bank-H1-TMPLTBANK-871147516-2048.xml,H1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0005-H1_split_bank-H1-TMPLTBANK-871147516-2048.xml,L1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0005-L1_split_bank-H1-TMPLTBANK-871147516-2048.xml,V1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0006-V1_split_bank-H1-TMPLTBANK-871147516-2048.xml,H1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0006-H1_split_bank-H1-TMPLTBANK-871147516-2048.xml,L1:/mnt/qfs3/gstlalcbc/engineering/5/bns_bank_10Hz_0.9/svd_0006-L1_split_bank-H1-TMPLTBANK-871147516-2048.xml --data-source framexmit --track-psd --likelihood-snapshot-interval 14400 --psd-fft-length 8 --gracedb-type LowMass --veto-segments-name vetoes --gracedb-group Test --marginalized-likelihood-file marginalized_likelihood.xml.gz --likelihood-file /mnt/qfs3/gstlalcbc/engineering/5/bns_trigs_10Hz/0001_likelihood.xml.gz --gracedb-far-threshold 0.0001 --fir-stride 1 --thinca-interval 1 --tmp-space /usr1/gstlalcbc --state-vector-off-bits V1=256 --state-vector-off-bits=H1=352 --state-vector-off-bits=L1=352 --state-vector-on-bits V1=7 --state-vector-on-bits=H1=7 --state-vector-on-bits=L1=7 --channel-name V1=FAKE_h_16384Hz_4R --channel-name=H1=FAKE-STRAIN --channel-name=L1=FAKE-STRAIN: (errno=666666: 'Unknown error 666666\u2019)\n</pre></div>\n\nit was discovered that this job has generated the following error message:\n<div class=\"verbatim\">\n<pre>[root@node509 condor]# grep \"child failed because PRIV_USER_FINAL process was still root before exec\" StarterLog.slot*\nStarterLog.slot1:03/19/14 10:58:39 Create_Process(/usr/libexec/condor/condor_ssh_to_job_sshd_setup): child failed because PRIV_USER_FINAL process was still root before exec()\nStarterLog.slot8:04/09/14 16:05:34 Create_Process(/home/gstlalcbc/profile/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\nStarterLog.slot8:04/09/14 16:06:49 Create_Process(/home/gstlalcbc/profile/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\nStarterLog.slot8:04/09/14 16:08:51 Create_Process(/home/gstlalcbc/profile/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\nStarterLog.slot8:04/10/14 17:16:17 Create_Process(/home/gstlalcbc/profile/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\nStarterLog.slot8:04/10/14 17:26:15 Create_Process(/home/gstlalcbc/profile/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\nStarterLog.slot8:04/13/14 10:08:06 Create_Process(/home/gstlalcbc/profile/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n</pre></div>\n\nNote, when released this job matched the same slot on the same machine and generated a repeat of the same error 3 days later.\n\n<p>Here is a quick scan through this particular cluster that only shows these errors on a restricted range of cluster nodes. In particular, node501 and above are all faster (10G connected Sandy Bridge) cluster nodes, so perhaps it is a race condition. There is also a bias towards using partitionable slots on the higher number nodes so it might be related to that (or perhaps the combination take together). You can also see the mix of executables involved, including /bin/taskset and condor_ssh_to_job_sshd_setup as well as user application code (gstlal_inspiral).\n\n</p><p>Any help in tracking this down further would be greatly appreciated.\n\n</p><p>Thanks.\n\n</p><p></p><div class=\"verbatim\">\n<pre>node501 : node502 : node503 : node504 : /var/log/condor/StarterLog.slot1_12:04/02/14 15:44:38 Create_Process(/bin/taskset): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1_12:04/02/14 15:44:38 Create_Process(/bin/taskset): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1_12:04/02/14 15:44:39 Create_Process(/bin/taskset): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1_14:04/02/14 15:44:39 Create_Process(/bin/taskset): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1_15:04/02/14 15:44:38 Create_Process(/bin/taskset): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1_15:04/02/14 15:44:38 Create_Process(/bin/taskset): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1_18:04/02/14 15:44:37 Create_Process(/bin/taskset): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1_19:04/02/14 15:44:37 Create_Process(/bin/taskset): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1_19:04/02/14 15:44:37 Create_Process(/bin/taskset): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1_19:04/02/14 15:44:37 Create_Process(/bin/taskset): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1_28:04/02/14 15:44:37 Create_Process(/bin/taskset): child failed because PRIV_USER_FINAL process was still root before exec()\nnode505 : /var/log/condor/StarterLog.slot3:03/19/14 17:24:35 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot5:03/19/14 12:09:47 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot5:03/19/14 12:10:44 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot7:03/19/14 11:39:58 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot7:03/19/14 12:09:20 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot7:03/20/14 06:01:49 Create_Process(/usr/libexec/condor/condor_ssh_to_job_sshd_setup): child failed because PRIV_USER_FINAL process was still root before exec()\nnode506 : /var/log/condor/StarterLog.slot1:03/19/14 11:01:51 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1:03/19/14 11:03:25 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1:03/19/14 11:19:11 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1:03/19/14 11:21:14 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1:03/19/14 11:31:27 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1:03/19/14 11:37:17 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1:03/19/14 11:39:29 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1:03/19/14 12:07:56 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1:03/19/14 12:08:51 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1:03/19/14 12:09:47 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1:03/19/14 12:10:45 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1:03/19/14 12:11:40 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot1:03/19/14 14:38:12 Create_Process(/mnt/qfs3/gstlalcbc/juan/sleep.sh): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot3:03/19/14 17:06:23 Create_Process(/usr/libexec/condor/condor_ssh_to_job_sshd_setup): child failed because PRIV_USER_FINAL process was still root before exec()\nnode507 : /var/log/condor/StarterLog.slot1:03/19/14 11:22:04 Create_Process(/usr/libexec/condor/condor_ssh_to_job_sshd_setup): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot3:03/19/14 12:09:47 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot5:03/19/14 12:10:46 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\nnode508 : /var/log/condor/StarterLog.slot1:03/19/14 10:58:25 Create_Process(/usr/libexec/condor/condor_ssh_to_job_sshd_setup): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot3:03/19/14 12:10:16 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot6:03/19/14 12:11:40 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot7:03/19/14 12:12:34 Create_Process(/usr/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\nnode509 : /var/log/condor/StarterLog.slot1:03/19/14 10:58:39 Create_Process(/usr/libexec/condor/condor_ssh_to_job_sshd_setup): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot8:04/09/14 16:05:34 Create_Process(/home/gstlalcbc/profile/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot8:04/09/14 16:06:49 Create_Process(/home/gstlalcbc/profile/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot8:04/09/14 16:08:51 Create_Process(/home/gstlalcbc/profile/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot8:04/10/14 17:16:17 Create_Process(/home/gstlalcbc/profile/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot8:04/10/14 17:26:15 Create_Process(/home/gstlalcbc/profile/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\n/var/log/condor/StarterLog.slot8:04/13/14 10:08:06 Create_Process(/home/gstlalcbc/profile/bin/gstlal_inspiral): child failed because PRIV_USER_FINAL process was still root before exec()\nnode510 : node511 : node512 : node513 : node514 : node515 : node516 : node517 : node518 : node519 : node520 : node521 : node522 : node523 : node524 : node525 : node526 : node527 : node528 : node529 : node530 : node531 : node532 :\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2014-May-12 10:15:52 by danb:</em> <br/>\n\nThe Wisconsin CMS T2 cluster was struck by this same error 666666 when attempting to execute jobs.  In our case, many of the errors happened on machines that are not using partitionable slots.  We also seem to see a bias towards higher error rates on newer beefier machines.  We were running condor 8.0.5 at the time the error struck.\n\n<p></p><hr/>\n<em>2015-Sep-21 13:03:50 by tpdownes:</em> <br/>\n\nFrom Juan at Caltech:\n\n<p>We managed to track this problem down to the multi-threaded processes\nrunning on the worker nodes and forking off enough processes to exceed\nthe per user process limit (ulimit -u).\n\n</p><p>At start-up (after a reboot), all jobs manage to make it to the nodes\nand finish.  When a new job tries to occupy the vacated slot, the system\nwon't allow it because the user, i.e. \"gstlalcbc\", has reached or\nexceeded the limitby then.\n\n</p><p>The work-around is to set a really high limit in\n/etc/security/limits.d/90-nproc.conf (RHEL6) and\n/etc/security/limits.d/20-nproc.conf(RHEL7).  For our purpose, we just\nset the nproc limit to unlimited for the gstlalcbc user since it's\ndifficult to pin-point the exact ceiling for the multi-threaded jobs\nthat run on the nodes.\n\n</p><p>For reference the default limit for nproc is 1024 on RHEL6 and 4096 on\nRHEL7.\n\n</p><p></p><hr/>\n<em>2015-Sep-21 13:05:46 by tpdownes:</em> <br/>\n\nFrom LIGO's perspective the problem is resolved but Dan Bradley may wish to note our solution.\n\n<p>(I realize this is an old ticket - I'm doing housecleaning)</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "defect", "last_change": "2015-Sep-21 13:05", "status": "defer", "created": "2014-Apr-14 08:40", "fixed_version": "2014-Apr-14 08:40", "broken_version": "v080006", "priority": "5", "subsystem": "DaemonsExecNode", "assigned_to": "", "derived_from": "", "creator": "pfc", "rust": "a26837", "customer_group": "ligo", "visibility": "public", "notify": "pfcouvar@syr.edu, anderson@ligo.caltech.edu, gthain@cs.wisc.edu,dan@hep.wisc.edu,pcouvare@caltech.edu", "due_date": ""}