{"id": 7531, "title": "Ticket #7531: box_plugin doesn't work for uploads > 50 MB", "description": "<blockquote>\nUsers cannot upload files greater than 50 MB using the Box file transfer plugin as Box is now (since when?) is enforcing chunked uploads for such files.\n\n<p><a class=\"external\" href=\"https://developer.box.com/guides/uploads/chunked/\">https://developer.box.com/guides/uploads/chunked/</a></p></blockquote>", "remarks": "<blockquote>\n<em>2020-Mar-03 15:22:56 by jpatton:</em> <br/>\n\nResolved in <span class=\"chng\"><a href=\"chngview?cn=59075\">[59075]</a></span>, tested in CHTC using custom file transfer plugins (woo!). Feel free to run the test yourself:\n\n<p>generate_files.sh\n</p><div class=\"verbatim\">\n<pre>#!/bin/bash\n\ndd if=/dev/urandom of=$PWD/10mb.bin count=10000 bs=1000\ndd if=/dev/urandom of=$PWD/60mb.bin count=60000 bs=1000\n</pre></div>\n\n\n<p>test_box_plugin.submit\n</p><div class=\"verbatim\">\n<pre>executable = generate_files.sh\n\nuse_oauth_services = box\ntransfer_plugins = box=box_plugin.py\ntransfer_output_remaps = \"10mb.bin = box://plugin test/10mb.bin; 60mb.bin = box://plugin test/60mb.bin\"\n\noutput = out\nlog = log\n\nqueue\n</pre></div>\n\n\n<p></p><hr/>\n<em>2020-Mar-03 15:26:28 by jpatton:</em> <br/>\n\nAnd here's the <code>transfer_history</code> from my test. Note the different <code>TransferUrl</code> for the different upload methods. Also, sadly, note the difference in upload times... chunked upload takes much longer, though (according to the API docs) we could attempt to upload a few chunks at a time in parallel.\n\n<p></p><div class=\"verbatim\">\n<pre>***\nConnectionTimeSeconds = 4.288499116897583\nJobClusterId = 5583050\nJobOwner = \"jcpatton\"\nJobProcId = 0\nTransferEndTime = 1583269948\nTransferFileBytes = 10000000\nTransferFileName = \"/var/lib/condor/execute/slot1/dir_9408/10mb.bin\"\nTransferHostName = \"upload.box.com\"\nTransferLocalMachineName = \"c038.chtc.wisc.edu\"\nTransferProtocol = \"https\"\nTransferStartTime = 1583269943\nTransferSuccess = true\nTransferTotalBytes = 10000289\nTransferType = \"upload\"\nTransferUrl = \"https://upload.box.com/api/2.0/files/content\"\n***\nConnectionTimeSeconds = 23.83920502662659\nJobClusterId = 5583050\nJobOwner = \"jcpatton\"\nJobProcId = 0\nTransferEndTime = 1583269972\nTransferFileBytes = 60000000\nTransferFileName = \"/var/lib/condor/execute/slot1/dir_9408/60mb.bin\"\nTransferHostName = \"upload.box.com\"\nTransferLocalMachineName = \"c038.chtc.wisc.edu\"\nTransferProtocol = \"https\"\nTransferStartTime = 1583269948\nTransferSuccess = true\nTransferTotalBytes = 60000000\nTransferType = \"upload\"\nTransferUrl = \"https://upload.box.com/api/2.0/files/upload_sessions\"\n***\n</pre></div>\n\n<hr/>\n<em>2020-Apr-10 07:46:37 by tim:</em> <br/>\n\nBulk change of target version from v080906 to v080907 using ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-May-04 13:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59582\">[59582]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7531\" onclick=\"get_ticket_and_populate_wrapper('7531'); return false;\" title=\"box_plugin doesn't work for uploads &gt; 50 MB\">#7531</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-10 17:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59318\">[59318]</a></span>: Retry box uploads on broken pipe <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7531\" onclick=\"get_ticket_and_populate_wrapper('7531'); return false;\" title=\"box_plugin doesn't work for uploads &gt; 50 MB\">#7531</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-04 10:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59079\">[59079]</a></span>: Remove retry code meant for testing <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7531\" onclick=\"get_ticket_and_populate_wrapper('7531'); return false;\" title=\"box_plugin doesn't work for uploads &gt; 50 MB\">#7531</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-04 08:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59078\">[59078]</a></span>: Fix broken proxy skip <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7531\" onclick=\"get_ticket_and_populate_wrapper('7531'); return false;\" title=\"box_plugin doesn't work for uploads &gt; 50 MB\">#7531</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-03 16:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59076\">[59076]</a></span>: HTTPS_PROXY is useless at best, and actually kills chunked uploads at worst <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7531\" onclick=\"get_ticket_and_populate_wrapper('7531'); return false;\" title=\"box_plugin doesn't work for uploads &gt; 50 MB\">#7531</a></span>  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-03 15:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59075\">[59075]</a></span>: Add chunked upload method to box_plugin <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7531\" onclick=\"get_ticket_and_populate_wrapper('7531'); return false;\" title=\"box_plugin doesn't work for uploads &gt; 50 MB\">#7531</a></span> Box.com rejects file uploads &gt; 50 MB from their standard upload API endpoint, requiring users to instead use the chunked upload session/parts/commit endpoints. The API docs suggest using the direct upload endpoint for files less than 50 MB and used the chunked\u00a0[...]\n (By Jason Patton )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-May-04 13:50", "status": "resolved", "created": "2020-Mar-02 13:39", "fixed_version": "2020-Mar-02 13:39", "broken_version": "", "priority": "1", "subsystem": "FileTransfer", "assigned_to": "jpatton", "derived_from": "", "creator": "jpatton", "rust": "", "customer_group": "scitokens", "visibility": "public", "notify": "", "due_date": ""}