{"id": 7590, "title": "Ticket #7590: Removing job route associated with existing jobs causes stack trace", "description": "<blockquote>\nOne of our users updated their job routes on their CE, inadvertently removing a route that was associated with existing jobs. This caused the following stacktrace:\n\n<p></p><div class=\"verbatim\">\n<pre>04/01/20 10:41:06 Routes will be matched in this order: OSG_COVID-19_Jobs, OSG_Jobs\n04/01/20 10:41:06 Routing jobs to schedd osg.isi.edu in pool workflow.isi.edu:9618\n04/01/20 10:41:06 JobRouter warning (src=65153.0,dest=65182.0,route=Local_Condor): JobShouldBeSandboxed evaluated to true, but SUBMIT_Iwd is missing from target job, so assuming job is not sandboxed.\n04/01/20 10:41:06 JobRouter warning (src=65152.0,dest=65181.0,route=Local_Condor): JobShouldBeSandboxed evaluated to true, but SUBMIT_Iwd is missing from target job, so assuming job is not sandboxed.\n04/01/20 10:41:06 JobRouter warning (src=65148.0,dest=65180.0,route=Local_Condor): JobShouldBeSandboxed evaluated to true, but SUBMIT_Iwd is missing from target job, so assuming job is not sandboxed.\n04/01/20 10:41:06 JobRouter warning (src=65151.0,dest=65179.0,route=Local_Condor): JobShouldBeSandboxed evaluated to true, but SUBMIT_Iwd is missing from target job, so assuming job is not sandboxed.\n04/01/20 10:41:06 JobRouter warning (src=65149.0,dest=65178.0,route=Local_Condor): JobShouldBeSandboxed evaluated to true, but SUBMIT_Iwd is missing from target job, so assuming job is not sandboxed.\n04/01/20 10:41:06 JobRouter warning (src=65147.0,dest=65177.0,route=Local_Condor): JobShouldBeSandboxed evaluated to true, but SUBMIT_Iwd is missing from target job, so assuming job is not sandboxed.\n04/01/20 10:41:06 JobRouter warning (src=65150.0,dest=65176.0,route=Local_Condor): JobShouldBeSandboxed evaluated to true, but SUBMIT_Iwd is missing from target job, so assuming job is not sandboxed.\n04/01/20 10:41:06 JobRouter warning (src=65146.0,dest=65175.0,route=Local_Condor): JobShouldBeSandboxed evaluated to true, but SUBMIT_Iwd is missing from target job, so assuming job is not sandboxed.\n04/01/20 10:41:06 JobRouter warning (src=65144.0,dest=65174.0,route=Local_Condor): JobShouldBeSandboxed evaluated to true, but SUBMIT_Iwd is missing from target job, so assuming job is not sandboxed.\n04/01/20 10:41:06 JobRouter warning (src=65145.0,dest=65173.0,route=Local_Condor): JobShouldBeSandboxed evaluated to true, but SUBMIT_Iwd is missing from target job, so assuming job is not sandboxed.\nCaught signal 6: si_code=4294967290, si_pid=1512173, si_uid=0, si_addr=0x1712ED\nStack dump for process 1512173 at timestamp 1585762866 (17 frames)\n/usr/lib64/libcondor_utils_8_8_7.so(dprintf_dump_stack+0x24)[0x7f71b3797334]\n/usr/lib64/libcondor_utils_8_8_7.so(_Z17unix_sig_coredumpiP9siginfo_tPv+0x69)[0x7f71b39008d9]\n/usr/lib64/libpthread.so.0(+0xf5f0)[0x7f71b1e445f0]\n/usr/lib64/libc.so.6(gsignal+0x37)[0x7f71b1a9d337]\n/usr/lib64/libc.so.6(abort+0x148)[0x7f71b1a9ea28]\n/usr/lib64/libstdc++.so.6(_ZN9__gnu_cxx27__verbose_terminate_handlerEv+0x165)[0x7f71b27ef7d5]\n/usr/lib64/libstdc++.so.6(+0x5e746)[0x7f71b27ed746]\n/usr/lib64/libstdc++.so.6(+0x5e773)[0x7f71b27ed773]\n/usr/lib64/libstdc++.so.6(+0x5e993)[0x7f71b27ed993]\n/usr/lib64/libstdc++.so.6(_ZSt20__throw_out_of_rangePKc+0x77)[0x7f71b2842857]\ncondor_job_router[0x41d7c4]\ncondor_job_router(_ZN9JobRouter4PollEv+0x7c)[0x428d9c]\n/usr/lib64/libcondor_utils_8_8_7.so(_ZN12TimerManager7TimeoutEPiPd+0x280)[0x7f71b38dd9e0]\n/usr/lib64/libcondor_utils_8_8_7.so(_ZN10DaemonCore6DriverEv+0x9ce)[0x7f71b38f1d9e]\n/usr/lib64/libcondor_utils_8_8_7.so(_Z7dc_mainiPPc+0x13a9)[0x7f71b3904059]\n/usr/lib64/libc.so.6(__libc_start_main+0xf5)[0x7f71b1a89505]\ncondor_job_router[0x40c6c9]\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2020-Jul-15 13:40:09 by blin:</em> <br/>\n\nThis just bit another OSG user with 8.8.8\n\n<p></p><hr/>\n<em>2020-Jul-27 14:13:10 by johnkn:</em> <br/>\n\nFixed for 8.9.  there is a similar problem in 8.8, so a fix will be needed there also.\n\n<p></p><hr/>\n<em>2020-Jul-28 09:37:24 by johnkn:</em> <br/>\n\nactually the fix for 8.8 is identical.  bug was introduced with changes to make route order configurable <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7286\" onclick=\"get_ticket_and_populate_wrapper('7286'); return false;\" title=\"the condor_config_val -write:upgrade option needs a better name\">#7286</a></span>\n\n<p></p><hr/>\n<em>2020-Jul-28 11:57:28 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Looks pretty straightforward to me.  Approved.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-12 19:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61481\">[61481]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7590\" onclick=\"get_ticket_and_populate_wrapper('7590'); return false;\" title=\"Removing job route associated with existing jobs causes stack trace\">#7590</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-28 09:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60253\">[60253]</a></span>: fix <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7590\" onclick=\"get_ticket_and_populate_wrapper('7590'); return false;\" title=\"Removing job route associated with existing jobs causes stack trace\">#7590</a></span>, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> can segfault if a route is removed while it has active jobs  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-20 16:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60161\">[60161]</a></span>: fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7590\" onclick=\"get_ticket_and_populate_wrapper('7590'); return false;\" title=\"Removing job route associated with existing jobs causes stack trace\">#7590</a></span>, removing a route when there are associated jobs will crash the job router  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Oct-12 19:31", "status": "resolved", "created": "2020-Apr-10 10:09", "fixed_version": "2020-Apr-10 10:09", "broken_version": "v080807", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "johnkn", "derived_from": "#4555", "creator": "blin", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "blin@cs.wisc.edu tannenba@cs.wisc.edu", "due_date": ""}