{"id": 795, "title": "Ticket #795: Amazon Proxy does'nt support proxies requiring user authentication", "description": "<blockquote>\nThe Amazon gahp is unable to use a proxy that requires user authentication.  The following errors appear in the amazon gahp log:\n\n<p>09/29 14:37:59 Using proxy server, host=localhost, port=3128\n09/29 14:37:59 Using http proxy = <a class=\"external\" href=\"http://localhost:3128/\">http://localhost:3128/</a>\n09/29 14:37:59 Call to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DescribeInstances\" title=\"Describe Instances\">DescribeInstances</a></span> failed: SOAP 1.1 fault:\nSOAP-ENV:Server [no subcode]\n\"HTTP/1.0 407 Proxy Authentication Required\"\nDetail: &lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\"\n\"<a class=\"external\" href='http://www.w3.org/TR/html4/strict.dtd\"&gt;'>http://www.w3.org/TR/html4/strict.dtd\"&gt;</a>\n&lt;html&gt;&lt;head&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"&gt;\n&lt;title&gt;ERROR: Cache Access Denied&lt;/title&gt;\n&lt;style\ntype=\"text/css\"&gt;&lt;!--BODY{background-color:#ffffff;font-family:verdana,sans-serif}PRE{font-family:sans-serif}--&gt;&lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;ERROR&lt;/h1&gt;\n&lt;h2&gt;Cache Access Denied.&lt;/h2&gt;\n&lt;hr&gt;\n&lt;p\n09/29 14:37:59 Command(AMAZON_VM_STATUS_ALL) got error(code:Server,\nmsg:HTTP/1.0 407 Proxy Authentication Required</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Oct-07 10:50:30 by jfrey:</em> <br/>\n\nI've reviewed the patch and have one comment:\n\n<p>If a username and password aren't given in AMAZON_HTTP_PROXY, then the proxy_userid and proxy_passwd fields of the soap struct in <span class=\"quote\">AmazonRequest</span> are set to point at empty strings, rather than NULL. That may surprise gsoap. Someone should verify that it works properly.\n\n</p><p></p><hr/>\n<em>2009-Oct-07 14:04:18 by rrati:</em> <br/>\n\nTested and verified code words against proxy that doesn't require authentication.\n\n<p></p><hr/>\n<em>2009-Oct-27 16:19:14 by jfrey:</em> <br/>\n\nThe check for config param SOAP_SSL_CA_DIR introduces a memory leak. It should also check for SOAP_SSL_CA_FILE, which is an easy change to make.\n\n<p></p><hr/>\n<em>2009-Oct-27 16:23:31 by jfrey:</em> <br/>\n\nPushed a patch to V7_4-branch for 7.4.1 that addresses the issues mentioned above.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1465\" title=\"SOAP_SSL_CA_DIR/FILE don't work in amazon_gahp\">#1465</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nSOAP_SSL_CA_DIR/FILE don't work in amazon_gahp</td></tr>\n</tbody></table>", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/104/amazon-proxy-authentication.patch\">amazon-proxy-authentication.patch</a>\n4038 bytes added by rrati on 2009-Sep-30 15:59:18 UTC.\n<br/>\nThis patch will provide support for defining a username:password in the Amazon proxy  variable in the form:\n\n<p>http[s]://[&lt;username&gt;:&lt;password&gt;]@&lt;host&gt;:[&lt;port&gt;][/]\n\n</p><p>It also adds support to define \"SOAP_SSL_CA_DIR\" to a directory containing trusted CA certs (to verify server)\n<br/>\n</p></li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-27 16:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=16173\">[16173]</a></span>: Improve CA file handling for Amazon EC2 jobs. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=795\" title=\"Amazon Proxy does'nt support proxies requiring user authentication\">#795</a></span> Fixed a memory leak when SOAP_SSL_CA_DIR is set in the config file. Added check for SOAP_SSL_CA_FILE.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-07 13:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=15937\">[15937]</a></span>: HTTP proxy support for EC2 doesn't support providing a user or password for a proxy requiring user authentication. Added support for proxy definition in the form: \u00a0[...]\n (By Robert Rati )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2009-Dec-04 13:52", "status": "resolved", "created": "2009-Sep-30 10:57", "fixed_version": "2009-Sep-30 10:57", "broken_version": "v070200", "priority": "3", "subsystem": "Daemons", "assigned_to": "whenry", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "jfrey@cs.wisc.edu,matt@cs.wisc.edu", "due_date": ""}