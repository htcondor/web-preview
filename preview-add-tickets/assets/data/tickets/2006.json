{"id": 2006, "title": "Ticket #2006: RFE: publish some additional performance-related stats in schedd ad", "description": "<blockquote>\nHaving the schedd publish some additional performance-related statistics would improve the ability of an admin to understand how the schedd and the pool in general are performing.\n\n<p>Some proposed additional classad statistic attributes:\n\n</p><p></p><ul>\n<li>Jobs submitted\n</li><li>Jobs started\n</li><li>Jobs completed/exited\n\n<p></p></li><li>Over some definable window, rates (jobs/sec) for above (+ way to define that window)\n\n<p></p></li><li>Job Exit code histogram\n</li><li>Shadow Exception counts\n\n<p></p></li><li>Job running times\n</li><li>Times spent waiting in job queue to start\n\n<p></p></li><li>Cumulative variations on above (i.e. over schedd lifetime)</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Mar-29 16:10:47 by eje:</em> <br/>\n\nThe attached patch \"gt2006_schedd_stats.patch\" defines the following:\n\n<p></p><div class=\"verbatim\">\n<pre>UpdateInterval: seconds between current schedd ad publish time and previous\n\nJobsSubmitted: number of jobs submitted over most recent sampling window\nJobSubmissionRate: rate of job submission (jobs/sec) over sampling window\nJobsCompleted: number of jobs completed (successfully) over sampling window\nJobCompletionRate: rate of successful job completions over window\nJobsExited: number of jobs that exited (successful or otherwise) over window\nShadowExceptions: number of shadow exceptions over window\nExitCodeXXX: number of jobs exited with code XXX (100, 115, etc) over window\n\nJobsSubmittedCum: number of jobs submitted over lifetime of schedd\nJobsCompletedCum: number of jobs successfully completed over schedd lifetime\nJobsExitedCum: number of jobs exited (successful or otherwise) over schedd lifetime\nShadowExceptionsCum: number of shadow exceptions over schedd lifetime\nExitCodeCumXXX: number of jobs exited with code XXX over schedd lifetime\n\nWindowedStatWidth: The value of config param WINDOWED_STAT_WIDTH at the time this ad was published\n\nJobsStartedCum: Number of jobs started over schedd lifetime\nJobsStarted: Number of jobs started in stat window WINDOWED_STAT_WIDTH\nJobStartRate: The rate (jobs/sec) of jobs starting in stat window\n\nMeanTimeToStartCum: mean time a job waits in the schedd until first start, over schedd lifetime\nMeanRunningTimeCum: mean running time for jobs in the schedd (wall-clock time), over schedd lifetime\nSumTimeToStartCum: sum of job wait times to first start, over schedd lifetime\nSumRunningTimeCum: sum of job running times over schedd lifetime\n\nMeanTimeToStart: mean time a job waits in schedd until first start, over stat window\nMeanRunningTime: mean running (wall-clock) time of jobs in schedd, over stat window\n\nThese are now published to all daemon ads, via dc_collector:\nDetectedMemory: detected machine RAM\nDetectedCpus: detected machine cpus/cores\n</pre></div>\n\n\n<p></p><hr/>\n<em>2011-May-03 10:13:30 by nwp:</em> <br/>\n\nI reviewed the patch for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2006\" onclick=\"get_ticket_and_populate_wrapper('2006'); return false;\" title=\"RFE: publish some additional performance-related stats in schedd ad\">#2006</a></span>.  I cannot find anything obviously wrong with it.  Todd expressed concern with some of the names, especially ones that are close to existing attribute names, and the names ending in \"...Cum\".  Also Todd has expressed some desire to see that attributes are properly scoped, but my understanding is that that is a long term project.\n\n<p>I am going to push this onto <code>V7_7-publish_schedd_stats-branch</code> and send this back to Erik to revise.\n\n</p><p></p><hr/>\n<em>2011-May-10 08:26:00 by eje:</em> <br/>\n\nI'd like to get more clarity about what changes to make for inclusion -- my understanding is that name scoping is going to be tabled until classad support for namespaces.\n\n<p>On the schedd ad, I do not see any attribute names that seemed confusing to me.  There was mention of confusion between \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobsExited\" title=\"Jobs Exited\">JobsExited</a></span>\" and \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobExited\" title=\"Job Exited\">JobExited</a></span>\" however I do not see any occurrence of \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobExited\" title=\"Job Exited\">JobExited</a></span>\" on the schedd or any other ad.\n\n</p><p>The other remaining issue was \"Cum\" --&gt; \"Cumulative.\"   I propose making that change for inclusion, with name scoping to be addressed in the future with classad namespaces.\n\n</p><p></p><hr/>\n<em>2011-May-10 10:41:10 by tannenba:</em> <br/>\n\nI think the suggestion above is reasonable, e.g.\n<div class=\"blockquote\">\n<table width=\"95%\"><tbody><tr><td>\u00a0</td><td>\n  \nThe other remaining issue was \"Cum\" --&gt; \"Cumulative.\" I propose making that change for inclusion, with name scoping to be addressed in the future with classad namespaces.\n</td></tr></tbody></table></div>\n\n\n<p></p><hr/>\n<em>2011-May-15 22:07:42 by gthain:</em> <br/>\n\nThe \"a36...\" checkin causes the Windows schedd to crash on startup.\n\n<p>Also, is subclassing std::dequeue a good idea?\n\n</p><p></p><hr/>\n<em>2011-Jun-06 16:53:59 by johnkn:</em> <br/>\n\nRegarding the Cum/Cumulative.  I think it would be more likely to match naieve expectations if the windowed values had a prefix rather than the lifetime cumulative values having a suffix.  I propose Recent as the prefix. But I think Cur or Current or Window would be fine.\n\n<p>So <code>JobsSubmitted</code> becomes <code>RecentJobsSubmitted</code> and <code>JobsSubmittedCum</code> becomes <code>JobsSubmitted</code>.  I think someone who hadn't read this\n\n</p><p>Also. I think that some other name changes could make the names more clearly match the data they contain.  I suggest.\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">RecentStatWindowWidth: The value of config param WINDOWED_STAT_WIDTH at the time.\nRecentJobsStarted: Number of jobs started in stat window WINDOWED_STAT_WIDTH\nRecentJobStartedPerSec: The rate (jobs/sec) of jobs starting in stat window\nRecentJobsSubmitted: number of jobs submitted over most recent sampling window\nRecentJobsSubmittedPerSec: rate of job submission (jobs/sec) over sampling window\nRecentJobsCompleted: number of jobs completed (successfully) over sampling window\nRecentJobsCompletedPerSec: rate of successful job completions over window\nRecentJobsExited: number of jobs that exited (successful or otherwise) over window\nRecentShadowExceptions: number of shadow exceptions over window\nRecentJobxExitedWithCodeXXX: number of jobs exited with code XXX (100, 115, etc) over window\nRecentMeanJobTimeToStart: mean time a job waits in schedd until first start, over stat window\nRecentMeanJobRunningTime: mean running (wall-clock) time of jobs in schedd, over stat window\n\nJobsSubmitted: number of jobs submitted over lifetime of schedd\nJobsStarted: Number of jobs started over schedd lifetime\nJobsCompleted: number of jobs successfully completed over schedd lifetime\nJobsExited: number of jobs exited (successful or otherwise) over schedd lifetime\nShadowExceptions: number of shadow exceptions over schedd lifetime\nJobsExitedWithCodeXXX: number of jobs exited with code XXX over schedd lifetime this ad was published\n\nMeanJobTimeToStart: mean time a job waits in the schedd until first start, over schedd lifetime\nMeanJobRunningTime: mean running time for jobs in the schedd (wall-clock time), over schedd lifetime\nTotalJobTimeToStart: sum of job wait times to first start, over schedd lifetime\nTotalJobRunningTime: sum of job running times over schedd lifetime\n</pre></div>\n\n\n<p>Finally, use of minutes rather than seconds as the units of the window size strikes me as likely to cause confusion and errors.</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"stalled\" href=\"/tickets?ticket=2197\" onclick=\"get_ticket_and_populate_wrapper('2197'); return false;\" title=\"General statistics architecture for Condor\">#2197</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nGeneral statistics architecture for Condor</td></tr>\n</tbody></table>", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/304/gt2006_schedd_stats.patch\">gt2006_schedd_stats.patch</a>\n26375 bytes added by eje on 2011-Mar-29 21:04:10 UTC.\n<br/>\nPatch that implements additional scheduler statistic attributes<br/>\n</li><li><a href=\"attach_get/315/gt2006_schedd_stats.patch2\">gt2006_schedd_stats.patch2</a>\n26479 bytes added by eje on 2011-Apr-07 18:39:29 UTC.\n<br/>\nUpdated patch that includes bug-fix to push_back() that could seg-fault on empty queues.<br/>\n</li><li><a href=\"attach_get/324/gt2006_schedd_stats.patch3\">gt2006_schedd_stats.patch3</a>\n25999 bytes added by eje on 2011-Apr-15 23:16:57 UTC.\n<br/>\nUpdated logic so that cumulative exit codes do not get spuriously reset on reconfig.  Also modified instances of Insert() to Assign()<br/>\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-19 12:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27288\">[27288]</a></span>: Add <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCoreDutyCycle\" title=\"Daemon Core Duty Cycle\">DaemonCoreDutyCycle</a></span> to daemon core stats <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span>. and change default publishing flags for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> stats so that it is the only one published by default. Also add a new verbose daemon core statistic DCPumpCycle which is a full Probe of the daemon core pump with min/max/avg/std time for each cycle\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-28 09:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26156\">[26156]</a></span>: minor edit and place schedd attribute in correct alphabetical order ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2006\" onclick=\"get_ticket_and_populate_wrapper('2006'); return false;\" title=\"RFE: publish some additional performance-related stats in schedd ad\">#2006</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-16 12:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26131\">[26131]</a></span>: attempted definition for new config knob WINDOWED_STAT_WIDTH; gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2006\" onclick=\"get_ticket_and_populate_wrapper('2006'); return false;\" title=\"RFE: publish some additional performance-related stats in schedd ad\">#2006</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-16 11:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26130\">[26130]</a></span>: version history item for new schedd attributes; gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2006\" onclick=\"get_ticket_and_populate_wrapper('2006'); return false;\" title=\"RFE: publish some additional performance-related stats in schedd ad\">#2006</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-16 11:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26129\">[26129]</a></span>: alphabetize newly edited schedd attributes; gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2006\" onclick=\"get_ticket_and_populate_wrapper('2006'); return false;\" title=\"RFE: publish some additional performance-related stats in schedd ad\">#2006</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-15 12:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26128\">[26128]</a></span>: edit of new schedd attributes; gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2006\" onclick=\"get_ticket_and_populate_wrapper('2006'); return false;\" title=\"RFE: publish some additional performance-related stats in schedd ad\">#2006</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-20 17:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26107\">[26107]</a></span>: New schedd performance parameters. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2006\" onclick=\"get_ticket_and_populate_wrapper('2006'); return false;\" title=\"RFE: publish some additional performance-related stats in schedd ad\">#2006</a></span>  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-16 13:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21874\">[21874]</a></span>: Fix startup crash on windows with <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2006\" onclick=\"get_ticket_and_populate_wrapper('2006'); return false;\" title=\"RFE: publish some additional performance-related stats in schedd ad\">#2006</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2006\" onclick=\"get_ticket_and_populate_wrapper('2006'); return false;\" title=\"RFE: publish some additional performance-related stats in schedd ad\">#2006</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-13 15:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21866\">[21866]</a></span>: Publish new performance statistics for the scheduler (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2006\" onclick=\"get_ticket_and_populate_wrapper('2006'); return false;\" title=\"RFE: publish some additional performance-related stats in schedd ad\">#2006</a></span>)  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-03 10:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21776\">[21776]</a></span>: Publish schedd stats ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2006\" onclick=\"get_ticket_and_populate_wrapper('2006'); return false;\" title=\"RFE: publish some additional performance-related stats in schedd ad\">#2006</a></span> RFE: publish some additional performance-related stats in schedd ad Committer: Nathan W. Panike  (By Erik Erlandson )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Jun-06 16:53", "status": "resolved", "created": "2011-Mar-29 15:59", "fixed_version": "2011-Mar-29 15:59", "broken_version": "", "priority": "2", "subsystem": "Daemons", "assigned_to": "eje", "derived_from": "", "creator": "eje", "rust": "", "customer_group": "other", "visibility": "public", "notify": "eje@redhat.com, matt@cs.wisc.edu, tstclair@redhat.com, danb@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}