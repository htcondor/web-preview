{"id": 5017, "title": "Ticket #5017: SCHEDD per-user stats should be published in Submitter ads", "description": "<blockquote>\nThe SCHEDD keeps track of per-user Transfer stats, and can be configured to keep track of per-user job counts - These stats are all currently published in the SCHEDD ad.  It would be better if they were published in the various Submitter ads instead.</blockquote>", "remarks": "<blockquote>\n<em>2015-Apr-23 15:35:11 by bbockelm:</em> <br/>\n\nBe aware -\n\n<p>The transfer queue statistics are based on the queue setup which defaults to \"per user\".  However, locally and in CMS, we use a separate queue setup (per site).\n\n</p><p>No qualms with publishing things for the default values, but please keep the queue setup a configuration knob.\n\n</p><p></p><hr/>\n<em>2015-Apr-23 15:42:58 by johnkn:</em> <br/>\n\nI'm aware that per-user is configurable via <code>TRANSFER_QUEUE_USER_EXPR</code>, if you change that knob to be something other than the default, then that will defeat the code that attempts to lookup per-user transfer stats - with the result that you don't in-fact get transfer stats in the submitter ad.\n\n<p>Out of curiosity, what do you set <code>TRANSFER_QUEUE_USER_EXPR</code> to?\n\n</p><p></p><hr/>\n<em>2015-Apr-23 22:07:07 by bbockelm:</em> <br/>\n\nSounds good - just wanted to make sure we're on the same page.\n\n<p>I forget the precise expression, but it's something like:\n\n</p><p>TRANSFER_QUEUE_USER_EXPR = strcat( MATCH_EXP_GLIDEIN_CMSSite, \".\", Owner)\n\n</p><p></p><hr/>\n<em>2015-Jun-04 14:51:18 by johnkn:</em> <br/>\n\nWith this change, the submitter ad can now have the following transfer attributes. All attributes mean the same as the schedd attrib of the same name, but count only jobs owned by the given submitter.\n\n<p></p><div class=\"code\">\n<pre class=\"code\">FileTransferDownloadBytes = 203637409.0\nFileTransferDownloadBytesPerSecond_1m = 12916.8735739667\nFileTransferDownloadBytesPerSecond_5m = 99159.05286330295\nFileTransferFileReadLoad_1m = 6.344814202657538E-06\nFileTransferFileReadLoad_5m = 1.251884759708207E-05\nFileTransferFileReadSeconds = 0.011492\nFileTransferFileWriteLoad_1m = 3.068744711687119E-05\nFileTransferFileWriteLoad_5m = 0.0002436755219610988\nFileTransferFileWriteSeconds = 0.5464809999999999\nFileTransferMBWaitingToDownload = 0.0\nFileTransferMBWaitingToUpload = 0.0\nFileTransferNetReadLoad_1m = 0.0002422391271525464\nFileTransferNetReadLoad_5m = 0.002662238796703572\nFileTransferNetReadSeconds = 5.358821\nFileTransferNetWriteLoad_1m = 0.000270733109020532\nFileTransferNetWriteLoad_5m = 0.0005231420611959526\nFileTransferNetWriteSeconds = 0.446865\nFileTransferUploadBytes = 30646495.0\nFileTransferUploadBytesPerSecond_1m = 17052.00076728137\nFileTransferUploadBytesPerSecond_5m = 33390.8360077328\n</pre></div>\n\n\n<p>Also the following job counters\n</p><div class=\"code\">\n<pre class=\"code\">JobsAccumBadputTime = 0\nJobsAccumExceptionalBadputTime = 0\nJobsAccumExecuteTime = 62808\nJobsAccumPostExecuteTime = 0\nJobsAccumPreExecuteTime = 24\nJobsAccumRunningTime = 62832\nJobsAccumTimeToStart = 2923\nJobsBadputRuntimes = \"0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0\"\nJobsBadputSizes = \"0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0\"\nJobsCompleted = 10\nJobsCompletedRuntimes = \"0, 0, 0, 0, 0, 3, 7, 1, 0, 0, 0, 0, 0, 0, 0\"\nJobsCompletedSizes = \"0, 0, 0, 0, 0, 0, 0, 11, 0, 0, 0, 0, 0\"\nJobsExecFailed = 0\nJobsExited = 11\nJobsExitedNormally = 10\nJobsExitException = 0\nJobsKilled = 0\nJobsRunning = 30\nJobsRunningRuntimes = \"0, 0, 4, 0, 6, 5, 9, 3, 3, 0, 0, 0, 0, 0, 0\"\nJobsRunningSizes = \"8, 0, 2, 0, 0, 0, 0, 20, 0, 0, 0, 0, 0\"\nJobsShouldRequeue = 1\nJobsStarted = 10\n</pre></div>\n\n\n<p>And the follwing recent job counters.\n</p><div class=\"code\">\n<pre class=\"code\">RecentJobsAccumBadputTime = 0\nRecentJobsAccumExceptionalBadputTime = 0\nRecentJobsAccumExecuteTime = 32519\nRecentJobsAccumPostExecuteTime = 0\nRecentJobsAccumPreExecuteTime = 11\nRecentJobsAccumRunningTime = 32530\nRecentJobsAccumTimeToStart = 2210\nRecentJobsBadputRuntimes = \"0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0\"\nRecentJobsBadputSizes = \"0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0\"\nRecentJobsCompleted = 4\nRecentJobsCompletedRuntimes = \"0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0\"\nRecentJobsCompletedSizes = \"0, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0\"\nRecentJobsExecFailed = 0\nRecentJobsExited = 5\nRecentJobsExitedNormally = 4\nRecentJobsExitException = 0\nRecentJobsKilled = 0\nRecentJobsShouldRequeue = 1\nRecentJobsStarted = 8\n</pre></div>\n\n\n<p>There is a known bug in the current code such that if a jobs that have <code>+AccountingGroup</code> or <code>NiceUser</code> will be counted separately from other jobs by that user.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-04 11:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44969\">[44969]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5017\" onclick=\"get_ticket_and_populate_wrapper('5017'); return false;\" title=\"SCHEDD per-user stats should be published in Submitter ads\">#5017</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-03 14:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44944\">[44944]</a></span>: fix for previous commit for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5017\" onclick=\"get_ticket_and_populate_wrapper('5017'); return false;\" title=\"SCHEDD per-user stats should be published in Submitter ads\">#5017</a></span> that broke flocking. used MIN when I should have used MAX ===VersionHistory:None=== bug never shipped.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-27 11:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44729\">[44729]</a></span>: fix previous commit of <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5017\" onclick=\"get_ticket_and_populate_wrapper('5017'); return false;\" title=\"SCHEDD per-user stats should be published in Submitter ads\">#5017</a></span> to use const_reverse_iterator on const object.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-27 09:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44728\">[44728]</a></span>: Publish per-user stats in submitter ads <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5017\" onclick=\"get_ticket_and_populate_wrapper('5017'); return false;\" title=\"SCHEDD per-user stats should be published in Submitter ads\">#5017</a></span> This commit changes the schedd's <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=OwnerData\" title=\"Owner Data\">OwnerData</a></span> structure (used to create submitter ads) from a vector to a map and makes the structures persistent rather than having count_jobs destroy and re-create them. per-owner SCHEDD stats are created automatically and published\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Jun-05 14:30", "status": "resolved", "created": "2015-Apr-23 11:19", "fixed_version": "2015-Apr-23 11:19", "broken_version": "", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}