{"id": 5749, "title": "Ticket #5749: Pegasus problems with DAG priorities", "description": "<blockquote>\nPegasus has run into problems with the current DAG node priority scheme (which I'd like to simplify anyhow).\n\n<p>This is from Mats:\n\n</p><p>I would like to see:\n\n</p><p></p><pre>   if defined(explicit node prio):\n       // user provided a priority to use\n       effective node prio = explicit node prio\n   else:\n       // no priority specified, use the default strategy\n       effective node prio = max(parents' effective prios, DAG prio)\n</pre>\n\n<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n</p><p>Stuff after this is from Kent:\n\n</p><p>I'd actually like to simplify things even more, maybe this:\n\n</p><p></p><pre>   if defined(explicit node prio):\n       // user provided a priority to use\n       effective node prio = explicit node prio\n   else:\n       // no priority specified, use the default strategy\n       effective node prio = DAG prio\n</pre>\n\n<p>Or, maybe what I'd really like is this:\n\n</p><p></p><pre>   if defined(explicit node prio):\n       // user provided a priority to use\n       effective node prio = explicit node prio + DAG prio\n   else:\n       // no priority specified, use the default strategy\n       effective node prio = DAG prio\n</pre>\n\n<p>That would get rid of the problem of increasing your DAG priority erasing priority differences between the nodes.  I'm okay with either of the last two, though.\n\n</p><p>At any rate, I'd really like to get rid of the feature of a parent node's priority \"trickling down\" to its children -- I think that's complicated and hard to understand.  Unless someone really needs that, I'd like to simplify things in that regard...\n\n</p><p>(Having the max() function in there causes problems if we ever implement having DAGMan respond to priority changes while it's running -- I'm sure there was a ticket about that somewhere, but I can't find it now.)\n\n</p><p>Anyhow, one issue with this is how much people are using DAG priorities right now, and whether this will goof things up for them.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Jun-24 13:22:17 by wenger:</em> <br/>\n\nSounds like Mats is okay with this:\n\n<p></p><pre>   if defined(explicit node prio):\n       // user provided a priority to use\n       effective node prio = explicit node prio + DAG prio\n   else:\n       // no priority specified, use the default strategy\n       effective node prio = DAG prio\n</pre>\n\n<p>So I'm going to propose this on htcondor-users and see if anyone screams.\n\n</p><p></p><hr/>\n<em>2016-Jul-03 14:01:40 by wenger:</em> <br/>\n\nCreated V8_5-gittrac_5749-branch for this.\n\n<p></p><hr/>\n<em>2016-Jul-08 13:07:43 by wenger:</em> <br/>\n\nJust did a build/test of this -- everything is green except for 20 test failures on Debian 7 (lots of other stuff seems to be failing on Debian 7, though, so that may well not actually be a problem with the code).\n\n<p></p><hr/>\n<em>2016-Jul-29 09:46:35 by wenger:</em> <br/>\n\nMerged this with verbal okay from Zach; still needs \"official\" sign-off.\n\n<p></p><hr/>\n<em>2016-Jul-29 12:36:33 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>: Looks good.</blockquote>", "derived_tickets": "", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/952/gt5749_dif\">gt5749_dif</a>\n28164 bytes added by wenger on 2016-Jul-08 19:07:43 UTC.\n<br/>\nA diff of the whole branch at this point.<br/>\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jul-20 17:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48822\">[48822]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5749\" onclick=\"get_ticket_and_populate_wrapper('5749'); return false;\" title=\"Pegasus problems with DAG priorities\">#5749</a></span>: Added version history entry and updated priority documentation in the DAGMan section of the manual.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jul-08 09:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48752\">[48752]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5749\" onclick=\"get_ticket_and_populate_wrapper('5749'); return false;\" title=\"Pegasus problems with DAG priorities\">#5749</a></span>: Oops -- test failed because I forgot to add new config file...  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jul-07 17:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48750\">[48750]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5749\" onclick=\"get_ticket_and_populate_wrapper('5749'); return false;\" title=\"Pegasus problems with DAG priorities\">#5749</a></span>: Lots of code cleanup -- got rid of the debug code, and considerably simplified the existing priority code, added some extra cases to the priority propagation test.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jul-07 13:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48749\">[48749]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5749\" onclick=\"get_ticket_and_populate_wrapper('5749'); return false;\" title=\"Pegasus problems with DAG priorities\">#5749</a></span>: New priority scheme implemented, test changed accordingly. Code still needs cleanup.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jul-07 12:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48748\">[48748]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5749\" onclick=\"get_ticket_and_populate_wrapper('5749'); return false;\" title=\"Pegasus problems with DAG priorities\">#5749</a></span>: Priorities are now set directly by condor_submit(), instead of the kludgey way via VARS -- fixes problem with priorities getting doubly-defined in full rescue DAGs.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jul-07 11:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48747\">[48747]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5749\" onclick=\"get_ticket_and_populate_wrapper('5749'); return false;\" title=\"Pegasus problems with DAG priorities\">#5749</a></span>: Fixed bug with priority getting doubly-set in VARS on retries; various debug code in place; didn't actually change priority scheme yet.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Aug-08 15:28", "status": "resolved", "created": "2016-Jun-24 11:40", "fixed_version": "2016-Jun-24 11:40", "broken_version": "v080505", "priority": "1", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "#4024", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, vahi@isi.edu, rynge@isi.edu, zmiller@cs.wisc.edu", "due_date": ""}