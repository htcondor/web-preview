{"id": 5946, "title": "Ticket #5946: MAX_JOBS_PER_OWNER broken if job specifies an accounting_group", "description": "<blockquote>\nThe config knob <code>MAX_JOBS_PER_OWNER</code> works great at specifying a limit per owner <em>unless</em> the job specifies an <code>accounting_group</code>, in which case it is possible to exceed the limit.\n\n<p>To reproduce, simply continuously submit jobs that specify an <code>accounting_group</code>.  The schedd will refuse to accept jobs above the limit until the schedd performs <em>count_jobs()</em> (typically within a minute or less), at which point jobs will incorrectly be accepted again.  The problem appears to be that the code introduced in <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4641\" title=\"feature request: MAX_JOBS_PER_OWNER\">#4641</a></span> uses the submitter name (eg accounting principle) for past submits, and the owner name for recent submits that have occurred since the last <em>count_jobs()</em>.\n\n</p><p>Credit to INFN for reporting this bug; see <a class=\"external\" href=\"https://www-auth.cs.wisc.edu/lists/htcondor-users/2016-October/msg00001.shtml\">this thread in htcondor-users</a>.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Dec-01 13:26:38 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This change looks good.\n\n</p><p></p><hr/>\n<em>2016-Dec-01 13:29:02 by jfrey:</em> <br/>\n\nAs a follow-on in 8.7, can we rename \"owner\" variables to \"submitter\" when they actually refer to the submitter identity?</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Nov-23 11:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49631\">[49631]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5946\" title=\"MAX_JOBS_PER_OWNER broken if job specifies an accounting_group\">#5946</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5983\" title=\"REMOVE_SIGNIFICANT_ATTRIBUTES should not require a restart\">#5983</a></span>, and <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5989\" title=\"condor_gpu_discovery -config should not write to stderr\">#5989</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Oct-04 16:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49369\">[49369]</a></span>: fix bug <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5946\" title=\"MAX_JOBS_PER_OWNER broken if job specifies an accounting_group\">#5946</a></span>, MAX_JOBS_PER_OWNER broken if job specifies an accounting_group ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Dec-01 13:29", "status": "resolved", "created": "2016-Oct-04 13:07", "fixed_version": "2016-Oct-04 13:07", "broken_version": "v080307", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "johnkn", "derived_from": "#4641", "creator": "tannenba", "rust": "", "customer_group": "users", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}