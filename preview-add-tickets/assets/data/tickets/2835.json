{"id": 2835, "title": "Ticket #2835: revamp default job requirements esp given partitionable slots", "description": "<blockquote>\nThe way <code>condor_submit</code> sets up default job requirements for memory, disk, etc, is pretty convoluted and typically does not do what users expect. Especially given our push towards partitionable slots, it is time to revisit this.\n\n<p>So currently the default requirements looks like this:\n</p><div class=\"code\">\n<pre class=\"code\">Requirements =\n    ( TARGET.Disk &gt;= DiskUsage ) &amp;&amp;\n    ( ( TARGET.Memory * 1024 ) &gt;= ImageSize ) &amp;&amp;\n    ( ( RequestMemory * 1024 ) &gt;= ImageSize )\n\n RequestMemory =\n    ceiling(\n        ifThenElse(JobVMMemory =!= undefined,\n                   JobVMMemory,\n                   ImageSize / 1024.000000)\n           )\n</pre></div>\n\n\n<p>Proposed to change such that\n</p><ol>\n<li>default job requirements expression does not insert in any sub-expressions related to partitionable resources (currently memory, disk, cpu).\n</li><li>no default (in condor_submit) for <code>RequestMemory</code> etc; of course submit exprs knob could set one\n</li><li>Add <code>XxxUsage</code> for each partitionable resource, e.g. <code>MemoryUsage</code>, <code>DiskUsage</code>, that makes the units match up with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestXxx\" title=\"Request Xxx\">RequestXxx</a></span> units (e.g. everything based on Mbytes?) and references a 'best practice' attribute. So on Linux, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MemoryUsage\" title=\"Memory Usage\">MemoryUsage</a></span> = <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ResidentSetSize\" title=\"Resident Set Size\">ResidentSetSize</a></span> * xxx\n</li></ol>\n\n<p>So if and only the job ad specifies <code>RequestDisk</code> and <code>RequestMemory</code>, job requirements would look like\n</p><div class=\"code\">\n<pre class=\"code\"> Requirements = ( Disk &gt;= RequestDisk ) &amp;&amp; ( Memory &gt;= RequestMemory )\n</pre></div>\n\n<strong>NOTE: we either need to bite the bullet and make all units the same (bytes? Mbytes?) or include unit multipliers in the above</strong></blockquote>", "remarks": "<blockquote>\n<em>2012-Feb-27 21:49:49 by tstclair:</em> <br/>\n\nI think we need to add a warning on submission if no <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> is given such that the user can make sense out of it, being silent is not an option imho given that I was completely trip'd by this.\n\n<p></p><hr/>\n<em>2012-Apr-02 15:46:37 by tstclair:</em> <br/>\n\nSo this should be updated and kicked out of review per that last meeting as the defaults need to change.\n\n<p></p><hr/>\n<em>2012-Apr-25 13:13:00 by johnkn:</em> <br/>\n\nGiven this submit file\n<div class=\"code\">\n<pre class=\"code\">Executable = dummy\nUniverse = Vanilla\nQueue 1\n</pre></div>\n\ncondor_submit will now produce <code>Request*</code> and <code>Requirements</code> expressions like this:\n<div class=\"code\">\n<pre class=\"code\">RequestMemory = ifthenelse(MemoryUsage =!= undefined,MemoryUsage,1)\nRequestDisk = DiskUsage\nRequestCpus = 1\nRequirements = &lt;opsys_expr&gt; &amp;&amp; (TARGET.Disk &gt;= RequestDisk) &amp;&amp; (TARGET.Memory &gt;= RequestMemory)\n</pre></div>\n\nBy comparison, 7.6.6 would produce the following instead\n<div class=\"code\">\n<pre class=\"code\">RequestMemory = ceiling(ifThenElse(JobVMMemory =!= undefined,JobVMMemory,ImageSize / 1024.000000))\nRequestDisk = DiskUsage\nRequestCpus = 1\nRequirements = &lt;opsys_expr&gt; &amp;&amp; (TARGET.Disk &gt;= DiskUsage) &amp;&amp; ((TARGET.Memory * 1024) &gt;= ImageSize) &amp;&amp; ((RequestMemory * 1024) &gt;= ImageSize))\n</pre></div>\n\n\n<p></p><hr/>\n<em>2012-Apr-27 15:38:18 by johnkn:</em> <br/>\n\nIgor points out that we changed the policy between 7.7.5 and 7.7.6 to warn about using Memory and Disk in Requrements.  He suggests that we should give users an entire series to transition to the new policy before having condor_submit warn about it.\n\n<p>I propose that we do this.  In particular I propose\n\n</p><p></p><ul>\n<li>Create a new config knob ENABLE_SUBMIT_WARNINGS_ABOUT_UPCOMING_POLICY\nset the default value for this knob to FALSE.\n\n<p></p></li><li>Have 7.8 check this knob before warning about Memory &amp; Disk in requirements\n\n<p></p></li><li>Have 7.9 NOT check this knob before warning about Memory &amp; Disk.\n\n<p></p></li><li>At about 7.8.5 either switch the default value for this knob to TRUE, or remove the code that checks the knob for Memory &amp; Disk in requirements.\n</li></ul>\n\n<p>Also we should support Igor's use case of having a way to disable Requirements checks against memory &amp; disk entirely -\n\n</p><p></p><ul>\n<li>Add code in condor_submit to check for a <code>request_memory=undefined</code> statement in the submit file, and have it NOT add a reference to <code>RequestMemory</code> into <code>Requirements</code> in that case.</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-18 14:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32068\">[32068]</a></span>: document JOB_DEFAULT_REQUESTDISK and JOB_DEFAULT_REQUESTCPUS ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2835\" onclick=\"get_ticket_and_populate_wrapper('2835'); return false;\" title=\"revamp default job requirements esp given partitionable slots\">#2835</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-09 15:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=31985\">[31985]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2850\" onclick=\"get_ticket_and_populate_wrapper('2850'); return false;\" title=\"startd expressions to enable default rules on partitionable resources\">#2850</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2835\" onclick=\"get_ticket_and_populate_wrapper('2835'); return false;\" title=\"revamp default job requirements esp given partitionable slots\">#2835</a></span> &amp; <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2783\" onclick=\"get_ticket_and_populate_wrapper('2783'); return false;\" title=\"Add attributes to JobAd to show time spent in file transfer\">#2783</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-03 19:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=31098\">[31098]</a></span>: Added knobs JOB_DEFAULT_REQUEST[MEMORY|DISK|CPUS] to condor_submit. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2835\" onclick=\"get_ticket_and_populate_wrapper('2835'); return false;\" title=\"revamp default job requirements esp given partitionable slots\">#2835</a></span> Defaults are in the param table.  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-20 15:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=30979\">[30979]</a></span>: Update Default <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> check + add a warning. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2835\" onclick=\"get_ticket_and_populate_wrapper('2835'); return false;\" title=\"revamp default job requirements esp given partitionable slots\">#2835</a></span>  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Feb-23 11:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=30676\">[30676]</a></span>: revamp default Requirements expression in condor_submit given needs of Partitional slots. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2835\" onclick=\"get_ticket_and_populate_wrapper('2835'); return false;\" title=\"revamp default job requirements esp given partitionable slots\">#2835</a></span> comparisons to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ImageSize\" title=\"Image Size\">ImageSize</a></span> are no longer inserted into Requirements. Now omparisons to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestDisk\" title=\"Request Disk\">RequestDisk</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> are inserted if they are defined at submit time. This check-in also makes condor_submit ready\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-May-25 12:47", "status": "resolved", "created": "2012-Feb-20 15:02", "fixed_version": "2012-Feb-20 15:02", "broken_version": "", "priority": "2", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "#2842", "creator": "tannenba", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tannenba@cs.wisc.edu, danb@cs.wisc.edu, tstclair@redhat.com, bbockelm@cse.unl.edu", "due_date": ""}