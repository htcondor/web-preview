{"id": 5594, "title": "Ticket #5594: Condor directory structure in Debian 8 / RHEL 7", "description": "<blockquote>\nThere is a warning about condor home directory not existing during installation of Condor 8.5.3 on Debian 8.\n\n<p></p><pre>  Selecting previously unselected package condor.\n  Preparing to unpack .../condor_8.5.3-360850-deb8_amd64.deb ...\n  Creating group: condor\n  Adding group `condor' (GID 115) ...\n  Done.\n  Creating user: condor\n  Warning: The home dir /var/lib/condor you specified can't be accessed: No such file or directory\n  Adding system user `condor' (UID 110) ...\n  Adding new user `condor' (UID 110) with group `condor' ...\n  Not creating home directory `/var/lib/condor'.\n  Unpacking condor (8.5.3-360850-deb8) ...\n  Processing triggers for man-db (2.7.0.2-5) ...\n  Processing triggers for systemd (215-17+deb8u3) ...\n</pre>\n\n<p>This seems to trace backwards to the package's preinst and postinst scripts.\n\n</p><p></p><pre>  # from preinst\n  adduser --system --ingroup $CONDOR_GROUP --no-create-home --home $HOME --disabled-password --disabled-login $CONDOR_USER\n</pre>\n\n<p></p><pre>  # from postinst\n  change_permission() {\n          #Recreate empty dir because it is not part of the package\n          mkdir -p /var/run/condor /var/lock/condor /var/log/condor /var/lib/condor/spool /var/lib/condor/execute\n          chown -R condor:condor /var/run/condor\n          chown -R condor:condor /var/lock/condor\n          chown -R condor:condor /var/log/condor\n          chown -R condor:condor /var/lib/condor\n          chmod 1777 /var/lib/condor/execute\n  }\n</pre>\n\n<p>Personally, the \"-p\" argument to mkdir concerns me a bit. For example, the \"/var/run\" and \"/var/lock\" directory have been symlinks to \"/run\" and \"/run/lock\" since at least Debian 7. This should also start being the case in RHEL7 and maybe already was in RHEL6. So I'd rather not see Condor creating those directories if they don't exist.\n\n</p><p><a class=\"external\" href=\"https://wiki.debian.org/ReleaseGoals/RunDirectory#Overview\">Debian /run directory</a>\n<br/>\n\n<a class=\"external\" href=\"https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Migration_Planning_Guide/sect-Red_Hat_Enterprise_Linux-Migration_Planning_Guide-File_System_Layout.html#idp4755616\">RHEL 7 /run directory</a>\n\n</p><p>I think you are better off:\n\n</p><p></p><ol>\n<li>allowing the condor user to create the home directory\n<ol>\n<li>In the else part of preinst:create_user() (not quoted above), consider use of usermod to move the Condor home directory.\n</li></ol>\n</li><li>replace \"/var/run\" with \"/run\"\n</li><li>replace \"/var/lock\" with \"/run/lock\"\n</li><li>remove the \"-p\" argument to mkdir\n</li></ol>\n\n<p>But obviously you should explore this in detail.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Apr-01 09:57:41 by tpdownes:</em> <br/>\n\nPlease also see this important note in RHEL7 text on /run:\n\n<p></p><pre>  This means that applications must recreate their own files and directories on startup, rather than doing this once at installation time.\n</pre>\n\n<p>Stuart/Juan/Michael: can you please investigate what the /var/run and /run directories look like on RHEL7 and SL7? I see differing behavior between your SL7 and RHEL7 VMs and neither of them match the documented RHEL7 behavior (/run and /var/run being connected via a bind mount). Maybe your management tools don't quite match up with RHEL7 spec?\n\n</p><p></p><hr/>\n<em>2016-Apr-01 10:38:25 by tpdownes:</em> <br/>\n\nFHS 3.0 on the two directories:\n\n<p><a class=\"external\" href=\"http://refspecs.linuxfoundation.org/FHS_3.0/fhs/ch05s09.html\">http://refspecs.linuxfoundation.org/FHS_3.0/fhs/ch05s09.html</a>\n<br/>\n\n<a class=\"external\" href=\"http://refspecs.linuxfoundation.org/FHS_3.0/fhs/ch05s13.html\">http://refspecs.linuxfoundation.org/FHS_3.0/fhs/ch05s13.html</a>\n\n</p><p>Doesn't exactly match what Debian and RHEL are doing but maybe a guide. Dunno - again, there is a need to figure the right thing and the real-world thing out in detail.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "incident", "last_change": "2016-Apr-07 11:01", "status": "defer", "created": "2016-Apr-01 09:51", "fixed_version": "2016-Apr-01 09:51", "broken_version": "v080503", "priority": "5", "subsystem": "Packaging", "assigned_to": "tim", "derived_from": "", "creator": "tpdownes", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pcouvare@caltech.edu", "due_date": ""}