{"id": 1480, "title": "Ticket #1480: Remove node jobs that have been held \"too many\" times", "description": "<blockquote>\nDAGMan should remove any jobs that have gone on hold \"too many\" times.  (\"Too many\" should be user-configurable.)\n\n<p>(This came up because in the SIPHT workflows some jobs kept going on hold because of a problem with the executable, and for some reason the periodic remove expression was not working right, so the workflow got \"stuck\".)</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Jul-01 15:35:26 by wenger:</em> <br/>\n\nHmm -- we have to think about how this will work for nodes that queue more than one job.  (We can't easily keep track of the number of holds for each job proc, because we just have a data structure for the whole node.)\n\n<p></p><hr/>\n<em>2010-Jul-01 15:40:47 by wenger:</em> <br/>\n\nI just realized that the maxidle code probably won't work right for parallel jobs -- I think instead of a boolean flag for whether the node is idle, we need to keep a count of idle job procs, and compare that to the number of job procs that exist for the node...\n\n<p></p><hr/>\n<em>2010-Jul-09 11:01:24 by wenger:</em> <br/>\n\nActually, I guess for parallel jobs, we should keep a hold count for each process, and if any process exceeds the limit, remove the whole cluster.\n\n<p>Also, we need to remember to reset the count when re-trying a node.\n\n</p><p></p><hr/>\n<em>2010-Jul-09 11:36:07 by wenger:</em> <br/>\n\nI'm thinking of DAGMAN_MAX_JOB_HOLDS for the configuration macro.\n\n<p></p><hr/>\n<em>2010-Aug-02 11:39:57 by wenger:</em> <br/>\n\nThis is going into the master branch, so I changed \"fixed version\" to v070504 (from v070404).\n\n<p></p><hr/>\n<em>2010-Aug-27 12:39:03 by wenger:</em> <br/>\n\nCommitted code for this yesterday; I'm leaving the ticket open until I finish documentation.\n\n<p></p><hr/>\n<em>2010-Aug-27 15:29:11 by wenger:</em> <br/>\n\nThis is now documented, so I'm going to resolve the ticket.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Aug-27 15:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25641\">[25641]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1480\" title='Remove node jobs that have been held \"too many\" times'>#1480</a></span>: documented the new DAGMAN_MAX_JOB_HOLDS configuration variable.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Aug-27 15:29", "status": "resolved", "created": "2010-Jun-30 11:18", "fixed_version": "2010-Jun-30 11:18", "broken_version": "v070403", "priority": "1", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, psilord@cs.wisc.edu", "due_date": ""}