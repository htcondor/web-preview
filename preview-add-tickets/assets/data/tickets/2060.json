{"id": 2060, "title": "Ticket #2060: Enhance condor_preen output", "description": "<blockquote>\nCurrently condor_preen has limited output. It has a verbose flag and a flag to\ntrigger mailing of output, but\n\n<p>1) The mail flag only provides that info regarding removed files is sent\n2) The verbose output doesn't help debug problems and is not sent in mail</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Jun-20 17:54:43 by eje:</em> <br/>\n\nThe proposed patch seems to replace some calls to dprintf() with printf().  That brings up potential backward compatibility issues.\n\n<p>Given that the debug levels PREEN_{ALWAYS,VERBOSE,DEBUG} are fairly similar in flavor to the dprintf() debug bit-flags, I wonder if it would be cleaner to support the RFE inside the dprintf() universe.   It might require adding a new \"D_VERBOSE\" bit-flag, however there appear to be two currently-unused values: D_UNUSED2 and D_UNUSED3.  Given that this is a tool, it also seems possible to overload some daemon-specific flags, however I don't know if that's an allowed policy.\n\n</p><p>One impact: a dprintf() solution would support logging output to stderr, but not stdout.\n\n</p><p></p><hr/>\n<em>2011-Jun-21 13:50:39 by jrt:</em> <br/>\n\nIn my tests, the dprintf didn't work in preen. The output doesn't go anywhere. The -m flag is the config default. Condor_preen can be run as an admin tool and it already delivers printf stdout output. The printf output in the patch is an extension of that.\n\n<p></p><hr/>\n<em>2011-Jul-07 08:42:13 by tstclair:</em> <br/>\n\nD_ALL == D_VERBOSE in dprintf land.\n\n<p></p><hr/>\n<em>2011-Aug-08 11:32:50 by tstclair:</em> <br/>\n\nIn tracing, there were missing and conditional initialization to the dprintf system. Patch will be coming shortly which simply performs proper initialization, and allow the tool to behave like all others.\n\n<p></p><hr/>\n<em>2011-Aug-08 14:16:34 by tstclair:</em> <br/>\n\nPlease ignore patch when reviewing, instead look at checkin.\n\n<p></p><hr/>\n<em>2011-Aug-22 11:02:47 by gthain:</em> <br/>\n\nIn the long run, it might be nice to have a separate 'PreenLog', but I can live with TOOLLog</blockquote>", "derived_tickets": "", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/321/preen.patch\">preen.patch</a>\n13178 bytes added by jrt on 2011-Apr-12 20:39:24 UTC.\n<br/>\nI'm attaching a patch that adds a notify and debug flag and allows verbose or\ndebug output to be sent in email.\n\n<p>Usage: condor_preen [-mail] -[notify] [-remove] [-verbose] [-debug]\n\n</p><p>notify: email is sent if no \"bad\" files are found\ndebug: adds some debug information to verbose output. \n\n</p><p>added log levels\n\n</p><p>#define PREEN_ALWAYS  (1&lt;&lt;0) \n#define PREEN_VERBOSE (1&lt;&lt;1)\n#define PREEN_DEBUG   (1&lt;&lt;2)\n\n</p><p>debug includes verbose\n\n</p><p></p><hr/>\ndefault behavior found in condor_config is unchanged\nPREEN_ARGS   = -m -r \n<hr/>\nverbose output is sent\nPREEN_ARGS   = -m -r -v\n<hr/>\ndebug output is sent \nPREEN_ARGS   = -m -r -d\n<hr/>\nemail sent if no bad files found\nPREEN_ARGS   = -m -r -n\n<hr/>\nSimilarly, if using condor_preen from command line, one can drop the \"-m\" flag\nand get output on stdout.<br/>\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-09 09:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26680\">[26680]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2060\" onclick=\"get_ticket_and_populate_wrapper('2060'); return false;\" title=\"Enhance condor_preen output\">#2060</a></span> add preen output to dprintf logs.  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-08 14:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26656\">[26656]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2060\" onclick=\"get_ticket_and_populate_wrapper('2060'); return false;\" title=\"Enhance condor_preen output\">#2060</a></span> Update preen to use TOOL_LOG like other tools.  (By Timothy St. Clair )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Sep-07 11:56", "status": "resolved", "created": "2011-Apr-12 15:37", "fixed_version": "2011-Apr-12 15:37", "broken_version": "v070601", "priority": "3", "subsystem": "Tools", "assigned_to": "tstclair", "derived_from": "#2261", "creator": "jrt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu, eje@cs.wisc.edu, tstclair@redhat.com", "due_date": "20110809"}