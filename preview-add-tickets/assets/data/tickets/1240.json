{"id": 1240, "title": "Ticket #1240: Unify child reaping code in batch_test.pl", "description": "<blockquote>\nbatch_test.pl has three nearly identical blocks to handle reaping the child tests.  These should be collected into a single function called three times.  The block in question is similar to this, although the three variants are different:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">while( my $child = wait() ) {\n\t# if there are no more children, we're done\n\tlast if $child == -1;\n\n\t# record the child's return status\n\tmy $status = $?;\n\n\tif(! defined $test{$child}) {\n\t\tdebug(\"Can't find jobname for child?&lt;ignore&gt;\\n\",2);\n\t\tnext;\n\t} else {\n\t\tdebug( \"informed $child gone yeilding test $test{$child}{'program'}\\n\",2);\n\t}\n\n\tdebug( \"wait returned test&lt;$currentgroup&gt;\\n\",2);\n\t$currentgroup -= 1;\n\tdebug( \"wait returned test new size&lt;$currentgroup&gt;\\n\",2);\n\n\tmy $test_name = $test{$child}{'testname'};\n\n\tStartTestOutput($compiler,$test_name);\n\n\tCompleteTestOutput($compiler,$test_name,$child,$status, $test{$child}{'program'}, $test{$child}{'workdir'});\n\tdelete $test{$child};\n\t$hashsize = keys %test;\n\tdebug(\"Tests remaining: $hashsize\\n\",3);\n\tlast if $hashsize == 0;\n\t# if we have more tests fire off another\n\t# and don't wait for the last one\n\tdebug(\"currenttest&lt;$currenttest&gt; testspercompiler&lt;$testspercompiler&gt;\\n\",2);\n\tlast if $currenttest &lt;= $testspercompiler;\n\n} # end while\n\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2010-Oct-20 16:03:30 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.\n<hr/>\n<em>2011-Jan-27 14:46:04 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 16:01:00 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2011-May-05 15:06:06 by adesmet:</em> <br/>\n\nFix developed, testing in BATLab. Waiting for results, due 20110506\n\n<p></p><hr/>\n<em>2011-May-06 10:46:20 by adesmet:</em> <br/>\n\nFixed.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-06 10:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21802\">[21802]</a></span>: ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1240\" onclick=\"get_ticket_and_populate_wrapper('1240'); return false;\" title=\"Unify child reaping code in batch_test.pl\">#1240</a></span> ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1240\" onclick=\"get_ticket_and_populate_wrapper('1240'); return false;\" title=\"Unify child reaping code in batch_test.pl\">#1240</a></span> Unify 3 copies of same code. No version history required; this is non-user visible, testing only code.  (By Alan De Smet )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Nov-21 15:52", "status": "resolved", "created": "2010-Feb-19 17:23", "fixed_version": "2010-Feb-19 17:23", "broken_version": "v070500", "priority": "3", "subsystem": "Tests", "assigned_to": "adesmet", "derived_from": "#1214", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": "20110506"}