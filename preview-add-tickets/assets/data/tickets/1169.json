{"id": 1169, "title": "Ticket #1169: Add a lease to cached security sessions", "description": "<blockquote>\n<span class=\"section\"><h2>The Problem</h2></span>\nCached security sessions currently have an age limit, which defaults to 1 day for daemons and 60s for command-line tools.  Daemons that sometimes don't live for very long, such as the shadow or glidein daemons may therefore result in a lot of unnecessary security sessions bloating the cache.  A misconfigured command-line tool could also cause severe bloating of the cache.\n\n<p><span class=\"section\"></span></p><h2>Proposed Solution</h2>\n\n<p>To address this, we would like to add a session lease which defaults to 1 hour, but which is configurable and negotiated between client and server.  Leases are automatically extended whenever sessions are used.  Sessions which are not used for the lease time will be removed from the cache.\n\n</p><p>This allows for more aggressive garbage collection of daemon sessions without incurring greater authentication overhead in typical cases.  All daemons which communicate on a regular basis do so with a default frequency higher than once per hour.  Those that communicate less frequently than once per hour are unlikely to suffer much from reauthenticating at this low frequency.\n\n</p><p>The session lease time will be controlled by SEC_&lt;auth-level&gt;_SESSION_LEASE, which defaults to 1h in all cases.  We don't think users will need to adjust this in most cases.  The shorter of the server's and client's values will be used.  Sessions with older versions that do not support session leases will be given an infinite lease time.\n\n</p><p>The server will add a small grace period (20s by default) before expiring a session due to its lease running out.  This is the same as the server's existing treatment of expiration due to the session duration running out.\n\n</p><p><span class=\"section\"></span></p><h2>Error Handling</h2>\n\n<p>There is no in-line ACK from the server to the client when a session is requested, so we will have the client blindly renew its lease whenever it tries to use a session.  If the server does not successfully receive the request, there is therefore a possibility of the server's cached session expiring before the client's.  The error handling in this case is identical to the case where the server is restarted and therefore has lost all prior cached sessions: the server responds out-of-band to inform the client that the session is invalid.  This may result in failure of the operation that the client was attempting when using the invalid security session.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-01 17:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25240\">[25240]</a></span>: Documented addition of session leases. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1169\" title=\"Add a lease to cached security sessions\">#1169</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-01 16:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17060\">[17060]</a></span>: Added publication of the security session cache size. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1169\" title=\"Add a lease to cached security sessions\">#1169</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-01 16:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17061\">[17061]</a></span>: Added a lease to security sessions so they can be garbage collected faster. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1169\" title=\"Add a lease to cached security sessions\">#1169</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Feb-01 16:44", "status": "resolved", "created": "2010-Feb-01 14:51", "fixed_version": "2010-Feb-01 14:51", "broken_version": "v070501", "priority": "4", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "sfiligoi@fnal.gov,zmiller@cs.wisc.edu,dan@hep.wisc.edu,tannenba@cs.wisc.edu", "due_date": "20100201"}