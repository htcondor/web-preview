{"id": 6877, "title": "Ticket #6877: Warnings from gcc 8", "description": "<blockquote>\nWe get a lot of warnings when compiling with gcc 8.  Many are mostly harmless (casting a (pointer to a) function returning int to one returning void), but a few are more dangerous, like casting a (pointer to a) function returning void to one returning int.  We've gotten away with pulling random nonsense off the stack (or out of the register, depending), but we should probably stop doing that.\n\n<p>There are also a few warnings I have no intention of fixing:\n\n</p><p></p><ul>\n<li>Warnings in the standard universe, which we're no longer porting to new platforms in anticipation of its glorious demise.\n</li><li>Warnings coming from the boost external, which we're hoping to jettison anyway.\n</li><li>The warning about an unused variable code generated by yacc.\n</li><li>The use of <code>mktemp()</code> in libpthread.\n</li><li>A non-typesafe <code>memcpy()</code> in the rapidjson header.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2019-Jan-23 14:51:02 by tlmiller:</em> <br/>\n\ngeneral review:\n<ul>\n<li>How many, if any, of the function wrappers could be eliminated in favor of changing the wrapped function's signature?  (This only works for functions which aren't called from anywhere but the callback, generally.)\n</li></ul>\n\n<p>design questions:\n</p><ul>\n<li><span class=\"chng\"><a href=\"chngview?cn=55875\">[55875]</a></span> -- keep reference with explicit constructor or switch to pointer and use the implicit one?\n</li><li><span class=\"chng\"><a href=\"chngview?cn=56047\">[56047]</a></span> -- redefine reaper callbacks with pid_t?\n</li></ul>\n\n<p>potentially serious bugs (grouped by potential assignees)\n</p><ul>\n<li><span class=\"chng\"><a href=\"chngview?cn=56048\">[56048]</a></span> -- redefine reaper callbacks to return void?\n\n<p></p></li><li><span class=\"chng\"><a href=\"chngview?cn=56049\">[56049]</a></span> -- what should <code>store_pool_cred_handler()</code> return?\n</li><li><span class=\"chng\"><a href=\"chngview?cn=56050\">[56050]</a></span> -- what should <code>zkm_query_creds()</code> and <code>refresh_all_handler()</code> return?\n</li></ul>\n\n<p></p><hr/>\n<em>2019-Jan-24 16:05:20 by tlmiller:</em> <br/>\n\nSince we ignore the return value of reaper callbacks, switching their signature to return void makes sense, but would involve a lot of annoying little changes.\n\n<p>I suspect the same applies to using pid_t instead of int, so I'll just write this pair of changes up as its own sub-ticket.\n\n</p><p></p><hr/>\n<em>2019-Jan-24 16:24:31 by tlmiller:</em> <br/>\n\n<code>store_pool_cred_handler()</code>, <code>zkm_query_creds()</code>, and <code>refresh_all_handler()</code> are each only called from the command handler and were previously returning void; I surmise that the correct return value is CLOSE_STREAM.\n\n<p></p><hr/>\n<em>2019-Jan-27 18:25:58 by tlmiller:</em> <br/>\n\nMerged, hoping it continues to look good.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"tktview?tn=6882\" title=\"Fix DaemonCore reaper callback typedef\">#6882</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nFix <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> reaper callback typedef</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-24 16:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56084\">[56084]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Command handlers which previously return void probably should return CLOSE_STREAM.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-24 13:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56078\">[56078]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Fix Windows build.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-23 15:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56068\">[56068]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Commit beautification.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-23 14:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56065\">[56065]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Missed a few warnings.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-22 16:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56061\">[56061]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Fix exception signatures.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-22 16:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56060\">[56060]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Fix callback function signatures in the grid manager.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-22 15:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56059\">[56059]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Fix more callback function signatures in the starter.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-22 15:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56058\">[56058]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Fix callback function signatures in the VM universe.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-21 17:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56057\">[56057]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Correct two more callback's function signatures.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-21 17:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56056\">[56056]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Correct another callback's function signature.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-21 17:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56055\">[56055]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Correct another callback's function signature.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-21 17:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56054\">[56054]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Correct another callback's function signature.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-21 17:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56053\">[56053]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Correct another callback's function signature.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-21 17:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56052\">[56052]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Fix compiler warning (ignoring a return value should always be safe).  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-21 17:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56051\">[56051]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Fix agent_starter() declaration.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-21 17:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56050\">[56050]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Declare some credd callbacks properly. Needs code review to determine proper return values.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-21 17:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56049\">[56049]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Declare store_pool_cred_handler() properly. Needs review to determine appropriate return values.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-20 17:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56048\">[56048]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Add another type-safe wrapper. Add a type-unsafe wrapper that may mask a more serious problem (WTF was it returning before?).  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-20 17:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56047\">[56047]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) If sizeof(long) != sizeof(int) on any of platforms, the reaper wasn't going to work anyway. Maybe resignature the reaper callback as pid_t?  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-20 16:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56046\">[56046]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Replace a non-type-safe initialization with a cheaper one that is type-safe. (It may also be superflous, but there you go.)  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-11 11:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55887\">[55887]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Resolve a bunch of invalid function pointer conversions by writing one-line *FromTimer wrappers that actually return void.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-11 11:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55886\">[55886]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Correctly (if absurdly) construct the const-discarding cast to void *.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-11 11:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55885\">[55885]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Missed one of the type-unsafe MACRO_SET initializations.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-10 16:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55883\">[55883]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Fix logic error in analysis code's output routine.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-10 16:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55882\">[55882]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Don't grossly violate type safety when initializing a MACRO_SET, even if we fix it up again right away after.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-10 16:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55881\">[55881]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Suppress an absurd warning about snprintf() truncating strings (because we don't care about the return value).  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-09 18:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55878\">[55878]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Add wrapper functions to explicitly ignore return values (because our callbacks return void, not int).  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-09 18:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55877\">[55877]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Remove superfluous const from casts.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-09 18:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55876\">[55876]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Don't define track_by_associated_cgroup() if we don't have cgroups.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-09 18:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55875\">[55875]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6877\" title=\"Warnings from gcc 8\">#6877</a></span>) Reimplement HASHITER's operator =. Required by reference in structure; may be better to replace with a pointer and let the compiler generate an operator =.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Mar-19 09:54", "status": "resolved", "created": "2019-Jan-23 14:29", "fixed_version": "2019-Jan-23 14:29", "broken_version": "v080901", "priority": "3", "subsystem": "Unknown", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}