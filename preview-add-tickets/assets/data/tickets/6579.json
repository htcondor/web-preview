{"id": 6579, "title": "Ticket #6579: DAGMan does not check for .nodes.log integrity", "description": "<blockquote>\nDAGMan uses a log file, *.dag.nodes.log, to coordinate events with the schedd during the execution of a DAG. Every event cycle, DAGMan checks if the log file has grown. If so, it processes any new events that were added; if not, it carries on as if nothing has changed.\n\n<p>DAGMan uses the ReadMultipleUserLogs::detectLogGrowth() function to detect log growth. This function returns a boolean value, true or false. If the log file has shrunk, it returns false. If the log file has been erased, it returns false. So if the log file gets corrupted (ie. overwritten by the user), DAGMan just carries on and spins endlessly.\n\n</p><p>We need to change this function to detectLogStatus() or something similar, and return a ReadUserLog::FileStatus object instead. Then DAGMan should look for all varieties of statuses (growth, no change, shrunk, error) and handle them accordingly. In error situations, we should terminate the DAG immediately with a relevant error message.</p></blockquote>", "remarks": "<blockquote>\n<em>2018-Mar-12 16:54:44 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>: Looks good.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Mar-15 16:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54523\">[54523]</a></span>: Added documentation (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6579\" title=\"DAGMan does not check for .nodes.log integrity\">#6579</a></span>) (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6582\" title=\"ReadUserLog class fails to detect file overwrites\">#6582</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Mar-14 16:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54510\">[54510]</a></span>: Fixed a couple of lingering bugs (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6579\" title=\"DAGMan does not check for .nodes.log integrity\">#6579</a></span>) (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6582\" title=\"ReadUserLog class fails to detect file overwrites\">#6582</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Mar-09 11:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54473\">[54473]</a></span>: DAGMan now exits with error when log file gets corrupted (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6579\" title=\"DAGMan does not check for .nodes.log integrity\">#6579</a></span>) (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6582\" title=\"ReadUserLog class fails to detect file overwrites\">#6582</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2018-Mar-15 16:03", "status": "resolved", "created": "2018-Feb-26 10:56", "fixed_version": "2018-Feb-26 10:56", "broken_version": "", "priority": "2", "subsystem": "Dag", "assigned_to": "coatsworth", "derived_from": "", "creator": "coatsworth", "rust": "", "customer_group": "other", "visibility": "public", "notify": "coatsworth@cs.wisc.edu, zmiller@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}