{"id": 4579, "title": "Ticket #4579: isQueueSuperUser should use case-insensitive usernames on Windows", "description": "<blockquote>\nOn windows, usernames are case-insensitive. but when the SCHEDD checks to see if a username is a member of the queue super users group, it uses a case-sensitive comparison.  This problem is exacerbated by the fact that case is preserved in some parts of HTCondor but not in others, so that if a username is not defined to be all lowercase, in some places it will forced to all lowercase before comparing it to the superusers list.\n\n<p>View the admin rust queue a user comments:\nAt (roughly) line 1483 in the \\condor-8.2.1\\src\\condor_schedd.V6\\qmgmt.cpp\nfile, there is a block of code (in OwnerCheck2) that compares the usernames\n of the job owner and the entity trying to connect to the queue.  Here is the relevant code ...\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">   // Finally, compare the owner of the ad with the entity trying\n   // to connect to the queue.\n#if defined(WIN32)\n   // WIN32: user names are case-insensitive\n   if (strcasecmp(job_owner, test_owner) =3D=3D 0) {\n#else\n   if (strcmp(job_owner, test_owner) =3D=3D 0) {\n#endif\n   return true;\n   }\n\n   if (isQueueSuperUser(test_owner)) {\n      dprintf(D_FULLDEBUG, \"OwnerCheck retval 1 (success), super_user\\n\");\n      return true;\n   }\n</pre></div>\n\n\n<p>Note that the first part of this block of code in OwnerCheck2 correctly compares the two usernames on Windows platforms using a case <strong>insensitive</strong> function (strcasecmp).  However, the second part of this block of code invokes isQueueSuperUser() to test if test_owner is one of the users named in the QUEUE_SUPER_USERS macro - and, the corresponding comparison in isQueueSuperUser() is still using a case <strong>sensitive</strong> function - here is the code (in isQueueSuperUser) from (roughly) line 1306 of the same file.\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">   if( strcmp( user, super_users[i] ) =3D=3D 0 ) {\n      return true;\n   }\n</pre></div>\n\n\n<p>This code should be changed so that it uses case-insensitive comparison logic also.</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Sep-08 16:36:18 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This change looks good.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Sep-11 16:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41156\">[41156]</a></span>: minor edit to 8.2.3 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4579\" title=\"isQueueSuperUser should use case-insensitive usernames on Windows\">#4579</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Sep-09 16:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41129\">[41129]</a></span>: Version history for 8.2.3 bugfixes <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4579\" title=\"isQueueSuperUser should use case-insensitive usernames on Windows\">#4579</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4548\" title=\"job_queue.log leaking from schedd to shadow on Windows\">#4548</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4582\" title=\"param system leaks memory from allocation_pool on reconfig\">#4582</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4559\" title=\"condor_config_val -verbose shows invalid meta knob info\">#4559</a></span>, and <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4571\" title=\"can't set a .txt extension for the logs on Windows\">#4571</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Sep-08 12:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41112\">[41112]</a></span>: fix compare of user to queue superusers to be case insensitive on Windows <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4579\" title=\"isQueueSuperUser should use case-insensitive usernames on Windows\">#4579</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Sep-29 10:53", "status": "resolved", "created": "2014-Sep-08 12:32", "fixed_version": "2014-Sep-08 12:32", "broken_version": "v080201", "priority": "3", "subsystem": "", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "a27184", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}