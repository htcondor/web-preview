{"id": 5728, "title": "Ticket #5728: Sinful::addressPointsToMe() can't just compare the primary address.", "description": "<blockquote>\nIt is possible for a Sinful to end up with an IPv6 primary address for a host with both addresses.  Between two machines, this is possible based on configuration differences, e.g., PREFER_IPV4 or not; however, it is possible even on the same machine if one of the Sinfuls was not constructed by the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> classes.  For instance, HAD constructs Sinfuls by hand after resolving a hostname.  The hostname's first address is IPv6, but the HAD daemon's primary address is IPv4 because <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> tries really hard to make that true.\n\n<p>Thus, addressPointsToMe() needs to compare not just its primary address, but its addrs as well.  In particular, if the other Sinful's primary address is my primary address, or is any of my addrs addresses, the other sinful points to me.\n\n</p><p>(It may be wise to check, if the other Sinful has them, each address in its addrs, as well.)\n\n</p><p>(Also, it appears to be valid to construct a Sinful out of the string, e.g., \"hostname:9618\"; this does not resolve hostname, opening the possibility that the either side of the comparison could have a hostname rather than an IP address as the primary address.  It seems like the hostname should be resolved and the whole list of results used to compare.)</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Jun-16 15:10:42 by jfrey:</em> <br/>\n\nI ran this code change through my test case reproducing the error reported on htcondor-users, and it fixes the problem.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jun-29 14:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48700\">[48700]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5705\" onclick=\"get_ticket_and_populate_wrapper('5705'); return false;\" title=\"Add NumJobCompletions to job ad.\">#5705</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5726\" onclick=\"get_ticket_and_populate_wrapper('5726'); return false;\" title=\"Fix HAD/REPLICATION problems with shared port.\">#5726</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5728\" onclick=\"get_ticket_and_populate_wrapper('5728'); return false;\" title=\"Sinful::addressPointsToMe() can't just compare the primary address.\">#5728</a></span>) Documentation.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jun-20 14:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48589\">[48589]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5728\" onclick=\"get_ticket_and_populate_wrapper('5728'); return false;\" title=\"Sinful::addressPointsToMe() can't just compare the primary address.\">#5728</a></span>) Use new(er) config language figures to set the (new) default values for [HAD|REPLICATION]_ARGS better.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jun-16 11:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48571\">[48571]</a></span>: Squashed commit of the following: commit 1f72850da8c73037f1d7bf47fbb1b1e38bb13d81 Author: Todd L Miller &lt;tlmiller@cs.wisc.edu&gt; Date: Wed Jun 15 10:21:07 2016 -0500\u00a0[...]\n (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jun-14 17:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48557\">[48557]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5728\" onclick=\"get_ticket_and_populate_wrapper('5728'); return false;\" title=\"Sinful::addressPointsToMe() can't just compare the primary address.\">#5728</a></span>) Fix REPLICATION_LIST, as well.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jun-14 17:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48556\">[48556]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5728\" onclick=\"get_ticket_and_populate_wrapper('5728'); return false;\" title=\"Sinful::addressPointsToMe() can't just compare the primary address.\">#5728</a></span>) Change Sinful::addressPointsToMe() to check my addrs attribute if available. Change shared port endpoint to allow HAD and REPLICATION to use it. Change the HAD daemon to add its own shared port ID to the sinfuls from the HAD_LIST.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Jun-29 14:12", "status": "resolved", "created": "2016-Jun-14 11:41", "fixed_version": "2016-Jun-14 11:41", "broken_version": "", "priority": "4", "subsystem": "Libs", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, jfrey@cs.wisc.edu", "due_date": ""}