{"id": 3529, "title": "Ticket #3529: Multiple file transfer worker threads can crash daemon", "description": "<blockquote>\nThe <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> object keeps a hash table to track child processes created to perform transfers. A pointer to the hash table is a static member of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span>. An entry is inserted when a child process is created and removed when a child process is reaped. Whenever a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> object is created, the hash table allocated if it isn't already. When a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> object is destroyed, the hash table is also destroyed (and the pointer set to NULL) if it doesn't have any entries.\n\n<p>If a daemon creates two <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> objects, deletes one, then creates a child process to perform a transfer for the other object, the process crashes due to a NULL pointer deference.\n\n</p><p>We should leave the hash table in place once it's created, never deleting it. The amount of memory used by an empty table is tiny.\n\n</p><p>This problem was first observed in the condor_gridmanager and condor_ft-gahp with Bosco. Everywhere else in HTCondor, no more than one <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> object is in existence at a time. (Well, also the transfer daemon, but that's not used.)</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-14 12:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35160\">[35160]</a></span>: minor edit of 7.9.5 version history item. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3529\" onclick=\"get_ticket_and_populate_wrapper('3529'); return false;\" title=\"Multiple file transfer worker threads can crash daemon\">#3529</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-06 14:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35084\">[35084]</a></span>: Multiple file transfer worker threads can crash daemon. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3529\" onclick=\"get_ticket_and_populate_wrapper('3529'); return false;\" title=\"Multiple file transfer worker threads can crash daemon\">#3529</a></span> Don't delete the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TransThreadTable\" title=\"Trans Thread Table\">TransThreadTable</a></span> when a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> object is deleted. Other objects may be planning to use it and will assume it exists.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Mar-06 14:50", "status": "resolved", "created": "2013-Mar-06 14:34", "fixed_version": "2013-Mar-06 14:34", "broken_version": "v070901", "priority": "2", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "", "due_date": ""}