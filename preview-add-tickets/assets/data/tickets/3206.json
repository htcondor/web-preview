{"id": 3206, "title": "Ticket #3206: condor_q misses job ads when schedd version unknown", "description": "<blockquote>\nIn <code>CondorQ::fetchQueueFromHostAndProcess()</code>, <code>ExprTreeToString()</code> is called to unparse a constraint expression. When <code>useFastPath</code> is false, the unparsed string is passed to repeated calls of <code>GetNextJobByConstraint()</code>, interspersed with calls to a caller-provided function pointer. If the caller-provided function also calls ExprTreeToString(), then the constraint is overwritten and subsequent calls to GetNextJobByConstraint() use an invalid argument.\n\n<p>A user on condor-users reported a problem where, with the right arguments, condor_q printed results for only one of many ads in the schedd. Their condor_q didn't know the version of the schedd, so it used the old code path (useFastPath=false). The first call to <code>GetNextJobByConstraint()</code> had the correct unparsed constraint (<code>true</code>), but subsequent calls had the constraint string <code>\"Req</code>, due to an interspersed call of <code>ExprTreeToString()</code>.\n\n</p><p>The fix is to have <code>CondorQ::fetchQueueFromHostAndProcess()</code> copy the string returned by <code>ExprTreeToString()</code>.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-28 11:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33193\">[33193]</a></span>: super minor wording change to version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3206\" onclick=\"get_ticket_and_populate_wrapper('3206'); return false;\" title=\"condor_q misses job ads when schedd version unknown\">#3206</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-22 15:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33135\">[33135]</a></span>: condor_q misses job ads when schedd version unknown <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3206\" onclick=\"get_ticket_and_populate_wrapper('3206'); return false;\" title=\"condor_q misses job ads when schedd version unknown\">#3206</a></span> When using the old schedd query interface in CondorQ::fetchQueueFromHostAndProcess(), the unparsed constraint string can become corrupted if the caller-provided function pointer calls ExprTreeToString(). As a result, we may not get all of the\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Aug-22 15:06", "status": "resolved", "created": "2012-Aug-22 14:54", "fixed_version": "2012-Aug-22 14:54", "broken_version": "v070800", "priority": "4", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "users", "visibility": "public", "notify": "", "due_date": ""}