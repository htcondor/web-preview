{"id": 5957, "title": "Ticket #5957: startd policies always_run_jobs and limit_job_runtimes do not work", "description": "<blockquote>\nOn an execute node one of whose config.d files contains\n\n<p></p><div class=\"verbatim\">\n<pre>use POLICY:Always_Run_Jobs\nuse POLICY:Limit_Job_Runtimes\nMAX_JOB_RUNTIME = (24*$(HOUR))\n</pre></div>\n\n\n<p>and in condor_config\n\n</p><p></p><div class=\"verbatim\">\n<pre>MINUTE = 60\nHOUR   = (60 * $(MINUTE))\nDAY    = (24 * $(HOUR))\n</pre></div>\n\n\n<p>we observe that jobs are not, in fact, retired after 24 hours as the documentation for 8.5.7 (p. 193 in the PDF) claims.\n\n</p><p></p><div class=\"verbatim\">\n<pre>slot2_15@execute2024.nemo.uwm.edu LINUX      X86_64 Claimed   Retiring  2.860  2048  4+21:56:33\n</pre></div>\n\n\n<p>The <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StartLog\" title=\"Start Log\">StartLog</a></span> on the node.\n\n</p><p></p><div class=\"verbatim\">\n<pre>10/05/16 12:09:27 slot2_15: Got activate_claim request from shadow (172.20.1.34)\n10/05/16 12:09:28 slot2_15: Remote job ID is 1126438.0\n10/05/16 12:09:28 slot2_15: Got universe \"VANILLA\" (5) from request classad\n10/05/16 12:09:28 slot2_15: State change: claim-activation protocol successful\n10/05/16 12:09:28 slot2_15: Changing activity: Idle -&gt; Busy\n10/05/16 12:09:38 slot2_15: Called deactivate_claim_forcibly()\n10/05/16 12:09:38 slot2_15: State change: starter exited\n10/05/16 12:09:38 slot2_15: Changing activity: Busy -&gt; Idle\n10/05/16 12:09:39 slot2_15: Got activate_claim request from shadow (172.20.1.34)\n10/05/16 12:09:39 slot2_15: Remote job ID is 1126475.1\n10/05/16 12:09:39 slot2_15: Got universe \"VANILLA\" (5) from request classad\n10/05/16 12:09:39 slot2_15: State change: claim-activation protocol successful\n10/05/16 12:09:39 slot2_15: Changing activity: Idle -&gt; Busy\n10/06/16 12:09:42 slot2_15: State change: PREEMPT is TRUE\n10/06/16 12:09:42 slot2_15: Changing activity: Busy -&gt; Retiring\n</pre></div>\n\n\n<p>And nothing more (it's still retiring). I intend to explore the definitions of these policies to figure out why, but the documentation seems fairly clear that these policies should allow jobs to run until the time limit, but no more.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Oct-11 10:36:00 by tpdownes:</em> <br/>\n\nCould <code>ALLOW_PSLOT_PREEMPTION = True</code> on the negotiator affected this? Recall I'm running 8.5.7 so it doesn't also need to be set elsewhere. Would this configuration setting linger in its behavior even if it were condor_reconfig'd to <code>False</code>?\n\n<p></p><hr/>\n<em>2016-Oct-12 11:50:26 by tpdownes:</em> <br/>\n\n<div class=\"strike\">\n<strike>Because the job is essentially immediately entering the Retiring state, I suspect a race condition between job start and =EnteredCurrentActivity=.</strike></div>\n\n\n<p>Woops! Missed the change in day in the logs! It is nevertheless a fact that I am having jobs remain Retiring for a long time. Presumably until the job exits. Are these startd policies missing knobs necessary to actually limit the job runtimes?\n\n</p><p></p><hr/>\n<em>2016-Oct-12 13:30:26 by gthain:</em> <br/>\n\nNote that LIMIT_JOB_RUNTIMES needs to set <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxJobRetirementTime\" title=\"Max Job Retirement Time\">MaxJobRetirementTime</a></span>\n\n<p></p><hr/>\n<em>2016-Oct-12 13:35:06 by tlmiller:</em> <br/>\n\nLooks like Limit_Job_Runtime doesn't set MAXJOBRETIREMENTTIME, which trumps the PREEMPT knob it does set.  Since Always_Run_Jobs sets MAXJOBRETIREMENTTIME to MAX_SIGNED_INT (or thereabouts), Limit_Job_Runtime doesn't actually limit job run time.\n\n<p>Do we also need to add the Retiring state to the PREEMPT expression?</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "todo", "last_change": "2016-Oct-12 13:35", "status": "defer", "created": "2016-Oct-11 10:16", "fixed_version": "2016-Oct-11 10:16", "broken_version": "v080507", "priority": "5", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "tpdownes", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pcouvare@caltech.edu", "due_date": ""}