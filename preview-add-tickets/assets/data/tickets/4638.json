{"id": 4638, "title": "Ticket #4638: Disk space machine attributes on Windows are incorrect", "description": "<blockquote>\nDisk attributes in the startd ad (aka <code>Disk,TotalDisk,TotalSlotDisk</code>) on Windows are incorrectly being reported in bytes.  They should be reported in kilobytes.  Note they are correctly in kbytes on Linux.\n\n<p>Furthermore, although we have not been able to reproduce it, Nate reported an instance where <code>TotalDisk</code> is being incorrectly reported with a value capped at 2^31 (2147483647).  That can happen if any part of the path of the machine ad from the STARTD to condor_status\ndoesn't support 64bit integers (which we added in 8.1); there may still be some codepaths (visible via comments or compiler fixme flags) that still cap integer values at 2^31 leftover from the days before we supported 64bit integers in classads.</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Oct-06 16:59:10 by tannenba:</em> <br/>\n\nNate's current workaround is to request 1024x more disk in his submit file than required.  This works because he is only submitting to a bunch of Windows machines running the same version of HTCondor.  Of course, once this bug is fixed, he will need to chance his submit file.\n\n<p></p><hr/>\n<em>2014-Oct-08 14:54:08 by nyehle:</em> <br/>\n\nHi increasing disk space by 1024 doesn't seem to match any machines, 20000000 (20gb) matches but 204800000000 does not match any slots.  for now I will fill up the disks and then exclude machines that are close to full by hand.\n-Nate\n\n<p></p><hr/>\n<em>2014-Oct-09 11:23:28 by johnkn:</em> <br/>\n\nThis was introduced as part of fixing <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1784\" onclick=\"get_ticket_and_populate_wrapper('1784'); return false;\" title=\"Newer hard disks may exceed MAX_INT in available size\">#1784</a></span>, it's a silly bug. some unnecessarily complicated and obscure code to 1024 was removed (rather than being replaced with better code)\n\n<p></p><hr/>\n<em>2014-Nov-07 09:42:48 by gthain:</em> <br/>\n\n<strong>CODE REVIEW</strong>  Approved.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-06 11:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41592\">[41592]</a></span>: minor edit of 8.2.4 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4638\" onclick=\"get_ticket_and_populate_wrapper('4638'); return false;\" title=\"Disk space machine attributes on Windows are incorrect\">#4638</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-06 09:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41589\">[41589]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4638\" onclick=\"get_ticket_and_populate_wrapper('4638'); return false;\" title=\"Disk space machine attributes on Windows are incorrect\">#4638</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4634\" onclick=\"get_ticket_and_populate_wrapper('4634'); return false;\" title=\"condor_kbdd heap corruption\">#4634</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3572\" onclick=\"get_ticket_and_populate_wrapper('3572'); return false;\" title=\"Daylight savings time causes master to restart on Windows\">#3572</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-24 13:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41466\">[41466]</a></span>: fix off by 1024 in reporting disk space on Windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4638\" onclick=\"get_ticket_and_populate_wrapper('4638'); return false;\" title=\"Disk space machine attributes on Windows are incorrect\">#4638</a></span> ===VersionHistory:Pending=== Committer: Todd L Miller  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-09 11:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41360\">[41360]</a></span>: fix off by 1024 in reporting disk space on Windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4638\" onclick=\"get_ticket_and_populate_wrapper('4638'); return false;\" title=\"Disk space machine attributes on Windows are incorrect\">#4638</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Nov-07 10:09", "status": "resolved", "created": "2014-Oct-06 16:57", "fixed_version": "2014-Oct-06 16:57", "broken_version": "v080202", "priority": "2", "subsystem": "Win32", "assigned_to": "gthain", "derived_from": "", "creator": "tannenba", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "nyehle@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}