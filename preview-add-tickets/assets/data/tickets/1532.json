{"id": 1532, "title": "Ticket #1532: Parallel universe jobs must have spool directories", "description": "<blockquote>\nAs detailed in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=749\" onclick=\"get_ticket_and_populate_wrapper('749'); return false;\" title=\"Schedd creates unnecessary job spool dirs\">#749</a></span>, operations on unnecessary job sandbox directories have terrible performance consequences on shared filesystems.  The fix applied in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=749\" onclick=\"get_ticket_and_populate_wrapper('749'); return false;\" title=\"Schedd creates unnecessary job spool dirs\">#749</a></span> eliminated many cases in which the schedd and shadow spuriously expected a job sandbox directory to exist.  Unfortunately, some jobs (specifically parallel universe jobs, which depend on chirp) require spool directories in order to run.  We can identify these jobs; they are ones that have WantIOProxy set in the job ad.\n\n<p>The following description is copied from <a class=\"external\" href=\"https://bugzilla.redhat.com/show_bug.cgi?id=549432\">Red Hat Bugzilla</a>:\n\n</p><p></p><div class=\"blockquote\">\n<table width=\"95%\"><tbody><tr><td>\u00a0</td><td>\n  \nProblems related to /usr/libexec/condor/sshd.sh from condor-7.4.1-0.7.el5.\n</td></tr></tbody></table></div>\n\n\n<p></p><div class=\"blockquote\">\n<table width=\"95%\"><tbody><tr><td>\u00a0</td><td>\n  \nProblem #1 - sshd.sh's use of condor_chirp assumes the previous creation of a\nspool temp directory.  In our shared NFS environment, we've worked with the\nfolks to prevent schedd from making those temp directories.\n</td></tr></tbody></table></div>\n\n\n<p></p><div class=\"blockquote\">\n<table width=\"95%\"><tbody><tr><td>\u00a0</td><td>\n  \nProblem #2 - I tested anyway working around problem #1 with a \"condor_submit\n-spool\", and the job experienced further problems.  I've attached the spooled\n_condor_stderr file in the schedd area, if you look at line 103 you'll see that\ncondor_chirp is getting a \\001 character appended to the returned ClassAd value\nof EnteredCurrentStatus.  This causes the next condor_chirp put to fail,\nfailing the job in a hanging-like state.\n</td></tr></tbody></table></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Jul-23 09:10:24 by willb:</em> <br/>\n\nThis is fixed in 7.4.3.  Ticket <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=1517\" onclick=\"get_ticket_and_populate_wrapper('1517'); return false;\" title='Unify \"do I use sandboxing/file transfer\" logic in schedd and shadow'>#1517</a></span> is targeted at finding a more permanent fix for the issue of whether or not to use job sandboxing.\n\n<p></p><hr/>\n<em>2010-Aug-31 09:53:04 by willb:</em> <br/>\n\nA less conservative fix for this issue is in V7_4-branch.  Specifically, the less conservative fix does not necessarily create spool directories for jobs using Chirp, but it does for parallel universe jobs (whose scripts require a spool).</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Aug-31 09:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18898\">[18898]</a></span>: Ensures that only parallel universe jobs (not merely all jobs using Chirp/WantIOProxy) will create job spool directories. Provides the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRequiresSandbox\" title=\"Job Requires Sandbox\">JobRequiresSandbox</a></span> attribute, for jobs to specify that they require a job spool directory. <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRequiresSandbox\" title=\"Job Requires Sandbox\">JobRequiresSandbox</a></span> will trump <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NeverCreateJobSandbox\" title=\"Never Create Job Sandbox\">NeverCreateJobSandbox</a></span>.\u00a0[...]\n (By Will Benton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jul-22 09:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18615\">[18615]</a></span>: The shadow will now create a file transfer object for jobs that set WANT_IO_PROXY. Related to ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1532\" onclick=\"get_ticket_and_populate_wrapper('1532'); return false;\" title=\"Parallel universe jobs must have spool directories\">#1532</a></span>. (By Will Benton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jul-22 09:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18614\">[18614]</a></span>: The schedd now creates spool directories for parallel uni jobs with WantIOProxy set. Related to ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1532\" onclick=\"get_ticket_and_populate_wrapper('1532'); return false;\" title=\"Parallel universe jobs must have spool directories\">#1532</a></span>.  (By Will Benton )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Aug-31 09:53", "status": "resolved", "created": "2010-Jul-23 09:08", "fixed_version": "2010-Jul-23 09:08", "broken_version": "v070400", "priority": "4", "subsystem": "Daemons", "assigned_to": "willb", "derived_from": "", "creator": "willb", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}