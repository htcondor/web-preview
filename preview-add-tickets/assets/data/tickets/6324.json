{"id": 6324, "title": "Ticket #6324: Execute directory cannot be an ImDisk ramdrive on Windows", "description": "<blockquote>\nA user at HTCondor Hamburg and also on condor-users reported that when he puts his execute directory on a Windows ramdrive using the <code>ImDisk</code> virtual disk driver. The HTCondor STARTD will abort on startup, The Start log has the following messages\n\n<p>The entries in the <code>StartLog</code>:\n</p><div class=\"verbatim\">\n<pre>06/22/17 14:07:08 sysapi_partition_id: GetVolumeNameForVolumeMountPoint error: 4390\n06/22/17 14:07:08 ERROR \"Failed to get partition id for SLOT1_EXECUTE=X:\\Execute\" at line 81 in file C:\\condor\\execute\\dir_14532\\sources\\src\\condor_startd.V6\\slot_builder.cpp\n</pre></div>\n\n\n<p>This happens because the <code>ImDisk</code> driver doesn't pretend to be an actual disk and therefore, <code>GetVolumeNameForMountPoint</code> returns <code>ERROR_NOT_A_REPARSE_POINT</code>. The STARTD treats this as a fatal error, but it doesn't need to.  The STARTD only needs to have a unique id for each 'partition' so it can avoid having to get the free disk individually for every slot.  If we change the sysapi code to log this error but then treat the drive letter as if it were the partition id, then the rest of the STARTD code would work correctly.</p></blockquote>", "remarks": "<blockquote>\n<strong>CODE REVIEW:</strong> Looks good. Still need version history.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jul-31 16:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51971\">[51971]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6344\" onclick=\"get_ticket_and_populate_wrapper('6344'); return false;\" title=\"Cross-protocol CCB should not cause schedd or shadow to EXCEPT\">#6344</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6324\" onclick=\"get_ticket_and_populate_wrapper('6324'); return false;\" title=\"Execute directory cannot be an ImDisk ramdrive on Windows\">#6324</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6308\" onclick=\"get_ticket_and_populate_wrapper('6308'); return false;\" title=\"parallel universe doesn't support partitionable slots well\">#6308</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6343\" onclick=\"get_ticket_and_populate_wrapper('6343'); return false;\" title=\"Collector Python plugin has undefined symbols\">#6343</a></span>  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-27 12:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51809\">[51809]</a></span>: fix <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6324\" onclick=\"get_ticket_and_populate_wrapper('6324'); return false;\" title=\"Execute directory cannot be an ImDisk ramdrive on Windows\">#6324</a></span>, have sysapi on Windows use the drive letter as the partition id when the volume name is not available because the volume path is not a reparse point. This allows the use of the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ImDisk\" title=\"Im Disk\">ImDisk</a></span> ramdrive as the execute directory. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Jul-31 15:21", "status": "resolved", "created": "2017-Jun-27 12:25", "fixed_version": "2017-Jun-27 12:25", "broken_version": "v080000", "priority": "3", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "users", "visibility": "public", "notify": "", "due_date": ""}