{"id": 2386, "title": "Ticket #2386: Add file transfer to BOSCO", "description": "<blockquote>\nBOSCO needs to support file transfer.\n\n<p>The work for this ticket lives on <code>V7_9-bosco_file_xfer-publicbranch</code> in git.\n\n</p><p><span class=\"subsection\"></span></p><h3>Milestones </h3>\n\n<p></p><ul>\n<li>[2 days] Become familiar with relevant pre-existing file-transfer code [Zach]\n</li><li>[3 days] Add send/receive sandbox handlers to transferd [Zach]\n</li><li>[5 days] Write sandbox management gahp [Zach]\n</li><li>Modify gridmanager [Jaime]\n<ul>\n<li>[2 days] Add transferd management code (using existing code in the schedd as a template)\n</li><li>[2 days] Add handlers for new gahp commands\n</li><li>[5 days] Add sandbox movement to pbs/lsf job workflow, with particular attention paid to proper recovery\n</li></ul>\n</li><li>[4 days] Testing [Zach]\n</li></ul>\n\n<p></p><div>\n<table border=\"1\" cellpadding=\"2\" cellspacing=\"0\" summary=\"EMBED: Status Table of Derived Tickets\">\n<caption>\n  <a href=\"rptview?rn=86\" rel=\"nofollow\" title=\"EMBED: Status Table of Derived Tickets\">EMBED: Status Table of Derived Tickets</a>\n</caption>\n<tbody><tr>\n<td colspan=\"11\"><form action=\"rptview\" method=\"GET\">\n<input name=\"rn\" type=\"hidden\" value=\"86\"/>\nTN: <input name=\"TN\" type=\"text\" value=\"2386\"/>\n<input type=\"submit\" value=\"Go\"/>\n</form></td></tr> \n<tr>\n<th><a href=\"rptview?rn=86&amp;order_by=2&amp;order_dir=ASC&amp;TN=2386\">Developer</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=3&amp;order_dir=ASC&amp;TN=2386\">#</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=4&amp;order_dir=ASC&amp;TN=2386\">Status</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=5&amp;order_dir=ASC&amp;TN=2386\">Type</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=6&amp;order_dir=ASC&amp;TN=2386\">Pri</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=7&amp;order_dir=ASC&amp;TN=2386\">Created</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=8&amp;order_dir=ASC&amp;TN=2386\">Changed</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=9&amp;order_dir=ASC&amp;TN=2386\">Target</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=10&amp;order_dir=ASC&amp;TN=2386\">Due Date</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=11&amp;order_dir=ASC&amp;TN=2386\">Days left</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=12&amp;order_dir=ASC&amp;TN=2386\">Title</a></th>\n</tr>\n<tr bgcolor=\"#c8c8c8\">\n<td valign=\"top\">\nzmiller\n</td>\n<td valign=\"top\"><a href=\"tktview?tn=3031,86\">3031</a></td>\n<td valign=\"top\">\nresolved\n</td>\n<td valign=\"top\">\nenhance\n</td>\n<td valign=\"top\">\n2\n</td>\n<td valign=\"top\">\n2012 Jun\n</td>\n<td valign=\"top\">\n2012 Sep\n</td>\n<td valign=\"top\">\nv070901\n</td>\n<td valign=\"top\">\n2012-06-06\n</td>\n<td valign=\"top\">\n-3409.9\n</td>\n<td valign=\"top\">\nbecome familiar with the exisint file-transfer-code\n</td>\n</tr>\n<tr bgcolor=\"#c8c8c8\">\n<td valign=\"top\">\njfrey\n</td>\n<td valign=\"top\"><a href=\"tktview?tn=3035,86\">3035</a></td>\n<td valign=\"top\">\nresolved\n</td>\n<td valign=\"top\">\nenhance\n</td>\n<td valign=\"top\">\n2\n</td>\n<td valign=\"top\">\n2012 Jun\n</td>\n<td valign=\"top\">\n2012 Sep\n</td>\n<td valign=\"top\">\nv070901\n</td>\n<td valign=\"top\">\n2012-06-12\n</td>\n<td valign=\"top\">\n-3403.9\n</td>\n<td valign=\"top\">\nAdd handlers for BOSCO file transfer commands in gridmanager\n</td>\n</tr>\n<tr bgcolor=\"#c8c8c8\">\n<td valign=\"top\">\njfrey\n</td>\n<td valign=\"top\"><a href=\"tktview?tn=3034,86\">3034</a></td>\n<td valign=\"top\">\nresolved\n</td>\n<td valign=\"top\">\nenhance\n</td>\n<td valign=\"top\">\n2\n</td>\n<td valign=\"top\">\n2012 Jun\n</td>\n<td valign=\"top\">\n2012 Sep\n</td>\n<td valign=\"top\">\nv070901\n</td>\n<td valign=\"top\">\n2012-06-20\n</td>\n<td valign=\"top\">\n-3395.9\n</td>\n<td valign=\"top\">\nAdd transferd management code to gridmanager\n</td>\n</tr>\n<tr bgcolor=\"#c8c8c8\">\n<td valign=\"top\">\njfrey\n</td>\n<td valign=\"top\"><a href=\"tktview?tn=3036,86\">3036</a></td>\n<td valign=\"top\">\nresolved\n</td>\n<td valign=\"top\">\nenhance\n</td>\n<td valign=\"top\">\n2\n</td>\n<td valign=\"top\">\n2012 Jun\n</td>\n<td valign=\"top\">\n2012 Sep\n</td>\n<td valign=\"top\">\nv070901\n</td>\n<td valign=\"top\">\n2012-07-11\n</td>\n<td valign=\"top\">\n-3374.9\n</td>\n<td valign=\"top\">\nAdd sandbox movement to pbs/lsf workflow in gridmanager\n</td>\n</tr>\n<tr bgcolor=\"#c8c8c8\">\n<td valign=\"top\">\nzmiller\n</td>\n<td valign=\"top\"><a href=\"tktview?tn=3033,86\">3033</a></td>\n<td valign=\"top\">\nresolved\n</td>\n<td valign=\"top\">\nenhance\n</td>\n<td valign=\"top\">\n2\n</td>\n<td valign=\"top\">\n2012 Jun\n</td>\n<td valign=\"top\">\n2012 Sep\n</td>\n<td valign=\"top\">\nv070901\n</td>\n<td valign=\"top\">\n2012-07-16\n</td>\n<td valign=\"top\">\n-3369.9\n</td>\n<td valign=\"top\">\nWrite sandbox management gahp\n</td>\n</tr>\n<tr bgcolor=\"#c8c8c8\">\n<td valign=\"top\">\nzmiller\n</td>\n<td valign=\"top\"><a href=\"tktview?tn=3038,86\">3038</a></td>\n<td valign=\"top\">\nresolved\n</td>\n<td valign=\"top\">\nenhance\n</td>\n<td valign=\"top\">\n3\n</td>\n<td valign=\"top\">\n2012 Jun\n</td>\n<td valign=\"top\">\n2012 Sep\n</td>\n<td valign=\"top\">\nv070901\n</td>\n<td valign=\"top\">\n2012-07-30\n</td>\n<td valign=\"top\">\n-3355.9\n</td>\n<td valign=\"top\">\nTest BOSCO file transfer\n</td>\n</tr>\n<tr bgcolor=\"#c8c8c8\">\n<td valign=\"top\">\njfrey\n</td>\n<td valign=\"top\"><a href=\"tktview?tn=3293,86\">3293</a></td>\n<td valign=\"top\">\nresolved\n</td>\n<td valign=\"top\">\nenhance\n</td>\n<td valign=\"top\">\n4\n</td>\n<td valign=\"top\">\n2012 Oct\n</td>\n<td valign=\"top\">\n2013 Jan\n</td>\n<td valign=\"top\">\nv070903\n</td>\n<td valign=\"top\">\u00a0</td>\n<td valign=\"top\">\u00a0</td>\n<td valign=\"top\">\nTunnel Bosco file transfers over ssh\n</td>\n</tr>\n</tbody></table></div>\n\n\n<p><span class=\"section\"></span></p><h2>History </h2>\n\n<p><span class=\"subsection\"></span></p><h3>Design considerations</h3>\n\n<p>These are the design considerations, in approximate order of importance. They will guide the approach we decide to take. Many of these are preferences, not requirements. 'A' is the initial submit machine. 'B' is the PBS/LSF frontend node.\n\n</p><p></p><ul>\n<li>No reverse connections (B to A)\n</li><li>No security setup beyond ssh authentication\n</li><li>Minimize amount of new code\n</li><li>At least same level of service as Condor-C -&gt; blahp\n<ul>\n<li>Currently, Condor-C -&gt; blahp transfers back all input and output files if <span class=\"wiki\"><a href=\"wiki?p=TransferOutputFiles\" title=\"Transfer Output Files\">TransferOutputFiles</a></span> isn't set. Do we want to improve this?\n</li></ul>\n</li><li>No independent, long-lived processes on B\n<ul>\n<li>Either short-lived or tied to ssh connection\n</li></ul>\n</li><li>Avoid secondary connections (A to B)\n</li><li>Avoid additional software installation on B (none as root)\n</li><li>Avoid additional software installation on A (none as root)\n</li><li>Avoid use of extra ports on B for incoming connections\n</li><li>Avoid connection per file transfer\n</li></ul>\n\n<p><span class=\"subsection\"></span></p><h3>Design Choices</h3>\n\n<p>Fuse Mount FS of B on A\n</p><ul>\n<li>Modify gridmanager to copy files around (4 days)\n</li><li>Modify gridmanager to create fuse mount (3 days)\n</li><li>Modify <span class=\"wiki\"><a href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> to provide lists of source and destination paths (2 days)\n</li><li>Requires kernel module on A; on most distros it is as easy as installing a package, but unfortunately that package is not typically installed by default.\n</li><li>Easier to add support to bring back changed files\n</li><li>Use one connection to transfer all files\n</li></ul>\n\n<p>Scp Files From A to B\n</p><ul>\n<li>Modify gridmanager to scp files around (6 days)\n</li><li>Modify <span class=\"wiki\"><a href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> to provide lists of source and destination paths (2 days)\n</li><li>Uses new connection per transfer\n</li><li>Cumbersome to avoid transferring unmodified input files, and/or transferring back changed/created files (need to ssh ls, then scp).\n</li></ul>\n\n<p>Invoke FileTransfer-based tool on B\n</p><ul>\n<li>Modify gridmanager to launch tool and use <span class=\"wiki\"><a href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> with it (5 days)\n</li><li>Write file transfer tool (5 days)\n</li><li>Requires extra port on B (with security) or uses new connection per transfer or handles multiple requests over stdin/stdout\n</li><li><span class=\"wiki\"><a href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> already handles most details\n</li><li>Tool would require Condor config file or have extra modifications to not require it\n</li></ul>\n\n<p>Add file transfer commands to blahp\n</p><ul>\n<li>Modify gridmanager to do file transfers via blahp (5 days)\n</li><li>Add file transfer commands to blahp (5 days)\n</li><li>Can't parallelize large file transfers with other activities\n</li><li>Currently pipe to a gahp is a command channel; this would confuse the role of this communication channel from command only to command and/or data... probably not a good idea.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3031\" onclick=\"get_ticket_and_populate_wrapper('3031'); return false;\" title=\"become familiar with the exisint file-transfer-code\">#3031</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nbecome familiar with the exisint file-transfer-code</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=3032\" onclick=\"get_ticket_and_populate_wrapper('3032'); return false;\" title=\"Add send/receive sandbox handlers to transferd\">#3032</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd send/receive sandbox handlers to transferd</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3033\" onclick=\"get_ticket_and_populate_wrapper('3033'); return false;\" title=\"Write sandbox management gahp\">#3033</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nWrite sandbox management gahp</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3034\" onclick=\"get_ticket_and_populate_wrapper('3034'); return false;\" title=\"Add transferd management code to gridmanager\">#3034</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd transferd management code to gridmanager</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3035\" onclick=\"get_ticket_and_populate_wrapper('3035'); return false;\" title=\"Add handlers for BOSCO file transfer commands in gridmanager\">#3035</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd handlers for BOSCO file transfer commands in gridmanager</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3036\" onclick=\"get_ticket_and_populate_wrapper('3036'); return false;\" title=\"Add sandbox movement to pbs/lsf workflow in gridmanager\">#3036</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd sandbox movement to pbs/lsf workflow in gridmanager</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3038\" onclick=\"get_ticket_and_populate_wrapper('3038'); return false;\" title=\"Test BOSCO file transfer\">#3038</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nTest BOSCO file transfer</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3293\" onclick=\"get_ticket_and_populate_wrapper('3293'); return false;\" title=\"Tunnel Bosco file transfers over ssh\">#3293</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nTunnel Bosco file transfers over ssh</td></tr>\n</tbody></table>", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/572/BoscoFileTransfer_v4.doc\">BoscoFileTransfer_v4.doc</a>\n34816 bytes added by tannenba on 2012-Jun-05 15:24:57 UTC.\n<br/>\nbosco file transfer design document<br/>\n</li></ul>\n</blockquote>", "check_ins": "", "type": "enhance", "last_change": "2012-Sep-25 17:19", "status": "resolved", "created": "2011-Aug-15 13:16", "fixed_version": "2011-Aug-15 13:16", "broken_version": "", "priority": "3", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "#1938", "creator": "jfrey", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": "20120730"}