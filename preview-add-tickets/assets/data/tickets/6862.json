{"id": 6862, "title": "Ticket #6862: scitokens: admin cannot define hostname:port of credmon webserver", "description": "<blockquote>\nCurrently, if an admin wants to run the credmon webserver, condor assumes it to be running at the root of the webserver, which is accessed at the FQDN under port 443 (i.e. <a class=\"external\" href=\"https://&lt;fqdn_of_submit_host&gt;/\">https://&lt;fqdn_of_submit_host&gt;/</a>). The admin should be able to modify this in case the webserver is running on a different port or if the webserver is hosted under a subdirectory (e.g. <a class=\"external\" href=\"https://mydomain.edu:8443/credmon_app/\">https://mydomain.edu:8443/credmon_app/</a>).\n\n<p>Currently, there is an undocumented knob, ZKMHOST, that can do this, but we should make it more obvious. See lines 294-304 in <a class=\"file\" href=\"rlog?f=src/condor_credd/credd.cpp\">/src/condor_credd/credd.cpp</a> . Maybe we can call it CREDMON_WEBSERVER_HOST, which will default to the FQDN if unspecified.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Jan-16 20:32:57 by bbockelm:</em> <br/>\n\nTwo cents:\n\n<p></p><ol>\n<li>It's not a hostname, it's a URL prefix.\n</li><li>We should be able to specify just a path prefix if the hostname auto-detection works.  This will allow easier packaging of the credmon, where the packagers may know the prefix of the webapp but not the hostname it's deployed on.\n</li><li>Does the credmon know its URL?  Is there any way it can pass this information along to the credd without a sysadmin knob?\n</li></ol>\n\n<p>In terms of bikeshedding -- <code>CREDMON_WEB_PREFIX</code> ?\n\n</p><p></p><hr/>\n<em>2019-Jan-17 08:40:20 by jpatton:</em> <br/>\n\nAgree on (1) and (2). It's not apparent to me how to do (3). Flask is agnostic to where its home is unless the admin sets <code>app.config['SERVER_NAME']</code> .\n\n<p><code>CREDMON_WEB_PREFIX</code> is ok with me. Might either need to clarify that <a class=\"external\" href=\"https://\">https://</a> is not needed <em>or</em> we should have code to strip out whatever protocol (if any) is put by the admin and replace it with <a class=\"external\" href=\"https://\">https://</a> (to be sure that users' browsers are checking for secure HTTP).\n\n</p><p></p><hr/>\n<em>2019-Jan-17 09:46:27 by bbockelm:</em> <br/>\n\nYes - let's require the string start with <a class=\"external\" href=\"https://\">https://</a> and send an error back otherwise.\n\n<p></p><hr/>\n<em>2019-Feb-06 14:31:51 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p></p><ul>\n<li>Now, a tab in the secret file will denote the end of the data. I\ndon't like that, but it probably won't be a problem in practice.\n\n<p></p></li><li>In submit.cpp, I hope the param name \"UseOAuthServies\" should really\nbe \"UseOAuthServices\".</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Feb-12 14:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56169\">[56169]</a></span>: fix typo in submit keyword. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6862\" onclick=\"get_ticket_and_populate_wrapper('6862'); return false;\" title=\"scitokens: admin cannot define hostname:port of credmon webserver\">#6862</a></span> Services, not Servies  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-21 13:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56033\">[56033]</a></span>: Fixes for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6862\" onclick=\"get_ticket_and_populate_wrapper('6862'); return false;\" title=\"scitokens: admin cannot define hostname:port of credmon webserver\">#6862</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6864\" onclick=\"get_ticket_and_populate_wrapper('6864'); return false;\" title=\"scitokens: credd log needs cleaning up\">#6864</a></span>, cleanup of credd.cpp code for scitokens fix memory leaks remove use of g++ only syntax that makes code not build on Windows/Mac add knob CREDMON_WEB_PREFIX for setting the hostname and port of the returned URL remove ZKM from log messages, and generally make the log messages\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Feb-12 14:59", "status": "resolved", "created": "2019-Jan-16 11:35", "fixed_version": "2019-Jan-16 11:35", "broken_version": "v080800", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "johnkn", "derived_from": "#6513", "creator": "jpatton", "rust": "", "customer_group": "scitokens", "visibility": "public", "notify": "jpatton@cs.wisc.edu,tannenba@cs.wisc.edu,bbockelman@morgridge.org", "due_date": ""}