{"id": 1234, "title": "Ticket #1234: Add implicit target scoping to new ClassAds", "description": "<blockquote>\nRewriting old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> expressions to include proper Target scoping on attribute references (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1112\" onclick=\"get_ticket_and_populate_wrapper('1112'); return false;\" title=\"Fix mixed use of TARGET scope in expressions\">#1112</a></span>) isn't quite good enough. So we'll temporarily add to new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> the ability for unscoped references to be looked up in a secondary scope, if they aren't in the local scope. This is intended to be a temporary change to ease users' transition to new ClassAd's stricter scoping rules.</blockquote>", "remarks": "<blockquote>\n<em>2010-Feb-19 09:07:43 by jfrey:</em> <br/>\n\nThis new scoping behavior should be controllable by a config param. For the transition period, we should also ensure that the My scope works for all expression evaluations that don't have a target ad.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 14:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17300\">[17300]</a></span>: Add knob to disable implicit target scoping in compat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1242\" onclick=\"get_ticket_and_populate_wrapper('1242'); return false;\" title=\"Add config knob for strict target scoping\">#1242</a></span> Now that we can have implicit target scoping of attribute references in new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1234\" onclick=\"get_ticket_and_populate_wrapper('1234'); return false;\" title=\"Add implicit target scoping to new ClassAds\">#1234</a></span>), we should have a way to disable it. This will allow users to test their configuration before upgrading to a future version of Condor where\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-19 11:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17293\">[17293]</a></span>: Disable AddTargetRefs() in compat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> layer. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1122\" onclick=\"get_ticket_and_populate_wrapper('1122'); return false;\" title=\"Add methods for adding TARGET scope in expressions based on ad type\">#1122</a></span> Now that we're mimicing old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>' scoping behavior (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1234\" onclick=\"get_ticket_and_populate_wrapper('1234'); return false;\" title=\"Add implicit target scoping to new ClassAds\">#1234</a></span>), we don't need the expression rewriting done by AddTargetRefs(). We'll keep the code around, as it may still be useful once we want to start enforcing new ClassAd's scoping rules.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-19 10:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17292\">[17292]</a></span>: Use implicit target scoping in compat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1234\" onclick=\"get_ticket_and_populate_wrapper('1234'); return false;\" title=\"Add implicit target scoping to new ClassAds\">#1234</a></span> When matchmaking, use new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>' alternateScope to search the target ad when a referenced attribute isn't in the local ad. This duplicates the evaluation logic of old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-19 10:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17291\">[17291]</a></span>: Add implicit target scoping to new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1234\" onclick=\"get_ticket_and_populate_wrapper('1234'); return false;\" title=\"Add implicit target scoping to new ClassAds\">#1234</a></span> When evaluating an expression, if an unscoped attribute reference can't be found in the current scope, allow a secondary scope to be searched as well.\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Feb-19 16:17", "status": "resolved", "created": "2010-Feb-19 09:04", "fixed_version": "2010-Feb-19 09:04", "broken_version": "v070500", "priority": "4", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "#1109", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": "20100219"}