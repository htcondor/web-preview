{"id": 7193, "title": "Ticket #7193: Schedd blocked for 5 minutes on ssh_to_job", "description": "<blockquote>\nToday, I encountered a situation where the schedd on submit-1.chtc.wisc.edu was blocked for 5 minutes. The cause was a deadlock triggered by ssh-to-job, which I don't believe has been reported before. Here are the legs of the deadlock:\n\n<p></p><ul>\n<li>In response to a GET_JOB_CONNECT_INFO request, the schedd is making a blocking connection to the starter to do a CREATE_JOB_OWNER_SEC_SESSION command. The CEDAR timeout is 300 seconds.\n</li><li>The starter is about to start the job and is making a <code>begin_execution</code> RPC to the shadow.\n</li><li>Having just finished input file transfer, the shadow is attempting to connect to the schedd to push job ad changes related to the transfer. The CEDAR timeout is 300 seconds.\n</li></ul>\n\n<p>As a short term fix, the schedd's timeout for CREATE_JOB_OWNER_SEC_SESSION could be shortened (years of careful research would suggest 20 seconds). In the long term, making one of the connection attempts non-blocking would be better.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Aug-08 15:34:27 by jfrey:</em> <br/>\n\nThe timeout for schedd connecting to the startd and starter was originally 20 seconds. It was increased to 300 seconds in <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5070\" title='condor_ssh_to_job fails with \"Failed to get address of starter\"'>#5070</a></span>.\n\n<p></p><hr/>\n<em>2019-Aug-20 13:56:46 by jfrey:</em> <br/>\n\nRestoring the old timeout value of 20 seconds for now.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-24 16:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58260\">[58260]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7193\" title=\"Schedd blocked for 5 minutes on ssh_to_job\">#7193</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7248\" title=\"Build with SciTokens\">#7248</a></span>  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-20 13:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57707\">[57707]</a></span>: Reduce schedd timeout for ssh-to-job network connections. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7193\" title=\"Schedd blocked for 5 minutes on ssh_to_job\">#7193</a></span> Restore the old timeout value of 20 seconds when the schedd connects to the startd and starter for command GET_JOB_CONNECT_INFO (used for ssh-to-job). The recent value of 300 exacerbates a possible deadlock between schedd, starter, and shadow.\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Oct-24 16:59", "status": "resolved", "created": "2019-Aug-06 14:01", "fixed_version": "2019-Aug-06 14:01", "broken_version": "v080903", "priority": "4", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "", "due_date": ""}