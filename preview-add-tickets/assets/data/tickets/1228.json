{"id": 1228, "title": "Ticket #1228: CLASSAD_LIB_PATH for new ClassAds", "description": "<blockquote>\nSo called Old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> allow for loading new functions via shared libraries dropped into CLASSAD_LIB_PATH. New <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> appear to contain the same low-level functionality, see classad/fnCall.cpp and classad/extra_tests.cpp, but it is not exposed by Condor. It should be exposed, possibly via CLASSAD_LIB_PATH.</blockquote>", "remarks": "<blockquote>\n<em>2010-Feb-18 16:45:24 by jfrey:</em> <br/>\n\nOld <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> can be given a single shared library that provides additional <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> functions (via CLASSAD_LIB_PATH). If the evaluation code encounters a function that's not implemented in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> library and CLASSAD_LIB_PATH is set, it tries to open the library and look for a function with the same name as the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> function being evaluated. If it finds one, it invokes it.\n\n<p>In new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>, you can supply multiple shared libraries that provide additional <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> functions. You explicitly register each library, at which point <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> opens the library and attempts to invoke a function named 'Init'. Init is expected to return an array of structs that provides a function name and function pointer for each new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> function.\n\n</p><p>The signature of the functions in the shared library is different between new and old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. In new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>, all new functions must be registered before they can be invoked. In order to transparently support the old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> shared libraries, we'd have to modify the new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> code to be willing to deal with just-in-time lookups of added functions or figure out how to scan a shared library for all additional functions.\n\n</p><p></p><hr/>\n<em>2010-Feb-19 11:16:51 by matt:</em> <br/>\n\nAllowing for CLASSAD_LIB_PATH with new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> is probably sufficient. Making the DSO mechanism backward compatible is likely overkill.\n\n<p></p><hr/>\n<em>2010-May-07 15:24:46 by jfrey:</em> <br/>\n\nGiven the difference between the ABIs of new and old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> for user-defined functions, we will add a new config parameter for specifying libraries for new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> functions. The old paramater (CLASSAD_LIB_PATH) will no longer work. Condor may send email to the administrator if the parameter is defined in the config file.\n\n<p></p><hr/>\n<em>2010-May-11 15:42:48 by jfrey:</em> <br/>\n\nPushed a commit to master for 7.5.3.\n\n<p>There's now a <code>CLASSAD_USER_LIBS</code> config param, a list of libraries containing user-defined new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> functions.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-May-11 16:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25468\">[25468]</a></span>: Document new config param CLASSAD_USER_LIBS. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1228\" title=\"CLASSAD_LIB_PATH for new ClassAds\">#1228</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-May-11 15:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17968\">[17968]</a></span>: Allow user-defined new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> functions via CLASSAD_USER_LIBS. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1228\" title=\"CLASSAD_LIB_PATH for new ClassAds\">#1228</a></span> Add new Condor config param CLASSAD_USER_LIBS to allow the user to provide shared libraries with user-defined functions for new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. The old parameter CLASSAD_LIB_PATH is no longer supported, since the ABI is different between\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-May-11 15:43", "status": "resolved", "created": "2010-Feb-18 13:16", "fixed_version": "2010-Feb-18 13:16", "broken_version": "v070501", "priority": "3", "subsystem": "Daemons", "assigned_to": "jfrey", "derived_from": "", "creator": "matt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu", "due_date": ""}