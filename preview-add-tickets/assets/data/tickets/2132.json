{"id": 2132, "title": "Ticket #2132: [Debian] Using shared libraries", "description": "<blockquote>\nFor being accepted as a Debian package, Condor should build using shared libraries. This ticket is for the respective patch already created by Michael.\n\n<p>Changes impact CMake files.\n\n</p><p>Branch V7_7-debian-publicbranch in the git repository contains changes for this ticket.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-May-13 11:25:29 by tstclair:</em> <br/>\n\nNote, this will need to be an option enabled function (Windows will not build shared libs without exports) and should be hidden under a macro so higher level functionality is not impacted.\n\n<p></p><hr/>\n<em>2011-May-17 08:33:29 by bbockelm:</em> <br/>\n\nAny updates on this?  I'm building a new release for our site, and I'd like to include this patch.\n\n<p></p><hr/>\n<em>2011-May-19 14:41:39 by cat:</em> <br/>\n\n[Originally, I sent this note as email to the CC list, but now that I have access to the wiki again, I am posting it as a remark for posterity.]\n\n<p>Of all of the Debian-related patches that we are working to integrate, this one will take the longest.  It is the most complex and has some fairly broad implications.\n\n</p><p>Are you building Condor from source for your site?  If so, out of curiosity: Why?  And why do you want to include the shared-library patch for your site?  What makes this change compelling for you?\n\n</p><p></p><hr/>\n<em>2011-May-19 14:52:35 by tstclair:</em> <br/>\n\nDeployment is the most obvious reason.  It reduces the thunk from ~300+ MB &gt;50.\n\n<p>Multiply that by thousands of machines == good motivation.\n\n</p><p></p><hr/>\n<em>2011-May-19 15:23:13 by matt:</em> <br/>\n\nPlease attach the patch to this ticket so we can see what's being discussed.\n\n<p></p><hr/>\n<em>2011-May-19 16:44:06 by cweiss:</em> <br/>\n\nAs agreed in an earlier meeting, all these changes go into a separate branch to avoid patch chaos. So just take a look at the associated commit.\n\n<p></p><hr/>\n<em>2011-Nov-02 14:55:57 by jfrey:</em> <br/>\n\nAll of the Condor utility libraries are now one large library, named condor_utils. On linux and mac, this is a shared library. On other platforms, it's static. The shared library is unversioned and, for vendor packaging, is kept in a 'condor' subdirectory.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2613\" onclick=\"get_ticket_and_populate_wrapper('2613'); return false;\" title=\"Add versioning to libcondor_utils\">#2613</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd versioning to libcondor_utils</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2932\" onclick=\"get_ticket_and_populate_wrapper('2932'); return false;\" title=\"Condor version and platfrom strings missing from binaries\">#2932</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nCondor version and platfrom strings missing from binaries</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-08 14:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28684\">[28684]</a></span>: Fix logging for c-gahp. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2132\" onclick=\"get_ticket_and_populate_wrapper('2132'); return false;\" title=\"[Debian] Using shared libraries\">#2132</a></span> When introducing the new set_mySubSystem() call, I put it in the wrong location in the c-gahp. Consequently, the c-gahp thought its subsystem was TOOL. When Condor was started as root, the c-gahp would fail immediately because it couldn't write to $(LOG)/TOOLLog.\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Nov-03 11:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28114\">[28114]</a></span>: Version history for libcondor_utils. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2132\" onclick=\"get_ticket_and_populate_wrapper('2132'); return false;\" title=\"[Debian] Using shared libraries\">#2132</a></span> ===VersionHistory:Complete===  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-10 06:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27744\">[27744]</a></span>: Updated job_server and triggerd dc_* function signatures after <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2132\" onclick=\"get_ticket_and_populate_wrapper('2132'); return false;\" title=\"[Debian] Using shared libraries\">#2132</a></span> changes  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-05 14:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27653\">[27653]</a></span>: Turn libcondor_utils into a dynamic library on mac. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2132\" onclick=\"get_ticket_and_populate_wrapper('2132'); return false;\" title=\"[Debian] Using shared libraries\">#2132</a></span> The environ variable is not directly accessible by dynamic libraries on the mac, but there is a function available to get its location. As a result, Condor now has the function GetEnviron() for utility code that needs to directly access environ.\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-05 14:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27652\">[27652]</a></span>: Combine all of the Condor utility libraries into one library. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2132\" onclick=\"get_ticket_and_populate_wrapper('2132'); return false;\" title=\"[Debian] Using shared libraries\">#2132</a></span> These libraries are hopelessly interdependent and serve no purpose as separate libraries. They are now part of libcondor_utils: analysis conversion ccb cedar ckpt_server_api daemon_client daemon_core privsep procapi procd_client qmgmt\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-05 14:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27649\">[27649]</a></span>: Make subsystem specification more compatible with shared libraries. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2132\" onclick=\"get_ticket_and_populate_wrapper('2132'); return false;\" title=\"[Debian] Using shared libraries\">#2132</a></span> Before, each binary that declared its subsystem type via DECL_SUBSYSTEM() defined its own version of get_mySubSystem(), which would be called by various functions in the utility libraries. The util lib contained an extra DECL_SUBSYSTEM(\"TOOL\")\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-03 17:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27590\">[27590]</a></span>: Build libchirp_client as both static and shared. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2132\" onclick=\"get_ticket_and_populate_wrapper('2132'); return false;\" title=\"[Debian] Using shared libraries\">#2132</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-03 14:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27580\">[27580]</a></span>: Keep chirp_client as a static library. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2132\" onclick=\"get_ticket_and_populate_wrapper('2132'); return false;\" title=\"[Debian] Using shared libraries\">#2132</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-29 11:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27579\">[27579]</a></span>: Fix some compiler errors with the new dynamic library setup. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2132\" onclick=\"get_ticket_and_populate_wrapper('2132'); return false;\" title=\"[Debian] Using shared libraries\">#2132</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-28 10:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27577\">[27577]</a></span>: Make some daemoncore callouts optional. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2132\" onclick=\"get_ticket_and_populate_wrapper('2132'); return false;\" title=\"[Debian] Using shared libraries\">#2132</a></span> dc_main_pre_dc_init and dc_main_pre_command_sock_init are now optional, since most daemons don't use them. Daemoncore will except if the other dc_* function pointers are NULL.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-27 22:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27576\">[27576]</a></span>: Link tools against daemoncore library. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2132\" onclick=\"get_ticket_and_populate_wrapper('2132'); return false;\" title=\"[Debian] Using shared libraries\">#2132</a></span> Virtually all Condor binaries now link against daemoncore. Use of daemoncore is optional. This is a step in our plan to combine the Condor utility libraries into a single dynamic library.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-17 00:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27269\">[27269]</a></span>: Fix up naming of cmake library macros for shared libraries. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2132\" onclick=\"get_ticket_and_populate_wrapper('2132'); return false;\" title=\"[Debian] Using shared libraries\">#2132</a></span> The library target macros are now called condor_shared_library() and condor_static_library(). New cmake variable CONDOR_BUILD_SHARED_LIBS controls whether shared libraries are built. If it's turned off, condor_shared_library() acts like\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-19 16:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21918\">[21918]</a></span>: Apply shared library patch for debian <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2132\" onclick=\"get_ticket_and_populate_wrapper('2132'); return false;\" title=\"[Debian] Using shared libraries\">#2132</a></span>  (By Cathrin Weiss )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Dec-16 13:44", "status": "resolved", "created": "2011-May-06 09:40", "fixed_version": "2011-May-06 09:40", "broken_version": "v070000", "priority": "4", "subsystem": "", "assigned_to": "jfrey", "derived_from": "#2058", "creator": "cweiss", "rust": "", "customer_group": "other", "visibility": "public", "notify": "jfrey@cs.wisc.edu,cat@cs.wisc.edu, michael.hanke@gmail.com , cweiss@cs.wisc.edu, bbockelm@cse.unl.edu, tstclair@redhat.com, matt@cs.wisc.edu", "due_date": ""}