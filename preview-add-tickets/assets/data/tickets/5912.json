{"id": 5912, "title": "Ticket #5912: Condor_submit should have syntax for job retries", "description": "<blockquote>\ncondor_submit should have first class keywords to describe job retries, and it should automatically generate the appropriate <code>OnExitRemove</code> expressions in the job ad based on those keywords.\n\n<p>Use of one or more of the keywords below will cause an appropriate <code>OnExitRemove</code> expression to be added to the job ad, and possibly other attributes as well.\n\n</p><p>keywords will be one or more of\n\n</p><p><table border=\"1\" cellspacing=\"0\">\n<tbody><tr>\n<td>\n <strong>name</strong> </td>\n<td>\n <strong>type</strong> </td>\n<td>\n <strong>description</strong> </td>\n</tr>\n\n<tr>\n<td>\n <code>max_retries</code> </td>\n<td>\n integer </td>\n<td>\n values &gt; 0 should cause the job to retry N times </td>\n</tr>\n\n<tr>\n<td>\n <code>retry_until</code> </td>\n<td>\n int or expr </td>\n<td>\n futility exit code, or expression that when true, causes retries to cease </td>\n</tr>\n\n<tr>\n<td>\n <code>success_exit_code</code> </td>\n<td>\n integer </td>\n<td>\n exit code that will be returned on success </td>\n</tr>\n\n</tbody></table>\n</p><p></p><ul>\n<li>Retries will continue until the job exits with the value of <code>success_exit_code</code> or has exited more than <code>max_retries</code> times.\n</li><li>If <code>success_exit_code</code> is not set, then 0 will be assumed to mean success.\n</li><li>if <code>retry_until</code> is an integer, it is equivalent to DAGman's <code>UNLESS-EXIT</code> keyword.  It should contain an exit code that indicates futility and retries will cease when the exit code is equal to it. If it is an expression retries will cease when it evaluates to true.\n</li><li>Use of <code>max_retries</code> and/or <code>success_exit_code</code> without <code>max_retries</code> will use a configuration knob to control the default retry count.\n</li><li>If an <code>OnExitRemove</code> expression is also defined in the submit file, that expression will be ||'ed with the expression generated for doing retries.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2016-Sep-20 16:47:30 by johnkn:</em> <br/>\n\nMay need to have some automatic check for <code>ExitBySignal</code>.\n\n<p></p><hr/>\n<em>2016-Nov-30 13:35:43 by wenger:</em> <br/>\n\nA couple of questions:\n<ul>\n<li>Is there a config macro that sets the default for max_retries?\n</li><li>What happens if retry_until and success_exit_code are\nset to the same value?\n</li></ul>\n\n<p></p><hr/>\n<em>2016-Nov-30 13:44:28 by johnkn:</em> <br/>\n\nDEFAULT_JOB_MAX_RETRIES</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"stalled\" href=\"tktview?tn=6029\" title=\"DAGMan should check success_exit_code\">#6029</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDAGMan should check success_exit_code</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6030\" title=\"DEFAULT_JOB_MAX_RETRIES is not in param table\">#6030</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDEFAULT_JOB_MAX_RETRIES is not in param table</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Dec-07 15:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49752\">[49752]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5912\" title=\"Condor_submit should have syntax for job retries\">#5912</a></span>: Added a note about non-zero values of success_exit_code not working for DAG node jobs.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Nov-30 16:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49689\">[49689]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5912\" title=\"Condor_submit should have syntax for job retries\">#5912</a></span>: Documented condor_submit retry commands (including adding version history entry); also added related DEFAULT_JOB_MAX_RETRIES macro in config section. (Also fixed unrelated typo in condor_submit_dag man page.)  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-23 11:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49275\">[49275]</a></span>: smarter brace insertion and better error reporting for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5912\" title=\"Condor_submit should have syntax for job retries\">#5912</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-22 13:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49268\">[49268]</a></span>: Add first class syntax for job retries to condor_submit. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5912\" title=\"Condor_submit should have syntax for job retries\">#5912</a></span> this commit adds new kewords to condor_submit and submit utils: max_retries, retry_until and success_exit_code And a new knob. DEFAULT_JOB_MAX_RETRIES which sets the retry count when retries are enabled, but the job doesn't actually set a\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Nov-30 16:53", "status": "resolved", "created": "2016-Sep-20 15:18", "fixed_version": "2016-Sep-20 15:18", "broken_version": "", "priority": "4", "subsystem": "", "assigned_to": "wenger", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}