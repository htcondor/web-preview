{"id": 3947, "title": "Ticket #3947: Schedd crashes in select with EBADF when killing hung shadows", "description": "<blockquote>\nThe schedd is dying when killing hung shadows with\n\n<p></p><div class=\"code\">\n<pre class=\"code\">09/19/13 16:23:33 ERROR \"select, error # =3D 9\" at line 4172 in file /slots/01/dir_52478/userdir/src/condor_daemon_core.V6/daemon_core.cpp\n</pre></div>\n\n\n<p>The problem is that in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> itself, before we kill a child, due to inactivity, we call <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ServiceCommandSocket\" title=\"Service Command Socket\">ServiceCommandSocket</a></span>, in the hopes that there's a lingering CHILD_ALIVE waiting on a socket.  This seems unlikely, and is a source for all kids of race conditions.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Sep-25 16:16:44 by danb:</em> <br/>\n\nCODE REVIEW: amen!</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Oct-14 15:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37842\">[37842]</a></span>: edit 8.0.4 version history item <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3947\" onclick=\"get_ticket_and_populate_wrapper('3947'); return false;\" title=\"Schedd crashes in select with EBADF when killing hung shadows\">#3947</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Sep-25 15:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37719\">[37719]</a></span>: Document <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3947\" onclick=\"get_ticket_and_populate_wrapper('3947'); return false;\" title=\"Schedd crashes in select with EBADF when killing hung shadows\">#3947</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Sep-25 15:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37718\">[37718]</a></span>: Fix schedd crash in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ServiceCommandSocket\" title=\"Service Command Socket\">ServiceCommandSocket</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3947\" onclick=\"get_ticket_and_populate_wrapper('3947'); return false;\" title=\"Schedd crashes in select with EBADF when killing hung shadows\">#3947</a></span> No longer try to re-enter <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ServiceCommandSocket\" title=\"Service Command Socket\">ServiceCommandSocket</a></span> when killing children who have stopped sending CHILD_ALIVE messages.  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Sep-25 16:17", "status": "defer", "created": "2013-Sep-25 15:44", "fixed_version": "2013-Sep-25 15:44", "broken_version": "v080000", "priority": "5", "subsystem": "DaemonsSubmitNode", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "s8350", "customer_group": "ligo", "visibility": "public", "notify": "pfcouvar@syr.edu,pcouvare@caltech.edu", "due_date": "9252013"}