{"id": 1403, "title": "Ticket #1403: Eliminate file transfer services started by Condor for grid universe", "description": "<blockquote>\nCondor starts up file transfers services under the gridmanager to perform file staging for several types of grid universe jobs: a GASS server for gt2, and a gridftp server for gt4 and cream. A remote user with a copy of the job owner's proxy can connect to these servers to read or write any file of the job owner, not just files related to their jobs. These servers also require a range of ports be opened for incoming connections, which some site admins may be reluctant to configure in their firewalls.\n\n<p>For these reasons, we want to eliminate these file transfer services and have Condor act in a purely client mode for these job types.\n\n</p><p><span class=\"section\"></span></p><h2>Milestones </h2>\n\n<p></p><ul>\n<li>Build proof-of-concept file transfer code for Cream jobs <strong>[DONE]</strong>\n</li><li>Write gridftp file transfer management code for gridmanager <strong>[DONE]</strong>\n</li><li>Use active file transfers for Cream jobs <strong>[DONE]</strong>\n</li><li>Use active file transfers for GRAM4 jobs <strong>[WON'T DO]</strong>\n</li><li>Use active file transfers for GRAM2/5 jobs\n</li><li>Add rate-limiting <strong>[DONE]</strong>\n</li><li>Improve connection caching in nordugrid_gahp <strong>[DONE]</strong>\n</li></ul>\n\n<p><span class=\"section\"></span></p><h2>Cream Jobs</h2>\n\n<p>A Cream client can submit a job with a mixture of client- and server-initiated file transfers. Here is an example job description snippet:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">InputSandbox = { \"gsiftp://remote.edu/foo/in\" };\nOutputSandbox = {\n    \"out1\",\n    \"out2\"\n    };\nOutputSandboxDestURI = {\n    \"gsiftp://localhost/out1\",\n    \"gsiftp://remote.edu/foo/out2\"\n    };\n</pre></div>\n\n\n<p>When the job is first submitted, the client is given gridftp URLs for an Input Sandbox (ISB) and an Output Sandbox (OSB). These are directories used to hold input and output files transferred by the client. In this example, the server will transfer the files <code>in</code> and <code>out2</code> between itself and remote.edu. In addition, the client can transfer additional input files to the ISB before signaling that the job should be started (i.e. submitted to the batch system behind the Cream server). Once the job completes, <code>out1</code> will be available in the OSB for the client to retrieve. If the client wants to retrieve all output files itself, it can use wildcards to say that all output files should be saved. This removes the need to name all output files using <code>transfer_output_files</code> in the Condor submit file.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Jun-11 09:45:02 by jfrey:</em> <br/>\n\nIn Condor 7.5.3, file transfers for cream jobs are initiated by the gridmanager using the nordugrid gahp. The nordugrid gahp now executes multiple commands to each server in parallel, with a rate limit of 10 active transfers. Idle connections are held for 30 seconds waiting for new transfer commands from the gridmanager. There's no global limit on active transfers yet.\n<hr/>\n<em>2010-Oct-20 16:03:30 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.\n<hr/>\n<em>2011-Jan-27 14:46:04 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 16:08:44 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-09 17:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25513\">[25513]</a></span>: Add version history entry for change in cream file transfers. <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1403\" onclick=\"get_ticket_and_populate_wrapper('1403'); return false;\" title=\"Eliminate file transfer services started by Condor for grid universe\">#1403</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-09 17:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18435\">[18435]</a></span>: Improve connection caching in the nordugrid_gahp. <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1403\" onclick=\"get_ticket_and_populate_wrapper('1403'); return false;\" title=\"Eliminate file transfer services started by Condor for grid universe\">#1403</a></span> The nordugrid_gahp will now allow 10 data-heavy and 1 non-data-heavy commands to occur in parallel to each remote server. When the Globus handle for a connection is no longer needed, it is saved for 30 seconds (along with the connection it represents)\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-07 16:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18433\">[18433]</a></span>: Cream jobs no longer spawn a local gridftp server. <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1403\" onclick=\"get_ticket_and_populate_wrapper('1403'); return false;\" title=\"Eliminate file transfer services started by Condor for grid universe\">#1403</a></span> Remove references to the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GridftpServer\" title=\"Gridftp Server\">GridftpServer</a></span> class from <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CreamJob\" title=\"Cream Job\">CreamJob</a></span> in the gridmanager. Now that we initiate file transfers from the client, there's no need to start a gridftp server.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-03 15:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18432\">[18432]</a></span>: Renew job leases during file staging for cream jobs. <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1403\" onclick=\"get_ticket_and_populate_wrapper('1403'); return false;\" title=\"Eliminate file transfer services started by Condor for grid universe\">#1403</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-May-27 15:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18431\">[18431]</a></span>: Control file staging in the gridmanager for cream jobs. <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1403\" onclick=\"get_ticket_and_populate_wrapper('1403'); return false;\" title=\"Eliminate file transfer services started by Condor for grid universe\">#1403</a></span> This is the first draft for initiating file staging from the client side for cream grid jobs, rather than having the server perform the transfers.\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-May-27 13:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18428\">[18428]</a></span>: Add new command GRIDFTP_TRANSFER to nordugrid_gahp. <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1403\" onclick=\"get_ticket_and_populate_wrapper('1403'); return false;\" title=\"Eliminate file transfer services started by Condor for grid universe\">#1403</a></span> It transfers a file between a file:// URL and a gsiftp:// URL, or two gsiftp:// URLs.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-May-27 13:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18429\">[18429]</a></span>: Add handling of new gahp command GRIDFT_TRANSFER in gridmanager. <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1403\" onclick=\"get_ticket_and_populate_wrapper('1403'); return false;\" title=\"Eliminate file transfer services started by Condor for grid universe\">#1403</a></span>  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Jan-30 14:18", "status": "defer", "created": "2010-May-13 08:58", "fixed_version": "2010-May-13 08:58", "broken_version": "v070500", "priority": "5", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}