{"id": 1912, "title": "Ticket #1912: C++ exception related bugs in cream client", "description": "<blockquote>\nCoverity found the following problems with this code in cream's baseException.h\n\n<p></p><div class=\"code\">\n<pre class=\"code\">  55        virtual const char* what() const throw() {\n  56            char timestamp[40];\n  57            struct tm TSTAMP;\n  58            memset((void*)timestamp, 0, 40);\n  59            localtime_r(&amp;m_timestamp, &amp;TSTAMP);\n  60            strftime(timestamp, sizeof(timestamp), \"%a %d %b %Y %T\", &amp;TSTAMP);\n  61            std::string whatinfo = boost::str( boost::format(\"MethodName=[%s] ErrorCode=[%s] Description=[%s] FaultCause=[%s] Timestamp=[%s]\") % m_methodname % m_errorcode % m_description % m_faultcause % timestamp );\n  68          return whatinfo.c_str();\n  69          }\n</pre></div>\n\n\n<p>Returning the stack-allocated whatinfo's c_str is asking for trouble.\n\n</p><p>Also, the boost::str method can throw any number of exceptions, but the throw clause lists none of them, which can result in the C++ runtime terminating the\nprogram.\n\n</p><p>Can we push this up to the cream folks?\n\n</p><p>I don't think we see this code path, but it is a lurking horror.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Mar-01 14:51:07 by jfrey:</em> <br/>\n\nI sent an e-mail to the CREAM developers today describing the problems in this ticket.\n\n<p></p><hr/>\n<em>2011-Mar-02 10:12:08 by jfrey:</em> <br/>\n\nReply by Alvise Dorigo:\n\n<p></p><ul>\nin the next release of cream-client-api-c the return stack-allocated has been fixed as I can see in the code of the branch glite-ce-cream-client-api-c_branch_1_13.\nBut the boost::str's exception issue not yet. I'm going to fix it and commit, but it will be available with the next release.</ul>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "incident", "last_change": "2014-Aug-07 12:03", "status": "resolved", "created": "2011-Feb-11 13:21", "fixed_version": "2011-Feb-11 13:21", "broken_version": "", "priority": "4", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}