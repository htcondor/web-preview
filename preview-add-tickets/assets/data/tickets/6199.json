{"id": 6199, "title": "Ticket #6199: Harmonize periodic job policy evaluation parameters", "description": "<blockquote>\nThe config parameters that control how often the job policy expressions are evaluated are a confusing mess. The documented default for PERIODIC_EXPR_INTERVAL is 60 seconds, but the parameter defaults table has a default value of 300. But everywhere that we query the value, we pass in an explicit default value of 60 (except the gridmanager, which uses 300). The param table wins over the call sites, so functional default is 300 everywhere.\nThe parameters MAX_PERIODIC_EXPR_INTERVAL and PERIODIC_EXPR_TIMESLICE aren't in the defaults table. The schedd and job router supply the documented defaults when querying them. The gridmanager, shadow, and starter ignore these parameters, as they don't use a Timeslice to limit the aggregate evaluation time.\n\n<p>We should make the following changes:\n</p><ul>\n<li>Change the param defaults table entry for PERIODIC_EXPR_INTERVAL to say 60\n</li><li>Add param defaults table entries for MAX_PERIODIC_EXPR_INTERVAL and PERIODIC_EXPR_TIMESLICE with the documented values\n</li><li>Change the gridmanager to use a Timeslice for job policy evaluation with a default PERIODIC_EXPR_INTERVAL of 60</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2017-Apr-04 13:37:57 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong> changes look good.\n\n<p></p><hr/>\n<em>2017-Apr-17 17:06:26 by tim:</em> <br/>\n\n<strong>DOC REVIEW:</strong> Looks good</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-11 16:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50449\">[50449]</a></span>: Improve docs for periodic job policy expressions. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6199\" title=\"Harmonize periodic job policy evaluation parameters\">#6199</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-22 15:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50359\">[50359]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6199\" title=\"Harmonize periodic job policy evaluation parameters\">#6199</a></span>) Keep Fedora compiler happy.  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-22 13:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50357\">[50357]</a></span>: Docs for job policy evaluation bug fixes. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6199\" title=\"Harmonize periodic job policy evaluation parameters\">#6199</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-22 13:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50356\">[50356]</a></span>: Fix gridmanager job policy evaluation to match documentation. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6199\" title=\"Harmonize periodic job policy evaluation parameters\">#6199</a></span> The gridmanager now uses a Timeslice for job policy evaluation and respects the related config parameters.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-22 13:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50355\">[50355]</a></span>: Fix param table defaults for periodic job policy evalution. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6199\" title=\"Harmonize periodic job policy evaluation parameters\">#6199</a></span> The default for PERIODIC_EXPR_INTERVAL should be 60, not 300. Add table entries for MAX_PERIODIC_EXPR_INTERVAL and PERIODIC_EXPR_TIMESLICE.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-22 13:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50354\">[50354]</a></span>: Add new DaemonCore::Register_Timer() variant for Timeslices. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6199\" title=\"Harmonize periodic job policy evaluation parameters\">#6199</a></span> We need a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> timer that uses a Timeslice and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TimerHandler\" title=\"Timer Handler\">TimerHandler</a></span> function pointer. This combination is not currently exposed.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2021-Apr-28 16:31", "status": "resolved", "created": "2017-Mar-21 14:29", "fixed_version": "2017-Mar-21 14:29", "broken_version": "v080500", "priority": "5", "subsystem": "DaemonsSubmitNode", "assigned_to": "johnkn", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pcouvare@caltech.edu", "due_date": ""}