{"id": 2851, "title": "Ticket #2851: RFE: reread config files once per cycle in negotiator", "description": "<blockquote>\nNeed a knob to re-read config files once per cycle to avoid (multiple) use of\ncondor_reconfig and communication side effects in negotiator.</blockquote>", "remarks": "<blockquote>\n<em>2012-Feb-29 17:35:42 by eje:</em> <br/>\n\nTEST:\n\n<p>Begin with configuration:\n</p><div class=\"code\">\n<pre class=\"code\">NEGOTIATOR_DEBUG = D_ACCOUNTANT | D_FULLDEBUG\nNEGOTIATOR_INTERVAL = 20\nNEGOTIATOR_CYCLE_DELAY = 5\n\nNUM_CPUS = 10\n\n# instruct the negotiator to reread configuration each cycle:\nNEGOTIATOR_READ_CONFIG_BEFORE_CYCLE = True\n\n# concurrency limit:\nTEST_LIMIT = 1\n</pre></div>\n\n\n<p>Spin up a pool, and submit 10 jobs requiring concurrency limit TEST:\n</p><div class=\"code\">\n<pre class=\"code\">universe = vanilla\ncmd = /bin/sleep\nargs = 600\nshould_transfer_files = if_needed\nwhen_to_transfer_output = on_exit\nconcurrency_limits = TEST\nqueue 10\n</pre></div>\n\n\n<p>Following the negotiator log you should see the new limit take effect:\n</p><div class=\"code\">\n<pre class=\"code\">$ tail -f NegotiatorLog | grep -e '-------' -e 'Limits --' -e 'Limit:'\n02/29/12 16:24:37 Previous Limits --\n02/29/12 16:24:37 Current Limits --\n02/29/12 16:24:37 ---------- Finished Negotiation Cycle ----------\n02/29/12 16:24:49 ---------- Started Negotiation Cycle ----------\n02/29/12 16:24:49 Previous Limits --\n02/29/12 16:24:49 Current Limits --\n02/29/12 16:24:49 Concurrency Limit: test is 0.000000\n02/29/12 16:24:49 Concurrency Limit: test is 1.000000\n02/29/12 16:24:49 ---------- Finished Negotiation Cycle ----------\n02/29/12 16:25:09 ---------- Started Negotiation Cycle ----------\n02/29/12 16:25:09 Previous Limits --\n02/29/12 16:25:09   Limit: test = 1.000000\n02/29/12 16:25:09 Current Limits --\n02/29/12 16:25:09   Limit: test = 1.000000\n02/29/12 16:25:09 Concurrency Limit: test is 1.000000\n02/29/12 16:25:09 ---------- Finished Negotiation Cycle ----------\n</pre></div>\n\n\n<p>Now, re-edit the config file above, to increase the concurrency limit:\n</p><div class=\"code\">\n<pre class=\"code\">TEST_LIMIT = 5\n</pre></div>\n\n\n<p>Resave the above change.  With the new flag NEGOTIATOR_READ_CONFIG_BEFORE_CYCLE = True, you should see the negotiator respond to the updated concurrency limit:\n</p><div class=\"code\">\n<pre class=\"code\">02/29/12 16:25:29 ---------- Started Negotiation Cycle ----------\n02/29/12 16:25:29 Previous Limits --\n02/29/12 16:25:29   Limit: test = 1.000000\n02/29/12 16:25:29 Current Limits --\n02/29/12 16:25:29   Limit: test = 1.000000\n02/29/12 16:25:29 Concurrency Limit: test is 1.000000\n02/29/12 16:25:30 Concurrency Limit: test is 2.000000\n02/29/12 16:25:30 Concurrency Limit: test is 3.000000\n02/29/12 16:25:30 Concurrency Limit: test is 4.000000\n02/29/12 16:25:30 Concurrency Limit: test is 5.000000\n02/29/12 16:25:30 ---------- Finished Negotiation Cycle ----------\n</pre></div>\n\n\n<p>Without the new flag enabled, negotiator requires a reconfig for the limit update to take effect.\n\n</p><p></p><hr/>\n<em>2012-Feb-29 17:37:43 by eje:</em> <br/>\n\nNew patch on branch V7_7-gt2851-neg-reread-config (against master)</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-29 11:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=31033\">[31033]</a></span>: editing associated with new knob NEGOTIATOR_READ_CONFIG_BEFORE_CYCLE ===GT=== <span class=\"ticket\"><a class=\"review\" href=\"/tickets?ticket=2851\" onclick=\"get_ticket_and_populate_wrapper('2851'); return false;\" title=\"RFE: reread config files once per cycle in negotiator\">#2851</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-09 12:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=30876\">[30876]</a></span>: ===VersionHistory:Completed=== <span class=\"ticket\"><a class=\"review\" href=\"/tickets?ticket=2851\" onclick=\"get_ticket_and_populate_wrapper('2851'); return false;\" title=\"RFE: reread config files once per cycle in negotiator\">#2851</a></span>  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-09 12:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=30875\">[30875]</a></span>: Documentation for NEGOTIATOR_READ_CONFIG_BEFORE_CYCLE ===GT=== <span class=\"ticket\"><a class=\"review\" href=\"/tickets?ticket=2851\" onclick=\"get_ticket_and_populate_wrapper('2851'); return false;\" title=\"RFE: reread config files once per cycle in negotiator\">#2851</a></span>  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-09 12:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=30874\">[30874]</a></span>: Added flag NEGOTIATOR_READ_CONFIG_BEFORE_CYCLE to allow negotiator to re-read configuration each cycle ===GT:Fixed=== <span class=\"ticket\"><a class=\"review\" href=\"/tickets?ticket=2851\" onclick=\"get_ticket_and_populate_wrapper('2851'); return false;\" title=\"RFE: reread config files once per cycle in negotiator\">#2851</a></span>  (By Erik Erlandson )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-Oct-18 07:08", "status": "review", "created": "2012-Feb-28 15:36", "fixed_version": "2012-Feb-28 15:36", "broken_version": "", "priority": "2", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "", "creator": "eje", "rust": "", "customer_group": "other", "visibility": "public", "notify": "eje@cs.wisc.edu, tstclair@redhat.com", "due_date": ""}