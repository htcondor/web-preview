{"id": 5608, "title": "Ticket #5608: Machine ClassAd TotalVirtualMemory definition is undocumented", "description": "<blockquote>\nThe definition of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TotalVirtualMemory\" title=\"Total Virtual Memory\">TotalVirtualMemory</a></span> is not included on pages 656 or 658 of the PDF for the 8.5.3 manual.\n\n<p>Empirically it appears to be the total amount of SWAP + RAM on the host regardless of how much SWAP and how much RAM you have told Condor about.\n\n</p><p>For example, I lie to Condor about the total memory and explicitly set swap to 0 for each slot.\n\n</p><p></p><pre>  MEMORY = ($(DETECTED_CPUS) * 2048)\n  slot_type_1 = swap=0\n</pre>\n\n<p></p><pre>  [pcdev1:~] condor_status execute0155 -autof Memory TotalVirtualMemory VirtualMemory\n  49152 69086768 0\n</pre>\n\n<p></p><pre>  [execute0155:~] free -b\n               total       used       free     shared    buffers     cached\n  Mem:    50745364480 1986764800 48758599680          0  107376640  396517376\n  -/+ buffers/cache: 1482870784 49262493696\n  Swap:   19999485952          0 19999485952\n</pre>\n\n<p>These numbers add up: 50745364480+19999485952=69086768*1024. Should <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TotalVirtualMemory\" title=\"Total Virtual Memory\">TotalVirtualMemory</a></span> actually be set to this? Maybe it should be Memory + <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=VirtualMemory\" title=\"Virtual Memory\">VirtualMemory</a></span> (scaled so each are in the same units).</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Apr-07 10:45:54 by tpdownes:</em> <br/>\n\nI also note that the value of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=VirtualMemory\" title=\"Virtual Memory\">VirtualMemory</a></span> is 0 for the partitionable slot when I have set \"swap=0\". Shouldn't it be equal to Memory (scaled to kB)?\n\n<p>For other slots (that default to swap=100% or whatever), this is so:\n\n</p><p></p><pre>  [pcdev1:~] condor_status slot1@execute0156.nemo.phys.uwm.edu -autof Memory TotalVirtualMemory VirtualMemory\n  47104 69086768 69086768\n</pre>\n\n<p></p><hr/>\n<em>2016-Apr-07 11:08:51 by tpdownes:</em> <br/>\n\nI have no idea where the cgroups hard limit value is coming from:\n\n<p></p><pre>  [execute0156:condor_localscratch_condor_execute_slot1_1@execute0156.nemo.phys.uwm.edu] condor_status slot1_1@execute0156.nemo.phys.uwm.edu -autof TotalMemory TotalVirtualMemory VirtualMemory\n49152 69086768 69086768\n  [execute0156:condor_localscratch_condor_execute_slot1_1@execute0156.nemo.phys.uwm.edu] cat memory.limit_in_bytes\n70744846336\n</pre>\n\n<p></p><hr/>\n<em>2016-Apr-07 11:11:01 by tpdownes:</em> <br/>\n\nWoops - yes I do. Multiply by 1024.\n\n<p>69086768*1024-70744846336 = 4096.\n\n</p><p>So the value is 4kB less than the total RAM and SWAP available to the entire host. Unclear if the difference is an intentional rounding by Condor or some kind of \"block size\" issue in the setting of the value.\n\n</p><p></p><hr/>\n<em>2016-Apr-07 11:14:05 by tpdownes:</em> <br/>\n\nI'll eventually shut up: note that you are setting the hard limit on <strong>RAM usage</strong> to the total of RAM + swap. So clearly a bad value.\n\n<p>This is a plausible value for memory.memsw.limit_in_bytes. In this case, the comparison of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TotalVirtualMemory\" title=\"Total Virtual Memory\">TotalVirtualMemory</a></span> * 1024 is exact.\n\n</p><p></p><pre>  [execute0156:condor_localscratch_condor_execute_slot1_1@execute0156.nemo.phys.uwm.edu] cat memory.memsw.limit_in_bytes\n70744850432</pre>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "todo", "last_change": "2016-Apr-07 11:14", "status": "defer", "created": "2016-Apr-07 10:36", "fixed_version": "2016-Apr-07 10:36", "broken_version": "v080503", "priority": "5", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "tpdownes", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pcouvare@caltech.edu", "due_date": ""}