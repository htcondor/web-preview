{"id": 7270, "title": "Ticket #7270: when_to_transfer_output = ON_SUCCESS", "description": "<blockquote>\nDuncan M writes:\n\n<p>I am seeing many jobs being held when the process fails because the output file I passed to transfer_output_files doesn't exit. Presuming it is standard practice to have a job that only creates the output file on success, is there a way to tell condor only to expect the output files to exist for passing jobs, something like\n\n</p><p></p><div class=\"verbatim\">\n<pre>when_to_transfer_output = ON_SUCCESS\n</pre></div>\n\n\n<p>? Then just have DAGMan tell me, as normal, that my jobs are failing?</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Sep-18 13:50:54 by pfc:</em> <br/>\n\nThis is related to <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7269\" onclick=\"get_ticket_and_populate_wrapper('7269'); return false;\" title=\"support an explicit list of checkpoint files\">#7269</a></span>.\n\n<p></p><hr/>\n<em>2019-Sep-18 15:13:55 by tlmiller:</em> <br/>\n\nSo if I understand this ticket correctly, the request is that if <code>when_to_transfer_output</code> is <code>ON_SUCCESS</code>, and:\n\n<p></p><ul>\n<li>the job exits with <code>success_exit_code</code>, behave as the code currently\n   does (HTCondor will expect the files in <code>transfer_output_files</code> to exist).\n</li><li>Otherwise, the job should not go on hold, and ... you didn't say what\n   you want to happen to the files?\n</li></ul>\n\n<p>Options include: (a) not transferring any files back (b) transferring the output files that exist (a missing file isn't doesn't put the job on hold, but other file transfer failures still would), or (c) specifying the list of files to transfer back on failure.\n\n</p><p>If (c) is at all interesting, would you prefer to have <code>ON_SUCCESS</code> change the semantics of <code>transfer_output_files</code>, or just to directly specify <code>success_output_files</code> and <code>failure_output_files</code>?\n\n</p><p></p><hr/>\n<em>2019-Sep-18 16:17:41 by tlmiller:</em> <br/>\n\nFor the record --\n\n<p></p><div class=\"snip\">\n<pre class=\"sniplabel\">Duncan M writes</pre>\n<pre class=\"snip\">I would be happy with (a): when_to_transfer_files = ON_SUCCESS\nshould mean that if my job isn't successful, I don't get anything back. If I\nwant intermediate files, I can use condor_chirp to get them myself.\n</pre></div>\n\n\n<p></p><hr/>\n<em>2019-Sep-25 14:40:42 by pfc:</em> <br/>\n\nBumping to priority 2 since Josh Willis informed me that this is effectively blocking lalinference from using Condor file i/o.\n\n<p></p><hr/>\n<em>2020-Mar-03 10:38:37 by pfc:</em> <br/>\n\nTodd Miller's NOT PROMISED eta is roughly Condor Week (May 2020) for seeing this in a release.\n<hr/>\n<em>2020-Apr-10 07:46:37 by tim:</em> <br/>\n\nBulk change of target version from v080906 to v080907 using ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-16 15:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59161\">[59161]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7270\" onclick=\"get_ticket_and_populate_wrapper('7270'); return false;\" title=\"when_to_transfer_output = ON_SUCCESS\">#7270</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7338\" onclick=\"get_ticket_and_populate_wrapper('7338'); return false;\" title=\"Input file transfer should preserve relative paths\">#7338</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7269\" onclick=\"get_ticket_and_populate_wrapper('7269'); return false;\" title=\"support an explicit list of checkpoint files\">#7269</a></span>) Release notes and documentation.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-13 17:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59153\">[59153]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7270\" onclick=\"get_ticket_and_populate_wrapper('7270'); return false;\" title=\"when_to_transfer_output = ON_SUCCESS\">#7270</a></span>) Fix bug: computeDesiredExitCode() checked the Success&lt;Infix&gt;Exit* attributes. The job-level attribute(s) are JobSuccessExit*, which are now checked if the infix argument is empty (instead of \"Pre\" or \"Post\").  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-13 17:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59152\">[59152]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7270\" onclick=\"get_ticket_and_populate_wrapper('7270'); return false;\" title=\"when_to_transfer_output = ON_SUCCESS\">#7270</a></span>) Fix bug: don't assume that <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=OutputFiles\" title=\"Output Files\">OutputFiles</a></span> was ever initialized.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-11 14:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59127\">[59127]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7270\" onclick=\"get_ticket_and_populate_wrapper('7270'); return false;\" title=\"when_to_transfer_output = ON_SUCCESS\">#7270</a></span>) Implement when_to_transfer_output = ON_SUCCESS. <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserProc\" title=\"User Proc\">UserProc</a></span> objects without names (the \"real\" job, with the possible exception of interactive jobs) will now tell the base starter object what their exit code was, and the base starter will use this information to determine if the job failed or not,\u00a0[...]\n (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Apr-10 07:46", "status": "resolved", "created": "2019-Sep-18 13:49", "fixed_version": "2019-Sep-18 13:49", "broken_version": "", "priority": "2", "subsystem": "FileTransfer", "assigned_to": "tlmiller", "derived_from": "", "creator": "pfc", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "james.clark@physics.gatech.edu, MacLeodDM@cardiff.ac.uk, pcouvare@caltech.edu, tlmiller@cs.wisc.edu, joshua.willis@ligo.org", "due_date": ""}