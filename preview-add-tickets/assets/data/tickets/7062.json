{"id": 7062, "title": "Ticket #7062: Add ctest support for HTCondor unit tests", "description": "<blockquote>\nThe integration tests present an extremely high hurdle for folks to run (see: <a class=\"external\" href=\"https://htcondor-wiki.cs.wisc.edu/index.cgi/wiki?p=TestingHtCondorOnLinuxImproved\">https://htcondor-wiki.cs.wisc.edu/index.cgi/wiki?p=TestingHtCondorOnLinuxImproved</a>).\n\n<p>Given that cmake comes with a built-in test driver, we should tweak the setup such that ctest can invoke <code>run_test.pl</code> appropriately.  The goal is to:\n\n</p><p></p><ol>\n<li>Allow test runs to be idempotent.  Developers should be able to invoke <code>ctest</code> cleanly multiple times.\n</li><li>Allow <code>ctest</code> to run many tests in parallel.\n</li><li>Not disrupt the NMI builds.</li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2019-Aug-02 09:10:48 by bbockelm:</em> <br/>\n\nClosing as this is mostly done.  Small fix-ups can happen separately from this ticket.\n\n<p>Behavior not visible to users so I'm not including any release history notes.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-20 16:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57215\">[57215]</a></span>: Fixup ctest dependency for condor_on/off test. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56938\">[56938]</a></span>: Only run batlab unit tests in NMI glue, not all of them. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56937\">[56937]</a></span>: Fixup the final dependencies in ctest. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56936\">[56936]</a></span>: Add sleep statements to give time for old tests/jobs to exit the queue. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56935\">[56935]</a></span>: Do not fail if initd cannot be removed completely. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span> When run on NFS, this directory cannot be deleted because the perl process itself holds an open file handle to a file inside the directory, resulting in undeleteable shadow file handles until the test suite fails.\u00a0[...]\n (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56934\">[56934]</a></span>: Switch to x_sleep.pl where available; test should only need a file that exists, not one that works on Windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56933\">[56933]</a></span>: Speed up the negotiator for concurrency limit tests. Keeps things under time threshold. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56932\">[56932]</a></span>: Another round of test dependency fixups. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56931\">[56931]</a></span>: Adjust timeouts in CMR tests; add sleep to allow cluster to come up. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56930\">[56930]</a></span>: Reduce sleep times and mandatory waits for concurrency tests. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56929\">[56929]</a></span>: Close file handle; relevant for cleaning out working directories on NFS hosts. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56927\">[56927]</a></span>: Fix additional test dependencies for ctest. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56928\">[56928]</a></span>: Increase look-back; some tests are more chatty on test hosts with larger CPU counts. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56926\">[56926]</a></span>: Continued fixing of unit tests under ctest. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56925\">[56925]</a></span>: Rename executable to avoid target name clashes on Windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56924\">[56924]</a></span>: Convert over a large number of tests to ctest. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56923\">[56923]</a></span>: Convert a subset of HTCondor tests to ctest. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Aug-02 09:10", "status": "resolved", "created": "2019-May-22 07:58", "fixed_version": "2019-May-22 07:58", "broken_version": "", "priority": "3", "subsystem": "Packaging", "assigned_to": "bbockelm", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bbockelman@morgridge.org; tannenba@cs.wisc.edu", "due_date": ""}