{"id": 6759, "title": "Ticket #6759: Improve new JobEventLog API before release", "description": "<blockquote>\nThe current <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobEventLog\" title=\"Job Event Log\">JobEventLog</a></span> interface is not very Pythonic, and on further reflection, way more complicated than it needs to be.  Instead:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">class JobEventLog:\n    # Raises IOError if we can't initialize the log reader for filename.\n    __init__(filename)\n    # Returns the next event in the log, if any become available before the deadline.\n    __next__()\n    # Returns self, so that this class functions like file iterators (where\n    # iterators don't maintain their own seek pointer).\n    __iter__()\n    # Sets self's deadline and then returns self.\n    events(deadline=None)\n</pre></div>\n\n\n<p>This is the interface we actually wanted, more or less, eliminates a lot of functions, and is more Pythonic than the previous API.  Example usage:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">import os\nimport htcondor\nfrom htcondor import JobEventType\n\njel = htcondor.JobEventLog(\"logfile\")\n# Stop waiting for events sixty seconds from now.\nfor event in jel.events(deadline=+60):\n    if event.type == JobEventType.EXECUTE:\n        break;\nelse:\n    print(\"Failed to find execute event before deadline, aborting.\")\n    sys.exit(-1)\n\n# Do something else.\n\n# Stop waiting for events ninety seconds from now.\nfor event in jel.events(deadline=+90):\n    if event.type == JobEventType.JOB_TERMINATED:\n        break;\nelse:\n    print(\"Failed to find terminated event before deadline, aborting.\")\n    sys.exit(-1)\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2018-Sep-13 13:29:40 by tlmiller:</em> <br/>\n\nNone of us (TJ, ToddM, or Mark) are super happy about 'events()' and 'deadline', but we also can't come up with anything better.  (The main argument in favor of deadline is that -- despite it not being an absolute value for coding convenience reasons -- is (a) it sounds more like (if not quite enough) it applies to the whole sequence of events and (b) \"a deadline of None\" pretty clearly means \"no deadline\".)\n\n<p></p><hr/>\n<em>2018-Sep-13 13:30:19 by tlmiller:</em> <br/>\n\nThe above example should probably go into the documentation (for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6736\" title=\"Regression Tests for Backfill-while-Draining\">#6736</a></span>).\n\n<p></p><hr/>\n<em>2018-Sep-13 16:40:15 by tlmiller:</em> <br/>\n\nSince this API is new for 8.7.10, no further documentation is necessary.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-12 13:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55561\">[55561]</a></span>: Revert \"Continue to allow code to build with older Boost.Python libs. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6759\" title=\"Improve new JobEventLog API before release\">#6759</a></span>\" This reverts commit 8ecb502f80b2173041c4d7dd7e216edefffddd05.  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-01 06:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55507\">[55507]</a></span>: Revert \"(<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6759\" title=\"Improve new JobEventLog API before release\">#6759</a></span>) Use compatible expression for old boost (To be reverted later)\" This reverts commit b1172241ae3466ed572653f3e80cb801028e1873.  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-25 08:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55462\">[55462]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6759\" title=\"Improve new JobEventLog API before release\">#6759</a></span>) Use compatible expression for old boost (To be reverted later)  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-24 15:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55558\">[55558]</a></span>: Continue to allow code to build with older Boost.Python libs. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6759\" title=\"Improve new JobEventLog API before release\">#6759</a></span> Specifically, try to avoid using APIs that require a newer Boost library than is available in packages for Centos.  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-14 13:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55423\">[55423]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6759\" title=\"Improve new JobEventLog API before release\">#6759</a></span>) Change 'deadline' to 'stop_after' while we can still tweak the API.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-13 16:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55414\">[55414]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6736\" title=\"Regression Tests for Backfill-while-Draining\">#6736</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6759\" title=\"Improve new JobEventLog API before release\">#6759</a></span>) Document the (new) <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobEventLog\" title=\"Job Event Log\">JobEventLog</a></span> Python binding.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-12 14:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55409\">[55409]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6759\" title=\"Improve new JobEventLog API before release\">#6759</a></span>) Simplify and make the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobEventLog\" title=\"Job Event Log\">JobEventLog</a></span> API more Pythonic.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-Sep-13 16:40", "status": "resolved", "created": "2018-Sep-12 13:42", "fixed_version": "2018-Sep-12 13:42", "broken_version": "v080710", "priority": "2", "subsystem": "PythonBinding", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}