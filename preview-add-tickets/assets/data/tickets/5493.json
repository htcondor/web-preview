{"id": 5493, "title": "Ticket #5493: Propagate batch-name to all jobs in a workflow", "description": "<blockquote>\nThe -batch-name value (as currently implemented) does not get propagated to any jobs in a workflow when it is specified at the top level (condor_submit_dag -batch-name ...).  TJ says that his condor_q feature only relies on the associated <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> attribute existing in the top-level DAGMan's <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>, but it would be good to propagate this down to sub-DAGs and \"regular\" node jobs.  (We need to do that to fully implement <span class=\"ticket\"><a class=\"abandoned\" href=\"tktview?tn=5033\" title=\"Have classad attribute identifying all jobs in a workflow\">#5033</a></span> and <span class=\"ticket\"><a class=\"abandoned\" href=\"tktview?tn=5444\" title=\"Allow user to specify a workflow name\">#5444</a></span>.)</blockquote>", "remarks": "<blockquote>\n<em>2016-Feb-18 12:22:13 by wenger:</em> <br/>\n\nProbably implement this and <span class=\"ticket\"><a class=\"defer\" href=\"tktview?tn=5077\" title=\"Specify accounting_group, accounting_group_user at DAG level\">#5077</a></span> together.\n\n<p></p><hr/>\n<em>2016-Apr-06 14:15:30 by wenger:</em> <br/>\n\nNote that condor_submit_dag passes this value as a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> attribute, not an argument; so that's how DAGMan has to look for it to pass it down...\n\n<p></p><hr/>\n<em>2016-Apr-06 17:16:01 by wenger:</em> <br/>\n\nCreated V8_5-gittrac_5493-branch for this.\n\n<p></p><hr/>\n<em>2016-Apr-07 15:43:07 by wenger:</em> <br/>\n\nNote:  first commit for this ticket doesn't show up because of how the\ncomment was formatted.\n\n<p></p><hr/>\n<em>2016-Apr-08 14:39:56 by wenger:</em> <br/>\n\nLots of nice green on my test build -- so I'm going to change this ticket to the\n review state...\n\n<p></p><hr/>\n<em>2016-Apr-11 16:00:59 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>: Needs input validation.\n\n<p>Because the batch name is user-provided input, you should either make sure that it gets quoted/escaped properly from end-to-end, or validate it by making sure it doesn't contain spaces, commas, quotes, etc., and rejecting the command line argument if it doesn't conform.\n\n</p><p>Likewise, because the default batch name is the name of the primary dag file, and filenames can easily contain any of those characters, you'd again either need to quote everything properly as they propagate or strip the offending characters from the filename before setting that as the default batch name.\n\n</p><p></p><hr/>\n<em>2016-Apr-13 11:01:45 by wenger:</em> <br/>\n\nI just tested passing a bunch of special characters, such as spaces, in the batch name, and they all got passed down to the node jobs correctly.\n\n<p></p><hr/>\n<em>2016-Apr-15 11:04:10 by wenger:</em> <br/>\n\nI've gone ahead and merged V8_5-gittrac_5493-branch to master.\n\n<p></p><hr/>\n<em>2016-Apr-22 15:56:12 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>: Looks good.</blockquote>", "derived_tickets": "", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/934/gt5493_dif\">gt5493_dif</a>\n15863 bytes added by wenger on 2016-Apr-07 20:53:03 UTC.\n<br/>\nHere's a diff of the whole branch.<br/>\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Apr-07 15:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48184\">[48184]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5493\" title=\"Propagate batch-name to all jobs in a workflow\">#5493</a></span> / <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5494\" title=\"Create a test for -batch-name\">#5494</a></span> / <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5605\" title=\"Have a default for -batch-name (at least for DAGs)\">#5605</a></span>: Oops -- deleting temporary code left in the test...  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Apr-07 15:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48183\">[48183]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5493\" title=\"Propagate batch-name to all jobs in a workflow\">#5493</a></span> / <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5494\" title=\"Create a test for -batch-name\">#5494</a></span> / <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5605\" title=\"Have a default for -batch-name (at least for DAGs)\">#5605</a></span>: Replaced instances of literal \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobBatchName\" title=\"Job Batch Name\">JobBatchName</a></span>\" string with the appropriate #defined constant for safety. Cleaned up temporary code, and added version history items.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Apr-07 14:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48181\">[48181]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5493\" title=\"Propagate batch-name to all jobs in a workflow\">#5493</a></span> / <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5494\" title=\"Create a test for -batch-name\">#5494</a></span> / <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5605\" title=\"Have a default for -batch-name (at least for DAGs)\">#5605</a></span>: DAGMan now defaults to setting a batch name of the top-level DAGMan's CondorID; batch name is now passed down to all jobs within a workflow (including sub-DAGs); created a test for this. (Note: still needs a little cleanup, and needs documentation.)  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Apr-22 16:06", "status": "resolved", "created": "2016-Jan-27 13:47", "fixed_version": "2016-Jan-27 13:47", "broken_version": "v080502", "priority": "3", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "#5490", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.ecu, johnkn@cs.wisc.edu", "due_date": ""}