{"id": 4342, "title": "Ticket #4342: Can't distinguish normal and abnormal job exit for Nordugrid ARC", "description": "<blockquote>\nIn <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NorduGrid\" title=\"Nordu Grid\">NorduGrid</a></span> ARC, we can't distinguish between normal job termination and termination via a signal. If a job exits via signal 9, some ARC systems will report an exit code of 9 and others will report an exit code of 137.\n\n<p>Currently, the gridmanager assumes exit codes greater than 127 are probably exit-by-signal and reports job termination as such. In newer versions of ARC, these exit codes are likely to be normal job terminations. We should modify the gridmanager to always report a normal job termination with the exit code given the ARC LDAP interface.\n\n</p><p><span class=\"subsection\"></span></p><h3>Details </h3>\n\n<p>When <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NorduGrid\" title=\"Nordu Grid\">NorduGrid</a></span> ARC submits a job to the local batch system, it creates a Bourne wrapper script that does some setup and tear-down before and after running the user job. The script determines the job's exit status using the $? variable, saves that value, and uses it with the 'exit' command at the end of the script. In some situations, it runs the job via GNU's /usr/bin/time, and other times it runs the job directly. If the job exits via signal 9, the value reported by $? will be 9 in the former case and 137 in the latter.\n\n</p><p>In ARC 4.0.0, the wrapper script always runs the job directly if the batch system is HTCondor. For other batch systems, GNU's 'time' is used if it's available, otherwise the job is run directly. Some testing by Andrew Lahiff suggests that in 4.1.0, the behavior for HTCondor has changed to match that for other batch systems.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-May-06 15:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=40066\">[40066]</a></span>: Assume all nordugrid jobs exited normally. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4342\" onclick=\"get_ticket_and_populate_wrapper('4342'); return false;\" title=\"Can't distinguish normal and abnormal job exit for Nordugrid ARC\">#4342</a></span> It appears to be impossible to distinguish between normal job exit and exit-by-signal for nordugrid jobs. In in newer version of nordugrid, a job that exits by a signal is likely to have a reported exit code matching the signal number, not the number +\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Jun-13 13:28", "status": "resolved", "created": "2014-May-06 15:08", "fixed_version": "2014-May-06 15:08", "broken_version": "v080000", "priority": "3", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "a26901", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}