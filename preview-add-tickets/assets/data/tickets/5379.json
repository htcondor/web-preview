{"id": 5379, "title": "Ticket #5379: Strange AddressV1", "description": "<blockquote>\nI noticed the following <code>AddressV1</code> (I pretty-printed it below for readability) on a CMS glidein:\n\n<p></p><div class=\"verbatim\">\n<pre>   {\n\n          [\n              n = \"Internet\";\n              p = \"primary\";\n              port = 48709;\n              a = \"129.93.182.27\";\n              noUDP = true\n          ],\n\n          [\n              n = \"red-d9n7.unl.edu\";\n              p = \"IPv4\";\n              port = 48709;\n              a = \"129.93.182.27\";\n              noUDP = true\n          ],\n\n          [\n              brokerIndex = 0;\n              n = \"Internet\";\n              p = \"primary\";\n              port = 9637;\n              ccbid = \"377523\";\n              a = \"128.142.141.24\";\n              noUDP = true\n          ],\n\n          [\n              brokerIndex = 0;\n              n = \"Internet\";\n              p = \"IPv4\";\n              port = 9637;\n              ccbid = \"377523\";\n              a = \"128.142.141.24\";\n              noUDP = true\n          ],\n\n          [\n              n = \"Internet\";\n              p = \"IPv4\";\n              port = 48709;\n              a = \"129.93.182.27\";\n              noUDP = true\n          ]\n   }\n</pre></div>\n\n\n<p>The corresponding <code>MyAddress</code> is:\n\n</p><p></p><div class=\"verbatim\">\n<pre>MyAddress = \"&lt;129.93.182.27:48709?CCBID=128.142.141.24:9637%3faddrs%3d128.142.141.24-9637#377523&amp;PrivNet=red-d9n7.unl.edu&amp;addrs=129.93.182.27-48709&amp;noUDP&gt;\"\n</pre></div>\n\n\n<p>Does this smell funny to anyone else?  Particularly, why are there 5 entries for what appears to be two distinct addresses?</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Nov-10 11:50:20 by tlmiller:</em> <br/>\n\n<div class=\"verbatim\">\n<pre>          [\n              n = \"Internet\";\n              p = \"primary\";\n              port = 48709;\n              a = \"129.93.182.27\";\n              noUDP = true\n          ],\n</pre></div>\n\n\n<p>The \"primary\" address is the one used to the left of the question mark in the original Sinful string.  We need to know this address so we can reconstruct the original Sinful string for backwards compatibility.  This also allows to us to round-trip between the original Sinful string, through AddressV1, and back to the original Sinful string.\n\n</p><p>While you would expect that the primary address is always one of the addresses in the addrs parameter of the original Sinful string -- and thus readily representable in a more-compact way -- that's not always the case.  (See <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5339\" onclick=\"get_ticket_and_populate_wrapper('5339'); return false;\" title=\"TCP_FORWARDING_HOST disregarded.\">#5339</a></span> and <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=5182\" onclick=\"get_ticket_and_populate_wrapper('5182'); return false;\" title=\"&quot;Private&quot; daemon sinful's primary address is not in addrs.\">#5182</a></span>.)\n\n</p><p></p><div class=\"verbatim\">\n<pre>          [\n              n = \"red-d9n7.unl.edu\";\n              p = \"IPv4\";\n              port = 48709;\n              a = \"129.93.182.27\";\n              noUDP = true\n          ],\n</pre></div>\n\n\n<p>This is the configured private network; you can tell because the network name is not \"Internet\".  It doesn't look like a private address, but it unless they're using CCB unnecessarily, it actually is.  We represent it as its own address because it could be.\n\n</p><p></p><div class=\"verbatim\">\n<pre>          [\n              brokerIndex = 0;\n              n = \"Internet\";\n              p = \"primary\";\n              port = 9637;\n              ccbid = \"377523\";\n              a = \"128.142.141.24\";\n              noUDP = true\n          ],\n</pre></div>\n\n\n<p>This is the \"primary\" address of the first CCB broker.\n\n</p><p></p><div class=\"verbatim\">\n<pre>          [\n              brokerIndex = 0;\n              n = \"Internet\";\n              p = \"IPv4\";\n              port = 9637;\n              ccbid = \"377523\";\n              a = \"128.142.141.24\";\n              noUDP = true\n          ],\n</pre></div>\n\n\n<p>The broker's public address.  This information is in broker's Sinful string's addrs attribute.\n\n</p><p></p><div class=\"verbatim\">\n<pre>          [\n              n = \"Internet\";\n              p = \"IPv4\";\n              port = 48709;\n              a = \"129.93.182.27\";\n              noUDP = true\n          ]\n   }\n</pre></div>\n\n\n<p>The host's public address, as listed in its addrs attribute.\n\n</p><p>To summarize: the new address representation is larger because it's intended to allow us to describe more networking configurations than the original Sinful string.  In most cases, the AddressV1 will contain redundant information, but we consider orthogonality more important than compactness.\n\n</p><p></p><hr/>\n<em>2015-Nov-10 11:52:12 by tlmiller:</em> <br/>\n\nMarking resolved; will reopen if you reply.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "incident", "last_change": "2015-Nov-10 11:52", "status": "resolved", "created": "2015-Nov-10 10:07", "fixed_version": "2015-Nov-10 10:07", "broken_version": "", "priority": "3", "subsystem": "DaemonsExecNode", "assigned_to": "tlmiller", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}