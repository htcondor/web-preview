{"id": 3889, "title": "Ticket #3889: Periodically dump rescue DAG while continuing to run", "description": "<blockquote>\nAs per discussion in the LIGO phone conference today -- I think it would be a great idea for DAGMan to periodically dump out a rescue DAG while continuing to run.  This would mean that, even if something went wrong with recovery mode (see <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3882\" onclick=\"get_ticket_and_populate_wrapper('3882'); return false;\" title=\"DAGMan recovery aborts after failing to recognize completed jobs\">#3882</a></span>), you still wouldn't have to start over from scratch.\n\n<p>I think that the frequency at which the rescue DAG is dumped should be configurable -- it could default to something pretty infrequent, like every 24 hours or something.\n\n</p><p>Also, if the DAG succeeds, I think DAGMan should remove the rescue DAG, so it doesn't accidentally get run.  (Or maybe we could dump a rescue DAG that has everything marked as done?)\n\n</p><p>Design doc at: <a class=\"external\" href=\"https://docs.google.com/a/wisc.edu/document/d/1bqP6fcEsSM9yciJ9NlVPP7u71YLbRGrFDc5ihOwqMSA\">https://docs.google.com/a/wisc.edu/document/d/1bqP6fcEsSM9yciJ9NlVPP7u71YLbRGrFDc5ihOwqMSA</a></p></blockquote>", "remarks": "<blockquote>\n<em>2013-Oct-11 16:10:20 by wenger:</em> <br/>\n\nHmm -- I'm wondering now whether this rescue DAG should have a special name that doesn't cause it to get run automatically if the DAG is re-submitted.  (The user would have to rename the rescue DAG file or something for it to actually get used.)\n\n<p></p><hr/>\n<em>2013-Oct-11 16:11:06 by wenger:</em> <br/>\n\nOh, yeah -- especially for condor_hold/condor_release -- we wouldn't want to run the rescue DAG in that situation...\n\n<p></p><hr/>\n<em>2013-Oct-18 14:04:42 by wenger:</em> <br/>\n\nHmm -- I wonder if maybe we'd be better off just making a copy of the workflow log file periodically instead of dumping a rescue DAG.  (Also see <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=3993\" onclick=\"get_ticket_and_populate_wrapper('3993'); return false;\" title=\"Replace rescue DAG with recovery mode?\">#3993</a></span>.)\n\n<p></p><hr/>\n<em>2013-Oct-22 10:29:26 by wenger:</em> <br/>\n\nOkay, after thinking about this, I've changed my mind back to dumping a rescue DAG instead of copying the workflow log.  Here are the reasons:\n<ul>\n<li>Simplicity/reliability (at the present time, rescue DAGs are probably still more reliable than recovery mode).\n</li><li>Smaller files -- the rescue DAGs are a lot smaller than the log file.\n</li><li>Ease/speed of implementation -- not as much actual work has to be done to deal with the rescue DAGs.\n</li><li>The condor_submit_dag -recovery &lt;file&gt; option would result in node jobs whose DAGManJobId doesn't match the new parent DAGMan, unless DAGMan does a condor_qedit on all of the child jobs.\n</li></ul>\n\n<p></p><hr/>\n<em>2015-Sep-22 11:07:19 by tpdownes:</em> <br/>\n\nUpon discussion w/Kent, lower priority to 4 and remove LIGO tag as it's a more a general DAG reliability feature rather than a specific LIGO problem.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "enhance", "last_change": "2015-Sep-22 11:07", "status": "reviewdesign", "created": "2013-Sep-03 17:45", "fixed_version": "2013-Sep-03 17:45", "broken_version": "v080100", "priority": "4", "subsystem": "Dag", "assigned_to": "tannenba", "derived_from": "#3882", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, pfcouvar@syr.edu, anderson@ligo.caltech.edu", "due_date": ""}