{"id": 1900, "title": "Ticket #1900: Running jobs leave queue when held", "description": "<blockquote>\nThe code to start using the new TRANSFERRING_OUTPUT job status (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1641\" title=\"Add new job status TRANSFERRING_OUTPUT\">#1641</a></span>) introduced a bug. If a running vanilla, java, or vm universe job is held (e.g. via condor_hold), it ends up being removed instead. When the starter informs the shadow that the job is no longer running, the shadow always changes the job's status to TRANSFERRING_OUTPUT, regardless of whether the job was killed or exited on its own. When the shadow exits, this causes the schedd to remove the job.\n\n<p>The quickest fix is to stop using the TRANSFERRING_OUTPUT status for now, since nothing relies on it yet. When we want to reintroduce its use, either the shadow needs to be much more careful about when it changes the job status to TRANSFERRING_OUTPUT or the schedd should change the status as a result of the shadow exiting. In the latter case, the TRANSFERRING_OUTPUT status would only be used when delayed output transfer is in use (i.e. start a new job immediately and transfer output in parallel).</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Feb-08 15:29:10 by tannenba:</em> <br/>\n\nNote this means v7.5.5 has a <em>huge</em> bug (condor_hold now equals condor_rm if the job is running!).\n\n<p>Needs to go into the v7.5.5 release notes!\n\n</p><p>Note the patch below puts a band-aid on the problem but does not fix the underlying issue - this  needs to be revisited in v7.7.x.</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1908\" title=\"Reintroduce TRANSFERRING_OUTPUT job status\">#1908</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nReintroduce TRANSFERRING_OUTPUT job status</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=2249\" title=\"back to back condor_hold + release can cause job removal\">#2249</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nback to back condor_hold + release can cause job removal</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-08 16:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25905\">[25905]</a></span>: Documented known bug in 7.5.5: held jobs get removed. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1900\" title=\"Running jobs leave queue when held\">#1900</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-07 10:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=20307\">[20307]</a></span>: Fix eventlog tests for disabled TRANSFERRING_OUTPUT status. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1900\" title=\"Running jobs leave queue when held\">#1900</a></span> Now that job status TRANSFERRING_OUTPUT isn't used for the moment, the eventlog test output needs to be adjusted.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-05 08:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25895\">[25895]</a></span>: Version history for hold bug. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1900\" title=\"Running jobs leave queue when held\">#1900</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-05 08:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=20296\">[20296]</a></span>: Fix bug that removes running jobs instead of holding them. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1900\" title=\"Running jobs leave queue when held\">#1900</a></span> The shadow was unconditionally changing the job's state to TRANSFERRING_OUTPUT when it was told by the starter that the job was no longer running, regardless of why the job was no longer running. If the job was held (e.g. by condor_hold),\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Feb-08 15:29", "status": "resolved", "created": "2011-Feb-04 16:50", "fixed_version": "2011-Feb-04 16:50", "broken_version": "v070505", "priority": "1", "subsystem": "Daemons", "assigned_to": "jfrey", "derived_from": "#1641", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}