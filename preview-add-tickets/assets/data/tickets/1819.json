{"id": 1819, "title": "Ticket #1819: SubmitInfo.pm needs some cmake love", "description": "<blockquote>\n<div class=\"verbatim\">\n<pre>I went looking in the SubmitInfo.pm on the master branch and found things that\nlook like this:\n\nmy @minimal_build_configure_args =\n    (\n        '-DPROPER:BOOL=OFF'         =&gt; undef,\n        '-DCLIPPED:BOOL=ON'         =&gt; undef,\n        '-DWITH_BLAHP:BOOL=OFF'     =&gt; undef,\n        '-DWITH_BOOST:BOOL=OFF'     =&gt; undef,\n        '-DWITH_COREDUMPER:BOOL=OFF'    =&gt; undef,\n        '-DWITH_CREAM:BOOL=OFF'     =&gt; undef,\n        '-DWITH_CURL:BOOL=OFF'      =&gt; undef,\n        '-DWITH_DRMAA:BOOL=OFF'     =&gt; undef,\n        '-DWITH_EXPAT:BOOL=OFF'     =&gt; undef,\n        '-DWITH_GCB:BOOL=OFF'       =&gt; undef,\n        '-DWITH_GLOBUS:BOOL=OFF'    =&gt; undef,\n        '-DWITH_GSOAP:BOOL=OFF'     =&gt; undef,\n        '-DWITH_HADOOP:BOOL=OFF'    =&gt; undef,\n        '-DWITH_KRB5:BOOL=OFF'      =&gt; undef,\n        '-DWITH_LIBVIRT:BOOL=OFF'       =&gt; undef,\n        '-DWITH_LIBXML2:BOOL=OFF'       =&gt; undef,\n        '-DWITH_UNICOREGAHP:BOOL=OFF'   =&gt; undef,\n        '-DWITH_VOMS:BOOL=OFF'      =&gt; undef,\n    );\n\nThat's wrong since the arguments are key/value pairs but here the whole\nthing being represented as only the key value. Instead it should be\n(at the minimum) this:\n\nmy @minimal_build_configure_args =\n    (\n        '-DPROPER:BOOL'         =&gt; 'OFF',\n        '-DCLIPPED:BOOL'         =&gt; 'ON',\n        '-DWITH_BLAHP:BOOL'     =&gt; 'OFF',\n        '-DWITH_BOOST:BOOL'     =&gt; 'OFF',\n        '-DWITH_COREDUMPER:BOOL'    =&gt; 'OFF',\n        '-DWITH_CREAM:BOOL'     =&gt; 'OFF',\n        '-DWITH_CURL:BOOL'      =&gt; 'OFF',\n        '-DWITH_DRMAA:BOOL'     =&gt; 'OFF',\n        '-DWITH_EXPAT:BOOL'     =&gt; 'OFF',\n        '-DWITH_GCB:BOOL'       =&gt; 'OFF',\n        '-DWITH_GLOBUS:BOOL'    =&gt; 'OFF',\n        '-DWITH_GSOAP:BOOL'     =&gt; 'OFF',\n        '-DWITH_HADOOP:BOOL'    =&gt; 'OFF',\n        '-DWITH_KRB5:BOOL'      =&gt; 'OFF',\n        '-DWITH_LIBVIRT:BOOL'       =&gt; 'OFF',\n        '-DWITH_LIBXML2:BOOL'       =&gt; 'OFF',\n        '-DWITH_UNICOREGAHP:BOOL'   =&gt; 'OFF',\n        '-DWITH_VOMS:BOOL'      =&gt; 'OFF',\n    );\n\nThen I noticed that Z added something like this (note the -G usage):\n\n    'x86_64_winnt_5.1'  =&gt; {\n        'build' =&gt; {\n            'configure_args' =&gt; { '-G \\\"Visual Studio 9 2008\\\"' },\n            'prereqs'   =&gt; undef,\n            'xtests'    =&gt; undef,\n        },\n\n        'test' =&gt; {\n            'configure_args' =&gt; { @default_test_configure_args },\n            'prereqs'   =&gt; undef,\n            'testclass' =&gt; [ @default_testclass ],\n        },\n    },\n\nWhich is wrong because it is an odd number of keys in the configure_args\nhash table.\n\nTo make it a legal hash table definition, but following the wrong rendering\nabove, it would be:\n\n            'configure_args' =&gt; { '-G \\\"Visual Studio 9 2008' =&gt; undef },\n\nHowever, it really should be:\n\n            'configure_args' =&gt; { '-G' =&gt; 'Visual Studio 9 2008' },\n\nThen I noticed the larger problem that the SubmitInfo system was never\ntaught properly about how the cmake argument syntax differed from the\nconfigure syntax.\n\nFor example, currently when '-DFOOBAR:BOOL' =&gt; 'OFF' is assembled, the =\nsign is mandatorily enforced to form \"-DFOOBAR:BOOL=OFF\" and passed as a\ncommand line argument. This is the same thing when the -G flag to cmake\nis used. However, in that case the = sign is forbidden.\n\nThe method of option construction currently in SubmitInfo is a direct\nresult of how configure processes its arguments. In the configure flavor\nof SubmitInfo, the difference between a key with an undef value and a\nkey with a defined value is whether or not a = gets used when the final\noption to configure is generated. This is not true in the cmake system\nfor all arguments one can pass to cmake.\n\nSo, the right way to fix this is to construct two namespaces:\n\ncmake_args =&gt; { '-G' =&gt; '\\\"Visual Studio 9 2008\\\"', etc, etc, etc },\n\ncmake_cache_entries =&gt; { 'WITH_VOMS:BOOL' =&gt; 'OFF', etc, etc, etc },\n\nwhere cmake_args are not assembled with an =, but cmake_cache_entries\nare and the -D added when they are assembled.\n\nI don't have time for this work at the moment, but this is what should\nbe done to bring the SubmitInfo system in sync with the cmake changes.\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Dec-21 14:12:50 by tstclair:</em> <br/>\n\nThis seems like a good task for VDT as they will be maintaining this in the future.\n\n<p>_2011-Apr-13 by Scot Kronenfeld <br/>\n\nI fixed this.  Pete should review that the new format is correct.  Note that I didn't implement it exactly how he wrote in the ticket.  Per a discussion Pete and I had in my office a few weeks ago here's what I did.\n\n</p><p></p><div class=\"verbatim\">\n<pre>If the argument definition is\n\"-DFoo\" =&gt; \"Bar\"\nthen you get the form\n-DFoo='Bar'\n\nIf the argument definition is\n\"-DFoo Bar\" =&gt; undef\nthen you get the form\n-DFoo Bar\n</pre></div>\n\n\n<p>This allows the funky Windows style arguments to be expressed with minimal effort.\n\n</p><p></p><hr/>\n<em>2011-Apr-13 16:19:24 by psilord:</em> <br/>\n\nOk, I looked at the patch. The technical work is fine. I'm resolving the ticket.\n\n<p>However, it looks like a huge amount of additional whitespace changes also\nhappened. Be careful to keep that stuff to a minimum or in a separate commit.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-13 14:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=21386\">[21386]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1819\" title=\"SubmitInfo.pm needs some cmake love\">#1819</a></span> - Improved how arguments are specified in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SubmitInfo\" title=\"Submit Info\">SubmitInfo</a></span> hash.  (By Scot Kronenfeld )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Dec-21 14:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=19754\">[19754]</a></span>: This is the wrong way to fix this problem. See <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1819\" title=\"SubmitInfo.pm needs some cmake love\">#1819</a></span> for how the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SubmitInfo\" title=\"Submit Info\">SubmitInfo</a></span> system should be actually fixed to deal with cmake.  (By Peter Keller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Oct-19 09:50", "status": "resolved", "created": "2010-Dec-21 13:56", "fixed_version": "2010-Dec-21 13:56", "broken_version": "v070506", "priority": "4", "subsystem": "Packaging", "assigned_to": "kronenfe", "derived_from": "", "creator": "psilord", "rust": "", "customer_group": "other", "visibility": "public", "notify": "psilord@cs.wisc.edu tstclair@redhat.com kronenfe@cs.wisc.edu", "due_date": ""}