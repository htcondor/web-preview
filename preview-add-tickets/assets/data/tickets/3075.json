{"id": 3075, "title": "Ticket #3075: Proper build fails on Centos 5", "description": "<blockquote>\nOn Centos 5, a proper build fails because of boost.\n\n<p>On Centos 5, v1.33 of boost is packaged, and that version of boost does not have the boost system library, nor does it have unordered_map.hpp.\n\n</p><p><a class=\"file\" href=\"rlog?f=externals/bundles/boost/1.49.0/CMakeLists.txt\">/externals/bundles/boost/1.49.0/CMakeLists.txt</a> needs some love.\n\n</p><p>So the line\n\n</p><p></p><pre>    find_package( Boost 1.33.1 COMPONENTS thread program_options system regex filesystem)\n</pre>\n\n<p>should probably be changed to not require the COMPONENTS, since all we really need is a couple header files.  Plus the \"system\" component does not exist in boost v1.33.\n\n</p><p>Next the code should fall back on using tr1 unordered_map if not found in boost, since although boost on centos 5 does not have unordered_map, at least the following file does exist on centos 5:\n\n</p><p></p><pre>   usr/include/c++/4.1.1/tr1/unordered_map</pre>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Jun-21 16:46:15 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW 1</strong>\n\n<p>So <span class=\"chng\"><a href=\"chngview?cn=32450\">[32450]</a></span> fixes the problem for proper builds, however, it now appears the patch breaks non-proper (UW style) builds.  UW builds break when the configure for cream fails to build a simple classad binary.  The choice of tr1 vs boost needs to be enforced in the installed classad headers without depending on the user setting a #define. See 733f6b50 for an example of how you can fix this.\n\n</p><p></p><hr/>\n<em>2012-Jun-22 15:34:45 by tstclair:</em> <br/>\n\nIt should be totally hidden now.\n\n<p></p><hr/>\n<em>2012-Jun-27 15:21:00 by tstclair:</em> <br/>\n\nI believe this is all resolved now.\n\n<p></p><hr/>\n<em>2012-Jul-16 17:28:52 by jfrey:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>The current setup for selecting STL unordered_map, weak_ptr, and shared_ptr look good.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-22 15:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32459\">[32459]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3075\" onclick=\"get_ticket_and_populate_wrapper('3075'); return false;\" title=\"Proper build fails on Centos 5\">#3075</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2541\" onclick=\"get_ticket_and_populate_wrapper('2541'); return false;\" title=\"Memory utilization of classads (revised)\">#2541</a></span> remove namespace collision with prefix classad_  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-22 15:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32458\">[32458]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3075\" onclick=\"get_ticket_and_populate_wrapper('3075'); return false;\" title=\"Proper build fails on Centos 5\">#3075</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2541\" onclick=\"get_ticket_and_populate_wrapper('2541'); return false;\" title=\"Memory utilization of classads (revised)\">#2541</a></span> Add in order checks for standard features C++11 -&gt; tr1 -&gt; boost. Sadly our code base needs tender love for C++11 support. Also hides boost from classads exposure where possible.  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-22 11:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32457\">[32457]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3075\" onclick=\"get_ticket_and_populate_wrapper('3075'); return false;\" title=\"Proper build fails on Centos 5\">#3075</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2541\" onclick=\"get_ticket_and_populate_wrapper('2541'); return false;\" title=\"Memory utilization of classads (revised)\">#2541</a></span> Update build chain to prefer local system boost when possible even when non-proper. This ensures distributed libraries match system where possible.  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-21 17:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32456\">[32456]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2541\" onclick=\"get_ticket_and_populate_wrapper('2541'); return false;\" title=\"Memory utilization of classads (revised)\">#2541</a></span> &amp; Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3075\" onclick=\"get_ticket_and_populate_wrapper('3075'); return false;\" title=\"Proper build fails on Centos 5\">#3075</a></span> Update cream to use prefixed boost with prefixed classads  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-21 15:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32450\">[32450]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3075\" onclick=\"get_ticket_and_populate_wrapper('3075'); return false;\" title=\"Proper build fails on Centos 5\">#3075</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2541\" onclick=\"get_ticket_and_populate_wrapper('2541'); return false;\" title=\"Memory utilization of classads (revised)\">#2541</a></span> Where boost doesn't exist prefer tr1.  (By Timothy St. Clair )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Sep-26 13:34", "status": "resolved", "created": "2012-Jun-21 12:28", "fixed_version": "2012-Jun-21 12:28", "broken_version": "v070900", "priority": "2", "subsystem": "Packaging", "assigned_to": "tstclair", "derived_from": "#2541", "creator": "tannenba", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tannenba@cs.wisc.edu, tstclair@redhat.com, jfrey@cs.wisc.edu", "due_date": ""}