{"id": 1835, "title": "Ticket #1835: ArgList displaying very odd behavior on Windows", "description": "<blockquote>\nThere exists a very odd bug inside <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ArgList\" title=\"Arg List\">ArgList</a></span> that is being exposed in condor_hdfs on Windows.  The bug manifests in the Hadoop::startService( <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NodeType\" title=\"Node Type\">NodeType</a></span> type) function, when we try calling arglist.RemoveArg(0) on around line 512.  This causes a crash on Windows.  If however one calls arglist.Count() or even arglist.GetArgsStringForDisplay before calling arglist.RemoveArg(0), the problem goes away and condor_hdfs goes merrily on its way.  This behavior was not exhibited in 7.5.4.  The only changes made to the arglist class was done over a year ago before the 7.5 series and the code in hadoop.cpp that calls on <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RemoveArg\" title=\"Remove Arg\">RemoveArg</a></span> was written by Faisal during his original work on hadoop for Condor.  The only change between 7.5.4 and 7.5.5 are the switch over to the new Windows libraries in the Windows 7 SDK and the possible changes in compiler optimization switches being used.  No code changes are present around the relevant blocks of code.</blockquote>", "remarks": "<blockquote>\n<em>2011-Jan-05 16:47:09 by ziliang:</em> <br/>\n\nFollowing a suggestion by Dan, I went and reverted the optimization level in the VC proj file to O1, optimize for size, for both the condor_util library and condor_hdfs.  O1 was what the old build used.  O2 is what cmake sets for its <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RelWithDebInfo\" title=\"Rel With Deb Info\">RelWithDebInfo</a></span> configuration.  The compiled binary worked and did not exhibit the crash in arglist.RemoveArg(0) in hadoop.cpp and considering this issue does not appear on Linux, this appears to be a compiler issue.\n\n<p></p><hr/>\n<em>2011-Jan-14 16:08:42 by ziliang:</em> <br/>\n\nA potential cause for the corruption found not related to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ArgList\" title=\"Arg List\">ArgList</a></span>, but will need to verify before resolving this.\n\n<p></p><hr/>\n<em>2011-Jan-18 14:16:11 by ziliang:</em> <br/>\n\nCause verified and new ticket updated to reflect actual cause of problems.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1854\" onclick=\"get_ticket_and_populate_wrapper('1854'); return false;\" title=\"Stack corruption in condor_hdfs due to writing beyond an array's bound\">#1854</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nStack corruption in condor_hdfs due to writing beyond an array's bound</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "", "type": "defect", "last_change": "2011-Jan-18 14:16", "status": "resolved", "created": "2011-Jan-05 14:09", "fixed_version": "2011-Jan-05 14:09", "broken_version": "v070505", "priority": "3", "subsystem": "Win32", "assigned_to": "ziliang", "derived_from": "", "creator": "ziliang", "rust": "", "customer_group": "other", "visibility": "public", "notify": "adesmet@cs.wisc.edu, tannenba@cs.wisc.edu, johnkn.cs.wisc.edu, tstclair@redhat.com", "due_date": "20110201"}