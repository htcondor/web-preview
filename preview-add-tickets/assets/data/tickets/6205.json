{"id": 6205, "title": "Ticket #6205: condor_top using python bindings (condor_top.py)", "description": "<blockquote>\n<code>condor_top.pl</code> (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6067\" onclick=\"get_ticket_and_populate_wrapper('6067'); return false;\" title=\"add a tool that can compare daemon stats and show top results\">#6067</a></span>) is not a user-friendly script in that it requires users to dump <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> from a daemon (e.g. using <code>condor_status</code>) at regular intervals. Using the HTCondor Python bindings, we can query daemon <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> directly and update stats on a timer, much like how the *nix tool <code>top</code> works.\n\n<p>Output from <code>condor_top.py</code> will look something like:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">Collector status as of 2017-03-27 19:42:16\n\nMemory: 575.3K                      RSS: 507.3K\nDuty Cycle: 7.90%                   Ops/second: 56.330\n\nRuntime Inst.Avg   Avg Count/Min     Count   Max Item\n52527.8    0.001 0.001    2226.0  46411853 0.345 CollectorEngine_receive_update\n51138.9    0.001 0.001    2226.0  46411847 0.345 CollectorEngine_ru_collect\n51087.2    0.001 0.001    2226.0  46411853 0.345 CollectorEngine_ruc\n49250.2    0.002 0.001    1305.0  36430536 0.277 Command_UPDATE_STARTD_AD\n32867.9    0.001 0.001    2226.0  46411847 0.329 CollectorEngine_ruc_collect\n32772.1    0.001 0.001    2226.0  46412810 0.329 CollectorEngine_rucc\n24197.2    0.001 0.001    1302.0  35947068 0.099 CollectorEngine_rucc_updateAd\n17582.4    0.000 0.000    2226.0  46411847 0.270 CollectorEngine_ruc_getAd\n 5547.1    0.025 0.028      27.0    198592 0.616 HandleQueryForked\n 3696.6    0.000 0.000    1305.0  36430530 0.023 CollectorEngine_rucc_getPvtAd\n 2961.4      n/a 0.206       0.0     14383 0.786 Timer_WriteHistory\n 2131.0    0.000 0.000    1302.0  35947068 0.013 CollectorEngine_rucc_updatePvtAd\n 2028.7    0.000 0.000     921.0   9982280 0.329 CollectorEngine_rucc_other\n 1908.2    0.020 0.015      21.0    131575 0.617 Command_QUERY_STARTD_ADS\n 1658.1    0.000 0.000     597.0   4749112 0.086 Command_UPDATE_SUBMITTOR_AD\n 1067.8    0.021 0.027       6.0     39890 0.205 Command_QUERY_ANY_ADS\n  959.0    0.000 0.000     198.0   2660611 0.345 Command_UPDATE_MASTER_AD\n  843.9    0.001 0.002      12.0    546361 1.248 Command_INVALIDATE_STARTD_ADS\nUpdating ClassAd in    15 s\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2017-Apr-05 16:37:33 by jpatton:</em> <br/>\n\nInitial version:\n<ul>\n<li>Help is invoked with ./condor_top.py -h\n</li><li>Tries to use smart defaults to query the right daemon (<code>COLLECTOR_HOST</code> if collector/negotiator/master, <code>FULL_HOSTNAME</code> if schedd/startd)\n</li><li>Warns if multiple <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> are returned (user should specify <code>NAME</code> using -n)\n</li><li>Fits to size of console if on Linux, otherwise assumes 25 rows x 80 cols\n</li></ul>\n\n<p></p><hr/>\n<em>2017-Apr-20 11:47:08 by tim:</em> <br/>\n\nisn't the standard terminal size 80x24?\n\n<p></p><hr/>\n<em>2017-Apr-20 12:03:48 by tim:</em> <br/>\n\nThis is not installed. Bumping to next release.\n\n<p></p><hr/>\n<em>2017-Jun-13 09:35:46 by tim:</em> <br/>\n\n<strong>CODE REVIEW</strong>: Looks good. Just needs documentation now.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6352\" onclick=\"get_ticket_and_populate_wrapper('6352'); return false;\" title=\"Improve condor_top\">#6352</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nImprove condor_top</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-20 21:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51777\">[51777]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6205\" onclick=\"get_ticket_and_populate_wrapper('6205'); return false;\" title=\"condor_top using python bindings (condor_top.py)\">#6205</a></span>) RPM package condor_top man page  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-20 16:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51776\">[51776]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6205\" onclick=\"get_ticket_and_populate_wrapper('6205'); return false;\" title=\"condor_top using python bindings (condor_top.py)\">#6205</a></span>) Fix manual breakage  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-20 15:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51765\">[51765]</a></span>: Adding documentation for condor_top (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6205\" onclick=\"get_ticket_and_populate_wrapper('6205'); return false;\" title=\"condor_top using python bindings (condor_top.py)\">#6205</a></span>)  (By Jason Patton )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-02 14:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51674\">[51674]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6205\" onclick=\"get_ticket_and_populate_wrapper('6205'); return false;\" title=\"condor_top using python bindings (condor_top.py)\">#6205</a></span>) standard terminal is 80x24  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-02 13:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51671\">[51671]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6205\" onclick=\"get_ticket_and_populate_wrapper('6205'); return false;\" title=\"condor_top using python bindings (condor_top.py)\">#6205</a></span>) put condor_top python script into python sub-package  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-02 09:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51668\">[51668]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6205\" onclick=\"get_ticket_and_populate_wrapper('6205'); return false;\" title=\"condor_top using python bindings (condor_top.py)\">#6205</a></span>) Package the new condor_top, not condor_top.pl  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-05 16:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50418\">[50418]</a></span>: Initial version of condor_top.py for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6205\" onclick=\"get_ticket_and_populate_wrapper('6205'); return false;\" title=\"condor_top using python bindings (condor_top.py)\">#6205</a></span>  (By Jason Patton )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Jun-20 15:13", "status": "resolved", "created": "2017-Mar-27 14:49", "fixed_version": "2017-Mar-27 14:49", "broken_version": "", "priority": "3", "subsystem": "Tools", "assigned_to": "jpatton", "derived_from": "#6067", "creator": "jpatton", "rust": "a64607", "customer_group": "other", "visibility": "public", "notify": "johnkn@cs.wisc.edu", "due_date": "20170331"}