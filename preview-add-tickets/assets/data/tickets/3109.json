{"id": 3109, "title": "Ticket #3109: DAGMan and job lost over condor_off/condor_on pair.", "description": "<blockquote>\nIt looks like some jobs weren't restarted after (accidentally) condor_off'ing on submit-2.batlab.org.  I've grabbed a copy of Condor's logs and of the run directory of a run displaying the problem and stashed them in ~tlmiller/scary-problem on that machine.\n\n<p>In particular: the monitor is not presently running, yet is job log (monitor.log) ends with an eviction notice, rather than a terminate or remove event.  This seems to violate one of our invariants.  Likewise for the DAGMan watching the monitor.\n\n</p><p>The monitor's log:\n\n</p><p></p><pre>  000 (445454.000.000) 07/02 11:34:40 Job submitted from host: &lt;128.104.100.29:9543&gt;\n      DAG Node: monitor\n  ...\n  001 (445454.000.000) 07/02 11:34:41 Job executing on host: &lt;128.104.100.29:9543&gt;\n  ...\n  004 (445454.000.000) 07/03 15:12:43 Job was evicted.\n          (0) Job was not checkpointed.\n                  Usr 0 00:00:00, Sys 0 00:00:00  -  Run Remote Usage\n                  Usr 0 00:00:00, Sys 0 00:00:00  -  Run Local Usage\n          0  -  Run Bytes Sent By Job\n          0  -  Run Bytes Received By Job\n  ...\n</pre>\n\n<p>Everything in the schedd logs about it:\n\n</p><p></p><pre>  condor/SchedLog.old:07/03/12 15:12:43 (pid:23814) Sending SIGTERM to scheduler universe job 445454.0 (pid: 7408)\n  condor/SchedLog.old:07/03/12 15:12:43 (pid:23814) scheduler universe job (445454.0) pid 7408 exited with status 4\n</pre>\n\n<p>And condor_q 445454.0 returns nothing.\n\n</p><p>For the corresponding DAGMan:\n\n</p><p></p><pre>  000 (445452.000.000) 07/02 11:34:25 Job submitted from host: &lt;128.104.100.29:9543&gt;\n  ...\n  001 (445452.000.000) 07/02 11:34:25 Job executing on host: &lt;128.104.100.29:9543&gt;\n  ...\n  004 (445452.000.000) 07/03 15:12:33 Job was evicted.\n          (0) Job was not checkpointed.\n                  Usr 0 00:00:00, Sys 0 00:00:00  -  Run Remote Usage\n                  Usr 0 00:00:00, Sys 0 00:00:00  -  Run Local Usage\n          0  -  Run Bytes Sent By Job\n          0  -  Run Bytes Received By Job\n  ...\n</pre>\n\n<p>and its schedd log entries:\n\n</p><p></p><pre>  condor/SchedLog.old:07/03/12 15:12:33 (pid:23814) Sending SIGTERM to scheduler universe job 445452.0 (pid: 7355)\n  condor/SchedLog.old:07/03/12 15:12:33 (pid:23814) scheduler universe job (445452.0) pid 7355 exited with status 3\n</pre>\n\n<p>The schedd was trying to a graceful shutdown as a result of the accidental condor_off:\n\n</p><p></p><pre>  07/03/12 15:08:59 (pid:23814) Got SIGTERM. Performing graceful shutdown.\n  07/03/12 15:38:59 (pid:23814) Got SIGQUIT.  Performing fast shutdown.\n</pre>\n\n<p>but didn't finish.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Jul-10 12:42:31 by tlmiller:</em> <br/>\n\nUsed condor_history belatedly, didn't find anything.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "defect", "last_change": "2012-Jul-10 12:42", "status": "new", "created": "2012-Jul-05 15:27", "fixed_version": "2012-Jul-05 15:27", "broken_version": "", "priority": "4", "subsystem": "Daemons", "assigned_to": "", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "zmiller@cs.wisc.edu", "due_date": ""}