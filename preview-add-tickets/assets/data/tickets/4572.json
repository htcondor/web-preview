{"id": 4572, "title": "Ticket #4572: configure a filetransfer plugin for irods to run with root priv", "description": "<blockquote>\nAssume you are running HTCondor v8.2.3 or above.\n\n<p></p><ul>\n<li>Place all these files (attached to ticket) in some directory, aka <code>/path/to/irods_root_plugin</code>\n\n<p></p></li><li>Edit <code>irods_root_plugin.C</code> and modify the two <code>#defines</code> at the top\n\n<p></p></li><li>Run \"<code>make</code>\" to build the <code>irods_root_plugin</code> (or compile by hand)\n\n<p></p></li><li>permissions should be as follows:\n<div class=\"code\">\n<pre class=\"code\">% ls -l\ntotal 32\n 4 -rwxr-xr-x 1 condor  condor    242 Aug 26 13:35 irods_plugin.sh*\n16 -rwxr-xr-x 1 root    condor  12579 Aug 26 14:35 irods_root_plugin*\n 4 -rw------- 1 condor  condor   1674 Aug 26 14:35 irods_root_plugin.C\n 4 -rw------- 1 root    condor     10 Aug 26 13:26 magic_pass\n 4 -rw------- 1 condor  condor     92 Aug 26 14:00 Makefile\n</pre></div>\n\n\n<p></p></li><li>add to condor_config file:\n<div class=\"code\">\n<pre class=\"code\">filetransfer_plugins = /path/to/irods_root_plugin\nRUN_FILETRANSFER_PLUGINS_WITH_ROOT = True\n</pre></div>\n\n\n<p></p></li><li>add to job submit file:\n<div class=\"code\">\n<pre class=\"code\"># there must be exactly one input and output file so the plugin is invoked exactly once for input and once for output\ntransfer_input_files = irods://dev/null\ntransfer_output_files = /dev/null\noutput_destination = irods://dev/null\nshould_transfer_files = Yes\nwhen_to_transfer_output = ON_EXIT\n</pre></div>\n\n\n<p></p></li><li>Root debug log is written into <code>/tmp/zkm-d.$$</code>\n\n<p></p></li><li>Plugin debug log is written into <code>/tmp/zkm-p.$$</code></li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4561\" onclick=\"get_ticket_and_populate_wrapper('4561'); return false;\" title=\"Allow file transfer plugins to run with ruid root\">#4561</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAllow file transfer plugins to run with ruid root</td></tr>\n</tbody></table>", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/842/irods_plugin.sh\">irods_plugin.sh</a>\n448 bytes added by zmiller on 2014-Sep-04 18:58:46 UTC.\n<br/>\nThe actual plugin to run as the user<br/>\n</li><li><a href=\"attach_get/843/irods_root_plugin.C\">irods_root_plugin.C</a>\n2754 bytes added by zmiller on 2014-Sep-04 18:59:23 UTC.\n<br/>\nC source for the plugin that starts as root as does permission manipulation<br/>\n</li><li><a href=\"attach_get/844/Makefile\">Makefile</a>\n151 bytes added by zmiller on 2014-Sep-04 18:59:59 UTC.\n<br/>\nMakefile for the C program<br/>\n</li><li><a href=\"attach_get/845/magic_pass\">magic_pass</a>\n9 bytes added by zmiller on 2014-Sep-04 19:00:34 UTC.\n<br/>\nPlaceholder password file<br/>\n</li></ul>\n</blockquote>", "check_ins": "", "type": "experimental", "last_change": "2014-Sep-04 14:51", "status": "resolved", "created": "2014-Sep-04 13:53", "fixed_version": "2014-Sep-04 13:53", "broken_version": "", "priority": "4", "subsystem": "FileTransfer", "assigned_to": "zmiller", "derived_from": "", "creator": "zmiller", "rust": "", "customer_group": "iplant", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}