{"id": 6640, "title": "Ticket #6640: Jobs dont start on windows if INTERACTIVE login is disabled", "description": "<blockquote>\nUSGS was having a problem where jobs could be submitted, but would always fail to transfer input because the shadow was unable to impersonate the user.  There was a valid user/password in the CREDD store (i.e. set by condor_store_cred), but it could not be used because their LDAP server had a group policy that disabled INTERACTIVE logon, only allowing NETWORK logon.\n\n<p>The difference between NETWORK login and INTERACTIVE, is that INTERACTIVE tells Windows to cache the login info, so that a user can subsequently login to their machine even if the LDAP server cannot be conctacted at the next logon attempt. NETWORK login will always query the LDAP server.\n\n</p><p>Thus HTCondor should not care which type of logon is used, and indeed, condor_store cred will first use NETWORK and then INTERACTIVE when it tries to validate a credential.  But the SCHEDD, SHADOW, and STARTER will only use INTERACTIVE login.\n\n</p><p>This should be changed so that the SCHEDD first tries INTERACTIVE, and if that fails with the correct error code, it should then try NETWORK logon.  Also so that system administrators can avoid this inefficiency or force a certain type of logon (BATCH mode is also a type), a new knob should be added to choose which logon type the schedd,shadow and starter will use.  If this knob is set to AUTO (the default) then it will try INTERACTIVE and then NETWORK.\n\n</p><p>The new knob is windows specific, it will be called <code>WINDOWS_LOGON32_TYPE</code> and allowed values will be (not case sensitive):\n</p><ul>\n<li>AUTO - try INTERACTIVE, if that fails with <code>ERROR_LOGON_TYPE_NOT_GRANTED</code> then try NETWORK. This is the default\n</li><li>INTERACTIVE - always use <code>LOGON32_LOGON_INTERACTIVE</code>\n</li><li>NETWORK - always use <code>LOGON32_LOGON_NETWORK</code>\n</li><li>BATCH -  always use <code>LOGON32_LOGON_BATCH</code>\n</li></ul>\n\n<p>Any unrecognised value will be treated as AUTO.</p></blockquote>", "remarks": "<blockquote>\n<em>2018-May-10 06:33:54 by tim:</em> <br/>\n\nShouldn't WINDOWS_&amp;#8203;LOGON32_TYPE be in the param table?\n\n<p></p><hr/>\n<em>2018-May-10 12:56:22 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p><code>WINDOWS_LOGON32_TYPE</code> should be in the param table and be documented, or this ticket should explicitly explain why it should be undocumented. FWIW, I think it would make sense to leave <code>WINDOWS_LOGON32_TYPE</code> undocumented....</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-10 10:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54902\">[54902]</a></span>: Version histories for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6645\" onclick=\"get_ticket_and_populate_wrapper('6645'); return false;\" title=\"Increase systemd TasksMax\">#6645</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6662\" onclick=\"get_ticket_and_populate_wrapper('6662'); return false;\" title=\"RPATH improperly set in RPM builds\">#6662</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6640\" onclick=\"get_ticket_and_populate_wrapper('6640'); return false;\" title=\"Jobs dont start on windows if INTERACTIVE login is disabled\">#6640</a></span>. Final build.  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Apr-05 12:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54670\">[54670]</a></span>: fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6640\" onclick=\"get_ticket_and_populate_wrapper('6640'); return false;\" title=\"Jobs dont start on windows if INTERACTIVE login is disabled\">#6640</a></span>, on Windows try NETWORK logon after INTERACTIVE fails with ERROR_LOGON_TYPE_NOT_GRANTED ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2018-May-10 14:44", "status": "resolved", "created": "2018-Apr-05 12:30", "fixed_version": "2018-Apr-05 12:30", "broken_version": "v080600", "priority": "3", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}