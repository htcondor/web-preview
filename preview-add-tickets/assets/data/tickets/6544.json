{"id": 6544, "title": "Ticket #6544: Add GPUsMemoryUsage", "description": "<blockquote>\nWith <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6477\" title=\"Advertise GPU utilization in the same way as CPU utilization\">#6477</a></span> complete, we have an infrastructure for, but no data about, GPUsMemoryUsage.  This ticket covers two tasks:\n\n<p></p><ol>\n<li>Add a peak memory usage report to <code>condor_gpu_utilization</code>.\n</li><li>Verify that the plumbing all functions properly.\n</li></ol>\n\n<p>The first point should be relatively straightforward.\n\n</p><p>I've split the second point into basic tests and additional tests to mirror what happened with SUM metrics.  The CI tests for this commit just need to test one PEAK metric with multiple resource instances.</p></blockquote>", "remarks": "<blockquote>\n<em>2018-Feb-02 10:21:33 by tlmiller:</em> <br/>\n\nManual testing with multiple instances of the same type in partitionable slots has already found what appears to be consistent undercounting when both resources have nonzero usage.\n\n<p>[Recorded in ticket <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6553\" title=\"GPUsUsage accounts for multiple GPU devices improperly.\">#6553</a></span> and subsequently fixed.]\n\n</p><p></p><hr/>\n<em>2018-Feb-19 15:06:32 by tlmiller:</em> <br/>\n\nThe basic tests here will also check both static and dynamic slots, as well as slot reuse.\n\n<p></p><hr/>\n<em>2018-Feb-19 15:09:51 by tlmiller:</em> <br/>\n\nThey will not, however, make use of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DeferralTime\" title=\"Deferral Time\">DeferralTime</a></span> to try to ensure that we hit each position in each sequence of memory usage reports; instead, we'll assume some randomness over the whole test suite and over time will do a thorough-enough test.  This is because <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DeferralTime\" title=\"Deferral Time\">DeferralTime</a></span> is implemented in the starter, and since the startd starts tracking usage once the starter is spawned, the reported peak usages can look impossible (since they can include peaks from before the job started).  In real life, this won't be a problem unless the monitor in question is <em>also</em> misreporting.\n\n<p></p><hr/>\n<em>2018-Feb-27 11:16:34 by tlmiller:</em> <br/>\n\nShould test new memory-usage probe on \"the\" 4-GPU machine.\n\n<p></p><hr/>\n<em>2018-Mar-08 13:59:05 by tlmiller:</em> <br/>\n\n&gt; Should test new memory-usage probe on \"the\" 4-GPU machine.\n\n<p>Done.  Looks good.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Mar-08 14:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54460\">[54460]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6544\" title=\"Add GPUsMemoryUsage\">#6544</a></span>) Fix bad monitor example in manual.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-27 11:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54376\">[54376]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6544\" title=\"Add GPUsMemoryUsage\">#6544</a></span>) Documentation.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-22 15:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54346\">[54346]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6544\" title=\"Add GPUsMemoryUsage\">#6544</a></span>) Report GPU memory usage.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-22 13:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54344\">[54344]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6544\" title=\"Add GPUsMemoryUsage\">#6544</a></span>) Test one PEAK metric. (<span class=\"ticket\"><a class=\"abandoned\" href=\"tktview?tn=6569\" title=\"Test multiple PEAK metrics.\">#6569</a></span>) Test one SUM and one PEAK metric simultaneously. Patch up some other testing bugs. Activate both one-PEAK and one-PEAK-and-one-SUM tests.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-16 14:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54328\">[54328]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6544\" title=\"Add GPUsMemoryUsage\">#6544</a></span>) Test metrics with claim reuse.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-14 16:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54327\">[54327]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6544\" title=\"Add GPUsMemoryUsage\">#6544</a></span>) Fix problem with bogus first value for job-specific PEAK metrics. Test also now recognizes and ignores when a PEAK metric is undefined.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-13 19:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54326\">[54326]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6544\" title=\"Add GPUsMemoryUsage\">#6544</a></span>) Tests for PEAK metrics.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-13 17:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54325\">[54325]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=6544\" title=\"Add GPUsMemoryUsage\">#6544</a></span>) First pass at PEAK metrics.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-Mar-08 14:46", "status": "resolved", "created": "2018-Jan-25 19:19", "fixed_version": "2018-Jan-25 19:19", "broken_version": "v080707", "priority": "2", "subsystem": "DaemonsExecNode", "assigned_to": "tlmiller", "derived_from": "#6477", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}