{"id": 3313, "title": "Ticket #3313: missing semanage requires in condor.spec", "description": "<blockquote>\nPatch submitted via github -\n\n<p> pull request: <a class=\"external\" href=\"https://github.com/htcondor/htcondor/pull/2\">https://github.com/htcondor/htcondor/pull/2</a>\n\n</p><p> patch: <a class=\"external\" href=\"https://github.com/lwandrebeck/htcondor/commit/e5654424ae5e6a3b3c5f61be08929ca37f2d4d53\">https://github.com/lwandrebeck/htcondor/commit/e5654424ae5e6a3b3c5f61be08929ca37f2d4d53</a>\n\n</p><p>Need -\n</p><ol>\n<li>condor-wiki account for Laurent <strong>[DONE]</strong>\n</li><li>signed CLA from Laurent\n</li><li>review &amp; feedback on patch from packaging team <strong>[DONE]</strong>\n</li></ol>\n\n<p>Note - commit needs to be done with --author=\"Laurent Wandrebeck &lt;l.wandrebeck@gmail.com&gt;\"</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Nov-09 10:50:48 by matyas:</em> <br/>\n\nReviewed the patch. Patch adds an explicit requirement for /usr/sbin/semanage for the pre-install step. However, /usr/sbin/semanage is used in the post-install step.\n\n<p>The issue is valid, however. I've attached a patch for how I would do it instead.\n\n</p><p>Some justification for removing the test for the existence of /usr/sbin/selinuxenabled in the post step: we cannot make a requirement conditional -- that is, we cannot say \"require semanage only if selinuxenabled is also present.\" If we are going to bring semanage in, then we should also bring in selinuxenabled -- which makes the test superfluous.\n\n</p><p></p><hr/>\n<em>2012-Nov-10 14:46:05 by l.wandrebeck:</em> <br/>\n\nPerfectly right matyas, your patch is 1st not buggy (contrary to mine) and 2nd just better. don't even bother with authorship, commit yours.\nThanks for quickly taking care of that one :)\n\n<p></p><hr/>\n<em>2012-Nov-14 18:15:00 by matyas:</em> <br/>\n\nThis is now in the 7.9.2 branch. Should make sure it does not break anything and then discuss if we should merge it into 7.8.\n\n<p></p><hr/>\n<em>2012-Nov-15 03:27:15 by l.wandrebeck:</em> <br/>\n\nI have both a CentOS 5 (running fine) and a CentOS 6 condor cluster (acting strangely&amp;#8230;tasks are split only over the master, no time yet to find out why) so it <strong>may</strong> be related to that selinux thing.\nIf you could build up a new 7.8 release with the fix in, I'll be glad to test it right away.\n\n<p></p><hr/>\n<em>2012-Nov-15 19:24:44 by matyas:</em> <br/>\n\nBuild 78994 ( <a class=\"external\" href=\"http://submit-2.batlab.org/nmi/results/details?runID=78944\">http://submit-2.batlab.org/nmi/results/details?runID=78944</a> ) contains 7.8.6 RPMs built with the patch. Let me know if that works.\n\n<p></p><hr/>\n<em>2012-Nov-20 09:25:20 by matyas:</em> <br/>\n\nI got the paths wrong and broke the package; fixed it in my next commit. Laurent, if you want to try 7.8.6 again, it's run 79689.\n\n<p></p><hr/>\n<em>2012-Dec-03 03:45:13 by l.wandrebeck:</em> <br/>\n\nSorry for the delay, I've been gulped by another task. Thing is, I clicked about everywhere I could and I'm unable to find the resulting RPM for testing ? Am I&amp;#160;blind or did I miss a step somewhere ?\n\n<p></p><hr/>\n<em>2012-Dec-03 09:33:06 by matyas:</em> <br/>\n\nI'm guessing the results got cleaned up due to age. I'll submit a new build.\n\n<p></p><hr/>\n<em>2012-Dec-03 15:22:01 by matyas:</em> <br/>\n\nTry out this build:\n<a class=\"external\" href=\"http://submit-2.batlab.org/nmi/results/details?runID=82645\">http://submit-2.batlab.org/nmi/results/details?runID=82645</a>\n\n<p></p><hr/>\n<em>2012-Dec-05 07:38:59 by l.wandrebeck:</em> <br/>\n\nOK, tested. Installs fine (had installed by hand policycoreutils-python before that, to be sure that selinux thing was not the problem of tasks not being splitted over all servers.\nI still need to launch a run on it (should be done in a couple hours), but I'm afraid it still won't split tasks on the other boxes. Wondering why as it's the same conf as on the Centos 5 cluster which runs fine&amp;#8230;</blockquote>", "derived_tickets": "", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/646/rpm-selinux.patch\">rpm-selinux.patch</a>\n864 bytes added by matyas on 2012-Nov-09 16:51:27 UTC.\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jan-16 11:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=34658\">[34658]</a></span>: edit of 7.9.3 version history item ===GT=== <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=3313\" onclick=\"get_ticket_and_populate_wrapper('3313'); return false;\" title=\"missing semanage requires in condor.spec\">#3313</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jan-15 15:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=34653\">[34653]</a></span>: Add version history for RPM change in <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=3313\" onclick=\"get_ticket_and_populate_wrapper('3313'); return false;\" title=\"missing semanage requires in condor.spec\">#3313</a></span>. ===GT=== <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=3313\" onclick=\"get_ticket_and_populate_wrapper('3313'); return false;\" title=\"missing semanage requires in condor.spec\">#3313</a></span> ===VersionHistory:Complete===  (By Matyas Selmeci )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Nov-19 16:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=34154\">[34154]</a></span>: Fixed paths in my previous commit (e0adc027) regarding adding the selinux console utilities as dependencies. ===GT:Fixed=== <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=3313\" onclick=\"get_ticket_and_populate_wrapper('3313'); return false;\" title=\"missing semanage requires in condor.spec\">#3313</a></span> ===VersionHistory:Pending===  (By Matyas Selmeci )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Nov-14 17:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=34121\">[34121]</a></span>: Add /usr/sbin/selinuxenabled, /usr/sbin/semanage and /usr/sbin/restorecon as dependencies of the RPM. Those commands are used in the %post scriptlet, so they should be on the system even if SELinux is not enabled. ===GT:Fixed=== <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=3313\" onclick=\"get_ticket_and_populate_wrapper('3313'); return false;\" title=\"missing semanage requires in condor.spec\">#3313</a></span> ===VersionHistory:Pending===  (By Matyas Selmeci )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Nov-14 17:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=34120\">[34120]</a></span>: Add /usr/sbin/selinuxenabled, /usr/sbin/semanage and /usr/sbin/restorecon as dependencies of the RPM. Those commands are used in the %post scriptlet, so they should be on the system even if SELinux is not enabled. ===GT:Fixed=== <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=3313\" onclick=\"get_ticket_and_populate_wrapper('3313'); return false;\" title=\"missing semanage requires in condor.spec\">#3313</a></span> ===VersionHistory:Pending===  (By Matyas Selmeci )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Dec-05 07:38", "status": "active", "created": "2012-Nov-09 10:19", "fixed_version": "2012-Nov-09 10:19", "broken_version": "", "priority": "4", "subsystem": "Daemons", "assigned_to": "matyas", "derived_from": "", "creator": "matt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu", "due_date": ""}