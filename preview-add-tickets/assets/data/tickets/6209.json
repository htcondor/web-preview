{"id": 6209, "title": "Ticket #6209: Job router retains stale copy of x509UserProxyExpiration", "description": "<blockquote>\nFermilab and Wisconsin are seeing an issue with jobs getting held due to an expired proxy even though the proxy does not appear to be expired when querying the schedd or the proxy directly (<a class=\"external\" href=\"https://ticket.grid.iu.edu/33110\">https://ticket.grid.iu.edu/33110</a>). It turns out that the copy of the job's <code>x509UserProxyExpiration</code> in the job router is not being updated and since the job router owns the job, it evaluates the <code>SYSTEM_PERIOD_HOLD</code>, and puts the job on hold.</blockquote>", "remarks": "<blockquote>\n<em>2017-Apr-05 15:46:41 by danb:</em> <br/>\n\nA workaround is to restart (i.e. kill) condor_job_router once per day.\n\n<p></p><hr/>\n<em>2017-Apr-14 10:30:58 by jfrey:</em> <br/>\n\nWe can use the same fix as we do for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TimerRemove\" title=\"Timer Remove\">TimerRemove</a></span> in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5470\" onclick=\"get_ticket_and_populate_wrapper('5470'); return false;\" title=\"TimerRemove attribute broken\">#5470</a></span>. That is, have the job router copy the value of x509UserProxyExpiration from the mirror job log ad of the source job to the ad in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RoutedJob\" title=\"Routed Job\">RoutedJob</a></span> just before doing job policy evaluation.\n\n<p></p><hr/>\n<em>2017-Apr-14 11:16:12 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Looks good to me.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-14 10:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50479\">[50479]</a></span>: Docs for stale x509UserProxyExpiration in job router bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6209\" onclick=\"get_ticket_and_populate_wrapper('6209'); return false;\" title=\"Job router retains stale copy of x509UserProxyExpiration\">#6209</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-14 10:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50478\">[50478]</a></span>: Update x509UserProxyExpiration attribute in Job Router. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6209\" onclick=\"get_ticket_and_populate_wrapper('6209'); return false;\" title=\"Job router retains stale copy of x509UserProxyExpiration\">#6209</a></span> Propagate any changes to x509UserProxyExpiration from the source job ad in the schedd to the ad used for job policy evaluation (in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RoutedJob\" title=\"Routed Job\">RoutedJob</a></span> object). This attribute can change during the lifetime of the job and is sometimes used in job\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Apr-19 09:39", "status": "resolved", "created": "2017-Mar-31 11:00", "fixed_version": "2017-Mar-31 11:00", "broken_version": "v080600", "priority": "2", "subsystem": "DaemonsCM", "assigned_to": "jfrey", "derived_from": "#5985", "creator": "blin", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "blin@cs.wisc.edu timm@fnal.gov dan@hep.wisc.edu", "due_date": ""}