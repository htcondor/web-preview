{"id": 5271, "title": "Ticket #5271: condor_q should show only current owner's jobs by default", "description": "<blockquote>\nBy default, condor_q should show only jobs owned by the current user (unless the user is a queue super-user).\n\n<p>If one or more user argument is specifed for condor_q, then only those owners' jobs will be shown. If no user argument is specifed, then a special value will be passed in the query ad for new schedds that means \"add Owner==Me to the constraint\".  For older schedds Owner==&lt;user&gt; will be explicitly added to the constraint, with condor_q attempting to determine what value to use for &lt;user&gt;\n\n</p><p>Thus the condor_q results may be somewhat different when talking to older schedds. There are actually 3 cases.\n\n</p><p></p><ol>\n<li>When talking to an 8.5.1 or later schedd, the V3 query protocol is used and it's the schedd who figures out what the value of &lt;user&gt; is.\n</li><li>When Talking to an schedd that supports the V3 protocol but is older than 8.5.1, condor_q figures out what &lt;user&gt; is and adds an explicit constraint to the query.\n</li><li>When talking to schedd that do not support the V3 protocol, condor_q adds an explicit constraint and figures out what &lt;user&gt; is.</li></ol>\n</blockquote>", "remarks": "<blockquote>\nthe new -all-users arg should be documented, and somehow this new default behavior needs to be mentioned in the manual.\n\n<p>as of <em>2016-Jan-28 12:34:59</em> this works only when using the V3 protocol and an 8.5.2 or later schedd.\n\n</p><p></p><hr/>\n<em>2016-Jan-28 12:34:59 by bbockelm:</em> <br/>\n\nIs there a way to prevent the schedd from showing the other user's jobs?  I.e., do not allow (newer) schedds to respond to -all-users unless it's a queue super user.\n\n<p></p><hr/>\n<em>2016-Jan-28 15:09:51 by johnkn:</em> <br/>\n\nat present there is no way to do that, and we can't reliably do it with current capabilities because we can't guarantee we can always identify what user is running condor_q.  If you make some assumptions about where users are allowed to run commands you can probably manage reliable authentication and with that we could make some small changes in the schedd to turn this behavior own whether the user requested it or not.\n\n<p></p><hr/>\n<em>2016-Jan-29 09:56:14 by bbockelm:</em> <br/>\n\nHi TJ,\n\n<p>The particular site I was thinking of indeed requires authentication for all read commands...\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2016-Feb-12 15:31:10 by wenger:</em> <br/>\n\nThis is now documented, so I'm going to resolve the ticket.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Feb-12 13:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47600\">[47600]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5271\" onclick=\"get_ticket_and_populate_wrapper('5271'); return false;\" title=\"condor_q should show only current owner's jobs by default\">#5271</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4976\" onclick=\"get_ticket_and_populate_wrapper('4976'); return false;\" title=\"Improvements to condor_q for 8.5 series\">#4976</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5490\" onclick=\"get_ticket_and_populate_wrapper('5490'); return false;\" title=\"add a -batch-name argument to condor_submit and condor_submit_dag\">#5490</a></span>: documented that condor_q now defaults to showing only the current user's jobs; documented condor_q -batch and -nobatch; fixed some places that still referenced -progress rather than -batch.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-28 15:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47514\">[47514]</a></span>: add -allusers and -progress to condor_q usage for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5271\" onclick=\"get_ticket_and_populate_wrapper('5271'); return false;\" title=\"condor_q should show only current owner's jobs by default\">#5271</a></span>. add version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=11\" onclick=\"get_ticket_and_populate_wrapper('11'); return false;\" title=\"condor_q -run -format produces broken output\">#11</a></span> (not a typo)  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-28 15:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47513\">[47513]</a></span>: add -all-users to condor_q usage, and add a paragraph at the bottom about new <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5271\" onclick=\"get_ticket_and_populate_wrapper('5271'); return false;\" title=\"condor_q should show only current owner's jobs by default\">#5271</a></span> policy that condor_q will only return jobs owned by the current user by default.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-28 09:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47502\">[47502]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5271\" onclick=\"get_ticket_and_populate_wrapper('5271'); return false;\" title=\"condor_q should show only current owner's jobs by default\">#5271</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4976\" onclick=\"get_ticket_and_populate_wrapper('4976'); return false;\" title=\"Improvements to condor_q for 8.5 series\">#4976</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5490\" onclick=\"get_ticket_and_populate_wrapper('5490'); return false;\" title=\"add a -batch-name argument to condor_submit and condor_submit_dag\">#5490</a></span>, <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=5429\" onclick=\"get_ticket_and_populate_wrapper('5429'); return false;\" title='\"Permission denied\" log messages with HTCondor CE'>#5429</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5459\" onclick=\"get_ticket_and_populate_wrapper('5459'); return false;\" title=\"condor_status should not truncate the name field if terminal is wide\">#5459</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-28 09:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47501\">[47501]</a></span>: add config knob CONDOR_Q_ONLY_MY_JOBS to allow <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5271\" onclick=\"get_ticket_and_populate_wrapper('5271'); return false;\" title=\"condor_q should show only current owner's jobs by default\">#5271</a></span>, to be disabled at condor_q or at the schedd. document knob in configuration manual.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-27 17:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47500\">[47500]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5271\" onclick=\"get_ticket_and_populate_wrapper('5271'); return false;\" title=\"condor_q should show only current owner's jobs by default\">#5271</a></span>, condor_q will request only the current users jobs when the schedd is 8.5.2 or later and the current user is not a queue superuser. In this commit, condor_q supplies the owner name, and the schedd does not verify it. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Feb-12 15:31", "status": "resolved", "created": "2015-Sep-22 15:05", "fixed_version": "2015-Sep-22 15:05", "broken_version": "", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "johnkn", "derived_from": "#4976", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}