{"id": 4654, "title": "Ticket #4654: Non-awful hold messages for VM Universe", "description": "<blockquote>\nThe <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=HoldReason\" title=\"Hold Reason\">HoldReason</a></span> for VM universe jobs which failed to launch is pretty terrible.  A rough draft of suggestions follows.  One possibility for implementation is to use the param table infrastructure to create an \"error table\" or \"hold reason table\" in which condor_q will look the short-form hold reasons to print out the long-form hold reasons below.  Similar code would be welcomed / required for the (user) job log.\n\n<p>(The instructions for VMGAHP_ERR_JOBCLASSAD_NO_VMWARE_VMX_PARAM are a little different than the others; it's not clear if it's better or not.)\n\n</p><p></p><div class=\"verbatim\">\n<pre>VMGAHP_ERR_JOBCLASSAD_NO_VM_MEMORY_PARAM\n\n    The attribute ${ATTR_JOB_VM_MEMORY} was not set in the job ad sent to the\nVM GAHP.  HTCondor will usually prevent you from submitting a VM universe job\nwithout ${ATTR_JOB_VM_MEMORY} set, so this may not be your fault.  Examine\nyour job (condor_q -l $(CLUSTER_ID).$(PROC_ID)) and verify that ${ATTR_JOB_VM_MEMORY}\nis set.  If it is, please contact your administrator.\n\nVMGAHP_ERR_JOBCLASSAD_NO_VMWARE_VMX_PARAM\n\n    The attribute ${VMPARAM_VMWARE_DIR} was not set in the job ad sent to the\nVM GAHP.  HTCondor will usually set this attribute when you submit a valid\nVMWare job (it is derived from vmware_dir).  If you used condor_submit to\nsubmit this job, contact your administrator.  Otherwise, examine your job\n(condor_q -l $(CLUSTER_ID).$(PROC_ID)) and verify that ${VMPARAM_VMWARE_DIR}\nis set.  If it is, contact your administrator.\n\nVMGAHP_ERR_JOBCLASSAD_KVM_NO_DISK_PARAM\n\n    The attribute ${VMPARAM_VM_DISK} was not set in the job ad sent to the\nVM GAHP.  HTCondor will usually prevent you from submitting a KVM job without\n${VMPARAM_VM_DISK} being set, so this may not be your fault.  Examine\nyour job (condor_q -l $(CLUSTER_ID).$(PROC_ID)) and verify that ${VMWARE_VM_DISK}\nis set.  If it is, please contact your administrator.\n\nVMGAHP_ERR_JOBCLASSAD_KVM_INVALID_DISK_PARAM\n\n    The attribute ${VMPARAM_VM_DISK} was invalid.  Please consult the manual,\nor the condor_submit man page, for information about the syntax of ${VMPARAM_VM_DISK}\nA syntactically correct value may be invalid if the on-disk permissions\nof a file specified in it do not match the requested permissions.  Presently,\nfiles not transferred to the root of the working directory must be specified\nwith full paths.\n\nVMGAHP_ERR_JOBCLASSAD_KVM_MISMATCHED_CHECKPOINT\n\n    KVM jobs can not presently checkpoint if any of their disk files are not\non a shared filesystem.  Files on a shared filesystem must be specified in\n${VMPARAM_VM_DISK} with full paths.\n\nVMGAHP_ERR_JOBCLASSAD_XEN_NO_KERNEL_PARAM\n\n    The attribute ${VMPARAM_XEN_KERNEL} was not set in the job ad sent to the\nVM GAHP.  HTCondor will usually prevent you from submitting a Xen job without\n${VMPARAM_XEN_KERNEL} being set, so this may not be your fault.  Examine\nyour job (condor_q -l $(CLUSTER_ID).$(PROC_ID)) and verify that ${VMPARAM_XEN_KERNEL}\nis set.  If it is, please contact your administrator.\n\nVMGAHP_ERR_JOBCLASSAD_MISMATCHED_HARDWARE_VT\n\n    Don't use 'vmx' as the name of your kernel image.  Pick something else and\nchange ${VMPARAM_XEN_KERNEL} to match.\n\nVMGAHP_ERR_JOBCLASSAD_XEN_KERNEL_NOT_FOUND\n\n    HTCondor could not read from the file specified by ${VMPARAM_XEN_KERNEL}.\nCheck the path and the file's permissions.  If it's on a shared filesystem,\nyou may need to alter your job's requirements expression to ensure the\nfilesystem's availability.\n\nVMGAHP_ERR_JOBCLASSAD_XEN_INITRD_NOT_FOUND\n\n    HTCondor could not read from the file specified by ${VMPARAM_XEN_INITRD}.\nCheck the path and the file's permissions.  If it's on a shared filesystem,\nyou may need to alter your job's requirements expression to ensure the\nfilesystem's availability.\n\nVMGAHP_ERR_JOBCLASSAD_XEN_NO_ROOT_DEVICE_PARAM\n\n    The attribute ${VMPARAM_XEN_ROOT} was not set in the job ad sent to the\nVM GAHP.  HTCondor will usually prevent you from submitting a Xen job without\n${VMPARAM_XEN_ROOT} being set, so this may not be your fault.  Examine\nyour job (condor_q -l $(CLUSTER_ID).$(PROC_ID)) and verify that ${VMWARE_XEN_ROOT}\nis set.  If it is, please contact your administrator.\n\nVMGAHP_ERR_JOBCLASSAD_XEN_NO_DISK_PARAM\n\n    The attribute ${VMPARAM_VM_DISK} was not set in the job ad sent to the\nVM GAHP.  HTCondor will usually prevent you from submitting a Xen job without\n${VMPARAM_VM_DISK} being set, so this may not be your fault.  Examine\nyour job (condor_q -l $(CLUSTER_ID).$(PROC_ID)) and verify that ${VMWARE_VM_DISK}\nis set.  If it is, please contact your administrator.\n\nVMGAHP_ERR_JOBCLASSAD_XEN_INVALID_DISK_PARAM\n\n    The attribute ${VMPARAM_VM_DISK} was invalid.  Please consult the manual,\nor the condor_submit man page, for information about the syntax of ${VMPARAM_VM_DISK}\nA syntaxically-correct value may be also be invalid if the on-disk permissions\nof a file specified in it do not match the requested permissions.  Presently,\nfiles not transferred to the root of the working directory must be specified\nwith full paths.\n\nVMGAHP_ERR_JOBCLASSAD_XEN_MISMATCHED_CHECKPOINT\n\n    Xen jobs can not presently checkpoint if any of their disk files are not\non a shared filesystem.  Files on a shared filesystem must be specified in\n${VMPARAM_VM_DISK} with full paths.\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2015-Jan-06 12:14:14 by bbockelm:</em> <br/>\n\nHold up on this one -- I'm not entirely sure about the approach here.\n\n<p>If I understand right the approach here is, condor_q itself does some simple string matching on hold reason and substitutes strings from a lookup table.\n\n</p><p>I worry about this because:\n</p><ul>\n<li>This means that different condor CLI versions would have different outputs for \"condor_q -held\"\n</li><li>Different clients (HTCondor-C, python bindings) would get different versions of the hold message.\n</li><li>\"condor_q -af:h ClusterID <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=HoldReason\" title=\"Hold Reason\">HoldReason</a></span>\" would have different hold reasons than \"condor_q -held\"\n</li><li>I worry about using string mangling for the substitution (seems brittle) instead of hold sub-codes.\n</li></ul>\n\n<p>You start to get inconsistencies between CLI output and the contents of the classad, which results in things like <span class=\"ticket\"><a class=\"new\" href=\"tktview?tn=4808\" title=\"Add bogus 'LongHoldReason' attribute to condor_q -l?\">#4808</a></span> which look like a scary maintenance nightmare to me.\n\n</p><p>As string constants are collapsed into a single object by <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>, the memory savings of having shorter strings in the schedd are going to be miniscule.  On first blush, this approach seems to be problematic versus having the startd set a more reasonable hold reason in the first place.\n\n</p><p>Is there a design doc here?  Who did the code review?  I think this warrants further attention, or at least recording previous discussions onto the ticket...\n\n</p><p></p><hr/>\n<em>2015-Jan-06 14:02:35 by tlmiller:</em> <br/>\n\n(Made verbatim to make the quotes readable on the web.)\n<div class=\"verbatim\">\n<pre>&gt; This means that different condor CLI versions would have different outputs\n&gt; for \"condor_q -held\"\n\nWhy is that a problem?  I don't think we make any promises about output\nstability.  What would be better?  A new flag to condor_q that nobody knows\nabout?  Printing the explanations beneath the output?\n\n&gt; Different clients (HTCondor-C, python bindings) would get different versions\n&gt; of the hold message.\n\nThe hold message is the one in the job ad; everybody /except/ condor_q -hold\nsees the same message.\n\n&gt; \"condor_q -af:h ClusterID HoldReason\" would have different hold reasons than\n&gt; \"condor_q -held\"\n\nThis is entirely deliberate; I'm assuming that 'condor_q -hold' is used\nprimarily by users (rather than scripts).\n\n&gt; I worry about using string mangling for the substitution (seems brittle)\n&gt; instead of hold sub-codes.\n\nThis is true.  I suppose hold reason codes and sub-codes are cheap enough to\nadd to the projection.\n\n&gt; You start to get inconsistencies between CLI output and the contents of the\n&gt; classad, which results in things like #4808 which look like a scary\n&gt; maintenance nightmare to me.\n\nAgain, this is entirely deliberate -- we want to give the user more information.\n\n&gt; As string constants are collapsed into a single object by ClassAds, the\n&gt; memory savings of having shorter strings in the schedd are going to be\n&gt; miniscule. On first blush, this approach seems to be problematic versus\n&gt; having the startd set a more reasonable hold reason in the first place.\n\nMy original plan was, indeed, to just set a longer hold reason.  That got shot\ndown by ToddT and TJ; I'm not sure why.  (Perhaps because the strings aren't\ncompressed over the wire?)\n\n&gt; Is there a design doc here?\n\nNo.\n\n&gt; Who did the code review?\n\nFor a feature commit to the devel branch?\n\n&gt; I think this warrants further attention, or at least recording previous\n&gt; discussions onto the ticket...\n\nFair enough.\n</pre></div>\n\n\n<p></p><hr/>\n<em>2015-Apr-22 15:23:40 by bbockelm:</em> <br/>\n\nFrom the OSG/HTCondor call:\n\n<p>Is it possible to (cheaply) revise this patch to change the hold message on the server side (Brian has strongest preference to not do this in <code>condor_q</code>)?  Preference would be to get it done in the 8.3 series.\n\n</p><p></p><hr/>\n<em>2015-Apr-22 16:12:36 by cat:</em> <br/>\n\nTodd Miller claims that Todd Tannenbaum objected to long messages going over the wire, hence the client-side solution (which in turn may have its own issues). I propose that either (a) ToddM, ToddT, and BrianB meet to hash out an acceptable solution, or if need be (b) the messages be made short on the server side and <strong>clearly</strong> point users to a look-up table in the documentation.\n\n<p></p><hr/>\n<em>2015-May-06 15:17:39 by bbockelm:</em> <br/>\n\nUpdate: this got priority bumped; likely won't make 8.3.6.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"tktview?tn=4808\" title=\"Add bogus 'LongHoldReason' attribute to condor_q -l?\">#4808</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd bogus 'LongHoldReason' attribute to condor_q -l?</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-16 12:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=42265\">[42265]</a></span>: Revert \"(<span class=\"ticket\"><a class=\"active\" href=\"tktview?tn=4654\" title=\"Non-awful hold messages for VM Universe\">#4654</a></span>) condor_q -hold and the user log now print less-awful hold messages for the VM universe.\" This reverts commit 4a94ad3c078abe8d07b6be512ecf6fcc3198e70b.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-05 15:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=42109\">[42109]</a></span>: (<span class=\"ticket\"><a class=\"active\" href=\"tktview?tn=4654\" title=\"Non-awful hold messages for VM Universe\">#4654</a></span>) condor_q -hold and the user log now print less-awful hold messages for the VM universe.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-May-06 15:17", "status": "active", "created": "2014-Oct-13 15:25", "fixed_version": "2014-Oct-13 15:25", "broken_version": "v080302", "priority": "4", "subsystem": "VM", "assigned_to": "bbockelm", "derived_from": "#4882", "creator": "tlmiller", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "cat@cs.wisc.edu, tlmiller@cs.wisc.edu, blin@cs.wisc.edu, johnkn@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}