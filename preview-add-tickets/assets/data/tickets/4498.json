{"id": 4498, "title": "Ticket #4498: Add preliminary Docker support to the starter", "description": "<blockquote>\nThis is the first iteration of Docker support for Condor.  The goal of this ticket is to provide enough detail for one week's worth of effort to have the absolute minimal useable example of Docker containers running in HTCondor.  This iteration\n\n<p></p><ul>\n<li>Has no image management support.  Assume that the image is somehow already prestaged the execute machine\n</li><li>Requires a custom attribute in the job ad to describe the name of the image and that it should be run in a container.\n</li><li>Assumes that the docker service is installed and running on the target execute machine.\n\n<p></p></li><li>Will not use a GAHP style implementation, but just use the docker CLI\n</li><li>Will start a job in a docker container, translation request_memory and request_cpus to the appropriate docker run options\n</li><li>Will support condor_rm\n</li><li>Will mount the execute directory as a volume, so file xfer works</li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-27 14:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44894\">[44894]</a></span>: Add support to suspend and continue docker jobs <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4498\" onclick=\"get_ticket_and_populate_wrapper('4498'); return false;\" title=\"Add preliminary Docker support to the starter\">#4498</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-13 20:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44855\">[44855]</a></span>: When docker job goes on hold, be sure to remove the container <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4498\" onclick=\"get_ticket_and_populate_wrapper('4498'); return false;\" title=\"Add preliminary Docker support to the starter\">#4498</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-13 20:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44854\">[44854]</a></span>: When docker job goes on hold, be sure to remove the container <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4498\" onclick=\"get_ticket_and_populate_wrapper('4498'); return false;\" title=\"Add preliminary Docker support to the starter\">#4498</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-13 16:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44852\">[44852]</a></span>: Allow docker jobs to run without a Cmd specified <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4498\" onclick=\"get_ticket_and_populate_wrapper('4498'); return false;\" title=\"Add preliminary Docker support to the starter\">#4498</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-13 09:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44844\">[44844]</a></span>: Put docker job on hold if executable not found <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4498\" onclick=\"get_ticket_and_populate_wrapper('4498'); return false;\" title=\"Add preliminary Docker support to the starter\">#4498</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-14 15:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44609\">[44609]</a></span>: Docker need to remove the container metadata on exit <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4498\" onclick=\"get_ticket_and_populate_wrapper('4498'); return false;\" title=\"Add preliminary Docker support to the starter\">#4498</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-12 17:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=43350\">[43350]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4498\" onclick=\"get_ticket_and_populate_wrapper('4498'); return false;\" title=\"Add preliminary Docker support to the starter\">#4498</a></span>) The starter now polls for a container id after the docker job is started and tries to register the docker cgroup for that container id with the PROCD for process tracking. This currently fails because the procd won't track processes that aren't children of condor.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-05 16:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=43269\">[43269]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4498\" onclick=\"get_ticket_and_populate_wrapper('4498'); return false;\" title=\"Add preliminary Docker support to the starter\">#4498</a></span>) The startd can now clean up Docker containers for the starter or after a crash. Also, for great bind mount justice, run the job as the starter's current user, rather than the Docker default.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-04 13:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=43242\">[43242]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4498\" onclick=\"get_ticket_and_populate_wrapper('4498'); return false;\" title=\"Add preliminary Docker support to the starter\">#4498</a></span>) Add support for resource limits.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-03 11:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=43217\">[43217]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4498\" onclick=\"get_ticket_and_populate_wrapper('4498'); return false;\" title=\"Add preliminary Docker support to the starter\">#4498</a></span>) Merge version and detect, since one had to call the other to avoid hanging on system's with OpenBox's docker installed. Implement kill and call everywhere we're supposed to; this makes condor_hold and condor_rm much more effective.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-20 16:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=42294\">[42294]</a></span>: have starter recognise sudo prefix on DOCKER command and 'do the right thing' <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4498\" onclick=\"get_ticket_and_populate_wrapper('4498'); return false;\" title=\"Add preliminary Docker support to the starter\">#4498</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-20 14:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=42290\">[42290]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4498\" onclick=\"get_ticket_and_populate_wrapper('4498'); return false;\" title=\"Add preliminary Docker support to the starter\">#4498</a></span>) Handle transferred executables.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-20 11:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=42288\">[42288]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4498\" onclick=\"get_ticket_and_populate_wrapper('4498'); return false;\" title=\"Add preliminary Docker support to the starter\">#4498</a></span>) Run Docker in attached mode after forking.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Jun-14 19:59", "status": "resolved", "created": "2014-Jul-29 16:39", "fixed_version": "2014-Jul-29 16:39", "broken_version": "v080000", "priority": "4", "subsystem": "", "assigned_to": "gthain", "derived_from": "#4497", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}