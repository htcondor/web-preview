{"id": 5115, "title": "Ticket #5115: Windows drops events when event log locking is disabled.", "description": "<blockquote>\nWhen <code>EVENT_LOG_LOCKING</code> or <code>ENABLE_USERLOG_LOCKING</code> are not set on Windows, the relevant event log can end up with truncated or missing events if there are multiple writers.  This happens despite the fact that the files are open for append only.\n\n<p>The problem is that the c-runtime on Windows, does not pass the 'append only' flag down into the underlying Windows API call that opens the file, instead the c-runtime is simulating append-only behavior by seeking inside the implementation of <code>write()</code>. (The VS11 runtime was examined to determine this).\n\n</p><p>The fix is to call the underlying Windows open API with the correct arguments for append mode directly, and then shove the resulting handle into the c-runtime's handle table.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-17 11:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=45336\">[45336]</a></span>: edit 8.3.7 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5115\" onclick=\"get_ticket_and_populate_wrapper('5115'); return false;\" title=\"Windows drops events when event log locking is disabled.\">#5115</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-16 11:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=45320\">[45320]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5115\" onclick=\"get_ticket_and_populate_wrapper('5115'); return false;\" title=\"Windows drops events when event log locking is disabled.\">#5115</a></span>. support opening eventlog in append mode on Windows.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-24 11:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=45141\">[45141]</a></span>: Fix Windows event log writer to work properly when locking is disabled. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5115\" onclick=\"get_ticket_and_populate_wrapper('5115'); return false;\" title=\"Windows drops events when event log locking is disabled.\">#5115</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Dec-21 17:12", "status": "resolved", "created": "2015-Jun-23 13:13", "fixed_version": "2015-Jun-23 13:13", "broken_version": "v080306", "priority": "3", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "#4908", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}