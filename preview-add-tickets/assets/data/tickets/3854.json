{"id": 3854, "title": "Ticket #3854: Failure to detect OpSys versions", "description": "<blockquote>\nHTCondor attempts to automatically detect the Linux distribution and version so that it can correctly set a bunch of machine ad attributes.\n\n<p>Unfortunately, it does so in an unreliable manner. Specifically, it parses the file <code>/etc/issue</code>. We should do better, as often times sysadmin will customize the contents of <code>/etc/issue</code> or delete it entirely, as this file is displayed before the login prompt.  Currently half the systems we use on the Open Science Grid have removed or customized /etc/issue.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Aug-14 14:58:14 by tannenba:</em> <br/>\n\nOn <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RedHat\" title=\"Red Hat\">RedHat</a></span> and Centos systems, it would be more reliable to look in <code>/etc/redhat-release</code> and then fall back to <code>/etc/issue</code>.\n\n<p>On Debian, look in <code>/etc/debian_version</code> for a number like <code>6.0.7</code> or <code>7.1</code>, although on older Ubuntu systems this file contains a string of the release code name instead of a number.\n\n</p><p>The ultimate is to run <code>lsb_release -d</code>.  If the system is LSB compliant, this gives exactly what we want.  Seems like everything RHEL 5.6 and newer has this. Downside is RHEL 5.0 does not.  Also a downside is the need to fork and exec a shell script everytime <code>condor_config()</code> is invoked; this seems really expensive. Perhaps the <code>condor_master</code> should run <code>lsb_release -d</code> and store the result in a file in <code>$(LOG)</code>; everything else would look for this file before anything else.\n\n</p><p></p><hr/>\n<em>2013-Aug-14 15:04:39 by tim:</em> <br/>\n\nDebian also has an /etc/issue.net\nHere is a sample:\nDebian GNU/Linux 7\n\n<p></p><hr/>\n<em>2013-Aug-14 16:16:34 by tannenba:</em> <br/>\n\nIf <code>/etc/issue</code> has been removed or mangled, it is likely that <code>/etc/issue.net</code> has been mangled as well. Only difference is the first is displayed before local logins, the latter before remote logins. But hey, maybe worth trying.\n\n<p></p><hr/>\n<em>2013-Aug-15 10:17:08 by johnkn:</em> <br/>\n\n<strong>CODE REVIEW</strong>: code looks like a correct, minimal patch.\n\n<p></p><hr/>\n<em>2013-Aug-16 11:29:43 by johnkn:</em> <br/>\n\ncoverity reports memory leak at line 645\n\n<p></p><hr/>\n<em>2013-Aug-16 12:01:13 by tannenba:</em> <br/>\n\n....and memory leak fixed in <span class=\"chng\"><a href=\"chngview?cn=37249\">[37249]</a></span>.  Yay coverity! No need to version history this, as this code was never released.\n\n<p></p><hr/>\n<em>2013-Aug-30 10:37:35 by tim:</em> <br/>\n\nTodd's remark from August 14th implies that older Ubuntu System have text instead of a number in <code>/etc/debian_version</code>. However, in current Ubuntu systems (12.04 and 13.04) have text: <code>wheezy/sid</code></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"active\" href=\"tktview?tn=3886\" title=\"Improved Opsys detection for Debian\">#3886</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nImproved Opsys detection for Debian</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-19 10:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37269\">[37269]</a></span>: 8.0.2 version history item edit ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3854\" title=\"Failure to detect OpSys versions\">#3854</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-16 11:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37249\">[37249]</a></span>: Fix small memory leak detected by coverity before release. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3854\" title=\"Failure to detect OpSys versions\">#3854</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-15 12:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37236\">[37236]</a></span>: fix fedora warning in arch.cpp <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3854\" title=\"Failure to detect OpSys versions\">#3854</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-14 18:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37232\">[37232]</a></span>: Make code to detect Linux distro info more robust. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3854\" title=\"Failure to detect OpSys versions\">#3854</a></span> Previously we just inspected the /etc/issue file. Now we will also look into /etc/redhat-release and/or /etc/issue.net to see if we can find what we need.  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Aug-30 10:37", "status": "resolved", "created": "2013-Aug-14 14:56", "fixed_version": "2013-Aug-14 14:56", "broken_version": "v070808", "priority": "2", "subsystem": "DaemonsExecNode", "assigned_to": "tannenba", "derived_from": "", "creator": "tannenba", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "tim@cs.wisc.edu, johnkn@cs.wisc.edu, lmichael@wisc.edu", "due_date": ""}