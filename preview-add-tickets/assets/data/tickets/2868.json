{"id": 2868, "title": "Ticket #2868: Win Profile not unloaded when a jobs is condor_rm'd", "description": "<blockquote>\nWhen using <code>load_profile</code> = <code>true</code> on Condor 7.6.6, If a job is removed with condor_rm, a warning appears in the Windows Application Log:\n\n<p>\"Unable to uload profile condor-reuse-slot1_1\"\n\n</p><p>and the profile directory <code>C:\\Documents and Settings\\condor-reuse-slot1_1</code> is never deleted.  This causes problems for subsequent jobs run on this slot.\n\n</p><p>The specific problem reported in the Rust support queue appears to reference a dynamic slot. it is not known at this time if the problem also applies to static slots.\n\n</p><p>Original text of the rust ticket follows\n\n</p><p></p><div class=\"verbatim\">\n<pre>We are testing the use of an application, Ansys Workbench with Condor.\nThe Central Manager/Submit node is a Linux (Centos 5.7 64bit) machine. The\nexecution nodes uses Windows XP 64 bit.\nThe Condor version is 7.6.6.\n\nIn order to be able to use this application, the user profile has to be\nloaded so the setting below has to be added in the submit description\nfile.\n-\nLoad_profile = True\n-\n\nWhen this setting is specified, the calculation terminates succesfully.\n\nHowever if the calculation is interrupted by executing condor_rm on the\nsubmit node, a warning \"Unable to unload profile condor-reuse-slot1_1\"\nappears in the Application section of the Event Viewer of Windows. Also\nthe profile directory \"C:\\Documents and Settings\\condor-reuse-slot1_1\"\nremains. (In the case the job terminates normally this directory is\ndeleted by Condor)\n\nThis affects the next job being executed on the node. Ansys Workbench\nfails to execute it if \"C:\\Documents and Settings\\condor-reuse-slot1_1\"was\nnot deleted.\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Mar-16 14:22:40 by johnkn:</em> <br/>\n\nSubsequent email exchanges via rust indicate that the problem does reproduce with static slots as well as dynamic slots.  And that the problem does appear to be caused by a process that is not killed by condor when the job is RM'd.\n\n<p>There is a Ansys WB license client process that is not a child of the starter.  We currently suspect that this process has ACL's that prevent the starter from terminating it, the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ProcLog\" title=\"Proc Log\">ProcLog</a></span> shows\n\n</p><p></p><div class=\"verbatim\">\n<pre>03/16/12 15:29:02 : sending signal 9 to family with root 148\n03/16/12 15:29:02 : windows_hard_kill: TerminateProcess error: 5\n03/16/12 15:29:02 : send_signal error; pid = 148, sig = 9\n03/16/12 15:29:02 : PROC_FAMILY_GET_USAGE\n03/16/12 15:29:02 : gathering usage data for family with root pid 148\n03/16/12 15:29:03 : PROC_FAMILY_KILL_FAMILY\n03/16/12 15:29:03 : taking a snapshot...\n03/16/12 15:29:03 : process 1696 (of family 148) has exited\n03/16/12 15:29:03 : process 2860 (of family 148) has exited\n03/16/12 15:29:03 : process 1484 (of family 148) has exited\n03/16/12 15:29:03 : process 148 (of family 148) has exited\n03/16/12 15:29:03 : ...snapshot complete\n03/16/12 15:29:03 : sending signal 9 to family with root 1964\n03/16/12 15:29:03 : windows_hard_kill: TerminateProcess error: 5\n03/16/12 15:29:03 : send_signal error; pid = 1964, sig = 9\n03/16/12 15:29:03 : PROC_FAMILY_UNREGISTER_FAMILY\n03/16/12 15:29:03 : unregistering family with root pid 1964\n03/16/12 15:29:17 : taking a snapshot...\n03/16/12 15:29:17 : process 1964 (of family 272) has exited\n03/16/12 15:29:17 : watcher 1964 of family with root 148 has died; family removed\n03/16/12 15:29:17 : ...snapshot complete\n</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "defect", "last_change": "2012-Mar-16 14:22", "status": "new", "created": "2012-Mar-06 17:53", "fixed_version": "2012-Mar-06 17:53", "broken_version": "v070605", "priority": "3", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "s8141", "customer_group": "support", "visibility": "public", "notify": "", "due_date": ""}