{"id": 6216, "title": "Ticket #6216: Spot Fleet -type annexes fail to join pool.", "description": "<blockquote>\nThere's a race condition between the Spot Fleet Request tagging the instance with its ID and the instance's <code>49ec2-instance.sh</code> looking for that tag.  (The script assumes the instance was on-demand if it doesn't find it, and then fails to check if the annex ID derived from its client token makes any sense.)  The script should instead check for see if it's an on-demand instance, and if not, wait until the tagging happens (or the hour is up).\n\n<p>Changes to <code>49ec2-instance.sh</code> imply a new default AMI.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Apr-05 18:25:05 by tlmiller:</em> <br/>\n\nThese changes should be safe to cherry-pick to 8.7.1.\n\n<p></p><hr/>\n<em>2017-Apr-06 11:19:34 by tlmiller:</em> <br/>\n\nCherry-picking approved by TJ and done.  Updated fixed version.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-06 10:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50429\">[50429]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6216\" onclick=\"get_ticket_and_populate_wrapper('6216'); return false;\" title=\"Spot Fleet -type annexes fail to join pool.\">#6216</a></span>) Update the default AMI.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-06 10:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50428\">[50428]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6216\" onclick=\"get_ticket_and_populate_wrapper('6216'); return false;\" title=\"Spot Fleet -type annexes fail to join pool.\">#6216</a></span>) Fix race condition in 49ec2-instance.sh and bug in instance profile script when dealing with spot fleet requests.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-06 10:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50427\">[50427]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6216\" onclick=\"get_ticket_and_populate_wrapper('6216'); return false;\" title=\"Spot Fleet -type annexes fail to join pool.\">#6216</a></span>) Update example copy of 49ec2-instance.sh to match example AMI.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-05 18:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50423\">[50423]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6216\" onclick=\"get_ticket_and_populate_wrapper('6216'); return false;\" title=\"Spot Fleet -type annexes fail to join pool.\">#6216</a></span>) Update the default AMI.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-05 18:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50420\">[50420]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6216\" onclick=\"get_ticket_and_populate_wrapper('6216'); return false;\" title=\"Spot Fleet -type annexes fail to join pool.\">#6216</a></span>) Fix race condition in 49ec2-instance.sh and bug in instance profile script when dealing with spot fleet requests.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-05 18:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50419\">[50419]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6216\" onclick=\"get_ticket_and_populate_wrapper('6216'); return false;\" title=\"Spot Fleet -type annexes fail to join pool.\">#6216</a></span>) Update example copy of 49ec2-instance.sh to match example AMI.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Apr-06 11:19", "status": "resolved", "created": "2017-Apr-05 18:24", "fixed_version": "2017-Apr-05 18:24", "broken_version": "v080701", "priority": "2", "subsystem": "Annex", "assigned_to": "tlmiller", "derived_from": "#6111", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}