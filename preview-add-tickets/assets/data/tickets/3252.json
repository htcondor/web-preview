{"id": 3252, "title": "Ticket #3252: Clean redundant execl code in DC_Exit", "description": "<blockquote>\nDC_Exit in <a class=\"file\" href=\"rlog?f=src/condor_daemon_core.V6/daemon_core_main.cpp\">/src/condor_daemon_core.V6/daemon_core_main.cpp</a> around line 310 has the following code, which is almost identical.  It should be simplified to remove redundancy.\n\n<p></p><div class=\"code\">\n<pre class=\"code\">#     if (HAVE_EXECL)\n\t\tdprintf( D_ALWAYS, \"**** %s (%s_%s) pid %lu EXITING BY EXECING %s\\n\",\n\t\t\t\t myName, myDistro-&gt;Get(), get_mySubSystem()-&gt;getName(), pid,\n\t\t\t\t shutdown_program );\n\t\tpriv_state p = set_root_priv( );\n\t\tint exec_status = execl( shutdown_program, shutdown_program, NULL );\n\t\tset_priv( p );\n\t\tdprintf( D_ALWAYS, \"**** execl() FAILED %d %d %s\\n\",\n\t\t\t\t exec_status, errno, strerror(errno) );\n#     elif defined(WIN32)\n\t\tdprintf( D_ALWAYS,\n\t\t\t\t \"**** %s (%s_%s) pid %lu EXECING SHUTDOWN PROGRAM %s\\n\",\n\t\t\t\t myName, myDistro-&gt;Get(), get_mySubSystem()-&gt;getName(), pid,\n\t\t\t\t shutdown_program );\n\t\tpriv_state p = set_root_priv( );\n\t\tint exec_status = execl( shutdown_program, shutdown_program, NULL );\n\t\tset_priv( p );\n\t\tif ( exec_status ) {\n\t\t\tdprintf( D_ALWAYS, \"**** _execl() FAILED %d %d %s\\n\",\n\t\t\t\t\t exec_status, errno, strerror(errno) );\n\t\t}\n#     else\n</pre></div>\n\n\n<p>Proposed, utterly untested, fix:\n</p><div class=\"code\">\n<pre class=\"code\">#     if (HAVE_EXECL) || defined(WIN32)\n\t\tdprintf( D_ALWAYS, \"**** %s (%s_%s) pid %lu EXITING BY EXECING %s\\n\",\n\t\t\t\t myName, myDistro-&gt;Get(), get_mySubSystem()-&gt;getName(), pid,\n\t\t\t\t shutdown_program );\n\t\tpriv_state p = set_root_priv( );\n\t\tint exec_status = execl( shutdown_program, shutdown_program, NULL );\n\t\tset_priv( p );\n\t\tdprintf( D_ALWAYS, \"**** execl() FAILED %d %d %s\\n\",\n\t\t\t\t exec_status, errno, strerror(errno) );\n#     else\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "enhance", "last_change": "2012-Oct-03 17:54", "status": "new", "created": "2012-Oct-03 17:54", "fixed_version": "2012-Oct-03 17:54", "broken_version": "v070805", "priority": "4", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}