{"id": 3388, "title": "Ticket #3388: GridJobStatus not updated by SIRs.", "description": "<blockquote>\nAlthough the job is idle, HTCondor <em>is</em> checking the status of the Spot Instance Request.  We should be copying it into the job ad when we do.\n\n<p>In particular, if we report the status-code field in addition to the status field, our users will be better-able to tune their bidding stategy (e.g., from seeing states like 'price-too-low').  This will probably require updating the API date field in the EC2 GAHP.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Jan-02 16:41:27 by tlmiller:</em> <br/>\n\nBecause the set of status values for spot and dedicated instances are (currently) disjoint, it will be unambiguous to combine the two into the job ad attribute <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GridJobStatus\" title=\"Grid Job Status\">GridJobStatus</a></span>, and I have a patch ready to so do.  Jaime and I feel that the simplicity and consistency of this approach recommend it over adding a new job ad attribute especially for spot instance request statuses.\n\n<p>The 'status-code' values are also disjoint, and provide more detail than the 'status'.  In particular, \"instance-terminated-by-price\", \"price-too-low\", and \"capacity-not-available\" look potentially valuable for tuning bids.  Given that we don't currently report the SIR 'status', I'd be OK with skipping it entirely, and just sing the 'status-code'.\n\n</p><p>However, it looks like obtaining 'status-code's will require using a new(er) API version.  In practice, I think this will have minimal effect on using the EC2 GAHP with Amazon (which, of course, supports the new API version); but it's unclear what effect (if any) it will have on other services or software, like <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=OpenStack\" title=\"Open Stack\">OpenStack</a></span>.  Creating a binary which specifies the newer version (for testing) won't be time-consuming, but the testing could be.\n\n</p><p>So, Tony: just how interested are you in the bidding information? :)\n\n</p><p></p><hr/>\n<em>2013-Jan-11 17:11:04 by tiradani:</em> <br/>\n\nI am very interested in the bidding information as long as it doesn't break compatibility with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=OpenStack\" title=\"Open Stack\">OpenStack</a></span> or Eucalyptus.  Eucalyptus has recently renewed their focus on being API compatible with EC2, so that <strong>may</strong> not be as big of a worry.\n\n<p>Then again, according to <a class=\"external\" href=\"http://www.stackgeek.com/blog/kordless/post/comparison-of-open-source-cloud-support-for-ec2\">http://www.stackgeek.com/blog/kordless/post/comparison-of-open-source-cloud-support-for-ec2</a>, Spot Instances aren't supported on <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=OpenStack\" title=\"Open Stack\">OpenStack</a></span> or Eucalyptus, so the issue may be moot.\n\n</p><p>Additionally, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=OpenStack\" title=\"Open Stack\">OpenStack</a></span> Folsom supports the API version up to 2009-04-04.\n<a class=\"external\" href=\"http://docs.openstack.org/folsom/openstack-compute/admin/content/metadata-service.html\">http://docs.openstack.org/folsom/openstack-compute/admin/content/metadata-service.html</a>\n\n</p><p>What version is needed to get the 'status-code'?\n\n</p><p></p><hr/>\n<em>2013-Jan-15 15:52:09 by tlmiller:</em> <br/>\n\nThe second-to-most-recent, 2012-10-01.  I'll look into what we can do as far as falling back gracefully.\n\n<p></p><hr/>\n<em>2013-Feb-13 13:36:48 by tlmiller:</em> <br/>\n\nI've asked Tony (thanks, Tony!) to make sure that the committed code works for him.  I'll ask for a code review later, after we're sure we like the functionality.\n<hr/>\n<em>2013-Apr-22 11:40:52 by johnkn:</em> <br/>\n\nBulk change of target version from v070905 to v070906 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2014-Jul-28 13:09:51 by bbockelm:</em> <br/>\n\nTodd - this ticket is a year old, can we close out?\n\n<p></p><hr/>\n<em>2014-Jul-28 13:13:26 by tlmiller:</em> <br/>\n\nIf Tony hasn't complained by now, I'm OK with assuming he won't.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-19 11:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35204\">[35204]</a></span>: add 7.9.5 version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3388\" onclick=\"get_ticket_and_populate_wrapper('3388'); return false;\" title=\"GridJobStatus not updated by SIRs.\">#3388</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Feb-12 11:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=34908\">[34908]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3388\" onclick=\"get_ticket_and_populate_wrapper('3388'); return false;\" title=\"GridJobStatus not updated by SIRs.\">#3388</a></span>) Request and use the 'status code' (bidding) information on EC2.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Jul-28 13:13", "status": "resolved", "created": "2012-Dec-18 15:17", "fixed_version": "2012-Dec-18 15:17", "broken_version": "v070902", "priority": "3", "subsystem": "Grid", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "tiradani@fnal.gov", "due_date": ""}