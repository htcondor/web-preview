{"id": 3651, "title": "Ticket #3651: condor is recording duplicate hold events in userlog", "description": "<blockquote>\nSee attached userlog.  This is a minor problem in and of itself, but is also causing DAGMan to become confused (<span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3650\" onclick=\"get_ticket_and_populate_wrapper('3650'); return false;\" title=\"DAGMan miscounts held jobs when hold event is duplicated.\">#3650</a></span>).\n\n<p>Note: this is a scheduler universe job.</p></blockquote>", "remarks": "<blockquote>\ncondor_dagman just merrily increments the hold count whenever it sees a hold event, and does not check whether the job is on hold already (in its internal state) -- see <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3650\" onclick=\"get_ticket_and_populate_wrapper('3650'); return false;\" title=\"DAGMan miscounts held jobs when hold event is duplicated.\">#3650</a></span>.  Add some functions that check that DAGMan has accounted for the hold event already, and also that everything gets released eventually as well.\n\n<p></p><hr/>\n<em>2013-May-28 14:48:04 by nwp:</em> <br/>\n\nLIGO says: periodic hold in scheduler universe causes this every time.\n\n<p></p><hr/>\n<em>2013-May-30 10:22:33 by gthain:</em> <br/>\n\nNote this is only with on_exit_hold:  the following submit file reproduces the problem:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">universe = scheduler\nexecutable = /bin/sleep\narguments = 3\n\noutput = out\nerror  = err\nlog    = log\n\non_exit_hold = true\nqueue\n\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">000 (387.000.000) 05/30 10:21:21 Job submitted from host: &lt;128.105.14.141:55617&gt;\n...\n001 (387.000.000) 05/30 10:21:21 Job executing on host: &lt;128.105.14.141:55617&gt;\n...\n012 (387.000.000) 05/30 10:21:25 Job was held.\n\tThe job attribute OnExitHold expression 'true' evaluated to TRUE\n\tCode 3 Subcode 0\n...\n012 (387.000.000) 05/30 10:21:25 Job was held.\n\tThe job attribute OnExitHold expression 'true' evaluated to TRUE\n\tCode 3 Subcode 0\n...\n\n</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/738/monitor.log\">monitor.log</a>\n1320 bytes added by pfc on 2013-May-21 19:32:12 UTC.\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jun-11 16:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=36533\">[36533]</a></span>: edit version history item ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3651\" onclick=\"get_ticket_and_populate_wrapper('3651'); return false;\" title=\"condor is recording duplicate hold events in userlog\">#3651</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jun-04 13:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35984\">[35984]</a></span>: Update aviary call due to signature change from Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3651\" onclick=\"get_ticket_and_populate_wrapper('3651'); return false;\" title=\"condor is recording duplicate hold events in userlog\">#3651</a></span>  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jun-04 13:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35983\">[35983]</a></span>: Update aviary call due to signature change from Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3651\" onclick=\"get_ticket_and_populate_wrapper('3651'); return false;\" title=\"condor is recording duplicate hold events in userlog\">#3651</a></span>  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-31 14:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35968\">[35968]</a></span>: Document <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3651\" onclick=\"get_ticket_and_populate_wrapper('3651'); return false;\" title=\"condor is recording duplicate hold events in userlog\">#3651</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-31 14:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35967\">[35967]</a></span>: Fix double-writing of hold events with on_exit_hold <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3651\" onclick=\"get_ticket_and_populate_wrapper('3651'); return false;\" title=\"condor is recording duplicate hold events in userlog\">#3651</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Jun-11 16:21", "status": "defer", "created": "2013-May-21 14:32", "fixed_version": "2013-May-21 14:32", "broken_version": "v070808", "priority": "5", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "#3650", "creator": "pfc", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pfcouvar@syr.edu,pcouvare@caltech.edu", "due_date": ""}