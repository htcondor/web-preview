{"id": 1738, "title": "Ticket #1738: document correct usage of condor_credd for mixed pools of machines", "description": "<blockquote>\nKaren has seen various condor-users with the same problem.  Using the condor_credd to set passwords, often in pools with mixed platforms.  This is to get Windows platform jobs to run as the job owner, instead of the temporary dedicated account, so pools with STARTER_ALLOW_RUNAS_OWNER = True.\n\n<p>Since so many have the same questions, it is time to document the answer in a clear way, in the manual.\n\n</p><p>Here is one such condor-users e-mail message:\n\n</p><p>I'm building a Condor cluster which will contain Windows and Linux\nmachines. Currently I'm trying to get the Windows part of the cluster\nto work. The jobs which will run on the cluster require the\n\"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RunAsOwner\" title=\"Run As Owner\">RunAsOwner</a></span>\" functionality. I already succeded installing Condor on a\nsmall part of the Windows cluster (1x WinXP x64 which is the Central\nManger, 4x Win Server 2003 R2 which are submit and execution hosts).\nI've read the manual section 6.2 about setting up the Central Manager\nas Credential Server but the setup does not work in my case. This is\nwhat I did:\n\n</p><p>1. Copied the contents of the condor_config.local.credd file to the\ncondor_config.local file on the Central Manager. The relevant part of\nthe condor_confic.local looks like:\n\n</p><p></p><pre>   CREDD_HOST = &lt;hostname.of.my.central.manager&gt;\n   STARTER_ALLOW_RUNAS_OWNER = True\n   CREDD_CACHE_LOCALLY = True\n</pre>\n\n<p></p><pre>   SEC_CLIENT_AUTHENTICATION_METHODS = NTSSPI, PASSWORD\n</pre>\n\n<p></p><pre>   ALLOW_CONFIG = &lt;hostname.of.my.central.manager&gt;\n   SEC_CONFIG_NEGOTIATION = REQUIRED\n   SEC_CONFIG_AUTHENTICATION = REQUIRED\n   SEC_CONFIG_ENCRYPTION = REQUIRED\n   SEC_CONFIG_INTEGRITY = REQUIRED\n</pre>\n\n<p>Plus the part for the \"UBER-KNOWLEDGABLE user\" from the\ncondor_config.local.credd file. The settings shown above are identical\nfor all hosts in my pool (except for the part for the\nUBER-KNOWLEDGABLE user which is only included in the config file of\nthe Central Manager).\n2. I ran the condor_restart command on the Central Manager. The\ncondor_credd daemon is correctly starting on this machine.\n\n</p><p>3. I ran the command\n\n</p><p>condor_store_credd -c add\n\n</p><p>and\n\n</p><p>condor_store_cred -c -n &lt;hostname&gt; add\n\n</p><p>from the Central Manager to define a pool password localy and for the\nother pool members. Although the condor_store_credd states that\n\"Operation succeeded\" for all my pool members the testcommand\n\n</p><p>condor_status -f \"%s\\t\" Name -f \"%s\\n\"\nifThenElse(isUndefined(LocalCredd),\\\"UNDEF\\\",LocalCredd)\n\n</p><p>states an \"UNDEF\" for all machines except for the Central Manager\nwhere I'm currently logged in. Another thing I can't really understand\n(and which is probably related to this problem) is that when I call\nthe condor_store_cred -c add command it states\n\n</p><p> \"Account: condor_pool@&lt;hostname.of.my.central.manager&gt;\"\n\n</p><p>This account does in fact not exist (should it be created?) and I\ndon't understand what the pool password has to do with this\nnonexistent account. BTW: I executed the condor_store_credd command\nusing a domain account which has administrator priviledges for all\nmachines in my pool which is what the manual suggested. In the\n<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CreddLog\" title=\"Credd Log\">CreddLog</a></span> file on my Central Manager I can see a bunch of entries like\n   10/27 18:05:16 getStoredCredential(): Could not locate credential for\n   user 'condor_pool@sword09.cst.de'\n   10/27 18:05:36 getStoredCredential(): Could not locate credential for\n   user 'condor_pool@sword07.cst.de'\n\n</p><p>Seems that the machines are searching for some local accounts called\ncondor_pool which of course do again not exist on the machines...\n\n</p><p></p><hr/>\nMy question now is: Should I create a user called \"condor_pool\" in\norder for the central password storage to work? If yes which\nproperties should this account have (Admin account (local), Domain\nAdmin, Normal user account...) or is there something else I'm missing\nhere?\n\n<p>I hope someone has an idea what is happening here. Thank you very much.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Dec-29 11:22:09 by smoler:</em> <br/>\n\nAfter discussion with TJ and Todd T., there is a fair amount of correct, if quite misleading info in the manual.\n\n<p>STEP 1: The condor_store_cred command is used for 2 different tasks. One task is to set a pool password for the implied condor_pool@$(UID_DOMAIN) user, when setting up the PASSWORD authentication method (for daemons to talk to each other, and probably to talk to the condor_credd).  The other task is to set a user password for use by the credd when run_as_owner is desired.\n\n</p><p>STEP 2: Decouple the section 6.2.4 discussion about executing jobs as the submitting user.  The current recipe provides an example of setting up PASSWORD authentication, but never states that this has little to do with run_as_owner for jobs.  Yes, there must be authentication, and our example uses PASSWORD as the method, but that is somewhat irrelevant.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Dec-29 14:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25839\">[25839]</a></span>: clarifying use of condor_store_cred (man page); gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=1738\" title=\"document correct usage of condor_credd for mixed pools of machines\">#1738</a></span>  (By Karen Miller )</td></tr>\n</tbody></table>", "type": "doc", "last_change": "2011-Nov-22 09:23", "status": "resolved", "created": "2010-Oct-27 14:42", "fixed_version": "2010-Oct-27 14:42", "broken_version": "v070400", "priority": "4", "subsystem": "", "assigned_to": "smoler", "derived_from": "", "creator": "smoler", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}