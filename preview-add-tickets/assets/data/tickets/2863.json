{"id": 2863, "title": "Ticket #2863: RFE: Concurrency limit default grouping", "description": "<blockquote>\nWe would like the ability to set a grouping of concurrency limit\ndefaults to assist in avoiding a high rate of negotiator reconfigs for\nconcurrency limit adjustments. We envision consuming that as something like:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">CONCURRENCY_LIMIT_DEFAULT=150\nCONCURRENCY_LIMIT_DEFAULT_LIST = direct,batch\nCONCURRENCY_LIMIT_DEFAULT_LIST_direct = 40\nCONCURRENCY_LIMIT_DEFAULT_LIST_batch = 120\n</pre></div>\n\n\n<p>A concurrency limit of \"gl5000\" would start with a value of 150. A concurrency\nlimit of \"direct.gl5000\" would start with a value of 40. A concurrency limit of\n\"batch.gl5000\" would start with a value of 120.</p></blockquote>", "remarks": "<blockquote>\nNote, I simplified the originally requested configuration scheme, as shown here:\n\n<p>TESTING:\n\n</p><p>Begin with this configuration, that defines some scoped cc-limit defaults and a traditional cc-limit \"TEST\":\n</p><div class=\"code\">\n<pre class=\"code\">NEGOTIATOR_DEBUG = D_ACCOUNTANT | D_FULLDEBUG\nNEGOTIATOR_INTERVAL = 20\nNEGOTIATOR_CYCLE_DELAY = 5\n\n# oversubscribe some slots to make testing easier:\nNUM_CPUS = 25\n\n# concurrency limit defaults:\nCONCURRENCY_LIMIT_DEFAULT = 1\nCONCURRENCY_LIMIT_DEFAULT_small = 2\nCONCURRENCY_LIMIT_DEFAULT_medium = 5\nCONCURRENCY_LIMIT_DEFAULT_large = 11\n\nTEST_LIMIT = 3\n</pre></div>\n\n\n<p>Spin up a pool with this configuration, and submit this job:\n</p><div class=\"code\">\n<pre class=\"code\">universe = vanilla\ncmd = /bin/sleep\nargs = 600\ntransfer_executable = false\nshould_transfer_files = if_needed\nwhen_to_transfer_output = on_exit\nconcurrency_limits = large.test\nqueue 20\nconcurrency_limits = medium.test\nqueue 20\nconcurrency_limits = small.test\nqueue 20\nconcurrency_limits = test\nqueue 20\nconcurrency_limits = undef.test\nqueue 20\nconcurrency_limits = undef\nqueue 20\n</pre></div>\n\n\n<p>If you grep the negotiator log as follows, after submission you should see:\n</p><div class=\"code\">\n<pre class=\"code\">$ tail -f NegotiatorLog | grep -e '-------' -e 'Limits --' -e 'Limit:'\n03/06/12 16:28:05 ---------- Started Negotiation Cycle ----------\n03/06/12 16:28:06 Previous Limits --\n03/06/12 16:28:06 Current Limits --\n03/06/12 16:28:06 ---------- Finished Negotiation Cycle ----------\n03/06/12 16:28:12 ---------- Started Negotiation Cycle ----------\n03/06/12 16:28:13 Previous Limits --\n03/06/12 16:28:13 Current Limits --\n03/06/12 16:28:13 Concurrency Limit: large.test is 0.000000\n03/06/12 16:28:13 Concurrency Limit: large.test is 1.000000\n03/06/12 16:28:13 Concurrency Limit: large.test is 2.000000\n03/06/12 16:28:13 Concurrency Limit: large.test is 3.000000\n03/06/12 16:28:13 Concurrency Limit: large.test is 4.000000\n03/06/12 16:28:13 Concurrency Limit: large.test is 5.000000\n03/06/12 16:28:13 Concurrency Limit: large.test is 6.000000\n03/06/12 16:28:13 Concurrency Limit: large.test is 7.000000\n03/06/12 16:28:13 Concurrency Limit: large.test is 8.000000\n03/06/12 16:28:13 Concurrency Limit: large.test is 9.000000\n03/06/12 16:28:13 Concurrency Limit: large.test is 10.000000\n03/06/12 16:28:13 Concurrency Limit: large.test is 11.000000\n03/06/12 16:28:13 Concurrency Limit: medium.test is 0.000000\n03/06/12 16:28:14 Concurrency Limit: medium.test is 1.000000\n03/06/12 16:28:14 Concurrency Limit: medium.test is 2.000000\n03/06/12 16:28:14 Concurrency Limit: medium.test is 3.000000\n03/06/12 16:28:14 Concurrency Limit: medium.test is 4.000000\n03/06/12 16:28:14 Concurrency Limit: medium.test is 5.000000\n03/06/12 16:28:14 Concurrency Limit: small.test is 0.000000\n03/06/12 16:28:14 Concurrency Limit: small.test is 1.000000\n03/06/12 16:28:14 Concurrency Limit: small.test is 2.000000\n03/06/12 16:28:14 Concurrency Limit: test is 0.000000\n03/06/12 16:28:14 Concurrency Limit: test is 1.000000\n03/06/12 16:28:14 Concurrency Limit: test is 2.000000\n03/06/12 16:28:14 Concurrency Limit: test is 3.000000\n03/06/12 16:28:14 Concurrency Limit: undef.test is 0.000000\n03/06/12 16:28:14 Concurrency Limit: undef.test is 1.000000\n03/06/12 16:28:14 Concurrency Limit: undef is 0.000000\n03/06/12 16:28:14 Concurrency Limit: undef is 1.000000\n03/06/12 16:28:15 ---------- Finished Negotiation Cycle ----------\n</pre></div>\n\n\n<p>Another verification that the concurrency limits were obeyed as defined:\n</p><div class=\"code\">\n<pre class=\"code\">$ qvhist ConcurrencyLimits -c 'JobStatus == 2'\n     11 large.test\n      5 medium.test\n      2 small.test\n      3 test\n      1 undef\n      1 undef.test\n     23 total\n</pre></div>\n\n\n<p>note, qvhist can be found here: <a class=\"external\" href=\"https://github.com/erikerlandson/bash_condor_tools\">https://github.com/erikerlandson/bash_condor_tools</a>\n\n</p><p></p><hr/>\n<em>2012-Apr-02 11:37:49 by smoler:</em> <br/>\n\nNice start to the documentation, but a detail is not specified and not yet clear. In your examples and also in the example in the manual, there is always a period in the example.  So, the question is: is this period a necessary part or separator with your prefix?  As in, if you've set the configuration with\n<div class=\"verbatim\">\n<pre>CONCURRENCY_LIMIT_DEFAULT = 5\nCONCURRENCY_LIMIT_DEFAULT_LARGE = 100\n</pre></div>\n\nand then a couple of jobs use the limits:\n<div class=\"verbatim\">\n<pre># one job that has the period character\nconcurrency_limits = large.swlicense\n</pre></div>\n\nIn your example, this job is part of the limit of 100.\n<div class=\"verbatim\">\n<pre># another job that does NOT have the period character\nconcurrency_limits = largeswlicense\n</pre></div>\n\nWhat limit does this second job fall under?  5 or 100?\n\n<p>Know that whatever the correct answer is, the documentation will be changed to <em>NOT</em> use the term groups.  We don't want to overload that term and confuse folks.  Yes, this certainly is a grouping (in its generic, dictionary definition), but I'll probably use wording that implies sets of jobs instead.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-07 17:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35643\">[35643]</a></span>: Improve concurrency limits documentation <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3425\" onclick=\"get_ticket_and_populate_wrapper('3425'); return false;\" title=\"Concurrency limit settings not in configuration section of manual\">#3425</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2863\" onclick=\"get_ticket_and_populate_wrapper('2863'); return false;\" title=\"RFE: Concurrency limit default grouping\">#2863</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-09 11:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=31553\">[31553]</a></span>: Added logic to replace '.' with '_' when reporting concurrency limits having scope ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2863\" onclick=\"get_ticket_and_populate_wrapper('2863'); return false;\" title=\"RFE: Concurrency limit default grouping\">#2863</a></span>  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-08 13:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=30868\">[30868]</a></span>: ===VersionHistory:Completed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2863\" onclick=\"get_ticket_and_populate_wrapper('2863'); return false;\" title=\"RFE: Concurrency limit default grouping\">#2863</a></span>  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-08 13:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=30867\">[30867]</a></span>: Documentation for concurrency limit default groups ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2863\" onclick=\"get_ticket_and_populate_wrapper('2863'); return false;\" title=\"RFE: Concurrency limit default grouping\">#2863</a></span>  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-08 13:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=30866\">[30866]</a></span>: Added support for scoping concurrency limit defaults ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2863\" onclick=\"get_ticket_and_populate_wrapper('2863'); return false;\" title=\"RFE: Concurrency limit default grouping\">#2863</a></span>  (By Erik Erlandson )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-May-07 15:11", "status": "resolved", "created": "2012-Mar-05 14:16", "fixed_version": "2012-Mar-05 14:16", "broken_version": "", "priority": "2", "subsystem": "Daemons", "assigned_to": "eje", "derived_from": "", "creator": "eje", "rust": "", "customer_group": "other", "visibility": "public", "notify": "eje@cs.wisc.edu, dan@hep.wisc.edu, matt@cs.wisc.edu, tstclair@redhat.com, smoler@cs.wisc.edu", "due_date": ""}