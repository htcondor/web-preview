{"id": 1434, "title": "Ticket #1434: Quill Error_Sqllogs table lossage causes disk fill up", "description": "<blockquote>\nIn file <code>src/condor_tt/ttmanager.cpp</code>, in function\n<code>void TTManager::handleErrorSqlLog()</code> something stupid happens.\n\n<p>Suppose we have a situation where an insertion in the horizontal\ntable fails due to a type mistake on the value (e.g., coresize =\n\"eleventy-billion\" instead of coresize = 11000000).\n\n</p><p>At this point, the erroneous query AND the entire schedd_sql.log file\nis inserted into new a row in the <code>Error_Sqllogs table</code>.\n\n</p><p>So, if you have a 1 Meg schedd_sql.log file, and have 1000 errors in\nit, you will consume 1GB of storage in the DB by having 1000 new rows\ninserted in the <code>Error_Sqllogs</code> table with each row having one copy of\nthe <code>schedd_sql.log</code> file.\n\n</p><p>condor_dbmsd will eventually get around to dropping and resetting that\ntable.  However, if it isn't running, or there are more errors with a\nlarge enough schedd_sql.log file that in one bulk load you fill the disk,\nyou get screwed.\n\n</p><p>The fix we're thinking of at this time is to simply stop appending the\nlog file into the table and fill that entry with a \"N/A\" string or some\nsuch thing when it happens. We need to rethink why that code was storing\nthe entire log like this.</p></blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2010-Aug-23 17:42:37 by adesmet:</em> <br/>\n\nBulk change of target version from v070403 to v070404 using ./ticket_target_mover.\n\n<p></p><hr/>\n<em>2010-Sep-29 12:16:04 by psilord:</em> <br/>\n\nMade it so that the schedd_sql.log file is NEVER inserted into the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LogBody\" title=\"Log Body\">LogBody</a></span> column in a row in the Error_SqlLogs table. Good enough for 7.4.x and noone we know of uses this feature.\n\n<p>Resolved.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Sep-29 12:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25708\">[25708]</a></span>: Added blurb about fixing quill bug defined in gt <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1434\" onclick=\"get_ticket_and_populate_wrapper('1434'); return false;\" title=\"Quill Error_Sqllogs table lossage causes disk fill up\">#1434</a></span>.  (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Sep-29 11:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=19093\">[19093]</a></span>: The Problem: When there is an error, we create a new row in the error_sqllog table and place the ENTIRE log file into the newly created row. Under conditions where the condor_quilld is down for a long time, the log file may have grown to hundreds of megabytes. Additionally, if a stable error rate is\u00a0[...]\n (By Peter Keller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Sep-29 12:16", "status": "resolved", "created": "2010-Jun-08 14:12", "fixed_version": "2010-Jun-08 14:12", "broken_version": "v070400", "priority": "1", "subsystem": "Quill", "assigned_to": "psilord", "derived_from": "", "creator": "psilord", "rust": "a20584", "customer_group": "fermi", "visibility": "public", "notify": "psilord@cs.wisc.edu, gthain@cs.wisc.edu", "due_date": "20100929"}