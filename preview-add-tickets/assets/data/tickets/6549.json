{"id": 6549, "title": "Ticket #6549: ProvisionedGPUs wrong", "description": "<blockquote>\nThe symptom is that the user log's usage report claims that a set of jobs had more simultaneously-provisioned GPUs than actually existed.\n\n<p>When the startd accepts a schedd's claim to a partitionable slot, that schedd does a bad job of converting the match ad it got from the negotiator into the slot ad for the dynamic slot on which the startd will actually run the job.  (The startd should just tell the schedd what the deal is, but that's GregT's problem.)  In particular, and aside from assuming that Request{Cpu,Memory,Disk} = Provisioned*, the schedd does not deal with custom machine resources at all.  As a result, the job running in the first dynamic slot (even when it's reused) will always have Provisioned* = Total* for each custom machine resource.  The second dynamic slot will have Provisioned* = Total* - &lt;AssignedToFirstJob*&gt;, and so forth.\n\n</p><p>The simplest work-around is to have the starter report the correct values from the copy of the slot ad it gets from the startd.</p></blockquote>", "remarks": "<blockquote>\n<em>2018-Feb-02 10:17:28 by tlmiller:</em> <br/>\n\nThere's an opportunity here to improve the usage report by adding another column for 'Assigned*', since we're now reporting that.\n\n<p>If we do that, the report could be further improved by converting CPU affinity into an Assigned* attribute.\n\n</p><p></p><hr/>\n<em>2018-Feb-02 16:14:13 by tlmiller:</em> <br/>\n\nDocument the bug fix and new feature (user log behaviour).\n\n<p></p><hr/>\n<em>2018-Feb-05 16:25:29 by tlmiller:</em> <br/>\n\nBuild fix 2/2 became <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6557\" onclick=\"get_ticket_and_populate_wrapper('6557'); return false;\" title=\"RemoteResource::allowRemoteWriteAttributeAccess() problems\">#6557</a></span> because the problem is also in v8.6.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-06 13:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54220\">[54220]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6549\" onclick=\"get_ticket_and_populate_wrapper('6549'); return false;\" title=\"ProvisionedGPUs wrong\">#6549</a></span>) Release notes.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-05 11:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54213\">[54213]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6549\" onclick=\"get_ticket_and_populate_wrapper('6549'); return false;\" title=\"ProvisionedGPUs wrong\">#6549</a></span>) Build fix (1A/2): derp. Missed <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ProvisionedResources\" title=\"Provisioned Resources\">ProvisionedResources</a></span>.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-05 11:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54211\">[54211]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6549\" onclick=\"get_ticket_and_populate_wrapper('6549'); return false;\" title=\"ProvisionedGPUs wrong\">#6549</a></span>) Build fix (1/2): derp. Only send the updates, not the whole job ad.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-02 15:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54203\">[54203]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6549\" onclick=\"get_ticket_and_populate_wrapper('6549'); return false;\" title=\"ProvisionedGPUs wrong\">#6549</a></span>) Report the assigned custom machine resources in the user log's report, as well.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-02 10:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54199\">[54199]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6549\" onclick=\"get_ticket_and_populate_wrapper('6549'); return false;\" title=\"ProvisionedGPUs wrong\">#6549</a></span>) Report Provisioned* and Assigned* from the starter.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2018-Feb-06 13:53", "status": "resolved", "created": "2018-Feb-02 10:14", "fixed_version": "2018-Feb-02 10:14", "broken_version": "v080707", "priority": "1", "subsystem": "DaemonsExecNode", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}