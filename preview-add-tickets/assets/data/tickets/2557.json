{"id": 2557, "title": "Ticket #2557: ssh_to_job test fails on deb 6.0 in new batlab", "description": "<blockquote>\nThe ssh_to_job test fails on deb 6.0 in the new batlab (exec-14.batlab.org).\n\n<p>I can reproduce the problem with a personal condor on the same machine with all default settings.  The sshd server claims that tcp wrappers rejects the connection.  If I instead configure the personal condor to use 127.0.0.1 as its IP address instead of 128.104.103.14, condor_ssh_to_job succeeds.  If I ssh_to_job from submit-2 to a job running in the base condor on this machine, it succeeds.\n\n</p><p>If I ssh to the IP address of this machine (128.104.103.14) from this machine, the connection is refused.  If I ssh to 127.0.0.1 or 127.0.1.1 from this machine, it succeeds.\n\n</p><p>I conclude that tcp wrappers does not like connections that originate from 128.104.103.14.  I don't understand why.  Dan R temporarily set tcp wrappers to accept from anywhere, but ssh_to_job still didn't work.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Oct-18 09:40:56 by gthain:</em> <br/>\n\n$ cat /etc/hosts\n127.0.0.1       localhost\n127.0.1.1       exec-5.batlab.org       exec-5\n\n<p>$ cat /etc/hosts.allow\nALL: localhost, 127.0.0.1\n\n</p><p>sshd: .wisc.edu, .batlab.org, 128.104.153.132\n\n</p><p>So, the ssh is binding to 127.0.1.1, which <em>isn't</em> in the hosts.allow.   I've changed hosts.allow to allos ALL: 127., and submitted a test run.  I'll let you know.\n\n</p><p></p><hr/>\n<em>2011-Oct-18 11:23:24 by danb:</em> <br/>\n\nGreg discovered the following:\n\n<p></p><pre>   Oct 18 10:30:28 exec-14 sshd[15967]: warning: /etc/hosts.allow, line 11: host name/address mismatch: 128.104.103.14 != exec-14.batlab.org\n   Oct 18 10:30:28 exec-14 sshd[15967]: refused connect from 128.104.103.14 (128.104.103.14)\n</pre>\n\n<p>If we comment out the\n\n</p><p></p><pre>   127.0.1.1 exec-4 exec-4.batlab.org\n</pre>\n\n<p>It all works.\n\n</p><p></p><hr/>\n<em>2011-Oct-18 11:32:23 by danb:</em> <br/>\n\nConclusion: some systems are set up in a way that reject ssh connections from the eth0 interface, due to the hostname being mapped to 127.0.1.1 in /etc/hosts.  This prevents ssh_to_job from succeeding in a personal condor that uses eth0.  The workaround is to either fix /etc/hosts or to run the personal condor on the localhost interface.\n\n<p>It would have been nice if Condor or at least the ssh_to_job test reported this problem more clearly.  sshd did not log anything in its sshd.log at the default debug level.  When I added -d to the sshd command-line, it reported in sshd.log that tcp wrappers rejected the connection, but it did not say why.  In the ssh_to_job test, we could add the -d option and we could print the contents of sshd.log in the test logs.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-18 12:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27883\">[27883]</a></span>: Made it easier to diagnose ssh_to_job test failure. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2557\" onclick=\"get_ticket_and_populate_wrapper('2557'); return false;\" title=\"ssh_to_job test fails on deb 6.0 in new batlab\">#2557</a></span> ===VersionHistory:None===  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Aug-07 11:52", "status": "resolved", "created": "2011-Oct-17 18:48", "fixed_version": "2011-Oct-17 18:48", "broken_version": "v070702", "priority": "4", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "", "due_date": ""}