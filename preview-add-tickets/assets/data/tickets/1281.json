{"id": 1281, "title": "Ticket #1281: condor_q -dag doesn't understand nested DAGs", "description": "<blockquote>\n\"condor_q -dag\" doesn't handle nested DAGs.  <a class=\"external\" href=\"http://www.cs.wisc.edu/condor/manual/v7.4/2_10DAGMan_Applications.html#SECTION003106700000000000000\">DAGMan has explicit support for nested dags</a>, so it's a shame that condor_q can't cope.\n\n<p>Observed output:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">-- Submitter: hpc114.tech.purdue.edu : &lt;128.210.135.144:44418&gt; : hpc114.tech.purdue.edu\n ID      OWNER/NODENAME   SUBMITTED     RUN_TIME ST PRI SIZE CMD\n 149.0   adesmet         3/16 21:20   0+00:01:53 R  0   7.3  condor_dagman -f -\n 158.0    |-G00002       3/16 21:21   0+00:00:34 R  0   7.3  condor_dagman -f -\n 161.0    |-Archive      3/16 21:21   0+00:00:01 R  0   0.0  archive_wrapper.sh\n</pre></div>\n\n\n<p>Expected output:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">-- Submitter: hpc114.tech.purdue.edu : &lt;128.210.135.144:44418&gt; : hpc114.tech.purdue.edu\n ID      OWNER/NODENAME   SUBMITTED     RUN_TIME ST PRI SIZE CMD\n 149.0   adesmet         3/16 21:20   0+00:01:53 R  0   7.3  condor_dagman -f -\n 158.0    |-G00002       3/16 21:21   0+00:00:34 R  0   7.3  condor_dagman -f -\n 161.0      |-Archive    3/16 21:21   0+00:00:01 R  0   0.0  archive_wrapper.sh\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2010-Oct-20 16:03:30 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.\n<hr/>\n<em>2011-Jan-27 14:46:04 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 16:01:00 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2011-Sep-01 09:35:52 by wenger:</em> <br/>\n\nBumped up the priority as per request from Duncan Brown at LIGO.\n\n<p></p><hr/>\n<em>2011-Dec-13 23:08:18 by nwp:</em> <br/>\n\nI have a working version of <code>condor_q -dag</code> that groups things properly.  Is there anyone who wants to test it out?  I have a nested DAG; the output is as follows:\n<div class=\"code\">\n<pre class=\"code\">-- Submitter: nwp@llunet.cs.wisc.edu : &lt;128.105.175.76:35373&gt; : llunet.cs.wisc.edu\n ID      OWNER/NODENAME   SUBMITTED     RUN_TIME ST PRI SIZE CMD\n 194.0   nwp            12/13 22:44   0+00:00:38 R  0   2.0  condor_dagman -f -\n 195.0    |-1           12/13 22:44   0+00:00:14 R  0   0.0  1281.sh 195\n 196.0    |-2           12/13 22:44   0+00:00:14 R  0   0.0  1281.sh 196\n 197.0    |-0           12/13 22:44   0+00:00:18 R  0   2.0  condor_dagman -f -\n 201.0     |-1          12/13 22:45   0+00:00:00 I  0   0.0  1281.sh 201\n 202.0     |-2          12/13 22:45   0+00:00:00 I  0   0.0  1281.sh 202\n 203.0     |-3          12/13 22:45   0+00:00:00 I  0   0.0  1281.sh 203\n 204.0     |-4          12/13 22:45   0+00:00:00 I  0   0.0  1281.sh 204\n 205.0     |-5          12/13 22:45   0+00:00:00 I  0   0.0  1281.sh 205\n 198.0    |-3           12/13 22:44   0+00:00:14 R  0   0.0  1281.sh 198\n 199.0    |-4           12/13 22:44   0+00:00:14 R  0   0.0  1281.sh 199\n 200.0    |-5           12/13 22:44   0+00:00:14 R  0   0.0  1281.sh 200\n</pre></div>\n\nThis <em>is</em> the correct output for my case.\n\n<p></p><hr/>\n<em>2011-Dec-14 10:05:42 by nwp:</em> <br/>\n\nTests failed in my build&amp;test run last night.  I think I found the problem.  Unfortunately, it seems that the tests do not run in my personal condor, so I have to submit a build&amp;test run to verify that my fix actually works.\n\n<p></p><hr/>\n<em>2011-Dec-14 12:03:28 by wenger:</em> <br/>\n\nYeah, that output looks good to me.\n\n<p></p><hr/>\n<em>2011-Dec-15 09:53:23 by nwp:</em> <br/>\n\nI ran the tests again.  Due to batlab flakiness, there were sporadic failures, but nothing consistent that shows a regression.  I am going to push this into\nmaster; I still need to write a regression test to make sure this keeps working.\nIf LIGO would like the correct <code>condor_q -dag</code> behavior immediately, we can ship out a binary.\n\n<p></p><hr/>\n<em>2011-Dec-16 23:07:53 by nwp:</em> <br/>\n\nTests on batlab pass; regression test done.  So I am resolving this.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-10 11:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=29043\">[29043]</a></span>: Reorder version history items to group DAGMan ones together; move a bug fix item mistakenly placed with the new features; edit version history items and correct spelling; update the condor_q man page to represent the new feature. ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1281\" onclick=\"get_ticket_and_populate_wrapper('1281'); return false;\" title=\"condor_q -dag doesn't understand nested DAGs\">#1281</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2463\" onclick=\"get_ticket_and_populate_wrapper('2463'); return false;\" title=\"condor_q -dag incorrectly assigns node jobs\">#2463</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-19 20:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28860\">[28860]</a></span>: Try to take care of spacing properly when formatting a DAG Also, I believe this solves <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2463\" onclick=\"get_ticket_and_populate_wrapper('2463'); return false;\" title=\"condor_q -dag incorrectly assigns node jobs\">#2463</a></span> ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1281\" onclick=\"get_ticket_and_populate_wrapper('1281'); return false;\" title=\"condor_q -dag doesn't understand nested DAGs\">#1281</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-17 14:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28836\">[28836]</a></span>: Fix paths in last commit Also fix a typo ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1281\" onclick=\"get_ticket_and_populate_wrapper('1281'); return false;\" title=\"condor_q -dag doesn't understand nested DAGs\">#1281</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-17 13:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28835\">[28835]</a></span>: Make the output filenames longer to guard against collisions ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1281\" onclick=\"get_ticket_and_populate_wrapper('1281'); return false;\" title=\"condor_q -dag doesn't understand nested DAGs\">#1281</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-16 16:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28834\">[28834]</a></span>: Write regression tests for condor_q -dag ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1281\" onclick=\"get_ticket_and_populate_wrapper('1281'); return false;\" title=\"condor_q -dag doesn't understand nested DAGs\">#1281</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-15 09:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28796\">[28796]</a></span>: Fix output of -dag option to condor_q ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=1281\" onclick=\"get_ticket_and_populate_wrapper('1281'); return false;\" title=\"condor_q -dag doesn't understand nested DAGs\">#1281</a></span> ===VersionHistory===  (By Nathan W. Panike )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Dec-16 23:07", "status": "defer", "created": "2010-Mar-16 20:26", "fixed_version": "2010-Mar-16 20:26", "broken_version": "v070400", "priority": "5", "subsystem": "Dag", "assigned_to": "nwp", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "wenger@cs.wisc.edu,dabrown@physics.syr.edu,pcouvare@caltech.edu", "due_date": ""}