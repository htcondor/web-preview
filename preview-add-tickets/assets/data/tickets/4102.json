{"id": 4102, "title": "Ticket #4102: Complete rescue DAGs have incorrect node priorities", "description": "<blockquote>\nWhen writing a complete (\"old-style\") rescue DAG, the node priorities that are written are the <strong>calculated</strong> priorities, not the priorities actually set in the original DAG file.  The rescue DAG file should duplicate the original DAG file in this.\n\n<p>For the current priority scheme, I <strong>think</strong> this will not actually cause incorrect priorities; but for some of the proposed changes in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4024\" onclick=\"get_ticket_and_populate_wrapper('4024'); return false;\" title=\"Problems with DAG node priority implementation\">#4024</a></span>, it would cause incorrect priorities when the rescue DAG is run.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Dec-16 13:22:19 by wenger:</em> <br/>\n\nNote:  we could get rid of this issue by just no longer allowing old-style rescue DAGs...\n\n<p></p><hr/>\n<em>2013-Dec-19 12:33:21 by wenger:</em> <br/>\n\nMade V8_0-gittrac_4102-branch branch for this.\n\n<p></p><hr/>\n<em>2013-Dec-23 07:23:49 by wenger:</em> <br/>\n\nAlso add warnings if user defines a VARS macro called \"priority\", because that would conflict with the priority implementation.\n\n<p></p><hr/>\n<em>2014-Jan-31 15:08:05 by wenger:</em> <br/>\n\nI probably want to put this into 8.1 instead of 8.0 -- the changes are awfully complex for the stable series, and I'm not sure the bug is important enough to try to break out just the minimum changes needed to fix the priorities in old-style rescue DAGs, especially since I think there's still a case where you get the wrong priorities...\n\n<p></p><hr/>\n<em>2014-Aug-28 10:06:10 by wenger:</em> <br/>\n\nI'm going to mark this ticket as abandoned because of <span class=\"ticket\"><a class=\"stalled\" href=\"/tickets?ticket=4563\" onclick=\"get_ticket_and_populate_wrapper('4563'); return false;\" title=\"Disable complete (as opposed to partial) rescue DAGs\">#4563</a></span>: Disable \"old-style\" (complete) rescue DAGs.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"stalled\" href=\"/tickets?ticket=4563\" onclick=\"get_ticket_and_populate_wrapper('4563'); return false;\" title=\"Disable complete (as opposed to partial) rescue DAGs\">#4563</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDisable complete (as opposed to partial) rescue DAGs</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-17 16:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41659\">[41659]</a></span>: Gittrac <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4102\" onclick=\"get_ticket_and_populate_wrapper('4102'); return false;\" title=\"Complete rescue DAGs have incorrect node priorities\">#4102</a></span>: This ticket is abandoned, but I'm committed my partial changes on this (never-to-be-merged) branch just so we have a record of what I was doing.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jan-22 14:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39211\">[39211]</a></span>: Gittrac <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4102\" onclick=\"get_ticket_and_populate_wrapper('4102'); return false;\" title=\"Complete rescue DAGs have incorrect node priorities\">#4102</a></span>: Changed job_dagman_prio_in_rescue test to check that a node with a priority set by a parent doesn't get priority written to rescue DAG; split out HasPriority() and HasExplicitPriority() so that the new part of job_dagman_prio_in_rescue test works; priority values are now private with accessor\u00a0[...]\n (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jan-16 17:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39181\">[39181]</a></span>: Gittrac <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4102\" onclick=\"get_ticket_and_populate_wrapper('4102'); return false;\" title=\"Complete rescue DAGs have incorrect node priorities\">#4102</a></span>: Added splice to job_dagman_propogate_priorities test, other improvements.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jan-16 14:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39179\">[39179]</a></span>: Gittrac <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4102\" onclick=\"get_ticket_and_populate_wrapper('4102'); return false;\" title=\"Complete rescue DAGs have incorrect node priorities\">#4102</a></span>: Simplified the priority propagation code -- note that priority is no longer in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SubmitDagDeepOptions\" title=\"Submit Dag Deep Options\">SubmitDagDeepOptions</a></span>. Please enter the commit message for your changes. Lines starting  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jan-16 11:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39176\">[39176]</a></span>: Gittrac <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4102\" onclick=\"get_ticket_and_populate_wrapper('4102'); return false;\" title=\"Complete rescue DAGs have incorrect node priorities\">#4102</a></span>: Improved the job_dagman_propogate_priorities test to test more cases, in preparation for more changes to the DAGMan priority code.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jan-08 13:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39122\">[39122]</a></span>: Gittrac <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4102\" onclick=\"get_ticket_and_populate_wrapper('4102'); return false;\" title=\"Complete rescue DAGs have incorrect node priorities\">#4102</a></span>: Added a node to the job_dagman_propagate_priorities sub-DAG to make sure that a DAG-level priority does override the submit file priority even if the node doesn't have an explicit DAG- level priority.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jan-07 11:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39116\">[39116]</a></span>: Gittrac <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4102\" onclick=\"get_ticket_and_populate_wrapper('4102'); return false;\" title=\"Complete rescue DAGs have incorrect node priorities\">#4102</a></span>: Added more nodes to the job_dagman_propogate_prioritie (sic) test to test some more cases; consolidates identical submit files into one; fixed problem in DAG node priority overriding submit file priority (introduced by my earlier changes); cleanup of variable and method names; various\u00a0[...]\n (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jan-03 10:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39113\">[39113]</a></span>: Gittrac <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4102\" onclick=\"get_ticket_and_populate_wrapper('4102'); return false;\" title=\"Complete rescue DAGs have incorrect node priorities\">#4102</a></span>: Improved illegal variable name checks.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Dec-23 17:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39092\">[39092]</a></span>: Gittrac <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4102\" onclick=\"get_ticket_and_populate_wrapper('4102'); return false;\" title=\"Complete rescue DAGs have incorrect node priorities\">#4102</a></span>: Added checks for \"priority\" and other VAR names that will goof things up...  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Dec-22 13:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39085\">[39085]</a></span>: Gittrac <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4102\" onclick=\"get_ticket_and_populate_wrapper('4102'); return false;\" title=\"Complete rescue DAGs have incorrect node priorities\">#4102</a></span>: Priority implementation no longer adds priorities to the VARS list; they are explicitly passed to condor_submit().  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Dec-20 13:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39082\">[39082]</a></span>: Gittrac <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4102\" onclick=\"get_ticket_and_populate_wrapper('4102'); return false;\" title=\"Complete rescue DAGs have incorrect node priorities\">#4102</a></span>: Minor fixes to the job_dagman_prio_in_rescue test.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Dec-20 10:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39065\">[39065]</a></span>: Gittrac <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4102\" onclick=\"get_ticket_and_populate_wrapper('4102'); return false;\" title=\"Complete rescue DAGs have incorrect node priorities\">#4102</a></span>: Added job_dagman_prio_in_rescue test for this problem.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Dec-19 14:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39060\">[39060]</a></span>: Gittrac <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4102\" onclick=\"get_ticket_and_populate_wrapper('4102'); return false;\" title=\"Complete rescue DAGs have incorrect node priorities\">#4102</a></span>: Initial actual fix is in place; need to make a test for this; lots of temporary comments where the code needs to be clarified.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Aug-28 10:06", "status": "abandoned", "created": "2013-Dec-04 13:26", "fixed_version": "2013-Dec-04 13:26", "broken_version": "v070700", "priority": "2", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "#4024", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu", "due_date": ""}