{"id": 1267, "title": "Ticket #1267: NMI Builds for window should also make MSI packages", "description": "<blockquote>\nNMI Builds should produce MSI packages for window. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=571\" onclick=\"get_ticket_and_populate_wrapper('571'); return false;\" title=\"Get Condor to run MakeMSI and have it create a sample MSI\">#571</a></span> worked towards this and I'm finishing it.</blockquote>", "remarks": "<blockquote>\n<em>2010-Mar-09 10:51:37 by psilord:</em> <br/>\n\nMeh, my checkin last night didn't work because the environment variables for NMI builds are vastly different than builds done while logged into a windows machine. I have some avenues to fix it and will iterate some branch builds today.\n\n<p></p><hr/>\n<em>2010-Mar-09 14:31:52 by psilord:</em> <br/>\n\nWith Todd's help, I've been hacking on it. I think I'm very close.\n\n<p></p><hr/>\n<em>2010-Mar-10 13:42:48 by psilord:</em> <br/>\n\nThis task just. won't. die.\n\n<p></p><hr/>\n<em>2010-Mar-17 10:23:47 by psilord:</em> <br/>\n\nI was unsuccessful in getting this to work. :(\n\n<p>The final error I could not get around was:\n\n</p><p></p><div class=\"verbatim\">\n<pre>SYNTAX CHECK'S OUTPUT\n~~~~~~~~~~~~~~~~~~~~~\nCScript Error: Loading your settings failed. (Access is denied. )\n</pre></div>\n\n\n<p>This <a class=\"external\" href=\"http://support.microsoft.com/kb/221081\">link</a>, especially step 5, seems to be something important that I need to do, but it doesn't seem to have\nan effect when I do it.\n\n</p><p>The things from <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=571\" onclick=\"get_ticket_and_populate_wrapper('571'); return false;\" title=\"Get Condor to run MakeMSI and have it create a sample MSI\">#571</a></span> (and more) were implemented in V7_4-branch and master:\n</p><ul>\n<li><code>load_profile</code> is true in the nmi submit file glue\n</li><li>Commented out in <code>nmi_glue/build/remote_task</code> is the means by which dopackaging.bat should be run.\n</li><li>MSI (and more) env vars are set in <code>msconfig/installer/mm.cmd</code>.\n</li><li>The env vars TMP and TEMP are automatically set to meaningful values in <code>nmi_glue/build/remote_task</code>.\n</li><li>I created a file called msconfig/installer/msikeys.reg which holds the apparently needed registry keys for CScript. There is a commented out line in msconfig/installer/Makefile which puts the keys into the registry. I didn't check to see if the registry keys actually showed up or not. I don't know how.\n</li></ul>\n\n<p>I did all this, but couldn't ever figure out the problem without spending an unreasonable amount of more time.\n\n</p><p>If you want to test it, then (on V7_4-branch or master):\n</p><ul>\n<li>Comment in the dopackaging step in <code>nmi_glue/build/remote_task</code>.\n</li><li>Comment in the regedit line in <code>msconfig/installer/Makefile</code>.\n</li><li>Submit your workspace build.\n</li></ul>\n\n<p>Good Luck.\n</p><hr/>\n<em>2010-Aug-23 17:07:50 by adesmet:</em> <br/>\n\nBulk change of target version from v070402 to v070404 using ./ticket_target_mover.\n<hr/>\n<em>2010-Oct-27 16:39:01 by adesmet:</em> <br/>\n\nBulk change of target version from v070404 to v070405 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2011-Mar-30 14:13:26 by psilord:</em> <br/>\n\nIt seems that it is impossible for this to work. The three resident windows experts and one upset unix programmer couldn't figure it out.\n\n<p></p><hr/>\n<em>2011-Mar-30 14:22:20 by ziliang:</em> <br/>\n\nActually, I do believe we got this working, but it's turned off right now.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1529\" onclick=\"get_ticket_and_populate_wrapper('1529'); return false;\" title=\"condor_nmi_submit incorrectly tries to load windows profile\">#1529</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\ncondor_nmi_submit incorrectly tries to load windows profile</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-15 12:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17630\">[17630]</a></span>: Sadly, I was unable to get our nightlies to produce the MSI package. :( I've commented out the attempting of it in this script. Hopefully later another crack can be taken at it. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1267\" onclick=\"get_ticket_and_populate_wrapper('1267'); return false;\" title=\"NMI Builds for window should also make MSI packages\">#1267</a></span> holds all of what I know about what was tried and hypotheses why it might not work.  (By Pete Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-15 11:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17628\">[17628]</a></span>: In order to try and get makemsi, which needs cscript, working, I add a registry key with regedit. Unfortunately, this seems to have no effect on the non-workingness of cscript, but the internet insists this is the right thing to do. So I'm leaving it here, but commenting it out until we figure it out\u00a0[...]\n (By Pete Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-12 11:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17449\">[17449]</a></span>: Fixed a control flow error in the output of this script when it fails. This is for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1267\" onclick=\"get_ticket_and_populate_wrapper('1267'); return false;\" title=\"NMI Builds for window should also make MSI packages\">#1267</a></span>.  (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-12 11:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17448\">[17448]</a></span>: Fix the NMI glue to set TEMP properly under a windows build. NMI was setting it to something very wrong, and the windows build was picking it up and using it. Some new code went in recently that caused this to suddenly become a problem.\u00a0[...]\n (By Pete Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-10 16:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17445\">[17445]</a></span>: Fix the NMI glue to set TEMP properly under a windows build. NMI was setting it to something very wrong, and the windows build was picking it up and using it. Some new code went in recently that caused this to suddenly become a problem.\u00a0[...]\n (By Pete Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-10 10:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17423\">[17423]</a></span>: After some serious debugging, I think the real change to enable the msi installer pass in NMI that actually needed to happen was simply that the environment variables TMP and TEMP needed to be set up in mm.cmd <strong>just</strong> for the make msi installer program. I was setting those tmp directories far to early\u00a0[...]\n (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-09 13:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17421\">[17421]</a></span>: Added some double quotes around the processing of %TEMP% and %TMP%. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1267\" onclick=\"get_ticket_and_populate_wrapper('1267'); return false;\" title=\"NMI Builds for window should also make MSI packages\">#1267</a></span>  (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-09 12:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17419\">[17419]</a></span>: Turns out I only need the TMP and TEMP variables. The others are set in installer/mm.cmd. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1267\" onclick=\"get_ticket_and_populate_wrapper('1267'); return false;\" title=\"NMI Builds for window should also make MSI packages\">#1267</a></span>  (By Pete Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-09 11:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17417\">[17417]</a></span>: Another iteration of getting MSI builds to work on windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1267\" onclick=\"get_ticket_and_populate_wrapper('1267'); return false;\" title=\"NMI Builds for window should also make MSI packages\">#1267</a></span>  (By Pete Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-08 16:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17414\">[17414]</a></span>: No guts, no glory. Add MSI packaging to NMI builds. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1267\" onclick=\"get_ticket_and_populate_wrapper('1267'); return false;\" title=\"NMI Builds for window should also make MSI packages\">#1267</a></span>  (By Peter Keller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Jun-04 11:53", "status": "resolved", "created": "2010-Mar-08 16:20", "fixed_version": "2010-Mar-08 16:20", "broken_version": "v070000", "priority": "4", "subsystem": "Packaging", "assigned_to": "", "derived_from": "", "creator": "PitS", "rust": "", "customer_group": "other", "visibility": "public", "notify": "psilord@cs.wisc.edu tanneba@cs.wisc.edu ziliang@cs.wisc.edu", "due_date": ""}