{"id": 7103, "title": "Ticket #7103: obituary missing last k lines of daemon log", "description": "<blockquote>\nTetsuya Miyoshi of Argo noticed that the obituary mails sent the master sends stopped including the last twenty lines of the dead daemon's log.  This appears to have been caused by <span class=\"chng\"><a href=\"chngview?cn=49036\">[49036]</a></span>, which removed one line too many in <code>masterDaemon.cpp</code> (<code>log_name</code> should still be set).  The quick fix, which should work for almost everyone, is to restore the missing line.\n\n<p>The long fix would require the daemon in question to tell the master which log file it's been updating, since the master can't otherwise be sure (and not just because of the obvious config file changes/daemon restarts/reconfigs -- what about <code>condor_config_val -set</code>).  One possibility is to include its current log file name in its keep-alive payload.\n\n</p><p>Additionally, everyone thinks that 20 lines is far too small of default.  Let's try 200, instead.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Jun-10 15:24:11 by tlmiller:</em> <br/>\n\nTJ remarks that it should be easy and we should check to see if the daemon in question has a local name and refuse to set the log file name if it does, since we know we'll get it wrong; we can address the problem more fully if anyone complains.\n\n<p>(As TJ remarked: \"maybe we should hoist dprintf_config.cpp lines 417 447 to a function and make localname and subsysname arguments to that function\".)\n\n</p><p></p><hr/>\n<em>2019-Jun-13 17:09:49 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong> changes look good.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-19 11:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57170\">[57170]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7103\" title=\"obituary missing last k lines of daemon log\">#7103</a></span>) Release note. (And a correction to the annex documentation.)  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-12 13:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57145\">[57145]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7103\" title=\"obituary missing last k lines of daemon log\">#7103</a></span>) Increase the default log size to 200.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-11 18:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57141\">[57141]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7103\" title=\"obituary missing last k lines of daemon log\">#7103</a></span>) Set log_name so that the obituary can actually include the last k lines of the daemon's log. Ignore log_name if the daemon was started with -localname rather than add the all code to handle that case (which still wouldn't always work).  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Jun-19 11:03", "status": "resolved", "created": "2019-Jun-10 14:50", "fixed_version": "2019-Jun-10 14:50", "broken_version": "v080507", "priority": "2", "subsystem": "DaemonMaster", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "s97822", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}