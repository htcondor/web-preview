{"id": 5942, "title": "Ticket #5942: Refresh classad usermaps by timer, without a full reconfig", "description": "<blockquote>\nBoth CERN and CMS would like some enhancement in how the new classad usermaps are refreshed. (Usermaps implemented in <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=5751\" title=\"add a userMap function to condor ClassAds\">#5751</a></span>)\n\n<p>Currently the usermaps are only called within DC::Reconfig by their nature of being inside the classads lib.\n\n</p><p>Currently CERN is generating the mapfiles atomically and calling condor_reconfig.\n\n</p><p>We'd like to keep the mapfiles on disk but allow <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> to refresh the maps on a timer.\n\n</p><p>For CMS their use-case is slightly different in that they'd like to base their config on the MAPDATA variant and have the daemon-core timer ensure a call-out is run which refreshes the mapdata.\n\n</p><p>Talking with BrianB the suggestion is as far as the timer goes, we base it off the DNS Cache example, already in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span>. (See: <a class=\"external\" href=\"https://github.com/htcondor/htcondor/blob/master/src/condor_daemon_core.V6/daemon_core.cpp#L2959\">https://github.com/htcondor/htcondor/blob/master/src/condor_daemon_core.V6/daemon_core.cpp#L2959</a>)\n\n</p><p>This would require exposing the <em>reconfig_user_maps</em> function from <em>classad_usermaps.h</em> to daemonCore.\n\n</p><p>A new config knob for specifying the timer, which defaults to 15 minutes(?)\n\n</p><p><code>CLASSAD_USER_MAP_REFRESH_INTERVAL</code></p></blockquote>", "remarks": "<blockquote>\n<em>2016-Oct-03 13:37:56 by iain.steers:</em> <br/>\n\nI'm happy to submit a patch for the CERN case.\n\n<p>The CMS looks more complicated and may require Brian or TJ to review.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "enhance", "last_change": "2016-Oct-03 13:37", "status": "new", "created": "2016-Oct-03 13:36", "fixed_version": "2016-Oct-03 13:36", "broken_version": "", "priority": "3", "subsystem": "Libs", "assigned_to": "", "derived_from": "", "creator": "iain.steers", "rust": "", "customer_group": "cern", "visibility": "public", "notify": "", "due_date": ""}