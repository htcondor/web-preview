{"id": 6367, "title": "Ticket #6367: +PreCmd exit code ignored", "description": "<blockquote>\nTom Bricker (from SWAMP) observed that the exit code of +PreCmd is ignored.  Since one of the things his pre-script would like to do is abort a (VM universe) job if something is wrong with it, this is dreadfully inconvenient (because of some underspecified problem it causes with the VM universe infrastructure to fail a job in this particular way).\n\n<p>It should not be hard to allow the user to specify what a successful exit from the pre-script looks like (defaults to exit code 0), liked we do for vanilla-universe checkpoints.  (We could even include attributes in the job ad for what the actual exit was, and maybe should -- in both cases.)</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Aug-07 14:15:30 by tlmiller:</em> <br/>\n\nSwitch from +[Pre|Post]Cmd to [Pre|Post]Cmd, as well.\n\n<p></p><hr/>\n<em>2017-Aug-07 14:16:49 by tlmiller:</em> <br/>\n\nShould we also adjust the environment as we do for the job proper?\n\n<p></p><hr/>\n<em>2017-Aug-07 14:19:57 by tlmiller:</em> <br/>\n\nMaybe make it VMPreScript/VMPostScript and not \"look like\" a \"first class\" thing for vanilla universe, since it may well be hard to make it work the way people want/expect (e.g., a shishkebab), since the current implementation is /not/ in the vanilla proc.\n\n<p></p><hr/>\n<em>2017-Aug-07 17:26:53 by tlmiller:</em> <br/>\n\nThe user specifically wants the job not to become idle, since (in his case) the job is malformed.  It may be worth thinking about other options as well.  (Perhaps it would suffice to insert prescriptexitcode... attributes for the use of periodic_release?)\n\n<p></p><hr/>\n<em>2017-Aug-09 16:13:29 by tlmiller:</em> <br/>\n\nIt avoids a naming collision and is more orthogonal to how we handle job retries to name the success condition variables SuccessPreExit*, instead.\n\n<p></p><hr/>\n<em>2017-Aug-09 16:19:13 by tlmiller:</em> <br/>\n\nSo for now, don't change anything about how we run the script -- what we probably want for vanilla universe is the shishkebab, where <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=VanillaProc\" title=\"Vanilla Proc\">VanillaProc</a></span> calls VanillaProc::StartJob() multiple times (like vanilla-universe checkpointing currently does, except with multiple args).\n\n<p></p><hr/>\n<em>2017-Aug-09 17:04:00 by tlmiller:</em> <br/>\n\nRemaining work items (after check-in <span class=\"chng\"><a href=\"chngview?cn=52045\">[52045]</a></span>):\n\n<p></p><ul>\n<li>repeat the exercise for +PostCmd\n</li><li>Add a submit file command with a less-awful name.\n</li></ul>\n\n<p>It may make sense to include \"sandbox\" in the name; or maybe \"input_files/output_files\", as appropriate.\n\n</p><p></p><hr/>\n<em>2017-Aug-11 13:41:28 by tlmiller:</em> <br/>\n\nBe sure to not in the documentation that <code>vm_no_output_vm</code> deletes the postscript before it can run, and as such, if you'd also like to run a post script, you need to turn off <code>vm_no_output_vm</code> and delete the contents of the sandbox in the postscript yourself.\n\n<p></p><hr/>\n<em>2017-Aug-11 13:57:52 by tlmiller:</em> <br/>\n\nOn further consideration, we probably don't want to document this until I get chance to add the non-'+' versions of everything to the submit file language.\n\n<p>See ticket <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=6372\" onclick=\"get_ticket_and_populate_wrapper('6372'); return false;\" title='\"first-class\" names for \"+pre\" or \"+post\" and company'>#6372</a></span>.\n\n</p><p></p><hr/>\n<em>2017-Aug-11 16:32:38 by tlmiller:</em> <br/>\n\nTJ points out that we should do is document the job attributes (and maybe remove +PreCmd/+PostCmd from the condor_submit man page) in the manual section dedicated to them (and ideally split it up by \"things you tell HTCondor\" and \"things HTCondor tells you\").\n\n<p></p><hr/>\n<em>2017-Sep-12 10:37:44 by tlmiller:</em> <br/>\n\nWe'd rather not talk about +PreCmd/+PostCmd until we at least finish <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=6372\" onclick=\"get_ticket_and_populate_wrapper('6372'); return false;\" title='\"first-class\" names for \"+pre\" or \"+post\" and company'>#6372</a></span>, and possible never mention them at all if we go ahead with the multiple commands idea , so let's leave this change out of the version history.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=6372\" onclick=\"get_ticket_and_populate_wrapper('6372'); return false;\" title='\"first-class\" names for \"+pre\" or \"+post\" and company'>#6372</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\n\"first-class\" names for \"+pre\" or \"+post\" and company</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-16 17:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52136\">[52136]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6367\" onclick=\"get_ticket_and_populate_wrapper('6367'); return false;\" title=\"+PreCmd exit code ignored\">#6367</a></span>) Forgot to document the new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=HoldReasonCodes\" title=\"Hold Reason Codes\">HoldReasonCodes</a></span>.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-15 13:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52110\">[52110]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6367\" onclick=\"get_ticket_and_populate_wrapper('6367'); return false;\" title=\"+PreCmd exit code ignored\">#6367</a></span>) Forgot to document the problem with vm_no_output_vm.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-14 13:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52093\">[52093]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6367\" onclick=\"get_ticket_and_populate_wrapper('6367'); return false;\" title=\"+PreCmd exit code ignored\">#6367</a></span>) Remove +Pre*, +Post* from condor_submit man page, move to job attributes and update with better information and the documentation for this ticket.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-10 15:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52066\">[52066]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6367\" onclick=\"get_ticket_and_populate_wrapper('6367'); return false;\" title=\"+PreCmd exit code ignored\">#6367</a></span>) Implement SuccessPostExit[Code|Signal|BySignal] as for Pre. +PostScript is NOT compatible with vm_no_output_vm.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-09 16:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52045\">[52045]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6367\" onclick=\"get_ticket_and_populate_wrapper('6367'); return false;\" title=\"+PreCmd exit code ignored\">#6367</a></span>) Implement SuccessPreExit[Code|Signal|BySignal]; if an exit condition for prescript success is set, enforce it, and on a failure, set PreExit[Code|Signal|BySignal] and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExitCode\" title=\"Exit Code\">ExitCode</a></span> appropriately and then put the job on hold.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Sep-12 10:38", "status": "resolved", "created": "2017-Aug-07 11:48", "fixed_version": "2017-Aug-07 11:48", "broken_version": "", "priority": "3", "subsystem": "DaemonsExecNode", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}