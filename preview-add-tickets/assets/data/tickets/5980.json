{"id": 5980, "title": "Ticket #5980: job transform requirements don't work if TARGET is used", "description": "<blockquote>\nWhen a job transform's <code>Requirements</code> statement uses <code>TARGET</code> to refer to the job being transformed, the attribute lookup fails because the job is <code>MY</code> not <code>TARGET</code>.  This would not be considered a bug, except that in the job router the <code>Requirements</code> statement for a route used to <em>require</em> that <code>TARGET</code> be used to refer to the job, and even after that bug was fixed in the job router many users still reflexively add the <code>TARGET.</code> prefix.\n\n<p>To reduce the pain for users, the code that loads job transforms in new-classad language should strip the <code>TARGET</code> prefix from attributes in the <code>Requirements</code> (and from eval_set) expressions while converting the expressions into the new transform language.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Nov-23 14:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49643\">[49643]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5967\" onclick=\"get_ticket_and_populate_wrapper('5967'); return false;\" title=\"It should be possible to have multiple negotiators in the collector\">#5967</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5969\" onclick=\"get_ticket_and_populate_wrapper('5969'); return false;\" title=\"config should warn about obsolete SUBSYS.LOCALNAME.* prefixes\">#5969</a></span>, <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5988\" onclick=\"get_ticket_and_populate_wrapper('5988'); return false;\" title=\"classad userMap should tokenize arg3 only commas\">#5988</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5882\" onclick=\"get_ticket_and_populate_wrapper('5882'); return false;\" title=\"$ENV in config/submit should support defaults\">#5882</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5980\" onclick=\"get_ticket_and_populate_wrapper('5980'); return false;\" title=\"job transform requirements don't work if TARGET is used\">#5980</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6020\" onclick=\"get_ticket_and_populate_wrapper('6020'); return false;\" title=\"condor-c and jobRouter should delete TotalSubmitProcs\">#6020</a></span> and doc for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5882\" onclick=\"get_ticket_and_populate_wrapper('5882'); return false;\" title=\"$ENV in config/submit should support defaults\">#5882</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Oct-27 01:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49476\">[49476]</a></span>: strip TARGET prefix from attribute refs in job_transform Requirements and eval_set expressions. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5980\" onclick=\"get_ticket_and_populate_wrapper('5980'); return false;\" title=\"job transform requirements don't work if TARGET is used\">#5980</a></span> So that the (mis)use of TARGET. prefix in the Requirements doesn't prevent at job transform. We do this because TARGET. used to be needed in the job router, and many users have gotten in the habbit of\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Nov-23 15:38", "status": "resolved", "created": "2016-Oct-26 16:08", "fixed_version": "2016-Oct-26 16:08", "broken_version": "", "priority": "4", "subsystem": "DaemonsSubmitNode", "assigned_to": "johnkn", "derived_from": "#5885", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}