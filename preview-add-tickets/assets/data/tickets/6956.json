{"id": 6956, "title": "Ticket #6956: \"Match password auth\" for schedds", "description": "<blockquote>\nOnce <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6947\" onclick=\"get_ticket_and_populate_wrapper('6947'); return false;\" title=\"Extend PASSWORD auth to support multiple and derived secrets\">#6947</a></span> is completed, the schedd will be able to generate a token that can be used as part of PASSWORD2 authentication.\n\n<p>Specifically, this allows a sort of \"match password authentication\" for the negotiator to authenticate with the schedd.  That is, the schedd can generate a token that (a) maps as user condor, (b) <em>only</em> is usable for the NEGOTIATOR authorization, and (c) expires in 20 minutes.\n\n</p><p>This match password can be embedded into the ad sent to the collector as a private attribute.  When the negotiator retrieves the ads from the collector, it now has a valid PASSWORD2 token to perform negotiation with the schedd.\n\n</p><p>This significantly simplifies a flocking setup: the schedd only needs to be able to advertise to the collector, enable PASSWORD2, and the remote negotiator will automatically be able to authenticate with the schedd.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Mar-29 21:27:59 by bbockelm:</em> <br/>\n\nDesign doc is here: <a class=\"external\" href=\"https://docs.google.com/document/d/140IErC6m12WbmalqeBz4Z9LdatOZQfMJ8Q0A9KwYfSI/edit\">https://docs.google.com/document/d/140IErC6m12WbmalqeBz4Z9LdatOZQfMJ8Q0A9KwYfSI/edit</a></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Sep-26 09:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57953\">[57953]</a></span>: Reduce verbosity of log line. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6956\" onclick=\"get_ticket_and_populate_wrapper('6956'); return false;\" title='\"Match password auth\" for schedds'>#6956</a></span> This line causes a scary-looking failure message on collector queries - despite it being harmless in almost all cases. Suppress it.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-02 09:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57553\">[57553]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6956\" onclick=\"get_ticket_and_populate_wrapper('6956'); return false;\" title='\"Match password auth\" for schedds'>#6956</a></span>) Fix typo  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-02 08:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57550\">[57550]</a></span>: Document new match password authentication for negotiation. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6956\" onclick=\"get_ticket_and_populate_wrapper('6956'); return false;\" title='\"Match password auth\" for schedds'>#6956</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-11 16:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57137\">[57137]</a></span>: fix <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6956\" onclick=\"get_ticket_and_populate_wrapper('6956'); return false;\" title='\"Match password auth\" for schedds'>#6956</a></span> so it doesn't crash the schedd on Windows  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-05 15:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57116\">[57116]</a></span>: Bugfixes for putting secrets. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6956\" onclick=\"get_ticket_and_populate_wrapper('6956'); return false;\" title='\"Match password auth\" for schedds'>#6956</a></span> - Make sure we always include the secrets for the start private ad. - Make sure we log whether the collector stripped out the secrets. - Only trust 8.9.3 collectors, not 8.9.2. This change is because the branch was merged later than expected.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Mar-28 20:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56466\">[56466]</a></span>: Fixup: correct constant name. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6956\" onclick=\"get_ticket_and_populate_wrapper('6956'); return false;\" title='\"Match password auth\" for schedds'>#6956</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Mar-27 23:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56458\">[56458]</a></span>: Have the matchmaker use schedd capabilities. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6956\" onclick=\"get_ticket_and_populate_wrapper('6956'); return false;\" title='\"Match password auth\" for schedds'>#6956</a></span> Changes the matchmaker to look at the submitter ads for any provided capabilities. If found, we use those instead of negotiating a new security session with the remote schedd.\u00a0[...]\n (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Mar-27 23:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56457\">[56457]</a></span>: Have the schedd create a capability for negotiation. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6956\" onclick=\"get_ticket_and_populate_wrapper('6956'); return false;\" title='\"Match password auth\" for schedds'>#6956</a></span> This causes the schedd to create a capability, good for a remote host to negotiate with it, and adds it into the submitter ads.\u00a0[...]\n (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Mar-27 23:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56456\">[56456]</a></span>: Speed up filtering of private ads. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6956\" onclick=\"get_ticket_and_populate_wrapper('6956'); return false;\" title='\"Match password auth\" for schedds'>#6956</a></span> Now that the collector always filters private attributes from ads when sending to remote clients, we should make sure this is not too expensive.\u00a0[...]\n (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Mar-27 23:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56455\">[56455]</a></span>: Always filter out private attributes. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6956\" onclick=\"get_ticket_and_populate_wrapper('6956'); return false;\" title='\"Match password auth\" for schedds'>#6956</a></span> Make sure we always filter out private attributes when sending ads to/from the collector - except when we know it is safe (such as when there is a startd private ad or a newer build of HTCondor that will perform the filtering).  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Aug-02 09:11", "status": "resolved", "created": "2019-Mar-13 23:15", "fixed_version": "2019-Mar-13 23:15", "broken_version": "", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "bbockelm", "derived_from": "#6947", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bbockelman@morgridge.org tannenba@cs.wisc.edu tlmiller@cs.wisc.edu", "due_date": ""}