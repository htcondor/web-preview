{"id": 7889, "title": "Ticket #7889: credd sends hup to krb credmon, not oauth, for local issuer scitokens", "description": "<blockquote>\nAfter changing the code for 8.9.9 to add plumbing for locally issued credentials, I realized the credd is attempting to send the sighup to the Kerberos <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CredMon\" title=\"Cred Mon\">CredMon</a></span> and not the OAuth Credmon.\n\n<p>This can be worked around in the config by setting\n</p><div class=\"code\">\n<pre class=\"code\">SEC_CREDENTIAL_DIRECTORY_KRB = $(SEC_CREDENTIAL_DIRECTORY_OAUTH)\n</pre></div>\n\nThis causes the credd to pick up the <code>pid</code> file from the OAuth directory and <code>SIGHUP</code> it correctly.\n\n<p>Code change is to fix the code path that does the \"magic\" <code>LOCAL:scitokens</code> store cred via krb mechanism to also realize it should <code>HUP</code> the OAuth <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CredMon\" title=\"Cred Mon\">CredMon</a></span>, not the Kerberos Credmon.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Nov-02 16:18:24 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong>: after a KRB_STORE_CRED returns is_local at around line 1450, the mode is changed to <code>STORE_CRED_USER_OAUTH</code> with the intent of changing which credmon is kicked, but this should happen only when the KRB_STORE_CRED is successful, otherwise the error check/reporting may not work correctly.\n\n<p></p><hr/>\n<em>2020-Nov-06 13:48:02 by zmiller:</em> <br/>\n\nJust committed code addressing the review, please have another look and sign off if we're good.\n\n<p></p><hr/>\n<em>2020-Nov-11 10:46:55 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong> looks good.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Nov-23 10:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61724\">[61724]</a></span>: Version history from OAuth credmon signalling bug. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7889\" title=\"credd sends hup to krb credmon, not oauth, for local issuer scitokens\">#7889</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Nov-06 13:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61616\">[61616]</a></span>: Address code review issues <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7889\" title=\"credd sends hup to krb credmon, not oauth, for local issuer scitokens\">#7889</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Nov-02 15:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61597\">[61597]</a></span>: For \"LOCAL\" credentials, signal the OAuth credmon and not the KRB credmon. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=7889\" title=\"credd sends hup to krb credmon, not oauth, for local issuer scitokens\">#7889</a></span>  (By zmiller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Nov-11 10:52", "status": "resolved", "created": "2020-Oct-29 14:55", "fixed_version": "2020-Oct-29 14:55", "broken_version": "v080909", "priority": "2", "subsystem": "Security", "assigned_to": "zmiller", "derived_from": "#7885", "creator": "zmiller", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "zmiller@cs.wisc.edu", "due_date": ""}