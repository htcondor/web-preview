{"id": 5652, "title": "Ticket #5652: suggested security metaknob", "description": "<blockquote>\nHere is my condor_config common to all hosts\n\n<p></p><pre>  use SECURITY:HOST_BASED\n  NEMO_SUBNET = 192.168.0.0/21\n  ALLOW_READ  = $(NEMO_SUBNET)\n  BIND_ALL_INTERFACES = False\n  NETWORK_INTERFACE   = 192.168.*\n  PRIVATE_NETWORK_NAME      = NEMONET\n  PRIVATE_NETWORK_INTERFACE = 192.168.*\n  DEFAULT_DOMAIN_NAME  = nemo.phys.uwm.edu\n  UID_DOMAIN           = nemo.phys.uwm.edu\n  FILESYSTEM_DOMAIN    = nemo.phys.uwm.edu\n  CONDOR_HOST = condorcm.nemo.phys.uwm.edu\n</pre>\n\n<p>Some of these aren't strictly security settings. And the only thing I need to do for it to work is to add this to my central manager config:\n\n</p><p></p><pre>  ALLOW_WRITE = $(ALLOW_WRITE) $(NEMO_SUBNET)\n</pre>\n\n<p>You might consider a \"security:PRIVATE_NETWORK_HOST_BASED\" metaknob that could condense this configuration down to 5 lines:\n\n</p><p></p><pre>  use SECURITY:PRIVATE_NETWORK_HOST_BASED\n  PRIVATE_NETWORK = 192.168.0.0/21\n  PRIVATE_NETWORK_NAME = NEMONET\n  PRIVATE_NETWORK_DOMAIN = nemo.phys.uwm.edu\n  CONDOR_HOST = condorcm.nemo.phys.uwm.edu\n</pre>\n\n<p>On the submit node, the metaknob would add\n\n</p><p></p><pre>  ALLOW_READ = $(PRIVATE_NETWORK)\n  BIND_ALL_INTERFACES = False\n  NETWORK_INTERFACE   = $(PRIVATE_NETWORK)\n  PRIVATE_NETWORK_INTERFACE = $(PRIVATE_NETWORK)\n  DEFAULT_DOMAIN_NAME  = $(PRIVATE_NETWORK_DOMAIN)\n  UID_DOMAIN           = $(PRIVATE_NETWORK_DOMAIN)\n  FILESYSTEM_DOMAIN    = $(PRIVATE_NETWORK_DOMAIN)\n</pre>\n\n<p>In principle, you might combine PRIVATE_NETWORK_DOMAIN and PRIVATE_NETWORK_NAME. On the manager node, the metaknob would also add this\n\n</p><p></p><pre>  ALLOW_WRITE = $(ALLOW_WRITE) $(PRIVATE_NETWORK)\n</pre>\n\n<p>You would also need NETWORK_INTERFACE and PRIVATE_NETWORK_INTERFACE to support CIDR notation.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Feb-20 14:11:14 by johnkn:</em> <br/>\n\nIn 8.6, metaknobs allow arguments, and they can be optional  So how about something like this:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">use SECURITY : HOST_BASED_PRIVATE_NETWORK(192.168.0.0/21)</pre></div>\n\n  or\n<div class=\"code\">\n<pre class=\"code\">use SECURITY : HOST_BASED_PRIVATE_NETWORK(192.168.0.0/21, NEMONET)</pre></div>\n\n\n<p>which would expand to\n\n</p><p></p><div class=\"snip\">\n<pre class=\"sniplabel\">SECURITY : HOST_BASED_PRIVATE_NETWORK metaknob definition</pre>\n<pre class=\"snip\">use SECURITY : HOST_BASED\nALLOW_WRITE = $(1) $(ALLOW_WRITE)\nALLOW_READ = $(1)\nBIND_ALL_INTERFACES = false\nif $(2?)\n   PRIVATE_NETWORK_INTERFACE = $(1)\n   PRIVATE_NETWORK_NAME = $(2)\n   # set this just so that we can easily reference the private network ip range in other config knobs.\n   $(2)_SUBNET = $(1)\nendif\n</pre></div>\n\n\n<p>Perhaps also changing the definition of the HOST_BASED metaknob to\n</p><div class=\"snip\">\n<pre class=\"sniplabel\">SECURITY : HOST_BASED metaknob definition</pre>\n<pre class=\"snip\">ALLOW_ADMINISTRATOR=$(CONDOR_HOST)\nif $(1?)\n  ALLOW_OWNER=$(1)\n  ALLOW_READ=$(1)\n  ALLOW_WRITE=$(1)\n  ALLOW_NEGOTIATOR=$(1)\nelse\n  ALLOW_OWNER=$(FULL_HOSTNAME) $(IPV4_ADDRESS) $(IPV6_ADDRESS)\n  ALLOW_READ=*\n  ALLOW_WRITE=$(FULL_HOSTNAME) $(IPV4_ADDRESS) $(IPV6_ADDRESS)\n  ALLOW_NEGOTIATOR=$(CONDOR_HOST)\nendif\nALLOW_NEGOTIATOR_SCHEDD=$(ALLOW_NEGOTIATOR) $(FLOCK_NEGOTIATOR_HOSTS)\nALLOW_WRITE_COLLECTOR=$(ALLOW_WRITE) $(FLOCK_FROM)\nALLOW_WRITE_STARTD=$(ALLOW_WRITE) $(FLOCK_FROM)\nALLOW_READ_COLLECTOR=$(ALLOW_READ) $(FLOCK_FROM)\nALLOW_READ_STARTD=$(ALLOW_READ) $(FLOCK_FROM)\n</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "todo", "last_change": "2017-Feb-20 14:11", "status": "defer", "created": "2016-Apr-27 17:23", "fixed_version": "2016-Apr-27 17:23", "broken_version": "v080503", "priority": "5", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "tpdownes", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pcouvare@caltech.edu", "due_date": ""}