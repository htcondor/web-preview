{"id": 4660, "title": "Ticket #4660: Add sub-second accurate timestamps to dprintf logs", "description": "<blockquote>\nIt would be very helpful when analyzing logs to have the option for sub-second accurate dprintfs.  Also, less important but still valuable would be the ability to drop a stacktrace at into the dprintf log.\n\n<p>This will implemented by adding two new flags for the dprintf logs.\n\n</p><p></p><ul>\n<li><code>D_SUB_SECOND</code> will cause fraction values to be printed after the seconds field in the timestamp.\n\n<p></p></li><li><code>D_TIMESTAMP</code> will cause unix epoch time to b printed instead of human readable time. The old <code>LOG_USE_TIMESTAMPS</code> config knob will turn this flag on for all log files.\n\n<p></p></li><li><code>D_BACKTRACE</code> will cause \"(bt:hash:depth)\" to be printed before the dprintf message, and the first time that the \"hash\" value occurs, a stack backtrace will follow the current message.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2014-Dec-22 18:39:51 by smoler:</em> <br/>\n\nThis ticket needs to remain in doc pending state until all the new features are documented.  Version history appears to mention only part of the new-ness.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-22 18:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=42020\">[42020]</a></span>: Edit existing 8.3.2 version history items for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4603\" title=\"DAEMON_SOCKET_DIR=auto breaks partial use of shared port\">#4603</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4657\" title=\"Support EC2 block-device mapping.\">#4657</a></span>, and <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4660\" title=\"Add sub-second accurate timestamps to dprintf logs\">#4660</a></span>. Add new version history items for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=374\" title=\"dlopen Kerberos\">#374</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4735\" title=\"Speed up V3 query protocol\">#4735</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4594\" title=\"Fix time-slicing for ClassAd iterator\">#4594</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4491\" title=\"Scalable claim keepalive protocol\">#4491</a></span>, and <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4585\" title=\"Detect SO version of libraries we dlopen() at compile time\">#4585</a></span>.  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-22 10:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=42003\">[42003]</a></span>: document new dprintf flags D_TIMESTAMP, D_SUB_SECOND <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4660\" title=\"Add sub-second accurate timestamps to dprintf logs\">#4660</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-22 10:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=42001\">[42001]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4645\" title=\"Stats publication should be configurable using a whitelist\">#4645</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4593\" title=\"Use Miron probes for DC runtime statistics\">#4593</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4595\" title=\"Add DC stats for fsync, DNS &amp; prio-rec array runtime\">#4595</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4660\" title=\"Add sub-second accurate timestamps to dprintf logs\">#4660</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-01 20:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41559\">[41559]</a></span>: fix <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4660\" title=\"Add sub-second accurate timestamps to dprintf logs\">#4660</a></span> to only try and get Windows 8.0 function addresses once. ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-24 13:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41478\">[41478]</a></span>: add D_SUB_SECOND, D_TIMESTAMP &amp; D_BACKTRACE header flags for dprintf. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4660\" title=\"Add sub-second accurate timestamps to dprintf logs\">#4660</a></span> ===VersionHistory:Pending=== Committer: Todd L Miller  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-24 13:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41480\">[41480]</a></span>: use CLOCK_REALTIME_COARSE for D_SUB_SECOND logs if it is available <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4660\" title=\"Add sub-second accurate timestamps to dprintf logs\">#4660</a></span> it's about 8x faster than CLOCK_REALTIME and still accurate to the millisecond Committer: Todd L Miller  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-16 13:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41400\">[41400]</a></span>: use CLOCK_REALTIME_COARSE for D_SUB_SECOND logs if it is available <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4660\" title=\"Add sub-second accurate timestamps to dprintf logs\">#4660</a></span> it's about 8x faster than CLOCK_REALTIME and still accurate to the millisecond  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-15 15:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=41398\">[41398]</a></span>: add D_SUB_SECOND, D_TIMESTAMP &amp; D_BACKTRACE header flags for dprintf. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=4660\" title=\"Add sub-second accurate timestamps to dprintf logs\">#4660</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Dec-23 16:32", "status": "resolved", "created": "2014-Oct-15 15:32", "fixed_version": "2014-Oct-15 15:32", "broken_version": "", "priority": "3", "subsystem": "Libs", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}