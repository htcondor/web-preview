{"id": 5477, "title": "Ticket #5477: Don't run POST script if PRE script fails?", "description": "<blockquote>\nJust had a phone conversation with Miron, and he is not happy with the \"POST script runs if PRE script fails\" semantics of DAGMan.\n\n<p>Note that there's a config knob for this (DAGMAN_ALWAYS_RUN_POST) so if just we want to change the default, the fix is very simple.\n\n</p><p>(The main issue with this is whether it will cause problems for any users -- I need to check about that.)</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Feb-17 12:30:40 by wenger:</em> <br/>\n\nCreated V8_5-gittrac_5477-branch for this.\n\n<p></p><hr/>\n<em>2016-Feb-17 12:34:43 by wenger:</em> <br/>\n\nNote that this will probably make some DAGMan tests fail.\n\n<p>Also, there will need to be changes to the DAGMan section of the manual.\n\n</p><p></p><hr/>\n<em>2016-Feb-17 15:18:48 by wenger:</em> <br/>\n\nJust sent out an email to htcondor-users to see if anyone objects to this change.\n\n<p></p><hr/>\n<em>2016-Mar-22 13:39:51 by wenger:</em> <br/>\n\nI have this all working for most platforms, but some tests are failing on Windows (I think because I don't have some of the latest test fixes for Windows).  So I'm going to create a new branch (V8_5-gittrac_5477_2-branch) from master, merge V8_5-gittrac_5477-branch to it, and go from there...\n\n<p></p><hr/>\n<em>2016-Mar-30 13:51:00 by wenger:</em> <br/>\n\nNotes from code review w/ Zach:\n<ul>\n<li>Make it an error if both -DontAlwaysRunPost and -AlwaysRunPost are specified on the command line.\n</li><li>Make a ticket to create a new test for the POST script <strong>not</strong> getting run if the PRE script fails.\n</li><li>We debated somewhat whether this should be a shallow or deep option (agreed that deep is better in <strong>most</strong> cases, but has the disadvantage that you can't always do what you want; whereas if it's shallow you <strong>can</strong> always do what you want).\n</li></ul>\n\n<p></p><hr/>\n<em>2016-Apr-01 15:38:45 by wenger:</em> <br/>\n\nThis is now merged to master based on verbal okay from Zach on Wednesday.  Zach -- please mark this as reviewed...\n\n<p></p><hr/>\n<em>2016-Apr-04 15:10:48 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>:  Looks good.  All my previous concerns were addressed.</blockquote>", "derived_tickets": "", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/929/gt_5477_dif\">gt_5477_dif</a>\n16523 bytes added by wenger on 2016-Mar-22 18:41:30 UTC.\n<br/>\nOkay, these are all of the changes on the original feature branch (V8_5-gittrac_5477-branch).<br/>\n</li><li><a href=\"attach_get/931/gt5477-2_dif\">gt5477-2_dif</a>\n16120 bytes added by wenger on 2016-Mar-25 16:15:46 UTC.\n<br/>\nHere's a diff of everything on the V8_5-gittrac_5477_2-branch.<br/>\n</li><li><a href=\"attach_get/932/gt5477-3_dif\">gt5477-3_dif</a>\n19954 bytes added by wenger on 2016-Apr-01 17:58:29 UTC.\n<br/>\nHere's a diff of everything on the branch after post-code review fixes.<br/>\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Apr-01 12:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48150\">[48150]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5477\" onclick=\"get_ticket_and_populate_wrapper('5477'); return false;\" title=\"Don't run POST script if PRE script fails?\">#5477</a></span>: Fixes from code review: we now fail if -AlwaysRunPost and -DontAlwaysRunPost are both set; improved how command-line flags work in conjunction with non-default config setting; a few test cleanups.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-25 11:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48114\">[48114]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5477\" onclick=\"get_ticket_and_populate_wrapper('5477'); return false;\" title=\"Don't run POST script if PRE script fails?\">#5477</a></span>: Removed temporary comment -- job_dagman_prepost worked okay on Fedora22 on my last build/test.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-22 14:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48083\">[48083]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=47613\">[47613]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=47661\">[47661]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=47663\">[47663]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=47664\">[47664]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=47665\">[47665]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=47688\">[47688]</a></span>, Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5477\" onclick=\"get_ticket_and_populate_wrapper('5477'); return false;\" title=\"Don't run POST script if PRE script fails?\">#5477</a></span>: Merged V8_5-gittrac_5477-branch to V8_5-gittrac_5477_2-branch, fixed problem in job_dagman_always_run_post-A test, and fixed version history.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-09 16:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47688\">[47688]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5477\" onclick=\"get_ticket_and_populate_wrapper('5477'); return false;\" title=\"Don't run POST script if PRE script fails?\">#5477</a></span>: Added version history item (not in the right section yet); a little more documentation cleanup.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-02 11:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47665\">[47665]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5477\" onclick=\"get_ticket_and_populate_wrapper('5477'); return false;\" title=\"Don't run POST script if PRE script fails?\">#5477</a></span>: A bunch of documentation updates related to this change, including some general cleanup of the PRE/POST script documentation.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-01 12:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47664\">[47664]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5477\" onclick=\"get_ticket_and_populate_wrapper('5477'); return false;\" title=\"Don't run POST script if PRE script fails?\">#5477</a></span>: Added note about switching node result tables, etc. in DAGMan docs.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-01 11:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47663\">[47663]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5477\" onclick=\"get_ticket_and_populate_wrapper('5477'); return false;\" title=\"Don't run POST script if PRE script fails?\">#5477</a></span>: Added note that job_dagman_prepost failed on Fedora 22 build/test.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Feb-29 16:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47661\">[47661]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5477\" onclick=\"get_ticket_and_populate_wrapper('5477'); return false;\" title=\"Don't run POST script if PRE script fails?\">#5477</a></span>: Added -AlwaysRunPost argument to condor_dagman and condor_submit_dag; changed job_dagman_always_run_post-A test to use it; some doc changes.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Feb-17 13:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47613\">[47613]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5477\" onclick=\"get_ticket_and_populate_wrapper('5477'); return false;\" title=\"Don't run POST script if PRE script fails?\">#5477</a></span>: Changed DAGMAN_ALWAYS_RUN_POST default to false; going to do a build/test and see what tests fail...  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Jun-01 15:53", "status": "resolved", "created": "2016-Jan-14 12:13", "fixed_version": "2016-Jan-14 12:13", "broken_version": "v080501", "priority": "3", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, miron@cs.wisc.edu, zmiller@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}