{"id": 3822, "title": "Ticket #3822: param substitution does not honor per-daemon overrides", "description": "<blockquote>\nWhen a param references another param, it does not honor per-daemon overrides.  so if the param system contains:\n<div class=\"code\">\n<pre class=\"code\">foo = 1\nbar = $(foo) + 1\nmaster.foo = 2\n</pre></div>\n\nthe result of param(\"bar\") should be <code>\"1 + 1\"</code> genericaly and \"2 + 1\"= for master, but the result is =\"1 + 1\" for everyone.</blockquote>", "remarks": "<blockquote>\n<em>2013-Jul-30 09:09:41 by johnkn:</em> <br/>\n\nthis seems to be the underlying cause for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3196\" title=\"SPOOL is wrong with multiple schedds\">#3196</a></span>\n\n<p></p><hr/>\n<em>2013-Jul-30 09:11:24 by johnkn:</em> <br/>\n\nnote that <span class=\"chng\"><a href=\"chngview?cn=37028\">[37028]</a></span> fixes the problem for per-daemon overrides, but not for local-name overrides.  A more complete fix is needed.  also the fix should be cherry-picked back to 8.0 branch for inclusion in 8.0.2\n\n<p></p><hr/>\n<em>2013-Aug-18 21:24:55 by bbockelm:</em> <br/>\n\nHi TJ,\n\n<p>This commit introduced an infinite loop at our site with our production configs.  It appears that this evaluates differently now:\n\n</p><p></p><div class=\"verbatim\">\n<pre>FOO = baz\nSCHEDD.FOO = $(FOO), bar\n</pre></div>\n\n\n<p>Previously, this evaluated to \"baz, bar\"; now, this causes an infinite loop.\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2013-Aug-19 10:38:42 by tannenba:</em> <br/>\n\n^^^ This exact config that Brian posted should be added as a regression test for the config system.  Would be trivial to add a few regression tests in this area, just add some entries into a config file and run condor_config_val.\n\n<p></p><hr/>\n<em>2013-Aug-21 11:04:34 by johnkn:</em> <br/>\n\nwith <span class=\"chng\"><a href=\"chngview?cn=37299\">[37299]</a></span>, param parsing will now handle\n<div class=\"code\">\n<pre class=\"code\">FOO = bar\nMASTER.FOO = $(FOO), baz\n</pre></div>\n\nin a way that is consistent with v8.0.x for the master and for other daemons <strong>if there is no prior definition of MASTER.FOO</strong>.\n\n<p>However\n</p><div class=\"code\">\n<pre class=\"code\">FOO = bar\nMASTER.FOO = mike\nMASTER.FOO = $(FOO), baz\n</pre></div>\n\nwill produce different results for the master between 8.1.1 and prior versions.\n\n<p>for the 8.1.1 master, <code>param(\"FOO\")</code> will return <code>\"mike, baz\"</code>\n\n</p><p>for the 8.0.x master, <code>param(\"FOO\")</code> will return <code>\"bar, baz\"</code>\n\n</p><p></p><hr/>\n<em>2013-Aug-27 13:57:55 by bt:</em> <br/>\n\nThe more compound  testing which led to an infinate loop has been added as a third check(making 4 counting basic 'it runs' check ) in job_basic_param_config_check.run.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Sep-12 11:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37567\">[37567]</a></span>: Small edit to 8.1.1 version history item. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3822\" title=\"param substitution does not honor per-daemon overrides\">#3822</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Sep-11 16:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37554\">[37554]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3822\" title=\"param substitution does not honor per-daemon overrides\">#3822</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-26 12:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37350\">[37350]</a></span>: for 8.1.1, state how use of &lt;SUBSYS&gt;.macro prefix interacts with use of the macro in subsequent macros, which changes for 8.1.1 ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3822\" title=\"param substitution does not honor per-daemon overrides\">#3822</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-26 12:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37348\">[37348]</a></span>: in V8_0-branch, explicitly state how combining the use of a configuration macro interacts with the &lt;SUBSYS&gt;.macroname feature ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3822\" title=\"param substitution does not honor per-daemon overrides\">#3822</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-20 17:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37309\">[37309]</a></span>: fix sorting of static param table for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3821\" title=\"convert param_info.in to static const data with binary lookup\">#3821</a></span> so sort is case-insensitive. also fix lookup of int, bool &amp; double params to honor static per-daemon overrides. <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3822\" title=\"param substitution does not honor per-daemon overrides\">#3822</a></span> ===VersionHistory:None=== bugs never shipped.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-20 13:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37299\">[37299]</a></span>: fix <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3822\" title=\"param substitution does not honor per-daemon overrides\">#3822</a></span> to recognise param self-reference between param and subsys.param lack of this caused \"$(subsys.foo) = $(foo)\" to expand forever. ===VersionHistory:None=== bug never shipped.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jul-29 01:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37028\">[37028]</a></span>: fix for <span class=\"ticket\"><a class=\"resolved\" href=\"tktview?tn=3822\" title=\"param substitution does not honor per-daemon overrides\">#3822</a></span>, param substitution doesn't honor per-daemon overrides. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Sep-13 10:20", "status": "resolved", "created": "2013-Jul-28 12:55", "fixed_version": "2013-Jul-28 12:55", "broken_version": "v080000", "priority": "3", "subsystem": "Libs", "assigned_to": "johnkn", "derived_from": "#3820", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}