{"id": 2890, "title": "Ticket #2890: BOSCO shell independent setup", "description": "<blockquote>\nAfter usability test by Alain became evident that users don't know which shell they use and need a single setup file.\n\n<p>Users will type <code>source ~/bosco/boscosetup</code>\n\n</p><p>This will use 3 files:\n</p><ul>\n<li>boscosetup - shell independent script\n</li><li>shellselector - detects the shell used and selects the appropriate setup file\n</li><li>shell dependent setup file (sh/csh version provided)\n</li></ul>\n\n<p>boscosetup will be something like:\n</p><div class=\"code\">\n<pre class=\"code\"># shell independent setup\n# replace the installation directory (default is $HOME/bosco)\nsource $HOME/bosco/bosco.`$HOME/bosco/shellselector -q`\n</pre></div>\n\n\n<p>shellselector is:\n</p><div class=\"code\">\n<pre class=\"code\">#!/bin/bash\n# shellselector by Marco Mambelli, marco@hep.uchciago.edu\n# Expects the parent process to be a shell and provides its name\n# Used to select a shell dependent setup from an insependent one:\n# source setup.`./shellselector -q`\n# Without \"-q\" it prints informations about the shell detected\n#\n# Test show that $SHELL is unreliable\n# Current shell is preferrable to the login shell\n#\nif [ \"X${1}X\" == \"X-hX\" ]\nthen\n echo \"$0 [-h|-q]\"\n echo \"         detects a shell and shell family\"\n echo \" -h      prints this help message\"\n echo \" -q      quiet, prints only the shell family (sh or csh)\"\n exit\nfi\n\nMYSHELL=\"`ps -o ppid= -p $$ | xargs ps -o comm= -p `\"\n# change the case statement below to have different setup files for ksh or zsh\ncase \"$MYSHELL\" in\n bash|sh) SHELLFAM=\"sh\";;\n ksh) SHELLFAM=\"sh\";;\n zsh) SHELLFAM=\"sh\";;\n tcsh|csh) SHELLFAM=\"csh\";;\n *) if [ \"X${1}X\" == \"X-qX\" ]\n    then SHELLFAM=\"sh\"\n    else echo \"Unknown shell $MYSHELL\"; exit 1\n    fi;;\nesac\nif [ \"X${1}X\" == \"X-qX\" ]\nthen echo \"$SHELLFAM\"\nelse echo \"Your shell is $MYSHELL, of type $SHELLFAM\"\nfi\n</pre></div>\n\n\n<p>bosco.sh and bosco.csh are generated at the installation\n\n</p><p>This code has been tested.\nIt has to be added to the release</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Mar-19 15:14:58 by marco:</em> <br/>\n\nThis is an additional modification of the setup scripts.\n\n<p>The usability test showed a problem on clusters with multiple hosts behind balancing.\nThe solution here takes care of that checking if the setup is sourced on the host where the install script was launched.\nThere is a new script checking that and the 2 setup scripts are modified. All 3 follow here.\nI don't know exactly how bosco.sh (condor.sh) or bosco.csh (condor.csh) are created so I did not modify the source code.\n\n</p><p>An alternative could be to modify bosco.sh and bosco.csh to include the content of bosco_check_host.\nI have no preference between the 2 options.\n\n</p><p>bosco_check_host:\n</p><div class=\"code\">\n<pre class=\"code\">#!/bin/bash\n# checks that a directory ~/bosco/local.$HOST exists\n# to verify that bosco has been installed on the correct host\ninstall_host=`ls -d $HOME/bosco/local.* | xargs basename | cut -f2 -d.`\ncurrent_host=`hostname | cut -f1 -d.`\necho \"Here $install_host and are on $current_host\"\nif [ \"$install_host\" != \"$current_host\" ]; then\n    echo \"Bad host. You installed BOSCO on $install_host and are on $current_host.\" &gt;&amp;2\n    exit 1\nfi\n</pre></div>\n\n\n<p>bosco.sh (I added few lines on top):\n</p><div class=\"code\">\n<pre class=\"code\"># The script should be sourced by /bin/sh or similar\n/share/home/marco/bosco/bosco_check_host\nif [ $? -ne 0 ]; then return 1\nfi\nCONDOR_CONFIG=\"/share/home/marco/bosco/etc/condor_config\"\nexport CONDOR_CONFIG\nPATH=\"/share/home/marco/bosco/bin:/share/home/marco/bosco/sbin:$PATH\"\nexport PATH\n</pre></div>\n\n\n<p>bosco.csh (I added few lines on top):\n</p><div class=\"code\">\n<pre class=\"code\"># The script should be sourced by /bin/csh or similar\n/share/home/marco/bosco/bosco_check_host\nif ( $? != 0 ) then\n    exit 1\nendif\nsetenv CONDOR_CONFIG \"/share/home/marco/bosco/etc/condor_config\"\nsetenv PATH \"/share/home/marco/bosco/bin:/share/home/marco/bosco/sbin:$PATH\"\n</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-19 15:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/181fc4d25f980966a0c0eb746fda8c9bceff07c6\">[30968]</a></span>: Create a unified source script for all shells. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2890\" onclick=\"get_ticket_and_populate_wrapper('2890'); return false;\" title=\"BOSCO shell independent setup\">#2890</a></span> To set up their environment, the user executes \"source ~/bosco/bosco_setenv\", no matter what shell they're using. This file makes use of the new script shellselector to determine the actual file to source (bosco.sh or bosco.csh).\u00a0[...]\n (By Marco Mambelli )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-Sep-25 17:23", "status": "resolved", "created": "2012-Mar-14 10:53", "fixed_version": "2012-Mar-14 10:53", "broken_version": "", "priority": "4", "subsystem": "Unknown", "assigned_to": "marco", "derived_from": "", "creator": "marco", "rust": "", "customer_group": "other", "visibility": "public", "notify": "jfrey@cs.wisc.edu, marco@hep.uchicago.edu,", "due_date": ""}