{"id": 3285, "title": "Ticket #3285: Add new tool for cluster summaries", "description": "<blockquote>\nI've found condor_status less useful over time (as our cluster grows and when we switched to p-slots) - I think we're at a point where a new tool would be beneficial.\n\n<p>When I use \"condor_status\", I use it as a mechanism to get an overview of my pool.  I often have the following questions about the basic dimensions of the poool:\n</p><ul>\n<li>How large is my pool?\n</li><li>How full is my pool?\n</li><li>How busy is the pool?  (I.e., if a slot is claimed, is it also fully utilized by the job?)\nAnd questions about nodes in abnormal state:\n</li><li>Are there idle nodes (in the face of large queues)?\n</li><li>Are there poorly utilized nodes?\n</li></ul>\n\n<p>I claim that for a 100-node cluster using p-slots, condor_status does not provide meaningful answers for any of the above questions.\n\n</p><p>Here are some deficiencies I've noted:\n</p><ol>\n<li>Entirely too verbose for large pools.  Our site is 3k cores and growing.  No human can get process that many lines of output.\n</li><li>Does not take into account the significant differences between p-slots and \"traditional\" slots.\n<ul>\n<li>State, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LoadAv\" title=\"Load Av\">LoadAv</a></span>, Mem, and Activity time have different meanings for p-slots.\n</li></ul>\n</li><li>Does not advertise number of cores in the output.\n</li><li>Uses outdated terminology - \"Machines\" in the summary means \"Slots\".  Slots don't have a significant meaning when the slots are transient.\n</li><li>The \"Name\" column is truncated for every node I own.  I have a 300-character wide terminal, yet the Name is limited to about 30 characters!\n</li><li>The Arch and OS column is the same for every node I own; quite the waste of space.\n</li><li>I can't easily determine if the occupancy rate is reasonable for the current load.  A 50% occupied pool is \"no problem\" if there are no jobs in queue.  There might be a big problem if there are 10k jobs in queue.\n1 No units on memory numbers!\n</li></ol>\n\n<p>I propose we do not touch condor_status - changing output has too high a chance of breaking user scripts.  Instead, I propose we have a new tool - \"condor_pool_summary\" - which addresses the needs of sysadmins (condor_status is plenty powerful for machine-readable needs).  No XML format, no stable output guarantees, maybe limited query semantics, not entirely grep-friendly.  I'd start with Matt's work here: <a class=\"external\" href=\"http://spinningmatt.wordpress.com/2012/10/01/partitionable-slot-utilization/\">http://spinningmatt.wordpress.com/2012/10/01/partitionable-slot-utilization/</a> and extend it in light of the comments above.\n\n</p><p>Here's a draft output:\n\n</p><p></p><div class=\"verbatim\">\n<pre>MACHINE STATES\n              Name  Cpus Avail Util%  Memory Avail Util% Notes\nLinux / x86-64 machines at red.hcc.unl.edu\n     slot1@node064     4     0  100%    9.5G   15M   99%\n     slot1@node065     4     0  100%    9.5G   15M   99%\n     slot1@node066     4     0  100%    9.5G   15M   99%\n     slot1@node067     4     0  100%    9.5G   15M   99%\n     slot1@node068     4     0  100%    9.5G   15M   99%\nLinux / x86-64 machines at sandhills.hcc.unl.edu\n  slot1@red-d11n12    16     1   93%     38G   46M   99%\n  slot1@red-d11n10    16     2   87%     38G   46M   99%\n  slot1@red-d11n11    16     2   87%     38G   46M   99% 2 Retiring\n  slot1@red-d11n13    16     2   87%     38G   46M   99%\n  slot1@red-d11n14    16     2   87%     38G   46M   99% Owner\n  slot1@red-d11n15    16     2   87%     38G  640M   98%\n   slot1@red-d11n1    16     3   81%     38G   46M   99% Draining\nWindows / x86 machines at foo.hcc.unl.edu\n    slot1@red-d9n3    16     2   87%     38G   48M   99%\n    slot1@red-d9n4    16     2   87%     38G   48M   99%\n\nQUEUE SUMMARY:\nScheddCount RunningJobs IdleJobs HeldJobs FlockedJobs\n          5        3000    10000        3         500\n\nNEGOTIATOR SUMMARY:\n- Last negotiation cycle took 5.5 min to complete.  3 submitters on 2 schedds timed-out.\n- 100 nodes and 3200 cores were considered.\n- 10 accounting groups were considered; 5 received new slots.\n\nPOOL SUMMARY\n               Cores Avail Util%  Memory Avail Util% Owner Matched Preempting\nLinux/x86-64     100     4   91%    300G  700M   99%     2       0          0\nWindows/x86       32     4   87%     80G  100M   99%     0       0          0\nTotal            132     8   89%    380G  800M   99%     2       0          0\n</pre></div>\n\n\n<p>Notes:\n</p><ul>\n<li>I didn't bother to make the summary correct - it's a made-up output, don't worry about it.\n</li><li>I would really prefer the utilization numbers to be \"live\" - not the claimed / total, but actual (CPU used by Condor jobs) / (CPU claimed by Condor jobs).  But that might be a bigger project.\n</li><li>Adjust the width of the columns to the size of the data; only truncate when you hit terminal size limits.\n</li><li>Everything gets units and 2 significant figures.\n* The \"Notes\" column denotes states or activities that are not \"Claimed/Busy\" or \"Avail/Idle\".\n</li><li>Group by OS, arch, and domain (if available).  Sort in ascending order of idle slots.\n</li></ul>\n\n<p>Thoughts?  This ticket was derived from a short thread on condor-devel.  Not included in this ticket is Lans's idea to have a tool which can measure expected versus recorded throughput (digging more deeply into the negotiatior / schedd statistics) and TJ's idea to have pre-defined reports for condor_status (and allow the config file to select the default report).  Those can be filed as separate tickets.</p></blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2012-Dec-11 16:40:19 by johnkn:</em> <br/>\n\nBulk change of target version from v070902 to v070903 using ./ticket-target-mover.\n<hr/>\n<em>2013-Jan-22 10:54:51 by johnkn:</em> <br/>\n\nBulk change of target version from v070903 to v070904 using ./ticket-target-mover.\n<hr/>\n<em>2013-Mar-05 10:58:27 by johnkn:</em> <br/>\n\nBulk change of target version from v070904 to v070905 using ./ticket-target-mover.\n<hr/>\n<em>2013-Apr-22 11:10:10 by johnkn:</em> <br/>\n\nBulk change of target version from v070905 to v070906 using ./ticket-target-mover.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=3285\" onclick=\"get_ticket_and_populate_wrapper('3285'); return false;\" title=\"Add new tool for cluster summaries\">#3285</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd new tool for cluster summaries</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2015-Feb-11 20:30", "status": "stalled", "created": "2012-Oct-21 19:56", "fixed_version": "2012-Oct-21 19:56", "broken_version": "", "priority": "5", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "#3285", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu tstclair@redhat.com", "due_date": ""}