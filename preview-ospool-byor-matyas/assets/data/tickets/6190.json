{"id": 6190, "title": "Ticket #6190: Replace Job Router round-robin matching with first match in list", "description": "<blockquote>\nCurrently the job router matches jobs to routes in a round-robin fashion, which results in non-deterministic behavior unless admins write <code>JOB_ROUTER_ENTRIES</code> requirements statements that are mutually exclusive. A quick scan of the CEs in the OSG reporting to the central collector didn't show any CEs that appear to be taking advantage of the round-robin behavior. It's also preventing some use cases: Vanderbilt wants to set up a condor pool on some old nodes but would only want to route jobs to them once the slurm job route fills up, which turns out to be difficult, if not impossible with the round-robin.\n\n<p>I propose that the job router should attempt to match jobs to routes in the order they appear in the <code>JOB_ROUTER_ENTRIES</code>. This is the behavior that admins actually first expect when they first begin configuring the job router.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Mar-28 15:12:43 by jfrey:</em> <br/>\n\nWe can add a new parameter to set the route selection algorithm, either round-robin or first-match. I'm thinking of calling it JOB_ROUTER_ROUND_ROBIN_SELECTION, with a default of True (maintain current behavior). We can consider changing that default. I don't know if there are any users of the Job Router for whom round-robin makes more sense at this point.\n\n<p></p><hr/>\n<em>2017-Mar-31 14:05:35 by jfrey:</em> <br/>\n\nToddT and I agreed that first-match is the better default behavior for the Job Router. I've changed the new config parameter accordingly.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-21 11:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/18e3b139ae6a93f7ef17bb84b823786484fa2e24\">[50535]</a></span>: Docs for JOB_ROUTER_ROUND_ROBIN_SELECTION. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6190\" onclick=\"get_ticket_and_populate_wrapper('6190'); return false;\" title=\"Replace Job Router round-robin matching with first match in list\">#6190</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-31 14:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f86fa18051958f96349310d799df1daabb49c259\">[50385]</a></span>: Change default for JOB_ROUTER_ROUND_ROBIN_SELECTION to false. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6190\" onclick=\"get_ticket_and_populate_wrapper('6190'); return false;\" title=\"Replace Job Router round-robin matching with first match in list\">#6190</a></span> This is the behavior that the primary users of the job router want.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-28 15:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f562bf6e4fe652851bcee21adea0aa9afb4f08ff\">[50367]</a></span>: Add config param to disable round-robin route selection in Job Router <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6190\" onclick=\"get_ticket_and_populate_wrapper('6190'); return false;\" title=\"Replace Job Router round-robin matching with first match in list\">#6190</a></span> New parameter JOB_ROUTER_ROUND_ROBIN_SELECTION (default true) can be set to false to modify the route selection algorithm, so that the first route that matches the job is chosen, instead of trying to round-robin between all matching\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Apr-21 11:19", "status": "resolved", "created": "2017-Mar-14 10:45", "fixed_version": "2017-Mar-14 10:45", "broken_version": "", "priority": "3", "subsystem": "DaemonsCM", "assigned_to": "jfrey", "derived_from": "#4555", "creator": "blin", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "blin@cs.wisc.edu bbocklem@cse.unl.edu", "due_date": ""}