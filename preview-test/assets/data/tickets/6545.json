{"id": 6545, "title": "Ticket #6545: Test GPUsUsage and company with dynamic slots.", "description": "<blockquote>\nThe tests committed in <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6477\" onclick=\"get_ticket_and_populate_wrapper('6477'); return false;\" title=\"Advertise GPU utilization in the same way as CPU utilization\">#6477</a></span> and desired in <span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=6543\" onclick=\"get_ticket_and_populate_wrapper('6543'); return false;\" title=\"Test multiple SUM metrics.\">#6543</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6544\" onclick=\"get_ticket_and_populate_wrapper('6544'); return false;\" title=\"Add GPUsMemoryUsage\">#6544</a></span> are not run against partitionable slots in the test suite.  They need to be.</blockquote>", "remarks": "<blockquote>\n<em>2018-Feb-09 09:52:50 by tlmiller:</em> <br/>\n\nThe commits from Feb 7 run the tests from <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6477\" onclick=\"get_ticket_and_populate_wrapper('6477'); return false;\" title=\"Advertise GPU utilization in the same way as CPU utilization\">#6477</a></span> against dynamic slots.\n\n<p>The tests from <span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=6543\" onclick=\"get_ticket_and_populate_wrapper('6543'); return false;\" title=\"Test multiple SUM metrics.\">#6543</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6544\" onclick=\"get_ticket_and_populate_wrapper('6544'); return false;\" title=\"Add GPUsMemoryUsage\">#6544</a></span> may or may not automatically benefit from this work, depending on how they're implemented.\n\n</p><p>There's some additional work to do to improve testing accuracy as a result of this ticket: if the startd's debug flag includes D_TEST, it should include the sample duration used to compute the usage in each .update.ad write.  The test should report this information to assist in debugging, printing a warning if it's not the expected duration.  (The test may even be able to check if the resulting usage is as would be expected, but since anomalous lengths may also result in extra samples being aggregated, this could be tricky.)\n\n</p><p></p><hr/>\n<em>2018-Feb-09 14:12:46 by tlmiller:</em> <br/>\n\nBugs:\n\n<p></p><ol>\n<li>So it turns out that if you duplicate two different tests, the outputs and logs of their jobs get interleaved.  This causes problems when you check how much output there was.  (While I'm fixing this, I should probably also try to fix the occasional line miscount problem, assuming that it's causes by job outputs stepping on each other.)\n\n<p></p></li><li>Also, if you round in the event log, my test will flag that as an error, because the value in the event log doesn't match the value in condor_history.\n</li></ol>\n\n<p></p><hr/>\n<em>2018-Feb-19 15:06:07 by tlmiller:</em> <br/>\n\nInfrastructure for static vs dynamic slots is now in place, so I'm making a note of this requirement in the other testing tickets and resolving this one.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-10 23:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b2df8b143c9467b04b27e5b5bd6e05a2b92cd214\">[54253]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6545\" onclick=\"get_ticket_and_populate_wrapper('6545'); return false;\" title=\"Test GPUsUsage and company with dynamic slots.\">#6545</a></span>) Compare rounded (truncated?) value from ad to value from user log.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-09 17:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2a62320820f8067cd41200290c23357fd2d2d235\">[54251]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6545\" onclick=\"get_ticket_and_populate_wrapper('6545'); return false;\" title=\"Test GPUsUsage and company with dynamic slots.\">#6545</a></span>) Custom machine resource tests no longer stomp on each other's files.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-07 18:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9323ef15ae0d00f8f3a7828cf550ad4d015bcbee\">[54244]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6545\" onclick=\"get_ticket_and_populate_wrapper('6545'); return false;\" title=\"Test GPUsUsage and company with dynamic slots.\">#6545</a></span>) Make test both more resilient and more forgiving.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-07 15:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a22b638218692d0d0279f7c58330869f80431f2c\">[54243]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6545\" onclick=\"get_ticket_and_populate_wrapper('6545'); return false;\" title=\"Test GPUsUsage and company with dynamic slots.\">#6545</a></span>) Activate the previously-committed test.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-07 15:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4bd79abe23f52fab49f3f3d4ded45acd0a43318f\">[54231]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6545\" onclick=\"get_ticket_and_populate_wrapper('6545'); return false;\" title=\"Test GPUsUsage and company with dynamic slots.\">#6545</a></span>) Repeat the existing cmr-monitor-basic test against a partitionable slot configuration. Move all of the CMR test logic to 'CustomMachineResource.pm' to avoid duplication.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-Mar-09 13:57", "status": "resolved", "created": "2018-Jan-25 19:25", "fixed_version": "2018-Jan-25 19:25", "broken_version": "v080707", "priority": "2", "subsystem": "Tests", "assigned_to": "tlmiller", "derived_from": "#6477", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}