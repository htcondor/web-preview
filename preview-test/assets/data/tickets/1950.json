{"id": 1950, "title": "Ticket #1950: startd can core dump when leaving preempting state", "description": "<blockquote>\nWe observed startd crashes on CHTC while beta testing the v7.5.6 release. This bug may have existed for a long time before v7.5.6 however.\n\n<p><span class=\"quote\">StartLog</span> is below. Problem was leave_preempting_state() deleted the job ad (r_cur) since the starter is gone, and then later on eval_expr() tried to  dereference it while evaluating IS_OWNER. Since IS_OWNER should not need to reference job ad attributes, the patch simply makes eval_expr() evaluate solely in the context of the machine ad if the job ad has already been destroyed.\n\n</p><p></p><div class=\"verbatim\">\n<pre>** Last 20 line(s) of file /var/condor/log/StartLog:\n03/03/11 18:27:04 228843356 kbytes available for \"/var/lib/condor/execute/slot7\"\n03/03/11 18:27:04 228843356 kbytes available for \"/var/lib/condor/execute/slot4\"\n03/03/11 18:27:04 slot4: State change: KILL is TRUE\n03/03/11 18:27:04 slot4: Changing activity: Vacating -&gt; Killing\nStack dump for process 14377 at timestamp 1299198424 (15 frames)\ncondor_startd(dprintf_dump_stack+0x56)[0x5ccc36]\ncondor_startd[0x5ce982]\n/lib64/libpthread.so.0[0x392f80eb10]\ncondor_startd(_ZN8Resource9eval_exprEPKcbb+0x94)[0x4d75b4]\ncondor_startd(_ZN8Resource22leave_preempting_stateEv+0x148)[0x4d7d18]\ncondor_startd(_ZN8ResState12enter_actionE5State8Activitybb+0x3b1)[0x4d6111]\ncondor_startd(_ZN8ResState6changeE5State8Activity+0xe7)[0x4d56a7]\ncondor_startd(_ZN8ResState4evalEv+0x383)[0x4d6603]\ncondor_startd(_ZN6ResMgr4walkEM8ResourceFvvE+0x91)[0x4cff71]\ncondor_startd(_ZN6ResMgr8eval_allEv+0x4e)[0x4d0b5e]\ncondor_startd(_ZN12TimerManager7TimeoutEv+0x155)[0x51c835]\ncondor_startd(_ZN10DaemonCore6DriverEv+0x248)[0x50b2c8]\ncondor_startd(main+0xe47)[0x51aed7]\n/lib64/libc.so.6(__libc_start_main+0xf4)[0x392ec1d994]\ncondor_startd(__gxx_personality_v0+0x3f9)[0x4ca6c9]\n*** End of file StartLog\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Mar-04 15:31:34 by tannenba:</em> <br/>\n\nHad Greg Thain review patch, pushed it to V7_5_6-branch.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Mar-04 15:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9923ec0efcbfaa0a57fbeb982524751298a4f649\">[20928]</a></span>: Fixed startd core dump that could occur when leaving the PREEMPTING state. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1950\" onclick=\"get_ticket_and_populate_wrapper('1950'); return false;\" title=\"startd can core dump when leaving preempting state\">#1950</a></span>  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Mar-04 15:31", "status": "resolved", "created": "2011-Mar-04 15:26", "fixed_version": "2011-Mar-04 15:26", "broken_version": "v070505", "priority": "2", "subsystem": "Daemons", "assigned_to": "tannenba", "derived_from": "", "creator": "tannenba", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "", "due_date": ""}