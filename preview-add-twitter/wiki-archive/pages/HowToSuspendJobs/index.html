<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="HTCondor Homepage">
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/web-preview/preview-add-twitter/assets/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/web-preview/preview-add-twitter/assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/web-preview/preview-add-twitter/assets/images/favicons/favicon-16x16.png">
    <link rel="manifest" href="/web-preview/preview-add-twitter/assets/images/favicons/site.webmanifest">
    <link rel="mask-icon" href="/web-preview/preview-add-twitter/assets/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/web-preview/preview-add-twitter/assets/images/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/web-preview/preview-add-twitter/assets/images/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <!-- Primary Meta Tags -->
    <meta name="title" content="HTCondor">
    <meta name="description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://htcondor.org/">
    <meta property="og:title" content="HTCondor">
    <meta property="og:description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">
    <meta property="og:image" content="https://htcondor.org/assets/images/HTC.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://htcondor.org/">
    <meta property="twitter:title" content="HTCondor">
    <meta property="twitter:description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">
    <meta property="twitter:image" content="https://htcondor.org/assets/images/HTC.png">

    <title>How To Suspend Jobs</title>

    <script src="/web-preview/preview-add-twitter/assets/js/sitewide.js" type="text/javascript" defer></script>
    <script src="/web-preview/preview-add-twitter/assets/js/bootstrap.js" type="text/javascript"></script>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    

    

    <meta name="robots" content="noindex">

    

    <link href="/web-preview/preview-add-twitter/assets/css/style-v1.css" media="screen, tv, projection" title="Default" rel="stylesheet">
    

</head>
<body class="vh-100 d-flex flex-column">

<!-- For non-visual user agents: -->
<a id="skip-link" href="#main-copy">Skip to main content.</a>

<header id="header">
    <div class="mb-4 container">
        <div class="row">
            <div class="col-12">
                <nav class="navbar navBar navbar-expand-lg navbar-light w-100">
                    <a href="/web-preview/preview-add-twitter/index.html" class="d-none d-md-inline"><img height="75" alt="Condor High Throughput Computing" src="/web-preview/preview-add-twitter/assets/images/CondorTitle.png" style="border:0"></a>
                    <a href="/web-preview/preview-add-twitter/index.html" class="d-inline d-md-none"><img height="65" alt="Condor High Throughput Computing" src="/web-preview/preview-add-twitter/assets/images/HTCondor_red_blk.svg" style="border:0"></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mb-2 mb-lg-0 ms-auto mt-auto">
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-add-twitter/">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-add-twitter/new">News</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-add-twitter/downloads">Downloads</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-add-twitter/publications">Publications</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="mailto:htcondor-admin@cs.wisc.edu">Contact Us</a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        <div class="row">
            

<script async src="https://cse.google.com/cse.js?cx=1056a9a876b1d1474"></script>
<div class="gcse-searchbox-only"></div>


        </div>
    </div>
</header>
<main id="main-copy" tabindex="-1">
    <div class="container mb-4">
    <h1>How To Suspend Jobs</h1>
<div id="content">
 <span class="section">
  <h2>
   How to suspend jobs in place of preemption
  </h2>
 </span>
 <p>
  <br/>
  <br/>
 </p>
 <hr/>
 <strong>
  NOTE:
 </strong>
 Current versions of HTCondor include the command-line tool
 <code>
  condor_suspend
 </code>
 to easily suspend jobs. See the
 <a class="external" href="http://research.cs.wisc.edu/htcondor/manual/current/condor_suspend.html">
  condor_suspend manual page
 </a>
 .
 <p>
  <strong>
   The below is kept just for historical purposes
  </strong>
 </p>
 <p>
 </p>
 <hr/>
 <br/>
 <br/>
 <br/>
 <p>
  Known to work with HTCondor version: 7.0
 </p>
 <p>
  HTCondor can suspend a process and then later resume right where it left off.  This is similar to standard universe checkpointing, except it cannot move the suspended job from one machine to another.  The mechanism works with all types of jobs, without any special preparation of the job.
 </p>
 <p>
  There are two cases where you might prefer suspension in place of killing jobs.  One is preemption caused by other activity on the machine (e.g. a user coming back to their desktop).  The other is preemption caused by higher priority jobs getting matched to machines that are already busy.  Both of these cases are covered below.
 </p>
 <p>
  <span class="subsection">
  </span>
 </p>
 <h3>
  How to suspend jobs instead of killing them when higher priority jobs need to run
 </h3>
 <p>
  There is a section in the HTCondor Manual on this topic
  <a class="external" href="http://www.cs.wisc.edu/condor/manual/v7.0/3_5Startd_Policy.html#SECTION00459600000000000000">
   here
  </a>
  .  The example in the manual requires that you divide jobs into two classes: high priority and low priority.  When the high priority jobs arrive on a machine, existing low priority jobs get suspended.
 </p>
 <p>
  Below is an example in which the relative priority of the jobs to be suspended and the other class of jobs is left up to the usual mechanisms of startd RANK and user priority.  You still have to divide the jobs into two classes: normal jobs and those that should be suspended when they are preempted by normal jobs.  This is useful, for example, when you have a special class of jobs which are long running and not checkpointable, but you don't want them to unfairly hog the pool.
 </p>
 <p>
 </p>
 <div class="code">
  <pre class="code"># You may want to advertise double the amount of system memory
# if you have enough virtual memory to allow the foreground job
# to consume all of memory while the suspended job gets pushed
# into swap memory.  There is currently no convenient way to
# tell HTCondor you want to oversubscribe your memory, so you
# have to hard-code the amount of memory you want to advertise
# by uncommenting and filling in the following:
# Memory = TWICE_YOUR_SYSTEM_MEMORY

NUM_CPUS = 2

# So that the suspension slot can see the state
# of the other slot, we need to have some things
# advertised about each slot in the ClassAds of
# all the other slots on the same machine:
STARTD_SLOT_EXPRS = $(STARTD_SLOT_EXPRS) State, CurrentRank

# For informational purposes, put IsSuspensionSlot
# in the startd ClassAd:
STARTD_ATTRS = $(STARTD_ATTRS) IsSuspensionSlot

# Slot 1 is the "normal" batch slot
SLOT1_IsSuspensionSlot = False
# Slot 2 suspends its job, rather than preempting it
SLOT2_IsSuspensionSlot = True


START    = SlotID == 1 &amp;&amp; ($(SLOT1_START)) || \
           SlotID == 2 &amp;&amp; ($(SLOT2_START))
CONTINUE = SlotID == 1 &amp;&amp; ($(SLOT1_CONTINUE)) || \
           SlotID == 2 &amp;&amp; ($(SLOT2_CONTINUE))
PREEMPT  = SlotID == 1 &amp;&amp; ($(SLOT1_PREEMPT)) || \
           SlotID == 2 &amp;&amp; ($(SLOT2_PREEMPT))
SUSPEND  = SlotID == 1 &amp;&amp; ($(SLOT1_SUSPEND)) || \
           SlotID == 2 &amp;&amp; ($(SLOT2_SUSPEND))


# The purpose of the following expression is to prevent a
# job from starting on slot 1 if it has less priority to run
# than the job already running on slot 2, because once we let
# a job run on slot 1, the slot 2 job will be suspended.
# This expression refers to attributes that are only defined
# when requirements are being evaluated by the Negotiator:
# SubmittorPrio [sic] and RemoteUserPrio

SLOT1_HAS_PRIO = SubmittorPrio =?= UNDEFINED || \
                vm2_RemoteUserPrio =?= UNDEFINED || \
                SubmittorPrio &lt; 1.2 * vm2_RemoteUserPrio || \
                vm2_CurrentRank =?= UNDEFINED || \
                MY.Rank &gt; vm2_CurrentRank

# Slot 1 is a normal execution slot
SLOT1_START    = TARGET.IsSuspensionJob =!= true &amp;&amp; ($(SLOT1_HAS_PRIO))
SLOT1_CONTINUE = True
SLOT1_PREEMPT  = False
SLOT1_SUSPEND  = False

# Slot 2 is for jobs that get suspended while slot 1 is busy
SLOT2_START    = TARGET.IsSuspensionJob =?= true
SLOT2_CONTINUE = slot1_State =?= "Unclaimed" || slot1_State =?= "Owner"
SLOT2_PREEMPT  = FALSE
SLOT2_SUSPEND  = slot1_State =?= href="/web-preview/preview-add-twitter/wiki-archive/pages/Claimed" </pre>
 </div>
 <p>
  To submit a suspension job, you could put something like the following in your submit file:
 </p>
 <p>
 </p>
 <div class="code">
  <pre class="code">+IsSuspensionJob = True
requirements = TARGET.IsSuspensionSlot
</pre>
 </div>
 <p>
  The example policy above does not prevent preemption of suspension jobs by other suspension jobs.  It only prevents preemption of suspension jobs by other normal jobs.  If you want to prevent that, you could do something like this:
 </p>
 <p>
 </p>
 <div class="code">
  <pre class="code"># Do not preempt suspension jobs (for up to 24 hours)
MaxJobRetirementTime = (MY.IsSuspensionSlot =?= True) * 3600 * 24
</pre>
 </div>
 <p>
  <span class="subsection">
  </span>
 </p>
 <h3>
  How to suspend jobs instead of killing them when the machine is busy
 </h3>
 <p>
  You just need to make sure WANT_SUSPEND and SUSPEND are true in the cases where you want suspension.  The following example is similar to the default policy that ships in HTCondor's configuration file.  It has been made more aggressive in what types of jobs it suspends (everything) and for how long it suspends them before giving up and killing them.
 </p>
 <p>
 </p>
 <div class="code">
  <pre class="code">KeyboardBusy            = (KeyboardIdle &lt; $(MINUTE))
# Suspend jobs for up to one day
MaxSuspendTime          = (3600 * 24)
ContinueIdleTime        =  60 * $(MINUTE)


# Suspend jobs if:
# 1) the keyboard has been touched, OR
# 2a) The cpu has been busy for more than 2 minutes, AND
# 2b) the job has been running for more than 90 seconds
SUSPEND = ( $(KeyboardBusy) || \
            ( (CpuBusyTime &gt; 2 * $(MINUTE)) \
              &amp;&amp; $(ActivationTimer) &gt; 90 ) )

WANT_SUSPEND = SUSPEND


# Preempt jobs if:
# 1) The job is suspended and has been suspended longer than we want
# 2) OR, we don't want to suspend this job, but the conditions to
#    suspend jobs have been met (someone is using the machine)
PREEMPT = ( ((Activity == "Suspended") &amp;&amp; \
            ($(ActivityTimer) &gt; $(MaxSuspendTime))) \
           || (SUSPEND &amp;&amp; (WANT_SUSPEND == False)) )

CONTINUE = ( $(CPUIdle) &amp;&amp; ($(ActivityTimer) &gt; 10) \
             &amp;&amp; (KeyboardIdle &gt; $(ContinueIdleTime)) )

</pre>
 </div>
</div>

</div>
</main>
<div id="footer" class="border-top mt-auto">
    <div class="container py-4">
        <div class="row">
            <div class="col text-center">
                For comments or questions about this website, please email
                <a href="mailto:htcondor-admin@cs.wisc.edu">htcondor-admin@cs.wisc.edu</a><br />
                This work is supported by <a href="https://www.nsf.gov/div/index.jsp?div=OAC">NSF</a> under Cooperative Agreement <a href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=2030508">OAC-2030508</a> as part of the <a href="https://path-cc.io/">PATh Project</a>. <br />
                <script type="text/javascript">
                    document.write("Updated &raquo; "+lastMod(document.lastModified))
                </script>
            </div>
        </div>
    </div>
</div>



</body>
</html>
