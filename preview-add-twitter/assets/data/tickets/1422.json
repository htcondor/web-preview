{"id": 1422, "title": "Ticket #1422: dagman assertion: (node->_queuedNodeJobProcs >= 0)\" at 3200 dag.cpp", "description": "<blockquote>\nDagman is assertion in the test job_dagman_maxprescripts.  Other dagman tests are failing, I'm guessing in a similar way:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">05/18/10 23:28:17 ReadMultipleUserLogs::readEvent()\n05/18/10 23:28:17 ReadMultipleUserLogs::readEventFromLog(/home/condor/execute/dir_7316/userdir/src/condor_tests/job_dagman_maxprescripts-node.log)\n05/18/10 23:28:17 FileLock::obtain(1) - @1274243297.444082 lock on /home/condor/execute/dir_7316/userdir/src/condor_tests/job_dagman_maxprescripts-node.log now WRITE\n05/18/10 23:28:17 FileLock::obtain(2) - @1274243297.444172 lock on /home/condor/execute/dir_7316/userdir/src/condor_tests/job_dagman_maxprescripts-node.log now UNLOCKED\n05/18/10 23:28:17 Event: ULOG_JOB_TERMINATED for Condor Node NODE14 (178.0.0)\n05/18/10 23:28:17 BAD EVENT: job (178.0.0) ended, submit count &lt; 1 (0)\n05/18/10 23:28:17 BAD EVENT is warning only\n05/18/10 23:28:17 ERROR \"Assertion ERROR on (node-&gt;_queuedNodeJobProcs &gt;= 0)\" at line 3200 in file dag.cpp\n05/18/10 23:28:17 Warning: ReadMultipleUserLogs destructor called, but still monitoring 1 log(s)!\n</pre></div>\n\n\n<p>Note in this case the submission event for job 178 is logged not just after the execute event, but also after the terminate event.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Jun-02 09:06:00 by wenger:</em> <br/>\n\nSo the problem here is that the submit event for job 178 is coming <strong>after</strong> the terminated event (note the timestamps):\n\n<p></p><pre>  001 (178.000.000) 05/18 23:28:13 Job executing on host: &lt;192.168.0.104:40785&gt;\n  005 (178.000.000) 05/18 23:28:15 Job terminated.\n  000 (178.000.000) 05/18 23:28:11 Job submitted from host: &lt;192.168.0.104:59492&gt;\n</pre>\n\n<p>DAGMan can deal with the submit event coming after the execute event, but not after the terminated event.  (Although it just occurred to me that the workaround for this may not work in recovery mode.)  Anyhow, I'm going to argue that the real problem here is the ordering of the events, and that this is a good time to move the writing of the submit event from condor_submit to the schedd (I think the schedd already writes the submit event to the global event log if you have that turned on).\n\n</p><p></p><hr/>\n<em>2010-Jun-02 09:13:44 by wenger:</em> <br/>\n\nNote that this is an <strong>intermittent</strong> failure.\n\n<p></p><hr/>\n<em>2010-Jun-02 10:02:34 by matt:</em> <br/>\n\nWhat use is the submit event to DAGMan, if an execute and/or terminate exists?\n\n<p>Side - since condor_submit writes the submit event does this mean that submit had not returned to condor_dagman here?\n\n</p><p></p><hr/>\n<em>2010-Jul-01 05:55:53 by matt:</em> <br/>\n\nTim setup a Hudson build of the stable series for us. This failure may be intermitent, but it is not rare.\n\n<p></p><div class=\"verbatim\">\n<pre>#50\n.      job_dagman_maxprescripts.run             failed\n\n#57\n.      job_dagman_maxpostscripts.run            failed\n\n#70\n.      job_dagman_maxprescripts.run             failed\n\n#71\n.      job_dagman_maxpostscripts.run            failed\n\n#75\n.      job_dagman_maxprescripts.run             failed\n\n#76\n.      job_dagman_maxprescripts.run             failed\n\n#77\n.      job_dagman_maxprescripts.run             failed\n\n#95\n.      job_dagman_maxprescripts.run             failed\n\n#112\n.      job_dagman_maxpostscripts.run            failed\n</pre></div>\n\n\n<p></p><hr/>\n<em>2013-Feb-11 10:14:51 by nwp:</em> <br/>\n\nIs this still a problem, or should it be abandoned?</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/182/job_dagman_maxprescripts-node.log\">job_dagman_maxprescripts-node.log</a>\n14857 bytes added by gthain on 2010-Jun-02 00:27:38 UTC.\n</li></ul>\n</blockquote></body></html>", "check_ins": "", "type": "defect", "last_change": "2014-May-11 20:59", "status": "stalled", "created": "2010-Jun-01 19:21", "fixed_version": "2010-Jun-01 19:21", "broken_version": "v070400", "priority": "3", "subsystem": "Dag", "assigned_to": "PitS", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com, wenger@cs.wisc.edu", "due_date": ""}