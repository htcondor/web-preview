{"id": 6981, "title": "Ticket #6981: Add non-blocking support for SSL authentication", "description": "<blockquote>\nOne potential future mechanism for using <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span> as an authentication method is to perform an SSL connection (client remains anonymous) and then client writes the token to the server over the encrypted connection.\n\n<p>To do that, however, we need to make SSL a non-blocking authentication method: we effectively can't make a blocking method exposed to the internet.\n\n</p><p>Let's do it!\n\n</p><p>All commits are on branch <strong>V8_9-gt6981</strong></p></blockquote>", "remarks": "<blockquote>\n<em>2019-May-02 11:35:46 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>:  The non-blocking portion looks good on first pass.  However commit <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8a53ea0fe7e3bde24c5fd21e26cd6c5aa3534ac2\">[56604]</a></span> on this branch is a change in behavior that has nothing to do with non-blocking changes as far as I can tell.  It should have a separate ticket and at least a short description of what motivated this change.\n\n<p></p><hr/>\n<em>2019-May-02 15:52:04 by zmiller:</em> <br/>\n\nTicket split to move commit <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8a53ea0fe7e3bde24c5fd21e26cd6c5aa3534ac2\">[56604]</a></span> to separate ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7032\" onclick=\"get_ticket_and_populate_wrapper('7032'); return false;\" title=\"Allow SSL client auth without client cert\">#7032</a></span>.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7145\" onclick=\"get_ticket_and_populate_wrapper('7145'); return false;\" title=\"Memory leak in CEDAR SSL authentication\">#7145</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nMemory leak in CEDAR SSL authentication</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-27 20:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/375756fe4eeb2620930d85ee342129723fbe1ebc\">[56974]</a></span>: Add release note for SSL non-blocking changes. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6981\" onclick=\"get_ticket_and_populate_wrapper('6981'); return false;\" title=\"Add non-blocking support for SSL authentication\">#6981</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-07 04:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fd905850d38893de9f942931aa511b40908eb6dc\">[56768]</a></span>: Bugfix: Avoid double-deleting the BIO object from OpenSSL. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6981\" onclick=\"get_ticket_and_populate_wrapper('6981'); return false;\" title=\"Add non-blocking support for SSL authentication\">#6981</a></span> (cherry picked from commit 27bc78e8dea6fe9a093b3f2ded0f6e23e71f8be3)  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-07 04:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5e22ff6ddb69b4bc6a2fe81fb01c79dbc6b0c7ec\">[56767]</a></span>: Bugfixes of non-blocking SSL. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6981\" onclick=\"get_ticket_and_populate_wrapper('6981'); return false;\" title=\"Add non-blocking support for SSL authentication\">#6981</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-07 04:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f002cc91f164216468013c6fa73039aa73aa47b2\">[56766]</a></span>: Add non-blocking SSL state machine. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6981\" onclick=\"get_ticket_and_populate_wrapper('6981'); return false;\" title=\"Add non-blocking support for SSL authentication\">#6981</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-07 04:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/71666e8b9ad7a16860767ab7233267f3a79ea493\">[56765]</a></span>: Add first layer of non-blocking SSL. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6981\" onclick=\"get_ticket_and_populate_wrapper('6981'); return false;\" title=\"Add non-blocking support for SSL authentication\">#6981</a></span> Always disables non-blocking, but updates the function signatures and state logic.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-07 04:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c3bb18c36d7f234196b9deed79e78da3c4059d62\">[56764]</a></span>: Break SSL server auth into discrete phases. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6981\" onclick=\"get_ticket_and_populate_wrapper('6981'); return false;\" title=\"Add non-blocking support for SSL authentication\">#6981</a></span> This is the first piece of making SSL non-blocking: extract the state into the main class and break the different protocol phases into separate functions. In all cases, however, this actually blocks.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-12 13:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4ff0a28e514edac718ebac795e51743f763302a2\">[56603]</a></span>: Bugfixes of non-blocking SSL. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6981\" onclick=\"get_ticket_and_populate_wrapper('6981'); return false;\" title=\"Add non-blocking support for SSL authentication\">#6981</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-06 16:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/90482e80a7b86066f24050d567c18fa4f5f5bfc5\">[56518]</a></span>: Add first layer of non-blocking SSL. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6981\" onclick=\"get_ticket_and_populate_wrapper('6981'); return false;\" title=\"Add non-blocking support for SSL authentication\">#6981</a></span> Always disables non-blocking, but updates the function signatures and state logic.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-06 16:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/65c5fbbb4012c2ec3aeb321c4456e51e099ea870\">[56519]</a></span>: Add non-blocking SSL state machine. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6981\" onclick=\"get_ticket_and_populate_wrapper('6981'); return false;\" title=\"Add non-blocking support for SSL authentication\">#6981</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-06 16:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1e87a645c8369c9a13fdc89e68abefa977b5a629\">[56517]</a></span>: Break SSL server auth into discrete phases. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6981\" onclick=\"get_ticket_and_populate_wrapper('6981'); return false;\" title=\"Add non-blocking support for SSL authentication\">#6981</a></span> This is the first piece of making SSL non-blocking: extract the state into the main class and break the different protocol phases into separate functions. In all cases, however, this actually blocks.  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-May-27 20:40", "status": "resolved", "created": "2019-Apr-06 16:52", "fixed_version": "2019-Apr-06 16:52", "broken_version": "", "priority": "3", "subsystem": "Security", "assigned_to": "zmiller", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "scitokens", "visibility": "public", "notify": "bbockelman@morgridge.org; tannenba@cs.wisc.edu zmiller@cs.wisc.edu", "due_date": ""}