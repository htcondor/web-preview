{"id": 1370, "title": "Ticket #1370: condor_q and condor_status reports should use -format interface", "description": "<blockquote>\ncondor_q and condor_status have a bunch of code internally to generate the various supported reports.  They read the relevant <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>, and pass them through printf.\n\n<p>A user can reproduce those reports from scratch using -format and -constant, to varying levels of accuracy.  For example <span class=\"wiki\"><a href=\"wiki?p=HowToWriteaCondorqWrapper\" title=\"How To Writea Condorq Wrapper\">HowToWriteaCondorqWrapper</a></span> documents how to <em>almost</em> reproduce the default condor_q report.  Note that it's hard to read (it was hard to write) and it hard codes unsafe assumptions about the possible values of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobStatus\" title=\"Job Status\">JobStatus</a></span>.\n\n</p><p>We have two very different code paths to accomplish the same result.\n\n</p><p>This is bad because redundant code paths bloat our code and create opportunities for bugs to sneak in.  The two code paths can drift so that one might include features not present in the other.  (Today the C-code implements a number of features that are impossible to exactly reproduce in -format commands.)  We can't offer users a starting template if they want to craft their own reports.\n\n</p><p>Proposed: The core of all reports generated by condor_q and condor_status (that is, excluding the headers and footers) should be generated as though by using the -format and -constraint options.\n\n</p><p>This will simplify the code.  This will exercise our -format and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> code to ensure they include functionality we ourselves would want.  It would let us add a \"-dump-command\" option that would output the exact condor_q or condor_status command to replicate the core of the report, giving users a template to start from.\n\n</p><p>This should be approached one report at a time.  I suggest starting with \"condor_status -master\" which can be exactly replicated with\n</p><div class=\"code\">\n<pre class=\"code\">condor_status -format '%s\\n' Machine -master</pre></div>\n\n(It should be possible to replicate using\n<div class=\"code\">\n<pre class=\"code\">condor_status -any -format '%s\\n' Name -constraint \"MyType=='DaemonMaster'\"</pre></div>\n\nbut limitations in how the constraint is done mean it doesn't work.  It should.  See <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=508\" onclick=\"get_ticket_and_populate_wrapper('508'); return false;\" title=\"Cannot use MyType/TargetType in constraints\">#508</a></span> for details.)\n\n<p>After creating the basic glue to make this work at all, then move from report to report, implementing them.  If a given report can't be perfectly implemented, create a ticket documenting the additional functionality needed (ex. <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=1368\" onclick=\"get_ticket_and_populate_wrapper('1368'); return false;\" title=\"New ClassAd function: regex_replace\">#1368</a></span>), and move on to the next report.</p></blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2010-Oct-20 16:03:30 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.\n<hr/>\n<em>2011-Jan-27 14:46:04 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 16:08:44 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2011-Feb-01 16:08", "status": "new", "created": "2010-Apr-21 16:43", "fixed_version": "2010-Apr-21 16:43", "broken_version": "v070400", "priority": "3", "subsystem": "Tools", "assigned_to": "", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}