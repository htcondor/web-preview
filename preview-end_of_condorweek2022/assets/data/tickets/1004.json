{"id": 1004, "title": "Ticket #1004: Condor-C and Nordugrid grid jobs should share job status polling loop", "description": "<blockquote>\nThe Condor-C and Nordugrid grid types have nearly identical code for handling batch queries of job statuses. For Condor-C jobs, condorresource.cpp's CondorResource::DoScheddPoll implements this on a timer setup in the constructor.  Nordugrid jobs use nordugridresource.cpp's NordugridResource::DoJobStatus, again, set up in a timer in the constructor.  The new CREAM grid type needed to do the same thing, but instead of copying the code again, I factored a bunch of it out into <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=BaseResource\" title=\"Base Resource\">BaseResource</a></span>.  Ideally Condor-C and Nordugrid would be refactored to use this code as well, cutting down on duplicate code.  You can see the changes in question in <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=939\" onclick=\"get_ticket_and_populate_wrapper('939'); return false;\" title=\"Issue single status command for all cream jobs\">#939</a></span>.  The interface is documented in <a class=\"file\" href=\"rlog?f=src/condor_gridmanager/baseresource.h\">/src/condor_gridmanager/baseresource.h</a>, but in short:\n\n<p></p><ul>\n<li>Call BaseResource::StartBatchStatusTimer in The <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FooResource\" title=\"Foo Resource\">FooResource</a></span> constructor\n</li><li>Implement FooResource::BatchStatusInterval to return the interval the batch query should fire on.\n</li><li>Implement FooResource::StartBatchStatus to initiate a batch query.  It will probably launch the request via the gahp, then return BSR_PENDING\n</li><li>Implement FooResource::FinishBatchStatus to continue and optionally complete a batch query.  Typically should return BSR_PENDING repeatedly until the gahp replies, in which case it should process the results and return BSR_DONE\n</li><li>Implement FooResource::BatchGahp to return the Gahp* used for your batch status queries.  The batch status code will ensure that it's isStarted(), possibly calling Startup(), before calling into your other functions.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2010-Oct-20 16:03:30 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.\n<hr/>\n<em>2011-Jan-27 14:46:04 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 14:49:30 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2011-Feb-01 14:52", "status": "new", "created": "2009-Nov-25 15:53", "fixed_version": "2009-Nov-25 15:53", "broken_version": "v070400", "priority": "4", "subsystem": "Grid", "assigned_to": "", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}