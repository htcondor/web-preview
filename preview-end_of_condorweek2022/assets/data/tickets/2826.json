{"id": 2826, "title": "Ticket #2826: HGQ + CC-Limits + CLAIM_PARTITIONABLE_LEFTOVERS", "description": "<blockquote>\ntest config:\n<div class=\"code\">\n<pre class=\"code\">########################################################\n# pSlot overload\nNUM_CPUS=32\n\nSLOT_TYPE_1 = cpus=8\nNUM_SLOTS_TYPE_1 = 1\nSLOT_TYPE_1_PARTITIONABLE=TRUE\n\nSLOT_TYPE_2 = cpus=8\nNUM_SLOTS_TYPE_2 = 1\nSLOT_TYPE_2_PARTITIONABLE=TRUE\n\nSLOT_TYPE_3 = cpus=8\nNUM_SLOTS_TYPE_3 = 1\nSLOT_TYPE_3_PARTITIONABLE=TRUE\n\nSLOT_TYPE_4 = cpus=8\nNUM_SLOTS_TYPE_4 = 1\nSLOT_TYPE_4_PARTITIONABLE=TRUE\n\n########################################################\n# Test for concurrency limits\nXSW_LIMIT=4\n\n########################################################\n## Test for HGQ\nGROUP_NAMES = group_one, group_two\nGROUP_QUOTA_group_one = 8\nGROUP_QUOTA_group_two = 8\n\nGROUP_AUTOREGROUP_group_one = TRUE\nGROUP_AUTOREGROUP_group_two = TRUE\n\n</pre></div>\n\n\n<p><strong>Step 1:</strong>\nSubmit job with cc-limits\n</p><div class=\"code\">\n<pre class=\"code\">executable=/bin/sleep\narguments=300\nconcurrency_limits = XSW\n+AccountingGroup = \"group_one.user\"\n</pre></div>\n\n\n<p><strong>Result of Step 1:</strong>\nWill hand out pSlot Claim for all 4 slots.\n\n</p><p><strong>Step 2:</strong>\nSubmit same job w/o cc-limits e.g. user+group == same\n</p><div class=\"code\">\n<pre class=\"code\">executable=/bin/sleep\narguments=300\n+AccountingGroup = \"group_one.user\"\n</pre></div>\n\n\n<p><strong>Results of step 2:</strong>\nSchedd uses claim to match pSlot and uses all slots blowing past HGQ</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Feb-27 14:37:01 by tstclair:</em> <br/>\n\nIn running through the matchmaker it's pretty clear that the accountant does not use slot weight when +/-'ing limits.  It seems doable to pass details into <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AddMatch\" title=\"Add Match\">AddMatch</a></span> which will update this.\n\n<p>Also <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LoadLimits\" title=\"Load Limits\">LoadLimits</a></span> will need to account for this during it's next run.\n\n</p><p><strong>Of Note:</strong> This all happens in phase 4.1 of the negotiation cycle, for ease of tracing set : NEGOTIATOR_DEBUG = D_MATCH | D_ACCOUNTANT | D_FULLDEBUG\n\n</p><p></p><hr/>\n<em>2012-Mar-20 13:34:32 by tannenba:</em> <br/>\n\nSome bold assertions:\n\n<p></p><ol>\n<li>If you are using dynamic slots, it only makes sense to have accounting (including HGQ accounting) done using slot weights.\n</li><li>As we move towards dynamic slots becoming more common, we should change so that slot accounting is no longer the default, but instead the default should be slotweight accounting were the default slotweight is simply number of cpus.\n</li></ol>\n\n<p>Anyone disagree?\n</p><hr/>\n<em>2012-Dec-11 16:37:58 by johnkn:</em> <br/>\n\nBulk change of target version from v070902 to v070903 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2013-Jan-18 09:10:44 by tstclair:</em> <br/>\n\nSee <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3435\" onclick=\"get_ticket_and_populate_wrapper('3435'); return false;\" title=\"negotiator-side resource consumption with consumption policies\">#3435</a></span> for implementation fix.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3435\" onclick=\"get_ticket_and_populate_wrapper('3435'); return false;\" title=\"negotiator-side resource consumption with consumption policies\">#3435</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nnegotiator-side resource consumption with consumption policies</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2013-Jan-18 09:10", "status": "abandoned", "created": "2012-Feb-14 11:08", "fixed_version": "2012-Feb-14 11:08", "broken_version": "v070705", "priority": "2", "subsystem": "Daemons", "assigned_to": "tstclair", "derived_from": "#2818", "creator": "tstclair", "rust": "", "customer_group": "users", "visibility": "public", "notify": "tstclair@redhat.com, eje@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}