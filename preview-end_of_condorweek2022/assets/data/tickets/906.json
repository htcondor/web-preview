{"id": 906, "title": "Ticket #906: Fix soap patches for clipped builds on fedora <latest>", "description": "<blockquote>\nThere are two soap patches that need modification in order to build a clipped version of condor on the later versions of fedora.</blockquote>", "remarks": "<blockquote>\n<em>2009-Nov-04 13:39:01 by matt:</em> <br/>\n\nSee <span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=472\" onclick=\"get_ticket_and_populate_wrapper('472'); return false;\" title=\"Upgrade gsoap external to 2.7.13\">#472</a></span>\n\n<p></p><hr/>\n<em>2009-Nov-04 13:42:03 by matt:</em> <br/>\n\nHere is the patch needed to get on gsoap 2.7.12 (in Fedora)...\n\n<p></p><div class=\"verbatim\">\n<pre>diff --git a/src/condor_daemon_core.V6/stdsoap2.h.patch b/src/condor_daemon_core\nindex a0fe3ed..c84abe7 100644\n--- a/src/condor_daemon_core.V6/stdsoap2.h.patch\n+++ b/src/condor_daemon_core.V6/stdsoap2.h.patch\n@@ -47,7 +47,7 @@\n @@ -418,8 +427,8 @@\n  #endif\n\n- #if defined(__cplusplus) &amp;&amp; !defined(WITH_LEAN)\n+ #if defined(__cplusplus) &amp;&amp; !defined(WITH_LEAN) &amp;&amp; !defined(WITH_COMPAT)\n -# include &lt;string&gt;\n -# include &lt;iostream&gt;\n +# include &lt;string.h&gt;\n</pre></div>\n\n\n<p></p><hr/>\n<em>2009-Nov-04 16:06:01 by tstclair:</em> <br/>\n\nAfter thinking about what we are doing, I think there are a couple alternatives.\n\n<p>1.) patch the patch (which will only be guaranteed for so long.)\n\n</p><p>2.) Upgrade UW to point to a later rendition of gsoap. (Again we will be chasing our tails later on if things change)\n\n</p><p>3.) Fix the inclusion order issues that exist with condor headers &amp;&amp; gsoap.\n\n</p><p>I'm inclined to do option#3 given our conversations about technical debt.  I feel we will just revisit this issue as newer versions become available.\n\n</p><p></p><hr/>\n<em>2009-Nov-05 11:37:09 by matt:</em> <br/>\n\nNew file should get a Red Hat copyright notice.\n\n<p>Why does testStub.cpp not include soap_daemon_core.h?\n\n</p><p></p><hr/>\n<em>2009-Nov-05 16:03:48 by tstclair:</em> <br/>\n\nAfter much tribulation and finding the root source of all errors was actually due to the symbol poisoning of open &amp;&amp; fopen, and the original patch purposefully got around the issue by using condor_fix_iostream.  Which doesn't really fix anything, it basically includes all elements then undefs the open calls again.\n\n<p>To really fix this would require far more time then I want to spend on this particular issue, and I will create another ticket for it.\n\n</p><p>The fix for the time being is simply to adjust the --fuzz=3 as the input args to patch, seeing how there is only one include section which matches those two lines I do not think this as an issue.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-05 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/65f50037b334e0bfd873e369db2cdd4168bd1bb0\">[16257]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=906\" onclick=\"get_ticket_and_populate_wrapper('906'); return false;\" title=\"Fix soap patches for clipped builds on fedora &lt;latest&gt;\">#906</a></span>: adjust the patch line to fuzz=3 to allow for differences in newer versions of soap. In general the larger issue is the elimination of symbol poisoning.  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-05 12:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/916f1721239024e9c4c3ef0735823e231d2f8bc0\">[16246]</a></span>: Revert \"Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=906\" onclick=\"get_ticket_and_populate_wrapper('906'); return false;\" title=\"Fix soap patches for clipped builds on fedora &lt;latest&gt;\">#906</a></span>: Update to fix inclusion order for soap stubs, and remove\" This reverts commit 9dd85d979c72801524a8f0c737598dcad98eb97a.  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-05 12:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6255867f14a118fb680e057b8d5eb2354a1f0fff\">[16245]</a></span>: Revert \"Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=906\" onclick=\"get_ticket_and_populate_wrapper('906'); return false;\" title=\"Fix soap patches for clipped builds on fedora &lt;latest&gt;\">#906</a></span>: Update to fix inclusion order for soap stubs, and remove\" This reverts commit 9dd85d979c72801524a8f0c737598dcad98eb97a.  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-05 11:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9dd85d979c72801524a8f0c737598dcad98eb97a\">[16243]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=906\" onclick=\"get_ticket_and_populate_wrapper('906'); return false;\" title=\"Fix soap patches for clipped builds on fedora &lt;latest&gt;\">#906</a></span>: Update to fix inclusion order for soap stubs, and remove from patch which was causing issues on later versions of fedora.  (By Timothy St. Clair )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-04 09:19", "status": "resolved", "created": "2009-Nov-04 10:17", "fixed_version": "2009-Nov-04 10:17", "broken_version": "v070400", "priority": "3", "subsystem": "Packaging", "assigned_to": "tstclair", "derived_from": "", "creator": "tstclair", "rust": "", "customer_group": "users", "visibility": "public", "notify": "matt@cs.wisc.edu", "due_date": ""}