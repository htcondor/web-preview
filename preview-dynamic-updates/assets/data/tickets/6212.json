{"id": 6212, "title": "Ticket #6212: Milestone 1 for schedd late materialization", "description": "<blockquote>\nMilestone 1 of schedd late materialization will have\n\n<p></p><ul>\n<li>opt-in via condor_submit -factory, and set max_materialize=&lt;n&gt; in your submit file.\n</li><li>master off switch in the schedd SCHEDD_ALLOW_LATE_MATERIALIZE\n</li></ul>\n\n<p>condor_submit -factory will create a digest of your submit file into a file in the current working directory.  The file will be called condor_submit.$(cluster).digest.  It will then make a cluster ad and transmit it to the schedd. then send the schedd the filename of the digest using a new RPC.  if there is foreach data that is not already a file, it will also make a file called condor_submit.$(cluster).items out of the foreach item data.\n\n</p><p>On commit of the submit transaction. The schedd will make an instance of submit_utils and attach it to the cluster ad, and initialize it from the submit digest by reading the given file.  It will then add the cluster to a list of clusters needing attention and start a 0 tick timer if one is not already\nqueued. It will then return success or failure to the condor_submit.\n\n</p><p>When the timer fires, it will examine each cluster needing attention and materialize proc ads as needed.  Each proc ad will be in its own transaction.\n\n</p><p>When <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DestroyProc\" title=\"Destroy Proc\">DestroyProc</a></span> decrements the proc count for a cluster, it will check to see if the cluster has a job factory, and if it does, it will put the cluster into a list of clusters needing attention - and it will NOT remove the cluster even if the current proc count is 0.  It will then start a 0 tick timer just like submit does.\n\n</p><p>actOnJobs in the schedd will look at cluster ads as well as job ads and will handle RM, HOLD and RELEASE on the cluster ad that match the constraint expression.  RM will pause the job factory in a permanent way. HOLD will pause the job factory, and RELEASE will resume a paused job factory. a RELEASE will also put the cluster into the list of clusters needing attention and start the timer.\n\n</p><p>When the clusters needing attention timer fires, it will materialize new jobs for clusters that have less than the max_materialize limit, and remove clusters that have 0 procs and will never materialize any new jobs - either because they have been permanenently paused, or because all of the jobs have already been materialized.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Apr-20 10:45:56 by tim:</em> <br/>\n\n<strong>DOC REVIEW:</strong> OK for now. More docs will come with Milestone 2.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-26 12:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2cb427c981d35b3bb11485910c0cfc9b8281f0a9\">[50584]</a></span>: Added a test for late materialization. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6212\" onclick=\"get_ticket_and_populate_wrapper('6212'); return false;\" title=\"Milestone 1 for schedd late materialization\">#6212</a></span>  (By shuyang )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-20 10:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b012cc166e51eecb4cb3f7e294fde71f1aa0c636\">[50515]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6181\" onclick=\"get_ticket_and_populate_wrapper('6181'); return false;\" title=\"condor_submit should use submit_utils\">#6181</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6212\" onclick=\"get_ticket_and_populate_wrapper('6212'); return false;\" title=\"Milestone 1 for schedd late materialization\">#6212</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-13 10:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/65c679f522cb72b013e5def0aec2c6974ca6fae5\">[50462]</a></span>: fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6212\" onclick=\"get_ticket_and_populate_wrapper('6212'); return false;\" title=\"Milestone 1 for schedd late materialization\">#6212</a></span>, fixes for various bugs in queue from in the late-materialize milestone 1 implementation. these changes have no effect of not using late materialize.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-07 14:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/96d4dad96b2b1220fd7bc6d0b488fbedaceccd47\">[50435]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6212\" onclick=\"get_ticket_and_populate_wrapper('6212'); return false;\" title=\"Milestone 1 for schedd late materialization\">#6212</a></span>, cancel the transaction when we fail to materialize a job. chain proc ads to the cluster ad before evaluating job transforms and submit requirements  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-04 12:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b1fc5b7135731c441ce1752d03b23aa6d4d14c5f\">[50406]</a></span>: fixes for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6212\" onclick=\"get_ticket_and_populate_wrapper('6212'); return false;\" title=\"Milestone 1 for schedd late materialization\">#6212</a></span>, don't check access on IWD when late materializing, condor_submit use <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GetCapabilities\" title=\"Get Capabilities\">GetCapabilities</a></span> to give clear error messages when late materialiation is disabled in the schedd  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-31 17:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b8385a0f99df5da0f6ee6ff39ee7c6f926dd6c39\">[50396]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6212\" onclick=\"get_ticket_and_populate_wrapper('6212'); return false;\" title=\"Milestone 1 for schedd late materialization\">#6212</a></span>, milestone 1 for schedd late materialization. late materialization is opt-in for users via condor_submit -factory and opt in for administrators via SCHEDD_ALLOW_LATE_MATERIALIZATION which defaults to false.  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Apr-26 12:32", "status": "resolved", "created": "2017-Mar-31 16:58", "fixed_version": "2017-Mar-31 16:58", "broken_version": "", "priority": "4", "subsystem": "", "assigned_to": "johnkn", "derived_from": "#6166", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}