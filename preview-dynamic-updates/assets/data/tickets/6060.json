{"id": 6060, "title": "Ticket #6060: Negotiator metrics", "description": "<blockquote>\nCMS still has a difficult time debugging negotiator issues.  Things that <em>appear simple</em> - \"do we have too many RRLs or are we spending too much time on network IO\" - are frustrating hard.\n\n<p>A few brainstorming ideas for negotiator metrics:\n</p><ul>\n<li>Keep a count of \"repeat offenders\": keep a history of the slots matched in the last N negotiation cycles (N=2?).  Print out the counts of slots that have been matched more than once within the window.  This would allow us to detect\u00a0startds that are not claimable.\n</li><li>Report prefetching time (in total) as a standalone metric.\n</li><li>Differentiate between \"CPU usage\" and \"IO usage\" when recording time spent interacting with schedds.  For example, this could be done by adding a <code>getrusage</code> call and recording the increases in <code>ru_utime</code>.\n</li><li>Report the number of RRLs received per-schedd per negotiation cycle.  Note this is different from <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4611\" onclick=\"get_ticket_and_populate_wrapper('4611'); return false;\" title=\"Resource request count metrics\">#4611</a></span>.  Alternate is to have a schedd-side count of the RRLs in memory.\n</li><li>Report fine-grained statistics (timings per schedd) to the negotiator ad.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2017-Mar-02 14:01:26 by jfrey:</em> <br/>\n\nI've added the following new negotiator statistics:\n\n<p></p><ul>\n<li><span class=\"quote\">LastNegotiationCyclePies</span>: Number of pies that were spun (will be greater than 1 for hierarchical group quotas)\n</li><li><span class=\"quote\">LastNegotiationCyclePieSpins</span>: Number of spins across all pies\n</li><li><span class=\"quote\">LastNegotiationCyclePrefetchDuration</span>: Time spent in schedd prefetch\n</li><li><span class=\"quote\">LastNegotiationCycleCpuTime</span>,\n<span class=\"quote\">LastNegotiationCyclePhase1CpuTime</span>,\n<span class=\"quote\">LastNegotiationCyclePhase2CpuTime</span>,\n<span class=\"quote\">LastNegotiationCyclePhase3CpuTime</span>,\n<span class=\"quote\">LastNegotiationCyclePhase4CpuTime</span>, <span class=\"quote\">LastNegotiationCyclePrefetchCpuTime</span>: Companions to duration stats that record cpu time (increase in user time from getrusage())\n</li><li><span class=\"quote\">LastNegotiationCycleScheddsOutOfTime</span>: Set of schedds that exceeded per-schedd time limit</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-21 11:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1209247a09c01cb263383ee8b2e9d531e2b81279\">[50536]</a></span>: Docs for new negotiator stats. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6060\" onclick=\"get_ticket_and_populate_wrapper('6060'); return false;\" title=\"Negotiator metrics\">#6060</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-03 13:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4a00f859177e5365896c0f6e5f8aabf82f056cde\">[50273]</a></span>: Implement cpu time negotiator stats on Windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6060\" onclick=\"get_ticket_and_populate_wrapper('6060'); return false;\" title=\"Negotiator metrics\">#6060</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-02 15:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8661677d767f750ab4a313081966fd578cb2dc20\">[50265]</a></span>: Disable cpu time negotiator stats on Windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6060\" onclick=\"get_ticket_and_populate_wrapper('6060'); return false;\" title=\"Negotiator metrics\">#6060</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-02 13:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9b54b88a7b353c0fc4175054ea4f1e0aed41b7d2\">[50263]</a></span>: Add negotiator stats for cpu time, prefetch time, and pie spins. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6060\" onclick=\"get_ticket_and_populate_wrapper('6060'); return false;\" title=\"Negotiator metrics\">#6060</a></span> Add timing for the schedd prefetch phase. Add cpu-time companions to all of the duration stats, which measure cpu time instead of wallclock time. Add counts for the number of pies spun and the total number of spins. The number of\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Apr-21 11:22", "status": "resolved", "created": "2016-Dec-20 08:57", "fixed_version": "2016-Dec-20 08:57", "broken_version": "", "priority": "3", "subsystem": "DaemonsCM", "assigned_to": "jfrey", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "bbockelm@cse.unl.edu", "due_date": ""}