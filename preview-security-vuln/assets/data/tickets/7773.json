{"id": 7773, "title": "Ticket #7773: Master is never IsReady if managing non-DC daemons", "description": "<blockquote>\nWhen non-Daemon-Core daemons are run by the master (e.g., <code>CREDMON_OAUTH</code>), since those non-DC daemons never send a keepalive, so the master perpetually thinks they are in <code>\"Startup\"</code>, which means that <code>condor_who -quick</code> will never show <code>IsReady</code> to be <code>true</code>. Instead you get a who ad that looks like this:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">$ condor_who -quick\nCREDD = \"Alive\"\nCREDD_PID = 2624590\nCREDMON_OAUTH = \"Startup\"\nCREDMON_OAUTH_PID = 2624596\nIsReady = false\nMASTER = \"Alive\"\nMASTER_PID = 2624427\nNumAlive = 4\nNumDaemons = 5\nNumDead = 0\nNumHold = 0\nNumHung = 0\nNumStartup = 1\nSCHEDD = \"Alive\"\nSCHEDD_PID = 2624579\nSHARED_PORT = \"Alive\"\nSHARED_PORT_PID = 2624554\n</pre></div>\n\n\n<p>We should either make the non-DC daemons send a keepalive (perhaps using <a class=\"external\" href=\"https://htcondor.readthedocs.io/en/latest/apis/python-bindings/api/htcondor.html#htcondor.send_alive\">https://htcondor.readthedocs.io/en/latest/apis/python-bindings/api/htcondor.html#htcondor.send_alive</a>), or the master should be able to understand that some daemons will not send keep alives.\n\n</p><p>Though it hasn't come up yet, this will eventually be a problem for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7501\" onclick=\"get_ticket_and_populate_wrapper('7501'); return false;\" title=\"Add new Python-based test framework\">#7501</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7745\" onclick=\"get_ticket_and_populate_wrapper('7745'); return false;\" title=\"Provide implementation of a Personal Pool object in Python\">#7745</a></span> (both use the who ad to determine whether a personal condor has started up correctly).</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Sep-23 10:09:48 by jpatton:</em> <br/>\n\nFYI: The example in the ticket has been worked around now as the OAuth Credmon reports ready to the master as of commit <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/06f05eb8abefa7f08564cb04a93fff7d981576cd\">[61172]</a></span>\n\n<p></p><hr/>\n<em>2020-Oct-21 13:31:45 by tim:</em> <br/>\n\nInternal implementation details. No docs needed.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-28 20:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8b92301ab1a1d28bbac24c9c6c5fc9f0b902d27f\">[61157]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7773\" onclick=\"get_ticket_and_populate_wrapper('7773'); return false;\" title=\"Master is never IsReady if managing non-DC daemons\">#7773</a></span>) Fix Fedora build  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-27 16:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6ff26314ce2221aedc2cf61b501e8c4f30e13aea\">[61137]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7773\" onclick=\"get_ticket_and_populate_wrapper('7773'); return false;\" title=\"Master is never IsReady if managing non-DC daemons\">#7773</a></span>, add set_ready_state, a binding for daemons written in python to notify the master that they are running this commit also changes the master to pass the family session environment variable to all daemons, not just those that have a command port. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Oct-21 13:31", "status": "resolved", "created": "2020-Jul-31 11:11", "fixed_version": "2020-Jul-31 11:11", "broken_version": "", "priority": "3", "subsystem": "DaemonMaster", "assigned_to": "johnkn", "derived_from": "", "creator": "karpel", "rust": "", "customer_group": "other", "visibility": "public", "notify": "johnkn@cs.wisc.edu, karpel@wisc.edu, jpatton@cs.wisc.edu", "due_date": ""}