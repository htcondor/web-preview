{"id": 6029, "title": "Ticket #6029: DAGMan should check success_exit_code", "description": "<blockquote>\nDAGMan should check for the attribute corresponding to the new success_exit_code submit command -- otherwise, if success_exit_code is set to anything non-zero, DAGMan will think the node failed even if it succeeded.\n\n<p>Hmm -- if success_exit_code is non-zero, should that also apply to the POST script?  (It can't really apply to the PRE script, because the submit file, in general, might not exist until after the PRE script runs.)\n\n</p><p>Also see <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=5479\" onclick=\"get_ticket_and_populate_wrapper('5479'); return false;\" title=\"Allow user to define failure for DAG node jobs\">#5479</a></span>.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Dec-01 11:26:40 by wenger:</em> <br/>\n\nCreated V8_5-gittrac_6029-branch for this.\n\n<p></p><hr/>\n<em>2016-Dec-02 14:19:02 by wenger:</em> <br/>\n\nHmm -- this is a little trickier than I first was thinking.  I don't want DAGMan to have to parse the submit file (we got away from that).  On the other hand, when we get the terminated event, the job is no longer in the queue, so we can't get the relevant attribute from the schedd.  And even if we tried to get the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobSuccessExitCode\" title=\"Job Success Exit Code\">JobSuccessExitCode</a></span> attribute right after submission, there would still be a race condition because a job <strong>could</strong> exit before we get the attribute.\n\n<p>As a further complication, I'm not sure what happens if you have a multi-proc job and try to set <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobSuccessExitCode\" title=\"Job Success Exit Code\">JobSuccessExitCode</a></span> to different values for the different procs.  (I assume the last value wins, because I don't think you could have different values for the different procs.)\n\n</p><p></p><hr/>\n<em>2016-Dec-02 14:33:38 by wenger:</em> <br/>\n\nHmm -- part of my last remark was wrong:  it turns out that you <strong>can</strong> have different <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobSuccessExitCode\" title=\"Job Success Exit Code\">JobSuccessExitCode</a></span> values for different procs in a job...\n\n<p></p><hr/>\n<em>2016-Dec-07 16:31:55 by wenger:</em> <br/>\n\nMaybe make it an error if a multi-proc DAG node job has different success_exit_code values for different procs...\n\n<p></p><hr/>\n<em>2017-Jan-11 10:03:19 by wenger:</em> <br/>\n\nThis should be a development series change, so I'm going to change the fixed version.\n\n<p></p><hr/>\n<em>2017-Feb-27 14:21:51 by wenger:</em> <br/>\n\nAs per today's discussion in the flightworthy meeting -- we'd like DAGMan to not actually look the job's exit code in the workflow log -- the schedd (?) should add something that says \"job succeeded\" or \"job failed\", and DAGMan should only look at that.  (That would mean that DAGMan wouldn't have to actually care about how success_exit_code is defined.)\n\n<p>Also, we may want to generally look at the interaction between retries defined in a job submit file and retries defined in the DAG file -- do we really want them to multiply, for example?</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Dec-01 16:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7f206e097254c943ffc07998f2c1f90820024bf0\">[49705]</a></span>: Gittrac <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=6029\" onclick=\"get_ticket_and_populate_wrapper('6029'); return false;\" title=\"DAGMan should check success_exit_code\">#6029</a></span>: Added more stuff to retry test DAG, and started on code changes to work with this.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Dec-01 14:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/65b151d0c2a0a637a79ab1ea36b861589dc65fa0\">[49699]</a></span>: Gittrac <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=6029\" onclick=\"get_ticket_and_populate_wrapper('6029'); return false;\" title=\"DAGMan should check success_exit_code\">#6029</a></span>: Created a DAG to test Condor-level job retries and non-zero success exit code.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-May-14 06:31", "status": "stalled", "created": "2016-Nov-30 13:56", "fixed_version": "2016-Nov-30 13:56", "broken_version": "v080508", "priority": "1", "subsystem": "Dag", "assigned_to": "coatsworth", "derived_from": "#5912", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, johnkn@cs.wisc.edu, coatsworth@cs.wisc.edu", "due_date": ""}