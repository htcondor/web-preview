{"id": 1219, "title": "Ticket #1219: ConcurrencyLimit problems with new ClassAds", "description": "<blockquote>\nI noticed that condor_q from the current 7.5.1 build is unable to run -better-analyze in CHTC (CM 7.5.0).  The failure is caused by entries such as the following in the negotiator's classad response to GET_PRIORITY:\n\n<p></p><div class=\"verbatim\">\n<pre>ConcurrencyLimit.jmag = 0.0\n</pre></div>\n\n\n<p>This causes condor_q to report:\n\n</p><p></p><div class=\"verbatim\">\n<pre>Could not get priorities from negotiator\n</pre></div>\n\n\n<p>The code that produces these entries appears to be this in Accountant.cpp:\n\n</p><p></p><div class=\"verbatim\">\n<pre>        attr.sprintf(\"ConcurrencyLimit.%s = %f\\n\", limit.Value(), count);\n</pre></div>\n\n\n<p>In new classads, \".\" is not a valid character in an attribute name, so condor_q cannot parse the classad.  Presumably if the negotiator were using new classads, it would fail to insert these attributes into the ad, but it ignores the return value of Insert(), so this information would simply be missing.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Feb-16 08:54:04 by matt:</em> <br/>\n\nThe dot (.) is an arbitrary separator. An underscore (_) or colon (:) would also work. I have some code that depends on the dot, which I can update. I do not expect many others have code that rely on dot. Ideally we can pick a stable separator now. In the future we can likely use a nested <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>.\n\n<p></p><hr/>\n<em>2010-Feb-16 09:14:53 by jfrey:</em> <br/>\n\nI can't find any code that looks up these ConcurrencyLimit.&lt;blah&gt; attributes. In the new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> compatibility layer, getOldClassAdNoTypes() and getOldClassAd() could check for these names and convert the '.' to '_'.\n\n<p></p><hr/>\n<em>2010-Feb-16 10:30:40 by jfrey:</em> <br/>\n\nI've attached a patch to fix this specific problem. The accountant would use '_' instead of '.' in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ConcurrencyLimit\" title=\"Concurrency Limit\">ConcurrencyLimit</a></span> attributes. And the compatibility layer would convert '.' to '_' if it sees these specific attributes come over the wire. I've tested the second half of the patch against a 7.5.0 negotiator.\n\n<p></p><hr/>\n<em>2010-Feb-16 10:34:54 by matt:</em> <br/>\n\nThat looks like the change I would have made.\n\n<p></p><hr/>\n<em>2010-Feb-16 10:41:48 by jfrey:</em> <br/>\n\nI've pushed the patch to V7_5_1-branch.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/140/dot.patch\">dot.patch</a>\n1086 bytes added by jfrey on 2010-Feb-16 16:28:46 UTC.\n<br/>\nPatch to remove '.' from attribute names in accountant.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-16 10:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/90c99964b24eceed9e3f852bf0e4ac02b2a2fc4e\">[17255]</a></span>: Change '.' to '_' in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ConcurrencyLimit\" title=\"Concurrency Limit\">ConcurrencyLimit</a></span> attrs in Accountant. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1219\" onclick=\"get_ticket_and_populate_wrapper('1219'); return false;\" title=\"ConcurrencyLimit problems with new ClassAds\">#1219</a></span> The accountant would create user priority ads with attributes named ConcurrencyLimit.foo. New <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>' stricter checking of attribute names chokes on this, causing condor_userprio and condor_q -analyze to fail if these attributes are present.\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Feb-23 14:12", "status": "resolved", "created": "2010-Feb-15 18:50", "fixed_version": "2010-Feb-15 18:50", "broken_version": "v070501", "priority": "4", "subsystem": "", "assigned_to": "jfrey", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu,dan@hep.wisc.edu,jfrey@cs.wisc.edu", "due_date": ""}