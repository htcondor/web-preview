{"id": 2712, "title": "Ticket #2712: RFE: new dprintf() format-modifying flag to output flag info", "description": "<blockquote>\nA new format-modifying flag that instructs dprintf() to include the 'regular' flags (D_FULLDEBUG, D_MATCH, etc) as part of log output for grepping would be helpful for selecting subsets of log output using 'grep' or other tools.\n\n<p>So, a new format flag to go with D_PID, D_FDS and friends:  D_FLAGS.  If D_FLAGS was set, then a line of log output might look like:\n\n</p><p>12/13/11 10:01:19 D_FULLDEBUG|D_ALWAYS Phase 1:  Obtaining ads from collector ...\n\n</p><p>One use case is suggested in <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=2711\" onclick=\"get_ticket_and_populate_wrapper('2711'); return false;\" title=\"RFE: new 'unit testing' parsable dprintf flag\">#2711</a></span>, for selecting parsable log output lines from the log stream using grep.</p></blockquote>", "remarks": "<blockquote>\nTESTING\n\n<p>To test new 'D_LEVEL' debug flag, use the following config, which enables the new flag for the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SchedLog\" title=\"Sched Log\">SchedLog</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NegotiatorLog\" title=\"Negotiator Log\">NegotiatorLog</a></span>, and sets all other logging to D_ALWAYS:\n</p><div class=\"code\">\n<pre class=\"code\">ALL_DEBUG =\nNEGOTIATOR_DEBUG = D_LEVEL D_MATCH D_ACCOUNTANT D_SECURITY D_FULLDEBUG\nSCHEDD_DEBUG = D_LEVEL\n</pre></div>\n\n\n<p>Spin up the pool, and submit a short job to exercise the system, e.g.\n</p><div class=\"code\">\n<pre class=\"code\">universe = vanilla\ncmd = /bin/sleep\nargs = 15\nshould_transfer_files = if_needed\nwhen_to_transfer_output = on_exit\n+AccountingGroup = \"none.user0000\"\nqueue 1\n</pre></div>\n\n\n<p>Let the job complete, and (optionally) shut down the pool.   Detect new 'D_LEVEL' logging output:\n</p><div class=\"code\">\n<pre class=\"code\"># only logging output flagged D_ALWAYS should appear:\n$ grep ' (D_.*) ' SchedLog | awk '{print $3}' | sort | uniq -c\n     75 (D_ALWAYS)\n      1 (D_ALWAYS|D_PROTOCOL)\n\n# Anything flagged D_ALWAYS, D_ACCOUNTANT, D_SECURIY, D_MATCH or D_FULLDEBUG:\n$ grep ' (D_.*) ' NegotiatorLog | awk '{print $3}' | sort | uniq -c\n     26 (D_ACCOUNTANT)\n     72 (D_ALWAYS)\n      1 (D_ALWAYS|D_MATCH)\n     71 (D_FULLDEBUG)\n      4 (D_FULLDEBUG|D_SECURITY)\n    290 (D_SECURITY)\n\n# other logs should not show the new fields because the D_LEVEL flag was not set:\n$ grep ' (D_.*) ' MasterLog | awk '{print $3}' | sort | uniq -c\n$ grep ' (D_.*) ' CollectorLog | awk '{print $3}' | sort | uniq -c\n$ grep ' (D_.*) ' StartLog | awk '{print $3}' | sort | uniq -c\n</pre></div>\n\n\n<p>Logging lines should look like this example:\n</p><div class=\"code\">\n<pre class=\"code\">$ grep D_SECURITY NegotiatorLog | head -5\n04/19/12 14:10:42 (D_SECURITY) KEYCACHE: created: 0x222bfc0\n04/19/12 14:10:42 (D_SECURITY) SECMAN: created non-negotiated security session eb6374d91fb5d110209b8c36bb2f048eb64fdc51b95f30b9 for 0 (inf) seconds.\n04/19/12 14:10:42 (D_SECURITY) Imported session attributes: [Integrity=\"NO\";Encryption=\"NO\";CryptoMethods=\"3DES\";CurrentTime=time();]\n04/19/12 14:10:42 (D_SECURITY) Caching non-negotiated security session ad:\n04/19/12 14:10:42 (D_SECURITY) IpVerify::PunchHole: opened DAEMON level to condor@parent\n</pre></div>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=2713\" onclick=\"get_ticket_and_populate_wrapper('2713'); return false;\" title=\"RFE: extend dprintf flag parameter to 64-bit integer\">#2713</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nRFE: extend dprintf flag parameter to 64-bit integer</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-27 12:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1ced0086d69054eb19ebba115c3d40fae042de63\">[32489]</a></span>: new &lt;SUBSYS&gt;_DEBUG isn't D_LEVEL, it is D_CATEGORY . . . ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2712\" onclick=\"get_ticket_and_populate_wrapper('2712'); return false;\" title=\"RFE: new dprintf() format-modifying flag to output flag info\">#2712</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-20 11:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/72d26f8c4805195cd86058515c2e4d2f62d2ff89\">[32427]</a></span>: edit to 7.9.0 version history and associated defn of new debug level:D_LEVEL ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2712\" onclick=\"get_ticket_and_populate_wrapper('2712'); return false;\" title=\"RFE: new dprintf() format-modifying flag to output flag info\">#2712</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-19 17:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3229c9056c2c3665aa2d467d27742de7c0ad89cd\">[31761]</a></span>: Added D_LEVEL logging output flag ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2712\" onclick=\"get_ticket_and_populate_wrapper('2712'); return false;\" title=\"RFE: new dprintf() format-modifying flag to output flag info\">#2712</a></span>  (By Erik Erlandson )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-Jun-26 15:15", "status": "resolved", "created": "2011-Dec-13 16:28", "fixed_version": "2011-Dec-13 16:28", "broken_version": "", "priority": "2", "subsystem": "Libs", "assigned_to": "gthain", "derived_from": "#2711", "creator": "eje", "rust": "", "customer_group": "other", "visibility": "public", "notify": "eje@cs.wisc.edu, matt@cs.wisc.edu, tannenba@cs.wisc.edu, gthain@cs.wisc.edu, tstclair@redhat.com, ziliang@cs.wisc.edu, johnkn@cs.wisc.edu", "due_date": ""}