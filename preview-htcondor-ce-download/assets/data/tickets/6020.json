{"id": 6020, "title": "Ticket #6020: condor-c and jobRouter should delete TotalSubmitProcs", "description": "<blockquote>\nWhen you submit a job to an 8.5.7 Schedd it injects an attribute <code>TotalSubmitProcs</code> and sets it's value to the number of <code>ProcId</code> 's in that <code>ClusterId</code>. This attribute is used by condor_q -batch to calculate the total number of jobs and the number of jobs that have completed and left the queue.\n\n<p>So if a job is transformed by condor-c or by the job router and turned into a bunch of single procid jobs, this attribute need to be stripped by condor-c or the job router when submitting to a schedd that is older than 8.5.7.  Otherwise condor_q can report wildly inaccurate values for total jobs in a batch.\n\n</p><p>There is no harm in having these tools always remove that attribute.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Nov-23 12:35:59 by johnkn:</em> <br/>\n\nAccording to Jaime.  the relevant functions to fix up are:\n\n<p></p><pre>   condor_gridmanager/condorjob.cpp: CondorJob::buildSubmitAd()\n   condor_job_router/VanillaToGrid.cpp: VanillaToGrid::vanillaToGrid()</pre>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Nov-23 14:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ce563b7816e6c44a3b7822f3a36cd472d6002b01\">[49643]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5967\" onclick=\"get_ticket_and_populate_wrapper('5967'); return false;\" title=\"It should be possible to have multiple negotiators in the collector\">#5967</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5969\" onclick=\"get_ticket_and_populate_wrapper('5969'); return false;\" title=\"config should warn about obsolete SUBSYS.LOCALNAME.* prefixes\">#5969</a></span>, <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=5988\" onclick=\"get_ticket_and_populate_wrapper('5988'); return false;\" title=\"classad userMap should tokenize arg3 only commas\">#5988</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5882\" onclick=\"get_ticket_and_populate_wrapper('5882'); return false;\" title=\"$ENV in config/submit should support defaults\">#5882</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5980\" onclick=\"get_ticket_and_populate_wrapper('5980'); return false;\" title=\"job transform requirements don't work if TARGET is used\">#5980</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6020\" onclick=\"get_ticket_and_populate_wrapper('6020'); return false;\" title=\"condor-c and jobRouter should delete TotalSubmitProcs\">#6020</a></span> and doc for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5882\" onclick=\"get_ticket_and_populate_wrapper('5882'); return false;\" title=\"$ENV in config/submit should support defaults\">#5882</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Nov-23 12:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/58b1ec934f1863e2f29227542926249648ba3193\">[49640]</a></span>: fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6020\" onclick=\"get_ticket_and_populate_wrapper('6020'); return false;\" title=\"condor-c and jobRouter should delete TotalSubmitProcs\">#6020</a></span>, condor_q -batch reporting wrong job total and done values for jobs that were routed by the job_router or condor_c. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "incident", "last_change": "2016-Nov-23 15:38", "status": "resolved", "created": "2016-Nov-23 12:24", "fixed_version": "2016-Nov-23 12:24", "broken_version": "v080507", "priority": "4", "subsystem": "DaemonsSubmitNode", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}