{"id": 7683, "title": "Ticket #7683: NonNegotiated Security Sessions have bad AuthMethods attribute", "description": "<blockquote>\nWhen two Condor processes do security negotiation, the <code>AuthMethods</code> attribute in the policy ad is initially set to the list of authentication methods each side is able to try. Once an authentication method succeeds, <code>AuthMethods</code> in the final security session policy ad is set to that method (yes, the plural form is deceiving). For a non-negotiated security session, <code>AuthMethods</code> in the policy ad is set to the initial list of configured authentication methods. This value should not be a list, and none of the individual authentication methods is a valid value.\n\n<p>This nonsense value pops into public view when an ad is advertised in the collector using a non-negotiated security session. The collector sets <code>AuthenticationMethod</code> in the advertised ad based on the value of <code>AuthMethods</code> in the session policy ad for the connection with the advertiser. This will happen most commonly for daemons on the same machine as the collector, which will use the family security session to talk with the collector.\n\n</p><p>We propose that non-negotiated sessions use one of a small number of special authentication method names that indicate the nature of the relationship (and how the trust of the security session was established. Below is a list of all existing non-negotiated sessions, grouped by the proposed authentication name. Each entry lists the participants of the session, followed by the authenticated names.\n\n</p><p></p><ul>\n<li><code>FAMILY</code>\n<ul>\n<li>Parent/Child: <code>condor@parent</code>, <code>condor@child</code>\n</li><li>Family: <code>condor@family</code>\n</li><li>gridmanager/ft-gahp: <code>condor@parent</code>, <code>condor@child</code>\n</li></ul>\n</li><li><code>MATCH</code>\n<ul>\n<li>Startd/Schedd: <code>execute-side@matchsession</code>, <code>submit-side@matchsession</code>\n</li><li>Starter/Shadow file transfer: <code>execute-side@matchsession</code>, <code>submit-side@matchsession</code>\n</li><li>SubmitTool/Startd: <code>User</code> job attribute or <code>job-owner@submit-domain</code>, <code>execute-side@matchsession</code>\n</li><li>Schedd/Negotiator: <code>submit-side@matchsession</code>, <code>negotiator-side@matchsession</code>\n</li><li>Schedd/Collector: <code>submit-side@matchsession</code>, <code>collector-side@matchsession</code></li></ul>\n</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2020-Jun-16 15:03:58 by jfrey:</em> <br/>\n\nCode for this ticket is on branch <code>V8_9-gt7683-nonnegotiated-authmethods</code>.\n\n<p></p><hr/>\n<em>2020-Jun-16 16:14:51 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>:  Names look good and code looks good.  No docs needed IMHO.\n\n<p></p><hr/>\n<em>2020-Jun-17 20:40:41 by jfrey:</em> <br/>\n\nSince these new auth method names can show up in ads in the collector, I think some documentation is called for.\n\n<p></p><hr/>\n<em>2020-Jul-31 14:17:33 by jfrey:</em> <br/>\n\nThe security section of the manual should be updated to explain these authentication methods. For now, I'm just putting something in the version history.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-31 14:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9736cfba6006dcd99933b1af6b0b60081575b332\">[60295]</a></span>: Docs for new authentication method names FAMILY and MATCH. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7683\" onclick=\"get_ticket_and_populate_wrapper('7683'); return false;\" title=\"NonNegotiated Security Sessions have bad AuthMethods attribute\">#7683</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jun-16 15:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/53c3fca5a0556b9d01737e0cfdff72fba6c267a4\">[59888]</a></span>: Add authentication methods for non-negotiated security sessions. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7683\" onclick=\"get_ticket_and_populate_wrapper('7683'); return false;\" title=\"NonNegotiated Security Sessions have bad AuthMethods attribute\">#7683</a></span> Define special authentication methods for non-negotiated security sessions. These become the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AuthMethods\" title=\"Auth Methods\">AuthMethods</a></span> attribute of the security policy, and the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AuthenticationMethod\" title=\"Authentication Method\">AuthenticationMethod</a></span> attribute when advertising to the collector. Since none of the\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jun-16 14:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4a427596a5e4f893c1a3b4d7786633cfe0f8d96a\">[59887]</a></span>: Add attribute macros for collector authentication attrs. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7683\" onclick=\"get_ticket_and_populate_wrapper('7683'); return false;\" title=\"NonNegotiated Security Sessions have bad AuthMethods attribute\">#7683</a></span>  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Jul-31 14:17", "status": "resolved", "created": "2020-Jun-12 13:46", "fixed_version": "2020-Jun-12 13:46", "broken_version": "", "priority": "2", "subsystem": "Security", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "zmiller@cs.wisc.edu", "due_date": ""}