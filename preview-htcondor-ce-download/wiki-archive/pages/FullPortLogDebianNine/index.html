<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="HTCondor Homepage">
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/web-preview/preview-htcondor-ce-download/assets/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/web-preview/preview-htcondor-ce-download/assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/web-preview/preview-htcondor-ce-download/assets/images/favicons/favicon-16x16.png">
    <link rel="manifest" href="/web-preview/preview-htcondor-ce-download/assets/images/favicons/site.webmanifest">
    <link rel="mask-icon" href="/web-preview/preview-htcondor-ce-download/assets/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/web-preview/preview-htcondor-ce-download/assets/images/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/web-preview/preview-htcondor-ce-download/assets/images/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <!-- Primary Meta Tags -->
    <meta name="title" content="HTCondor">
    <meta name="description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://htcondor.org/">
    <meta property="og:title" content="HTCondor">
    <meta property="og:description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">
    <meta property="og:image" content="https://htcondor.org/assets/images/HTC.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://htcondor.org/">
    <meta property="twitter:title" content="HTCondor">
    <meta property="twitter:description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">
    <meta property="twitter:image" content="https://htcondor.org/assets/images/HTC.png">

    <title>Full Port Log Debian Nine</title>

    <script src="/web-preview/preview-htcondor-ce-download/assets/js/sitewide.js" type="text/javascript" defer></script>
    <script src="/web-preview/preview-htcondor-ce-download/assets/js/bootstrap.js" type="text/javascript"></script>
    

    

    <meta name="robots" content="noindex">

    

    <link href="/web-preview/preview-htcondor-ce-download/assets/css/style-v1.css" media="screen, tv, projection" title="Default" rel="stylesheet">
    

</head>
<body class="vh-100 d-flex flex-column">

<!-- For non-visual user agents: -->
<a id="skip-link" href="#main-copy">Skip to main content.</a>

<header id="header">
    <div class="mb-4 container">
        <div class="row">
            <div class="col-12">
                <nav class="navbar navBar navbar-expand-lg navbar-light w-100">
                    <a href="/web-preview/preview-htcondor-ce-download/index.html" class="d-none d-md-inline"><img height="75" alt="Condor High Throughput Computing" src="/web-preview/preview-htcondor-ce-download/assets/images/CondorTitle.png" style="border:0"></a>
                    <a href="/web-preview/preview-htcondor-ce-download/index.html" class="d-inline d-md-none"><img height="65" alt="Condor High Throughput Computing" src="/web-preview/preview-htcondor-ce-download/assets/images/HTCondor_red_blk.svg" style="border:0"></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mb-2 mb-lg-0 ms-auto mt-auto">
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-htcondor-ce-download/">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-htcondor-ce-download/new">News</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-htcondor-ce-download/downloads">Downloads</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-htcondor-ce-download/publications">Publications</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="mailto:htcondor-admin@cs.wisc.edu">Contact Us</a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        <div class="row">
            

<script async src="https://cse.google.com/cse.js?cx=1056a9a876b1d1474"></script>
<div class="gcse-searchbox-only"></div>


        </div>
    </div>
</header>
<main id="main-copy" tabindex="-1">
    <div class="container mb-4">
    <h1>Full Port Log Debian Nine</h1>
<div id="content">
 <span class="section">
  <h2>
   Perform a Clipped Port
  </h2>
 </span>
 <p>
  This log starts with some work for the general system port already having been done by another developer.
 </p>
 <p>
  <span class="section">
  </span>
 </p>
 <h2>
  Preparation of a new glibc external
 </h2>
 <p>
  See the
  <span class="wiki">
   <a href="/web-preview/preview-htcondor-ce-download/wiki-archive/pages/FullPortLogDebianSixSixtyFourBit" title="Full Port Log Debian Six Sixty Four Bit">
    Debian 6 full port log
   </a>
  </span>
  for more details.  Note that for Debian 9,
  <code>
   apt-get source glibc
  </code>
  applied the patches;
  <code>
   debian/rules patch
  </code>
  was probably a no-op.
 </p>
 <p>
  <span class="subsection">
  </span>
 </p>
 <h3>
  Locate and see how glibc builds
 </h3>
 <p>
 </p>
 <div class="verbatim">
  <pre>apt-get source glibc
cd glibc-2.24
debian/rules patch
cd ..
mv glibc-2.24 glibc-2.24-11
tar -z -c -f glibc-2.24-11.tar.gz glibc-2.24-11
cd glibc-2.24-11
debian/rules build |&amp; tee build.out
</pre>
 </div>
 <p>
  The build failed.  Needed to do
  <code>
   apt-get build-dep glibc
  </code>
  .  This wanted
  <code>
   makeinfo
  </code>
  , but still failed, unable to find
  <code>
   selinux/selinux.h
  </code>
  a long way into the build.  Since
  <code>
   /usr/include/selinux/selinux.h
  </code>
  existed, I tried
  <code>
   apt-get install linux-headers-4.9.0-3-all
  </code>
  .  This didn't help.  I tried starting over, in case the selinux headers were supposed to have been copied into the tree; didn't help.  Looked at other glibc external build comments, tried
  <code>
   apt-get install gcc-multilib
  </code>
  , because of the
  <code>
   debian/include
  </code>
  silliness.  (Why bother if you're going to make symlinks?)  This fixed the problem.
 </p>
 <p>
  Run
  <code>
   apt-get install texi2html
  </code>
  to get makeinfo.
 </p>
 <p>
  <span class="subsection">
  </span>
 </p>
 <h3>
  Create the glibc external
 </h3>
 <p>
  Follow the
  <span class="wiki">
   <a href="/web-preview/preview-htcondor-ce-download/wiki-archive/pages/FullPortLogDebianSixSixtyFourBit" title="Full Port Log Debian Six Sixty Four Bit">
    instructions
   </a>
  </span>
  .  Note that parrot updates what it serves over HTTP from AFS every ten minutes.
 </p>
 <p>
  Notes: the build system will warn but not fail if it doesn't find the glibc version it's looking for for standard universe.  This should probably be fixed.
 </p>
 <p>
  The CMakeLists.txt in question is the one in
  <code>
   externals/bundles/glibc
  </code>
  .
 </p>
 <p>
  <span class="subsection">
  </span>
 </p>
 <h3>
  Patch the glibc external
 </h3>
 <p>
  The Debian 8 patches all worked except for
  <code>
   disable-nscd.patch
  </code>
  , which had an obvious fix.
 </p>
 <p>
  <span class="subsection">
  </span>
 </p>
 <h3>
  Check the glibc external
 </h3>
 <p>
  The new configure script
  <em>
   really
  </em>
  wants the compiler to include flags.  The solution to making CMake do this was simple but not immediately obvious (escape the space rather than quote part of the string).
 </p>
 <p>
  Unlike the previous builds, the generated
  <code>
   debian/include
  </code>
  appears to be necessary.  However, since it's constructed entirely out of symlinks into
  <code>
   /usr/include
  </code>
  (or empty files), I'm OK with keeping it around.
 </p>
 <p>
  <span class="section">
  </span>
 </p>
 <h2>
  Build the Full Port
 </h2>
 <p>
  This was mostly just finding the
  <code>
   GLIBC219
  </code>
  checks and adding
  <code>
   GLIBC224
  </code>
  to them.  One exception was
  <code>
   wait4()
  </code>
  ; not sure if this is a glibc change or the compiler getting pickier, but apparently wait4()'s third argument really needs to be a pointer to
  <code>
   int
  </code>
  rather than a pointer to
  <code>
   void
  </code>
  .  Updated the remap to match the new declaration.
 </p>
 <p>
  <span class="subsection">
  </span>
 </p>
 <h3>
  Testing
 </h3>
 <p>
  The tests did not link.  The first problem was that we had to explicit for everything in the standard universe, including the tests, that we were building static libraries (e.g., add
  <code>
   -static
  </code>
  to the flags everywhere).
 </p>
 <p>
  The second was a problem with some symbols, including
  <code>
   __libc_memalign
  </code>
  , being multiply-defined.  The last time this happened, the problem was user code calling
  <code>
   memalign
  </code>
  and causing it to link against the glibc versions in
  <code>
   libcondor_c.a
  </code>
  , rather than against the versions in
  <code>
   libcondorsyscall.a
  </code>
  .  The problem was not in user code this time, and I wasn't able to isolate what else might have been calling it.  Instead, I massaged
  <code>
   malloc.o
  </code>
  to make its symbols harder to link against (localized them) except for a few that were needed by
  <code>
   libcondorsyscall.a
  </code>
  that, as they were glibc-internal, should not have be necessary.  It seems like maybe there's some premature linking going on in general with the new toolchain, but
  <code>
   -fno-lto
  </code>
  didn't seem to solve the problem.  (Maybe something needs to be changed about the libraries are being built?)
 </p>
 <p>
  The workaround resulted in a BaTLab test run with only two test failures.  I haven't looked at the second one in any detail.  The first one the first test's problem is as follows: unlike previous glibc implementations, version 2.24 does not have the *nocancel() family of functions; it instead has a set of
  <code>
   #defines
  </code>
  like the following:
 </p>
 <p>
 </p>
 <div class="verbatim">
  <pre>#define __close_nocancel(fd) \
  INLINE_SYSCALL (close, 1, fd)
</pre>
 </div>
 <p>
  which emits assembly which includes the syscall instruction.  This means we
can't intercept, for instance, the close() that you would expect to be
called by fclose().
 </p>
 <p>
  Work was paused there pending further demand.
 </p>
</div>

</div>
</main>
<div id="footer" class="border-top mt-auto">
    <div class="container py-4">
        <div class="row">
            <div class="col text-center">
                For comments or questions about this website, please email
                <a href="mailto:htcondor-admin@cs.wisc.edu">htcondor-admin@cs.wisc.edu</a><br />
                This work is supported by <a href="https://www.nsf.gov/div/index.jsp?div=OAC">NSF</a> under Cooperative Agreement <a href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=2030508">OAC-2030508</a> as part of the <a href="https://path-cc.io/">PATh Project</a>. <br />
                <script type="text/javascript">
                    document.write("Updated &raquo; "+lastMod(document.lastModified))
                </script>
            </div>
        </div>
    </div>
</div>



</body>
</html>
