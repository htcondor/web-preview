{"id": 7347, "title": "Ticket #7347: Discuss ClassAd memory management", "description": "<blockquote>\nWe should talk when Jaime gets back.  I've hated the way we do memory management in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> for quite some time, but I'm increasingly convinced by recent experiences, particularly in writing the <strong>classad_eval</strong> tool using the Python bindings, that the way <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> manage memory (in particular, ownership) is fundamentally incompatible with the way Python does.\n\n<p>This may not be 100% true; it may just be that we need to be really careful and explicit about generating new Python objects, managing their reference counts, and handing ownership over to them.  In addition to being hard, I think we'd need to add a bunch of things to the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> library in order to be able to make deep copies and/or reassign ownership.\n\n</p><p>On the other hand, I think it would benefit us, moving forward, to have a predictable and consistent memory model for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>.  (For instance, some types of Values are actually references.)  It may make sense to leave the existing API alone, because of the large body of code that's been tweaked to work well with it, and create another one -- initially used by the Python bindings -- that might be less efficient, but is easier to code against.</p></blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2020-Apr-10 07:46:37 by tim:</em> <br/>\n\nBulk change of target version from v080906 to v080907 using ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "todo", "last_change": "2020-Nov-09 12:26", "status": "new", "created": "2019-Oct-29 16:06", "fixed_version": "2019-Oct-29 16:06", "broken_version": "", "priority": "2", "subsystem": "ClassAd", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, jfrey@cs.wisc.edu, johnkn@cs.wisc.edu, tlmiller@cs.wisc.edu, karpel@wisc.edu, bbockelman@morgridge.org", "due_date": ""}