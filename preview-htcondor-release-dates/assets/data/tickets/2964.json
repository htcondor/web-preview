{"id": 2964, "title": "Ticket #2964: Failure to checkpoint.", "description": "<blockquote>\n<div class=\"code\">\n<pre class=\"code\">04/24/12 10:25:10 (?.?) (6655):argv[4] = 114225\n04/24/12 10:25:10 (?.?) (6655):Hostname = \"&lt;10.10.2.37:38967&gt;\", Job = 114225.0\n04/24/12 10:25:10 (114225.0) (6655):Reading job ClassAd from STDIN\n04/24/12 10:25:10 (114225.0) (6655):Shadow: Entering send_job()\n04/24/12 10:25:10 (114225.0) (6655):Initialized the following authorization table:\n04/24/12 10:25:10 (114225.0) (6655):Authorizations yet to be resolved:\n04/24/12 10:25:10 (114225.0) (6655):allow READ:  */172.16.0.0/12 */10.0.0.0/8\n04/24/12 10:25:10 (114225.0) (6655):allow WRITE:  */172.16.0.0/12 */10.0.0.0/8\n04/24/12 10:25:10 (114225.0) (6655):allow NEGOTIATOR:  */condormaster.atlas.local */10.20.30.100\n04/24/12 10:25:10 (114225.0) (6655):allow ADMINISTRATOR:  */10.20.30.1 */atlas1\n04/24/12 10:25:10 (114225.0) (6655):allow OWNER:  */130.75.116.10 */atlas1.atlas.aei.uni-hannover.de */10.20.30.1 */atlas1\n04/24/12 10:25:10 (114225.0) (6655):allow DAEMON:  */172.16.0.0/12 */10.0.0.0/8\n04/24/12 10:25:10 (114225.0) (6655):allow ADVERTISE_STARTD:  */172.16.0.0/12 */10.0.0.0/8\n04/24/12 10:25:10 (114225.0) (6655):allow ADVERTISE_SCHEDD:  */172.16.0.0/12 */10.0.0.0/8\n04/24/12 10:25:10 (114225.0) (6655):allow ADVERTISE_MASTER:  */172.16.0.0/12 */10.0.0.0/8\n04/24/12 10:25:10 (114225.0) (6655):send capability &lt;10.10.2.37:38967&gt;#1334561359#944#...\n04/24/12 10:25:10 (114225.0) (6655):Requesting Primary Starter\n04/24/12 10:25:10 (114225.0) (6655):Shadow: Request to run a job was ACCEPTED\n04/24/12 10:25:10 (114225.0) (6655):host = n0237.atlas.local inet_addr = 0x25020a0a port1 = 44494 port2 = 52468\n04/24/12 10:25:10 (114225.0) (6655):Shadow: RSC_SOCK connected, fd = 17\n04/24/12 10:25:10 (114225.0) (6655):Shadow: CLIENT_LOG connected, fd = 18\n04/24/12 10:25:10 (114225.0) (6655):FileLock object is updating timestamp on: /tmp/condorLocks/44/55/88557963018616.lockc\n04/24/12 10:25:10 (114225.0) (6655):UserLog = /local/user/tdent/s6logs/inspiral_hipe_full_data.FULL_DATA-02127798502833299288.log\n04/24/12 10:25:10 (114225.0) (6655):My_Filesystem_Domain = \"atlas.local\"\n04/24/12 10:25:10 (114225.0) (6655):My_UID_Domain = \"atlas.local\"\n04/24/12 10:25:10 (114225.0) (6655):HandleSyscalls: about to chdir(/home/tdent/S6/highmass/focused/eobnrv2/S5_comparison_5ms_cluster/949449543-955497687/././full_data)\n04/24/12 10:25:10 (114225.0) (6655):    Entering pseudo_get_file_stream\n04/24/12 10:25:10 (114225.0) (6655):    file =\n\"/home/tdent/S6/highmass/focused/eobnrv2/S5_comparison_5ms_cluster/949449543-955497687/full_data/../executables/lalapps_inspiral\"\n04/24/12 10:25:10 (114225.0) (6655):    len = 29232699\n04/24/12 10:25:10 (114225.0) (6655):    connect_sock = 4\n04/24/12 10:25:10 (114225.0) (6655):    Listening...\n04/24/12 10:25:10 (114225.0) (7277):    Should Send 29232699 bytes of data\n04/24/12 10:25:15 (114225.0) (7277):    Child Shadow: STREAM FILE XFER COMPLETE - 29232699 bytes\n04/24/12 10:25:15 (114225.0) (7277):FileLock::obtain(2) - @1335255915.930050 lock on /tmp/condorLocks/44/55/88557963018616.lockc now UNLOCKED\n04/24/12 10:25:15 (114225.0) (7277):FileLock::obtain(1) - @1335255915.930132 lock on /tmp/condorLocks/44/55/88557963018616.lockc now WRITE\n04/24/12 10:25:15 (114225.0) (7277):directory_util::rec_clean_up: file /tmp/condorLocks/44/55/88557963018616.lockc has been deleted.\n04/24/12 10:25:15 (114225.0) (7277):Lock file /tmp/condorLocks/44/55/88557963018616.lockc has been deleted.\n04/24/12 10:25:15 (114225.0) (7277):FileLock::obtain(2) - @1335255915.930305 lock on /tmp/condorLocks/44/55/88557963018616.lockc now UNLOCKED\n04/24/12 10:25:15 (114225.0) (6655):Reaped child status - pid 7277 exited with status 0\n04/24/12 10:25:16 (114225.0) (6655):FileLock::obtain(2) - @1335255916.467104 lock on /tmp/condorLocks/44/55/88557963018616.lockc now UNLOCKED\n04/24/12 10:25:16 (114225.0) (6655):FileLock::obtain(1) - @1335255916.467226 lock on /tmp/condorLocks/44/55/88557963018616.lockc now WRITE\n04/24/12 10:25:16 (114225.0) (6655):scheddname = atlas1.atlas.aei.uni-hannover.de\n04/24/12 10:25:16 (114225.0) (6655):executeHost = &lt;10.10.2.37:38967&gt;\n04/24/12 10:25:16 (114225.0) (6655):start = &lt;10.10.2.37:38967&gt;\n04/24/12 10:25:16 (114225.0) (6655):end = :38967&gt;\n04/24/12 10:25:16 (114225.0) (6655):tmpaddr = 10.10.2.37\n04/24/12 10:25:16 (114225.0) (6655):Executehost name = &lt;10.10.2.37:38967&gt; (executeHost)\n04/24/12 10:25:16 (114225.0) (6655):FileLock::obtain(2) - @1335255916.470341 lock on /tmp/condorLocks/44/55/88557963018616.lockc now UNLOCKED\n04/24/12 10:25:16 (114225.0) (6655):Read: User Job - $CondorPlatform: x86_64_deb_6.0-updated $\n04/24/12 10:25:16 (114225.0) (6655):Read: User Job - $CondorVersion: 7.6.6 Jan 17 2012 BuildID: 401976 $\n04/24/12 10:25:16 (114225.0) (6655):User job version '$CondorVersion: 7.6.6 Jan 17 2012 BuildID: 401976 $' is compatible with this shadow version '$CondorVersion: 7.6.6 Jan 17\n2012 BuildID: 401976 $'\n04/24/12 10:25:17 (114225.0) (6655):Read: Checkpoint file name is \"/local/condor/spool/4225/0/cluster114225.proc0.subproc0\"\n04/24/12 11:55:12 (114225.0) (6655):Read: received ckpt signal 12, but deferred it for later\n04/24/12 12:27:10 (114225.0) (6655):Read: _condor_ckpt_enable: forcing a deferred checkpoint on signal 12\n04/24/12 12:27:10 (114225.0) (6655):Read: Got SIGUSR2\n04/24/12 12:27:10 (114225.0) (6655):Read: Saved signal state.\n04/24/12 12:27:10 (114225.0) (6655):Read: About to save file state\n04/24/12 12:27:10 (114225.0) (6655):Read: CondorFileTable::checkpoint\n04/24/12 12:27:10 (114225.0) (6655):Read: OPEN FILE TABLE:\n04/24/12 12:27:10 (114225.0) (6655):Read: fd 4\n04/24/12 12:27:10 (114225.0) (6655):Read:       logical name: network connection\ns\n04/24/12 12:27:10 (114225.0) (6655):Read:       offset:       0\n04/24/12 12:27:10 (114225.0) (6655):Read:       dups:         1\n04/24/12 12:27:10 (114225.0) (6655):Read:       open flags:   0x2\n04/24/12 12:27:10 (114225.0) (6655):Read:       url:\n04/24/12 12:27:10 (114225.0) (6655):Read:       size:         -1\n04/24/12 12:27:10 (114225.0) (6655):Read:       opens:        1\n04/24/12 12:27:10 (114225.0) (6655):Read: working dir = /home/tdent/S6/highmass/focused/eobnrv2/S5_comparison_5ms_cluster/949449543-955497687/././full_data\n04/24/12 12:27:10 (114225.0) (6655):error: Error: Unable to commit data to file !\n04/24/12 12:27:10 (114225.0) (6655):Read: Error: Unable to commit data to file !\n04/24/12 12:27:11 (114225.0) (6655):send capability &lt;10.10.2.37:38967&gt;#1334561359#944#...\n04/24/12 12:27:11 (114225.0) (6655):Sent command 404 to startd at &lt;10.10.2.37:38967&gt; with cap &lt;10.10.2.37:38967&gt;#1334561359#944#...\n04/24/12 12:27:11 (114225.0) (6655):Shadow: Job 114225.0 exited, termsig = 9, coredump = 0, retcode = 0\n04/24/12 12:27:11 (114225.0) (6655):Entering Wrapup()\n04/24/12 12:27:11 (114225.0) (6655):handle_termination() called.\n04/24/12 12:27:11 (114225.0) (6655):Shadow: Job was kicked off without a checkpoint\n04/24/12 12:27:11 (114225.0) (6655):Shadow: Entered DoCleanup()\n04/24/12 12:27:11 (114225.0) (6655):Shadow: DoCleanup: unlinking TmpCkpt '/local/condor/spool/4225/0/cluster114225.proc0.subproc0.tmp'\n04/24/12 12:27:11 (114225.0) (6655):Trying to unlink /local/condor/spool/4225/0/cluster114225.proc0.subproc0.tmp\n04/24/12 12:27:11 (114225.0) (6655):Remove from ckpt server returns -1\n04/24/12 12:27:11 (114225.0) (6655):user_time = 8 ticks\n04/24/12 12:27:11 (114225.0) (6655):sys_time = 1 ticks\n04/24/12 12:27:11 (114225.0) (6655):Entering update_rusage()\n04/24/12 12:27:11 (114225.0) (6655):Entering update_rusage()\n04/24/12 12:27:11 (114225.0) (6655):TIME DEBUG 3 USR remotep=0 Proc=0 utime=0.000000\n04/24/12 12:27:11 (114225.0) (6655):TIME DEBUG 4 SYS remotep=0 Proc=0 utime=0.000000\n04/24/12 12:27:11 (114225.0) (6655):FileLock::obtain(2) - @1335263231.373701 lock on /tmp/condorLocks/44/55/88557963018616.lockc now UNLOCKED\n04/24/12 12:27:11 (114225.0) (6655):FileLock::obtain(1) - @1335263231.373761 lock on /tmp/condorLocks/44/55/88557963018616.lockc now WRITE\n04/24/12 12:27:11 (114225.0) (6655):FileLock::obtain(2) - @1335263231.374028 lock on /tmp/condorLocks/44/55/88557963018616.lockc now UNLOCKED\n04/24/12 12:27:11 (114225.0) (6655):********** Shadow Exiting(107) **********\n</pre></div>\n\n\n<p></p><pre>  Carsten Aulbert writes:\n  &gt; This seem to affect only Tom Dent's jobs right now, but it seems to be 100%\n  &gt; reproducible for this (sub)type of jobs.\n</pre>\n\n<p></p><pre>  &gt; one of the developers in this code said there's is no networking code\n  &gt; in this tool\n</pre>\n\n<p></p><pre>  &gt; one currently running job as a few fd open:\n</pre>\n\n<p></p><pre>  &gt; root@n0196:/proc/26923# for i in fd/*; do TMP=$(readlink $i | grep socket |\n  &gt; tr -cd '0-9'); if [ -z \"$TMP\" ]; then continue; fi; echo \"**** socket $TMP\";\n  &gt; echo -n \"netstat: \"; netstat -nxp | grep $TMP; echo \"/proc/net/unix: \";\n  &gt; grep $TMP /proc/net/unix; done\n</pre>\n\n<p></p><div class=\"code\">\n<pre class=\"code\">**** socket 3540770\nnetstat: unix  2      [ ]         STREAM                   3540770 26923/condor_exec.1\n/proc/net/unix: ffff880208092d80: 00000002 00000000 00000000 0001 01 3540770\n**** socket 3540692\nnetstat: /proc/net/unix:\n**** socket 3540693\nnetstat: /proc/net/unix:\n**** socket 3540693\nnetstat: /proc/net/unix:\n**** socket 3540771\nnetstat: unix  2      [ ]         STREAM                   3540771 26923/condor_exec.1\n/proc/net/unix: ffff88020838f440: 00000002 00000000 00000000 0001 01 3540771\n</pre></div>\n\n\n<p></p><pre>  &gt; Interestingly, two sockets seem to be connected at all and one is open\n  &gt; twice - but I'm not sure if that ok or not.</pre>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-May-07 13:30:14 by tlmiller:</em> <br/>\n\nOther incidents reported to the Condor-LIGO list raise the possibility that this is a bug in glibc, where a (Unix domain) socket used to communicate with nscd is (improperly) never closed.  Jaime is testing a build where the patch for older versions of glibc (turning off nscd) is applied to the newer version, which supposedly fixed the problem.  Will update this incident report.\n\n<p></p><hr/>\n<em>2012-May-07 14:02:46 by tlmiller:</em> <br/>\n\nDuncan Brown confirms that commenting out a call to getpwuid() permits the application in question to checkpoint and will proceed using that work-around until we fix the problem on our end.\n\n<p></p><hr/>\n<em>2012-May-07 16:46:01 by tlmiller:</em> <br/>\n\nFixed by <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2973\" onclick=\"get_ticket_and_populate_wrapper('2973'); return false;\" title=\"Standard universe may never checkpoint when nscd isn't running\">#2973</a></span>.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "incident", "last_change": "2012-May-07 16:46", "status": "defer", "created": "2012-May-01 13:42", "fixed_version": "2012-May-01 13:42", "broken_version": "", "priority": "5", "subsystem": "Std", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pcouvare@caltech.edu", "due_date": ""}