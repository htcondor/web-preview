{"id": 7728, "title": "Ticket #7728: Make BaTLab docs build more stable", "description": "<blockquote>\nI accidentally broke the BaTLab docs builds for a few hours last week because I added a new extension in <code>docs/conf.py</code>. This broke the build because we do a stripped-down Sphinx run that only builds the man pages, and therefore doesn't need any extra extensions. The problem is that this is driven by a patch file that needed to be updated when I changed the extensions list. This was annoying, and was doubly-annoying because it wasn't obvious that it would be happen.\n\n<p>I propose a fix: since the <code>extensions</code> Sphinx configuration attribute is just a list built up at runtime, we should set an environment variable during the BaTLab docs build that explicitly switches it to the more constrained list. That would look something like:\n</p><div class=\"code\">\n<pre class=\"code\">if os.getenv(\"BUILD_ONLY_MAN_PAGES\"):\n    extensions = [\n        ...  # whatever extensions are needed for the man page build... maybe none?\n    ]\nelse:\n    extensions = [\n        'sphinx.ext.autosectionlabel',\n        'sphinx.ext.intersphinx',\n        'sphinx.ext.autodoc',\n        'sphinx.ext.napoleon',\n        'sphinx_autodoc_typehints',\n        'nbsphinx',\n        'ticket',\n        'macro',\n        'macro-def',\n        'index',\n    ]\n</pre></div>\n\n\n<p>This should make it easier to not break the build by accident.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Jul-28 07:58:48 by tim:</em> <br/>\n\nRead the docs results reviewed by Josh Karpel and approved.\nMan pages identical before and after changes.\n\n<p>No documentation needed, internal build processes.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-27 12:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/986388bc4ea0ab9f0d18f1a4315983c903858a71\">[60238]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7728\" onclick=\"get_ticket_and_populate_wrapper('7728'); return false;\" title=\"Make BaTLab docs build more stable\">#7728</a></span>) Fix broken full_conf import  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-27 10:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6d9108e49f25a363ebf5fee05cd471a8a496b7d7\">[60233]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7728\" onclick=\"get_ticket_and_populate_wrapper('7728'); return false;\" title=\"Make BaTLab docs build more stable\">#7728</a></span>) Robust manpage generation Often changes to conf.py causes build failures on various platform. Refactor conf.py to only contain things needed for man page generation. If generating the full manual, import from full_conf.py. Duplicate code is eliminated.  (By Tim Theisen )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Jul-28 07:58", "status": "resolved", "created": "2020-Jul-06 18:09", "fixed_version": "2020-Jul-06 18:09", "broken_version": "", "priority": "2", "subsystem": "Packaging", "assigned_to": "tim", "derived_from": "", "creator": "karpel", "rust": "", "customer_group": "other", "visibility": "public", "notify": "karpel@wisc.edu", "due_date": ""}