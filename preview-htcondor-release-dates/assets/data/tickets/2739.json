{"id": 2739, "title": "Ticket #2739: condor_chirp closes the same FD twice - Asserts on Windows", "description": "<blockquote>\nWhen condor_chirp opens a socket to the starter, it then uses fdopen twice on the same socket handle to get a \"r\" and \"w\" stream.  This works, but after the command completes it tries to fclose() each stream.  The windows version of the c-runtime treats the seconds fclose() as an error because the underlying socket handle was closed by the first fclose, thus condor_chirp always returns a non-zero error code on Windows.\n\n<p>This seems to be a case of wrong code that is relatively harmless, which Linux ignores and Windows treats as an error.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-11 13:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8e08c0f2a8114684f9af3222bad68e8af1651146\">[29068]</a></span>: Hopefully did a correct edit of 7.6.6 version history items ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2739\" onclick=\"get_ticket_and_populate_wrapper('2739'); return false;\" title=\"condor_chirp closes the same FD twice - Asserts on Windows\">#2739</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2743\" onclick=\"get_ticket_and_populate_wrapper('2743'); return false;\" title=\"condor_chirp put and putfile doesnt work on Windows\">#2743</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-04 17:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4da607094d8bf0ebe28f911fb1ef51e661191ff6\">[28983]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2739\" onclick=\"get_ticket_and_populate_wrapper('2739'); return false;\" title=\"condor_chirp closes the same FD twice - Asserts on Windows\">#2739</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2743\" onclick=\"get_ticket_and_populate_wrapper('2743'); return false;\" title=\"condor_chirp put and putfile doesnt work on Windows\">#2743</a></span> ===VersionHistory:Complete===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-04 16:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/49f475aa22590d208cdeea85da59cd5fb88c4ee5\">[28981]</a></span>: fixes for 2 chirp bugs on Windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2743\" onclick=\"get_ticket_and_populate_wrapper('2743'); return false;\" title=\"condor_chirp put and putfile doesnt work on Windows\">#2743</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2739\" onclick=\"get_ticket_and_populate_wrapper('2739'); return false;\" title=\"condor_chirp closes the same FD twice - Asserts on Windows\">#2739</a></span>. All chirp commands enabled in NTSenders for Windows, since it may be talking to Linux Shadow which implements them all. putfile, getfile, getdir and whoami implementations in the Shadow now build on Windows as well, the code for these was already fine\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-May-03 09:15", "status": "resolved", "created": "2012-Jan-03 16:53", "fixed_version": "2012-Jan-03 16:53", "broken_version": "v070605", "priority": "2", "subsystem": "Win32", "assigned_to": "gthain", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "users", "visibility": "public", "notify": "", "due_date": ""}