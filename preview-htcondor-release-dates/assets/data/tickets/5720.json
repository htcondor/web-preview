{"id": 5720, "title": "Ticket #5720: Parse error for JobAdInformationAttrs from SUBMIT_ATTRS when quoted", "description": "<blockquote>\nIn 8.4.7 something like:\n+MyTag = pippo2, pippo3\n\n<p>gives an error:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">Submitting job(s)\nERROR: Parse error in expression:\n\tMyTag = pippo2, pippo3\n\t^^^\nError in submit file\n</pre></div>\n\n\n<p>Same happens for macros in the config file and SUBMIT_EXPRS\nIf any of the macros/attributes mentioned there is a list it triggers the error\n\n</p><p>It was OK in 8.4.6</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Jun-09 17:16:53 by tannenba:</em> <br/>\n\nAt first blush, it looks to me like condor_submit is correct in flagging it an error.\n\n<p>Perhaps you meant\n</p><div class=\"code\">\n<pre class=\"code\">MyTag = \"pippo2, pippo3\"\n</pre></div>\n\n\n<p>Note the quotation marks....\n\n</p><p></p><hr/>\n<em>2016-Jun-13 14:45:13 by marco:</em> <br/>\n\nThe problem has been discussed further with Todd after the ticket had been closed by Todd.\nIt happens with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobAdInformationAttrs\" title=\"Job Ad Information Attrs\">JobAdInformationAttrs</a></span> added inSUBMIT_EXPRS in the config file.\n\n<p>There is no syntax that works correctly in 8.4.7 and &gt;=8.4.6\n\n</p><p>In 8.4.7\n</p><div class=\"code\">\n<pre class=\"code\">JobAdInformationAttrs = \"JOB_GLIDEIN_SiteWMS, JOB_GLIDEIN_SiteWMS_Slot\"\nSUBMIT_EXPRS = JobAdInformationAttrs\n</pre></div>\n\n&amp;#65533;&gt; causes quotes in the classad (condor_q -l):\n<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobAdInformationAttrs\" title=\"Job Ad Information Attrs\">JobAdInformationAttrs</a></span> = \"\\\"JOB_GLIDEIN_SiteWMS, JOB_GLIDEIN_SiteWMS_Slot\\\"\"\n\n<p></p><div class=\"code\">\n<pre class=\"code\">JobAdInformationAttrs = JOB_GLIDEIN_SiteWMS, JOB_GLIDEIN_SiteWMS_Slot\nSUBMIT_EXPRS = JobAdInformationAttrs\n</pre></div>\n\n&amp;#65533;&gt; gives the parsing error\n\n<p>The following works in 8.4.7 but is ignored in 8.4.6 (there is no trace in the classad)\n</p><div class=\"code\">\n<pre class=\"code\">SUBMIT_EXPRS = +JobAdInformationAttrs\nJobAdInformationAttrs = \"JOB_GLIDEIN_SiteWMS, JOB_GLIDEIN_SiteWMS_Slot\"\n</pre></div>\n\n\n<p></p><hr/>\n<em>2016-Jun-13 15:13:16 by tim:</em> <br/>\n\nChanges made for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5694\" onclick=\"get_ticket_and_populate_wrapper('5694'); return false;\" title=\"SUBMIT_ATTRS can't set JobLeaseDuration to an expression\">#5694</a></span> triggered this issue. In discussion at our weekly meeting, we decided that the current implementation is still not correct. Check with ToddT for the desired specification.\n\n<p></p><hr/>\n<em>2016-Jun-14 10:20:43 by tim:</em> <br/>\n\nThe configuration file could account for HTCondor version:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">if version &lt;= 8.4.6\n    JobAdInformationAttrs = $(JOB_GLIDEIN_ATTRS) $(JOB_GLIDEIN_SITEWMS_ATTRS)\n    SUBMIT_EXPRS = $(SUBMIT_EXPRS) $(JOB_GLIDEIN_ATTRS) $(JOB_GLIDEIN_SITEWMS_ATTRS) JobAdInformationAttrs\nelif version &gt;= 8.5.0\n    if version &lt;= 8.5.4\n        JobAdInformationAttrs = $(JOB_GLIDEIN_ATTRS) $(JOB_GLIDEIN_SITEWMS_ATTRS)\n        SUBMIT_EXPRS = $(SUBMIT_EXPRS) $(JOB_GLIDEIN_ATTRS) $(JOB_GLIDEIN_SITEWMS_ATTRS) JobAdInformationAttrs\n    elif version == 8.5.5\n        JobAdInformationAttrs = \"$(JOB_GLIDEIN_ATTRS) $(JOB_GLIDEIN_SITEWMS_ATTRS)\"\n        SUBMIT_EXPRS = $(SUBMIT_EXPRS) $(JOB_GLIDEIN_ATTRS) $(JOB_GLIDEIN_SITEWMS_ATTRS) +JobAdInformationAttrs\n    else\n        JobAdInformationAttrs = \"$(JOB_GLIDEIN_ATTRS) $(JOB_GLIDEIN_SITEWMS_ATTRS)\"\n        SUBMIT_EXPRS = $(SUBMIT_EXPRS) $(JOB_GLIDEIN_ATTRS) $(JOB_GLIDEIN_SITEWMS_ATTRS) JobAdInformationAttrs\n    endif\nelif version == 8.4.7\n    JobAdInformationAttrs = \"$(JOB_GLIDEIN_ATTRS) $(JOB_GLIDEIN_SITEWMS_ATTRS)\"\n    SUBMIT_EXPRS = $(SUBMIT_EXPRS) $(JOB_GLIDEIN_ATTRS) $(JOB_GLIDEIN_SITEWMS_ATTRS) +JobAdInformationAttrs\nelse\n    JobAdInformationAttrs = \"$(JOB_GLIDEIN_ATTRS) $(JOB_GLIDEIN_SITEWMS_ATTRS)\"\n    SUBMIT_EXPRS = $(SUBMIT_EXPRS) $(JOB_GLIDEIN_ATTRS) $(JOB_GLIDEIN_SITEWMS_ATTRS) JobAdInformationAttrs\nendif\n</pre></div>\n\n\n<p></p><hr/>\n<em>2016-Jun-14 14:10:38 by johnkn:</em> <br/>\n\nThis bug was sort of specific to <code>JobAdInformationAttrs</code>.  There was a bug that would treat this attribute in <code>SUBMIT_EXPRS</code> or <code>SUBMIT_ATTRS</code> as if it were in the submit file and it would ALWAYS quote the value.\n\n<p>There was another bug that made failure to parse the value of <code>JobAdInformationAttrs</code> using <span class=\"quote\">ClassAd</span> syntax would fail silently.\n\n</p><p>These two bugs conspired to require that <code>JobAdInformationAttrs</code> in <code>SUBMIT_EXPRS</code> be unquoted even thought the correct form would have been\nto quote the value in the config file.\n\n</p><p>We fixed the bug that made the failure to parse the value as a <span class=\"quote\">ClassAd</span> value a silent failure, but added the +Attr syntax - this lead to the situation where the workaround was the only thing that worked.  That will continue to work in future versions of HTCondor, but the correct thing going forward will be\n\n</p><p></p><pre>    SUBMIT_ATTRS = MyAttr\n    MyAttr = \"string, value\"\n</pre>\n\n<p></p><hr/>\n<em>2016-Jun-28 15:04:28 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>These changes look good.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jun-29 12:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ed86137c13586c46697e1c5600b5616f4011bf7d\">[48694]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5720\" onclick=\"get_ticket_and_populate_wrapper('5720'); return false;\" title=\"Parse error for JobAdInformationAttrs from SUBMIT_ATTRS when quoted\">#5720</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jun-15 16:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/805d1e657fd31b9978962aea640a008fd0e4b547\">[48561]</a></span>: extend the fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5720\" onclick=\"get_ticket_and_populate_wrapper('5720'); return false;\" title=\"Parse error for JobAdInformationAttrs from SUBMIT_ATTRS when quoted\">#5720</a></span> to submit_utils for the devel branch  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jun-15 09:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b4837bcc8c60c6e2f9540a1b93b0399cb187b95d\">[48547]</a></span>: fix <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5720\" onclick=\"get_ticket_and_populate_wrapper('5720'); return false;\" title=\"Parse error for JobAdInformationAttrs from SUBMIT_ATTRS when quoted\">#5720</a></span>, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobAdInformationAttrs\" title=\"Job Ad Information Attrs\">JobAdInformationAttrs</a></span> in SUBMIT_ATTRS or SUBMIT_EXPRS produces a parse error when the value is quoted in the config file. Since the value is supposed to be a string, the value in the config file SHOULD be quoted, but a pair of bugs in results in the handling of SUBMIT_ATTRS to fail silently\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Jun-29 14:48", "status": "resolved", "created": "2016-Jun-09 16:49", "fixed_version": "2016-Jun-09 16:49", "broken_version": "v080407", "priority": "1", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "", "creator": "marco", "rust": "", "customer_group": "fermi", "visibility": "public", "notify": "marcom@fnal.gov, tannenba@cs.wisc.edu, zmiller@cs.wisc.edu", "due_date": ""}