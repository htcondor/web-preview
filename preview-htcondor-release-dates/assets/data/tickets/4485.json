{"id": 4485, "title": "Ticket #4485: Testing with shared port on - impact", "description": "<blockquote>\nWhat happens to our test runs when shared port is on?\n\n<p>First thing we encountered was string for the daemon ports being too long\nand though brian is patching this I needed an immediate test method. For now the testing framework uses a shorter path in /tmp and hopefully cleans it at the end of the test run. That folder is stored in the file SOCKETDIR in condor_tests.\nWorkstation tests have to recreate this file and contents to run .\n\n</p><p>condor_view_classad_types.run was broken because it only tried to parse a non-shared port address but not parses either.\n\n</p><p>job_services_during_neg_cycle.run broke because running with the shared port\ntrue displays a bug where userprio calls now again wait for the end of the negotiation cycle.\n\n</p><p>lib_ccb_schedd.run and lib_ccb_startd.run fail because what they expect to see as chatter within the collector log doen's happen with the shared port daemon handling things.\n\n</p><p>The last three are fixed for now by their turning off the shared port daemon\nfor the condors they configure and run.</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Jul-24 19:54:35 by bbockelm:</em> <br/>\n\nYou shouldn't need to manually set the DAEMON_SOCKET_DIR for tests anymore - the condor_master will do this automatically if it detects the path is too long.  See <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4465\" onclick=\"get_ticket_and_populate_wrapper('4465'); return false;\" title=\"Improve DAEMON_SOCKET_DIR\">#4465</a></span>.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jul-24 12:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f8d00bf4e2734f5d25dd6712fbd2575848d94ec3\">[40751]</a></span>: When the shared port daemon is requested, in our test framework the path is to long to open the daemon shared port socket. We now relocate the daemon directory to a unique folder in /tmp/tds$$. When we are done with a run, we remove it. We place this unique path into condor_tests/SOCKETDIR and CondorPersonal.pm\u00a0[...]\n (By Bill Taylor )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Jul-24 19:54", "status": "new", "created": "2014-Jul-24 12:27", "fixed_version": "2014-Jul-24 12:27", "broken_version": "", "priority": "4", "subsystem": "Tests", "assigned_to": "bt", "derived_from": "#3594", "creator": "bt", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "johnkn@cs.wisc.edu", "due_date": ""}