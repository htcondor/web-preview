{"id": 3864, "title": "Ticket #3864: Improve UPDATE_JOBAD handling in the schedd", "description": "<blockquote>\nWe've recently discovered some bugs and inefficiencies in how the schedd handles sending UPDATE_JOBAD signals to the shadow/gridmanager when a user qedits a job. The bugs have been fixed in 8.0. Other issues should be addressed in 8.1.\n\n<p></p><ul>\n<li>DAGMan shouldn't use SETDIRTY flag (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3863\" onclick=\"get_ticket_and_populate_wrapper('3863'); return false;\" title=\"DAGMan shouldn't set logging flags when updating its job ad\">#3863</a></span>)\n</li><li>Schedd shouldn't try to notify scheduler universe jobs (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3785\" onclick=\"get_ticket_and_populate_wrapper('3785'); return false;\" title=\"schedd tries to send UPDATE_JOBAD to scheduler universe jobs\">#3785</a></span>)\n</li><li>In SetAttribute(), don't try to send an UPDATE_JOBAD if the job is already in DirtyJobIDs (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3909\" onclick=\"get_ticket_and_populate_wrapper('3909'); return false;\" title=\"Make UPDATE_JOBAD handling more efficient in the schedd\">#3909</a></span>)\n</li><li>The gridmanager should only be signaled once for all jobs it's managing, not once for each job. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3909\" onclick=\"get_ticket_and_populate_wrapper('3909'); return false;\" title=\"Make UPDATE_JOBAD handling more efficient in the schedd\">#3909</a></span>)\n</li><li>If there's no shadow or gridmanager for a job, the dirty bits should cleared and the job should be removed from DirtyJobIDs. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3909\" onclick=\"get_ticket_and_populate_wrapper('3909'); return false;\" title=\"Make UPDATE_JOBAD handling more efficient in the schedd\">#3909</a></span>)\n</li><li>Local and standard universe jobs aren't handled properly.\n<ul>\n<li>For now, prevent the schedd from trying to send signals for these jobs (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3909\" onclick=\"get_ticket_and_populate_wrapper('3909'); return false;\" title=\"Make UPDATE_JOBAD handling more efficient in the schedd\">#3909</a></span>)\n</li></ul>\n</li><li>Do we need a periodic timer to constantly send UPDATE_JOBAD signals to the shadows/gridmanagers?\n<ul>\n<li>Yes, because shadow only tries to retrieve dirty attributes once.\n</li></ul>\n</li><li>Should DirtyJobIDs be a hashtable with PROC_ID keys?\n</li><li>Dirty attribute tracking and shadow/gridmanager notification isn't transaction-aware.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3785\" onclick=\"get_ticket_and_populate_wrapper('3785'); return false;\" title=\"schedd tries to send UPDATE_JOBAD to scheduler universe jobs\">#3785</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nschedd tries to send UPDATE_JOBAD to scheduler universe jobs</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3909\" onclick=\"get_ticket_and_populate_wrapper('3909'); return false;\" title=\"Make UPDATE_JOBAD handling more efficient in the schedd\">#3909</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nMake UPDATE_JOBAD handling more efficient in the schedd</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2013-Sep-11 17:00", "status": "new", "created": "2013-Aug-20 10:16", "fixed_version": "2013-Aug-20 10:16", "broken_version": "v080000", "priority": "4", "subsystem": "DaemonsSubmitNode", "assigned_to": "", "derived_from": "#1790", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}