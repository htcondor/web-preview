{"id": 2956, "title": "Ticket #2956: Cannot use \"/\" as a named chroot", "description": "<blockquote>\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2822\" onclick=\"get_ticket_and_populate_wrapper('2822'); return false;\" title=\"Improve cleanup of chroot execute dirs\">#2822</a></span> introduced a bug where Condor tries to create the execute directory twice if the target chroot is \"/\".\n\n<p>This is because the starter creates the execute directory, then the chroot code tries to create \"$CHROOT/$EXECUTE_DIR\" - and, if CHROOT=/, it tries to create //$EXECUTE_DIR, which already exists.\n\n</p><p>The use case for us is having a cluster where \"SL5\" refers to a chroot-on-SL6 for some hosts, while it is the real-root on other hosts.  Hence, all jobs ask for \"SL5\" (fwiw, we worked through this by simply turning off all SL5 nodes :).\n\n</p><p>Patch incoming - the simple way to fix this is not invoke any of the chroot business if the target chroot is \"/\".</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Apr-27 10:58:46 by tstclair:</em> <br/>\n\nWhat is the use case for chrooting to \"/\", you could give full control to a non-priv user?\n\n<p></p><hr/>\n<em>2012-Apr-27 11:18:40 by bbockelm:</em> <br/>\n\nChroot'ing doesn't provide any additional privileges, but it provides new environments.\n\n<p>The use case is a heterogeneous cluster where the \"SL5\" environment is mapped to \"/chroot/sl5\" on some hosts and \"/\" on others.  You want to just have to instruct users to add:\n\n</p><p>RequestChroot=\"SL5\"\n\n</p><p>and have Condor \"do the right thing\", even if the right thing is to use \"/\" (i.e., a no-op).\n\n</p><p></p><hr/>\n<em>2012-Apr-27 11:26:00 by tstclair:</em> <br/>\n\nreviewed and pushed</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=2981\" onclick=\"get_ticket_and_populate_wrapper('2981'); return false;\" title=\"If NAMED_CHROOT invalid startd fails to run anything\">#2981</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nIf NAMED_CHROOT invalid startd fails to run anything</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/557/chroot_rootdir.patch\">chroot_rootdir.patch</a>\n1798 bytes added by bbockelm on 2012-Apr-25 00:01:43 UTC.\n<br/>\nPatch.  It would greatly improved if there was an all-singing, all-dancing \"normalize path\" function in condor utils.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-27 11:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/80d86cc2702b844baa28acdf2dd2246b77d9ea9c\">[31840]</a></span>: Update for named chroots which navigate to \"/\" ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2956\" onclick=\"get_ticket_and_populate_wrapper('2956'); return false;\" title='Cannot use \"/\" as a named chroot'>#2956</a></span> ===VersionHistory:None===  (By Timothy St. Clair )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-May-03 09:33", "status": "resolved", "created": "2012-Apr-24 19:01", "fixed_version": "2012-Apr-24 19:01", "broken_version": "v070706", "priority": "4", "subsystem": "Daemons", "assigned_to": "tstclair", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "bbockelm@cse.unl.edu, tstclair@redhat.com, gthain@cs.wisc.edu", "due_date": ""}