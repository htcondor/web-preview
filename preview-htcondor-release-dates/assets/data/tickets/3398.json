{"id": 3398, "title": "Ticket #3398: Batch GAHP cannot set remote memory or walltime requests", "description": "<blockquote>\nThe batch GAHP cannot do some of the \"simple\" job attributes we observe OSG sites utilizing.  In particular we can't specify the following,\n<ul>\n<li>Maximum amount of memory the job is expected to use.\n</li><li>Maximum walltime for the job.\n</li></ul>\n\n<p>These would be beneficial features for both BOSCO and HTCondor-CE.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Jan-10 21:43:51 by dweitzel:</em> <br/>\n\nThe memory requirement is easy, propagate request_memory to the *_submit.sh files.  But the hard part is walltime.  Condor has no concept of a requested walltime, so do we need to make a new attribute?  <code>request_walltime</code> ?\n\n<p></p><hr/>\n<em>2013-Jan-11 07:04:34 by bbockelm:</em> <br/>\n\nI don't think HTCondor has an idea of a \"max wall time\".\n\n<p>I think such a thing would make sense and there's precedent for putting a cap on resources.  In fact, I thought that jobs could even specify an \"estimate runtime\" as part of the condor_defrag work (but can't find it in the code).  I'll CC Dan in case if he has any advice.\n\n</p><p></p><hr/>\n<em>2013-Feb-06 09:43:05 by bbockelm:</em> <br/>\n\nWe just hit the walltime issue in testing HTCondor-CE on tusker.\n\n<p>Jaime, can you review this patch?  Does this go against HTCondor only, or does it also need to be applied against our blahp distribution?\n\n</p><p></p><hr/>\n<em>2013-Feb-06 10:46:01 by dweitzel:</em> <br/>\n\nJust to be clear, the attached patch only adds min_memory, and even that only for Condor resources.  I (someone?) would need to patch each and every one of the *_submit.sh scripts to include the min_memory request.\n\n<p>In order to add the min_walltime (or whatever it will be called), someone will have to add a whole new submit argument, plus propagate it to the blahp.  So patches all around!\n\n</p><p></p><hr/>\n<em>2013-Feb-06 11:25:20 by bbockelm:</em> <br/>\n\nWell - I think we need to get it done!  Both for BOSCO and HTCondor-CE.\n\n<p>Can you send some pull requests to the github fork of blahp?\n\n</p><p></p><hr/>\n<em>2013-Mar-29 12:42:06 by dweitzel:</em> <br/>\n\nI have added all of the memory patches to get it to work with PBS and Condor.  I would like to figure out the walltime now.  What is the best way to describe walltime?\n\n<p>As you can see, I have a patch that will add <code>request_walltime</code>, and will propagate that to the blahp scripts.  Is this the way it should be done?  I'm not sure.\n\n</p><p>Also, we do not need to add <code>request_cpus</code>, as it is already built into blahp.  I quickly documented it on the <a class=\"external\" href=\"https://twiki.grid.iu.edu/bin/view/CampusGrids/BoscoMPI\">OSG Twiki</a>.\n\n</p><p></p><hr/>\n<em>2013-Apr-02 09:53:35 by jfrey:</em> <br/>\n\nHave you tested the syntax for setting memory requirements for a PBS job? I believe you need to include units on your \"#PBS -l mem=...\" lines, specifically \"mb\".\n\n<p></p><hr/>\n<em>2013-Apr-02 10:52:06 by dweitzel:</em> <br/>\n\nYes, you are correct about the mb.  When I tested it, I didn't inspect the memory requested.  Just tested again, and without the mb, it defaults to bytes!\n\n<p></p><hr/>\n<em>2013-May-07 14:36:11 by jfrey:</em> <br/>\n\nPropagating <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> through the blahp is included in 7.9.6. Adding a way to set a wallclock time limit for blahp jobs isn't in. We'll make a sub-ticket for that when we get to it.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4367\" onclick=\"get_ticket_and_populate_wrapper('4367'); return false;\" title=\"Bosco Blahp fails for condor on rhel6+ systems\">#4367</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nBosco Blahp fails for condor on rhel6+ systems</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/670/0001-Adding-request_memory-propagation-to-the-blahp-3398.patch\">0001-Adding-request_memory-propagation-to-the-blahp-3398.patch</a>\n3068 bytes added by dweitzel on 2013-Jan-11 03:35:08 UTC.\n<br/>\nAttaching an initial patch to propagate the <code>request_memory</code> from the submit file to the blahp.  I've tested that it does propagate the request memory to the -m option of the LRMS submitter.\n\n<p>It is still required to actually patch every single *_submit.sh in the blahp to interpret the -m option as the requested memory.<br/>\n</p></li><li><a href=\"../files/681/0001-Adding-RequestWalltime-attribute-to-propagate-to-bla.patch\">0001-Adding-RequestWalltime-attribute-to-propagate-to-bla.patch</a>\n2753 bytes added by dweitzel on 2013-Feb-06 19:24:45 UTC.\n<br/>\nV2 of patch.  Adds <code>request_walltime</code> to the submit file that will be propagated to the blahp.<br/>\n</li><li><a href=\"../files/712/condor_submit.memory.patch\">condor_submit.memory.patch</a>\n845 bytes added by dweitzel on 2013-Mar-29 17:38:25 UTC.\n<br/>\nAdding condor_submit.memory.patch<br/>\n</li><li><a href=\"../files/713/pbs_submit.memory.patch\">pbs_submit.memory.patch</a>\n642 bytes added by dweitzel on 2013-Mar-29 17:38:45 UTC.\n<br/>\nAdding pbs_submit.memory.patch<br/>\n</li><li><a href=\"../files/714/common_submit_functions.memory.patch\">common_submit_functions.memory.patch</a>\n813 bytes added by dweitzel on 2013-Mar-29 17:39:03 UTC.\n<br/>\nAdding common submit function memory patch.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-07 17:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/aec470eec260f1cc6076fe6aa4eb8630e64665ac\">[35641]</a></span>: Edit many 7.9.6 version history items, including those for tickets (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3539\" onclick=\"get_ticket_and_populate_wrapper('3539'); return false;\" title=\"change recommended configuration for disabling preemption\">#3539</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3586\" onclick=\"get_ticket_and_populate_wrapper('3586'); return false;\" title=\"move python bindings out of contrib\">#3586</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3398\" onclick=\"get_ticket_and_populate_wrapper('3398'); return false;\" title=\"Batch GAHP cannot set remote memory or walltime requests\">#3398</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3560\" onclick=\"get_ticket_and_populate_wrapper('3560'); return false;\" title=\"improve dprintf code to support audit logs (time based rotation)\">#3560</a></span>, <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2949\" onclick=\"get_ticket_and_populate_wrapper('2949'); return false;\" title=\"peaceful shutdown cannot be escalated to graceful\">#2949</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3493\" onclick=\"get_ticket_and_populate_wrapper('3493'); return false;\" title=\"Audit Log for Condor schedds\">#3493</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3496\" onclick=\"get_ticket_and_populate_wrapper('3496'); return false;\" title=\"monitor file transfer i/o activity\">#3496</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3597\" onclick=\"get_ticket_and_populate_wrapper('3597'); return false;\" title=\"CPU affinity enforcement broken with partitionable slots\">#3597</a></span>, <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=3601\" onclick=\"get_ticket_and_populate_wrapper('3601'); return false;\" title=\"autofs doesn't work with 7.9\">#3601</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3579\" onclick=\"get_ticket_and_populate_wrapper('3579'); return false;\" title=\"condor_updates_stats doesn't work anymore\">#3579</a></span>,) and (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3570\" onclick=\"get_ticket_and_populate_wrapper('3570'); return false;\" title=\"Starter leaks FDs to file transfer plugin\">#3570</a></span>, <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=3588\" onclick=\"get_ticket_and_populate_wrapper('3588'); return false;\" title=\"DHCPREQUEST doesn't have the ending 0xff byte to mark end of options f\">#3588</a></span>)  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-07 14:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b3ed0bdd5969c2616880336cb4d193e3e3883baa\">[35630]</a></span>: Version history for request_memory support in blahp. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3398\" onclick=\"get_ticket_and_populate_wrapper('3398'); return false;\" title=\"Batch GAHP cannot set remote memory or walltime requests\">#3398</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-02 11:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fdc08f99250a1806500c09ee444e6dca5f2a5d34\">[35306]</a></span>: Add support for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> to the blahp. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3398\" onclick=\"get_ticket_and_populate_wrapper('3398'); return false;\" title=\"Batch GAHP cannot set remote memory or walltime requests\">#3398</a></span> Allow users of the blahp to specify the amount of memory required by the job, using the same attribute as for HTCondor job ads. This number (in megabytes) is passed to the submit scripts via the new -m parameter. The PBS and Condor scripts now use it\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-May-07 14:41", "status": "resolved", "created": "2012-Dec-24 15:45", "fixed_version": "2012-Dec-24 15:45", "broken_version": "", "priority": "4", "subsystem": "Grid", "assigned_to": "dweitzel", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu, jfrey@cs.wisc.edu, danb@cs.wisc.edu", "due_date": ""}