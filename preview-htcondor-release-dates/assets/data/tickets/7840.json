{"id": 7840, "title": "Ticket #7840: Make DEACTIVATE_CLAIM command more robust to failure", "description": "<blockquote>\nWhen the shadow decides to abort a job execution (e.g. because the job is removed), it sends a DEACTIVATE_CLAIM command (or a DEACTIVATE_CLAIM_FORCIBLY command) to the startd. To maintain backwards compatibility with pre-7.0.5 startds, the shadow doesn't expect a response to its request. Recently in the BaTLab, we've seen cases where the startd doesn't receive a DEACTIVATE_CLAIM connection request from the shared port daemon before the shared port daemon and the shadow time out. With an existing security session, the shadow assumes the command has been delivered when it was not. The shadow then waits forever for the starter t exit, which will not happen before the job exits.\n\n<p>We should change the shadow to require a response from the startd. If there is no response, the shadow should make a new DEACTIVATE_CLAIM request.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Oct-12 16:45:34 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong> : looks good</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-19 22:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b0589b04c49ff824358c6216b6bb77169b42b1cf\">[61528]</a></span>: Docs for making DEACTIVATE_CLAIM more robust to failure. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7840\" onclick=\"get_ticket_and_populate_wrapper('7840'); return false;\" title=\"Make DEACTIVATE_CLAIM command more robust to failure\">#7840</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-08 14:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/92e9c00c971e4df35a9e825960962d2f9b825dea\">[61240]</a></span>: Make DEACTIVATE_CLAIM command more robust to failure. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7840\" onclick=\"get_ticket_and_populate_wrapper('7840'); return false;\" title=\"Make DEACTIVATE_CLAIM command more robust to failure\">#7840</a></span> The client now requires a response from the startd. With shared port and resuming a security session, the client can send the request and the startd may never receive it. The response from the startd is the only way for the client to know if\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Oct-19 23:03", "status": "resolved", "created": "2020-Sep-04 16:38", "fixed_version": "2020-Sep-04 16:38", "broken_version": "", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}