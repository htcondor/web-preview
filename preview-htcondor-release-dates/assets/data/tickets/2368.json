{"id": 2368, "title": "Ticket #2368: [RFE] add support for condor_suspend && condor_continue", "description": "<blockquote>\nAdd support to be able to condor_suspend &amp;&amp; condor_continue a series of jobs.\n\n<p>This would override the STARTD(s) SUSPEND &amp;&amp; CONTINUE.\n\n</p><p>The route of communication follows the condor_vacate path:\n\n</p><p>client-&gt;schedd-&gt;shadow-&gt;startd-&gt;starter  on update\n\n</p><p>starter-&gt;shadow-&gt;schedd.\n\n</p><p><strong>Motivation:</strong>\nThe ability to determine shared resource utilization based on job, user, or constraint.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Aug-15 12:57:40 by tstclair:</em> <br/>\n\nFor completeness gthain mentioned the idea about adding period_suspend and periodic_resume to the jobAd.\n\n<p>I'm uncertain at this point whether I should include directly within this ticket or if I should create a child ticket for that.  May depend on how long this takes to debug.\n\n</p><p></p><hr/>\n<em>2011-Aug-23 09:40:21 by tstclair:</em> <br/>\n\nNow tracking in V7_7-suspend-publicbranch .\n\n<p>Currently works, but still needs more love.  Items still pending:\n\n</p><p></p><ul>\n<li>promotion to 1st class citizenship. <strong>[DONE]</strong>\n</li><li>setup for PU <strong>[DONE]</strong>\n</li><li>Beat the hell out of it.\n</li></ul>\n\n<p></p><hr/>\n<em>2011-Aug-29 14:53:02 by psilord:</em> <br/>\n\nOk, I did the review:\n\n<p>General questions:\n\n</p><p>What's the motivation for this work? <strong>[See Above]</strong>\n\n</p><p>Why is it necessary? <strong>[==Motivation]</strong>\n\n</p><p>Who wanted it? <strong>[Can't state, but numerous condor-users have desired]</strong>\n\n</p><p>Please write into the main body of the ticket the answers to these questions.\n\n</p><p>What happens if you upgrade condor, have a job as recorded in suspended\nstate in the queue, shut off condor, downgrade it, then start up the\nold one? Will the schedd start at all?\n\n</p><p><strong>Unknown, it would likely not be good b/c we added a state ~= Transfer mod</strong>\n\n</p><p>Does condor_suspend and condor_continue take the same kind of arguments like\ncondor_rm--meaning a user name, a jobid, or a constraint?\n\n</p><p><strong>Yes, and this requires documentation</strong>\n\n</p><p>Can you suspend or continue jobs from a machines point of view?\n\n</p><p><strong>That's what SUSPEND and CONTINUE expressions are for ;-) + there is the default constraint you can pass</strong>\n\n</p><p>Now that job suspend/continue events are synched to the schedd, what is\nthe expected performance impact for reasonable policies? Are the suspend\nevents fsynced()--they shouldn't be.\n\n</p><p><strong>It has to update the job state which I believe translates to a durable transaction == fsync</strong>\n\n</p><p>It used to be that you only paid for the suspend queue connections from\nthe shadow to the schedd when you asked for it, and now you always pay\nwith no way to stop it. In pools with heavy churn of suspending jobs\n(which may actually exist today, since we don't keep good stats) there is\nno recourse for a pool admin to deal with it.\n\n</p><p><strong>Honestly, if this is the case you would want it to be denoted properly, as it stands now (prior to patch) it's obscured, but the admin \"should deal with it\"</strong>\n\n</p><p>What does a pool admin do if their suspend policies start causing the shadows to time out talking to the schedd and killing their jobs so they must rerun?\n\n</p><p><strong>That is no different then what an admin would have to do today</strong>\n\n</p><p>General changes:\n\n</p><p>Put braces around all single statement blocks for if statements. It prevents\nmerge accidents later.\n\n</p><p>Specific changes:\n\n</p><p>Check-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b79af7ffd09c80888bdd9627e7400ed16893bc25\">[26902]</a></span>\n\n</p><p>line 802 in dc_startd.cpp there is a chunk of commented out code.\nDid you forget to implement that feature? If not, remove the code, but\nif you are able to implement that feature you should.\n\n</p><p>line 4052, 4166, 12124 in schedd.cpp there is a TBD. Was it?\n\n</p><p>Check-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9e94ba70784155f83c87f88006f661aa642ded6f\">[26910]</a></span>\n\n</p><p>Seems ok.\n\n</p><p>Check-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2953e137e81e5b241a195952f062c6bca90e0294\">[26912]</a></span>\n\n</p><p>ASSERT that the ResourceList[i] value is a non-null pointer. A segfault\nthere would be confusing to find and reproduce. An ASSERT would make finding\nthe issue very fast.\n\n</p><p></p><hr/>\n<em>2011-Sep-06 14:56:17 by tstclair:</em> <br/>\n\nUpdates done per code review on 9/6/2011</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2479\" onclick=\"get_ticket_and_populate_wrapper('2479'); return false;\" title=\"startd SUSPEND trumps user continue, and user suspend trumps startd CO\">#2479</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nstartd SUSPEND trumps user continue, and user suspend trumps startd CO</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=2480\" onclick=\"get_ticket_and_populate_wrapper('2480'); return false;\" title=\"consistent naming for user commands vs. machine commands.\">#2480</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nconsistent naming for user commands vs. machine commands.</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=3513\" onclick=\"get_ticket_and_populate_wrapper('3513'); return false;\" title=\"RFE: condor_suspend/continue for EC2 jobs\">#3513</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nRFE: condor_suspend/continue for EC2 jobs</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jun-26 11:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a3cd8e890fb27c515b539da23051dc69f8481775\">[36685]</a></span>: Document <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobStatus\" title=\"Job Status\">JobStatus</a></span> value for Suspended state in Manual. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2368\" onclick=\"get_ticket_and_populate_wrapper('2368'); return false;\" title=\"[RFE] add support for condor_suspend &amp;&amp; condor_continue\">#2368</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-05 15:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8c092f6f3872ed75e09506b7c2e225c0649c9f28\">[27642]</a></span>: correct new man pages for condor_suspend and condor_continue ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2368\" onclick=\"get_ticket_and_populate_wrapper('2368'); return false;\" title=\"[RFE] add support for condor_suspend &amp;&amp; condor_continue\">#2368</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-15 13:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0b339511dcfe3d41290704e2b6bc81f114d95a73\">[27226]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2368\" onclick=\"get_ticket_and_populate_wrapper('2368'); return false;\" title=\"[RFE] add support for condor_suspend &amp;&amp; condor_continue\">#2368</a></span> missing an extra = for == in continue constrait query.  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-12 11:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/548367e986066bba5f30b2342d438bc3501625ab\">[27158]</a></span>: Fix condor_suspend and condor_continue man pages. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2368\" onclick=\"get_ticket_and_populate_wrapper('2368'); return false;\" title=\"[RFE] add support for condor_suspend &amp;&amp; condor_continue\">#2368</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-09 14:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1ac9a9a3f36eb5c3d840769c7ab60379d46a3fbb\">[27154]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2368\" onclick=\"get_ticket_and_populate_wrapper('2368'); return false;\" title=\"[RFE] add support for condor_suspend &amp;&amp; condor_continue\">#2368</a></span> Fix for std:u symbol collision.  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-09 11:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7a02fc2593c63a4556714a086e415572fdbf8656\">[27147]</a></span>: Final documentation update for condor_suspend &amp; continue. ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2368\" onclick=\"get_ticket_and_populate_wrapper('2368'); return false;\" title=\"[RFE] add support for condor_suspend &amp;&amp; condor_continue\">#2368</a></span> ===VersionHistory:Complete===  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-06 14:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b192cd01af9ac2a0c8a903f8d6ab77cb9dac7445\">[27100]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2368\" onclick=\"get_ticket_and_populate_wrapper('2368'); return false;\" title=\"[RFE] add support for condor_suspend &amp;&amp; condor_continue\">#2368</a></span> Updates per code review  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-23 15:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2953e137e81e5b241a195952f062c6bca90e0294\">[26912]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2368\" onclick=\"get_ticket_and_populate_wrapper('2368'); return false;\" title=\"[RFE] add support for condor_suspend &amp;&amp; condor_continue\">#2368</a></span> - Added support to suspend PU jobs  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-23 14:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9e94ba70784155f83c87f88006f661aa642ded6f\">[26910]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2368\" onclick=\"get_ticket_and_populate_wrapper('2368'); return false;\" title=\"[RFE] add support for condor_suspend &amp;&amp; condor_continue\">#2368</a></span> - promotion to 1st class status, will now display in condor_q  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-23 09:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b79af7ffd09c80888bdd9627e7400ed16893bc25\">[26902]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2368\" onclick=\"get_ticket_and_populate_wrapper('2368'); return false;\" title=\"[RFE] add support for condor_suspend &amp;&amp; condor_continue\">#2368</a></span> - First pass at suspend and continue. Currently it is still a second class citizen but functional. The next step will be to promote to 1st class citizenship.  (By Timothy St. Clair )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Sep-09 11:48", "status": "resolved", "created": "2011-Aug-09 12:58", "fixed_version": "2011-Aug-09 12:58", "broken_version": "v070600", "priority": "3", "subsystem": "Tools", "assigned_to": "tstclair", "derived_from": "", "creator": "tstclair", "rust": "", "customer_group": "users", "visibility": "public", "notify": "matt@cs.wisc.edu, tstclair@redhat.com, dan@hep.wisc.edu, gthain@cs.wisc.edu, psilord@cs.wisc.edu", "due_date": ""}