{"id": 6188, "title": "Ticket #6188: Allow SUBMIT_REQUIREMENT to reference X509 secure attributes", "description": "<blockquote>\nWhen the schedd sets secure attributes about the user's X.509 proxy, it does so after evaluating the SUBMIT_REQUIREMENT expressions. That means those expressions can't reference the proxy attributes. This is a change from 8.4.*, where the submitter provides the attributes, and is breaking some users' configurations. We should set the proxy attributes before checking SUBMIT_REQUIREMENT expressions.</blockquote>", "remarks": "<blockquote>\n<em>2017-Mar-16 13:41:51 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Code looks good.\n\n</p><p>[It's OK for AddSessionAttributes() to move inside the conditional because it already contains an identical conditional.  Having a second conditional on new jobs in the queue is redundant but should be harmless.]\n\n</p><p>I'd like to take a longer around for the original logic behind where the job requirements where initially implemented.  Jaime reports that the comment said it was to avoid impacting transactions that didn't create new jobs -- although if it was in the networking code, maybe the idea was to exclude from submit requirements all internal transactions and we just missed SOAP -- but if we're already checking for new jobs in the generic commit transaction code, than it seems like that's a cheap and safe place to do it, instead.\n\n</p><p></p><hr/>\n<em>2017-Mar-16 13:57:14 by tlmiller:</em> <br/>\n\nJaime found <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2640\" onclick=\"get_ticket_and_populate_wrapper('2640'); return false;\" title=\"SUBMIT_REQUIREMENTS: reject condor_submit if fails\">#2640</a></span>, whose corresponding design doc says that the primary reason for its placement there was to ensure that submit requirements only fired on new jobs.\n\n<p></p><hr/>\n<em>2017-Apr-17 17:09:19 by tim:</em> <br/>\n\n<strong>DOC REVIEW:</strong> OK</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-22 14:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1216a3ae4350ad411abfb09b3e357a9630caad22\">[50358]</a></span>: Docs for SUBMIT_REQUIREMENT referencing x509 attrs bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6188\" onclick=\"get_ticket_and_populate_wrapper('6188'); return false;\" title=\"Allow SUBMIT_REQUIREMENT to reference X509 secure attributes\">#6188</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-16 13:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/73f54a956126f40c4dff8b34a79fb00d668546f8\">[50327]</a></span>: Allow SUBMIT_REQUIREMENT to reference X509 secure attributes. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6188\" onclick=\"get_ticket_and_populate_wrapper('6188'); return false;\" title=\"Allow SUBMIT_REQUIREMENT to reference X509 secure attributes\">#6188</a></span> During job submission, set X509 secure attributes before checking job transforms and submit requirements. Also make CommitTransaction() more efficient for non-submit transactions.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Apr-17 17:09", "status": "resolved", "created": "2017-Mar-14 09:19", "fixed_version": "2017-Mar-14 09:19", "broken_version": "v080508", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "#5064", "creator": "jfrey", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "", "due_date": ""}