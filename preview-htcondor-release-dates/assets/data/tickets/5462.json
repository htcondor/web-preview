{"id": 5462, "title": "Ticket #5462: condor_mips has different performance in rpm than in tarball", "description": "<blockquote>\nCHTC reports that the Mips benchmark on the CHTC machines is about 1/3rd of the usual value after rolling out 8.5.1.  Turns out that the condor_mips binary in the rpm reports about 30% of the performance that the condor_mips binary in the tarball does.\n\n<p>Looks like none of the condor binaries in the RPM build are being built with -O2.  They are just being built with -g.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Jan-06 08:25:12 by tim:</em> <br/>\n\nIn <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=5383\" onclick=\"get_ticket_and_populate_wrapper('5383'); return false;\" title=\"The %cmake macro includes extra undesired CFLAGS for RPM builds\">#5383</a></span>, we removed extra flags from the cmake invocation that was causing standard universe to not work. Unfortunately, we also dropped the optimization flags.\n\n<p></p><hr/>\n<em>2016-Jan-06 11:17:56 by tim:</em> <br/>\n\nAs it turns out. The package build was setting the _DEBUG cmake flag.\n\n<p></p><hr/>\n<em>2016-Jan-07 09:52:04 by bbockelm:</em> <br/>\n\nThe solution for <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=5383\" onclick=\"get_ticket_and_populate_wrapper('5383'); return false;\" title=\"The %cmake macro includes extra undesired CFLAGS for RPM builds\">#5383</a></span> seems the wrong direction anyway.  There's good reason to use the default macros provided by the distro (especially the security-related ones!).\n\n<p>If we know about certain \"bad\" flags for HTCondor-wide or specific compilation units, we should disable them within CMake instead of relying on the builder to not pass them in the first place.\n\n</p><p>This is likely more robust anyway as it prevents others from adding the wrong flags when they do their own builds.\n\n</p><p></p><hr/>\n<em>2016-Jan-08 11:32:07 by tim:</em> <br/>\n\nTodd Tannenbaum wants the same bits (compile options) in RPM as the tarballs. I agree that we should move back toward using the %cmake macro to pick up platform specific flags. To get there, first we need to run automated tests on the installed RPMS. Then, we can figure out how to eliminate the flags that cause trouble for certain portions of HTCondor.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-06 13:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9aff3b6bbcf00b73555ae6105e993d50ca3840ae\">[47421]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5462\" onclick=\"get_ticket_and_populate_wrapper('5462'); return false;\" title=\"condor_mips has different performance in rpm than in tarball\">#5462</a></span>) Turn on compiler optimization for RPM builds.  (By Tim Theisen )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Mar-13 13:38", "status": "resolved", "created": "2016-Jan-05 16:37", "fixed_version": "2016-Jan-05 16:37", "broken_version": "v080402", "priority": "1", "subsystem": "Packaging", "assigned_to": "tim", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "", "due_date": ""}