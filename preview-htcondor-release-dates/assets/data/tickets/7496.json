{"id": 7496, "title": "Ticket #7496: Shrink compat ClassAds API, part 4", "description": "<blockquote>\nContinue shrinking the compat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> child class, until we can remove it entirely.\n\n<p></p><ul>\n<li>Reduce usage of single-argument Insert(), which we may be unable to move into the base class. Use the two-argument form when attribute name and value are already separate.\n</li><li>When an attribute name is in a string object, pass the object directly instead of extracting a char*. This avoids making an extra copy of the string.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2020-Apr-28 12:04:00 by jfrey:</em> <br/>\n\nNo user-visible changes, so no version history.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-24 18:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7988572821c3bac504c6acb61f4ce1d589643589\">[60222]</a></span>: fix bug in formatting of debug stats in previous commit to <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7496\" onclick=\"get_ticket_and_populate_wrapper('7496'); return false;\" title=\"Shrink compat ClassAds API, part 4\">#7496</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-24 17:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/391d99e444372cfd4dd2be2baa74939ba2acb1de\">[60220]</a></span>: fix bug in formatting of debug stats in previous commit to <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7496\" onclick=\"get_ticket_and_populate_wrapper('7496'); return false;\" title=\"Shrink compat ClassAds API, part 4\">#7496</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-30 13:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/091b29b129d85272d17c9c3c1642970996716ea5\">[59532]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7496\" onclick=\"get_ticket_and_populate_wrapper('7496'); return false;\" title=\"Shrink compat ClassAds API, part 4\">#7496</a></span>) Bump <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> version number since ABI changed  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-19 16:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5e93226fecf17da144ad13561dc010e48f386ec7\">[59014]</a></span>: Remove compat_classad namespace. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7496\" onclick=\"get_ticket_and_populate_wrapper('7496'); return false;\" title=\"Shrink compat ClassAds API, part 4\">#7496</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-19 16:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1b6d0f8ac093b4298f3c12e28980156d1f8268e5\">[59013]</a></span>: Remove compat_classad::ClassAd child class. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7496\" onclick=\"get_ticket_and_populate_wrapper('7496'); return false;\" title=\"Shrink compat ClassAds API, part 4\">#7496</a></span> There can be only one <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> class.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-18 13:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/40d5f0f8003f4165fbced5d988329db543a04400\">[59012]</a></span>: Move static items out of compat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7496\" onclick=\"get_ticket_and_populate_wrapper('7496'); return false;\" title=\"Shrink compat ClassAds API, part 4\">#7496</a></span> Note: ParallelIsAMatch() doesn't need to set alternateScope, as <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MatchClassAd\" title=\"Match Class Ad\">MatchClassAd</a></span> handles it.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-14 16:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4dfa9acfb20e50c0fc799500effb19affddb17f1\">[59011]</a></span>: Remove extra string copies in use of ClassAd::Assign(). <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7496\" onclick=\"get_ticket_and_populate_wrapper('7496'); return false;\" title=\"Shrink compat ClassAds API, part 4\">#7496</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-14 16:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cd8fcb4d1730d5da0ccc6022cac1b2139b2eae3e\">[59010]</a></span>: Add tests for new EscapeChars() function. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7496\" onclick=\"get_ticket_and_populate_wrapper('7496'); return false;\" title=\"Shrink compat ClassAds API, part 4\">#7496</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-14 14:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7885246ab928bc7deeb71606f254e3b7c4860588\">[59009]</a></span>: Turn off dirty tracking in base <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> by default. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7496\" onclick=\"get_ticket_and_populate_wrapper('7496'); return false;\" title=\"Shrink compat ClassAds API, part 4\">#7496</a></span> All known code that uses dirty tracking enables it explicitly. Don't make other uses pay the overhead. Also clean up some dodgy dirty tracking changes in the parsers.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-14 10:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3cdf5249f4003edb84fef785b2aceb014f2c7b01\">[59008]</a></span>: Move Insert(), Assign(), and Lookup methods into base <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> class <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7496\" onclick=\"get_ticket_and_populate_wrapper('7496'); return false;\" title=\"Shrink compat ClassAds API, part 4\">#7496</a></span> Most of these are alternate names for existing methods in the base class. They are from the old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> implementation and use extensively in the Condor codebase. Methods Insert() and AssignExpr() parse a string into an <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTree\" title=\"Expr Tree\">ExprTree</a></span>\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-13 13:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/71e2ff948de3ed459094319cce5aec547d1ddeb9\">[59007]</a></span>: Remove calls to ClassAd::LookupString() with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyString\" title=\"My String\">MyString</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7496\" onclick=\"get_ticket_and_populate_wrapper('7496'); return false;\" title=\"Shrink compat ClassAds API, part 4\">#7496</a></span> This is a step towards removing the compat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> class.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-11 15:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ba89b7c205ecadf52e3e37208698e56b263aa212\">[59006]</a></span>: Minimize use of single-argument classad Insert() method. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7496\" onclick=\"get_ticket_and_populate_wrapper('7496'); return false;\" title=\"Shrink compat ClassAds API, part 4\">#7496</a></span> When the attribute name and value are already seperate in the caller, use one of the Assign() methods instead. This is more efficient. Also, the single-argument Insert() is implemented in the Condor utils and we're tyring to eliminate the\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-11 09:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/700de189ab90650d383d29a3709f6b6bc5d1139c\">[59005]</a></span>: Pass attribute names as string object to classads when available. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7496\" onclick=\"get_ticket_and_populate_wrapper('7496'); return false;\" title=\"Shrink compat ClassAds API, part 4\">#7496</a></span> When we have an attribute name in a string object, extracting a char* to pass to a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> member function adds an extra copy.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Apr-28 12:04", "status": "resolved", "created": "2020-Feb-10 11:04", "fixed_version": "2020-Feb-10 11:04", "broken_version": "", "priority": "3", "subsystem": "ClassAd", "assigned_to": "jfrey", "derived_from": "#6852", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}