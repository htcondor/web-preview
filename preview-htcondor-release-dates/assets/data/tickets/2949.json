{"id": 2949, "title": "Ticket #2949: peaceful shutdown cannot be escalated to graceful", "description": "<blockquote>\nE.g., when using the command-line tools.</blockquote>", "remarks": "<blockquote>\nEscalating to priority==2, because Stuart keeps running into this.\n\n<p></p><hr/>\n<em>2013-Mar-05 10:15:40 by pfc:</em> <br/>\n\nAny update on this?\n\n<p></p><hr/>\n<em>2013-Mar-11 16:21:17 by nwp:</em> <br/>\n\nTo pfc: So the use case of this is, \"The admin starts a peaceful shutdown.  He waits a while for everything to finish.  Finally he gets tired of waiting, and issues a graceful shutdown for things to checkpoint and exit.\"  Is this the correct scenario?\n\n<p></p><hr/>\n<em>2013-Mar-11 16:26:10 by pfc:</em> <br/>\n\nExactly.\n\n<p></p><hr/>\n<em>2013-Mar-14 14:36:53 by bbockelm:</em> <br/>\n\nHi nwp, all,\n\n<p>Shutdown signals are in a horrible state in HTCondor right now.  Here's a few things I would like to be able to do, but can't:\n</p><ul>\n<li>Be able to query the current state of a daemon.\n</li><li>Have condor_off verify the daemon is in the correct state / the signal was accepted.\n</li><li>When talking to the master, be able ask whether it was able to propagate the signal to all daemons.\n</li><li>Have condor_off print out its actions it takes and signals it sends / and where.\n</li><li>Have daemons log what state they are in.\n</li></ul>\n\n<p>I would suggest that the current system is broken enough that we shouldn't spend any time adding features, but rather redesign with this feature in mind.\n\n</p><p>Anyhow, just $0.02.  We could do a lot better\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2013-Mar-14 15:27:49 by pfc:</em> <br/>\n\n<div class=\"blockquote\">\n<table width=\"95%\"><tbody><tr><td>\u00a0</td><td>\n  \"the current system is broken enough that we shouldn't spend any time adding features, but rather redesign with this feature in mind\"</td></tr></tbody></table></div>\n\n\n<p>I love this idea--but only if a full redesign is actually on the table in the short-term.  Otherwise please just solve our actual problem, even if it's duct tape on a pig.  The perfect being the enemy of the good and all...\n\n</p><p></p><hr/>\n<em>2013-Mar-18 14:32:11 by nwp:</em> <br/>\n\nThis seems to work.  I think gthain is supposed to review, but might be johnkn.  Pushed onto V7_9-gittrac_2949-branch\n\n<p></p><hr/>\n<em>2013-Mar-18 21:00:00 by nwp:</em> <br/>\n\n<a class=\"external\" href=\"http://submit-2.batlab.org/results/run-details.php?runid=109621\">NMI</a> shows a bunch of tests failing.  More work to do on this.\n\n<p></p><hr/>\n<em>2013-Mar-20 16:45:27 by nwp:</em> <br/>\n\nLast commit seems to have fixed the issues in batlab\n\n<p></p><hr/>\n<em>2013-Mar-21 14:05:14 by nwp:</em> <br/>\n\nThis is marked as a defect; Should it go into 7.8.8 (once it is reviewed)?  Right now, it is branched from master and the version history entry reflects this fact.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/701/Upgrading+Peaceful+shutdown+to+Graceful+via+Cancel+command.docx\">Upgrading Peaceful shutdown to Graceful via Cancel command.docx</a>\n15468 bytes added by nwp on 2013-Mar-13 13:57:49 UTC.\n<br/>\nDesign document for upgrading peaceful to cancel<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-07 17:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/aec470eec260f1cc6076fe6aa4eb8630e64665ac\">[35641]</a></span>: Edit many 7.9.6 version history items, including those for tickets (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3539\" onclick=\"get_ticket_and_populate_wrapper('3539'); return false;\" title=\"change recommended configuration for disabling preemption\">#3539</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3586\" onclick=\"get_ticket_and_populate_wrapper('3586'); return false;\" title=\"move python bindings out of contrib\">#3586</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3398\" onclick=\"get_ticket_and_populate_wrapper('3398'); return false;\" title=\"Batch GAHP cannot set remote memory or walltime requests\">#3398</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3560\" onclick=\"get_ticket_and_populate_wrapper('3560'); return false;\" title=\"improve dprintf code to support audit logs (time based rotation)\">#3560</a></span>, <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2949\" onclick=\"get_ticket_and_populate_wrapper('2949'); return false;\" title=\"peaceful shutdown cannot be escalated to graceful\">#2949</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3493\" onclick=\"get_ticket_and_populate_wrapper('3493'); return false;\" title=\"Audit Log for Condor schedds\">#3493</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3496\" onclick=\"get_ticket_and_populate_wrapper('3496'); return false;\" title=\"monitor file transfer i/o activity\">#3496</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3597\" onclick=\"get_ticket_and_populate_wrapper('3597'); return false;\" title=\"CPU affinity enforcement broken with partitionable slots\">#3597</a></span>, <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=3601\" onclick=\"get_ticket_and_populate_wrapper('3601'); return false;\" title=\"autofs doesn't work with 7.9\">#3601</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3579\" onclick=\"get_ticket_and_populate_wrapper('3579'); return false;\" title=\"condor_updates_stats doesn't work anymore\">#3579</a></span>,) and (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3570\" onclick=\"get_ticket_and_populate_wrapper('3570'); return false;\" title=\"Starter leaks FDs to file transfer plugin\">#3570</a></span>, <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=3588\" onclick=\"get_ticket_and_populate_wrapper('3588'); return false;\" title=\"DHCPREQUEST doesn't have the ending 0xff byte to mark end of options f\">#3588</a></span>)  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-29 16:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f5108d50b8a246bb45bfa8f16e3b727aa2fe3d79\">[35575]</a></span>: Edit of documentation for new condor_off -force-graceful command ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2949\" onclick=\"get_ticket_and_populate_wrapper('2949'); return false;\" title=\"peaceful shutdown cannot be escalated to graceful\">#2949</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-01 12:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/33dc136a7e2d499d5a7254061fb27b424a116ff9\">[35295]</a></span>: Merged <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b89a14e7e1ff7add24fbe0fc39155c881f600767\">[35187]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/816a9960820fa34dd6bd3247625f293e9ffddaeb\">[35192]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3537279a45650e6bb7c3449e3883e8bd7b700766\">[35222]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/447c7e6d9d4ec5fddb417eb06ee618c1c7019578\">[35227]</a></span>, Merge remote-tracking branch 'origin/V7_9-gittrac_2949-branch' <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2949\" onclick=\"get_ticket_and_populate_wrapper('2949'); return false;\" title=\"peaceful shutdown cannot be escalated to graceful\">#2949</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-20 18:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/447c7e6d9d4ec5fddb417eb06ee618c1c7019578\">[35227]</a></span>: Fix man page and add version history <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2949\" onclick=\"get_ticket_and_populate_wrapper('2949'); return false;\" title=\"peaceful shutdown cannot be escalated to graceful\">#2949</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-20 16:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3537279a45650e6bb7c3449e3883e8bd7b700766\">[35222]</a></span>: Send enlightening message to user <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2949\" onclick=\"get_ticket_and_populate_wrapper('2949'); return false;\" title=\"peaceful shutdown cannot be escalated to graceful\">#2949</a></span> Fix bugs that turned up in testing  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-18 20:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/816a9960820fa34dd6bd3247625f293e9ffddaeb\">[35192]</a></span>: Do -force-graceful instead of -cancel <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2949\" onclick=\"get_ticket_and_populate_wrapper('2949'); return false;\" title=\"peaceful shutdown cannot be escalated to graceful\">#2949</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-18 14:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b89a14e7e1ff7add24fbe0fc39155c881f600767\">[35187]</a></span>: Implement -cancel option for condor_off <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2949\" onclick=\"get_ticket_and_populate_wrapper('2949'); return false;\" title=\"peaceful shutdown cannot be escalated to graceful\">#2949</a></span> Update the version <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2949\" onclick=\"get_ticket_and_populate_wrapper('2949'); return false;\" title=\"peaceful shutdown cannot be escalated to graceful\">#2949</a></span>  (By Nathan W. Panike )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-May-30 10:28", "status": "defer", "created": "2012-Apr-20 13:44", "fixed_version": "2012-Apr-20 13:44", "broken_version": "v070606", "priority": "5", "subsystem": "Std", "assigned_to": "gthain", "derived_from": "", "creator": "pfc", "rust": "s1754", "customer_group": "ligo", "visibility": "public", "notify": "anderson@ligo.caltech.edu, pfcouvar@syr.edu, tstclair@redhat.com, gthain@cs.wisc.edu,pcouvare@caltech.edu", "due_date": ""}