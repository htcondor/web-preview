{"id": 6361, "title": "Ticket #6361: CMS Global Pool Memory Leak Hunt", "description": "<blockquote>\nThe CMS group has reported a gradually increase in memory usage of the collector in their global pool, indicative of a memory leak. We are using valgrind and static analysis to track down the potential leaks. We will also be improving the collector's memory cleanup at shutdown to reduce the noise in valgrind reports.</blockquote>", "remarks": "<blockquote>\n<em>2017-Aug-03 14:06:13 by jfrey:</em> <br/>\n\nBug <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6342\" onclick=\"get_ticket_and_populate_wrapper('6342'); return false;\" title=\"Memory leak during clean-up of an authenticated socket\">#6342</a></span> (<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> free()d instead of deleted) is a memory leak that is probably a primary culprit to the ever-increasing memory usage.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6363\" onclick=\"get_ticket_and_populate_wrapper('6363'); return false;\" title=\"Small memory leak in init_network_interfaces()\">#6363</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nSmall memory leak in init_network_interfaces()</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-17 13:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b6d9ab85a82c6ad547d987ed7b84f2d7fa944929\">[52142]</a></span>: Docs for minor memory leak fixes. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6361\" onclick=\"get_ticket_and_populate_wrapper('6361'); return false;\" title=\"CMS Global Pool Memory Leak Hunt\">#6361</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-11 16:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b81b72c5748f0f97d0c4b0aced33e6e79c8ea819\">[52073]</a></span>: Improve memory cleanup of schedd stats objects. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6361\" onclick=\"get_ticket_and_populate_wrapper('6361'); return false;\" title=\"CMS Global Pool Memory Leak Hunt\">#6361</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-11 14:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f02466274d14c06ed53303fb94f312e473a688c8\">[52072]</a></span>: Fix some small memory leaks in the schedd. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6361\" onclick=\"get_ticket_and_populate_wrapper('6361'); return false;\" title=\"CMS Global Pool Memory Leak Hunt\">#6361</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-11 14:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f7e22ba57351390e1433575a2ffcd9e7037f8f0e\">[52069]</a></span>: Fix mismatched new[]/delete for environment in my_popen. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6361\" onclick=\"get_ticket_and_populate_wrapper('6361'); return false;\" title=\"CMS Global Pool Memory Leak Hunt\">#6361</a></span> Use the deallocator mentioned in the header for Env.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-07 08:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ba581723f7246269ef827cd5728db6ea45971e76\">[52019]</a></span>: Remove redundant param() calls in init_network_interfaces(). <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6361\" onclick=\"get_ticket_and_populate_wrapper('6361'); return false;\" title=\"CMS Global Pool Memory Leak Hunt\">#6361</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-03 14:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/692dd2284ce3df4ac93420fb8007141e3ab72fc8\">[51994]</a></span>: Improve cleanup of heap menory in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CollectorDaemon\" title=\"Collector Daemon\">CollectorDaemon</a></span> on shutdown. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6361\" onclick=\"get_ticket_and_populate_wrapper('6361'); return false;\" title=\"CMS Global Pool Memory Leak Hunt\">#6361</a></span> These show up as potential memory leaks in valgrind.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-01 16:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2f908ce390acd8f55a1e6e80a8e8dda67be6f454\">[51979]</a></span>: Fix killGenericHashTable() walk function to delete all generic tables. If the walk function returns 0, then the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=HashTable\" title=\"Hash Table\">HashTable</a></span> aborts the walk. Thus, only one generic ad table was deleted before this fix. This only affects memory cleanup at shutdown, which helps memory leak detection.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jul-28 11:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/89bfc854fe21c5b354efde791aceabe7e71fc46f\">[51955]</a></span>: Delete main collector object on shutdown. This reduces noise in memory leak reports.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Aug-17 14:00", "status": "resolved", "created": "2017-Aug-03 14:01", "fixed_version": "2017-Aug-03 14:01", "broken_version": "", "priority": "3", "subsystem": "DaemonsCM", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}