{"id": 6073, "title": "Ticket #6073: docker simulator needed so we can test docker in the batlab", "description": "<blockquote>\nWe need a perl script that will respond in the same way that docker does so we can test docker universe in the batlab.  The docker simulator should be a perl script that we configure to be the docker command\n\n<p></p><div class=\"snip\">\n<pre class=\"sniplabel\">add to config</pre>\n<pre class=\"snip\">DOCKER=$(LIBEXEC)/docker_simulator.pl\n</pre></div>\n\n\n<p>The docker simulator should have a log file that it writes commands and other items of interest into. the simulator will also create a file for each simulated running docker job that it will use to track the state of the job and the simulated container id and pid.\n\n</p><p>It should respond to the following commands\n\n</p><p></p><ul>\n<li>-v   - the simulator should return a single line of docker version\n</li><li>version - the simulator should respond in the same way that real docker does.\n</li><li>info - the simulator should respond the same way that real docker does.\n</li><li>images - the simulator should list images\n\n<p></p></li><li>run - the run command is followed by many arguments, the only argument of interest is -name which sets the name of the job and will be how subsequent commands refer to the job. This command, is the only command that should not return right away. when it exits, the job is presumed to have finished.\n</li></ul>\n\n<p>The following commands will refer to the docker container that was created by the run command above.\n</p><ul>\n<li>inspect &lt;name&gt; - respond\n</li><li>rm &lt;name&gt; -\n</li><li>kill &lt;name&gt; - kill the given job (by container id)\n</li><li>pause &lt;name&gt;\n</li><li>unpause &lt;name&gt;\n</li></ul>\n\n<p></p><div class=\"snip\">\n<pre class=\"sniplabel\">docker info from a centos6.5 vm</pre>\n<pre class=\"snip\">Containers: 6\nImages: 4\nStorage Driver: devicemapper\n Pool Name: docker-253:0-522536-pool\n Pool Blocksize: 65.54 kB\n Backing Filesystem: extfs\n Data file: /dev/loop0\n Metadata file: /dev/loop1\n Data Space Used: 317.4 MB\n Data Space Total: 107.4 GB\n Data Space Available: 30.48 GB\n Metadata Space Used: 1.069 MB\n Metadata Space Total: 2.147 GB\n Metadata Space Available: 2.146 GB\n Udev Sync Supported: true\n Deferred Removal Enabled: false\n Data loop file: /var/lib/docker/devicemapper/devicemapper/data\n Metadata loop file: /var/lib/docker/devicemapper/devicemapper/metadata\n Library Version: 1.02.89-RHEL6 (2014-09-01)\nExecution Driver: native-0.2\nLogging Driver: json-file\nKernel Version: 2.6.32-642.11.1.el6.x86_64\nOperating System: &lt;unknown&gt;\nCPUs: 1\nTotal Memory: 1.826 GiB\nName: localhost.localdomain\nID: 4QHG:JPN3:H2UL:MANT:VUWJ:4J2G:WI6N:TASX:NWPF:G2J3:SVL6:CRDV\n</pre></div>\n\n\n<p></p><div class=\"snip\">\n<pre class=\"sniplabel\">docker version from a centos6.5 vm</pre>\n<pre class=\"snip\">Client version: 1.7.1\nClient API version: 1.19\nGo version (client): go1.4.2\nGit commit (client): 786b29d/1.7.1\nOS/Arch (client): linux/amd64\nServer version: 1.7.1\nServer API version: 1.19\nGo version (server): go1.4.2\nGit commit (server): 786b29d/1.7.1\nOS/Arch (server): linux/amd64\n</pre></div>\n\n\n<p></p><div class=\"snip\">\n<pre class=\"sniplabel\">docker inspect format</pre>\n<pre class=\"snip\">ContainerId=\\\"{{.Id}}\\\"\nPid={{.State.Pid}}\nName=\\\"{{.Name}}\\\"\nRunning={{.State.Running}}\nExitCode={{.State.ExitCode}}\nStartedAt=\\\"{{.State.StartedAt}}\\\"\nFinishedAt=\\\"{{.State.FinishedAt}}\\\"\nDockerError=\\\"{{.State.Error}}\\\"\nOOMKilled=\\\"{{.State.OOMKilled}}\\\"\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-21 16:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9fd5ceedb631f047e53368dc8fe4ff6b5f829f0b\">[50558]</a></span>: add test to submit a docker job <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=6073\" onclick=\"get_ticket_and_populate_wrapper('6073'); return false;\" title=\"docker simulator needed so we can test docker in the batlab\">#6073</a></span>  (By shuyang )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-17 15:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fa9e57e3104bc1c5508625ff0d08a8bd104527fa\">[50340]</a></span>: Added docker_simulator.pl script and the test for running the script. Ticket <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=6073\" onclick=\"get_ticket_and_populate_wrapper('6073'); return false;\" title=\"docker simulator needed so we can test docker in the batlab\">#6073</a></span>  (By shuyang )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-Oct-19 14:14", "status": "review", "created": "2016-Dec-27 10:17", "fixed_version": "2016-Dec-27 10:17", "broken_version": "", "priority": "3", "subsystem": "Tests", "assigned_to": "gthain", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}