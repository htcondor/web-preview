{"id": 3821, "title": "Ticket #3821: convert param_info.in to static const data with binary lookup", "description": "<blockquote>\nThe heap cost of param hashtables in the RedHat6 x64 shadow is about 100k in version 8.0.0.  Much of that is because all of the default params are loaded into heap at startup. The default param table should be a static const structure, and it should be sorted by parameter name, so that binary lookups can be made directly against the compile time data.</blockquote>", "remarks": "<blockquote>\n<em>2013-Aug-23 17:19:39 by danb:</em> <br/>\n\nI'm seeing strange behavior in which the default value for a param is not correctly returned.  It seems likely this is caused by the new param table code.\n\n<p>The specific param where I see this is TRANSFER_IO_REPORT_TIMESPANS.  It has a default value defined in the param table, but the following code initializes iostat_timespans to an empty string:\n\n</p><p></p><pre>    param(iostat_timespans,\"TRANSFER_IO_REPORT_TIMESPANS\");\n</pre>\n\n<p>condor_config_val also does not see the default value.\n\n</p><p></p><hr/>\n<em>2013-Aug-26 11:01:54 by johnkn:</em> <br/>\n\nThere is a problem with params that are of type int, or bool or double, but whose default value is not a simple int, bool or double. the default value is treated as undefined</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-26 13:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/11f01b33a6866bc458551d6e0d5e37aed4d498f4\">[37352]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3821\" onclick=\"get_ticket_and_populate_wrapper('3821'); return false;\" title=\"convert param_info.in to static const data with binary lookup\">#3821</a></span>) change sorting of static const param table to lowercase before comparing, since that's what strcasecmp appears to do ===VersionHistory:None=== bug never shipped  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-20 17:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/86f41bd82071dfadeff89fb2915945ab2a9c95c2\">[37309]</a></span>: fix sorting of static param table for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3821\" onclick=\"get_ticket_and_populate_wrapper('3821'); return false;\" title=\"convert param_info.in to static const data with binary lookup\">#3821</a></span> so sort is case-insensitive. also fix lookup of int, bool &amp; double params to honor static per-daemon overrides. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3822\" onclick=\"get_ticket_and_populate_wrapper('3822'); return false;\" title=\"param substitution does not honor per-daemon overrides\">#3822</a></span> ===VersionHistory:None=== bugs never shipped.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jul-30 09:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ebc6d33457702a31e50d713ce896d5c4b3331ff8\">[37037]</a></span>: change conversion of param_info.in from generated code to generated const data <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3821\" onclick=\"get_ticket_and_populate_wrapper('3821'); return false;\" title=\"convert param_info.in to static const data with binary lookup\">#3821</a></span> This saves about 50k per-process memory in the 64-bit shadow. ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Aug-26 11:01", "status": "resolved", "created": "2013-Jul-26 16:54", "fixed_version": "2013-Jul-26 16:54", "broken_version": "v080100", "priority": "2", "subsystem": "Libs", "assigned_to": "johnkn", "derived_from": "#3820", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "johnkn@cs.wisc.edu,dan@hep.wisc.edu", "due_date": ""}