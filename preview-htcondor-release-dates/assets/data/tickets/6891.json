{"id": 6891, "title": "Ticket #6891: job ads do not specify which tokens should be transferred", "description": "<blockquote>\nWhen a user submits a job that requires (or is provided) tokens, nothing is added to the job ad that says what (1) tokens the job requested and/or (2) what tokens the starter should request from the shadow. This is a problem because:\n<ol>\n<li>a user may want to query or edit jobs based on their token requests, and\n</li><li>the shadow sends all of a user's tokens to the starter from the submit machine because there is no way for the starter and/or shadow to know which tokens a job needs.\n</li></ol>\n\n<p>We should limit the tokens a user's job has access to to only those tokens the job needs. (This could include tokens not explicitly requested in a user's submit file if tokens are automatically being generated for each job, see OSG's scitoken workflow for example.)</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Mar-08 13:55:56 by zmiller:</em> <br/>\n\nAssigned to Jason for a \"runtime review\" to test in his environment.  I gave it a smoke test in my local environment but I don't have it set up to actually talk to any token servers.\n\n<p></p><hr/>\n<em>2019-Apr-09 11:31:07 by jpatton:</em> <br/>\n\n<strong>CODE REVIEW</strong>: LGTM. Note for when we get around to documenting token mode, the <code>OAuthServicesNeeded</code> attr in the job ad is a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StringList\" title=\"String List\">StringList</a></span> with each token name stored as <code>Provider*Handle</code>, <em>not</em> as <code>Provider_Handle</code>, which allows the admin to include underscores in the provider name in the config. This is good as, for example, a pool could be configured with multiple scitokens clients.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Mar-08 13:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/eac7cdded322df58cf749401e218e8c266aa2bd0\">[56323]</a></span>: Only send tokens for this particular job, not all tokens for a given user. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6891\" onclick=\"get_ticket_and_populate_wrapper('6891'); return false;\" title=\"job ads do not specify which tokens should be transferred\">#6891</a></span>  (By zmiller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Apr-09 11:31", "status": "resolved", "created": "2019-Feb-01 14:22", "fixed_version": "2019-Feb-01 14:22", "broken_version": "v080800", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "zmiller", "derived_from": "#6513", "creator": "jpatton", "rust": "", "customer_group": "scitokens", "visibility": "public", "notify": "jpatton@cs.wisc.edu,tannenba@cs.wisc.edu,bbockelman@morgridge.org,zmiller@cs.wisc.edu", "due_date": ""}