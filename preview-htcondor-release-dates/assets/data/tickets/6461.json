{"id": 6461, "title": "Ticket #6461: IPv6 causes crashes in ReliSock::serialize()", "description": "<blockquote>\n(See build ID 421606.)\n\n<p>When run the IPv6 tests are run on CentOS7, we get the following stack trace from the startd, which causes tests to fail:\n\n</p><p></p><div class=\"verbatim\">\n<pre>Stack dump for process 3393720 at timestamp 1508882382 (37 frames)\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(dprintf_dump_s\ntack+0x72)[0x2b84af4d87c2]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_Z18linux_sig_\ncoredumpi+0x24)[0x2b84af620754]\n/lib64/libpthread.so.0(+0xf370)[0x2b84b0ea8370]\n/lib64/libc.so.6(gsignal+0x37)[0x2b84b10ea1d7]\n/lib64/libc.so.6(abort+0x148)[0x2b84b10eb8c8]\n/lib64/libc.so.6(+0x74f07)[0x2b84b1129f07]\n/lib64/libc.so.6(__fortify_fail+0x37)[0x2b84b11c4047]\n/lib64/libc.so.6(+0x10d200)[0x2b84b11c2200]\n/lib64/libc.so.6(+0x10c709)[0x2b84b11c1709]\n/lib64/libc.so.6(_IO_default_xsputn+0xbc)[0x2b84b112d60c]\n/lib64/libc.so.6(_IO_vfprintf+0x805)[0x2b84b10fc935]\n/lib64/libc.so.6(__vsprintf_chk+0x88)[0x2b84b11c1798]\n/lib64/libc.so.6(__sprintf_chk+0x7d)[0x2b84b11c16ed]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZNK8ReliSock9serializeEv+0xbc)[0x2b84af5c432c]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN10DaemonCore14Create_ProcessEPKcRK7ArgList10priv_stateiiiPK3EnvS1_P10FamilyInfoPP6StreamPiSE_iP10__sigset_tiPmSE_S1_P8MyStringP15FilesystemRemapl+0x885)[0x2b84af6414f5]\ncondor_startd(_ZN7Starter13execDCStarterERK7ArgListPK3EnvPiP6Stream+0x612)[0x42ce52]\ncondor_startd(_ZN7Starter13execDCStarterEP6Stream+0x126)[0x42daf6]\ncondor_startd(_ZN7Starter5spawnElP6Stream+0x46)[0x42de36]\ncondor_startd(_ZN5Claim12spawnStarterEP6Stream+0x2a)[0x45803a]\ncondor_startd(_Z14activate_claimP8ResourceP6Stream+0x812)[0x450442]\ncondor_startd(_Z22command_activate_claimP7ServiceiP6Stream+0x24b)[0x45089b]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN10DaemonCore18CallCommandHandlerEiP6Streambbff+0x30c)[0x2b84af6362bc]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN21DaemonCommandProtocol11ExecCommandEv+0x161)[0x2b84af61dde1]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN21DaemonCommandProtocol10doProtocolEv+0x135)[0x2b84af61e7f5]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN10DaemonCore9HandleReqEP6StreamS1_+0x5b)[0x2b84af631f0b]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN10DaemonCore14HandleReqAsyncEP6Stream+0xb)[0x2b84af63209b]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN18SharedPortEndpoint13ReceiveSocketEP8ReliSockS1_+0x205)[0x2b84af5d3d65]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN18SharedPortEndpoint16DoListenerAcceptEP8ReliSock+0x17b)[0x2b84af5d3fcb]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN18SharedPortEndpoint20HandleListenerAcceptEP6Stream+0x62)[0x2b84af5d4042]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN10DaemonCore24CallSocketHandler_workerEibP6Stream+0x654)[0x2b84af635374]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN10DaemonCore35CallSocketHandler_worker_demarshallEPv+0x1d)[0x2b84af63544d]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN13CondorThreads8pool_addEPFvPvES0_PiPKc+0x35)[0x2b84af449435]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN10DaemonCore17CallSocketHandlerERib+0x14a)[0x2b84af63279a]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_ZN10DaemonCore6DriverEv+0x1ceb)[0x2b84af63b73b]\n/slots/05/dir_2822586/userdir/condor/lib/libcondor_utils_8_7_5.so(_Z7dc_mainiPPc+0x13e8)[0x2b84af623de8]\n/lib64/libc.so.6(__libc_start_main+0xf5)[0x2b84b10d6b35]\ncondor_startd[0x4236db]\n</pre></div>\n\n\n<p>Code examination quickly discovered a pair of fixed-size buffers, either of which could be over-run by the long Sinful strings produced by IPv6.  This ticket is for the quick fix (expand the buffers); the real fix will be a child ticket (size the serialized string dynamically).</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Oct-25 13:23:58 by tlmiller:</em> <br/>\n\nRun ID 421836 verifies that upping the constants in question is a workable quick fix.\n\n<p></p><hr/>\n<em>2017-Oct-25 15:36:42 by tim:</em> <br/>\n\n<strong>Code and Doc Review:</strong> Looks good</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6462\" onclick=\"get_ticket_and_populate_wrapper('6462'); return false;\" title=\"Do not use fixed-size buffers for Sock::serialize().\">#6462</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDo not use fixed-size buffers for Sock::serialize().</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Oct-25 13:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bfd6b65db6942bdf9c4fe954dd50a7f0e7d6c178\">[52653]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6461\" onclick=\"get_ticket_and_populate_wrapper('6461'); return false;\" title=\"IPv6 causes crashes in ReliSock::serialize()\">#6461</a></span>) Release note.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Oct-25 13:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6300148657c4db12e5f3b4a66a97f292832fe5a2\">[52651]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6461\" onclick=\"get_ticket_and_populate_wrapper('6461'); return false;\" title=\"IPv6 causes crashes in ReliSock::serialize()\">#6461</a></span>) Changing this pair of constants may work around a bug for a little while.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Oct-28 20:01", "status": "resolved", "created": "2017-Oct-25 13:23", "fixed_version": "2017-Oct-25 13:23", "broken_version": "v080508", "priority": "1", "subsystem": "Libs", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, johnkn@cs.wisc.edu, tim@cs.wisc.edu", "due_date": ""}