{"id": 949, "title": "Ticket #949: CronJobBase::StartJob and RunJob return codes need review", "description": "<blockquote>\nCronJobBase::StartJob and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RunJob\" title=\"Run Job\">RunJob</a></span> are registered as timers, which means their return code is entirely ignored.\n\n<p><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StartJob\" title=\"Start Job\">StartJob</a></span> returns 0 if the job is not idle, else RunProcess's return value. It is used by Reaper and Schedule. Its return code is ignored by Reaper.\n\n</p><p><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RunJob\" title=\"Run Job\">RunJob</a></span> returns -1 if killing the job is not allowed, else KillJob's return value; else, RunProcess's return value. It is used by Reaper and Schedule. Its return code is ignored by Reaper.\n\n</p><p>KillJob's return code is 0 if job is idle/dead or if a SIGKILL was attempted (even if it failed), 1 if job is sent a SIGTERM (note: a SIGKILL is registered), and -1 if the job is not running. The code is ignored when returned to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=KillHandler\" title=\"Kill Handler\">KillHandler</a></span>.\n\n</p><p>RunProcess's return code is -1 on failure and 0 on success.\n\n</p><p>Schedule's return code is 0 if uninitialized, or the return value of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StartJob\" title=\"Start Job\">StartJob</a></span>, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SetTimer\" title=\"Set Timer\">SetTimer</a></span> or <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RunJob\" title=\"Run Job\">RunJob</a></span>. It is called by Initialize and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SetPeriod\" title=\"Set Period\">SetPeriod</a></span>, which return its code.\n\n</p><p>SetTimer's return code is -1 if timer creation fails, otherwise 0. It is called by Reaper, where the code is ignored, and by Schedule.\n\n</p><p>Initialize is called by <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=InitializeAll\" title=\"Initialize All\">InitializeAll</a></span> where the return code is ignored. It is also called from the startd, where the return code is ignored.\n\n</p><p><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SetPeriod\" title=\"Set Period\">SetPeriod</a></span> is called from CronMgrBase::ParseJobList and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ParseOldJobList\" title=\"Parse Old Job List\">ParseOldJobList</a></span> where the return code is ignored.\n\n</p><p><strong>Conclusion:</strong> <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StartJob\" title=\"Start Job\">StartJob</a></span> and RunJob's return code is entirely unused, give the impression that it is used, and may be masking unhandled error conditions.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "todo", "last_change": "2009-Dec-27 18:14", "status": "new", "created": "2009-Nov-14 14:46", "fixed_version": "2009-Nov-14 14:46", "broken_version": "", "priority": "4", "subsystem": "Daemons", "assigned_to": "matt", "derived_from": "#946", "creator": "matt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu", "due_date": ""}