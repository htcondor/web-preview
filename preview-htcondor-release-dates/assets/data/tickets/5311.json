{"id": 5311, "title": "Ticket #5311: Starter needs to manage krb5ccache in job sandbox", "description": "<blockquote>\nThe starter currently receives the opaque credntial and activates it using the credential monitor.  However, it also then needs to securely copy this into the job sandbox, owned and readable only by the user.  It needs to periodically refresh this as well.\n\n<p>As a workaround to our potential PAG issue (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5302\" onclick=\"get_ticket_and_populate_wrapper('5302'); return false;\" title=\"Kerberos token and AFS investigation\">#5302</a></span>) the starter could run aklog everytime it does this to acquire and keep the AFS tokens for this job refreshed and within this PAG (assuming starter and job share a PAG... wrapper script could work too)\n\n</p><p>Finally, the starter needs to set the KRB5CCNAME environment variable to point to the ccache in the job sandbox before spawning the job.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-11 09:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/778edaa99048b82217569ba3a50dc1c8577bf04c\">[47704]</a></span>: Use memset instead of bzero for windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5311\" onclick=\"get_ticket_and_populate_wrapper('5311'); return false;\" title=\"Starter needs to manage krb5ccache in job sandbox\">#5311</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-09 16:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d1b2d45dc768138f1a0eb9ddf9202bc9f72984b7\">[47686]</a></span>: Set user priv when writing credential into sandbox. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5311\" onclick=\"get_ticket_and_populate_wrapper('5311'); return false;\" title=\"Starter needs to manage krb5ccache in job sandbox\">#5311</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-15 19:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/eeac034bdc5ec5c74b635ee7107e0ef117b7f111\">[45993]</a></span>: Rework refreshSandboxCredentials() to both utilize read_secure_file() and always set the timer, even on failure. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5315\" onclick=\"get_ticket_and_populate_wrapper('5315'); return false;\" title=\"create a secure_read_file() to remove several duplicate code blocks\">#5315</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5311\" onclick=\"get_ticket_and_populate_wrapper('5311'); return false;\" title=\"Starter needs to manage krb5ccache in job sandbox\">#5311</a></span>  (By Zach Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-15 13:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/938dba4552e3c448f7bf18f8b5ef83855e06c0c9\">[45987]</a></span>: have starter monitor the root-owned credential cache and keep the user's sandbox copy up to date. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5311\" onclick=\"get_ticket_and_populate_wrapper('5311'); return false;\" title=\"Starter needs to manage krb5ccache in job sandbox\">#5311</a></span>  (By Zach Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-15 13:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/86fd48ab3195c4f8bf0774dfad06b70a394fb001\">[45986]</a></span>: Change krb5ccache to krb5ccname and get env variable format correct <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5311\" onclick=\"get_ticket_and_populate_wrapper('5311'); return false;\" title=\"Starter needs to manage krb5ccache in job sandbox\">#5311</a></span>  (By Zach Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-15 09:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0b230d583e0343696d5c74be2fe40b7086cc0228\">[45985]</a></span>: Add plumbing to allow the setting of KRB5CCACHE in job environment <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5311\" onclick=\"get_ticket_and_populate_wrapper('5311'); return false;\" title=\"Starter needs to manage krb5ccache in job sandbox\">#5311</a></span>  (By Zach Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Apr-26 20:57", "status": "resolved", "created": "2015-Oct-14 18:52", "fixed_version": "2015-Oct-14 18:52", "broken_version": "", "priority": "1", "subsystem": "Security", "assigned_to": "zmiller", "derived_from": "#5272", "creator": "zmiller", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "zmiller@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": "20151017"}