{"id": 3419, "title": "Ticket #3419: condor_submit won't expand macros directly inserted into job classad", "description": "<blockquote>\nYou can specify macros for expansion in your submit file in the form $(Name).  This works for \"normal\" submit file entries, but not for things directly inserted into the job's classad using +Name=blah.\n\n<p>For example, given a submit file of:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">universe=vanilla\nrequirements=false\nexecutable=/bin/date\narguments=foo=$(foo) qux=$(qux)\nfoo=foo\n+qux=\"qux\"\nqueue\n</pre></div>\n\n\n<p>Actual output:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">sh-4.1$ condor_submit submit\nSubmitting job(s).\n1 job(s) submitted to cluster 45.\nsh-4.1$ condor_q -format '%s\\n' Args 45\nfoo=foo qux=\n</pre></div>\n\n\n<p>Expected output:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">sh-4.1$ condor_submit submit\nSubmitting job(s).\n1 job(s) submitted to cluster 45.\nsh-4.1$ condor_q -format '%s\\n' Args 45\nfoo=foo qux=qux\n</pre></div>\n\n\n<p>This was an actual nuisance, as I was setting a variable used by the machine's requirements, and that I had done so I wanted to pass to the arguments.  I wanted to say something like:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">arguments=--log-level=D_FULLDEBUG --identity=$(TrustedUser)\n\n+TrustedUser=\"username\"\nqueue\n\n+TrustedUser=\"someoneelse\"\nqueue\n\n+TrustedUser=\"bob\"\nqueue\n</pre></div>\n\n\n<p>but had to say:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">arguments=--log-level=D_FULLDEBUG --identity=username\n+TrustedUser=\"username\"\nqueue\n\narguments=--log-level=D_FULLDEBUG --identity=someoneelse\n+TrustedUser=\"someoneelse\"\nqueue\n\narguments=--log-level=D_FULLDEBUG --identity=bob\n+TrustedUser=\"bob\"\nqueue\n</pre></div>\n\n\n<p>This is more verbose and more prone to mistakes.\n\n</p><p>Tangentially related: Ticket <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=2091\" onclick=\"get_ticket_and_populate_wrapper('2091'); return false;\" title=\"Condor_submit should warn or fail if undefined macro used\">#2091</a></span>: Condor_submit should warn or fail if undefined macro used.  If that was implemented, as least you'd be warned that it hadn't worked, instead of silently being an empty string.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Jan-08 20:30:42 by nwp:</em> <br/>\n\nCan you do\n<div class=\"code\">\n<pre class=\"code\">arguments=foo=$(foo) qux=$$([qux])\n</pre></div>\n\n\n<p></p><hr/>\n<em>2013-Jan-08 20:39:15 by nwp:</em> <br/>\n\nWhy yes you can:\n<div class=\"code\">\n<pre class=\"code\">executable = /bin/echo\nuniverse = vanilla\narguments = $$([foo])\noutput = 3419.$(cluster).$(process).out\nerror = 3419.$(cluster).$(process).err\nlog = 3419.log\nshould_transfer_files = yes\nwhen_to_transfer_output = on_exit\n+foo = 1\nqueue\n\n+foo = 2\nqueue\n</pre></div>\n\nproduces the expected output.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2013-Jan-08 20:39", "status": "new", "created": "2013-Jan-08 20:18", "fixed_version": "2013-Jan-08 20:18", "broken_version": "v070900", "priority": "4", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}