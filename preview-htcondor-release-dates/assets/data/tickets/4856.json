{"id": 4856, "title": "Ticket #4856: Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file", "description": "<blockquote>\nCurrently, encryption of the execute directory is only available on Windows, and can only be enabled by the admin via the starter config knob ENCRYPT_EXECUTE_DIRECTORY.\n\n<p>This ticket will 1) allow the execute directory to be encrypted on Linux via ecryptfs, and 2) allow the user to require that the execute directory be encrypted in the job classad (implying the job can only match machines that are capable of this feat).</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4872\" onclick=\"get_ticket_and_populate_wrapper('4872'); return false;\" title=\"Add ecryptfs-utils as dependency to binary packaging\">#4872</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd ecryptfs-utils as dependency to binary packaging</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-19 13:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/71a025d525eaec1b9ca54ff1d28e23683671c256\">[43420]</a></span>: Add version history item for 2 8.3.3 known bugs. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4902\" onclick=\"get_ticket_and_populate_wrapper('4902'); return false;\" title=\"OnExitHold on windows in local universe broken\">#4902</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-19 13:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/aeef1e2e84dad75b0f280ce524ea2c83e2227fbb\">[43418]</a></span>: edit new knob definitions for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-19 12:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d3fd44ef9bd52bad29cbb90f815d1da50c674b57\">[43412]</a></span>: Document knob DISCARD_SESSION_KEYRING_ON_STARTUP. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-19 11:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6ca52fcd555a9541828c510b82f5917b73c8bf1f\">[43411]</a></span>: Documentation for knob ECRYPTFS_ADD_PASSPHRASE. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-19 10:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f6749e06b2dfb0d946186fc248ba2ca6b1a67a21\">[43414]</a></span>: fix typo in version history item for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-06 13:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/27de3b7009ac198ce82ca2f9c3eb0c8e8607c0bc\">[43277]</a></span>: documentation edits for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-06 10:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/69ff7f0b9e367ed08f941a1cb9db14de09212944\">[43272]</a></span>: Version history entry for encrypt_execute_directory enhancements. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-06 10:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/51f5dc4d520f51e8e03c4376ef32f8c2e86a9c64\">[43271]</a></span>: Documentation for encrypt_execute_directory changes. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-03 11:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b19a180f7f061f0d12248f76bda19f08767e5458\">[43218]</a></span>: Always include syscall.h, needed for encrypted execute directory keys. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-02 17:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/598dccef509fba5eaf7bf2423575b5c7bf571b7c\">[42525]</a></span>: If encrypt_execute_directory is True, encrypt /tmp and /var/tmp. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span> We do this by simply adding /tmp,/var/tmp to MOUNT_UNDER_SCRATCH if the excute directory is encrypted.  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-02 16:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f2ddf79868a1063f81f2ca25a7c6721a24935e10\">[42522]</a></span>: make g++ shut up about return value of write for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-02 14:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/09d8f2021c65ddb3545f0cacca1b7bd0204a0a2a\">[42516]</a></span>: Allow jobs to request encrypt_execute_directory in submit file. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span> In addition honoring admin desires to encrypt the execute directory via a knob in condor_config, allow users to specify it in the submit file on both Windows and Linux. This also requires the starter to advertise it as a capability\u00a0[...]\n (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-02 14:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/eeec609ff847fcd263cc7df24bb40db224f3f6e7\">[42515]</a></span>: Fix compile warning on Fedora (check fscanf return val). <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-02 13:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/51c57362580933679767f70c01b73cf7c7d028a2\">[42507]</a></span>: fix build break for non-clipped builds <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-30 16:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/eb46b63fff62e22b52203e2cf2f9c27660a6dca5\">[42500]</a></span>: Implement ENCRYPT_EXECUTE_DIRETORY on Linux. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span> Encrypt the execute directory on linux via ecryptfs and private mount namespaces. If enabled, the startd will create a subdirectory in the execute dir, and while spawning the starter, the startd will perform an ecryptfs mount of this subdirectory in\u00a0[...]\n (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-30 14:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/27d537f8c74558ec48eefeb2a3533b0d763b5f5d\">[42499]</a></span>: Added method to fill a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyString\" title=\"My String\">MyString</a></span> with a random password. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-30 14:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0d92b2436839e2b8397de46e276f118e5fc70fcb\">[42498]</a></span>: Utility function to check if linux kernel is version X or newer. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-30 14:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5ddd48cca1ef609ac02e477526aa184485314175\">[42497]</a></span>: Enable my_popen() to both write and read from child on Linux. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span> Normally popen() can write to stdin or read from stdout/err, but not both. This change allows a small (2k) null-terminated buffer to be sent to the child's stdin when using my_popen in \"r\" mode on Linux.  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-30 14:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e1ba775ce9b84bd9ca197b4188dbbd559fea0cce\">[42496]</a></span>: Add param_with_full_path() function to safely expand path of param. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Feb-18 15:35", "status": "resolved", "created": "2015-Jan-30 12:08", "fixed_version": "2015-Jan-30 12:08", "broken_version": "", "priority": "2", "subsystem": "DaemonsExecNode", "assigned_to": "tannenba", "derived_from": "", "creator": "tannenba", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "", "due_date": ""}