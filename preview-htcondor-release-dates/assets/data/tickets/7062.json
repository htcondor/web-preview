{"id": 7062, "title": "Ticket #7062: Add ctest support for HTCondor unit tests", "description": "<blockquote>\nThe integration tests present an extremely high hurdle for folks to run (see: <a class=\"external\" href=\"/wiki-archive/pages/TestingHtCondorOnLinuxImproved\">TestingHtCondorOnLinuxImproved</a>).\n\n<p>Given that cmake comes with a built-in test driver, we should tweak the setup such that ctest can invoke <code>run_test.pl</code> appropriately.  The goal is to:\n\n</p><p></p><ol>\n<li>Allow test runs to be idempotent.  Developers should be able to invoke <code>ctest</code> cleanly multiple times.\n</li><li>Allow <code>ctest</code> to run many tests in parallel.\n</li><li>Not disrupt the NMI builds.</li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2019-Aug-02 09:10:48 by bbockelm:</em> <br/>\n\nClosing as this is mostly done.  Small fix-ups can happen separately from this ticket.\n\n<p>Behavior not visible to users so I'm not including any release history notes.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-20 16:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0df41cfc0a8d48d5d70a6748e3f177169c237649\">[57215]</a></span>: Fixup ctest dependency for condor_on/off test. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/46529b740f85acc53eff9108c4a772aa43005b3f\">[56938]</a></span>: Only run batlab unit tests in NMI glue, not all of them. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8e632885e1ff72970f12783e964d4cd1602c3266\">[56937]</a></span>: Fixup the final dependencies in ctest. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/343a88e129033a516be3774bdf2eafc66f84a61e\">[56936]</a></span>: Add sleep statements to give time for old tests/jobs to exit the queue. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a122632a35ef4c0d07b8828a7de50bad09c867c6\">[56935]</a></span>: Do not fail if initd cannot be removed completely. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span> When run on NFS, this directory cannot be deleted because the perl process itself holds an open file handle to a file inside the directory, resulting in undeleteable shadow file handles until the test suite fails.\u00a0[...]\n (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b0d35ca5ed95c66db1bedcb8b6490ca155722831\">[56934]</a></span>: Switch to x_sleep.pl where available; test should only need a file that exists, not one that works on Windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/83671b9d5c77bc27d4c06cb0792d4c4c412fbdc3\">[56933]</a></span>: Speed up the negotiator for concurrency limit tests. Keeps things under time threshold. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a3bbca881f8bbef1fd5d57da59b722d448f017f6\">[56932]</a></span>: Another round of test dependency fixups. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/86b4991c23d7da67ce0675514747fa4c54cd34b1\">[56931]</a></span>: Adjust timeouts in CMR tests; add sleep to allow cluster to come up. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b43c9d6f50f37997acfecdc3e70fc14813e46cb0\">[56930]</a></span>: Reduce sleep times and mandatory waits for concurrency tests. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f61a0df63881f6faaae55cd11f7cfe515e420f40\">[56929]</a></span>: Close file handle; relevant for cleaning out working directories on NFS hosts. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/70a69a9f69505cbac2e619acc89804c102bbff0d\">[56927]</a></span>: Fix additional test dependencies for ctest. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/aa5463066d814b8e4cc23b0e166cbaef90a37e55\">[56928]</a></span>: Increase look-back; some tests are more chatty on test hosts with larger CPU counts. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3cc076238552c310b0bc911fa391005dd617fba6\">[56926]</a></span>: Continued fixing of unit tests under ctest. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2616bb4ad8ac8cd8addc5ada3772192292143de2\">[56925]</a></span>: Rename executable to avoid target name clashes on Windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9d0c41c4e22d57bca313577887243bc21cffc48e\">[56924]</a></span>: Convert over a large number of tests to ctest. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 08:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b80883465f9a07b6721847cad91aa91d68b77fb7\">[56923]</a></span>: Convert a subset of HTCondor tests to ctest. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7062\" onclick=\"get_ticket_and_populate_wrapper('7062'); return false;\" title=\"Add ctest support for HTCondor unit tests\">#7062</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Aug-02 09:10", "status": "resolved", "created": "2019-May-22 07:58", "fixed_version": "2019-May-22 07:58", "broken_version": "", "priority": "3", "subsystem": "Packaging", "assigned_to": "bbockelm", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bbockelman@morgridge.org; tannenba@cs.wisc.edu", "due_date": ""}