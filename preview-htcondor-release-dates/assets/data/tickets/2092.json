{"id": 2092, "title": "Ticket #2092: Negotiator miscounts resources it hands out", "description": "<blockquote>\nIn each pie spin in Phase 4.x, we keep a running total of the number of resources used by the schedd's which were active in that pie spin.  This number is cumulative across all pie spins.\n\n<p>This doesn't make any sense to me.  If you have schedd's that hit their submitter limit, they are added to scheddUsed.  Hence, in the second spin, their usage is double-counted.\n\n</p><p>I see this in our 7.5.6 negotiator; in phase 4.1, the group usage is counted as 563 (correct), but there are no matches.  In 4.2, it counts 1100 resources used by the group (incorrect), and hence has stuff like this:\n\n</p><p>04/26/11 09:29:05    maxAllowed  = -366.000000 groupQuota  = 734.000000 groupusage  = 1100.000000\n\n</p><p>In addition to counting groupusage correctly, we can probably halt the spin if maxAllowed is currently negative.\n\n</p><p>This is seriously affecting our ability to use 7.5.6 at our CMS T2.</p></blockquote>", "remarks": "<blockquote>\nThis problem appears to be fixed by <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ad9146b93c99f76436851f586d31d26e9c01ea0c\">[21563]</a></span>, but that checkin was done on the master branch rather than V7_6-branch.  I think it should have gone into V7_6-branch.  I will confirm with eje that this is what was intended.\n\n<p></p><hr/>\n<em>2011-Apr-26 12:27:49 by danb:</em> <br/>\n\nI have cherry picked <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ad9146b93c99f76436851f586d31d26e9c01ea0c\">[21563]</a></span> to V7_6-branch.  It should fix the problem reported in this ticket.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2011-Apr-26 12:28", "status": "resolved", "created": "2011-Apr-26 10:05", "fixed_version": "2011-Apr-26 10:05", "broken_version": "v070506", "priority": "2", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "#1393", "creator": "bbockelm", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "danb@cs.wisc.edu", "due_date": ""}