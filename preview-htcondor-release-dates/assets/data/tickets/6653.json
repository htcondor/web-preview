{"id": 6653, "title": "Ticket #6653: Fix build on Mac OS 10.13 High Sierra", "description": "<blockquote>\nIn macOS 10.13 (High Sierra), the default version of libssl and libcrypto was changed from OpenSSL 0.9.8zh to LibreSSL 2.2.7. The older libraries are still available, but still no header files. The main effect on HTCondor is that VOMS uses some old ssleay functions that have been removed from LibreSSL (<code>ASN1_verify()</code>, <code>ASN1_sign()</code>, <code>ASN1_digest()</code>). Oddly, the VOMS and HTCondor code still builds and links, and the HTCondor binaries run fine. But the Python bindings fail when dlopen()ing libcondor_utils, due to the missing symbols.\n\n<p>The newest VOMS code still uses these old functions that aren't in LibreSSL, and VOMS doesn't appear to be under active development anymore. These old functions should be replaceable by newer functions in the API, but I'm having trouble finding documentation. For example, <code>EVP_Digest()</code> appears to be suitable replacement for <code>ASN1_digest()</code>, but the parameters are different.\n\n</p><p>A few options:\n</p><ul>\n<li>Continuing using the crusty OpenSSL 0.9.8 on macOS.\n</li><li>Drop VOMS support on macOS.\n</li><li>Figure out how to patch VOMS to replace the old ssl functions.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2018-Apr-17 15:55:52 by jfrey:</em> <br/>\n\nI figured out why the linking and running succeed when the openssl functions are missing. The voms build script passes <code>-undefined dynamic_lookup</code> to the linker when creating the voms dynamic library. So everything compiles and runs without the symbols. But the process will explode if it tries to call one of them.\n\n<p></p><hr/>\n<em>2018-May-03 10:59:24 by jfrey:</em> <br/>\n\nAll versions of macOS will continue to use OpenSSL 0.9.8 in the 8.6.x series. On macOS 10.13 and above, we will directly link with the \"out-of-date\" 0.9.8 libraries in /usr/lib. A switch to LibreSSL may happen in 8.7 (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6668\" onclick=\"get_ticket_and_populate_wrapper('6668'); return false;\" title=\"Use LibreSSL on Mac OS 10.13 High Sierra\">#6668</a></span>).\n\n<p></p><hr/>\n<em>2018-May-04 13:24:24 by tim:</em> <br/>\n\n<strong>CODE REVIEW:</strong> Changes look good and are concise.\n\n<p></p><hr/>\n<em>2018-May-04 13:24:48 by tim:</em> <br/>\n\n<strong>DOC REVIEW:</strong> No docs needed</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6668\" onclick=\"get_ticket_and_populate_wrapper('6668'); return false;\" title=\"Use LibreSSL on Mac OS 10.13 High Sierra\">#6668</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nUse LibreSSL on Mac OS 10.13 High Sierra</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Apr-26 15:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/59128a23f27e6294e7bedfc6f9f4bf3bbaaa371f\">[54800]</a></span>: Fix cmake syntax error on non-macOS platforms. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6653\" onclick=\"get_ticket_and_populate_wrapper('6653'); return false;\" title=\"Fix build on Mac OS 10.13 High Sierra\">#6653</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Apr-26 12:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5c19708ddedc3eba9583cd93efb6478094b7e5c4\">[54799]</a></span>: Use older openssl version on macOS High Sierra. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6653\" onclick=\"get_ticket_and_populate_wrapper('6653'); return false;\" title=\"Fix build on Mac OS 10.13 High Sierra\">#6653</a></span> The default version of openssl on High Sierra is libressl 2.2.7, which removes several functions that globus and voms use. Use the older openssl 0.9.8za, which is also available.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-May-04 13:25", "status": "resolved", "created": "2018-Apr-17 14:29", "fixed_version": "2018-Apr-17 14:29", "broken_version": "", "priority": "3", "subsystem": "Security", "assigned_to": "jfrey", "derived_from": "#6046", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}