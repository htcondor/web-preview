{"id": 7553, "title": "Ticket #7553: Collector can hang when a port scanner probes it", "description": "<blockquote>\nWhen an arbitrary application opens port 9618 and sends bytes, those bytes will end up going to the collector unless the bytes happen to match a shared port command id.  When that happens, if the number of bytes is less than the size of a CEDAR packet header (5 bytes normally, 5+16 if integrity is enabled), then the collector will block forever or until the other end of the socket is closed.\n\n<p>For the most part, command delivery to a HTCondor daemon is non-blocking, but in the special case of reading the CEDAR header after at least 1 byte is on the wire, the read is blocking, and the timeout is infinite.\n\n</p><p>We should change this code so that the timeout is small when the socket is in non-blocking mode, and we should first make sure that the bytes that are already available are consistent with there being a valid CEDAR header on the way.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Apr-03 11:07:54 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This code looks good.\n</p><hr/>\n<em>2020-Apr-10 07:43:03 by tim:</em> <br/>\n\nBulk change of target version from v080808 to v080809 using ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-21 12:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/aaa85b7edad7854308d925d88a799982217e2bfa\">[59431]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7553\" onclick=\"get_ticket_and_populate_wrapper('7553'); return false;\" title=\"Collector can hang when a port scanner probes it\">#7553</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7521\" onclick=\"get_ticket_and_populate_wrapper('7521'); return false;\" title=\"p-slot child rollup should contain evaluated d-slot values\">#7521</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7542\" onclick=\"get_ticket_and_populate_wrapper('7542'); return false;\" title=\"SLOT_TYPE_N configuration works START, not for RANK, etc\">#7542</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7605\" onclick=\"get_ticket_and_populate_wrapper('7605'); return false;\" title=\"condor_gpu_discovery crashes on PowerPC\">#7605</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7360\" onclick=\"get_ticket_and_populate_wrapper('7360'); return false;\" title=\"macro default does not allow - character and workaround is broken\">#7360</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7591\" onclick=\"get_ticket_and_populate_wrapper('7591'); return false;\" title=\"preempting claim in a GPU slot attempts to add another GPU and fails\">#7591</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7479\" onclick=\"get_ticket_and_populate_wrapper('7479'); return false;\" title=\"MAX_PROCD_LOG does not honor units suffix\">#7479</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-12 13:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/165cc98bfe5f1e8596409001572d830052e3ebfa\">[59135]</a></span>: fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7553\" onclick=\"get_ticket_and_populate_wrapper('7553'); return false;\" title=\"Collector can hang when a port scanner probes it\">#7553</a></span>, Collector can hang when a port scanner probes it. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Apr-21 12:08", "status": "resolved", "created": "2020-Mar-12 13:10", "fixed_version": "2020-Mar-12 13:10", "broken_version": "", "priority": "4", "subsystem": "", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "s99798", "customer_group": "fermi", "visibility": "public", "notify": "", "due_date": ""}