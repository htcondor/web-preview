{"id": 5222, "title": "Ticket #5222: enable classad caching by default on Windows", "description": "<blockquote>\nclassad caching was enabled by default in non-windows platforms last series.  But on windows there was an occasional intermittent crash on shutdown that prevented this.  A recent change to free more things on shutdown (part of the Valgrind work), made this crash on exit on Windows 100% reproducible.\n\n<p>The problem is that the classad cache is essentially a static global class, and it can be destructed before all of the classads are destructed when the classad library is statically linked into a binary - which it is on windows.\n\n</p><p>The fix is a bit hacky, but essentially, we add a flag at global scope that short-circuits calls to remove items from the cache after it has been destructed.  This fixes the crash on exit, and allows us to make the configuration for classad caching the same on Windows as it is on other platforms.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Sep-18 08:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c0e6b861f22e7b49ffb847eb5f4b331bfe003101\">[45860]</a></span>: addition checking for free-after-use of classad cache <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5222\" onclick=\"get_ticket_and_populate_wrapper('5222'); return false;\" title=\"enable classad caching by default on Windows\">#5222</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-26 21:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7ee7d8aa93f23a6091017616d2e8fc41a53309bb\">[45718]</a></span>: minor edit of 8.3.8 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5222\" onclick=\"get_ticket_and_populate_wrapper('5222'); return false;\" title=\"enable classad caching by default on Windows\">#5222</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-25 15:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0f11e073b5799d851c2b9e492336f54c6a3c9029\">[45675]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5222\" onclick=\"get_ticket_and_populate_wrapper('5222'); return false;\" title=\"enable classad caching by default on Windows\">#5222</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5225\" onclick=\"get_ticket_and_populate_wrapper('5225'); return false;\" title=\"default SLOTS_CONNECTED_TO_KEYBOARD to all slots\">#5225</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5227\" onclick=\"get_ticket_and_populate_wrapper('5227'); return false;\" title=\"condor_who doesn't query the startd unless -allpids is passed.\">#5227</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-15 14:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1ac928126f305f2927912d6908a07f5d854a2905\">[45635]</a></span>: fix crash-on-exit on Windows when clasad caching is enabled, and enable caching by default. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5222\" onclick=\"get_ticket_and_populate_wrapper('5222'); return false;\" title=\"enable classad caching by default on Windows\">#5222</a></span>  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Sep-18 08:40", "status": "resolved", "created": "2015-Aug-15 14:53", "fixed_version": "2015-Aug-15 14:53", "broken_version": "", "priority": "3", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}