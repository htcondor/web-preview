{"id": 601, "title": "Ticket #601: Event log rotation on Win32 probably broken with >1 writer process", "description": "<blockquote>\nFrom looking at the code in it's current state, it's obvious that the writer does not (and never did) close the event log file while writing (except during rotations).  Thus, if there's more than one writer process, the file will never be closed, and rotations will always fail.\n\n<p>It works on UNIX because UNIX semantics allow for rename / delete operations on open files.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Jun-24 08:40:09 by tannenba:</em> <br/>\n\nPlease fill in the version field so we know if it is 7.2.x or 7.3.x, thanks.\n\n<p>Ugh, this isn't going to be quite as easy as I had hoped...  The code isn't prepared to handle the case of the file being closed except for during initialization and rotations.\n\n</p><p></p><hr/>\n<em>2009-Oct-08 12:27:01 by nleroy:</em> <br/>\n\nI believe this is fixed...  Updates to test_log_writer.cpp to test this are stalled.\n<hr/>\n<em>2010-Oct-27 16:39:01 by adesmet:</em> <br/>\n\nBulk change of target version from v070404 to v070405 using ./ticket-target-mover.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=691\" onclick=\"get_ticket_and_populate_wrapper('691'); return false;\" title=\"Race condition during initialization of event log\">#691</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nRace condition during initialization of event log</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=700\" onclick=\"get_ticket_and_populate_wrapper('700'); return false;\" title=\"Submit event written to Eventlog by both condor_submit and schedd\">#700</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nSubmit event written to Eventlog by both condor_submit and schedd</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Aug-26 22:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/043ff86c03e528664ea39b0aa2f3f5ee684214f0\">[15520]</a></span>: Fixed a bug in the event log code which could cause the event log to never be rotated on Windows. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=601\" onclick=\"get_ticket_and_populate_wrapper('601'); return false;\" title=\"Event log rotation on Win32 probably broken with &gt;1 writer process\">#601</a></span>)  (By Nick <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LeRoy\" title=\"Le Roy\">LeRoy</a></span> )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Aug-26 16:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d83466b6c34b008f97e63de2034e96c96303e6a7\">[15512]</a></span>: Fixed a bug in the event log code which could cause the event log to never be rotated on Windows. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=601\" onclick=\"get_ticket_and_populate_wrapper('601'); return false;\" title=\"Event log rotation on Win32 probably broken with &gt;1 writer process\">#601</a></span>)  (By Nick <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LeRoy\" title=\"Le Roy\">LeRoy</a></span> )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-May-28 15:21", "status": "resolved", "created": "2009-Jun-23 13:19", "fixed_version": "2009-Jun-23 13:19", "broken_version": "v070000", "priority": "2", "subsystem": "Win32", "assigned_to": "nleroy", "derived_from": "#759", "creator": "nleroy", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}