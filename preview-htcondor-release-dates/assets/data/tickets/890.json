{"id": 890, "title": "Ticket #890: gahp writing lots of data to stderr can wedge gridmanager", "description": "<blockquote>\nThe gridmanager and gahp_server can get into a deadlock. If the gahp writes a lot of data to stderr (more than will fit in the pipe buffer) at the same time that the gridmanager writes a new request to the gahp's stdin, the gahp will block trying to write to stderr while the gridmanager busy-loops trying to read from the gahp's stdout.\n\n<p>With the number of gahps around with third-party software that could be writing to stderr, making the gahp not block writing to stderr seems impractical. The best solution is to make the gridmanager read from the gahp's stderr in addition to the gahp's stdout (both non-blocking).\n\n</p><p>Better yet (though more work) would be to have the gridmanager talk to the gahp completely non-blocking, returning to daemon-core if reads/writes to the gahp's stdin/out would block. <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=648\" onclick=\"get_ticket_and_populate_wrapper('648'); return false;\" title=\"gridmanager busy-loops reading from gahp\">#648</a></span> is related.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Jun-17 11:14:51 by jfrey:</em> <br/>\n\nPushed a commit to master for 7.5.4 that fixes most of the problem. Now, whenever the gridmanager reads a gahp's stdout, it also reads it's stderr. There's still a potential deadlock between the gridmanager writing to the gahp's stdin and the gahp writing to its stderr. That should be harder to trigger, because it requires the data being written to both pipes to be larger than the pipe buffer.\n<hr/>\n<em>2010-Oct-20 15:59:08 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.\n<hr/>\n<em>2011-Jan-27 14:46:04 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 14:49:30 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-17 11:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/766a4ecff87c3a1aaf5f10e32224db667f1fa065\">[18486]</a></span>: Fix potential deadlock between gridmanager and gahp server. <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=890\" onclick=\"get_ticket_and_populate_wrapper('890'); return false;\" title=\"gahp writing lots of data to stderr can wedge gridmanager\">#890</a></span> When the gridmanager reads from a gahp server's stdout, it now also reads from the gahp's stderr. This eliminates a potential deadlock between the two.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Sep-12 13:18", "status": "defer", "created": "2009-Oct-29 18:12", "fixed_version": "2009-Oct-29 18:12", "broken_version": "v070400", "priority": "4", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}