{"id": 1875, "title": "Ticket #1875: condor_master gets into busy-waiting state and starves jobs", "description": "<blockquote>\nWhile trying to get 7.5.5. out the door, it was noticed that the windows build machine wasn't making progress on build jobs.  It turned out that the condor_master had gotten into a state where the main daemon-core loop was spinning without ever giving up the CPU.  The \"async_pipe\" was returning true from select(), but the daemon core main loop was never trying to read from the handle, so the state was never cleared.\n\n<p>Since the condor_master runs at higher priority than the jobs, all of the jobs were starving.\n\n</p><p>The daemon core loop handles the async_pipe differently between windows and unix - it appears that in windows if two or more signals came in in a short enough period of time, any windows daemon-core based daemon could be put into this busy-waiting state.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-10 16:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/99907387e22c939c9e283cd9b5e8fb6d71f4c855\">[20374]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1875\" onclick=\"get_ticket_and_populate_wrapper('1875'); return false;\" title=\"condor_master gets into busy-waiting state and starves jobs\">#1875</a></span>) fix for bug in windows code path of previous commit for this ticket. this fix uses the selector.fd_ready state rather than the async pipe as a trigger for emptying the pipe.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-09 17:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7dd97ab30bcb24961973735e240698b7c65d8bb4\">[20365]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1875\" onclick=\"get_ticket_and_populate_wrapper('1875'); return false;\" title=\"condor_master gets into busy-waiting state and starves jobs\">#1875</a></span>) changes to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> to prevent a Win32 specific problem where the main daemon loop can get into a state where it is busy waiting. The symptom of the problem is that the async_pipe is always signalled, so select never waits, but the daemon core flag regarding the pipe is not signalled. The change\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Feb-11 12:07", "status": "resolved", "created": "2011-Jan-25 16:26", "fixed_version": "2011-Jan-25 16:26", "broken_version": "v070504", "priority": "2", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "", "due_date": "20110209"}