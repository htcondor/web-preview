{"id": 435, "title": "Ticket #435: DAGMan core dumps if node has POST script and all submit attempts fail", "description": "<blockquote>\nIf you have a node for which all of the job submit attempts fail, and that node has a POST script, DAGMan core dumps when trying to write the POST_SCRIPT_TERMINATED event to the log file.  The core dump happens when it's trying to figure out whether the log file is XML-format or not.  (I'll bet this bug was introduced by the changes to handle log rotation in the user log reading code.  I think that in in the past, we defaulted to non-XML in this case, but the log reading code itself is segfaulting.)\n\n<p>(Hmm -- see also Gnats PRs 658 and 799.)\n\n</p><p>Here's the stack trace:\n\n</p><p></p><div class=\"verbatim\">\n<pre>Program terminated with signal 11, Segmentation fault.\n[New process 29315]\n#0  0x08180264 in ReadUserLogState::IsLogType (this=0x0, t=LOG_TYPE_XML)\n    at read_user_log_state.h:134\n134     read_user_log_state.h: No such file or directory.\n        in read_user_log_state.h\n(gdb) where\n#0  0x08180264 in ReadUserLogState::IsLogType (this=0x0, t=LOG_TYPE_XML)\n    at read_user_log_state.h:134\n#1  0x0817cb0b in ReadUserLog::getIsXMLLog (this=0xbfc040ec)\n    at read_user_log.cpp:1355\n#2  0x08112957 in Dag::PostScriptReaper (this=0x95ffc78,\n    nodeName=0x9600660 \"0\", status=0) at dag.cpp:1496\n#3  0x08121874 in ScriptQ::ScriptReaper (this=0x96009d8, pid=29324,\nstatus=0)\n    at scriptQ.cpp:133\n#4  0x08139ac4 in DaemonCore::CallReaper (this=0x95db4e0, reaper_id=2,\n    whatexited=0x840821f \"pid\", pid=29324, exit_status=0)\n    at daemon_core.cpp:8286\n#5  0x0813d520 in DaemonCore::HandleProcessExit (this=0x95db4e0,\npid=29324,\n    exit_status=0) at daemon_core.cpp:8386\n#6  0x0813d69e in DaemonCore::HandleDC_SERVICEWAITPIDS (this=0x95db4e0)\n    at daemon_core.cpp:7962\n#7  0x081444d8 in DaemonCore::Driver (this=0x95db4e0) at\ndaemon_core.cpp:2590\n#8  0x0814d8a6 in main (argc=13, argv=0xbfc04a10) at\ndaemon_core_main.cpp:2097\n(gdb)\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\nIt looks like this has actually gotten fixed in 7.2.4 or so.  I'm working on adding a test for it to make sure the bug doesn't creep back in. (wenger 2009-07-06)\n\n<p>2009-07-08: okay, just fixed this in 7.2 branch, merged changes to master, pushed everything.  It turns out that it wasn't fixed before; there was a problem with the test (which is now also fixed).  The problem was caused by changes in the user log reading code to deal with log rotation.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jul-08 11:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/958361f65d4779b7bfe1b462f2826d46d4c2c71a\">[24867]</a></span>: Fixed gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=435\" onclick=\"get_ticket_and_populate_wrapper('435'); return false;\" title=\"DAGMan core dumps if node has POST script and all submit attempts fail\">#435</a></span> (DAGMan core dumps if node has POST script and all submit attempts fail) -- this was related to the changes in the log file code to handle log rotation. (I also had to change the job_dagman_submit_fails_post.run test script to delete the node job log file at the beginning, to get the\u00a0[...]\n (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-31 08:36", "status": "resolved", "created": "2009-Apr-30 11:53", "fixed_version": "2009-Apr-30 11:53", "broken_version": "v070203", "priority": "2", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, psilord@cs.wisc.edu", "due_date": ""}