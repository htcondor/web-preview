{"id": 1279, "title": "Ticket #1279: New jobmanager version command crashes gt2 gahp", "description": "<blockquote>\nGram client library function globus_gram_client_get_jobmanager_version() returns a hashtable of information about a remote gram jobmanager. The validity of the hashtable argument when an error is returned is not well-defined. For some errors, it is defined and must be freed by the client. For other errors, it's undefined and must be ignored by the client. The gt2 gahp server assumes it's always defined and attempts to access it, frequently resulting in a seg-fault.\n\n<p>When an older gram jobmanager returns an error that it doesn't understand the version command, the gram client library returns gram error 91 and a valid, though sparse, hashtable.\nWhen a jobmanager closes the connection without sending a reply, the client library returns gram error 10 and an undefined hashtable reference. Due to another bug (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1280\" onclick=\"get_ticket_and_populate_wrapper('1280'); return false;\" title=\"Gram jobmanager version command doesn't work in most cases\">#1280</a></span>), the latter case is most common.\n\n</p><p>The gram client documentation says that the hashtable reference is always undefined when an error is returned, but ignoring the hashtable in the error 91 case results in a memory leak. A viable workaround appears to be possible. Set the hashtable reference to NULL before the call to globus_gram_client_get_jobmanager_version(). If it's still NULL after the call, then leave it alone. Otherwise, it's a valid hashtable that can be consulted and must be freed.\n\n</p><p>This ambiguity in the gram client interface has been reported to Globus: <a class=\"external\" href=\"http://jira.globus.org/browse/GRAM-142\">http://jira.globus.org/browse/GRAM-142</a></p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-17 10:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/df698e9481b6da7188b3eb7f265859f147d59054\">[17647]</a></span>: Fix crash in gt2 gahp caused by jobmanager version command. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1279\" onclick=\"get_ticket_and_populate_wrapper('1279'); return false;\" title=\"New jobmanager version command crashes gt2 gahp\">#1279</a></span> The new gram client call globus_gram_client_get_jobmanager_version() returns a valid hashtable on some errors, but not others. The gahp assumed it always returns a valid hashtable. If the hashtable is valid, then the gahp must free it\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Mar-17 10:37", "status": "resolved", "created": "2010-Mar-16 17:17", "fixed_version": "2010-Mar-16 17:17", "broken_version": "v070501", "priority": "2", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}