{"id": 6047, "title": "Ticket #6047: Systemd stop command must block until condor_master exits", "description": "<blockquote>\nWhen HTCondor is running under systemd, the command used to stop HTCondor needs to block until the service is completely shut down (i.e. the condor_master has exited). Immediately after the stop command exits, systemd kills any lingering processes and logs an error for the service in its logs. The service's state is marked as 'failed'.\n\n<p>The stop command is set in the systemd configuration file with the <code>ExecStop</code> parameter. We currently set <code>condor_off -master</code>, which returns immediately after signalling the condor_master. We also set <code>TimeoutStopSec</code> to 20 seconds, but it appears that affects how long systemd will wait for the stop command to finish.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Dec-09 08:03:04 by tim:</em> <br/>\n\nActually, the stop time is the 90 second system default in the 8.5.x series.\n\n<p></p><hr/>\n<em>2019-Jun-07 10:23:56 by tim:</em> <br/>\n\nFixed by <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6096\" onclick=\"get_ticket_and_populate_wrapper('6096'); return false;\" title=\"Fix systemctl config to perform a fast shutdown when stopping\">#6096</a></span> in version 8.6.7</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2019-Jun-07 10:24", "status": "abandoned", "created": "2016-Dec-08 16:45", "fixed_version": "2016-Dec-08 16:45", "broken_version": "v070900", "priority": "3", "subsystem": "Packaging", "assigned_to": "tim", "derived_from": "#2286", "creator": "jfrey", "rust": "a31152", "customer_group": "support", "visibility": "public", "notify": "michael.v.pelletier@raytheon.com", "due_date": ""}