{"id": 768, "title": "Ticket #768: JobRouter does not see buffered job ad updates", "description": "<blockquote>\nWhen the schedd makes changes to job ads using the NONDURABLE flag, it sometimes happens that data remains in memory buffers and is not written to disk indefinitely or until some further commit causes the buffer to be flushed.  <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> and Quill cannot see the changes until they are flushed.  A specific example where this caused trouble was <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobFinishedHookDone\" title=\"Job Finished Hook Done\">JobFinishedHookDone</a></span> not being visible to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> a long time after a routed job had actually finished.  This caused\n<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> not to mark the source job finished until the schedd flushed its buffers due to other activity.\n\n<p>Flushing after each transaction could negatively impact performance.  Therefore, for 7.4.0, I have added a timer to the schedd that flushes after some configurable maximum time when a NONDURABLE commit happens.  The configuration parameter name is SCHEDD_JOB_QUEUE_LOG_FLUSH_DELAY, which defaults to 5 seconds.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-06 14:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e91e53ae583722b7a54c55824276f0cfa86d7749\">[25017]</a></span>: Documented SCHEDD_JOB_QUEUE_LOG_FLUSH_DELAY. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=768\" onclick=\"get_ticket_and_populate_wrapper('768'); return false;\" title=\"JobRouter does not see buffered job ad updates\">#768</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Sep-23 13:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c32eabba40bdceac5967884f7a1370c70125dd68\">[15739]</a></span>: Added timed flushing of nondurable commits to schedd's job queue log. Without this, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> and Quill do not see some updates to job ads for an unbound amount of time. The upper bound is now controlled with SCHEDD_JOB_QUEUE_LOG_FLUSH_DELAY (default 5s). <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=768\" onclick=\"get_ticket_and_populate_wrapper('768'); return false;\" title=\"JobRouter does not see buffered job ad updates\">#768</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Jan-31 08:04", "status": "resolved", "created": "2009-Sep-23 13:27", "fixed_version": "2009-Sep-23 13:27", "broken_version": "v070200", "priority": "4", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}