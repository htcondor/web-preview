{"id": 7805, "title": "Ticket #7805: starter should set HOME correctly when running docker CLI", "description": "<blockquote>\nWhen the starter runs the docker cli, it generally runs it as the unprivileged \"condor\" user.  It does the by setting the real uid and effective uid to condor, then spawning the appropriate docker program, and inheriting all environment variables from the starter, which come indirectly from whatever started the condor_master.  One of these environment variables is $HOME.  docker looks in $HOME to find some configuration files.  If HOME is set to /root (common if an interactive shell user started condor), docker will complain with a warning that it can't read the file /root/.docker/config, which it can't, as it is running as the non-root condor user.\n\n<p>This warning comes back in the docker_stderr file, which confuses users.\n\n</p><p>We want some of the environment to percolate down to the docker cli, for example, the DOCKER_HOST variable tells the docker cli where the server is.\n\n</p><p>So, in this ticket, when we run docker commands, we will set the HOME directory correctly in the docker cli (note -- NONE OF THIS APPLIES TO THE JOB IN THE CONTAINER!) to remove this error.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-28 14:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c588577ba2e2d45a1575834757dda02b3a4c86ec\">[61348]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7805\" onclick=\"get_ticket_and_populate_wrapper('7805'); return false;\" title=\"starter should set HOME correctly when running docker CLI\">#7805</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-19 10:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/831445b4d241c18a37774b4dc34560aa8c075d9f\">[60484]</a></span>: Make sure we compile on Window <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7805\" onclick=\"get_ticket_and_populate_wrapper('7805'); return false;\" title=\"starter should set HOME correctly when running docker CLI\">#7805</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-18 14:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9f961101681c15bb992f0f369f863c83c47ce41c\">[60478]</a></span>: Set HOME correctly when running docker cli <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7805\" onclick=\"get_ticket_and_populate_wrapper('7805'); return false;\" title=\"starter should set HOME correctly when running docker CLI\">#7805</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Sep-28 14:53", "status": "resolved", "created": "2020-Aug-18 14:31", "fixed_version": "2020-Aug-18 14:31", "broken_version": "v080900", "priority": "3", "subsystem": "", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}