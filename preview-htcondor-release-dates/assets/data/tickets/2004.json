{"id": 2004, "title": "Ticket #2004: condor_submit -remote for unknown user", "description": "<blockquote>\nWhen using CLAIMTOBE and using remote submission to a schedd for a user which is not known to that schedd host, the jobs will get stuck in a limbo state where the shadow continually errors out.\n\n<p></p><div class=\"code\">\n<pre class=\"code\">03/28/11 09:27:09 (180.0) (31122): WriteUserLog::initialize: init_user_ids() failed!\n03/28/11 09:27:09 (180.0) (31122): ERROR \"Failed to initialize user log to /home/tstclair/work/personal-condor/spool/180/0/cluster180.proc0.subproc0/mrg_180.0.log\" at line 777 in file /home/tstclair/work/spaces/ref/git/src/condor_shadow.V6.1/baseshadow.cpp\n03/28/11 09:27:09 (180.0) (31122): WriteUserLog: not initialized @ writeEvent()\n</pre></div>\n\n\n<p>The expected behavior would be to run as user nobody in this case.\n\n</p><p>Repro condition:\n</p><ol>\n<li>Login to a windows box as a user not known on a linux submit node\n</li><li>condor_submit -remote schedhost.name your.submit\n</li><li>scan <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ShadowLog\" title=\"Shadow Log\">ShadowLog</a></span> &amp;&amp; <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SchedLog\" title=\"Sched Log\">SchedLog</a></span></li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Apr-07 13:17:10 by tstclair:</em> <br/>\n\nWhen attempting to create file(s) as user nobody you get a permission denied error\n\n<p></p><hr/>\n<em>2011-Apr-11 16:36:24 by danb:</em> <br/>\n\nCode review:\n\n<p>\"used\" --&gt; \"user\" in the following:\n\n</p><p></p><pre>    dprintf(D_ALWAYS, \"trying init_user_ids() as used nobody\\n\" );\n</pre>\n\n<p>Not sure what the following comment is trying to say:\n\n</p><p></p><pre>    // there is\n</pre>\n\n<p>The following makes me a little nervous:\n\n</p><p></p><pre>    jobAd-&gt;Assign( ATTR_OWNER, \"UNDEFINED\" );\n</pre>\n\n<p>For example, I see the following in the starter code:\n\n</p><p></p><pre>    if( run_as_owner ) {\n        if( job_ad-&gt;LookupString( ATTR_OWNER, owner ) != 1 ) {\n            dprintf( D_ALWAYS, \"ERROR: %s not found in JobAd.  Aborting.\\n\",\n                     ATTR_OWNER );\n            return false;\n        }\n    }\n</pre>\n\n<p>Therefore, you should probably force ATTR_JOB_RUNAS_OWNER to false in the job ad.\n\n</p><p></p><hr/>\n<em>2011-Apr-11 16:45:09 by tstclair:</em> <br/>\n\nYup, put it up in haste.. modified and will verify functionality\n\n<p></p><hr/>\n<em>2011-Apr-11 16:53:15 by danb:</em> <br/>\n\nOh, and please add SHADOW_RUN_UNKNOWN_USER_JOBS to the param table if it is not already there.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2371\" onclick=\"get_ticket_and_populate_wrapper('2371'); return false;\" title=\"document new config knob SHADOW_RUN_UNKNOWN_USER_JOBS\">#2371</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\ndocument new config knob SHADOW_RUN_UNKNOWN_USER_JOBS</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/319/nobody_shadow.patch\">nobody_shadow.patch</a>\n2535 bytes added by tstclair on 2011-Apr-11 20:58:28 UTC.\n<br/>\nPatch to enable submission of unknown user and switch privs to nobody allowing the shadow to run to completion.  \n\n<p>Tested with remote submission from a windows machine to a linux submit node. <br/>\n</p></li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-20 11:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d955357e7e22b8c74deb130cb6b825c7fc040c9e\">[27920]</a></span>: remove version history item from 7.7.0, as it was supposed to go in 7.6.1, but ended up in 7.6.4 ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2004\" onclick=\"get_ticket_and_populate_wrapper('2004'); return false;\" title=\"condor_submit -remote for unknown user\">#2004</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2371\" onclick=\"get_ticket_and_populate_wrapper('2371'); return false;\" title=\"document new config knob SHADOW_RUN_UNKNOWN_USER_JOBS\">#2371</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-20 11:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ab759063e896c77a351a8b5b966c469d5d13859d\">[27917]</a></span>: Document config knob (which was new in 7.6.1) SHADOW_RUN_UNKNOWN_USER_JOBS ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2004\" onclick=\"get_ticket_and_populate_wrapper('2004'); return false;\" title=\"condor_submit -remote for unknown user\">#2004</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2371\" onclick=\"get_ticket_and_populate_wrapper('2371'); return false;\" title=\"document new config knob SHADOW_RUN_UNKNOWN_USER_JOBS\">#2371</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-12 09:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/85bad3f13c3e859338c7f6c5cae629a74ed8cd00\">[21335]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2004\" onclick=\"get_ticket_and_populate_wrapper('2004'); return false;\" title=\"condor_submit -remote for unknown user\">#2004</a></span>: Update param table w/SHADOW_RUN_UNKNOWN_USER_JOBS  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-11 16:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/14f8eed95f2a4e9686ea7c7f50e2d2de90934c69\">[21331]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2004\" onclick=\"get_ticket_and_populate_wrapper('2004'); return false;\" title=\"condor_submit -remote for unknown user\">#2004</a></span>: Allow priv switching on shadow to nobody when SHADOW_RUN_UNKNOWN_USER_JOBS=TRUE. By default it is off.  (By Timothy St. Clair )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Apr-11 16:55", "status": "resolved", "created": "2011-Mar-29 12:35", "fixed_version": "2011-Mar-29 12:35", "broken_version": "v070506", "priority": "2", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "#1985", "creator": "tstclair", "rust": "", "customer_group": "users", "visibility": "public", "notify": "matt@cs.wisc.edu, tstclair@redhat.com, jfrey@cs.wisc.edu, gthain@cs.wisc.edu", "due_date": ""}