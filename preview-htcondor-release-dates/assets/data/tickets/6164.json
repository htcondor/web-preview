{"id": 6164, "title": "Ticket #6164: Fix negotiator prefetch bugs from code review", "description": "<blockquote>\nThe following items from the code review of negotiator prefetching of Resource Request Lists (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5174\" onclick=\"get_ticket_and_populate_wrapper('5174'); return false;\" title=\"Add resource request prefetch phase to the negotiator\">#5174</a></span>) were never addressed in the code.\n\n<p></p><ul>\n<li>In prefetchResourceRequestLists(), selector.timed_out() and selector.failed() are mutually exclusive, but they are logically anded to trigger a code block. That code block has problems, though. It gives up trying to read responses from schedds. To do so, it needs to close the sockets, like the timeout code at the end of the function.\n</li><li>At the end of prefetchResourceRequestLists(), for any schedds where it tried to prefetch but timed out before finishing prefetch, it closes the socket and then tries to send an END_NEGOTIATE (which turns into a noop because of the closed socket).</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2017-Apr-21 16:19:45 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Patch looks good, thanks.\n\n</p><p>No documentation or version history required, as this fixes bugs in a undocumented functionality that is currently off by default.  Once we are finished with the prefetch mechanism, we will document it at that time.\n\n</p><p>Resolving.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-06 15:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/92545177521459573310621129a2eaeb545c1c6c\">[50279]</a></span>: Fix network timeout/error handling in negotiator prefetch code. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6164\" onclick=\"get_ticket_and_populate_wrapper('6164'); return false;\" title=\"Fix negotiator prefetch bugs from code review\">#6164</a></span> Handling for timeout or error from select() is no longer dead code. Send an END_NEGOTIATE and then close the socket to problematic schedds.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Apr-21 16:20", "status": "resolved", "created": "2017-Mar-02 15:25", "fixed_version": "2017-Mar-02 15:25", "broken_version": "v080501", "priority": "3", "subsystem": "DaemonsCM", "assigned_to": "jfrey", "derived_from": "#5174", "creator": "jfrey", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}