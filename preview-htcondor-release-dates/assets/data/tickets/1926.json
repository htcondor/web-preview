{"id": 1926, "title": "Ticket #1926: RFE: option for condor_userprio to report acctgrp stats hierarchically", "description": "<blockquote>\nWith the new hierarchical accounting group support (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1393\" onclick=\"get_ticket_and_populate_wrapper('1393'); return false;\" title=\"Implement tiered groups and hierarchical fairshare\">#1393</a></span>), users may find it useful to have condor_userprio report stats such that stats for a group include stats for its children (subtree).  For example, if the usage for groups \"a\",\"a.b\",\"a.c\" are 1, 2, 3 respectively, the usage reported for \"a\" would be 6. (Currently, condor_userprio reports statistics for accounting groups independently of any children).   Proposal is to provide condor_userprio with an option to report stats rolled up by accounting group hierarchy.</blockquote>", "remarks": "<blockquote>\n<em>2011-Sep-22 13:22:00 by eje:</em> <br/>\n\nThe attached patch implements an option to roll up accounting group attributes by hierarchy.  The following attributes are rolled up by sum:\n<div class=\"verbatim\">\n<pre>ResourcesUsed&lt;N&gt;\nWeightedResourcesUsed&lt;N&gt;\nAccumulatedUsage&lt;N&gt;\nWeightedAccumulatedUsage&lt;N&gt;\n</pre></div>\n\n\n<p>BeginUsageTime&lt;N&gt; is rolled up by min().\n\n</p><p>LastUsageTime&lt;N&gt; is rolled up by max().\n\n</p><p>Priority&lt;N&gt; and PriorityFactor&lt;N&gt; are set to 0.0 when rollup is in effect.  This is because they no longer correspond to rolled up usage values, and there isn't a very meaningful way to roll priority or factor.\n\n</p><p></p><hr/>\n<em>2011-Sep-22 13:42:53 by eje:</em> <br/>\n\nREPRO/TEST\n\n<p>This is a new feature, and so there is no repro condition.\n\n</p><p>Consider the following accounting group configuration, with a simple hierarchy:\n</p><div class=\"code\">\n<pre class=\"code\">NEGOTIATOR_DEBUG = D_FULLDEBUG\nNEGOTIATOR_INTERVAL = 30\nSCHEDD_INTERVAL\t= 15\nNEGOTIATOR_USE_SLOT_WEIGHTS = FALSE\nGROUP_QUOTA_MAX_ALLOCATION_ROUNDS = 1\n\nNUM_CPUS = 10\n\nGROUP_NAMES = a, a.b, a.c\nGROUP_QUOTA_a = 10\nGROUP_QUOTA_a.b = 5\nGROUP_QUOTA_a.c = 5\nGROUP_ACCEPT_SURPLUS = TRUE\n</pre></div>\n\n\n<p>Submit the following to populate the acct groups with some jobs:\n</p><div class=\"code\">\n<pre class=\"code\">universe = vanilla\ncmd = /bin/sleep\nargs = 6000\nshould_transfer_files = if_needed\nwhen_to_transfer_output = on_exit\n+AccountingGroup=\"a.c.u3\"\nqueue 1\n+AccountingGroup=\"a.b.u1\"\nqueue 1\n+AccountingGroup=\"a.b.u2\"\nqueue 1\n</pre></div>\n\n\n<p>Wait for the jobs to spin up, and test output of condor_userprio.  The updated usage statement shows two new options \"-grouporder\" and \"-grouprollup\"\n</p><div class=\"code\">\n<pre class=\"code\">$ condor_userprio -h\nusage: condor_userprio [ -pool hostname ] [ -all | -usage | { -setprio | -setfactor | -setaccum | -setbegin | -setlast }  user value | -resetusage user | -resetall | -getreslist user | -delete user ] [-allusers | -activefrom month day year] [-l] [-grouprollup] [-grouporder]\n</pre></div>\n\n\n<p>Legacy default behavior is preserved (sorting by prio, no rollup, etc):\n</p><div class=\"code\">\n<pre class=\"code\">$ condor_userprio -all -allusers\nLast Priority Update:  9/22 11:36\n                                    Effective   Real     Priority   Res   Total Usage       Usage            Last\nUser Name                           Priority  Priority    Factor    Used (wghted-hrs)    Start Time       Usage Time\n------------------------------      --------- -------- ------------ ----  ----------- ---------------- ----------------\n&lt;none&gt;                                   0.50     0.50         1.00    0         0.00 12/31/1969 17:00        ???\na                                        0.50     0.50         1.00    0         0.00 12/31/1969 17:00        ???\na.c                                      0.50     0.50         1.00    1         0.02  9/22/2011 11:35  9/22/2011 11:36\na.c.u3@localdomain                       0.50     0.50         1.00    1         0.02  9/22/2011 11:35  9/22/2011 11:36\na.b.u2@localdomain                       0.50     0.50         1.00    1         0.02  9/22/2011 11:35  9/22/2011 11:36\na.b.u1@localdomain                       0.50     0.50         1.00    1         0.02  9/22/2011 11:35  9/22/2011 11:36\na.b                                      0.50     0.50         1.00    2         0.03  9/22/2011 11:35  9/22/2011 11:36\n------------------------------      --------- -------- ------------ ----  ----------- ---------------- ----------------\nNumber of users: 3                                                     3         0.05  9/22/2011 11:35        ???\n</pre></div>\n\n\n<p>Using the new \"-grouporder\" will place acct groups at top of output, in breadthfirst order (no rollup).  Individual submitters are still sorted by priority as usual:\n</p><div class=\"code\">\n<pre class=\"code\">$ condor_userprio -all -allusers -grouporder\nLast Priority Update:  9/22 11:37\n                                    Effective   Real     Priority   Res   Total Usage       Usage            Last\nUser Name                           Priority  Priority    Factor    Used (wghted-hrs)    Start Time       Usage Time\n------------------------------      --------- -------- ------------ ----  ----------- ---------------- ----------------\n&lt;none&gt;                                   0.50     0.50         1.00    0         0.00 12/31/1969 17:00        ???\na                                        0.50     0.50         1.00    0         0.00 12/31/1969 17:00        ???\na.b                                      0.50     0.50         1.00    2         0.09  9/22/2011 11:35  9/22/2011 11:37\na.c                                      0.50     0.50         1.00    1         0.04  9/22/2011 11:35  9/22/2011 11:37\na.c.u3@localdomain                       0.50     0.50         1.00    1         0.04  9/22/2011 11:35  9/22/2011 11:37\na.b.u2@localdomain                       0.50     0.50         1.00    1         0.04  9/22/2011 11:35  9/22/2011 11:37\na.b.u1@localdomain                       0.50     0.50         1.00    1         0.04  9/22/2011 11:35  9/22/2011 11:37\n------------------------------      --------- -------- ------------ ----  ----------- ---------------- ----------------\nNumber of users: 3                                                     3         0.13  9/22/2011 11:35        ???\n</pre></div>\n\n\n<p>With the \"-grouprollup\" option, acct group stats are rolled up the hierarchy (note that priority values are zeroed out for groups as rolled up priorities are meaningless).  Non-group submitters are ordered as usual.\n</p><div class=\"code\">\n<pre class=\"code\">$ condor_userprio -all -allusers -grouporder -grouprollup\nLast Priority Update:  9/22 11:41\n                                    Effective   Real     Priority   Res   Total Usage       Usage            Last\nUser Name                           Priority  Priority    Factor    Used (wghted-hrs)    Start Time       Usage Time\n------------------------------      --------- -------- ------------ ----  ----------- ---------------- ----------------\n&lt;none&gt;                                   0.00     0.00         0.00    3         0.30 12/31/1969 17:00  9/22/2011 11:41\na                                        0.00     0.00         0.00    3         0.30 12/31/1969 17:00  9/22/2011 11:41\na.b                                      0.00     0.00         0.00    2         0.20  9/22/2011 11:35  9/22/2011 11:41\na.c                                      0.00     0.00         0.00    1         0.10  9/22/2011 11:35  9/22/2011 11:41\na.c.u3@localdomain                       0.50     0.50         1.00    1         0.10  9/22/2011 11:35  9/22/2011 11:41\na.b.u2@localdomain                       0.50     0.50         1.00    1         0.10  9/22/2011 11:35  9/22/2011 11:41\na.b.u1@localdomain                       0.50     0.50         1.00    1         0.10  9/22/2011 11:35  9/22/2011 11:41\n------------------------------      --------- -------- ------------ ----  ----------- ---------------- ----------------\nNumber of users: 3                                                     3         0.30  9/22/2011 11:35        ???\n</pre></div>\n\n\n<p></p><hr/>\n<em>2011-Dec-16 15:22:08 by danb:</em> <br/>\n\nCode review:\n\n<p>This patch looks good to me.  It's already in and documented, so I am marking this ticket resolved.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/465/gt1926-userprio-rollup.patch\">gt1926-userprio-rollup.patch</a>\n20893 bytes added by eje on 2011-Sep-22 18:07:28 UTC.\n<br/>\nPatch implements a rollup option for reporting accounting groups from condor_userprio<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-13 09:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/23bb3f5e38c1733bf73f635878fbd313bbaa9a4c\">[27793]</a></span>: edit condor_userprio man page such that it does not use the invented and undefined term \"rollup\" to describe what it does. It simply works on a subtree, given the root of the subtree. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1926\" onclick=\"get_ticket_and_populate_wrapper('1926'); return false;\" title=\"RFE: option for condor_userprio to report acctgrp stats hierarchically\">#1926</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-26 20:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/269e3f8081eb7c2934445911b03421595a9f0dc0\">[27420]</a></span>: Fix bug where <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1926\" onclick=\"get_ticket_and_populate_wrapper('1926'); return false;\" title=\"RFE: option for condor_userprio to report acctgrp stats hierarchically\">#1926</a></span> wouldn't compile on Windows  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-26 13:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0a5aae4f844712bf3c88b14e3e56c8f579a88738\">[27409]</a></span>: ===VersionHistory:Completed=== ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1926\" onclick=\"get_ticket_and_populate_wrapper('1926'); return false;\" title=\"RFE: option for condor_userprio to report acctgrp stats hierarchically\">#1926</a></span>  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-26 13:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3519e4ffffa374af51d346c32968cfcf85393aea\">[27408]</a></span>: Documentation for new -grouporder and -grouprollup flags in condor_userprio ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1926\" onclick=\"get_ticket_and_populate_wrapper('1926'); return false;\" title=\"RFE: option for condor_userprio to report acctgrp stats hierarchically\">#1926</a></span>  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-26 13:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f1e8f9671fb9a78419f922de30bc56bac60e954d\">[27405]</a></span>: Added option for rolling accounting group attributes up the hierarchy. ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1926\" onclick=\"get_ticket_and_populate_wrapper('1926'); return false;\" title=\"RFE: option for condor_userprio to report acctgrp stats hierarchically\">#1926</a></span>  (By Erik Erlandson )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Dec-16 15:22", "status": "resolved", "created": "2011-Feb-22 12:52", "fixed_version": "2011-Feb-22 12:52", "broken_version": "v070506", "priority": "4", "subsystem": "Tools", "assigned_to": "eje", "derived_from": "#1393", "creator": "eje", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu, jthomas@redhat.com, eje@redhat.com, claudiol@redhat.com, dan@hep.wisc.edu", "due_date": ""}