{"id": 4942, "title": "Ticket #4942: Improve RANK preeemption for partitionable slots", "description": "<blockquote>\nWe want to make several improvements to the code for preempting partitionable/dynamic slots (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3667\" onclick=\"get_ticket_and_populate_wrapper('3667'); return false;\" title=\"Allow partitionable slots to be subject to RANK preeemption\">#3667</a></span>, <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=4580\" onclick=\"get_ticket_and_populate_wrapper('4580'); return false;\" title=\"Fix pslot startd RANK preemption\">#4580</a></span>).\n\n<p>Here are the things that have been done in Condor 8.3.6:\n\n</p><p></p><ul>\n<li>Negotiator will not directly preempt individual dslots if ALLOW_PSLOT_PREEMPTION is true.\n</li><li>For pslot preemption, the negotiator will ignore dslots that have retirement time remaining or are in preempting state.\n</li><li>Fixed bug that selected the claim ids of the wrong dslots when preempting a pslot.\n</li><li>When a preempting pslot claim is requested, the startd immediately returns resources of the preempted dslots to the pslot, then creates a new dslot with the requested resources.\n</li></ul>\n\n<p>Design doc <a class=\"external\" href=\"https://docs.google.com/document/d/17T65rh088vDa1Lb6WFtuk68LsvYZtLRNIu2lwlAkLG4/edit?usp=sharing\">is on google drive</a>.\n\n</p><p>The following is future work after 8.3.6:\n\n</p><p></p><ul>\n<li>Negotiator should not do pslot preemption calculations if NEGOTIATOR_CONSIDER_PREEMPTION is false.\n</li><li>When consumption policies are enabled, don't consider dslots for multiple preemptions.\n</li><li>Negotiator should sort eligible pslots that require preemption by applying rank expressions to all dynamic slots to be preempting and using minimum value.\n</li><li>Allow NEGOTIATOR_CONSIDER_EARLY_PREEMPTION to be an expression applied per slot ad.\n</li><li>Startd should wait for preempted dynamic slots to return resources to partitionable slot before creating dynamic slot for preempting claim. This would allow preemption of dslots that have retirement time remaining, like is possible with static slots.\n</li><li>Startd should verify that preempting claim is eligible to preempt existing claims.\n</li><li>Startd should update preemption stats properly.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2015-Jun-05 13:45:26 by tim:</em> <br/>\n\nThis ticket represents partial work. Final documentation coming in a follow-on ticket.\n\n<p></p><hr/>\n<em>2015-Jun-10 14:24:44 by tannenba:</em> <br/>\n\nThis ticket pretty much overtakes the issues in <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=4580\" onclick=\"get_ticket_and_populate_wrapper('4580'); return false;\" title=\"Fix pslot startd RANK preemption\">#4580</a></span></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nMore improvements for preemption of partitionable slots</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/93b6f58b2a7af3f9469a0219409d32f10c6e82ff\">[45076]</a></span>: Fix compiler warnings in pslot preemption code. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4942\" onclick=\"get_ticket_and_populate_wrapper('4942'); return false;\" title=\"Improve RANK preeemption for partitionable slots\">#4942</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/98a69053cafdb6c229d421fb37742ef8f98c824d\">[45075]</a></span>: Improve pslot preemption in the startd. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4942\" onclick=\"get_ticket_and_populate_wrapper('4942'); return false;\" title=\"Improve RANK preeemption for partitionable slots\">#4942</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span> * Constrain <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RetirementTimeRemaining\" title=\"Retirement Time Remaining\">RetirementTimeRemaining</a></span> to be non-negative. * Roll-up <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RetirementTimeRemaining\" title=\"Retirement Time Remaining\">RetirementTimeRemaining</a></span> of dslots into pslot. * Refuse to preempt dslots that have retirement time remaining. * Return <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CpuAttributes\" title=\"Cpu Attributes\">CpuAttributes</a></span> resources of preempted dslots to the pslot immediately,\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/33cef9468d2c80e4e66e89fc551cc8abe5c744e2\">[45074]</a></span>: Improve pslot preemption in the negotiator. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4942\" onclick=\"get_ticket_and_populate_wrapper('4942'); return false;\" title=\"Improve RANK preeemption for partitionable slots\">#4942</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span> * Disable direct preemption of dslots when ALLOW_PSLOT_PREEMPTION is True. * Simplify code to lookup values in rolled-up lists of dslot attributes in the pslot ad. * Ignore dslots that aren't eligible for preemption (due to retirement time or being\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-12 16:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6b69961aba3ce22af54bdd6335bcd8db70fba160\">[44841]</a></span>: Fix compiler warnings in pslot preemption code. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4942\" onclick=\"get_ticket_and_populate_wrapper('4942'); return false;\" title=\"Improve RANK preeemption for partitionable slots\">#4942</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-12 15:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3be502608d10573502c028c84d1d2110473b8ab1\">[44836]</a></span>: Improve pslot preemption in the startd. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4942\" onclick=\"get_ticket_and_populate_wrapper('4942'); return false;\" title=\"Improve RANK preeemption for partitionable slots\">#4942</a></span> * Constrain <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RetirementTimeRemaining\" title=\"Retirement Time Remaining\">RetirementTimeRemaining</a></span> to be non-negative. * Roll-up <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RetirementTimeRemaining\" title=\"Retirement Time Remaining\">RetirementTimeRemaining</a></span> of dslots into pslot. * Refuse to preempt dslots that have retirement time remaining. * Return <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CpuAttributes\" title=\"Cpu Attributes\">CpuAttributes</a></span> resources of preempted dslots to the pslot immediately,\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-12 15:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bdb1bf881edb384b640736566c78dfafbf5ad07f\">[44835]</a></span>: Improve pslot preemption in the negotiator. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4942\" onclick=\"get_ticket_and_populate_wrapper('4942'); return false;\" title=\"Improve RANK preeemption for partitionable slots\">#4942</a></span> * Disable direct preemption of dslots when ALLOW_PSLOT_PREEMPTION is True. * Simplify code to lookup values in rolled-up lists of dslot attributes in the pslot ad. * Ignore dslots that aren't eligible for preemption (due to retirement time or being in\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Jun-10 15:43", "status": "resolved", "created": "2015-Mar-17 16:43", "fixed_version": "2015-Mar-17 16:43", "broken_version": "v080100", "priority": "3", "subsystem": "DaemonsExecNode", "assigned_to": "jfrey", "derived_from": "#3667", "creator": "jfrey", "rust": "", "customer_group": "atlas", "visibility": "public", "notify": "", "due_date": ""}