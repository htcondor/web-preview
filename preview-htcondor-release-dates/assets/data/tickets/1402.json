{"id": 1402, "title": "Ticket #1402: VM universe: issues with bridged networking", "description": "<blockquote>\nThere are several issue with bridged networking in VM universe job:<br/>\n\n- when no XML helper is used, the generated configuration for KVM machines uses\nvirbr0 but this interface, according to libvirt documentation\n(<a class=\"external\" href=\"http://wiki.libvirt.org/page/Networking\">http://wiki.libvirt.org/page/Networking</a>) can not be used for bridged\nnetworking;<br/>\n\n- when no XML helper is used, the generated configuration for Xen machines does\nnot contain any reference to the bridged interface (&lt;source bridge=\"\"&gt;).<br/>\n\n- when the default XML helper is used, the configuration use 'br0', which does\nnot exist by default<br/>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-May-12 15:45:22 by rrati:</em> <br/>\n\nThe usefulness of VM_BRIDGE_SCRIPT is questionable, at best, at this point.\nAccording to the config file comments, and the usage in condor, the script is\nintended to be passed to libvirt as the 'source script' for bridged networking.\n However, the source script is not used by libvirt for bridged networking and\nin the cases where 'source script' would be used (generic networking), it will\nnot be able to be used by libvirt when VMs are run in unprivileged mode.\n\n<p>Additionally, VM_BRIDGE_SCRIPT provides a means to create a network interface,\nbut not to tear it down.  This seems of limited utility in a controlled\nenvironment.  The libvirt docs talk about setting up the bridge interface on\nthe host OS, and it seems a much more useful use case for the box admin to\nsetup the bridged networking interfaces for a machine that will run VMs with\nbridged networking.\n\n</p><p>It is likely that VM_BRIDGE_SCRIPT is a hold over from before the libvirt\nconversion, when condor used the xen API directly.  Additionally, dynamic\ninterface creation and destruction could be handled, much cleaner, via the\nstartd hooks.\n\n</p><p>Perhaps the job submit files should be allowed to specify which bridge\ninterface to use, with the administrator able to define a default in condor's\nconfiguration, for a case where multiple bridge interfaces could exist on a\nstartd.  The creation of all the interfaces would be the responsibility of the\nadmin (via hooks or explicit OS configuration).\n\n</p><p>Given all the above, it seems removing/deprecating the VM_BRIDGE_SCRIPT is the\nroute to take, along with providing documentation on how to configure a bridge\nnetworking on the host.\n\n</p><p></p><hr/>\n<em>2010-May-13 14:38:38 by jfrey:</em> <br/>\n\nThe patch looks alright to me.\n\n<p></p><hr/>\n<em>2010-May-14 11:41:51 by rrati:</em> <br/>\n\nChanges to documentation in ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1407\" onclick=\"get_ticket_and_populate_wrapper('1407'); return false;\" title=\"VM Universe Bridge Params update\">#1407</a></span></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/173/vm_universe_bridge_networking.patch\">vm_universe_bridge_networking.patch</a>\n10612 bytes added by rrati on 2010-May-12 20:54:13 UTC.\n<br/>\nThis patch adds a new param VM_NETWORKING_BRIDGE_INTERFACE that must be set if bridged networking is to be used with libvirt.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-May-14 11:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7388eee7fe26219783ea60683367cb74fc967007\">[17996]</a></span>: Added configuration for a console for all VMs started in libvirt (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1402\" onclick=\"get_ticket_and_populate_wrapper('1402'); return false;\" title=\"VM universe: issues with bridged networking\">#1402</a></span>)  (By Robert Rati )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-May-14 11:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/eb3e93041a084a8f73dd39c469dee550f9c7a4eb\">[17995]</a></span>: Fixes numerous issues with VM Universe and bridge networking (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1402\" onclick=\"get_ticket_and_populate_wrapper('1402'); return false;\" title=\"VM universe: issues with bridged networking\">#1402</a></span>): 1) Removed VM_BRIDGE_SCRIPT param, as it was useless 2) Added VM_NETWORKING_BRIDGE_INTERFACE param, which MUST be set if bridged networking is to be enabled. If it is not set and bridge networking is desired (ie in VM_NETWORKING_TYPE)\u00a0[...]\n (By Robert Rati )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-May-14 11:43", "status": "resolved", "created": "2010-May-12 15:42", "fixed_version": "2010-May-12 15:42", "broken_version": "v070400", "priority": "2", "subsystem": "VM", "assigned_to": "rrati", "derived_from": "", "creator": "rrati", "rust": "", "customer_group": "other", "visibility": "public", "notify": "jfrey@cs.wisc.edu, tstclair@redhat.com", "due_date": ""}