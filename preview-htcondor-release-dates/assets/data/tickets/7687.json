{"id": 7687, "title": "Ticket #7687: Use stable GPU identifiers", "description": "<blockquote>\n(As discussed originally in Slack)\n\n<p>Whenever a GPU device dies - or, really, the CUDA library decides relative GPU speeds have changed - the CUDA library will reorder the CUDA devices (so <code>CUDA_VISIBLE_DEVICES=1</code> actually indicates a different physical device than it did before).  HTCondor will not notice this change; this behavior is especially problematic when a GPU disappears as HTCondor will continue to try and schedule a GPU job on a non-existent device (e.g., if a GPU dies on an 8-GPU host then, according to CUDA, device <code>7</code> no longer exists; further attempts to use it will blackhole GPU jobs).\n\n</p><p>Since we already enumerate the UUID of existing devices, we can set <code>CUDA_VISIBLE_DEVICES=GPU-8932f937-d72c-4106-c12f-20bd9faed9f6</code> where <code>GPU-8932f937-d72c-4106-c12f-20bd9faed9f6</code> refers to the detected UUID of the device.  This provides a stable sorting for GPUs in the system.\n\n</p><p>When combined with the ability to mark GPUs as offline, this would allow us to work around problematic nodes (such as those in CHTC currently).  HTCondor would no longer try to start on these GPUs and we can blacklist them in the nvidia driver which fixes corresponding Docker problems.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Dec-23 14:31:25 by tlmiller:</em> <br/>\n\nDuplicated by the (already-implemented) <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7696\" onclick=\"get_ticket_and_populate_wrapper('7696'); return false;\" title=\"GPU discovery should report stable GPU ids\">#7696</a></span>.\n\n<p></p><hr/>\n<em>2020-Dec-23 14:50:50 by johnkn:</em> <br/>\n\nCHTC is now using the -short-uuid GPU identifiers</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2020-Dec-23 14:50", "status": "resolved", "created": "2020-Jun-15 22:39", "fixed_version": "2020-Jun-15 22:39", "broken_version": "", "priority": "2", "subsystem": "DaemonsExecNode", "assigned_to": "johnkn", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "bbockelman@morgridge.org tannenba@cs.wisc.edu", "due_date": ""}