{"id": 6078, "title": "Ticket #6078: Fix recovery of GCE jobs after failure during submission", "description": "<blockquote>\nRecovery of a Google Compute Engine (GCE) job after a failure during submission is flawed. When the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GridJobId\" title=\"Grid Job Id\">GridJobId</a></span> job attribute contains the HTCondor-assigned name for the job but not the GCE-assigned id, the gridmanager retries the submission to GCE. This assumes that a second submission of an instance with the same client-chosen name will return the id from the first submission. This is true for EC2, but not GCE. With the latter, the second submission will fail.\n\n<p>The fix is to do a query of all instances and look for one with a matching HTCondor-assigned name. The gridmanager always does this if the job status is Removed. It should do so regardless of the job status.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Jan-23 15:53:12 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Looks good.  Little surprised that GM_SEEK_INSTANCE_ID was already there, but it looks like it should work.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jan-19 10:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/069d113f4f8a371ef4d907c809e4832ba58094a3\">[50010]</a></span>: Docs for GCE failure recovery bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6078\" onclick=\"get_ticket_and_populate_wrapper('6078'); return false;\" title=\"Fix recovery of GCE jobs after failure during submission\">#6078</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jan-05 11:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c1175072c7c8a5bc634237b3ec0ab7397263124a\">[49921]</a></span>: Fix recovery of GCE jobs after failure during submission. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6078\" onclick=\"get_ticket_and_populate_wrapper('6078'); return false;\" title=\"Fix recovery of GCE jobs after failure during submission\">#6078</a></span> When we have the client-assigned name for a GCE job but not the server-assigned id, we can't blindly retry the submission request like with EC2. Instead, we need to do a query of all instances and see if there's one with the client-assigned\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Jan-23 15:55", "status": "resolved", "created": "2017-Jan-05 11:23", "fixed_version": "2017-Jan-05 11:23", "broken_version": "v080400", "priority": "3", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "fermi", "visibility": "public", "notify": "dstrain@google.com,timm@fnal.gov", "due_date": ""}