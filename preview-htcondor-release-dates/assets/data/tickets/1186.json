{"id": 1186, "title": "Ticket #1186: JobRouter crashes in some cases after failing to handle periodic exprs", "description": "<blockquote>\nCraig Struble reports a <code>JobRouter</code> crash:\n\n<p></p><div class=\"verbatim\">\n<pre>*** Last 20 line(s) of file /opt/condor-7.4.1/local.sunpassage/log/JobRouterLog:\n02/05 12:10:05 JobRouter (route=MSCS Pool): 0 submitted (max 400), 0 idle (max 100), throttle: 0.03 jobs/sec, recent stats: 0 started, 0 succeeded, 0 failed.\n02/05 12:10:12 WriteUserLog::initialize: safe_open_wrapper(\"/home/frupcich/dag_raytrace/logs/pen_raytrace.log\") failed - errno 2 (No such file or directory)\n02/05 12:10:12 WriteUserLog::initialize: failed to open file\n02/05 12:10:12 (252200.0) push_dirty_attributes: Failed to set EnteredCurrentStatus = 1265393412\n02/05 12:10:12 push_dirty_attributes: Failed to commit changes\n02/05 12:10:12 JobRouter failure (252200.0): failed to place job on hold.\n02/05 12:10:12 JobRouter failure (src=252200.0,dest=252393.0): Unable to evaluate job's periodic policy expressions.\nStack dump for process 26030 at timestamp 1265393412 (12 frames) condor_job_router(dprintf_dump_stack+0xb7)[0x561735]\ncondor_job_router(_Z18linux_sig_coredumpi+0x2c)[0x55302e]\n/lib64/libpthread.so.0[0x3ac960e930]\ncondor_job_router(_ZN7classad8ExprTree8CopyFromERKS0_+0x5)[0x869b75]\ncondor_job_router(_ZN7classad7ClassAd13CopyFromChainERKS0_+0x2b)[0x85283b]\ncondor_job_router(_ZN9RoutedJob11SetSrcJobAdEPKcPN7classad7ClassAdEPNS2_17ClassAdCollectionE+0x4f)[0x510317]\ncondor_job_router(_ZN9JobRouter26EvalAllSrcJobPeriodicExprsEv+0xd5)[0x51b42b]\ncondor_job_router(_ZN12TimerManager7TimeoutEv+0x24b)[0x55c9bb]\ncondor_job_router(_ZN10DaemonCore6DriverEv+0x82a)[0x53c5c4]\ncondor_job_router(main+0x18eb)[0x5552dd]\n/lib64/libc.so.6(__libc_start_main+0xf4)[0x3ac8a1d994]\ncondor_job_router(__gxx_personality_v0+0x439)[0x506df9]\n*** End of file JobRouterLog\n</pre></div>\n\n\n<p>My guess is that orig_ad is NULL in JobRouter::EvalAllSrcJobPeriodicExprs().  If so, then it appears that this problem was introduced in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9a3bd97b22ca2a24adc637b3bc6306faf36e2b8d\">[13748]</a></span>.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-05 18:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2c923b8c099264e74015d3434ead0e389bd9b55f\">[25253]</a></span>: Documented fix for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> crash. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1186\" onclick=\"get_ticket_and_populate_wrapper('1186'); return false;\" title=\"JobRouter crashes in some cases after failing to handle periodic exprs\">#1186</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-05 17:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0b4bb02b467605e93778dfad4b9c1e9f98feb19a\">[17108]</a></span>: Fixed a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> crash when handling failed periodic expression handler. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1186\" onclick=\"get_ticket_and_populate_wrapper('1186'); return false;\" title=\"JobRouter crashes in some cases after failing to handle periodic exprs\">#1186</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Feb-05 17:48", "status": "resolved", "created": "2010-Feb-05 17:47", "fixed_version": "2010-Feb-05 17:47", "broken_version": "v070202", "priority": "4", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "other", "visibility": "public", "notify": "craig.struble@marquette.edu,dan@hep.wisc.edu", "due_date": ""}