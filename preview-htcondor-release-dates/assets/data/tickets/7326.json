{"id": 7326, "title": "Ticket #7326: Discuss better fix for forwarding ads to self via CONDOR_VIEW_HOST", "description": "<blockquote>\nI'm not certain there isn't a safer fix for the parent ticket, where instead of changing <strong>Sinful::addressPointsToMe()</strong>, we re-use the code that solved the identical problem for COLLECTOR_HOST to solve the problem for CONDOR_VIEW_HOST.\n\n<p>See the code review in the parent ticket.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Dec-10 11:23:12 by jfrey:</em> <br/>\n\nThe two pieces of code for checking the default shared port id look functionally identical. They should be consolidated.\n\n<p>ToddM suggests that the consolidated code should be a static function in the collector. Since the collector is the default daemon behind shared port, other daemons don't have to worry about whether a sinful with no shared port id can end up being routed to themselves via shared port.\n\n</p><p>I believe that <code>Sinful::addressPointsToMe()</code> is the best place for this code for the following reasons:\n</p><ul>\n<li>Anyone adding new calls to <code>Sinful::addressPointsToMe()</code> in the collector may forget to call a special collector-specific function.\n</li><li>It is possible to configure share port to default forward to a different daemon. (Others can argue whether this would ever be a good idea.)\n</li></ul>\n\n<p></p><hr/>\n<em>2019-Dec-12 14:41:28 by tlmiller:</em> <br/>\n\nMy argument was <code>addressPointsToMe()</code> can't know which daemon is asking if a sinful string without a shared port ID points to itself, but the new version doesn't actually check that -- it checks to see if the default shared port ID is the same as the only shared port ID in the pair of sinfuls we're comparing.  I can't conceive of a reason why a daemon would get its own shared port ID wrong, so this should actually just work in all cases.  It won't work if the daemon fails to determine its own shared port ID and is passing a sinful without a shared port ID to <code>addressPointsToMe()</code>, but that's true for the existing code.\n\n<p><strong>Code Review</strong>\n\n</p><p>Change looks good.\n\n</p><p></p><hr/>\n<em>2019-Dec-12 14:44:32 by tlmiller:</em> <br/>\n\nI don't think this needs a release note.  (There's technically a semantic difference when the collector's Sinful object doesn't have a shared port ID and the other Sinful does, but that should never happen.)</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Dec-10 12:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a644eb486c7c5a8e53515b8bce89e11287644318\">[58628]</a></span>: Remove extra shared port default id check in the collector. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7326\" onclick=\"get_ticket_and_populate_wrapper('7326'); return false;\" title=\"Discuss better fix for forwarding ads to self via CONDOR_VIEW_HOST\">#7326</a></span> Sinful::addressPointsToMe() now does this check.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Dec-12 14:44", "status": "resolved", "created": "2019-Oct-15 14:32", "fixed_version": "2019-Oct-15 14:32", "broken_version": "v080806", "priority": "2", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "#7229", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, jfrey@cs.wisc.edu", "due_date": ""}