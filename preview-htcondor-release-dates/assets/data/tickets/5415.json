{"id": 5415, "title": "Ticket #5415: jobs fail to start in dynamic slots that depend on CROND script", "description": "<blockquote>\nExecute node:\n\n<p></p><pre>  STARTD_CRON_JOBLIST = $(STARTD_CRON_JOBLIST) ICC\n  STARTD_CRON_ICC_EXECUTABLE = /usr/lib/nagios/plugins/check_icc_version\n  STARTD_CRON_ICC_ARGS = --classad\n  STARTD_CRON_ICC_PERIOD = 300\n</pre>\n\n<p></p><pre>  STARTD_CRON_JOBLIST = $(STARTD_CRON_JOBLIST) DATA\n  STARTD_CRON_DATA_EXECUTABLE = /usr/lib/nagios/plugins/check_instrument_data\n  STARTD_CRON_DATA_ARGS = --classad\n  STARTD_CRON_DATA_MODE = WaitForExit\n  STARTD_CRON_DATA_PERIOD = 90\n</pre>\n\n<p></p><pre>  CROND_REQUIREMENTS = ( \\\n    ifThenElse(isUndefined(INSTRUMENT_DATA_OK), False, INSTRUMENT_DATA_OK) &amp;&amp; \\\n    ifThenElse(isUndefined(ICC_OK), False, ICC_OK))\n</pre>\n\n<p></p><pre>  slot_type_1_partitionable = True\n  num_slots_type_1 = 1\n  START = $(CROND_REQUIREMENTS) || TARGET.Owner =?= UNDEFINED\n</pre>\n\n<p>For the first several minutes of operation (after benchmarking) jobs will match to the partitionable slot but then fail to match in the newly-created dynamic slot. I believe the CROND classads are not being passed down to the dynamic slot even though they are being reported to the central manager.\n\n</p><p></p><pre>  11/24/15 15:01:19 slot1: Received ClaimId from schedd (&lt;192.168.4.32:50030&gt;#1448398592#5#...)\n  11/24/15 15:01:19 Job no longer matches partitionable slot after MODIFY_REQUEST_EXPR_ edits, retrying w/o edits\n  11/24/15 15:01:19 slot1: Partitionable slot can't be split to allocate a dynamic slot large enough for the claim\n</pre>\n\n<p>Without action, after several minutes the jobs begin to match.\n\n</p><p></p><pre>  11/24/15 15:02:19 slot1: Received ClaimId from schedd (&lt;192.168.4.32:50030&gt;#1448398592#6#...)\n  11/24/15 15:02:19 slot1: Match requesting resources: cpus=1 memory=2048 disk=1%\n  11/24/15 15:02:19 Got execute_dir = /localscratch/condor/execute\n  11/24/15 15:02:19 slot1: Total execute space: 820016768\n  11/24/15 15:02:19 slot1_1: New machine resource of type -1 allocated</pre>\n</blockquote>", "remarks": "<blockquote>\n<em>2015-Nov-25 12:46:29 by gthain:</em> <br/>\n\nWhat's the \"|| TARGET.Owner <code>?</code> UNDEFINED\" clause for?\n\n<p></p><hr/>\n<em>2016-Apr-07 10:39:15 by tpdownes:</em> <br/>\n\nWithout that the slot does not leave the Owner state. Maybe the initial benchmarking \"job\"?\n\n<p></p><hr/>\n<em>2016-May-13 13:31:21 by gthain:</em> <br/>\n\nThe slot should stay in the owner state if Start evaluates to false without a job ad.  That is, it will only go to Unclaimed if Start is true or undefined.  I think if you remove the || target.Owner == Undefined clause, jobs will start up faster.  The startd may go into owner state until the startd cron attribute gets evaluated, but that should be pretty quick.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "todo", "last_change": "2016-May-13 13:31", "status": "defer", "created": "2015-Nov-24 20:32", "fixed_version": "2015-Nov-24 20:32", "broken_version": "v080210", "priority": "5", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "tpdownes", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pcouvare@caltech.edu", "due_date": ""}