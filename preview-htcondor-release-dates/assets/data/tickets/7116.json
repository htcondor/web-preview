{"id": 7116, "title": "Ticket #7116: condor_ssh_to_job broken in packaging", "description": "<blockquote>\nLIGO reported that <code>condor_ssh_to_job</code> doesn't work for them.\n\n<p>Sure enough, it appears that the location where the file <code>condor_ssh_to_job_sshd_config_template</code> is installed doesn't match the file's location in the configuration (note: this is not documented in the param table but in the code).\n\n</p><p>Places that have <code>condor_ssh_to_job</code> working (such as CHTC) appear to be hand-overriding this knob.\n\n</p><p>Let's get the packaging matching the code!</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Jun-19 11:08:47 by tim:</em> <br/>\n\nFor Red Hat at least, the base configuration file <code>/etc/condor/condor_config</code> points to the proper location. I often test condor_ssh_to_job with the default installation.\n\n<p></p><hr/>\n<em>2019-Jun-20 03:48:07 by bbockelm:</em> <br/>\n\n<code>condor_config</code> is marked as <code>%config(noreplace)</code> in the RPM, right?  That means that nothing in there can really be counted on...\n\n<p>Given it has bit an important site already, can we just update the param table to have the right default?\n\n</p><p></p><hr/>\n<em>2019-Aug-04 17:24:46 by tim:</em> <br/>\n\nThe minimal change is to update the RPM install to put this file where the param tab says it is.\n\n<p></p><hr/>\n<em>2019-Aug-05 14:42:20 by matyas:</em> <br/>\n\nI don't like the way this is implemented.  Let me see if I have this right.  There are four groups of Condor admins:\n\n<p></p><ul>\n<li>Group 1 uses Puppet to stomp over /etc/condor/condor_config with their own version that unsets SSH_TO_JOB_SSHD_CONFIG_TEMPLATE.\n</li><li>Group 2 uses Puppet to stomp over /etc/condor/condor_config with their own version that leaves SSH_TO_JOB_SSHD_CONFIG_TEMPLATE pointing to the current template location in /etc.\n</li><li>Group 3 hand-edited /etc/condor/condor_config at one point but didn't touch SSH_TO_JOB_SSHD_CONFIG_TEMPLATE.\n</li><li>Group 4 has a pristine untouched /etc/condor/condor_config.\n</li></ul>\n\n<p>Today, condor_config points to the correct location, but the param table doesn't.  This means ssh_to_job is working for groups 2, 3, and 4, but is broken for group 1.  (LIGO is in group 1.)\n\n</p><p>The check-ins 57578, 57583, and 57587 move the config template to /usr/lib/condor and change condor_config to point to the /usr/lib/condor location (same as the param table).  This fixes the problem for group 1, but breaks things for group 2 (because their condor_config still points to /etc).  <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7183\" onclick=\"get_ticket_and_populate_wrapper('7183'); return false;\" title=\"Drop noreplace designation from configuration files\">#7183</a></span> keeps it from breaking group 3 as well.  Group 4 is unaffected.\n\n</p><p>So I don't like this change because it fixes things for one group but breaks things for another group.  Either the param table should be changed to point to the /etc location, or nothing should be done.\n\n</p><p>(I am fine with either of these, since we explicitly tell people not to modify condor_config, so groups 1, 2, and 3 are all Doing It Wrong.)\n\n</p><p></p><hr/>\n<em>2019-Aug-05 21:11:46 by bbockelm:</em> <br/>\n\nYup, I agree with Mat's analysis here - there's a chance of breaking other clusters with the fix as-is.  I think changing the param table to reflect the packaged location is safest.\n\n<p></p><hr/>\n<em>2019-Aug-07 10:19:58 by tim:</em> <br/>\n\nIf I change the param table, then the location of the file would change for tarballs, Debian, Ubuntu, Macs, and Windows. In stable, we go for minimal changes. This is the minimal change. If something more extensive is desired, then it goes into the development series.\n\n<p></p><hr/>\n<em>2019-Aug-07 10:32:21 by tim:</em> <br/>\n\nI'll drop a symbolic link in /etc that points to the copy in /usr/lib{64}/condor.\n\n<p></p><hr/>\n<em>2019-Aug-07 17:14:14 by matyas:</em> <br/>\n\nLGTM.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Sep-03 17:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/62e73141636ec7a4cf91588ec37a539a687a1632\">[57752]</a></span>: Version histories for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7219\" onclick=\"get_ticket_and_populate_wrapper('7219'); return false;\" title=\"HTCondor should not phone home by default\">#7219</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7161\" onclick=\"get_ticket_and_populate_wrapper('7161'); return false;\" title=\"Upgrade of annex-ec2 RPM disable the annex service\">#7161</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7197\" onclick=\"get_ticket_and_populate_wrapper('7197'); return false;\" title=\"Update condor_gpu_discovery for Volta and Turing GPUs\">#7197</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7116\" onclick=\"get_ticket_and_populate_wrapper('7116'); return false;\" title=\"condor_ssh_to_job broken in packaging\">#7116</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7183\" onclick=\"get_ticket_and_populate_wrapper('7183'); return false;\" title=\"Drop noreplace designation from configuration files\">#7183</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7209\" onclick=\"get_ticket_and_populate_wrapper('7209'); return false;\" title=\"Java files not packaged for Ubuntu 18\">#7209</a></span>  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-07 10:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bbcfaf44252668b2f23825a69e801a5b5a40872f\">[57620]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7116\" onclick=\"get_ticket_and_populate_wrapper('7116'); return false;\" title=\"condor_ssh_to_job broken in packaging\">#7116</a></span>) Correct symlink target for sshd_to_job config template  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-07 10:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f53e6dbb7a1314e4dd66cdb15ba132a96955c47f\">[57619]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7116\" onclick=\"get_ticket_and_populate_wrapper('7116'); return false;\" title=\"condor_ssh_to_job broken in packaging\">#7116</a></span>) Drop symbolic link to /etc for backward compatibility  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-04 23:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5af43bd784819437a4040abd87e874f2d2e4285f\">[57587]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7116\" onclick=\"get_ticket_and_populate_wrapper('7116'); return false;\" title=\"condor_ssh_to_job broken in packaging\">#7116</a></span>) Take 2 on condor_ssh_to_job_sshd_config_template  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-04 20:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8fdab394ddcc37cdb72edc414e7348159e17d8d7\">[57583]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7116\" onclick=\"get_ticket_and_populate_wrapper('7116'); return false;\" title=\"condor_ssh_to_job broken in packaging\">#7116</a></span>) Typo populating condor_ssh_to_job_sshd_config_template  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-04 17:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5b0d208e0cc2b5761c373eaf3ff8ee093054603a\">[57578]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7116\" onclick=\"get_ticket_and_populate_wrapper('7116'); return false;\" title=\"condor_ssh_to_job broken in packaging\">#7116</a></span>) Put condor_ssh_to_job_sshd_config_template in default location The condor_ssh_to_job_sshd_config_template is expected in $(LIB)  (By Tim Theisen )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Sep-18 14:24", "status": "resolved", "created": "2019-Jun-19 08:10", "fixed_version": "2019-Jun-19 08:10", "broken_version": "", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "tim", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "peter.couvares@ligo.org, bbockelman@morgridge.org; tannenba@cs.wisc.edu", "due_date": ""}