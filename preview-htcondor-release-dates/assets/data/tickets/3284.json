{"id": 3284, "title": "Ticket #3284: Change default MODIFY_REQUEST_EXPR_REQUESTMEMORY", "description": "<blockquote>\nAt least at our CMS T2, the default MODIFY_REQUEST_EXPR_REQUESTMEMORY does more harm than good.\n\n<p>Right now, it is something like: quantize(RequestMemory, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TotalCpus\" title=\"Total Cpus\">TotalCpus</a></span> / <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TotalMemory\" title=\"Total Memory\">TotalMemory</a></span> / 4).  This basically rounds-up to the nearest 25% of the per-slot memory.  Two issues with this:\n</p><ul>\n<li>If the memory request is slightly more than the per-slot memory, this can cause significant loss.\n<ul>\n<li>Example: Suppose there are 32 slots and 2000 MB RAM per slot.  If each job asks for 2001 MB, then the request is rounded to 2500 MB.  So, a maximum of 25 jobs can be run - idling 7 cores instead of 1 core.\n</li></ul>\n</li><li>If there are many node types, then this is causing quite a bit of fragmentation of match lists.  If you quantize based on the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span>, you cause fragmentation of the auto-clusters.  A priori, I don't really see any advantage based on using the per-slot memory size.\n</li></ul>\n\n<p>I propose we have a limit on the absolute amount of per-slot memory loss.  Let's change the default to:\n\n</p><p>quantize(RequestMemory, 100)</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Oct-22 12:33:15 by tstclair:</em> <br/>\n\nrecommend quantize(RequestMemory, 128)\n\n<p>Of note, the admin can always override.  This is simply an out-of-the-box issue.\n</p><hr/>\n<em>2012-Dec-11 16:40:19 by johnkn:</em> <br/>\n\nBulk change of target version from v070902 to v070903 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2013-May-21 16:36:31 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Code patch is fine, but why was the documentation not changed?  The manual now lists the wrong default for this parameter.\n\n</p><p></p><hr/>\n<em>2013-May-21 16:44:03 by tannenba:</em> <br/>\n\nUpdated manual, resolving.\n\n<p></p><hr/>\n<em>2014-Apr-21 15:20:11 by burt:</em> <br/>\n\nWhoops, you guys missed one spot in the docs:\n\n<p>./admin-man/multi-core.tex:  \\item{\\Macro{MODIFY\\_REQUEST\\_EXPR\\_REQUESTMEMORY} = \\Expr{quantize(RequestMemory, \\{TotalSlotMem / <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TotalSlotCpus\" title=\"Total Slot Cpus\">TotalSlotCpus</a></span> / 4\\}) }}</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Apr-22 16:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ee06cc52199c9cfd8dcdeb4b2b6b9fdacff85bb2\">[40012]</a></span>: missed doc change of default value of a knob <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3284\" onclick=\"get_ticket_and_populate_wrapper('3284'); return false;\" title=\"Change default MODIFY_REQUEST_EXPR_REQUESTMEMORY\">#3284</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-21 16:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6cd9a997915c474c976c0889911e9a0999d8da01\">[35801]</a></span>: correct default value for MODIFY_REQUEST_EXPR_REQUESTMEMORY <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3284\" onclick=\"get_ticket_and_populate_wrapper('3284'); return false;\" title=\"Change default MODIFY_REQUEST_EXPR_REQUESTMEMORY\">#3284</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Oct-22 12:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/89198b834f4c54bd5584e26af9ac8fccf5af6153\">[33728]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3284\" onclick=\"get_ticket_and_populate_wrapper('3284'); return false;\" title=\"Change default MODIFY_REQUEST_EXPR_REQUESTMEMORY\">#3284</a></span> Change default MODIFY_REQUEST_EXPR_REQUESTMEMORY to 128  (By Timothy St. Clair )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Apr-21 15:20", "status": "resolved", "created": "2012-Oct-21 19:42", "fixed_version": "2012-Oct-21 19:42", "broken_version": "v070900", "priority": "3", "subsystem": "Daemons", "assigned_to": "tannenba", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "bbockelm@cse.unl.edu tstclair@redhat.com burt@fnal.gov", "due_date": ""}