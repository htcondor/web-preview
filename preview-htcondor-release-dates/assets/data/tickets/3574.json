{"id": 3574, "title": "Ticket #3574: Have schedd advertised weighted slot demand, for group quota code use", "description": "<blockquote>\nCurrently, partitionable slots don't work with hierarchical groups for a number of reasons.  One reason is that the surplus sharing code relies on the submitter ad to estimate how many extra idle jobs there are per submitter.  Because the schedd doesn't know the slots weight, the units it advertises is in number of jobs.\n\n<p>In this ticket, we will help the common case where slot weights is \"cpus\", and have the schedd advertise number of idle jobs in units of cpus * idle jobs, which the negotiator group quota code will use to measure demand and thus surplus.  The schedd will advertise it unconditionally in the submitter ad, but the negotiator will only use it if NEGOTIATOR_USE_WEIGHTED_DEMAND is set to true.  Otherwise, it will continue as today and use the raw numbers.\n\n</p><p>Also see <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4324\" onclick=\"get_ticket_and_populate_wrapper('4324'); return false;\" title=\"Allow submitter WeightedJobIdle and Running to reflect slot weight\">#4324</a></span></p></blockquote>", "remarks": "<blockquote>\n<em>2013-Apr-15 14:00:41 by eje:</em> <br/>\n\nWith respect to \"units of cpus * idle jobs\", is 'cpus' total cpus on the pool, or some other cpu quantity?   Where does the schedd get its measurement of cpus?\n\n<p></p><hr/>\n<em>2013-Apr-15 14:09:26 by gthain:</em> <br/>\n\nFrom request_cpus in the job ads from idle jobs.  it's not generalized, and it is a short term workaround (hack).\n\n<p></p><hr/>\n<em>2013-Apr-18 15:41:40 by eje:</em> <br/>\n\nCan you attach a testing scenario with results that demonstrates the new behavior?\n\n<p></p><hr/>\n<em>2013-Apr-18 15:53:28 by eje:</em> <br/>\n\nUnder the assumption that this is an interim hack on emergency footing, the new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WeightedRunningJobs\" title=\"Weighted Running Jobs\">WeightedRunningJobs</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WeightedIdleJobs\" title=\"Weighted Idle Jobs\">WeightedIdleJobs</a></span> ought to be advertised conditionally on NEGOT&amp;#8203;IATOR_USE_WEIGHTED_DE&amp;#8203;MAND as well</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-07 10:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4864727f9ed5bcadf5415725880b598cc29c0293\">[35616]</a></span>: Document new knob NEGOTIATOR_USE_WEIGHTED_DEMAND and 2 new Submitter attributes, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WeightedIdleJobs\" title=\"Weighted Idle Jobs\">WeightedIdleJobs</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WeightedIdleJobs\" title=\"Weighted Idle Jobs\">WeightedIdleJobs</a></span>, and format the version history item. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3574\" onclick=\"get_ticket_and_populate_wrapper('3574'); return false;\" title=\"Have schedd advertised weighted slot demand, for group quota code use\">#3574</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-06 15:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7f40e363da059a42567d99aa3bc3f59a8527f619\">[35611]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3574\" onclick=\"get_ticket_and_populate_wrapper('3574'); return false;\" title=\"Have schedd advertised weighted slot demand, for group quota code use\">#3574</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-17 14:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2698365e30408a87a51c620d763627b1bfce812c\">[35442]</a></span>: Scheddd also advertises weighted demand <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3574\" onclick=\"get_ticket_and_populate_wrapper('3574'); return false;\" title=\"Have schedd advertised weighted slot demand, for group quota code use\">#3574</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Sep-03 13:22", "status": "resolved", "created": "2013-Apr-15 13:47", "fixed_version": "2013-Apr-15 13:47", "broken_version": "v070800", "priority": "1", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "eje@cs.wisc.edu, tstclair@redhat.com, matt@cs.wisc.edu", "due_date": ""}