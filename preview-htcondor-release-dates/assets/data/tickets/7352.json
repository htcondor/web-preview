{"id": 7352, "title": "Ticket #7352: Add DAGMan inline submit descriptions", "description": "<blockquote>\nDAGMan currently requires users to provide external submit files to describe jobs in their workflows. We'd like to extend the DAGMan syntax so that submit descriptions can be included inline.\n\n<p>The first step will be modifying the <code>JOB</code> command. Our current syntax expects the user to provide the path to a submit file in the local file system. We'll change this so a user can optionally provide a submit description in an inline classad, preceded by the <code>SUBMIT</code> keyword. For example, to define a job which sleeps for 10 seconds:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">JOB Sleep SUBMIT-DESCRIPTION {\n    executable = \"/bin/sleep\"\n    arguments = 10\n}\n</pre></div>\n\n\n<p>We also need to provide backwards compatibility. So the following syntax will still be valid:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">JOB Sleep sleep.sub\n</pre></div>\n\n\n<p>To avoid confusion between submit files and submit descriptions, we'll allow users to reference submit files with an optional <code>FILE</code> keyword:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">JOB Sleep FILE sleep.sub\n</pre></div>\n\n\n<p>Lastly, we'll allow submit descriptions to be declared independently of jobs. They can then be associated to jobs by passing the name instead of a classad. For example:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">SUBMIT-DESCRIPTION SleepSubmitDesc = {\n    executable = \"/bin/sleep\"\n    arguments = 10\n}\nJOB Sleep1 SUBMIT-DESCRIPTION SleepSubmitDesc\nJOB Sleep2 SUBMIT-DESCRIPTION SleepSubmitDesc\n</pre></div>\n\n\n<p>Internally, we'll extend DAGMan's <code>Job()</code> class to store the description in a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SubmitHash\" title=\"Submit Hash\">SubmitHash</a></span> member variable called <code>_submitDescription</code>. At parse time, <code>condor_dagman</code> will translate the inline classad to a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SubmitHash\" title=\"Submit Hash\">SubmitHash</a></span> object which can later be handed off directly to the schedd.\n\n</p><p>Some other rules and assumptions:\n</p><ul>\n<li>We will not support clusters with multiple procs. All inline submits are assumed to be \"queue 1\".\n</li><li>The <code>DAGMAN_USE_CONDOR_SUBMIT</code> configuration knob <strong>must</strong> be set to False. If not <code>condor_dagman</code> will fail at parse time.\n</li><li>Inline submits can coexist with regular submit files in the same .dag file.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=7847\" onclick=\"get_ticket_and_populate_wrapper('7847'); return false;\" title=\"DAGMan inline submit descriptions declared independent of jobs\">#7847</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDAGMan inline submit descriptions declared independent of jobs</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-30 12:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/92a66390c693c91441d7df4d5fc057e5135dba49\">[60281]</a></span>: Added documentation + version history (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7352\" onclick=\"get_ticket_and_populate_wrapper('7352'); return false;\" title=\"Add DAGMan inline submit descriptions\">#7352</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jun-02 18:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/45cde352a33ff1032fd0f5b060eaa733e628bcf4\">[59779]</a></span>: Added ornithology test for dagman inline job submission (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7352\" onclick=\"get_ticket_and_populate_wrapper('7352'); return false;\" title=\"Add DAGMan inline submit descriptions\">#7352</a></span>) (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7501\" onclick=\"get_ticket_and_populate_wrapper('7501'); return false;\" title=\"Add new Python-based test framework\">#7501</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jun-02 15:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/63f88ab9b52a46eff7d1a70167ba2e4a09689f17\">[59776]</a></span>: DAGMan inline job submission now aborts if DAGMAN_USE_CONDOR_SUBMIT set to True (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7352\" onclick=\"get_ticket_and_populate_wrapper('7352'); return false;\" title=\"Add DAGMan inline submit descriptions\">#7352</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-30 17:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1664e8f0e41e8480f4d144a6630cec18d0fc7fe1\">[59538]</a></span>: Implemented dagman inline job submission, ready for batlab testing (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7352\" onclick=\"get_ticket_and_populate_wrapper('7352'); return false;\" title=\"Add DAGMan inline submit descriptions\">#7352</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-25 10:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c4c214c06fd26c3e6134bcf8fb04e99f3f50902c\">[59031]</a></span>: Basic plumbing for DAGMan inline submit (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7352\" onclick=\"get_ticket_and_populate_wrapper('7352'); return false;\" title=\"Add DAGMan inline submit descriptions\">#7352</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Jul-30 12:31", "status": "resolved", "created": "2019-Oct-30 14:08", "fixed_version": "2019-Oct-30 14:08", "broken_version": "", "priority": "3", "subsystem": "Dag", "assigned_to": "coatsworth", "derived_from": "", "creator": "coatsworth", "rust": "", "customer_group": "other", "visibility": "public", "notify": "coatsworth@cs.wisc.edu, johnkn@cs.wisc.edu", "due_date": ""}