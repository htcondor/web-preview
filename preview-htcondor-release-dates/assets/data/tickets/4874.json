{"id": 4874, "title": "Ticket #4874: Fine-grained filtering of collector ads", "description": "<blockquote>\n<span class=\"section\"><h2>Use Case</h2></span>\n\n<p><span class=\"subsection\"></span></p><h3>HTCondor-CE </h3>\nOSG currently has a central collector that allows registered OSG sites to advertise the presence of a HTCondor-CE (internally - the HTCondor-CE's collector forwards the schedd ad to a central OSG collector).\n\n<p>The HTCondor-CE's DN is mapped to a HTCondor user name (i.e., <code>/DC=com/DC=example/OU=Services/CN=example.site.com</code> maps to <code>example.site.com@sites.opensciencegrid.org</code>); only authorized users are allowed to post schedd ads.  Currently, the list of authorized users is set to the list of authorized CEs in our other information systems (OSG's OIM web service).\n\n</p><p>Miron dislikes this; anyone with a HTCondor-CE &amp; valid certificate should be able to advertise their CE.  An explicit registration step should not be required.  However, we need to enforce a few simple rules: for example, an authenticated user of \"site.example.com@sites.opensciencegrid.org\" should not be permitted to advertise a schedd named \"cms.fnal.gov\".\n\n</p><p><span class=\"subsection\"></span></p><h3>Xrootd Caches</h3>\n\n<p>We are starting to plan the deployment of Xrootd caches across the OSG.  We'd like these caches to be able to self-register in the collector so we can see which pieces are alive and some simple monitoring statistics.\n\n</p><p>Similar to the case above - we'd like to be able to accept any Xrootd server with a DN, as long as we can filter out maliciously bad ads.\n\n</p><p><span class=\"section\"></span></p><h2>Proposal </h2>\n\n<p>I'd like to see COLLECTOR_REQUIREMENTS implemented.  That is:\n\n</p><p></p><ol>\n<li>In the collector engine, have an expression evaluated on every classad update within the context of the updated ad; if it evaluates to FALSE, UNDEFINED, or ERROR, then drop the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>.  No changes to the existing protocol.\n</li><li>This would still only be applied after authorizations.  In the examples above, OSG's central collector would authorize <code>*@sites.opensciencegrid.org</code>.\n</li><li>If the collector drops the ad because the requirement evaluates to FALSE or UNDEFINED, log the reason why at D_FULLDEBUG; if the classad evaluates to ERROR, log the reason why to D_ALWAYS.\n</li></ol>\n\n<p>To complete the project for the Xrootd caches, OSG will probably need a separate authorization level for generic updates (as the xrootd cache is likely not master, schedd, or startd ad type).\n\n</p><p>I'm not sold on the proposal and am willing to listen to other solutions for the use case above.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Feb-11 15:25:05 by tannenba:</em> <br/>\n\nBelieve a collector requirements knob already exists; perhaps we can abandon this ticket?\n\n<p></p><hr/>\n<em>2015-Feb-11 16:00:15 by bbockelm:</em> <br/>\n\nHa!  jfrey pointed out that this has been around for a long, long time (long enough I didn't know it existed).  Looks like it was originally developed for 6.8.\n\n<p>Doh.</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=4874\" onclick=\"get_ticket_and_populate_wrapper('4874'); return false;\" title=\"Fine-grained filtering of collector ads\">#4874</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nFine-grained filtering of collector ads</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2015-Feb-11 16:00", "status": "abandoned", "created": "2015-Feb-06 16:08", "fixed_version": "2015-Feb-06 16:08", "broken_version": "", "priority": "3", "subsystem": "DaemonsCM", "assigned_to": "bbockelm", "derived_from": "#4874", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu", "due_date": ""}