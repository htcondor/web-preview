{"id": 4800, "title": "Ticket #4800: Offload authorization to a separate process", "description": "<blockquote>\nAlong with <span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=189\" onclick=\"get_ticket_and_populate_wrapper('189'); return false;\" title=\"Allow Selector class to use epoll system call where available\">#189</a></span>, one remaining reason we need a collector hierarchy is the cost of authentication.\n\n<p>In <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4137\" onclick=\"get_ticket_and_populate_wrapper('4137'); return false;\" title=\"Non-blocking authentication\">#4137</a></span>, authentication (for FS and GSI) was made non-blocking, allowing multiple authentication attempts to proceed at once.  However, GSI itself is a costly operation in terms of CPU usage - in the case of a collector restart, there is simply no CPU fast enough to establish new connections for all startds in a large glidein pool.\n\n</p><p>I propose introducing a new daemon - condor_auth_server - which will receive the remote TCP socket, perform authentication only, and then send the socket back to the parent.  This will allow multiple CPUs to be utilized for GSI authentication.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-29 11:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bc93522948e54e4d7fb68116ccf451d0c5df90c9\">[42046]</a></span>: Enable the auth server in the collector. <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=4800\" onclick=\"get_ticket_and_populate_wrapper('4800'); return false;\" title=\"Offload authorization to a separate process\">#4800</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-29 11:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d2a8f216a74c7161c1ccbbaccc75687db454495a\">[42045]</a></span>: Allow DC to utilize the auth_server if enabled. <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=4800\" onclick=\"get_ticket_and_populate_wrapper('4800'); return false;\" title=\"Offload authorization to a separate process\">#4800</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-29 11:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/18d973f354721270ad5f3032f9d7225372f7f529\">[42044]</a></span>: Implementation of a separate authorization server. <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=4800\" onclick=\"get_ticket_and_populate_wrapper('4800'); return false;\" title=\"Offload authorization to a separate process\">#4800</a></span> The condor_auth_server accepts and authenticates TCP sockets from other daemons, sending the results and socket back to the original DC process.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-29 11:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/42bcaab9d17df00c79883274765cd2fd99442af7\">[42043]</a></span>: Allow the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CondorError\" title=\"Condor Error\">CondorError</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=KeyInfo\" title=\"Key Info\">KeyInfo</a></span> objects to be serialized in a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>. <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=4800\" onclick=\"get_ticket_and_populate_wrapper('4800'); return false;\" title=\"Offload authorization to a separate process\">#4800</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-29 11:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0eb1a90f5d4f706f6c67177da7f62326e54023c3\">[42042]</a></span>: CEDAR plumbing for socket passing. <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=4800\" onclick=\"get_ticket_and_populate_wrapper('4800'); return false;\" title=\"Offload authorization to a separate process\">#4800</a></span> This includes three items: - Passing file descriptors between two CEDAR processes on the same host. - Fix const-ness of the various socket serialize methods. - Creating a pair of unix domain sockets.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-29 11:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/98ce70c7f312195bc4c486b6821b1fc74b936fc1\">[42041]</a></span>: Fix missing include in exprList header. <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=4800\" onclick=\"get_ticket_and_populate_wrapper('4800'); return false;\" title=\"Offload authorization to a separate process\">#4800</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Dec-29 11:18", "status": "new", "created": "2014-Dec-29 11:18", "fixed_version": "2014-Dec-29 11:18", "broken_version": "", "priority": "4", "subsystem": "DaemonsCM", "assigned_to": "bbockelm", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bbockelm@cse.unl.edu", "due_date": ""}