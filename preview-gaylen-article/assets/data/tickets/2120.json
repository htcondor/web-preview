{"id": 2120, "title": "Ticket #2120: Cgroup feature should be documented in manual for 7.7.x series.", "description": "<blockquote>\nThe CGroup pid tracking functionality, which is about to go into Condor, should be documented in the manual.</blockquote>", "remarks": "<blockquote>\n<em>2011-Oct-12 11:10:48 by smoler:</em> <br/>\n\nFrom Brian Bockelman:\n\n<p>Hi Karen,\n\n</p><p>We realized there was a significant feature - cgroups integration - that was added to 7.7.0 but never documented. Sorry about that - since I'm not on the Condor team, I didn't really know it was needed.\n\n</p><p>Information:\nCgroups is a mechanism in newer Linux kernels (2.6.24 or later) which provides kernel-level tracking for process trees and resource consumption.  Starting in 7.7.0, the Condor can create and use cgroups for each job, offloading much of the procd's task to the kernel.  This significantly improves the accuracy of Condor accounting (especially for short-lived processes) and improves the reliability of job killing.  Cgroups integration is available on any kernel which supports it; it is in the stock 2.6.24 kernel or later.\n\n</p><p>Related parameters:\n\n</p><p><code>BASE_CGROUP</code>: this controls the base directory name of the cgroup Condor will use; each job will be in a unique cgroup that is a subdirectory called job_XYZ, where XYZ is the job process/cluster.  If <code>BASE_CGROUP</code> is \"/\", then job 123.45 will run in a cgroup called \"/job_123.45\".  If <code>BASE_CGROUP</code> is \"/condor\", then job 123.45 will run in \"/condor/job_123.45\".  This allows Condor to flexibly integrate in an existing cgroup setup.\n\n</p><p></p><hr/>\n<em>2011-Oct-12 13:36:12 by matt:</em> <br/>\n\nBrian,\n\n<p>What groups need to be mounted in the BASE_CGROUP? What if they are mounted in independent places, can we have MEMORY_CGROUP_ROOT and CPUACCT_CGROUP_ROOT?\n\n</p><p>What permissions are required on the mount point(s)?\n\n</p><p>Do you have an example cgconfig.conf to include?\n\n</p><p></p><hr/>\n<em>2011-Oct-14 15:01:08 by bbockelm:</em> <br/>\n\nHi Matt,\n\n<p>I'll attach a cgconfig.conf separately.  If you don't want to hand mount, you'll need one of these and to enable the cgconfig service.  The sample cgconfig.conf is designed for BASE_CGROUP=/condor.\n\n</p><p>To use the cgroups feature, Condor must be run as root.\n\n</p><p>If the cgroups are mounted in independent places, there is no issue - but the same cgroup name will be used for all controllers.\n\n</p><p>Condor will use freezer, cpuacct, memory, and blkio cgroups.  If you don't have one of these mounted, it will log this in the procd and fallback to the standard procd accounting in such case.\n\n</p><p>I think this answers all your questions?\n\n</p><p></p><hr/>\n<em>2011-Dec-01 11:46:59 by smoler:</em> <br/>\n\nPete's leaving.  Greg T. inherits this ticket.\n\n<p></p><hr/>\n<em>2012-Feb-01 11:50:40 by smoler:</em> <br/>\n\nGreg wrote section 3.13.13.  Karen edited.  Task complete.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/477/cgconfig.conf\">cgconfig.conf</a>\n260 bytes added by bbockelm on 2011-Oct-14 20:01:23 UTC.\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Feb-09 09:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2b18fd8c085c762dc2147b38614b61beb3599db1\">[30542]</a></span>: Add ticket number to version history item. And, fix incorrectly changed defn of config knob PROCD_LOG, due to <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2120\" onclick=\"get_ticket_and_populate_wrapper('2120'); return false;\" title=\"Cgroup feature should be documented in manual for 7.7.x series.\">#2120</a></span> changes also for 7.7.5. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2775\" onclick=\"get_ticket_and_populate_wrapper('2775'); return false;\" title=\"procd log should be turned on by default\">#2775</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-31 12:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4d2002f2173357adf21aa0501689cdcfbb797a7c\">[30036]</a></span>: Edit of new documentation on cgroups; addition of defn of config knob BASE_CGROUP; correction of defn of config knob PROCD_LOG; version history item to point to the new documentation. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2120\" onclick=\"get_ticket_and_populate_wrapper('2120'); return false;\" title=\"Cgroup feature should be documented in manual for 7.7.x series.\">#2120</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1831\" onclick=\"get_ticket_and_populate_wrapper('1831'); return false;\" title=\"Take advantage of cgroups-based capabilities on new Linux platforms\">#1831</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-20 10:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b7a4eda53c0fde16ed29926b571ee30dd0140197\">[29165]</a></span>: First cut at documenting cgroup <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2120\" onclick=\"get_ticket_and_populate_wrapper('2120'); return false;\" title=\"Cgroup feature should be documented in manual for 7.7.x series.\">#2120</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "doc", "last_change": "2012-Feb-01 11:51", "status": "resolved", "created": "2011-May-02 10:56", "fixed_version": "2011-May-02 10:56", "broken_version": "v070700", "priority": "4", "subsystem": "", "assigned_to": "gthain", "derived_from": "#1831", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu, tstclair@redhat.com, psilord@cs.wisc.edu, tannenba@cs.wisc.edu, dan@hep.wisc.edu, tannenba@cs.wisc.edu, smoler@cs.wisc.edu", "due_date": ""}