{"id": 4889, "title": "Ticket #4889: WriteUserLog has poor user id hygiene", "description": "<blockquote>\nSome constructors for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WriteUserLog\" title=\"Write User Log\">WriteUserLog</a></span> accept a username argument, which is used to call init_user_ids(). This call is immediately preceded by a call to uninit_user_ids(). uninit_user_ids() isn't called anywhere else in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WriteUserLog\" title=\"Write User Log\">WriteUserLog</a></span>.\nThus, after a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WriteUserLog\" title=\"Write User Log\">WriteUserLog</a></span> object is deleted, the user uid is still set in the Condor privilege handling code. The next time the daemon wants to act as a different user, the call to init_user_ids() will result in this daemon log message:\n<div class=\"verbatim\">\n<pre>warning: setting UserUid to 11021, was 6004 previously</pre></div>\n\n\n<p>We see this error a lot in the schedd's log when it spawns a scheduler universe job or needs to access a job's files.\n\n</p><p>If the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WriteUserLog\" title=\"Write User Log\">WriteUserLog</a></span> calls init_user_ids(), then it should call uninit_user_ids() when it is deleted.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-14 13:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/eb1ef68870003d1816d2c348d122edb7097bd9d9\">[44604]</a></span>: minor edit of 8.3.5 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4889\" onclick=\"get_ticket_and_populate_wrapper('4889'); return false;\" title=\"WriteUserLog has poor user id hygiene\">#4889</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-14 10:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9b4bcf505c69796a3d73ff6061b1458402e89361\">[44596]</a></span>: Docs for removing <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserUid\" title=\"User Uid\">UserUid</a></span> change warning in schedd log. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4889\" onclick=\"get_ticket_and_populate_wrapper('4889'); return false;\" title=\"WriteUserLog has poor user id hygiene\">#4889</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-16 11:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3d327e674a7803296d11d4797c838ac569520209\">[43366]</a></span>: Practice better user id hygiene in the schedd. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4889\" onclick=\"get_ticket_and_populate_wrapper('4889'); return false;\" title=\"WriteUserLog has poor user id hygiene\">#4889</a></span> In abort_job_myself(), always call uninit_user_ids() after calling init_user_ids().  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-16 11:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ce5acef7d1aaeab62c813847a7f9d83f800e48d2\">[43365]</a></span>: Practice better user id hygiene in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WriteUserLog\" title=\"Write User Log\">WriteUserLog</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4889\" onclick=\"get_ticket_and_populate_wrapper('4889'); return false;\" title=\"WriteUserLog has poor user id hygiene\">#4889</a></span> When <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WriteUserLog\" title=\"Write User Log\">WriteUserLog</a></span> calls init_user_ids(), it should also call uninit_user_ids() when it is deleted. Otherwise, subsequent code in the daemon that wants to act as a different uesr will get a spurious error message in the log.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Apr-14 10:02", "status": "resolved", "created": "2015-Feb-16 11:46", "fixed_version": "2015-Feb-16 11:46", "broken_version": "v080000", "priority": "3", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}