{"id": 4337, "title": "Ticket #4337: VM universe does not report CPU and memory usage", "description": "<blockquote>\nIn the OSG VM universe test runs, we do not get information about job CPU or memory usage. This is true in the job log and in \"condor_history -l\" output.\n\n<p>Example job log output:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">005 (75487.000.000) 05/01 06:17:02 Job terminated.\n        (1) Normal termination (return value 0)\n                Usr 0 00:00:00, Sys 0 00:00:00  -  Run Remote Usage\n                Usr 0 00:00:00, Sys 0 00:00:00  -  Run Local Usage\n                Usr 0 00:00:00, Sys 0 00:00:00  -  Total Remote Usage\n                Usr 0 00:00:00, Sys 0 00:00:00  -  Total Local Usage\n        1703936  -  Run Bytes Sent By Job\n        983095  -  Run Bytes Received By Job\n        1703936  -  Total Bytes Sent By Job\n        983095  -  Total Bytes Received By Job\n        Partitionable Resources :    Usage  Request Allocated\n           Cpus                 :                 1         1\n           Disk (KB)            :  6293133  6291456  22376675\n           Memory (MB)          :              2048      2048\n...\n</pre></div>\n\n\n<p>Sample lines from the corresponding condor_history output:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">MemoryUsage = VM_Memory\nJobVMMemory = 2048\nRemoteSysCpu = 0.0\nLocalUserCpu = 0.0\nLocalSysCpu = 0.0\n</pre></div>\n\n\n<p>It would be nice to get CPU and memory usage reported, as with a normal job.</p></blockquote>", "remarks": "<blockquote>\n<em>2014-May-01 13:49:43 by tlmiller:</em> <br/>\n\nNB: These test runs use KVM.\n\n<p></p><hr/>\n<em>2014-May-01 14:27:01 by tlmiller:</em> <br/>\n\nNate Yehle writes:\n\n<p></p><div class=\"verbatim\">\n<pre>\nAll of my windows vm universe jobs look inefficient on sysview, I notice remoteusercpu shows 0 for them all.\n\na windows job running on the doit pool showing a load of 1, thus cpu is being used:\n\n\n[nyehle@condor0 ~]$ condor_q -run | grep INFO-MEM-055-W.ad.wisc.edu\n   7.3   nyehle          4/17 08:25   7+07:46:57 slot1@INFO-MEM-055-W.ad.wisc.edu\n\n\n[nyehle@condor0 ~]$ condor_q -l 7.3 | grep -i RemoteUserCpu\nRemoteUserCpu = 0.0\n[nyehle@condor0 ~]$ condor_status INFO-MEM-055-W.ad.wisc.edu\nName               OpSys      Arch   State     Activity LoadAv Mem  ActvtyTime\n\nslot1@INFO-MEM-055 WINDOWS    X86_64 Claimed   Busy      1.000 2032 0+14:24:41\nslot2@INFO-MEM-055 WINDOWS    X86_64 Unclaimed Idle      0.000 2032 0+00:07:15\nslot3@INFO-MEM-055 WINDOWS    X86_64 Unclaimed Idle      0.000 2032 0+00:09:12\nslot4@INFO-MEM-055 WINDOWS    X86_64 Unclaimed Idle      0.000 2032 0+00:10:58\n\n\nvs a linux jobs output from submit-3 showing the value correctly:\n\nnyehle@submit-3 ~ $ condor_q -l 1752819.0| grep -i RemoteUserCpu\nRemoteUserCpu = 2390.0\n\nIs this a htcondor bug?\n</pre></div>\n\n\n<p>NB: The last job is a vanilla universe job.\n\n</p><p></p><hr/>\n<em>2014-May-02 14:45:12 by tlmiller:</em> <br/>\n\nVMWare (at least vix with Player) doesn't report CPU usage for its VM.  Neither Jaime nor I like the idea of grovelling the process table to guess which process is the VM, so I'm just moving this ticket to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DocPending\" title=\"Doc Pending\">DocPending</a></span> -- we should note the limitation somewhere.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4338\" onclick=\"get_ticket_and_populate_wrapper('4338'); return false;\" title=\"Investigate reporting memory usage of VMs\">#4338</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nInvestigate reporting memory usage of VMs</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-May-20 10:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/36479231be185150c311f5cb5c4e8c6da2e32823\">[40184]</a></span>: minor 8.1.6 version history item edit <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4337\" onclick=\"get_ticket_and_populate_wrapper('4337'); return false;\" title=\"VM universe does not report CPU and memory usage\">#4337</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-May-02 15:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4b9090e5429a3092fd5c5a909191caf5a1888db1\">[40059]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4337\" onclick=\"get_ticket_and_populate_wrapper('4337'); return false;\" title=\"VM universe does not report CPU and memory usage\">#4337</a></span>) Update documentation to reflect incomplete fix.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-May-02 13:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/da230b0a046714ac676cd3bf1682cd09098b0f01\">[40057]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4337\" onclick=\"get_ticket_and_populate_wrapper('4337'); return false;\" title=\"VM universe does not report CPU and memory usage\">#4337</a></span>) Document.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-May-02 10:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/87760bc0b432f00e476c307163c3b36d5db79f2b\">[40046]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4337\" onclick=\"get_ticket_and_populate_wrapper('4337'); return false;\" title=\"VM universe does not report CPU and memory usage\">#4337</a></span>) The virtual machine universe now reports CPU usage for KVM.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-May-20 10:46", "status": "resolved", "created": "2014-May-01 12:40", "fixed_version": "2014-May-01 12:40", "broken_version": "v080106", "priority": "3", "subsystem": "VM", "assigned_to": "", "derived_from": "", "creator": "cat", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "cat@cs.wisc.edu, tlmiller@cs.wisc.edu, nyehle@cs.wisc.edu", "due_date": ""}