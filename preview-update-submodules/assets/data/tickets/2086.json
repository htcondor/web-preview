{"id": 2086, "title": "Ticket #2086: infinite recursion caused by recursive classad reference", "description": "<blockquote>\nIgor reports that the UCSD negotiator for the CMS glidein pool crashed repeatedly while computing significant attributes.  This appears to have been caused by a machine ad containing an attribute that referenced itself.\n\n<p>I have been able to reproduce the same behavior using the following configuration:\n\n</p><p></p><pre>    MyAttr = MyAttr\n    STARTD_ATTRS = MyAttr\n</pre>\n\n<p>The stack looks like this:\n\n</p><p></p><div class=\"verbatim\">\n<pre>(many more repetitions of the following)\n#65507 0x081613ff in classad::ClassAd::_GetExternalReferences (\n    this=0x11cbf8b8, expr=0x11cbf8b8, ad=0x11cbf8b8, state=@0xffffcc00,\n    refs=@0xffffcc70, fullNames=true)\n    at /home/condor/execute/dir_6972/userdir/src/classad/classad.cpp:995\n#65508 0x081613ff in classad::ClassAd::_GetExternalReferences (\n    this=0x11cbf8b8, expr=0x11cbf8b8, ad=0x11cbf8b8, state=@0xffffcc00,\n    refs=@0xffffcc70, fullNames=true)\n    at /home/condor/execute/dir_6972/userdir/src/classad/classad.cpp:995\n#65509 0x081613ff in classad::ClassAd::_GetExternalReferences (\n    this=0x11cbf8b8, expr=0x11cbf8b8, ad=0x11cbf8b8, state=@0xffffcc00,\n    refs=@0xffffcc70, fullNames=true)\n    at /home/condor/execute/dir_6972/userdir/src/classad/classad.cpp:995\n#65510 0x081613ff in classad::ClassAd::_GetExternalReferences (\n    this=0x11cbf8b8, expr=0x11cbf8b8, ad=0x11cbf8b8, state=@0xffffcc00,\n    refs=@0xffffcc70, fullNames=true)\n    at /home/condor/execute/dir_6972/userdir/src/classad/classad.cpp:995\n#65511 0x081612ae in classad::ClassAd::GetExternalReferences (this=0x11cbf8b8,\n    tree=0x11cc20a8, refs=@0xffffcc70, fullNames=true)\n    at /home/condor/execute/dir_6972/userdir/src/classad/classad.cpp:925\n#65512 0x0819f4bf in compat_classad::ClassAd::_GetReferences (this=0x11cbf8b8,\n    tree=0x11cc20a8, internal_refs=@0xffffcd90, external_refs=@0xffffcd70)\n    at /home/condor/execute/dir_6972/userdir/src/condor_utils/compat_classad.cpp:2167\n#65513 0x0819f1b2 in compat_classad::ClassAd::GetReferences (this=0x11cbf8b8,\n    attr=0xb473dc8 \"GLIDEIN_Max_Walltime\", internal_refs=@0xffffcd90,\n    external_refs=@0xffffcd70)\n    at /home/condor/execute/dir_6972/userdir/src/condor_utils/compat_classad.cpp:2105\n#65514 0x080f4777 in Matchmaker::compute_significant_attrs (this=0x11cc20bc,\n    startdAds=@0xffffcfb0)\n    at /home/condor/execute/dir_6972/userdir/src/condor_negotiator.V6/matchmaker.cpp:823\n#65515 0x080f4deb in Matchmaker::negotiationTime (this=0x845b5a0)\n    at /home/condor/execute/dir_6972/userdir/src/condor_negotiator.V6/matchmaker.cpp:1000\n#65516 0x0811eeec in TimerManager::Timeout (this=0x845b8e8)\n    at /home/condor/execute/dir_6972/userdir/src/condor_daemon_core.V6/timer_manager.cpp:413\n#65517 0x0810bdeb in DaemonCore::Driver (this=0x84aa3f8)\n    at /home/condor/execute/dir_6972/userdir/src/condor_daemon_core.V6/daemon_core.cpp:3123\n#65518 0x0811d7b4 in main (argc=1, argv=0xffffd7b4)\n    at /home/condor/execute/dir_6972/userdir/src/condor_daemon_core.V6/daemon_core_main.cpp:2373\n</pre></div>\n\n\n<p>The bug is likely much older than 7.5.6, which is the version in which we observed the problem.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-25 18:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e4cf6c9e23bacdb2e7f6555d587274f4b5353ce9\">[26023]</a></span>: Documented fix for negotiator crash when there are circular classad attribute references. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2086\" onclick=\"get_ticket_and_populate_wrapper('2086'); return false;\" title=\"infinite recursion caused by recursive classad reference\">#2086</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-25 17:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b84252dda2d29777ca5f577f8a2d33572b8519f5\">[21565]</a></span>: Fixed negotiator crash on slot ads containing circular attribute references. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2086\" onclick=\"get_ticket_and_populate_wrapper('2086'); return false;\" title=\"infinite recursion caused by recursive classad reference\">#2086</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Apr-25 18:07", "status": "resolved", "created": "2011-Apr-22 13:47", "fixed_version": "2011-Apr-22 13:47", "broken_version": "v070506", "priority": "1", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "dan@hep.wisc.edu,sfiligoi@fnal.gov", "due_date": ""}