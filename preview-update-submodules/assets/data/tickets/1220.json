{"id": 1220, "title": "Ticket #1220: wrong Insert() method called", "description": "<blockquote>\nIn the Accountant::ReportState(), there were calls to the classad Insert() function that failed at runtime when using the new classad compatibility interface:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">ad-&gt;Insert(tmp, false);\n</pre></div>\n\n\n<p>The second boolean argument was implicitly converted into NULL in a call to a totally different version of Insert:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">Insert( const std::string &amp;attrName, classad::ExprTree *expr );\n</pre></div>\n\n\n<p>The result is that condor_userprio saw an empty ad in response to its query to the negotiator for user priorities.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Feb-16 19:11:16 by danb:</em> <br/>\n\nI have added an Insert() method to the compatibility interface that should prevent more cases of the wrong Insert() method getting called with the old boolean argument form is used.  However, all uses of that method should be removed as they are found.  The function prints a warning and a stack trace to help track them down if there are any.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-18 13:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/74dd33e878867ff4d54b59ad5069bf5dd4797ad8\">[17277]</a></span>: Changed WARNING to ERROR in deprecated compat Insert() method. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1220\" onclick=\"get_ticket_and_populate_wrapper('1220'); return false;\" title=\"wrong Insert() method called\">#1220</a></span> We want to track down and eliminate all calls to this funcion. ERROR is convenient for red flagging in the test suite.  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-16 19:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2c9d8623662ce79e8580578130f1f3b567298309\">[17258]</a></span>: Got rid of use of Insert(char const *name,bool) in the negotiator. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1220\" onclick=\"get_ticket_and_populate_wrapper('1220'); return false;\" title=\"wrong Insert() method called\">#1220</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-16 19:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a69968b40fa5a3d841b3f126686c7479a02b9a31\">[17257]</a></span>: Added Insert(char const *expr,bool) to compatibility classad interface. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1220\" onclick=\"get_ticket_and_populate_wrapper('1220'); return false;\" title=\"wrong Insert() method called\">#1220</a></span> Without this, calls to this old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> function with the second argument set to false were getting converted into calls to Insert(char const *name,ExprTree *expr) with expr=NULL, which is totally wrong!\u00a0[...]\n (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Feb-16 19:11", "status": "resolved", "created": "2010-Feb-16 19:02", "fixed_version": "2010-Feb-16 19:02", "broken_version": "v070501", "priority": "4", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}