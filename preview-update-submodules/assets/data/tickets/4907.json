{"id": 4907, "title": "Ticket #4907: Accept ClassAd expression as constraints for the python bindings", "description": "<blockquote>\nThe constraint argument passed to the Schedd.query and Collector.query functions has been a wart on the API design - reflecting the HTCondor internals, it only accepts a string (which is internally parsed as a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> expression).\n\n<p>We should allow <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTree\" title=\"Expr Tree\">ExprTree</a></span> objects to be used directly; we should also accept simple casts (python 'True' to classad 'true').\n\n</p><p>To maintain backward compatibility, strings passed to as constraints should <strong>not</strong> be converted to a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> string value - instead, they should be parsed as a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> expression.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Feb-21 11:16:44 by bbockelm:</em> <br/>\n\nFor example, the following are broken:\n\n<p></p><div class=\"verbatim\">\n<pre>schedd.query(False)\nschedd.query(classad.ExprTree('Owner=?=\"osg\"'))\n</pre></div>\n\n\n<p>but this is acceptable:\n\n</p><p></p><div class=\"verbatim\">\n<pre>schedd.query(\"false\")\nschedd.query('Owner=?=\"osg\"')\n</pre></div>\n\n\n<p>Both mechanisms should be fine.\n\n</p><p></p><hr/>\n<em>2015-Feb-21 11:25:14 by bbockelm:</em> <br/>\n\nPushed fix, including version history.\n\n<p>No changes to the manual as the reference for these functions already claimed this worked!</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-24 11:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ac43b960831ebaf452594b1ddae65495425e6afd\">[43451]</a></span>: minor 8.3.4 version history item edit <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4907\" onclick=\"get_ticket_and_populate_wrapper('4907'); return false;\" title=\"Accept ClassAd expression as constraints for the python bindings\">#4907</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-21 11:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bf28246c8f2c4331ea5153dfa41383a8b77cc1e8\">[43431]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4907\" onclick=\"get_ticket_and_populate_wrapper('4907'); return false;\" title=\"Accept ClassAd expression as constraints for the python bindings\">#4907</a></span>.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-21 11:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9d5222a8081a4870a2b2360d8894530473244303\">[43430]</a></span>: Allow Collector.query to accept expressions. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4907\" onclick=\"get_ticket_and_populate_wrapper('4907'); return false;\" title=\"Accept ClassAd expression as constraints for the python bindings\">#4907</a></span> Similar to Schedd.query, the Collector's query method ought to accept arbitrary python objects - converting to classad expressions as possible. To allow for backward compatibility, if a string is given, then it is parsed as a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> expression.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-21 11:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/be32f10d17102d5e982dbed62da21ddd66d1da01\">[43429]</a></span>: Allow Schedd.query to accept <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTree\" title=\"Expr Tree\">ExprTree</a></span> inputs. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4907\" onclick=\"get_ticket_and_populate_wrapper('4907'); return false;\" title=\"Accept ClassAd expression as constraints for the python bindings\">#4907</a></span> A key oversight of the original API is that Schedd.query only accepted a query string (this reflected the HTCondor internals, where <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTree\" title=\"Expr Tree\">ExprTree</a></span> is not used for the query constraint).\u00a0[...]\n (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Jun-02 16:17", "status": "resolved", "created": "2015-Feb-21 11:15", "fixed_version": "2015-Feb-21 11:15", "broken_version": "", "priority": "4", "subsystem": "Tools", "assigned_to": "bbockelm", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bbockelm@cse.unl.edu", "due_date": ""}