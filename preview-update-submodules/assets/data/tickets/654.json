{"id": 654, "title": "Ticket #654: Improve ftp connection handling in nordugrid gahp", "description": "<blockquote>\nThe nordugrid gahp opens a new ftp connection for each command it receives and closes those connections after the one command is complete. This is both inefficient and easily overwhelms servers. One nordugrid server I tested against wouldn't accept more than 23 simultaneous gridftp control connections.\n\n<p>The gridftp connection handling needs to be improved as follows:\n</p><ul>\n<li>The gahp should limit itself to two gridftp sessions per server, one for file transfer and one for all other commands.\n</li><li>The gahp should reuse connections, ideally leaving connections open for several seconds waiting for new commands to use them.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2009-Aug-11 16:30:50 by jfrey:</em> <br/>\n\nI just pushed a partial fix for this ticket to the master branch (for Condor 7.3.2). It has these limitations:\n\n<p></p><ul>\n<li>One connection per server is used, rather than two.\n</li><li>If no additional commands are queued for a connection, the connection is closed immediately.\n</li></ul>\n\n<p></p><hr/>\n<em>2009-Dec-08 16:31:05 by jfrey:</em> <br/>\n\nResolving this ticket. Any further improvements to connection reuse for nordugrid_gahp should go into another ticket.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Aug-11 16:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/34785065f75371dba1e34bb2fc69af7ea6cbc5e2\">[24921]</a></span>: Add version history for gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=654\" onclick=\"get_ticket_and_populate_wrapper('654'); return false;\" title=\"Improve ftp connection handling in nordugrid gahp\">#654</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Aug-11 16:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/187b7ccadf5d41bd0afcd39bfa99ba7b7cbf259c\">[15305]</a></span>: Improve ftp connection handling in nordugrid_gahp (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=654\" onclick=\"get_ticket_and_populate_wrapper('654'); return false;\" title=\"Improve ftp connection handling in nordugrid gahp\">#654</a></span>) Now, one connection to each server is used. Additional commands are queued. Each connection will be reused if additional commands are queued. If no commands are queued, the connection is closed immediately.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2009-Dec-08 16:31", "status": "resolved", "created": "2009-Aug-04 14:11", "fixed_version": "2009-Aug-04 14:11", "broken_version": "v070300", "priority": "4", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}