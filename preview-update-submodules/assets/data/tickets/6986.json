{"id": 6986, "title": "Ticket #6986: Vanilla-universe ckpt restarts nest extra condor_pid_ns_init calls", "description": "<blockquote>\nDuncan Brown wrote to condor-users:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">I think this one is definitely a bug. I have USE_PID_NAMESPACES = True and\nevery time the starter restarts a user process after a checkpoint, it adds\nanother invocation of condor_pid_ns_init:\n\nFirst time:\n\n04/03/19 23:01:53 (pid:10486) Using wrapper /etc/condor/sugwg-job-wrapper.sh to exec\n/usr/libexec/condor/condor_pid_ns_init\n/home/daniel.finstad/opt/pisn/bin/pycbc_inference --processing-scheme cpu --nprocesses 24 --fake-strain-from-file\n[...]\n04/04/19 03:00:03 (pid:10486) Using wrapper /etc/condor/sugwg-job-wrapper.sh to exec\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/home/daniel.finstad/opt/pisn/bin/pycbc_inference --processing-scheme cpu --nprocesses 24 --fake-strain-from-file\n[...]\n04/10/19 07:42:55 (pid:10486) Using wrapper /etc/condor/sugwg-job-wrapper.sh\nto exec /usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n/usr/libexec/condor/condor_pid_ns_init\n[...]\n</pre></div>\n\n\n<p>Without looking at the code, I'm betting we prepend condor_pid_ns_init to the command every time we start a process; the fix may be as simple as not storing the result.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Apr-11 15:11:11 by tannenba:</em> <br/>\n\nPushed a fix for this in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4811bd1d6f76777d09f12e6ba3105a9894077a2c\">[56577]</a></span> but we should check for other\nre-enter problems with calling StartJob() repeatedly.\n\n<p></p><hr/>\n<em>2019-Apr-12 08:55:28 by gthain:</em> <br/>\n\n<strong>CODE REVIEW</strong>  Coded reviewed and tested, fix works fine. USER_JOB_WRAPPER is not an issue, that happens elsewhere.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-12 08:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a1adfa49efb9572f7b2f587a9a0b683ed88ecf91\">[56590]</a></span>: Add version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6986\" onclick=\"get_ticket_and_populate_wrapper('6986'); return false;\" title=\"Vanilla-universe ckpt restarts nest extra condor_pid_ns_init calls\">#6986</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-11 15:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4811bd1d6f76777d09f12e6ba3105a9894077a2c\">[56577]</a></span>: Fix bug with vanilla ckpt restarts and nested condor_pid_ns_init. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6986\" onclick=\"get_ticket_and_populate_wrapper('6986'); return false;\" title=\"Vanilla-universe ckpt restarts nest extra condor_pid_ns_init calls\">#6986</a></span>  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Apr-12 10:00", "status": "resolved", "created": "2019-Apr-10 11:28", "fixed_version": "2019-Apr-10 11:28", "broken_version": "v080803", "priority": "3", "subsystem": "DaemonsExecNode", "assigned_to": "tannenba", "derived_from": "#4968", "creator": "tlmiller", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "gthain@cs.wisc.edu, tlmiller@cs.wisc.edu", "due_date": ""}