{"id": 3208, "title": "Ticket #3208: File transfer with older starters can put stdout/err in wrong location", "description": "<blockquote>\nWhen a new shadow talks with an old starter (pre/post 7.7.2), file transfer is being used, and the job's stdout and stderr contain any path information, the shadow needs to rename the files in the ad sent to the starter and add remaps to their real destinations. Otherwise, the files will end up in the IWD.\n\n<p>In some situations, the shadow doesn't know what version the starter is at the point it needs to do the renames. This can happen if security negotiation is disabled or <code>SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION</code> is set to <code>True</code>. GlideinWMS is running into this situation.\n\n</p><p>The best fix we can do without a significant protocol change is to have the shadow always perform the stdout/err renames when it doesn't know the starter's version and it does know that file transfer will be used. This won't affect new starters.\n\n</p><p>There is still the possibility for stdout/err to be written to incorrect locations when ShouldTransferFiles=\"IF_NEEDED\" with a new shadow and old starter. There's no simple fix for this, as the shadow needs to know when sending the job ad to the starter whether file transfer will be used. The starter makes that decision after the shadow sends the job ad. If the shadow had the slot ad, it could figure out what the starter would decide. But this is a corner case that doesn't warrant a protocol change in a stable series.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Aug-24 17:31:06 by danb:</em> <br/>\n\nCode Review: This patch looks okay to me.  It is too bad that it doesn't work with the default file transfer mode IF_NEEDED.  The workaround is for the user to use file transfer mode YES.\n\n<p></p><hr/>\n<em>2012-Sep-06 18:20:52 by sfiligoi:</em> <br/>\n\nToo bad\n<div class=\"code\">\n<pre class=\"code\">ShouldTransferFiles=\"IF_NEEDED\"\n</pre></div>\n\nis the default.\n\n<p>So a lot of users are likely to be hit by this.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-28 11:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ffaa24ad934a67513ce9c80d242d2781e0970559\">[33192]</a></span>: minor edit to version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3208\" onclick=\"get_ticket_and_populate_wrapper('3208'); return false;\" title=\"File transfer with older starters can put stdout/err in wrong location\">#3208</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-23 14:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2ecd896750a201412ffe753a357f0943c1c22be1\">[33140]</a></span>: File transfer with older starters can put stdout/err in wrong location <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3208\" onclick=\"get_ticket_and_populate_wrapper('3208'); return false;\" title=\"File transfer with older starters can put stdout/err in wrong location\">#3208</a></span> When the shadow doesn't know the version of the starter but does know that file transfer will be used, it should rename stdout/err. Otherwise, these files always end up in the job's Iwd.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Sep-06 18:20", "status": "resolved", "created": "2012-Aug-23 14:43", "fixed_version": "2012-Aug-23 14:43", "broken_version": "v070702", "priority": "4", "subsystem": "Daemons", "assigned_to": "jfrey", "derived_from": "#1811", "creator": "jfrey", "rust": "s8208", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}