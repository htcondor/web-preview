{"id": 1888, "title": "Ticket #1888: 'make package' of PACKAGE_BUILD broken when PROPER also set", "description": "<blockquote>\nWhen a cmake-enabled Condor build is configured with PROPER enabled, 'make package' fails:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">make[1]: Nothing to be done for `preinstall'.\nmake[1]: Leaving directory `/local/nick/condor/trunk/build'\nRun CPack packaging tool...\n/usr/bin/cpack --config ./CPackConfig.cmake\nCPack: Create package using RPM\nCPack: Install projects\nCPack: - Run preinstall target for: CONDOR\nCPack: - Install project: CONDOR\nCPack: Create package\nUsing patched version of CPackRPM.cmake-2.8.0 located in build/cmake\nCPackRPM:Debug: rpmbuild version is &lt;4.8.0&gt;\nCPackRPM: Will use user specified spec file: /local/nick/condor/trunk/build/build/packaging/rpm/condor.spec.in\nCPackRPM:Debug: You may consult rpmbuild logs in:\nCPackRPM:Debug:    - /local/nick/condor/trunk/build/_CPack_Packages/LINUX-X86_64/RPM/rpmbuild.err\nCPackRPM:Debug:    - /local/nick/condor/trunk/build/_CPack_Packages/LINUX-X86_64/RPM/rpmbuild.out\nCPack Error: Problem copying the package: /local/nick/condor/trunk/build/_CPack_Packages/LINUX-X86_64/RPM/condor-7.5.6-1.opensuse11.3.x86_64.rpm to /local/nick/condor/trunk/build/condor-7.5.6-1.opensuse11.3.x86_64.rpm\nCPack Error: Error when generating package: condor\nmake: *** [package] Error 1\n</pre></div>\n\n\n<p>The error file reveals that the usr/include/condor directory is not being created or populated:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">$ cat /local/nick/condor/trunk/build/_CPack_Packages/LINUX-X86_64/RPM/rpmbuild.err\nerror: File not found: /local/nick/condor/trunk/build/_CPack_Packages/LINUX-X86_64/RPM/condor-7.5.6-1.opensuse11.3.x86_64/usr/include/condor\nerror: File not found: /local/nick/condor/trunk/build/_CPack_Packages/LINUX-X86_64/RPM/condor-7.5.6-1.opensuse11.3.x86_64/usr/lib/condor\n    File not found: /local/nick/condor/trunk/build/_CPack_Packages/LINUX-X86_64/RPM/condor-7.5.6-1.opensuse11.3.x86_64/usr/include/condor\n    File not found: /local/nick/condor/trunk/build/_CPack_Packages/LINUX-X86_64/RPM/condor-7.5.6-1.opensuse11.3.x86_64/usr/lib/condor\n</pre></div>\n\n\n<p> I see the following in src/condor_utils/CMakeList.txt that is probably relevant:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">if (NOT PROPER)\n        install (FILES MyString.h\n                         condor_event.h\n                         condor_holdcodes.h\n                         read_user_log.h\n                         user_log.c++.h\n                         user_log.README\n                         write_user_log.h\n                         compat_classad.h\n                         compat_classad_list.h\n                         compat_classad_util.h\n                         stl_string_utils.h\n                        DESTINATION ${C_INCLUDE})\n\n        install ( TARGETS condorapi DESTINATION ${C_LIB} )\nendif(NOT PROPER)\n</pre></div>\n\n\n<p>I tried disabling the <code>if(NOT PROPER)</code> test -- it solved the immediate problem, but I suspect that the test is there a reason.  Even with the above check disabled, however, it then fails similary:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">$ cat /local/nick/condor/trunk/build/_CPack_Packages/LINUX-X86_64/RPM/rpmbuild.err\nerror: File not found: /local/nick/condor/trunk/build/_CPack_Packages/LINUX-X86_64/RPM/condor-7.5.6-1.opensuse11.3.x86_64/usr/lib/condor\n    File not found: /local/nick/condor/trunk/build/_CPack_Packages/LINUX-X86_64/RPM/condor-7.5.6-1.opensuse11.3.x86_64/usr/lib/condor\n</pre></div>\n\n\n<p>I see that <code>usr/lib64/condor</code> was created &amp; populated properly, but the rpm appears to be looking for <code>usr/lib/condor</code>...\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">$ ls _CPack_Packages/LINUX-X86_64/RPM/condor-7.5.6-1.opensuse11.3.x86_64/usr/lib\nls: cannot access _CPack_Packages/LINUX-X86_64/RPM/condor-7.5.6-1.opensuse11.3.x86_64/usr/lib: No such file or directory\n$ ls _CPack_Packages/LINUX-X86_64/RPM/condor-7.5.6-1.opensuse11.3.x86_64/usr/\nbin/     include/ lib64/   libexec/ sbin/    share/   src/\n$ ls _CPack_Packages/LINUX-X86_64/RPM/condor-7.5.6-1.opensuse11.3.x86_64/usr/lib64/\ncondor\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Jan-31 08:32:07 by tstclair:</em> <br/>\n\nI've switched flags to allow the inclusion of such elements during a PROPER compilation.  Thawan will need to verify the rest.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-28 17:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/44422a189d86987538d173c435f0c7120a811416\">[20793]</a></span>: Fix several problems with the blahp files in the release. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1935\" onclick=\"get_ticket_and_populate_wrapper('1935'); return false;\" title=\"Fix blahp installation\">#1935</a></span> * Restore execute bits on blahp binaries (broken in conversion to cmake in 7.5.5). * Restore NQS scripts, lost by commit for <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=1888\" onclick=\"get_ticket_and_populate_wrapper('1888'); return false;\" title=\"'make package' of PACKAGE_BUILD broken when PROPER also set\">#1888</a></span> (never released). * Move glite directory from lib to libexec.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jan-31 08:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/83bd1bd363908181673563e27227a6f384c9edeb\">[20186]</a></span>: Ticket <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=1888\" onclick=\"get_ticket_and_populate_wrapper('1888'); return false;\" title=\"'make package' of PACKAGE_BUILD broken when PROPER also set\">#1888</a></span>: switch flags used to install HEADERS, however Thawan will need to verify PROPER rpms.  (By Timothy St. Clair )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Jan-31 08:33", "status": "review", "created": "2011-Jan-30 00:23", "fixed_version": "2011-Jan-30 00:23", "broken_version": "v070506", "priority": "3", "subsystem": "Packaging", "assigned_to": "kooburat", "derived_from": "", "creator": "nleroy", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}