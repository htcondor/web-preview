{"id": 72, "title": "Ticket #72: Some schedd invocations never evaluate periodic expressions", "description": "<blockquote>\nIf the schedd's initialization takes longer than PERIODIC_EXPR_INTERVAL, the Timeslice code for periodic expression evaluation will return a negative number for the delay until the first call. This is passed to Register_Timer(), which takes an unsigned int, resulting in the callout never occurring.\n\n<p>This bug shows up in the test suite as the job_core_perremove_sched test occasionally failing.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Jan-22 11:17:02 by matt:</em> <br/>\n\nShould getTimeToNextRun return 0 if the time is negative? Saves duplicate min(time, 0) checks, and what does it really mean that the time to the next run is negative? Is it used anywhere to say the time was missed in a log message?\n\n<p></p><hr/>\n<em>2009-Feb-09 13:13:11 by danb:</em> <br/>\n\nOne of the lines in patch <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b6bc2c4be0e351452a1e819a4fe5f7dece02338b\">[13548]</a></span> has a greater than sign instead of a less than sign.  This has the unintended effect of causing the schedd to call its timeout() function every 5 seconds.  This is a blocker for 7.2.1.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-09 15:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8554048e173075a90bd8b9f63c32f9126cfb1272\">[13784]</a></span>: Fixed problem with patch for negative getTimeToNextRun(). One of the checks intended to test for delta &lt; 0 was checking for delta &gt; 0, so the schedd was scheduling its timeout() function every 5 seconds. Now getTimeToNextRun() automatically truncates its return to 0 if the delta is negative. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=72\" onclick=\"get_ticket_and_populate_wrapper('72'); return false;\" title=\"Some schedd invocations never evaluate periodic expressions\">#72</a></span>)  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-22 12:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7989730017e0b95dca9f2216702de2ceebfefe5b\">[24553]</a></span>: Document schedd periodic expression fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=72\" onclick=\"get_ticket_and_populate_wrapper('72'); return false;\" title=\"Some schedd invocations never evaluate periodic expressions\">#72</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-22 11:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b6bc2c4be0e351452a1e819a4fe5f7dece02338b\">[13548]</a></span>: Fix bug that can cause schedd to never evaluate periodic expressions gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=72\" onclick=\"get_ticket_and_populate_wrapper('72'); return false;\" title=\"Some schedd invocations never evaluate periodic expressions\">#72</a></span>  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-31 13:40", "status": "resolved", "created": "2009-Jan-22 10:57", "fixed_version": "2009-Jan-22 10:57", "broken_version": "v070200", "priority": "4", "subsystem": "Daemons", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}