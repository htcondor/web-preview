{"id": 1131, "title": "Ticket #1131: mixing authenticated and unauthenticated users problematic", "description": "<blockquote>\nThere are two issues with policies that deal with a mix of authenticated and unauthenticated users:\n\n<p></p><ol>\n<li>Currently, if security negotiation determines that authentication will happen, then failure to authenticate causes rejection of the connection, even if neither side required authentication.  The use of the ANONYMOUS authentication method can mostly overcome this problem, but the current implementation of this method is not safe to use (i.e. it is less safe than not authenticating).\n\n<p></p></li><li>Unauthenticated users are not mapped to a name, so the only way to refer to them in the allow/deny list is with a *, which also matches all authenticated users.\n</li></ol>\n\n<p>Cases where these issues have caused problems:\n\n</p><p></p><ul>\n<li>It is not possible to have a policy that allows both unauthenticated administrative access from the central manager and authenticated administrative access from the local host.\n\n<p></p></li><li>Authentication methods such as FS which are not mutual result in the server remaining unauthenticated from the client's point of view.  This has resulted in the inability to use ALLOW/DENY_CLIENT to achieve a desired policy, because there is no way to refer explicitly to the unauthenticated servers vs. servers that were authenticated.\n\n<p></p></li><li>Finally, it is simply confusing and unexpected that a policy that says authentication is optional will reject connections that fail to authenticate.\n</li></ul>\n\n<p>Zach and I (Dan) talked about possible solutions.  The one we think is worth pursuing is this:\n\n</p><p></p><ol>\n<li>if authentication was not required by both parties, then allow connections to proceed even if authentication fails.\n\n<p></p></li><li>assign a name to all unauthenticated connections. Currently we are thinking it will be unauthenticated@unmmappeduser.  This includes assigning a name to the unauthenticated side of an asymmetric authentication method such as FS.\n\n<p></p></li><li>commands that require authentication (such as submitting a job) should automatically disallow the unauthenticated user, or for that matter, all unmapped users.  This addresses an unintended \"feature\" in the current implementation where authenticated users who were not mapped can submit jobs as gsi@unmappeduser or ssl@unmappeduser or whatever.  The special unmappeduser domain would be rejected in all cases where the requirement of authentication is currently hard-coded.</li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Jan-22 11:08:33 by danb:</em> <br/>\n\nI personally find \"unmappeduser\" ugly and would prefer to replace it with \"anonymous\".\n\n<p></p><hr/>\n<em>2010-Jan-26 12:55:10 by danb:</em> <br/>\n\nI have attached a patch that implements unauthenticated@unmappeduser plus the other changes outlined in this ticket.  I would like to get it reviewed and I would like to finalize the name of the unauthenticated user before committing.\n\n<p></p><hr/>\n<em>2010-Mar-30 13:49:58 by danb:</em> <br/>\n\nZach and I talked.  We agreed that \"unmappeduser\" should be changed to \"unmapped\".  So unauthenticated people will appear as \"unauthenticated@unmapped\".  Someone authenticated via GSI but not found in the map file will appear as \"gsi@unmapped\".</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1809\" onclick=\"get_ticket_and_populate_wrapper('1809'); return false;\" title=\"AuthMethods contains garbage characters\">#1809</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\n<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AuthMethods\" title=\"Auth Methods\">AuthMethods</a></span> contains garbage characters</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Apr-09 14:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/504dab1d9c47faec1ba4b1c060dfb2311e54f939\">[25414]</a></span>: Documented unauthenticated@unmapped change. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1131\" onclick=\"get_ticket_and_populate_wrapper('1131'); return false;\" title=\"mixing authenticated and unauthenticated users problematic\">#1131</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-30 14:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/00d31c80b29e375f99a5da4ca2dd399674c7f342\">[17768]</a></span>: Always have a name to represent unauthenticated users. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1131\" onclick=\"get_ticket_and_populate_wrapper('1131'); return false;\" title=\"mixing authenticated and unauthenticated users problematic\">#1131</a></span> The name is unauthenticated@unmapped. This makes it possible to refer explicitly to unauthenticated users in the authorization policy.\u00a0[...]\n (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Feb-08 15:20", "status": "resolved", "created": "2010-Jan-22 10:57", "fixed_version": "2010-Jan-22 10:57", "broken_version": "v070000", "priority": "4", "subsystem": "Security", "assigned_to": "zmiller", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "other", "visibility": "public", "notify": "zmiller@cs.wisc.edu", "due_date": "20100503"}