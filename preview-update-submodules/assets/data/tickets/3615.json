{"id": 3615, "title": "Ticket #3615: Short condor_userprio", "description": "<blockquote>\n<strong class=\"three\">Getting Services During Negotiation Cycle</strong>\n\n<p><strong>job_services_during_neg_cycle</strong>\n\n</p><p>condor_userprio used to wait for the end of a negotion cycle making it very long to wait for. The test uses Check::CondorLog::RunCheckMultiple to find new start and end negotiator cycle markers and it also count and looks for things between markers.\n\n</p><p>The test first waits for the next start cycle and then does 51 condor_userprios.\n\n</p><p>After that, it waits for the next end cycle marker and verifies this is the\none which ends the cycle we did the commands in. Next it verifies there are 51 GET_PRIOs and no reconfigs(this one is supposed to wait till cycle ends.\n\n</p><p>The final test is securing another cycle and doing a few more condor_userprios to bracket a condor_off -fast -daemon negotiator. It looks to make sure it does not happen after the cycle ends. This makes the test fail for now.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Feb-25 13:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/70b8b8d2ff684e4b90577e78ac04d3e457e917c1\">[39464]</a></span>: At least some of our failures were due to log rotations. Stuck looking for the start of the negotiation cycle in the old log file. Tripled the negotiator log size <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Oct-31 13:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a304025b7add6641054fc010dc2be05618461324\">[38058]</a></span>: Timeout still too short on some platforms <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Oct-28 12:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9017780aca959d458047b7b9e2bdc78181a20ac1\">[37995]</a></span>: Timeout too low so bumped it. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Oct-25 13:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3bc121131d02c6f61b1bb09a394e983024c85df1\">[37985]</a></span>: Doubled the timeout on the log searches for slow machines <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Oct-23 14:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d87826412e006352140e0fc3f8c983e5bf3dce5a\">[37979]</a></span>: This is a big set of changes involving a number of issues. In the test job_services_during_neg_cycle we were saying that when we requested the next end of the negotiation cycle, it should be the same as the end cycle as the begin cycle we were matching next. Ain't so. Changes relative to the test showed\u00a0[...]\n (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-24 16:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a05b761962a5f7b4e72c4cf1a6c0c83515a52836\">[35868]</a></span>: After fixing the personal condor local config writing order the first test job never ran because the tests START = False finally took effect. So I removed this job so the other jobs would never run. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-23 15:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1106e087316836a68da3fc7e9f32e0ca53f0e6a3\">[35864]</a></span>: Lessen the condor_userprio calls from 50 to 5 <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-22 08:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3065a52ab0e66a8716d254a928daf317dda71b7c\">[35813]</a></span>: Resolve syntax issues <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-21 13:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b9b8baafc4148be046703c51f2d276c2b8cacba5\">[35808]</a></span>: Be verbose about the searches we are perfoming and test for failures due to hitting the retry limit. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-21 13:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3c92c02cbd15042de5b240a1bd7df66789ccd3ea\">[35807]</a></span>: In function <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SearchCondorLogMultiple\" title=\"Search Condor Log Multiple\">SearchCondorLogMultiple</a></span> if we hit the retry limit we return the string \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=HitRetryLimit\" title=\"Hit Retry Limit\">HitRetryLimit</a></span>\" so our tests can check for failures we do not expect to make the test more consistant <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-20 14:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fc86ae183d44c2034234f483a6447f2f07b28924\">[35767]</a></span>: disable condor_off -fast part of job_services_during_neg_cycle.run for now <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span> we don't actually have code to make the negotiator respond to condor_off while negotiating.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-17 12:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cf1c67af0de4f6a2394190e83349015886e4a722\">[35751]</a></span>: Test tuning. Cut back to 10000 jobs from 30000 and changed serach timeout to 80 checks from 45. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-17 11:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8ac243dbb46c0a6c9cf78a42ab34cc066e14dafa\">[35749]</a></span>: Turn back on the printing of a log being search and PASS/FAIL status and args in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RunCheck\" title=\"Run Check\">RunCheck</a></span> functions. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-17 11:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/96c95fe26cdb6b4181167a3617eeac1f5894bb2c\">[35748]</a></span>: New negoiator and services handling test which fails on condor_off -fast -daemon negotiator if it fails to take effect even within a negotiation cycle. Also works hard to verify condor_userprios will be serviced within a negotiation cycle <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-17 09:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6c0f25204730e15c4439812446de0e42fe735da0\">[35747]</a></span>: Override the built in subment event response. This lets us count submitted jobs and when we hit the limit we test things in the negotiator <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-16 09:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/47773e4cfa30c460757edf52e89164bd8613981c\">[35745]</a></span>: Changed a couple comments, a print message on something good happening and removed duplicate on_submit function which may have been my failure cause. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-15 16:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2baef9cf3285301455d63a4be8a473ca17c84475\">[35742]</a></span>: Last check is to verify that the GOT sigquit from the condor_off -fast does not happen after the final finish negotiator cycle message <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-15 16:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/763506379a1fcb9f9bdb022e5f08249a773e96e0\">[35741]</a></span>: Quiet down module messages on seen events by changing their debug level from 1 to 2. Was very distracting in <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-15 12:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/40662e218ccbe6459271a6555abc6130345d1920\">[35739]</a></span>: Add new cmd testing within a negotiator cycle and add it to the testing list.a <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-15 12:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1186e3dab35eecb56cf8d4bd9064a639c9dbc2eb\">[35737]</a></span>: Set two new patterns for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SearchCondorLogMultiple\" title=\"Search Condor Log Multiple\">SearchCondorLogMultiple</a></span> and and pass along a callback if it exists. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3615\" onclick=\"get_ticket_and_populate_wrapper('3615'); return false;\" title=\"Short condor_userprio\">#3615</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-15 12:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b5f9918b6d508ff715df8fc82d2de25373e92180\">[35736]</a></span>: Expanded <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SearchCondorLogMultiple\" title=\"Search Condor Log Multiple\">SearchCondorLogMultiple</a></span> to not only be able to find the first pattern after an initial search, but it can find and count a third pattern between two patterns. See comment above funtion. This function also accepts a callback for a first match. For inbetween searches it returns the count. Heavily\u00a0[...]\n (By Bill Taylor )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Aug-06 12:36", "status": "resolved", "created": "2013-May-10 16:02", "fixed_version": "2013-May-10 16:02", "broken_version": "", "priority": "4", "subsystem": "Tests", "assigned_to": "bt", "derived_from": "#3594", "creator": "bt", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "johnkn@cs.wisc.edu", "due_date": ""}