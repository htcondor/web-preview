{"id": 6954, "title": "Ticket #6954: add regression tests for submit utils.", "description": "<blockquote>\nAdd a test that sends a variety of submit files / dictionaries to submit_utils and verifies the cluster and proc ads that are generated as a result.\n\n<p>In support of this test. A hidden argument will be added to the -dry-run option of condor_submit so that the cluster id used for the dry run can be specified.\n</p><div class=\"code\">\n<pre class=\"code\">condor_submit -dry-run:cluster=&lt;id&gt; &lt;ads-file&gt; &lt;submit-file&gt;</pre></div>\n\nwill read from <code>&lt;submit-file&gt;</code> and generate cluster and proc ads and write them into <code>&lt;ads-file&gt;</code> using cluster id <code>&lt;id&gt;</code>.  In this mode of operation condor_submit will assume the schedd is the same version as condor_submit, so that the test can be run without starting up a personal condor.\n\n<p>A new perl test called <code>cmd_submit_regress_dry</code> will be written to make use of this option.  It will use a collection of submit files specified by <code>cmd_submit_regress_dry.subs</code> and verify the ads using information in <code>cmd_submit_regress_dry.expect</code>.\n\n</p><p>A similar python script will use these same files to test submit_utils through the python bindings.\n\n</p><p>This is intended to be a regression test, so that in the future changes/additions to the submit language, late materialization, and/or refactoring of submit_utils can be verified without a lot of new testing effort.\n\n</p><p>If possible, in the future we will compare the output of stable and development branches to insure that we don't break anything as we add new features.\n\n</p><p>Another new hidden argument will be added to condor_submit to support late materialization testing. </p><div class=\"code\">\n<pre class=\"code\">-digest &lt;digest-file&gt;</pre></div>\n will cause the submit digest to be written to <code>&lt;digest-file&gt;</code> in addition to being sent to the schedd.  When used with -dry-run  then the digest file will <strong>only</strong> be written to the file, and not sent to the schedd.  This argument could be made public if users request it, but the RCFs have indicated that so far no-one has indicated an interest.</blockquote>", "remarks": "<blockquote>\n<em>2019-Apr-09 12:54:37 by tim:</em> <br/>\n\n<strong>CODE REVIEW:</strong> Looks good</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Mar-13 11:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7f860fd3407834d19dc8488e361bcbaae51e7213\">[56342]</a></span>: Add new regression test for submit_utils <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6954\" onclick=\"get_ticket_and_populate_wrapper('6954'); return false;\" title=\"add regression tests for submit utils.\">#6954</a></span>. this change also adds a hidden option to condor_submit -dry-run to allow the cluster id to be specified a hidden option to condor_submit to request that the late materialization submit digest be echoed to a local file. ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Apr-09 14:11", "status": "resolved", "created": "2019-Mar-13 11:12", "fixed_version": "2019-Mar-13 11:12", "broken_version": "", "priority": "4", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}