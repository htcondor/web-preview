{"id": 2537, "title": "Ticket #2537: Procd / Master crash on MacOS in batlabs", "description": "<blockquote>\nFor the longest time, the mac machine in old batlab would stop running jobs, roughly once a week.  We now see the problem in the new batlab.\n\n<p>The master crashes with the following stack trace (c++filt doesn't seem to help)\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">Stack dump for process 47277 at timestamp 1318209859 (11 frames)\n0   condor_master                       0x00000001000e79d4 dprintf_dump_stack + 100^@\n1   condor_master                       0x00000001000e8627 _ZL21sig_backtrace_handleri + 23^@\n2   libsystem_c.dylib                   0x00007fff919e8cfa _sigtramp + 26^@\n3   ???                                 0x0000000000000b43 0x0 + 2883^@\n4   condor_master                       0x0000000100068eb5 _ZN7ProcAPI17buildProcInfoListEv + 69^@\n5   condor_master                       0x000000010006a5d7 _ZN7ProcAPI12getPidFamilyEiP10PidEnvID_sR8ExtArrayIiERi + 39^@\n6   condor_master                       0x0000000100102c46 _ZN10KillFamily12takesnapshotEv + 2326^@\n7   condor_master                       0x0000000100057885 _ZN12TimerManager7TimeoutEPi + 405\n^@\n8   condor_master                       0x000000010003f11b _ZN10DaemonCore6DriverEv + 1147^@\n9   condor_master                       0x000000010005065c main + 4844^@\n10  condor_master                       0x0000000100020bc8 start + 52^@\n10/09/11 20:24:20 Setting maximum accepts per cycle 8.\n</pre></div>\n\n\n<p>Every time a job tries to start up, the starter fails with:\n</p><div class=\"code\">\n<pre class=\"code\">10/10/11 16:57:53 error opening watchdog pipe /var/log/condor/procd_pipe.STARTD.watchdog: No s\nuch file or directory (2)\n10/10/11 16:57:53 ProcFamilyClient: error initializing LocalClient\n10/10/11 16:57:53 ProcFamilyProxy: error initializing ProcFamilyClient\n10/10/11 16:57:53 ERROR \"ProcD has failed\" at line 587 in file /Users/condor/execute/dir_9848/\nuserdir/src/condor_utils/proc_family_proxy.cpp\n10/10/11 16:57:53 ShutdownFast all jobs.\n10/10/11 16:57:53 condor_read() failed: recv(fd=7) returned -1, errno = 54 Connection reset by peer, reading 5 bytes from &lt;128.104.100.28:9452&gt;.\n10/10/11 16:57:53 IO: Failed to read packet header\n</pre></div>\n\n\n<p>Indeed, the watchdog pipe isn't there, but the procd process itself is running.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Oct-27 14:40:52 by jfrey:</em> <br/>\n\nSome additional investigation:\n\n<p>When the master crashes, it's restarted almost immediately by the launchd. The procd is restarted shortly thereafter. The procd has the missing watchdog pipe open, so it must have been unlinked after the procd was started.\n\n</p><p>When the procd starts, it unlinks the watchdog pipe filename, then recreates it, then opens both ends. On shutdown, it unlinks the filename. So if the old procd stayed alive until after the new one was started, it would have taken out the new procd's pipe when it finally exited.\n\n</p><p></p><hr/>\n<em>2013-May-23 11:43:56 by jfrey:</em> <br/>\n\nThe cause of this problem has been diagnosed and fixed (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3617\" onclick=\"get_ticket_and_populate_wrapper('3617'); return false;\" title=\"Gathering pid list on mac os x and bsd can cause crashes\">#3617</a></span>).</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "incident", "last_change": "2014-Aug-04 11:41", "status": "resolved", "created": "2011-Oct-10 17:03", "fixed_version": "2011-Oct-10 17:03", "broken_version": "v070700", "priority": "3", "subsystem": "", "assigned_to": "psilord", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "", "due_date": ""}