{"id": 7130, "title": "Ticket #7130: User requirements from submit file should get their own job attribute", "description": "<blockquote>\nWhen the user specifies <code>Requirements</code> in their submit file, this is merged with the automatically generated requirements that submit_utils detects and the result is written to the job as the singular <code>Requirements</code> attribute.\n\n<p>This complicates submit transforms, and also can lead to incorrect behavior for late materialization when user requirements contains $() expansions. (because not all of the context of submit is still available at materialization time)\n\n</p><p>To fix this, and to make things cleaner going forward, we should put the user specified requirements into a new job attribute, and reference that attribute in the generated Requirements expression.\n\n</p><p>So for instance, if the user specifies\n\n</p><p></p><div class=\"snip\">\n<pre class=\"sniplabel\">submit fragment</pre>\n<pre class=\"snip\">Requirements = OpSysAndVer == 6\n</pre></div>\n\nThe resulting job classad will be\n<div class=\"snip\">\n<pre class=\"sniplabel\">job classad fragment</pre>\n<pre class=\"snip\">SpecialRequirements = OpSysAndVer == 6\nRequirements = SpecialRequirements &amp;&amp; (TARGET.Arch == \"X86_64\") &amp;&amp; (TARGET.OpSys == \"LINUX\") &amp;&amp; (TARGET.Disk &gt;= RequestDisk) &amp;&amp; (TARGET.Memory &gt;= RequestMemory) &amp;&amp; (TARGET.HasFileTransfer &amp;&amp; stringListIMember(\"http\",TARGET.HasFileTransferPluginMethods))\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2019-Jun-26 15:34:51 by johnkn:</em> <br/>\n\nsee <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7129\" onclick=\"get_ticket_and_populate_wrapper('7129'); return false;\" title=\"Late materialization may not generate correct requirements\">#7129</a></span> for more context\n<hr/>\n<em>2020-Apr-10 07:46:13 by tim:</em> <br/>\n\nBulk change of target version from v080906 to v080907 using ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2020-Nov-09 12:32", "status": "new", "created": "2019-Jun-26 15:34", "fixed_version": "2019-Jun-26 15:34", "broken_version": "", "priority": "3", "subsystem": "", "assigned_to": "johnkn", "derived_from": "#6166", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}