{"id": 7535, "title": "Ticket #7535: startd should allow slots to be assigned specific custom resources", "description": "<blockquote>\nWhen the Startd creates a slot of any type (p-slot, d-slot, or static slot) it does so by parsing a string of the form that the <code>SLOT_TYPE_&lt;N&gt;</code> configuration knob reads.  This is a complicated, semi free-form request for resources that looks like this <div class=\"code\">\n<pre class=\"code\">&lt;resource_tag1&gt;=&lt;quantity&gt;, &lt;resource_tag2&gt;=&lt;quantity&gt;, ...</pre></div>\n example: <div class=\"code\">\n<pre class=\"code\">Cpus=1/4, Memory=4096, Gpus=1</pre></div>\n\n\n<p><code>&lt;quantity&gt;</code> may be an integer, a fraction, or a percentage, or the special values <strong>auto</strong> and <strong>minimal</strong>\n\n</p><p>At a minimum we need to extend this to allow a specific instance or instances of a non-fungible resource, (e.g. GPUS) to be specified; Possibly like this: </p><div class=\"code\">\n<pre class=\"code\">Cpus=2, Memory=4000, Gpus=\"CUDA2,CUDA3\"</pre></div>\n.\n\n<p>If we make this change, then P-slots and static slots could be configured to have specific GPUs assigned to them.  And with a small amount of additional code we could construct the provisioning string for d-slots to assign specific GPUs there also.  The mechanism for indicating to the STARTD what GPU assignments are desired would be left to a future ticket.\n\n</p><p>The above syntax, while sufficient, would be a bit of a PITA to use - So we should probably allow some sort of smart assignment here such as </p><div class=\"code\">\n<pre class=\"code\">Cpus=2, Gpus=(DeviceName:*Tesla*)</pre></div>\n which would indicate that we want to assign a GPU that has a <code>CUDA&lt;n&gt;DeviceName</code> attribute that matches /Tesla*/\n\n<p>Some things we need to consider:\n</p><ol>\n<li>currently the provisioning syntax splits on the usual string list characters and then treats each item as a resource assignment.  This means specification of the <code>&lt;quantity&gt;</code> cannot contain either spaces or commas - we should probably change that\n</li><li>we should probably pick a syntax that can survive being imbedded into a classad attribute value so that the schedd can make requests.\n</li><li>as a part of this work, we should <strong>stop</strong> advertising attributes of GPUs that are not assigned to the slot in the slot, and should remove the GPU id prefix from the attributes that are assigned to the slot.</li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2020-May-12 10:41:41 by pfc:</em> <br/>\n\nTodd thinks TJ may have done recent work that support this.  Greg will confirm.\n\n<p></p><hr/>\n<em>2020-Dec-01 10:37:05 by pfc:</em> <br/>\n\nThis should be folded in <span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=7239\" onclick=\"get_ticket_and_populate_wrapper('7239'); return false;\" title=\"support for more usable selection+binding of GPU devices by user\">#7239</a></span>.\n\n<p></p><hr/>\n<em>2021-May-04 10:56:10 by pfc:</em> <br/>\n\nShould be part of <a class=\"external\" href=\"https://opensciencegrid.atlassian.net/browse/HTCONDOR-127\">https://opensciencegrid.atlassian.net/browse/HTCONDOR-127</a></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2021-May-04 10:56", "status": "resolved", "created": "2020-Mar-03 15:41", "fixed_version": "2020-Mar-03 15:41", "broken_version": "", "priority": "3", "subsystem": "", "assigned_to": "johnkn", "derived_from": "#7239", "creator": "johnkn", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}