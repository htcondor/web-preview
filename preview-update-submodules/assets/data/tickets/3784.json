{"id": 3784, "title": "Ticket #3784: Memory Tracking Test - Waiting for ending from TJ", "description": "<blockquote>\n<strong class=\"three\">Memory Tracking Test</strong>\n\n<p><strong class=\"two\">job_memory_tracking</strong>\n\n</p><p>We want to ensure reported memory after a job completes is the high water mark\nfor resident memory used and that we have consistency in the image size reported\nto the user log and that we have the same values in the machine and job ads.\n\n</p><p>We first need a job that will grow and shrink on demand.\n\n</p><p>Having that, we want to check for various memory ads(Job and Machine) but need to be able to get callbacks on Image Size Updated(have these call backs now).\n\n</p><p>Discovered with this test that though we have all these callbacks for events, they were not able to impact global variables in the tests. The monitor  process\nwas the child of a fork and thus had it's own copies to update.\n\n</p><p>This is no longer the way it is. Now the test framework starts the monitor and when the monitor completes, the status is returned for the test. So we ping pong between the monitor and the test callbacks. Yet we are in a single process now.\n\n</p><p>The globals we care about are the arrays of hashes of slot ads and jobs ads collected on each image update callback and the image update counter.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-16 12:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d0413fc97bb9f51d57bf4d879f81394c63aefb88\">[37258]</a></span>: Changes to move to solaris and them mmap/munmap for all butb windows. Slight variation was needed for MACos. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-14 15:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8d4884ecb1c0d0c2057983e2d805695bcd8e8b1b\">[37231]</a></span>: Messed up curly brackets for solaris. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-14 15:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/20064e36d581a039015e6a3ffe7bcb2c60b1d5d6\">[37230]</a></span>: Balance the #if with an #endif for Solaris <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-14 13:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9afcf622bce456399a861e50e792476a51cabcec\">[37220]</a></span>: Add dummy memory data fetching function to unbreak solaris build. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-13 16:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6319d8290bf7751b5d6300e159b5d95c2d6a3548\">[37202]</a></span>: Get job_mem_checker testing on windows <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-13 16:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/77ae7f1ae468269ce00339049c124535b25953b2\">[37201]</a></span>: fix windows build for x_job_mem_checker.c <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span> ===VersionHistory:none===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-13 12:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/045fda0f14b61b5f102e8e335189330ac397ab3a\">[37185]</a></span>: Locate platform specific memory gathering to functions <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-08 12:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c2d3dbd17b51f4174c322f96698647273f27081b\">[37134]</a></span>: Changes in knobs from perl calling script and output format changes along with Darwin code tie in. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-07 11:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b401ab02a7d1f522beae688a690ffc97246e57b1\">[37117]</a></span>: add support for windows to x_job_mem_checker.c <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jul-30 10:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fc2db53c45bfb36c466be9cf89faedcec7128d4f\">[37042]</a></span>: Failed on 2 core machines because I was specifying NUM_SLOTS instead of NUM_CPUS <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jul-29 17:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/06259f2806c903b223fe2cd741594e2e185a4747\">[37035]</a></span>: We now have the currently desired output of all the memory information collected by the test and it will fail if it does not see the /proc/self/status RSS grow and then later shrink. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jul-29 17:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/da9e0052f815946b3d6a98d7f4c40c0755a959a4\">[37034]</a></span>: Added job_mem_checker fir Linux only. There are issues in OSX and Solaris. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jul-29 17:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cc7137e479067570f12346f6fe636d60a13215e0\">[37033]</a></span>: Tracked down an inability for an event callback in the tests actually changing a global variable within a test. Eventually traced it to the callbacks being done in CondorTest.pm which put the monitor which handles event into a different process where it has it's own copies of these variables. I removed\u00a0[...]\n (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jul-25 14:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6dbe9bed884130ec615ecb4f0add2d3cafbeceac\">[37003]</a></span>: Closer version of the memory checker and memory growth program which runs the memory grower as a job <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jul-18 12:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f3275ba96c5f166f444a9a02ad64919b82f52d7f\">[36999]</a></span>: Mwmory testing program and script to run it. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jul-18 12:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cef5e84e16717fa8fb0854c6febb889093ca82ff\">[36998]</a></span>: Preliminary memory checking test <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jul-18 12:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/03fe35a92e0f5feb76856c61cb133b4844a7915c\">[36997]</a></span>: Wanted to specify an error file in the new memory checking test <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3784\" onclick=\"get_ticket_and_populate_wrapper('3784'); return false;\" title=\"Memory Tracking Test - Waiting for ending from TJ\">#3784</a></span>  (By Bill Taylor )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Aug-06 14:27", "status": "resolved", "created": "2013-Jul-16 14:20", "fixed_version": "2013-Jul-16 14:20", "broken_version": "", "priority": "3", "subsystem": "", "assigned_to": "bt", "derived_from": "#3594", "creator": "bt", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "johnkn@cs.wisc.edu", "due_date": ""}