{"id": 1278, "title": "Ticket #1278: Create process check for .exe on file not found", "description": "<blockquote>\nThere have been a series of issues around inconsistencies between condor_config on windows and *nix.  This would eliminate one of those issues.</blockquote>", "remarks": "<blockquote>\n<em>2010-Mar-16 22:26:43 by tannenba:</em> <br/>\n\nWhat we need is a function to create an alternate pathname to an executable (aka one that appends .exe if no extention exists, and/or fixes up the path delimiters), and use it when calling Create_Process(), access(), or get version info from an (executable) file.\n\n<p>Pushing such a patch into the the stable V7.4 series at Dan's request to hopefully fix issues w/ rooster running the power tool correctly on Win32.\n\n</p><p></p><hr/>\n<em>2010-Mar-16 22:44:16 by tannenba:</em> <br/>\n\nSince Dan wanted this patch in the stable series, I'm assigning the ticket to him for code review :).  I did watch it work on Win32 with the config file set to run <code>condor_schedd</code> instead of <code>condor_schedd.exe</code>.\n\n<p>The big diff in <a class=\"file\" href=\"rlog?f=src/condor_includes/condor_sys_nt.h\">/src/condor_includes/condor_sys_nt.h</a> was because that file had incorrect line endings (sigh).  The only real change in that file was to get rid of the macro to define access to call _access on Win32.\n\n</p><p></p><hr/>\n<em>2010-Mar-18 10:34:20 by danb:</em> <br/>\n\nIn <code>alternate_exec_pathname()</code> it checks for \".\" in the executable path and appends \".exe\" if not found.  This code will not append \".exe\" if the path to the executable contains any directory name with a \".\" in it.\n\n<p>Under unix, <code>alternate_exec_pathname()</code> will generate warnings about unused variables.  Perhaps we should define two completely separate function bodies in the windows vs. unix case to avoid this.\n\n</p><p>In <code>Create_Process()</code>, in the following code that predates this patch, what if namelen is less than 4?\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">\textension = namelen &gt; 0 ? &amp;(executable[namelen-4]) : NULL;\n</pre></div>\n\n\n<p>In <code>Create_Process()</code> the addition of \".exe\" to the executable name happens after the check for 16-bit apps, so automatic detection of 16-bit apps does not appear like it will work when the \".exe\" extension is not explicitly supplied.  Is that a problem?\n\n</p><p>In <code>Create_Process()</code>, every time it runs a program where the \".exe\" is not explicitly supplied, it will dprintf, \"Create_Process(): Failed to extract the extension from file\".  Seems a bit ugly for something we are proposing to be the norm.\n\n</p><p></p><hr/>\n<em>2010-Apr-27 16:33:25 by tstclair:</em> <br/>\n\nsomeone want to mark this as done?</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-24 14:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/afa8051363d0485b3a34a3dc8caa21774d63d0f5\">[17694]</a></span>: Fixed two issues identified in review of .exe patch. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1278\" onclick=\"get_ticket_and_populate_wrapper('1278'); return false;\" title=\"Create process check for .exe on file not found\">#1278</a></span> 1. problem handling directories that contain a \".\" 2. problem handling filenames less than 4 characters long (this problem existed prior to the .exe patch but would be more likely to strike when people are encouraged to use filenames lacking\u00a0[...]\n (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-19 11:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bb638f23afacedbc4979b0b396f9392fff873378\">[17671]</a></span>: Remove <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CondorVersionInfo\" title=\"Condor Version Info\">CondorVersionInfo</a></span> from classad compat layer. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1122\" onclick=\"get_ticket_and_populate_wrapper('1122'); return false;\" title=\"Add methods for adding TARGET scope in expressions based on ad type\">#1122</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1278\" onclick=\"get_ticket_and_populate_wrapper('1278'); return false;\" title=\"Create process check for .exe on file not found\">#1278</a></span> Comment out use of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CondorVersionInfo\" title=\"Condor Version Info\">CondorVersionInfo</a></span> in the new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> compatibility layer. The code was disabled, but still being compiled. This caused changes for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1278\" onclick=\"get_ticket_and_populate_wrapper('1278'); return false;\" title=\"Create process check for .exe on file not found\">#1278</a></span> to pull more files into libcondorapi. Instead, we now have fewer files in libcondorapi.\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-16 22:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/70669cf02d10d1ff6079ed437eeff15343b7d9f2\">[17644]</a></span>: Set things up on Win32 so if we fail to find/exec an executable, try again after fixing the subdirectory delimiters and adding a default extention of .exe (if an extention didn't already exist). (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1278\" onclick=\"get_ticket_and_populate_wrapper('1278'); return false;\" title=\"Create process check for .exe on file not found\">#1278</a></span>)  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Jun-04 16:20", "status": "resolved", "created": "2010-Mar-16 16:43", "fixed_version": "2010-Mar-16 16:43", "broken_version": "v070401", "priority": "2", "subsystem": "Win32", "assigned_to": "tannenba", "derived_from": "#1282", "creator": "tstclair", "rust": "", "customer_group": "users", "visibility": "public", "notify": "tstclair@redhat.com,matt@cs.wisc.edu,dan@hep.wisc.edu,tannenba@cs.wisc.edu", "due_date": ""}