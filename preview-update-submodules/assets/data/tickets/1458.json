{"id": 1458, "title": "Ticket #1458: publish negotiator cycle stats", "description": "<blockquote>\nOne of the important health indicators for the negotiator is the length of the negotiation cycle.  Currently, this can only be monitored by scanning through the negotiator logs.\n\n<p>It would be nice to publish the following attributes in the negotiator ad:\n\n</p><p></p><ul>\n<li><code>LastNegotiationCycleDuration</code> - number of seconds from start to stop\n</li><li><code>LastNegotiationCycleSubmitterTimeouts</code> - a list of submitters who did not receive full attention due to timeouts</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Jun-16 10:30:15 by matt:</em> <br/>\n\nAlso useful -\n\n<p></p><ul>\n<li><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LastNegotiationCycleTime\" title=\"Last Negotiation Cycle Time\">LastNegotiationCycleTime</a></span> - seconds since EPOCH\n</li><li><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LastNegotiationCycleMatches\" title=\"Last Negotiation Cycle Matches\">LastNegotiationCycleMatches</a></span> - number of matches\n</li><li><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LastNegotiationCycleSubmitterCount\" title=\"Last Negotiation Cycle Submitter Count\">LastNegotiationCycleSubmitterCount</a></span> - number of submitters considered\n</li><li><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LastNegotiationCycleRejections\" title=\"Last Negotiation Cycle Rejections\">LastNegotiationCycleRejections</a></span> - number of rejected jobs (job with no match)\n</li></ul>\n\n<p>It would also be useful to allow a stack of these stats in the fashion of LAST_MATCH_LIST_LENGTH.\n\n</p><p></p><hr/>\n<em>2010-Jun-17 17:16:18 by danb:</em> <br/>\n\nThe negotiator now publishes stats on the most recent N cycles.  N defaults to 3.  The statistics that are reported include start time, duration, number of matches, number of rejections, number of submitters, a list of submitters who ran out of time, and a list of submitters who failed (e.g. due to communication errors).\n\n<p></p><hr/>\n<em>2010-Jun-29 19:48:34 by gthain:</em> <br/>\n\nSorry to be annoying, but this was causing the negotiation to segfault on solaris, so I reverted it.\n\n<p></p><hr/>\n<em>2010-Jun-30 03:13:16 by danb:</em> <br/>\n\nGreg, thanks for catching the test failure under solaris.  I have fixed it.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-30 02:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a3e1dae95a3345365767e50764f11d95d7ec3c85\">[18527]</a></span>: Fixed a bug causing the negotiator to crash under solaris. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1458\" onclick=\"get_ticket_and_populate_wrapper('1458'); return false;\" title=\"publish negotiator cycle stats\">#1458</a></span> vsprintf() was being called with a NULL for one of the %s substitutions.  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-30 02:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/900538134ec9281248ed02be6ea46a09a62eec3e\">[18526]</a></span>: Revert \"Revert \"The negotiator publishes information about the last N negotiation cycles. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1458\" onclick=\"get_ticket_and_populate_wrapper('1458'); return false;\" title=\"publish negotiator cycle stats\">#1458</a></span>\"\" This reverts commit 6580327177fa433cfb44d8993396283862d641d3.  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-29 19:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6580327177fa433cfb44d8993396283862d641d3\">[18525]</a></span>: Revert \"The negotiator publishes information about the last N negotiation cycles. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1458\" onclick=\"get_ticket_and_populate_wrapper('1458'); return false;\" title=\"publish negotiator cycle stats\">#1458</a></span>\" This reverts commit 90057488d14f51cec1d643d4a0e0fcad46319a7f. This commit causes the negotiator to segfault deterministically on solaris  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-17 17:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a948b338dc8dd18e7eb24ac64a8d303f50e9e426\">[25533]</a></span>: Documented min and max for NEGOTIATION_CYCLE_STATS_LENGTH. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1458\" onclick=\"get_ticket_and_populate_wrapper('1458'); return false;\" title=\"publish negotiator cycle stats\">#1458</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-17 17:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1dd1160f95d74ece19a0605243801bbe8823e97f\">[25532]</a></span>: Documented negotiation cycle stats. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1458\" onclick=\"get_ticket_and_populate_wrapper('1458'); return false;\" title=\"publish negotiator cycle stats\">#1458</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-17 17:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/90057488d14f51cec1d643d4a0e0fcad46319a7f\">[18497]</a></span>: The negotiator publishes information about the last N negotiation cycles. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1458\" onclick=\"get_ticket_and_populate_wrapper('1458'); return false;\" title=\"publish negotiator cycle stats\">#1458</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Jun-30 03:13", "status": "resolved", "created": "2010-Jun-16 09:33", "fixed_version": "2010-Jun-16 09:33", "broken_version": "v070504", "priority": "4", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "s7913", "customer_group": "cms", "visibility": "public", "notify": "dan@hep.wisc.edu,sfiligoi@fnal.gov matt@cs.wisc.edu", "due_date": ""}