{"id": 4281, "title": "Ticket #4281: Change default settings so that jobs are not preempted by default", "description": "<blockquote>\nOne of the most common questions for new HTCondor admins is how to turn off job preemption.  This ticket proposes to change the default out-of-the-box configuration for HTCondor so that jobs are not preempted by default, and thus enabling job preemption as before is opt-in.</blockquote>", "remarks": "<blockquote>\n<em>2014-Mar-27 15:32:48 by tannenba:</em> <br/>\n\n<strong>NOTE: This code must undergo a code review before v8.1.6</strong>\n\n<p></p><hr/>\n<em>2014-May-22 14:48:17 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Looking over this patch, it looks like it essentially comments out and/or removes a bunch of settings from the condor_config file and places the below defaults into the param table:\n\n</p><p></p><pre>  PREEMPTION_REQUIREMENTS = False\n  START = True\n  PREEMPTION_RANK =\n  NEGOTIATOR_PRE_JOB_RANK = RemoteOwner=?=UNDEFINED\n  NEGOTIATOR_POST_JOB_RANK = (RemoteOwner=?=UNDEFINED) *\n           (ifthenElse(isUndefined(KFlops),1000,Kflops) - \\\n           SlotID - 1.0e10*(Offline=?=True))\n  WANT_SUSPEND=FALSE\n  WANT_VACATE=FALSE\n  SUSPEND=FALSE\n  CONTINUE=TRUE\n  PREEMPT=FALSE\n  KILL=FALSE\n  PERIODIC_CHECKPOINT = ((time()-LastPeriodicCheckpoint)/60.0)&gt; \\\n            (180.0+$RANDOM_INTEGER(-30,30,1))\n  CLAIM_WORKLIFE = 3600\n</pre>\n\n<p>Looking this over, I think we can do better before v8.2.0.  Some items noticed:\n\n</p><p></p><ol>\n<li>CLAIM_WORKLIFE of an hour seems a bit long esp with preemption disabled by default; seems like 20 minutes seems better in absence of preemption.\n</li><li>Wouldn't it be better to disable preemption via <code>MaxJobRetirementTime</code> instead of changing <code>PREEMPTION_REQUIREMENTS</code> ? This way, the no preemption policy is honored even in the face of draining, for instance.  Also it would be easier for an admin to re-enable preemption by simply adjusting the <code>MaxJobRetirementTime</code> to whatever they want instead of messing around with a potentially complicated expression.\n</li><li><code>condor_config.annotated</code> should be released, i.e. the CMakefile should be modified to copy it into the release examples directory.  Right now it looks like the only place <code>condor_config.annotated</code> can be found is in the source code.\n</li><li>should metaknob policy always_run be enabled by default, just like the host security metaknob is?  BTW, if this metaknob, <code>MaxJobRetirementTime</code> is 0 - what does that mean?\n</li><li>should <code>preemption_rank</code> go by inverse wall clock time by default?\n</li><li>the \"uwcs\" preemption_requirements expression looks to be broken.  guessing it evaluates to undefined most of the time due to bug <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=4369\" onclick=\"get_ticket_and_populate_wrapper('4369'); return false;\" title=\"SubmitterUserPrio does not work in PREEMPTION_REQUIREMENTS|RANK\">#4369</a></span>\n</li><li>we should have negotiator_pre_job_rank do some local best fit with respect to cpu and memory.\n</li></ol>\n\n<p>Going to resolve this ticket and open a new ticket for v8.2.0 to address the above items.</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4374\" onclick=\"get_ticket_and_populate_wrapper('4374'); return false;\" title=\"Improve default configuration for v8.2.0\">#4374</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nImprove default configuration for v8.2.0</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Apr-08 14:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ca7a17a3ae8838a675bcdcd0d2cdb43ddd89547d\">[39883]</a></span>: Document new policy to disable preemption by default. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4281\" onclick=\"get_ticket_and_populate_wrapper('4281'); return false;\" title=\"Change default settings so that jobs are not preempted by default\">#4281</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-27 15:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e037ce7f294b2522a818e1bb9564ab7650b971e3\">[39737]</a></span>: change default for CLAIM_WORKLIFE from infinite to 3600. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4281\" onclick=\"get_ticket_and_populate_wrapper('4281'); return false;\" title=\"Change default settings so that jobs are not preempted by default\">#4281</a></span> note that 3600 is what the documentation claims it defaults to.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-11 23:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/773d8cb6a32af8bff5bc39ea190b03ff226e084e\">[39590]</a></span>: first-pass to change default run policy to no-preemption. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4281\" onclick=\"get_ticket_and_populate_wrapper('4281'); return false;\" title=\"Change default settings so that jobs are not preempted by default\">#4281</a></span>  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-May-22 14:49", "status": "resolved", "created": "2014-Mar-27 15:32", "fixed_version": "2014-Mar-27 15:32", "broken_version": "", "priority": "2", "subsystem": "Daemons", "assigned_to": "johnkn", "derived_from": "", "creator": "tannenba", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tannenba@cs.wisc.edu, gthain@cs.wisc.edu", "due_date": ""}