{"id": 7129, "title": "Ticket #7129: Late materialization may not generate correct requirements", "description": "<blockquote>\nThe fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7044\" onclick=\"get_ticket_and_populate_wrapper('7044'); return false;\" title=\"param calls in submit_utils should happen only when used by tools\">#7044</a></span> introduced a bug where when a user specifies <code>Requirements</code> in their submit file, and is also using late materialization, the code in submit_utils to generate a requirements expression automatically may do the wrong  thing.  This happens because in 8.9.2 the submit digest is pruned, but requirements generation needs access to unpruned file transfer lists (and possibly other things.)\n\n<p>It was intended that pruned submit digests have a flag that prevent requirements from being generated at all (so all procs will share the clusters requirements), but when the user has a requirements statement, this check is being skipped.\n\n</p><p>The fix is to always prune the requirements statement from the digest that is sent for a late materialization job.  But this will introduce a new bug whereby requirements statements what have $() expansions will not work correctly.  We consider this a less serious bug, and will work on a fix for that later. (see <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=7130\" onclick=\"get_ticket_and_populate_wrapper('7130'); return false;\" title=\"User requirements from submit file should get their own job attribute\">#7130</a></span>)</p></blockquote>", "remarks": "<blockquote>\nno version history because late materialization</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-27 09:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2c13779ea75626bf81f4a6f21d2aaa24b98e0797\">[57236]</a></span>: fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7129\" onclick=\"get_ticket_and_populate_wrapper('7129'); return false;\" title=\"Late materialization may not generate correct requirements\">#7129</a></span>, late materialization might not generate correct requirements when there is a user-specified requirement keyword in the submit file.  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Aug-26 16:08", "status": "resolved", "created": "2019-Jun-26 15:05", "fixed_version": "2019-Jun-26 15:05", "broken_version": "v080902", "priority": "4", "subsystem": "", "assigned_to": "johnkn", "derived_from": "#6166", "creator": "johnkn", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "", "due_date": ""}