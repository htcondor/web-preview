{"id": 6997, "title": "Ticket #6997: condor_q gives false errors when using the -attributes flag", "description": "<blockquote>\nIf condor_q is invoked with the -attributes command line flag in conjunction with -long, -json, or -xml flags, and the attributes <code>ClusterId</code> and <code>ProcId</code> are not both included, condor_q reports scary errors like\n\n<p></p><pre>   Error: Two results with the same ID\n</pre>\n\n<p>This is because condor_q code to assign jobs into collections really wants to see the job id attributes in order to sort the results by job id.\n\n</p><p>A simple, (but wrong) one line code fix would be to automatically add those two attributes to the list provided with the -attributes flag, but this will then result in these attributes showing up uninvited in the user's output.\n\n</p><p>Work-around for users running versions older than v8.8.3 is to add -stream-results flag, which will bypass the code that tries to sort ads by job id.\n\n</p><p>If sort of the ads is important, then they could use -af:r rather than -long\n\n</p><p><code>condor_q -af:lrng</code> produces output that is the same as -long except that -af will not skip a missing attribute, but will always print something at that position.\n\n</p><p>An alternate work around is to add <code>ClusterId</code> and <code>ProcId</code> to the list of attributes provided with the -attributes flag, although this will also alter the output.</p></blockquote>", "remarks": "<blockquote>\nThe right fix here is to not try and sort the results when <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClusterId\" title=\"Cluster Id\">ClusterId</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ProcId\" title=\"Proc Id\">ProcId</a></span> are not part of the projection. Or use the ad return order as a final sort key.\n\n<p></p><div class=\"strike\">\n<strike>Perhaps, stream-results should be turned on automatically when the output is -long and the projection does not include cluster and proc. </strike></div>\n.  This is a bad idea, because it would potentially result in a connection being held to the schedd for a long time if the user pauses the output of condor_q somehow.\n\n<p></p><hr/>\n<em>2019-May-13 15:50:11 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This code looks good.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-16 10:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/69a20e083ef83c97c252282445538847ce51e9ed\">[56900]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6997\" onclick=\"get_ticket_and_populate_wrapper('6997'); return false;\" title=\"condor_q gives false errors when using the -attributes flag\">#6997</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-22 11:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2257b30bbdbb3260b8341403c57c51377455acad\">[56687]</a></span>: Fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6997\" onclick=\"get_ticket_and_populate_wrapper('6997'); return false;\" title=\"condor_q gives false errors when using the -attributes flag\">#6997</a></span>, condor_q reports \"Two results with the same ID\" when it tries to print -long -attr and the attribute list does not contain the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ProcId\" title=\"Proc Id\">ProcId</a></span>. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-May-16 11:03", "status": "resolved", "created": "2019-Apr-12 11:55", "fixed_version": "2019-Apr-12 11:55", "broken_version": "v080710", "priority": "2", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "", "creator": "tannenba", "rust": "s97116", "customer_group": "support", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}