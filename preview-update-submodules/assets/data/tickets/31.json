{"id": 31, "title": "Ticket #31: Avoid thousands of copies of same file in SPOOL", "description": "<blockquote>\n(copy of drupal node 1493)\n\n<p>An idea for reducing disk space use in the SPOOL: whenever the condor_schedd is about to copy a binary/initial checkpoint/ickpt into SPOOL, it should look for an identical binary owned by the same user. If such a binary exists, simply hardlink the existing one to the new one\u2019s name.\n\n</p><p>Advantages: Saves disk space no matter how the jobs arrive, so long as they share a binary. Can save space on jobs submitted via Condor-C.\n\n</p><p>Disadvantages: Starting with 6.9.1, the default for copy_to_spool FALSE, so the local submission benefit is minimal. This is new functionality, and would necessitate someone tracking file identities (probably using a hashing algorithm). Will this tracking information be held by the schedd and lost on restart? That would be safe, but would make it less effective. If it\u2019s stored on disk, where? Perhaps squeezed into the ickpt\u2019s filename?\n\n</p><p>A tempting proposal, especially since it will benefit Condor-C users...\n\n</p><p>Will it satisfy LIGO's needs as well (see attached RUST ticket)?  How does the above idea compare to Alan D's earlier SPOOL proposal to help LIGO?</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Jan-16 13:02:55 by adesmet:</em> <br/>\n\nThe most recent proposal is at <span class=\"drupalnode\"><a href=\"http://drupal-old.batlab.cs.wisc.edu/node/1495\">1495 (backup)</a> <a href=\"http://nmi.cs.wisc.edu/node/1495\">1495 (public)</a></span>.  It will be moving into the local wiki ASAP.\n\n<p></p><hr/>\n<em>2009-Jan-16 13:15:30 by adesmet:</em> <br/>\n\nThe proposal is now in the wiki as <span class=\"wiki\"><a href=\"wiki?p=ProposalSharedExecutablesIckptsInTheSpool\" title=\"Proposal Shared Executables Ickpts In The Spool\">ProposalSharedExecutablesIckptsInTheSpool</a></span>.  The drupal copy is now obsolete.\n\n<p></p><hr/>\n<em>2009-Jan-16 13:22:53 by adesmet:</em> <br/>\n\nThere was a thread titled \"Avoiding redundant executables in the SPOOL\" on condor-devel in April and May of 2008 in which the proposal was discussed.  It is entirely likely that some minor feedback from that discussion hasn't been incorporated into the proposal.  I'll try to integrate them soon.\n<a class=\"external\" href=\"https://lists.cs.wisc.edu/archive/condor-devel/2008-April/threads.shtml\">https://lists.cs.wisc.edu/archive/condor-devel/2008-April/threads.shtml</a>\n<a class=\"external\" href=\"https://lists.cs.wisc.edu/archive/condor-devel/2008-May/threads.shtml\">https://lists.cs.wisc.edu/archive/condor-devel/2008-May/threads.shtml</a>\n\n<p></p><hr/>\n<em>2009-Feb-02 12:50:56 by gquinn:</em> <br/>\n\nThis feature is now coded and tested. I'd like to merge it after it gets a code review.\n\n<p></p><hr/>\n<em>2009-Feb-03 13:33:19 by gquinn:</em> <br/>\n\nAlan reviewed my branch and provided many helpful comments. I've addressed them and merged this feature for 7.3.0.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-03 13:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c89f9e88f53bcf9db9e973d76a5657e48502bb27\">[13698]</a></span>: Squash merge of V7_3-ickpt_share-branch into master Conflicts: src/condor_c++_util/Imakefile <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-03 13:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4ad0175d761994bbc68c2f291e07803badd8e657\">[13697]</a></span>: Minor EXCEPT message fix <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-03 13:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bf1a3c7358cec765d9268db46e6293917d4e3220\">[13696]</a></span>: Added comment as per Alan's code review <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-03 12:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0d85f1e6a191276ecc38c27acedb55b69433cf3d\">[13695]</a></span>: Clarified comment above make_hash_filename <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-03 12:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8fb973f9e70c0b305edf18077d7fa19b2dd82412\">[13694]</a></span>: Minor refactoring <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-03 12:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/302210cd0c4ee92c29c57717d022f2014cdfdc2d\">[13693]</a></span>: Fixed incorrect comment <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-03 12:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/61b9a60a45d114c78cea401d1fdca6abc2a96c50\">[13692]</a></span>: Documented return value for Condor_MD_MAC::addMDFile <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-03 12:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7e08a102830618afc05ef28c99005a7bee7c4c68\">[13691]</a></span>: Fixed spelling error in comment <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-03 12:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/97f333fe09626ce477f86d7eaa1916515f131a43\">[13690]</a></span>: Remove code that accidentally snuck in in an earlier commit <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-02 12:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3f14c3fd6c4a0c922c715dfa2ebca2ce611254a9\">[13684]</a></span>: Preen fixes <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-02 12:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ed7e58dd1fb3ebd0fe2dca8b42325e9f239b7a61\">[13683]</a></span>: Add missing <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=OwnerCheck\" title=\"Owner Check\">OwnerCheck</a></span> call to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SendSpoolFileIfNeeded\" title=\"Send Spool File If Needed\">SendSpoolFileIfNeeded</a></span> <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-02 12:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4b8699c627f2bda4f0fb17a9b625a3fdf9aecf9f\">[13682]</a></span>: Add missing dprintf argument <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-02 12:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4efb8032cdc071b39c948a72b3ddf0c8d48c8c28\">[13681]</a></span>: Fix Windows build <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-31 08:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9608f18d58eea6f2420ceb6f54cc623b0ecda6f0\">[13678]</a></span>: Add awareness of ickpt sharing to preen <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-30 13:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/16fe479cc81dbe52fad1834e0a07b38e62829ebb\">[13668]</a></span>: Add Windows support for the ickpt sharing stuff <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-29 15:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/14ffbabd08534efb6fa936f7d5fb28ac945450ff\">[13652]</a></span>: Use hard links to share ickpt files in SPOOL <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitTrac\" title=\"Git Trac\">GitTrac</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=31\" onclick=\"get_ticket_and_populate_wrapper('31'); return false;\" title=\"Avoid thousands of copies of same file in SPOOL\">#31</a></span>  (By Greg Quinn )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Jan-31 13:40", "status": "defer", "created": "2009-Jan-16 10:04", "fixed_version": "2009-Jan-16 10:04", "broken_version": "v070200", "priority": "5", "subsystem": "Daemons", "assigned_to": "gquinn", "derived_from": "", "creator": "tannenba", "rust": "a15277", "customer_group": "ligo", "visibility": "public", "notify": "matt@cs.wisc.edu,pcouvare@caltech.edu", "due_date": ""}