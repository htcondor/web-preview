{"id": 7030, "title": "Ticket #7030: SSL host verification", "description": "<blockquote>\nThe SSL authentication, on the client side, does not perform any authorization for the server certificate.\n\n<p>That is, <strong>any</strong> valid certificate is accepted as a server certificate.  So, if your server certificate has <code>/CN=htcondor.org</code> and it is presented for a schedd at <code>google.com</code>, the client does not complain.\n\n</p><p>Rather than introduce a dubious <code>SSL_DAEMON_NAME</code> as was originally done for GSI, I propose that we simple apply RFC 2818 rules to verify the host alias (as was done a few years back for GSI).  This avoids any dependency on the security of reverse DNS, which matches modern security practices.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-May-02 16:22:55 by zmiller:</em> <br/>\n\nWere the changes to the param table (HOST_ALIAS) supposed to be part of this commit or ticket?  It's not referenced in the other committed code.\n\n<p></p><hr/>\n<em>2019-May-02 16:26:49 by bbockelm:</em> <br/>\n\nAh shoot, I meant to discuss that in person.\n\n<p>Setting HOST_ALIAS causes the daemon to advertise its preferred \"hostname\" in the collector.  It's been somewhat of a hidden knob inside GSI for quite awhile; I think it should be set by default now.\n\n</p><p>If not set, GSI will utilize reverse DNS to determine the hostname associated with an IP.  Given this is widely considered a Bad Idea (even Globus stopped doing this as of last year), I would prefer to not introduce this undesired behavior into new functionality (as we have decided this isn't a security issue).\n\n</p><p></p><hr/>\n<em>2019-May-07 04:32:53 by bbockelm:</em> <br/>\n\nFrom an email:\n\n<p></p><ul>\n<li>We don't see this as a security issue in the end given this is been the behavior since the start.  One can always manage allowed server certs via ALLOW_CLIENT.\n</li><li>We should follow the RFC and do the host check, and this should be the default behavior.\n</li><li>There will be a knob to disable the check (= SSL_SKIP_HOST_CHECK=) in case anyone needs it.\n</li><li>Ability to do unauthenticated SSL will be split out into <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7032\" onclick=\"get_ticket_and_populate_wrapper('7032'); return false;\" title=\"Allow SSL client auth without client cert\">#7032</a></span>.\n</li><li>This will go in 8.9 but not stable.\n</li><li>I will make the changes.</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-27 20:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/79e60a70eab771f3cc5d26a51fd57ec5d93242ca\">[56973]</a></span>: Document the new SSL host verification behavior. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7030\" onclick=\"get_ticket_and_populate_wrapper('7030'); return false;\" title=\"SSL host verification\">#7030</a></span> Includes mention of new `SSL_SKIP_HOST_CHECK` config knob.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 06:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2cd6732c6f3064073b3882445ea8189fb0af48c1\">[56799]</a></span>: Skip the SSL hostcheck when running tests. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7030\" onclick=\"get_ticket_and_populate_wrapper('7030'); return false;\" title=\"SSL host verification\">#7030</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 02:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ad6a5a5a1d718bd9cf8dc8607001d8b2fcb28986\">[56798]</a></span>: Fix usage of `strtok_r`. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7030\" onclick=\"get_ticket_and_populate_wrapper('7030'); return false;\" title=\"SSL host verification\">#7030</a></span> This code was originally designed with `strsep` in mind (which had no Windows support); when `strtok_r` was used instead, the arguments were not correctly changed.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 00:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3f84698d8ce026a62e66eaa07f2930d242794f4d\">[56797]</a></span>: Add parameter to disable SSL host check. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7030\" onclick=\"get_ticket_and_populate_wrapper('7030'); return false;\" title=\"SSL host verification\">#7030</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 00:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/00a4aa11fc8caf26d6b3d0d7fae97de2df641c72\">[56796]</a></span>: Set the host alias by default to FULL_HOSTNAME. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7030\" onclick=\"get_ticket_and_populate_wrapper('7030'); return false;\" title=\"SSL host verification\">#7030</a></span> In order for SSL host verification to work without relying on reverse DNS (heavily frowned upon in existing code like GSI; even worse for new code), the client needs to specify the hostname they are expecting; for ads received from the collector (our\u00a0[...]\n (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 00:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e44b2fcc606da15f0fac796ecf6856ee9290c39a\">[56795]</a></span>: Verify host alias for SSL authentication. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7030\" onclick=\"get_ticket_and_populate_wrapper('7030'); return false;\" title=\"SSL host verification\">#7030</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-02 21:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0bd08d55163ac8cda1d621b4aff3f2a0937012ec\">[56748]</a></span>: Add parameter to disable SSL host check. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7030\" onclick=\"get_ticket_and_populate_wrapper('7030'); return false;\" title=\"SSL host verification\">#7030</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-01 21:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a4dc1dd4d3b840714ea9046777fa1db221d35aad\">[56727]</a></span>: Fix for. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7030\" onclick=\"get_ticket_and_populate_wrapper('7030'); return false;\" title=\"SSL host verification\">#7030</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-May-27 20:39", "status": "resolved", "created": "2019-May-01 21:14", "fixed_version": "2019-May-01 21:14", "broken_version": "v060700", "priority": "1", "subsystem": "Security", "assigned_to": "zmiller", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "scitokens", "visibility": "public", "notify": "bbockelman@morgridge.org; tannenba@cs.wisc.edu; zmiller@cs.wisc.edu", "due_date": ""}