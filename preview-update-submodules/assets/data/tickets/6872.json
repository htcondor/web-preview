{"id": 6872, "title": "Ticket #6872: Remove dependency on capability library for running in a containter", "description": "<blockquote>\nThe HTCondor starter checks to see if it is root (technically can_switch_ids) before it tries to contain a job with cgroups or issue a MOUNT_UNDER_SCRATCH.  WHen running in a docker or singularity container, HTCondor has uid root, but the linux capabilities to do these operations have been removed.  So, the starter now checks not just that it is root, but that it has cap_sys_admin.  Unfortunately, the library we use to wrap the system call to get the capability is not installed by default with the kernel headers, so we can't use it.\n\n<p>The code today, if it couldn't find the capability-checking library, assumed that the system didn't support capabilities, and thus fell back to the \"if I have uid 0, I can do anything\", and thus a condor built this way started inside a container would fail to run jobs.\n\n</p><p>To fix this, we will not use the capability library, but check the capabilites directly with a system call.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-18 09:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/92af3d4293e7f837123759d678e8bca1f4eacffc\">[56021]</a></span>: Check for capabilites via more-portable system call <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6872\" onclick=\"get_ticket_and_populate_wrapper('6872'); return false;\" title=\"Remove dependency on capability library for running in a containter\">#6872</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Mar-25 13:41", "status": "resolved", "created": "2019-Jan-18 09:30", "fixed_version": "2019-Jan-18 09:30", "broken_version": "v080800", "priority": "3", "subsystem": "", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}