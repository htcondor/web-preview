{"id": 2259, "title": "Ticket #2259: glideins fail to use glexec at lcg grid sites", "description": "<blockquote>\nWhen glideinWMS attempts to use glexec at various European grid sites, the starter fails in the following way:\n\n<p></p><div class=\"verbatim\">\n<pre>GLEXEC: error reading message from wrapper: Connection reset by peer\n</pre></div>\n\n\n<p>Simple command-line tests of glexec succeed.\n\n</p><p>Burt set up a glite CE at Fermilab and was unable to reproduce the problem.  He and Igor got the following results in their tests:\n\n</p><p></p><div class=\"verbatim\">\n<pre>FNAL factory + FNAL gLite WN + glite-GLEXEC 0.8.0 = success\nFNAL factory + FNAL gLite WN + glite-GLEXEC 0.7.0-1 = success\nUCSD factory + RAL gLite WN + glite-GLEXEC 0.7.0-1 = fail\nFNAL factory + RAL gLite WN + glite-GLEXEC 0.7.0-1 = fail\nUCSD factory + CSCS gLite WN + glite-GLEXEC 0.8.1-1 = fail\n</pre></div>\n\n\n<p>All those tests have linger=on.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Jun-21 17:56:40 by danb:</em> <br/>\n\nI found that the problem is caused by restrictive permissions on a parent directory of the directory in which the glidein binaries are installed.\n\n<p></p><pre>  $ ls -ld /home/cmspilot016\n  drwx------ 5 cmspilot016 cmspilot 4096 Jun 21 23:33 /home/cmspilot016\n</pre>\n\n<p></p><pre>  $ ls -ld /home/cmspilot016/globus-tmp.t2wn60.5546.0\n  drwx------ 5 cmspilot016 cmspilot 4096 Jun 21 23:33 /home/cmspilot016/globus-tmp.t2wn60.5546.0\n</pre>\n\n<p>The problem is that condor tries to run condor_glexec_job_wrapper via glexec, but condor_glexec_job_wrapper is installed in a sub-directory of a directory that the target user does not have permission to access.  The target user in my test is cms140 and the user running the glidein is cmspilot016.\n\n</p><p>On this same grid node, if I install glidein in /tmp, which does not have restrictive permissions, condor is able to use glexec successfully.\n\n</p><p>Here is what happens if I try to run a program by hand via glexec in a directory that the target user does not have access to:\n\n</p><p></p><pre>  $ /opt/glite/sbin/glexec /home/cmspilot016/test_job\n  [gLExec]:   Error while examining the executable that is about to be executed.\n</pre>\n\n<p>It is unfortunate that this error message did not get reported by Condor, since lack of this made the debugging effort much more difficult.  Before this ticket is closed, we should attempt fixing that or flag it as a bug to be fixed in the future.\n\n</p><p>What can we do about the permission problem?  One idea would be to have glidein install condor's glexec job wrapper (if not the rest of condor) in a location such as /tmp that is accessible to the target user.  The down-side of this is that if the glidein gets kicked off the code without having an opportunity to clean up after itself, we may leave droppings behind in /tmp that are not immediately cleaned up by the batchsystem.\n\n</p><p>In addition to the job wrapper needing to be accessible to the target user, the glidein's condor execute directory would also need to be accessible.\n\n</p><p>Another idea would be to say that if sites support glexec, they must also have directory permissions set up to allow all possible target users to access all parent directories in which pilot jobs run.\n\n</p><p></p><hr/>\n<em>2011-Jun-23 12:27:32 by danb:</em> <br/>\n\nI have submitted a patch to 7.7.0 to capture and propagate diagnostic messages from glexec when it fails to run the job.\n\n<p></p><hr/>\n<em>2011-Jun-23 12:40:07 by danb:</em> <br/>\n\nThe issue of parent directory permissions is, for now, considered to be a problem to be addressed outside of condor, so I am closing this ticket.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-27 09:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/571ebc9d4dbd1567a0d2d3ed4627dc65ef9762f5\">[22291]</a></span>: Fixed broken windows build. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2259\" onclick=\"get_ticket_and_populate_wrapper('2259'); return false;\" title=\"glideins fail to use glexec at lcg grid sites\">#2259</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-23 14:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d4ef89f9b7f367e84feb091d26baab742857b8b7\">[22278]</a></span>: Another improvement to glexec error propagation. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2259\" onclick=\"get_ticket_and_populate_wrapper('2259'); return false;\" title=\"glideins fail to use glexec at lcg grid sites\">#2259</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-23 12:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0816b99f25006a5203daf86dde7d0cc826ecad75\">[22275]</a></span>: Improved error propagation when glexec fails to execute the job. ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2259\" onclick=\"get_ticket_and_populate_wrapper('2259'); return false;\" title=\"glideins fail to use glexec at lcg grid sites\">#2259</a></span> ===VersionHistory=== When glexec fails to execute the job, diagnostic error messages produced by glexec used to be discarded. These error messages are now displayed in the starter log and in the job's hold reason.  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Aug-04 14:59", "status": "resolved", "created": "2011-Jun-21 13:56", "fixed_version": "2011-Jun-21 13:56", "broken_version": "v070405", "priority": "1", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "s8055", "customer_group": "cms", "visibility": "public", "notify": "dan@hep.wisc.edu,sfiligoi@fnal.gov,burt@fnal.gov", "due_date": ""}