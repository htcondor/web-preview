{"id": 937, "title": "Ticket #937: outgoing security session caching is broken with CCB", "description": "<blockquote>\nOutgoing security sessions are being cached by IP:port of the peer, but in the case of a CCB connection, the port is an ephemeral port, which is likely to be different each time we connect to the same daemon.\n\n<p>This typically results in renegotiation security in situations where we could have used a cached session.  It could also result in an inappropriate security session being used if two different daemons on the same IP use the same ephemeral port in different instances.\n\n</p><p>We did not notice this problem before, because SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION sidesteps the problem by forcing the use of a pre-created security session.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Nov-12 15:32:47 by danb:</em> <br/>\n\nThis problem is fixed for 7.4.1.\n\n<p></p><hr/>\n<em>2009-Nov-12 15:41:32 by danb:</em> <br/>\n\nI should also note a related problem addressed by the same patch: when the connection is closed in response to DC_AUTHENTICATE, secman tries to send a raw command int (no security negotiation).  It does this by closing the socket and reconnecting.  The address it was using to reconnect to was the peer's connected address, which in the case of a reversed CCB connection contains an ephemeral port, not appropriate for reconnecting to.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-13 13:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a6539e71bc95723ead0441a98078bb51732560c4\">[25132]</a></span>: Documented fix for security session caching with CCB. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=937\" onclick=\"get_ticket_and_populate_wrapper('937'); return false;\" title=\"outgoing security session caching is broken with CCB\">#937</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-12 15:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/28eacae363d14be1c731ac86d619e483883168a0\">[16300]</a></span>: Outgoing security sessions are associated with full connect address. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=937\" onclick=\"get_ticket_and_populate_wrapper('937'); return false;\" title=\"outgoing security session caching is broken with CCB\">#937</a></span> Previously, it was using the IP:port of the connected peer, but for reversed CCB connections, that port is an ephemeral port and for shared port connections, that port is shared by many different daemons.  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-31 08:04", "status": "resolved", "created": "2009-Nov-12 15:20", "fixed_version": "2009-Nov-12 15:20", "broken_version": "v070300", "priority": "4", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}