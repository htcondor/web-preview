{"id": 2079, "title": "Ticket #2079: CondorUtils runcmd processing errors from system call wrong", "description": "<blockquote>\nsub <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ProcessReturn\" title=\"Process Return\">ProcessReturn</a></span> { <br/>\n\n    my $rc = shift;  <br/>\n\n    my $signal = 0;  <br/>\n\n    my @result;  <br/>\n\n    if ($rc == 0) {  <br/>\n\n        #print \"ran with normal exit\\n\";  <br/>\n\n    } elsif ($rc == 0xff00) {  <br/>\n\n        #print \"command failed: $!\\n\";  <br/>\n\n    } elsif (($rc &amp; 0xff) == 0) {  <br/>\n\n        $rc &gt;&gt;= 8;  <br/>\n\n        #print \"ran with non-zero exit status $rc\\n\";  <br/>\n\n    } else {  <br/>\n\n        #print \"ran with \";  <br/>\n\n        if ($rc &amp;   0x80) {  <br/>\n\n            $rc &amp;= ~0x80;  <br/>\n\n            #print \"coredump from \";  <br/>\n\n        }   <br/>\n\n        #print \"signal $rc\\n\";  <br/>\n\n        $signal = $rc;  <br/>\n\n    }  <br/>\n\n    push @result, $rc;  <br/>\n\n    push @result, $signal;  <br/>\n\n    return @result;  <br/>\n\n} <br/>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Apr-21 18:12:15 by tannenba:</em> <br/>\n\nBill, please edit this ticket so it actually describes the problem.  Also the broken version field is not properly formatted.  Thanks!\n\n<p>bt:\n\n</p><p>It looks like the logic got switched around in the if(A)/else if(B)/else if(C)/else(D)\nand that an additional check for -1 first to see if it ran at all is in order.\nThe prior check of -1 one should precede the rest. A is fine. B should come\nlast and include the shifting in C. The test for C should be the\nfirst elsif and include the actions currently in D.\n\n</p><p>The perl manual documents it to be done similar to this:\n\n</p><p>if ($? == -1) {   <br/>\n\n    print \"failed to execute: $!\\n\";   <br/>\n\n}   <br/>\n\nelsif ($? &amp; 127) {   <br/>\n\n    printf \"child died with signal %d, %s coredump\\n\",   <br/>\n\n         ($? &amp; 127),  ($? &amp; 128) ? &amp;#8217;with&amp;#8217; : &amp;#8217;without&amp;#8217;;   <br/>\n\n}   <br/>\n\nelse {   <br/>\n\n    printf \"child exited with value %d\\n\", $? &gt;&gt; 8;   <br/>\n\n}   <br/>\n</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "todo", "last_change": "2011-Apr-26 13:10", "status": "new", "created": "2011-Apr-21 14:36", "fixed_version": "2011-Apr-21 14:36", "broken_version": "v070400", "priority": "2", "subsystem": "Tests", "assigned_to": "", "derived_from": "", "creator": "bt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bt@cs.wisc.edu", "due_date": ""}