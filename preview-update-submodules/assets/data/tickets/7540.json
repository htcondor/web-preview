{"id": 7540, "title": "Ticket #7540: Rename TOKENS to IDTOKENS", "description": "<blockquote>\nIn discussions with Miron, he suggested the name of the <code>TOKEN</code> auth method is confusing.  Why?\n\n<p></p><ul>\n<li>There's a second method called <code>SCITOKENS</code>.  It is not immediately clear the difference between <code>TOKEN</code> and <code>SCITOKENS</code>.\n</li><li><code>SCITOKENS</code> is plural while <code>TOKEN</code> is singular.\n</li></ul>\n\n<p>Miron's input is that, given <code>TOKEN</code> auth provides an identity, we should call these <code>IDTOKENS</code>.  As we already have many configs saying <code>TOKEN</code>, we should just add an alias mapping the word <code>IDTOKENS</code> to <code>TOKEN</code> at the configuration file level instead of changing the wire protocol.\n\n</p><p>Also fixing confusion about singular or plural, we end up with the following mappings from user-provided name to internal name:\n\n</p><p></p><ul>\n<li><code>TOKENS</code> -&gt; <code>TOKEN</code>\n</li><li><code>TOKEN</code> -&gt; <code>TOKEN</code>\n</li><li><code>IDTOKENS</code> -&gt; <code>TOKEN</code>\n</li><li><code>IDTOKEN</code> -&gt; <code>TOKEN</code>\n</li><li><code>SCITOKENS</code> -&gt; <code>SCITOKENS</code>\n</li><li><code>SCITOKEN</code> -&gt; <code>SCITOKENS</code>\n</li></ul>\n\n<p>The preferred names we put into the documentation will be <code>IDTOKENS</code> and <code>SCITOKENS</code>.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Mar-17 13:36:21 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>(of <a class=\"external\" href=\"https://github.com/htcondor/htcondor/pull/106/commits/976202a4f107eaff46a8a51e72597cb4a61bcb64\">pull request #106</a>.)\n\n</p><p>Setting <strong>method_used</strong> to \"IDTOKENS\" instead of \"TOKEN\" (lines 283 and 444 of <code>condor_io/authentication.cpp</code>)\nends up passing a new constant into <strong>map_authentication_name_to_canonical_name()</strong>,\nwhich I think will break existing map files.\n\n</p><p></p><hr/>\n<em>2020-Mar-21 17:36:47 by bbockelm:</em> <br/>\n\nThanks for the review --\n\n<p></p><ul>\n<li>Mapfiles are not enabled for TOKEN auth in the first place.  Hence, no compatibility issue there!\n</li><li>However, I did find another issue where the client sent out the <code>IDTOKENS</code> method on the wire, resulting in older servers to skip the method.  This is fixed in the last branch commit.\n</li></ul>\n\n<p></p><hr/>\n<em>2020-Mar-22 05:20:24 by tlmiller:</em> <br/>\n\n<div class=\"code\">\n<pre class=\"code\">&gt; Mapfiles are not enabled for TOKEN auth in the first place.  Hence, no compatibility issue there!</pre></div>\n\n\n<p>I went looking for how this exception was implemented and I didn't find anything.  I probably just missed it, but does IDTOKENS never call  <code>Authentication::authenticate_finish()</code>, or what?\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">&gt; However, I did find another issue where the client sent out the =IDTOKENS= method on the wire,\n&gt; resulting in older servers to skip the method.  This is fixed in the last branch commit.\n</pre></div>\n\n\n<p>Good catch.  I refactored the code that detected and rewrote the aliases into one function.  It's a little clumsy, but it reduced code duplication.  Please take a look.  If you've got a testing set-up ready to go, I'd appreciate it if you could check this code again; otherwise let me know.\n\n</p><p></p><hr/>\n<em>2020-Mar-22 09:04:17 by bbockelm:</em> <br/>\n\n@tlmiller - did you push those changes anywhere?  Don't see them here or on github.\n\n<p>I wasn't going to worry too much about the code duplication when filtering -- I have a branch for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7500\" onclick=\"get_ticket_and_populate_wrapper('7500'); return false;\" title=\"Clients should not suggest authentication methods they don't support\">#7500</a></span> that blows away much of this code anyway.\n\n</p><p></p><hr/>\n<em>2020-Mar-22 15:31:00 by tlmiller:</em> <br/>\n\nSorry about that, pushed to V8_9-gt7540-branch.\n\n<p></p><hr/>\n<em>2020-Mar-22 22:31:56 by bbockelm:</em> <br/>\n\nReviewed the refactored code and verified it works as expected on my test setup.  Feel free to merge when ready!\n\n<p></p><hr/>\n<em>2020-Mar-23 11:06:59 by tlmiller:</em> <br/>\n\nGreat, thanks!\n<hr/>\n<em>2020-Apr-10 07:46:37 by tim:</em> <br/>\n\nBulk change of target version from v080906 to v080907 using ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-May-02 23:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ba8026ff1bd8188d69a92276cc6516cd58b9d6dc\">[59568]</a></span>: Update manual to use IDTOKENS over TOKEN. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7540\" onclick=\"get_ticket_and_populate_wrapper('7540'); return false;\" title=\"Rename TOKENS to IDTOKENS\">#7540</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-22 05:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a6eec91dffe867f1b97333c4fbd7867830598dd0\">[59191]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7540\" onclick=\"get_ticket_and_populate_wrapper('7540'); return false;\" title=\"Rename TOKENS to IDTOKENS\">#7540</a></span>) Refactor some common code into a function.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-21 17:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d6366e70e4eedebcd8558076844c5b7a7cfed3a8\">[59189]</a></span>: Ensure we translate IDTOKENS for the auth list wire protocol. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7540\" onclick=\"get_ticket_and_populate_wrapper('7540'); return false;\" title=\"Rename TOKENS to IDTOKENS\">#7540</a></span> For example, if the client is configured with the following methods:\u00a0[...]\n (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-07 08:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/976202a4f107eaff46a8a51e72597cb4a61bcb64\">[59187]</a></span>: Alias IDTOKENS to TOKEN. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7540\" onclick=\"get_ticket_and_populate_wrapper('7540'); return false;\" title=\"Rename TOKENS to IDTOKENS\">#7540</a></span> In order to better distinguish TOKEN from SCITOKENS, provide an alias from IDTOKENS to SCITOKENS.  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-May-02 23:45", "status": "resolved", "created": "2020-Mar-07 08:08", "fixed_version": "2020-Mar-07 08:08", "broken_version": "", "priority": "3", "subsystem": "", "assigned_to": "bbockelm", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bbockelman@morgridge.org, tlmiller@cs.wisc.edu", "due_date": ""}