{"id": 6717, "title": "Ticket #6717: Memory leak when SSL authentication fails", "description": "<blockquote>\nWhen using the SSL authentication method in CEDAR, memory is leaked if a failure occurs during the procedure. Specifically, in Condor_Auth_SSL::authenticate(), several data structures are dynamically allocated at the top of the method and deallocated at the end. If a failure occurs in the middle, the method returns immediately without deallocating the memory.\n\n<p>Failures that can trigger this memory leak include the peer having an expired certificate. We observed this in CHTC when the host certificate for annex-cm.chtc.wisc.edu expired.</p></blockquote>", "remarks": "<blockquote>\n<em>2018-Jul-25 10:49:10 by jfrey:</em> <br/>\n\nWe are cherry-picking this fix from V8_6-branch to V8_6_12-branch.\n\n<p></p><hr/>\n<em>2018-Jul-30 10:23:34 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong> : change looks good. safe enough to go into stable without a lot of testing - it's strictly better than without the fix.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6720\" onclick=\"get_ticket_and_populate_wrapper('6720'); return false;\" title=\"Keep peers in sync after SSL authentication failures\">#6720</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nKeep peers in sync after SSL authentication failures</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jul-26 14:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c49fe6a216bce25b27354d9d79981d58203f347b\">[55220]</a></span>: Docs for SSL memory leak fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6717\" onclick=\"get_ticket_and_populate_wrapper('6717'); return false;\" title=\"Memory leak when SSL authentication fails\">#6717</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jul-25 10:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ffa2ffee285cf794b09797efb32f7d00c1810e40\">[55213]</a></span>: Update SSL memory leak fix for added return site in 8.7. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6717\" onclick=\"get_ticket_and_populate_wrapper('6717'); return false;\" title=\"Memory leak when SSL authentication fails\">#6717</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jul-25 10:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f370482d6d48bd24629a1b884dbf1fee9d86ccc3\">[55211]</a></span>: Fix memory leak when SSL authentication fails. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6717\" onclick=\"get_ticket_and_populate_wrapper('6717'); return false;\" title=\"Memory leak when SSL authentication fails\">#6717</a></span> Free allocated data structures when aborting SSL auth on an error. This can be triggered by something as common as an expired certificate.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jul-23 11:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7c9748f37b009def2f4fb56c0fc4508537eaedcc\">[55202]</a></span>: Fix memory leak when SSL authentication fails. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6717\" onclick=\"get_ticket_and_populate_wrapper('6717'); return false;\" title=\"Memory leak when SSL authentication fails\">#6717</a></span> Free allocated data structures when aborting SSL auth on an error. This can be triggered by something as common as an expired certificate.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2018-Jul-30 10:24", "status": "resolved", "created": "2018-Jul-23 11:28", "fixed_version": "2018-Jul-23 11:28", "broken_version": "", "priority": "4", "subsystem": "Security", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "", "due_date": ""}