{"id": 5279, "title": "Ticket #5279: lib_job_router_local on Windows broken with shared port active", "description": "<blockquote>\nThe lib_job_router_local test currently turns shared port off for the job router on Windows.  It's unclear why this is necessary -- the resulting hang has been inexplicable.\n\n<p>According to the logs, the job router simply stops doing anything after it updates its ad with the collector the first time.  The last line in the log is consistently <code>09/24/15 16:35:23 <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> Timeout() Complete, returning 5</code>, which should be followed by no more than five seconds later by the timer firing again.\n\n</p><p>In a normal run, a few seconds later, the job router accepts what is probably a connection from a <code>condor_who</code> invoked by the test harness; and shortly afterwards, the other timers fire again, the job router finds a job, and the test (eventually) passes.  This may be entirely a coincidence, or it could be that accept()ing that connection kicks daemon core out of a bad state.  It is suspicious because shared port, of course, changes how that connection works.  The shared port daemon logs that it has written a number of bytes to the named pipe, but there's no corresponding record in the job router.  Since it's unlikely that the timer code is just flat-out broken on Windows (then nothing would work) I wonder if we're somehow wedging in the daemon core event loop.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jun-08 14:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/73642520a613628e4e71c09c87110f3913e78dbc\">[48519]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5279\" onclick=\"get_ticket_and_populate_wrapper('5279'); return false;\" title=\"lib_job_router_local on Windows broken with shared port active\">#5279</a></span>, turn off Windows sharedport hack for lib_job_router_local test.  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Jul-14 15:24", "status": "resolved", "created": "2015-Sep-24 17:59", "fixed_version": "2015-Sep-24 17:59", "broken_version": "", "priority": "4", "subsystem": "Tests", "assigned_to": "johnkn", "derived_from": "#5247", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "johnkn@cs.wisc.edu", "due_date": ""}