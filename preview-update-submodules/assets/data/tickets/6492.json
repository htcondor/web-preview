{"id": 6492, "title": "Ticket #6492: DAGMan inconsistently tracks job holds, aborts jobs too early", "description": "<blockquote>\nSome CHTC users were getting their DAGMan jobs aborted for exceeding DAGMAN_MAX_JOB_HOLDS, although these jobs clearly had far fewer held procs than the maximum limit. This turned out to be more than a simple bug; DAGMan is fundamentally confused about how it tracks job holds.\n\n<p>The problem is fairly basic. Some parts of the DAGMan code track held procs on a per-job basis, whereas other parts of the code track holds across the entire DAG. From reading the code, it seems like DAGMan was originally tracking on a per-DAG basis, then someone started refactoring it to a per-job basis, but they stopped halfway through.\n\n</p><p>We need to pick one or the other. Given that we seemed to be moving to per-job tracking, this seems like the obvious solution to me. Any objections?</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Nov-30 17:15:31 by coatsworth:</em> <br/>\n\nI've moved this from stable release to dev since it turned out to be more complex than a regular bug. Previously, we aborted a DAG node if it exceeded DAGMAN_MAX_JOB_HOLDS holds across its entire lifetime. I've changed this so now the holds need to be simultaneous.\n\n<p>However, the previous behavior is still desirable in certain cases. We should plan to implement both of them, but we have to balance this out across per-node or per-DAG tracking. To be continued...</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Dec-12 14:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ff1794a03a7f3ffc6dcec7124e85a36ab2fef86b\">[52981]</a></span>: Added documentation (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6492\" onclick=\"get_ticket_and_populate_wrapper('6492'); return false;\" title=\"DAGMan inconsistently tracks job holds, aborts jobs too early\">#6492</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Nov-30 17:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7677a0248807e1d66e37e824bd119f6a2d959658\">[52900]</a></span>: Merged <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2ef5e5e57f6bae8aec653a226c471e03b35d74a3\">[52891]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6f4f83d5b72ffc9b4b41639a1e2953ba13db4fcc\">[52892]</a></span>, DAGMAN_MAX_JOB_HOLDS now measures against individual nodes, not full dag (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6492\" onclick=\"get_ticket_and_populate_wrapper('6492'); return false;\" title=\"DAGMan inconsistently tracks job holds, aborts jobs too early\">#6492</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Nov-30 13:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6f4f83d5b72ffc9b4b41639a1e2953ba13db4fcc\">[52892]</a></span>: Updated tests to reflect new behavior of DAGMAN_MAX_JOB_HOLDS (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6492\" onclick=\"get_ticket_and_populate_wrapper('6492'); return false;\" title=\"DAGMan inconsistently tracks job holds, aborts jobs too early\">#6492</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Nov-24 11:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2ef5e5e57f6bae8aec653a226c471e03b35d74a3\">[52891]</a></span>: Now tracking holds on a per-node instead of per-DAG basis (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6492\" onclick=\"get_ticket_and_populate_wrapper('6492'); return false;\" title=\"DAGMan inconsistently tracks job holds, aborts jobs too early\">#6492</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Dec-13 11:18", "status": "resolved", "created": "2017-Nov-22 15:45", "fixed_version": "2017-Nov-22 15:45", "broken_version": "", "priority": "2", "subsystem": "Dag", "assigned_to": "coatsworth", "derived_from": "", "creator": "coatsworth", "rust": "", "customer_group": "other", "visibility": "public", "notify": "coatsworth@cs.wisc.edu, zmiller@cs.wisc.edu, tannenba@cs.wisc.edu, lmichael@wisc.edu", "due_date": ""}