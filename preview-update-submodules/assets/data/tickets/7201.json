{"id": 7201, "title": "Ticket #7201: Advertise GPUs*Usage for startd/slots", "description": "<blockquote>\nWhile a monitored GPU device is assigned to a slot, we compute GPUs*Usage for that device and advertise it in the slot's job ad.  We have the information to compute GPUs*Usage for the device since the last time the startd restarted; this information is not currently advertised anywhere, but might be useful.  (Because of <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7176\" onclick=\"get_ticket_and_populate_wrapper('7176'); return false;\" title=\"Add condor_gpu_utilization and monitoring information to manual\">#7176</a></span>, the attributes can't be name GPUs*Usage, but UptimeGPUs*Usage should be fine.)\n\n<p>Update the documentation that mentions Uptime* and only being available via a -direct query.</p></blockquote>", "remarks": "<blockquote>\nThis is in the critical path for what we want for GPU scheduling, so bumping up to priority 3.\n\n<p></p><hr/>\n<em>2019-Aug-28 13:17:23 by tannenba:</em> <br/>\n\nMaybe call it <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GpuAvgUsage\" title=\"Gpu Avg Usage\">GpuAvgUsage</a></span> ?  Because it is currently an average, unlike all the others like <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CpuUsage\" title=\"Cpu Usage\">CpuUsage</a></span> which are a peak...\n\n<p></p><hr/>\n<em>2019-Aug-28 13:19:13 by tlmiller:</em> <br/>\n\nThe plan, for now, is to (continue to) advertise <code>GPUsUsage</code> as the average value, hopefully changing the name to <code>GPUsAverageUsage</code> to make it clear that it's a different kind of <code>Usage</code> than the others.  (Hopefully because it's not clear what changes we can make without writing some special-case code given the prevalence of magic regexes.)\n\n<p></p><hr/>\n<em>2019-Aug-28 13:21:18 by tlmiller:</em> <br/>\n\nOK, that's actually two separate topics:\n\n<p></p><ul>\n<li>Changing the name of job ad attribute to <code>GPUsAverageUsage</code>.\n</li><li>Adding an attribute, <code>UptimeGPUsAverageUsage</code>, which we can call whatever we want, since nobody (particularly, the shadow) cares.\n</li></ul>\n\n<p></p><hr/>\n<em>2019-Sep-05 17:54:10 by tlmiller:</em> <br/>\n\nAdded <code>UptimeGPUsAverageUsage</code>.\n\n<p>(Changing the name of the job-ad attribute isn't simple because the <code>Usage</code> suffix is magic.  A bunch of places in the code need to know to look for <code>AverageUsage</code> as well.  I'll find all of them eventually.)</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Sep-23 15:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2089ba9a3fbad9254e67cda2086936e4909aabd8\">[57893]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7201\" onclick=\"get_ticket_and_populate_wrapper('7201'); return false;\" title=\"Advertise GPUs*Usage for startd/slots\">#7201</a></span>) More fixing of the custom machine resource tests.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Sep-23 13:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c842dc107801ecf0dfdfe28dc082f859a930d4c1\">[57890]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7201\" onclick=\"get_ticket_and_populate_wrapper('7201'); return false;\" title=\"Advertise GPUs*Usage for startd/slots\">#7201</a></span>) Fix custom machine resource tests to recognize the new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AverageUsage\" title=\"Average Usage\">AverageUsage</a></span> attribute.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Sep-22 18:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c67334ed59dd47c39f6b6b3f95121d481119347a\">[57885]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7201\" onclick=\"get_ticket_and_populate_wrapper('7201'); return false;\" title=\"Advertise GPUs*Usage for startd/slots\">#7201</a></span>) Documentation.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Sep-22 18:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d8c23cecc2dadd270c441bef0be1f4ecde118b78\">[57883]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7201\" onclick=\"get_ticket_and_populate_wrapper('7201'); return false;\" title=\"Advertise GPUs*Usage for startd/slots\">#7201</a></span>) Change from GPUsUsage to GPUsAverageUsage. Add GPUsMemoryUsage reporting to the terminate event.  (By Todd L. Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Sep-21 21:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fcd5cdfe081f853c00048014b74b6d33e6e13bf8\">[57882]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7201\" onclick=\"get_ticket_and_populate_wrapper('7201'); return false;\" title=\"Advertise GPUs*Usage for startd/slots\">#7201</a></span>) Rename to Device*AverageUsage and Device*PeakUsage.  (By Todd L. Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Sep-05 17:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6a1c0cbe73d97cded24d16e8b540ebfdb0f5a8fc\">[57784]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7201\" onclick=\"get_ticket_and_populate_wrapper('7201'); return false;\" title=\"Advertise GPUs*Usage for startd/slots\">#7201</a></span>) Implement the slot-ad attribute UptimeGPUsAverageUsage.  (By Todd L. Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Sep-22 18:31", "status": "resolved", "created": "2019-Aug-08 15:19", "fixed_version": "2019-Aug-08 15:19", "broken_version": "", "priority": "3", "subsystem": "DaemonsExecNode", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "peter.couvares@ligo.org, tlmiller@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}