{"id": 6553, "title": "Ticket #6553: GPUsUsage accounts for multiple GPU devices improperly.", "description": "<blockquote>\nThis was easy to test with partitionable slots, and is broken.</blockquote>", "remarks": "<blockquote>\n<em>2018-Feb-02 16:10:28 by tlmiller:</em> <br/>\n\nThere were a number of problems.  The first problem was that we were copying the StartOfJob* attributes on every Aggregate() call, which meant that the second GPU's StartOfJob* attributes were over-writing the first's... which would still be wrong, because we need to aggregate StartOfJob* across all devices in the slot ad.  In fact, because slot ads are recomputed every time, we need to store device-specific StartOfJob* attributes in the device-specific ad and aggregate them every time in the Aggregate() ad.  We also needed to move the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ResetStartOfJob\" title=\"Reset Start Of Job\">ResetStartOfJob</a></span> code so that it would only trigger when a new sample came in.\n\n<p></p><hr/>\n<em>2018-Feb-02 16:11:50 by tlmiller:</em> <br/>\n\nNo need to add documentation for a bug fix to an unreleased branch.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-02 16:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2463b6bf926b0e33fe8264a9a7ea8498c24422b7\">[54204]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6553\" onclick=\"get_ticket_and_populate_wrapper('6553'); return false;\" title=\"GPUsUsage accounts for multiple GPU devices improperly.\">#6553</a></span>) Move <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ResetStartOfJob\" title=\"Reset Start Of Job\">ResetStartOfJob</a></span> code to where it needed to be.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2018-Feb-02 16:11", "status": "resolved", "created": "2018-Feb-02 16:06", "fixed_version": "2018-Feb-02 16:06", "broken_version": "v080707", "priority": "1", "subsystem": "DaemonsExecNode", "assigned_to": "tlmiller", "derived_from": "#6477", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}