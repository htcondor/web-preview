{"id": 5654, "title": "Ticket #5654: Implement \"shadow\" DAGMan", "description": "<blockquote>\nAs per discussion today with Miron:  have the capability to have a \"shadow\" DAGMan that reads the jobstate.log file produced by the \"real\" DAGMan running a given workflow.  The shadow DAGMan should maintain the same internal state as the \"real\" DAGMan, so that eventually we can query the shadow DAGMan instead of having to query the real DAGMan.\n\n<p>My initial thoughts on this:\n</p><ul>\n<li>Have something like a -shadow flag to condor_submit_dag and condor_dagman that puts DAGMan into shadow mode.\n</li><li>I think we can get most of what we need with recovery mode -- the shadow DAGMan would have to permanently stay in recovery mode, instead of switching into \"normal\" mode, so it doesn't start submitting jobs.\n</li><li>The shadow DAGMan would have to ignore lock files.\n</li><li>We would need to write a jobstate.log parser, which should be pretty easy because the format is so simple.  My thought is that the parser should probably emit ULogEvent objects, to integrate as easily as possible into the existing DAGMan code.\n</li><li>One question is what to do about things in the jobstate.log that don't correspond to existing events -- like starting and ending recovery mode.  I guess if we need to deal with those things in the shadow, we could use ULOG_GENERIC events.\n</li><li>I think we could do a lot of the initial implementation with the shadow DAGMan reading the regular workflow log, and then write the jobstate.log parser and substitute that for the \"regular\" log file parser.\n</li><li>Make sure the shadow DAGMan can deal with restarts of both itself and the \"real\" DAGMan.\n</li><li>The shadow DAGMan should not write a node status file or jobstate.log file, even if these files are specified in the DAG.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2016-Jun-06 16:01:56 by wenger:</em> <br/>\n\nCreated V8_5-gittrac_5654-branch for this.\n\n<p></p><hr/>\n<em>2016-Jun-06 16:03:38 by wenger:</em> <br/>\n\nHmm -- have to think about what we should do for sub-DAGs...</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jun-07 13:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2a46446756adad1c90875432d0d46d5305ea051d\">[48507]</a></span>: Gittrac <span class=\"ticket\"><a class=\"active\" href=\"/wiki-archive/tickets/?ticket=5654\" onclick=\"get_ticket_and_populate_wrapper('5654'); return false;\" title='Implement \"shadow\" DAGMan'>#5654</a></span>: In the process of switching away from doing everything in recovery mode -- now condor_rm of \"shadow\" DAGMan works, but shadow thinks the DAG is done as soon as there are no jobs in the queue...  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jun-07 11:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ee69674b1541569ed5b4b52c79f9e0789bba7af8\">[48506]</a></span>: Gittrac <span class=\"ticket\"><a class=\"active\" href=\"/wiki-archive/tickets/?ticket=5654\" onclick=\"get_ticket_and_populate_wrapper('5654'); return false;\" title='Implement \"shadow\" DAGMan'>#5654</a></span>: Works when \"real\" DAG is still running, but never exits -- needs to be changed to go back to daemoncore, etc.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jun-06 17:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/396554b498adc6aef8c3baae9b7b92478dc95feb\">[48503]</a></span>: Gittrac <span class=\"ticket\"><a class=\"active\" href=\"/wiki-archive/tickets/?ticket=5654\" onclick=\"get_ticket_and_populate_wrapper('5654'); return false;\" title='Implement \"shadow\" DAGMan'>#5654</a></span>: First version -- partially works, but won't work correctly if the \"shadowed\" DAG hasn't finished before the shadow DAGMan starts.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Jun-06 16:03", "status": "active", "created": "2016-Apr-28 15:24", "fixed_version": "2016-Apr-28 15:24", "broken_version": "v080504", "priority": "4", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, zmiller@cs.wisc.edu, tannenba@cs.wisc.edu, miron@cs.wisc.edu", "due_date": ""}