{"id": 53, "title": "Ticket #53: condor_master's invalidate attempt delays shutdown", "description": "<blockquote>\nIn a personal condor, e.g. all daemons on one machine, when shutting down the condor_master the COLLECTOR is quickly shutdown along with all other daemons. All the other daemons attempt to contact the collector and fail. Most do this quickly. The MASTER does the same thing, and its attempt appears to delay delivery of the termination signal to some daemons, in the example below it is the STARTD.\n\n<p><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MasterLog\" title=\"Master Log\">MasterLog</a></span>:\n\n</p><p></p><div class=\"restricted\"><pre>1/21 09:18:06 Got SIGQUIT.  Performing fast shutdown.\n1/21 09:18:06 Sent SIGQUIT to COLLECTOR (pid 11945)\n1/21 09:18:06 Sent SIGQUIT to NEGOTIATOR (pid 11973)\n1/21 09:18:06 Sent SIGQUIT to SCHEDD (pid 11974)\n1/21 09:18:06 Sent SIGQUIT to STARTD (pid 11975)\n1/21 09:18:06 The NEGOTIATOR (pid 11973) exited with status 0\n1/21 09:18:08 The COLLECTOR (pid 11945) exited with status 0\n1/21 09:18:08 The SCHEDD (pid 11974) exited with status 0\n1/21 09:18:11 attempt to connect to &lt;127.0.0.1:9618&gt; failed: Connection refused (connect errno = 111).\n1/21 09:18:11 ERROR: SECMAN:2004:Failed to create security session to &lt;127.0.0.1:9618&gt; with TCP|SECMAN:2003:TCP connection to &lt;127.0.0.1:9618&gt; failed\n1/21 09:18:11 Failed to start non-blocking update to &lt;127.0.0.1:9618&gt;.\n1/21 09:18:16 The STARTD (pid 11975) exited with status 0\n1/21 09:18:16 All daemons are gone.  Exiting.\n1/21 09:18:16 **** condor_master (condor_MASTER) pid 11943 EXITING WITH STATUS 0\n</pre></div><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StartLog\" title=\"Start Log\">StartLog</a></span>:\n\n<p></p><div class=\"restricted\"><pre>1/21 09:18:16 Got SIGQUIT.  Performing fast shutdown.\n1/21 09:18:16 shutdown fast\n1/21 09:18:16 Deleting Cronmgr\n1/21 09:18:16 attempt to connect to &lt;127.0.0.1:9618&gt; failed: Connection refused (connect errno = 111).\n1/21 09:18:16 ERROR: SECMAN:2003:TCP auth connection to &lt;127.0.0.1:9618&gt; failed\n\n1/21 09:18:16 attempt to connect to &lt;127.0.0.1:9618&gt; failed: Connection refused (connect errno = 111).\n1/21 09:18:16 ERROR: SECMAN:2003:TCP auth connection to &lt;127.0.0.1:9618&gt; failed\n\n1/21 09:18:16 All resources are free, exiting.\n1/21 09:18:16 **** condor_startd (condor_STARTD) pid 11975 EXITING WITH STATUS 0\n</pre></div></blockquote>", "remarks": "<blockquote>\n<em>2010-Jul-27 17:05:59 by slauson:</em> <br/>\n\nI'm not sure this is still an issue as the master currently doesn't invalidate its ad. I will still take this ticket into account for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1139\" onclick=\"get_ticket_and_populate_wrapper('1139'); return false;\" title=\"Master doesn't invalidate its ad on shutdown\">#1139</a></span> so the problem isn't reintroduced. Perhaps the problem is caused by something else or was fixed without resolving the ticket?\n<hr/>\n<em>2010-Aug-23 17:07:50 by adesmet:</em> <br/>\n\nBulk change of target version from v070402 to v070404 using ./ticket_target_mover.\n<hr/>\n<em>2010-Oct-27 16:39:01 by adesmet:</em> <br/>\n\nBulk change of target version from v070404 to v070405 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2013-Jun-03 13:28:19 by tannenba:</em> <br/>\n\nAbandoning this old ticket, as in current versions of HTCondor the master does have some notion of what needs to be shutdown in what order, e.g. the master will indeed shutdown the collector last.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2014-Aug-04 11:41", "status": "abandoned", "created": "2009-Jan-21 10:26", "fixed_version": "2009-Jan-21 10:26", "broken_version": "v070200", "priority": "4", "subsystem": "Daemons", "assigned_to": "", "derived_from": "", "creator": "matt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}