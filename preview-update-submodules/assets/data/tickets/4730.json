{"id": 4730, "title": "Ticket #4730: Do not stageout blahp-generated limited proxy", "description": "<blockquote>\nAt PBS sites, the blahp will generate a limited proxy in the working directory; if the proxy is named \"foo\", then the resulting file is \"foo.lmt\".\n\n<p>This leads to two problems at sandbox stageout time (unless the pilot explicitly lists which sandbox files to return):\na) (Not fully understood): Incorrect permissions to stageout this file.\nb) When the files are staged out, this file is staged out in the clear by default; it shouldn't be, as it is a proxy.\n\n</p><p>Luckily, for the most part, problem (a) prevents (b) [as (b) is a bit serious].\n\n</p><p>I propose that we should automatically exclude \"foo.lmt\" from the sandbox in the same manner we exclude \"foo\" from the sandbox (assuming \"foo\" is the x509 proxy).</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Mar-11 14:34:09 by jfrey:</em> <br/>\n\nI'd prefer to remove the proxy.lmt file closer to the source, rather than have a blanket exception for all file transfers. More specifically, when dealing with a blahp job, the gridmanager could delete the proxy.lmt file after the blahp indicates that the job has completed.\n\n<p>And for the .condor_pid_ns_status file in the starter, there's already code to exclude it from the output transfer list, though it looks like there's a problem with an absolute vs relative path. And it would be better if the starter removed the file after the job exits, to better handle running on a shared filesystem.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-20 13:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0f38fd365f859f710e2898757cd85b2ad06b1176\">[44870]</a></span>: minor edit of 8.3.6 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4730\" onclick=\"get_ticket_and_populate_wrapper('4730'); return false;\" title=\"Do not stageout blahp-generated limited proxy\">#4730</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-14 16:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2514fd94f5b736aa3fd41c8870fa9b81298d496c\">[44865]</a></span>: Docs for proxy.lmt and .condor_pid_ns_status in output files bugfix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4730\" onclick=\"get_ticket_and_populate_wrapper('4730'); return false;\" title=\"Do not stageout blahp-generated limited proxy\">#4730</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-10 16:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/858a241d0765bed636891d8bef9eef35b533b441\">[44591]</a></span>: Delete blahp-generated limited proxy after job completion. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4730\" onclick=\"get_ticket_and_populate_wrapper('4730'); return false;\" title=\"Do not stageout blahp-generated limited proxy\">#4730</a></span> If the job has an x509 proxy, the blahp creates a limited proxy in the same directory. We don't want to treat this file as an output file, so delete once the job is done.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-09 16:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ccde776ba9d465fc15f712477d919bebad0b5e22\">[44574]</a></span>: Don't transfer .condor_pid_ns_status with job output files. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4730\" onclick=\"get_ticket_and_populate_wrapper('4730'); return false;\" title=\"Do not stageout blahp-generated limited proxy\">#4730</a></span> This is a file created by a job wrapper that the starter uses when pid namespaces are enabled. It's not an output file of the job. When we tell the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> object to exclude it, we need to use the basename, not the full pathname.\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-11 14:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/567efe8872e96d4bb2613c8085b188bdc04c5f6a\">[42163]</a></span>: Avoid staging out unnecessary files. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4730\" onclick=\"get_ticket_and_populate_wrapper('4730'); return false;\" title=\"Do not stageout blahp-generated limited proxy\">#4730</a></span> The blahp will create (and not cleanup) a file containing a limited version of the job's proxy. This file may be transferred back to remote clients as part of the job sandbox (incorrectly - and possibly in the clear!). We should automatically exclude it.\u00a0[...]\n (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-May-14 16:32", "status": "resolved", "created": "2014-Nov-18 14:47", "fixed_version": "2014-Nov-18 14:47", "broken_version": "", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "#4555", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu, blin@cs.wisc.edu, marian.zvada@cern.ch,jfrey@cs.wisc.edu", "due_date": ""}