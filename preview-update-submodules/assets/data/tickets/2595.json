{"id": 2595, "title": "Ticket #2595: Procd handles stdin/out/err incorrectly", "description": "<blockquote>\nAfter it's done with initialization, the procd's file descriptors 0 and 1 are open to its log file or one of its named pipes (depending on configuration) and fd 2 is closed. All three fds should be opened to /dev/null. Otherwise, an inadvertent read/write to stdin, stdout, or stderr could foul up the procd's communication and interactions with the OS.</blockquote>", "remarks": "<blockquote>\n<em>2012-Feb-08 16:39:17 by jfrey:</em> <br/>\n\nCheckin <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0553664f9beda35dfced49917252d114b835a280\">[30529]</a></span> actually belongs to ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2613\" onclick=\"get_ticket_and_populate_wrapper('2613'); return false;\" title=\"Add versioning to libcondor_utils\">#2613</a></span>.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Feb-09 13:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f51c48d23aaca9977ef130bc8809aed917f17b9e\">[30558]</a></span>: Fix compile error on windows for procd handing of stdio. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2595\" onclick=\"get_ticket_and_populate_wrapper('2595'); return false;\" title=\"Procd handles stdin/out/err incorrectly\">#2595</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Feb-09 11:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d07de9db3a2bc4498c90eaf5b8bd77b8f3ddaf3a\">[30552]</a></span>: Check return value of freopen() for stdio in procd. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2595\" onclick=\"get_ticket_and_populate_wrapper('2595'); return false;\" title=\"Procd handles stdin/out/err incorrectly\">#2595</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Feb-08 17:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/71a4b1833550c3e6a21d6d0b2510ac07290b632e\">[30537]</a></span>: Fix procd's handling of stdio file descriptors. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2595\" onclick=\"get_ticket_and_populate_wrapper('2595'); return false;\" title=\"Procd handles stdin/out/err incorrectly\">#2595</a></span> The procd used to close stdin, stdout, and stderr and leave them closed. Then it would open other files, which would receive file descrptors 0, 1, and 2. This is potentially dangerous. Now, the procd reopens stdin/out/err to the null file (/dev/null\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Feb-08 16:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0553664f9beda35dfced49917252d114b835a280\">[30529]</a></span>: Add Condor version to libcondor_utils. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2595\" onclick=\"get_ticket_and_populate_wrapper('2595'); return false;\" title=\"Procd handles stdin/out/err incorrectly\">#2595</a></span> We need some kind of versioning of libcondor_utils to prevent a Condor binary from using an incompatible version. At present, we'll do so by incorporating the Condor version into the library name.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Feb-08 17:29", "status": "resolved", "created": "2011-Oct-27 16:31", "fixed_version": "2011-Oct-27 16:31", "broken_version": "v070600", "priority": "4", "subsystem": "Daemons", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}