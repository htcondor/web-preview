{"id": 2018, "title": "Ticket #2018: RequestMemory should be configurable with a default in condor_config", "description": "<blockquote>\nSome folks at LIGO work on dynamic slot provisioning. For that they use hard memory limits for each executing job, as advertised via <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span>. <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> is typically a user-defined value or approximately the size of the job's binary as a default. The later is a rather poor value in practice as it is usually too small.\n\n<p>For that reason, LIGO asked whether it is possible to set a default in the condor_config that will be used if users don't specify <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> in their submit files.\n\n</p><p>Given that this is a four line code change, I just went ahead and added this feature to condor_submit.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Apr-01 10:14:48 by matt:</em> <br/>\n\nNo code change necessary, they should use SUBMIT_EXPRS for this:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">$ condor_version\n$CondorVersion: 7.6.0 Mar 30 2011 BuildID: RH-7.6.0-0.4.el6 PRE-RELEASE-GRID $\n$CondorPlatform: X86_64-Fedora_13 $\n\n$ echo \"cmd=/bin/sleep\\nargs=1d\\nqueue\" | condor_submit\nSubmitting job(s).\n1 job(s) submitted to cluster 248.\n$ condor_q -l 248 | grep RequestMemory\nRequestMemory = ceiling(ifThenElse(JobVMMemory =!= undefined,JobVMMemory,ImageSize / 1024.000000))\nRequirements = ( TARGET.Arch == \"X86_64\" ) &amp;&amp; ( TARGET.OpSys == \"LINUX\" ) &amp;&amp; ( TARGET.Disk &gt;= DiskUsage ) &amp;&amp; ( ( TARGET.Memory * 1024 ) &gt;= ImageSize ) &amp;&amp; ( ( RequestMemory * 1024 ) &gt;= ImageSize ) &amp;&amp; ( TARGET.FileSystemDomain == MY.FileSystemDomain )\n\n$ echo \"cmd=/bin/sleep\\nargs=1d\\nqueue\" | env _CONDOR_RequestMemory=1234 _CONDOR_SUBMIT_EXPRS=RequestMemory condor_submit\nSubmitting job(s).\n1 job(s) submitted to cluster 249.\n$ condor_q -l 249 | grep RequestMemory\nRequestMemory = 1234\nRequirements = ( TARGET.Arch == \"X86_64\" ) &amp;&amp; ( TARGET.OpSys == \"LINUX\" ) &amp;&amp; ( TARGET.Disk &gt;= DiskUsage ) &amp;&amp; ( ( TARGET.Memory * 1024 ) &gt;= ImageSize ) &amp;&amp; ( ( RequestMemory * 1024 ) &gt;= ImageSize ) &amp;&amp; ( TARGET.FileSystemDomain == MY.FileSystemDomain )\n</pre></div>\n\n\n<p></p><hr/>\n<em>2011-Apr-01 10:19:57 by cweiss:</em> <br/>\n\nEven better :-) Or actually -- wait a minute: In this scenario, the submitting user still needs to be the applying force. Sure, a wrapper script replacing condor_submit would do the trick, but it won't grab a default from the condor_config...\n\n<p></p><hr/>\n<em>2011-Apr-01 10:30:09 by matt:</em> <br/>\n\nThat's just my shorthand to demonstrate.\n\n<p>The admin would put <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> = 1234 and SUBMIT_EXPRS = <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> in condor_config.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-01 10:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/33a344dd3b20f98940a9bc410daa5058ef0ee075\">[21221]</a></span>: This reverts commit fea7c3de902ae0481242918fbb983844987daff6. (was <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2018\" onclick=\"get_ticket_and_populate_wrapper('2018'); return false;\" title=\"RequestMemory should be configurable with a default in condor_config\">#2018</a></span>)  (By Cathrin Weiss )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Mar-31 14:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fea7c3de902ae0481242918fbb983844987daff6\">[21213]</a></span>: Add functionality to set <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> as a default in the condor_submit file. This allows for making a better approximation about memory usage than the size of the binary in vanilla jobs <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2018\" onclick=\"get_ticket_and_populate_wrapper('2018'); return false;\" title=\"RequestMemory should be configurable with a default in condor_config\">#2018</a></span>  (By Cathrin Weiss )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Apr-01 10:30", "status": "defer", "created": "2011-Mar-31 13:53", "fixed_version": "2011-Mar-31 13:53", "broken_version": "v070000", "priority": "5", "subsystem": "Tools", "assigned_to": "cweiss", "derived_from": "", "creator": "cweiss", "rust": "a21880", "customer_group": "ligo", "visibility": "public", "notify": "matt@cs.wisc.edu tannenba@cs.wisc.edu,pcouvare@caltech.edu", "due_date": "20110331"}