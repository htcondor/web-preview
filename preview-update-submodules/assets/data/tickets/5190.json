{"id": 5190, "title": "Ticket #5190: Heavyweight job polling in Condor-C", "description": "<blockquote>\nWe've had sysadmins complain about slow response times from the HTCondor-CE (and indeed, we are seeing issues where various actions hit socket timeouts).\n\n<p>Poking around, it seems the most common place where the CE schedd is blocking is when it is queried from the condor-c gahp on the server side.  Instead of using the relatively-scalable query protocol (as in <code>condor_q</code>), we are using qmgmt.  This means the schedd isn't forking to respond to requests - all IO stays in the main process.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Aug-03 10:19:24 by bbockelm:</em> <br/>\n\nI tested and pushed a minimal change - simply disconnect and reconnect read-only (i.e., not using the V3 protocol yet).\n\n<p>Can this be considered for backport to the next stable series release?\n\n</p><p></p><hr/>\n<em>2015-Aug-03 14:33:15 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This change looks good.\n\n</p><p>This should be safe for the 8.2 series, but it's not a bug fix.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-13 12:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3d11435f3aabc34cbfdd4fd63be204ca226019a3\">[45607]</a></span>: 8.2.9 version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5190\" onclick=\"get_ticket_and_populate_wrapper('5190'); return false;\" title=\"Heavyweight job polling in Condor-C\">#5190</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-03 15:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ad9783755e6e9ec1f140cfce19c9d4b7877c4c96\">[45457]</a></span>: For GAHP queries, reopen read-only connection. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5190\" onclick=\"get_ticket_and_populate_wrapper('5190'); return false;\" title=\"Heavyweight job polling in Condor-C\">#5190</a></span> Job status queries were being done under a read-write connection; this forces the schedd to service the read queries in the main process. This causes significant blocking in schedds with a larger number of jobs. Committer: Tim Theisen  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-03 10:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/577dff0e8c4e8d2324b0db427beca5d096fe9297\">[45448]</a></span>: For GAHP queries, reopen read-only connection. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5190\" onclick=\"get_ticket_and_populate_wrapper('5190'); return false;\" title=\"Heavyweight job polling in Condor-C\">#5190</a></span> Job status queries were being done under a read-write connection; this forces the schedd to service the read queries in the main process. This causes significant blocking in schedds with a larger number of jobs.  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Aug-15 17:34", "status": "resolved", "created": "2015-Aug-03 09:54", "fixed_version": "2015-Aug-03 09:54", "broken_version": "", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "tim", "derived_from": "#4555", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu", "due_date": ""}