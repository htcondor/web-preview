{"id": 2189, "title": "Ticket #2189: privsep mkdir creates root-owned directory", "description": "<blockquote>\nJeff Dost discovered the following:\n\n<p>\"When using the mkdir functionality of Condor privsep, if I try to create a directory as a non-whitelisted (but otherwise valid) user, it will create it as user root.\"\n\n</p><p>The caller of the switchboard must still be a valid caller.  The issue is with the target uid specified for the directory.\n\n</p><p>The severity of this problem seems pretty low, unless someone thinks of a way to exploit this to do further damage.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-May-24 11:06:29 by danb:</em> <br/>\n\nThe mkdir was being done before checking the validity of the target uid.  The attached patch remedies this.\n\n<p></p><hr/>\n<em>2011-May-25 15:24:50 by kupsch:</em> <br/>\n\nThis seems like a bug, but not an exploitable vulnerability.  A priv sep trusted user is required to cause the directory to be created, the directory location is still constrained, and only root can make entries in the new directory.\n\n<p>The only other thing to change, which I already told Dan B., is that the if the chown fails (which it shouldn't) after creating the directory, then an attempt to remove the directory should be made, before exiting with an error.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/355/mkdir.patch\">mkdir.patch</a>\n916 bytes added by danb on 2011-May-24 16:05:38 UTC.\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-24 13:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/67b669c718c4af4693053d2e1a1bd03c5b0ae667\">[21963]</a></span>: Fixed privsep creating root-owned directories. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2189\" onclick=\"get_ticket_and_populate_wrapper('2189'); return false;\" title=\"privsep mkdir creates root-owned directory\">#2189</a></span> ===VersionHistory=== The privsep support in Condor could leave behind root-owned directories after encountering some types of errors.  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-May-27 14:21", "status": "resolved", "created": "2011-May-24 10:49", "fixed_version": "2011-May-24 10:49", "broken_version": "v070000", "priority": "2", "subsystem": "Security", "assigned_to": "zmiller", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "dan@hep.wisc.edu,zmiller@cs.wisc.edu,gthain@cs.wisc.edu", "due_date": ""}