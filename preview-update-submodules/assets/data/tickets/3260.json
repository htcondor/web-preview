{"id": 3260, "title": "Ticket #3260: startd crash when using MODIFY_REQUEST_EXPR", "description": "<blockquote>\nThe startd crashes shortly after emitting the following message in its logs:\n\n<p></p><div class=\"verbatim\">\n<pre>10/08/12 16:55:52 slot1: Changing state: Unclaimed -&gt; Matched\n10/08/12 16:55:53 Job no longer matches partitionable slot after MODIFY_REQUEST_EXPR_ edits, retrying w/o edits\n10/08/12 16:55:53 slot1: Partitionable slot can't be split to allocate a dynamic slot large enough for the claim\n</pre></div>\n\n\n<p>The problem appears to be that in this code path, req_classad is deleted inside initialize_resource() and then again after returning to the caller.  This bug appears to have been introduced in <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2819\" onclick=\"get_ticket_and_populate_wrapper('2819'); return false;\" title=\"fetchwork will claim existing dynamic slots but not allocate new ones\">#2819</a></span> when code was refactored into initialize_resource().\n\n</p><p>A workaround for this problem is to apply the following configuration:\n\n</p><p></p><pre>    MUST_MODIFY_REQUEST_EXPRS = True\n</pre>\n\n<p>I have a patch.  I'm waiting to find out whether it should land in V7_8_5-branch or V7_8-branch.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Oct-09 10:51:35 by tstclair:</em> <br/>\n\nI would think it worthy.\n\n<p></p><hr/>\n<em>2012-Oct-18 13:19:55 by johnkn:</em> <br/>\n\npatch looks good to me.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/642/modify_request_expr.patch\">modify_request_expr.patch</a>\n963 bytes added by danb on 2012-Oct-09 15:35:49 UTC.\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Oct-09 14:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9f8fae325c98661d6146f20dee25fb2cf9214870\">[33621]</a></span>: Edit 7.8.5 version history item. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3260\" onclick=\"get_ticket_and_populate_wrapper('3260'); return false;\" title=\"startd crash when using MODIFY_REQUEST_EXPR\">#3260</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Oct-09 12:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4fd38b00718ea0da13684d064ee6c267bf094462\">[33615]</a></span>: Fixed startd crash handling MODIFY_REQUEST_EXPR. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3260\" onclick=\"get_ticket_and_populate_wrapper('3260'); return false;\" title=\"startd crash when using MODIFY_REQUEST_EXPR\">#3260</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Oct-18 13:20", "status": "resolved", "created": "2012-Oct-09 10:34", "fixed_version": "2012-Oct-09 10:34", "broken_version": "v070803", "priority": "2", "subsystem": "", "assigned_to": "johnkn", "derived_from": "#3050", "creator": "danb", "rust": "a24261", "customer_group": "cms", "visibility": "public", "notify": "dan@hep.wisc.edu,adesmet@cs.wisc.edu,gthain@cs.wisc.edu,johnkn@cs.wisc.edu,tstclair@redhat.com", "due_date": ""}