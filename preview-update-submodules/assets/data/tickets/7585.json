{"id": 7585, "title": "Ticket #7585: STARTD_NAME is ignored if master or startd is started with -d flag", "description": "<blockquote>\nA user discovered that running passing the <code>\"-d\"</code> flag when starting condor causes the startd to ignore <code>STARTD_NAME</code>.  The <code>\"-d\"</code> flag is for \"dynamic directories\" and for <code>LOG, SPOOL,</code> and <code>EXECUTE</code> causes daemoncore to append the IP and pid to the directory names to attempt to make them unique.  However, it also <strong>replaces</strong> <code>STARTD_NAME</code> with &lt;pid&gt;@&lt;hostname&gt;.\n\n<p>This code is in <code>condor_daemon_core.cpp:handle_dynamic_dirs()</code>.  Similar to treatment of <code>LOG/SPOOL/EXECUTE</code> my proposal is to <strong>prepend</strong> the pid to the existing name, so the new <code>STARTD_NAME</code> will be &lt;pid&gt;@&lt;old_startd_name&gt;.\n\n</p><p>Note: this bug was noticed because when running HTCondor inside a container (e.g. Singularity) it is not uncommon for multiple startds running in separate containers to end up with the same internal (container-specific) pid, which they then advertise to the collector.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Apr-08 09:51:40 by tannenba:</em> <br/>\n\nAs this is a defect, seems like it should target the v8.8 branch, not v8.9.\nAlso you know the first known broken version is much earlier than v8.9, yes? :)\n\n<p></p><hr/>\n<em>2020-Apr-08 14:44:21 by zmiller:</em> <br/>\n\nIt's only really a \"bug\" if you are using containers.  It does something reasonable otherwise.  However, I doubt anyone is relying on this behavior in 8.8 so I'm fine putting it in stable.  This has also been a bug since 1999, so I updated the first known broken version to 6.0.0 for you.  :)\n\n<p></p><hr/>\n<em>2020-Apr-10 08:40:28 by gthain:</em> <br/>\n\n<strong>CODE REVIEW</strong>. Looks good to me.  I guess we can live with the hack of passing state across a re-exec through the environment, because I can't think of a better way off the top of my head.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-21 12:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c6c4f604c88c95d3328341d06ceaa3a52bfc3c4e\">[59435]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7585\" onclick=\"get_ticket_and_populate_wrapper('7585'); return false;\" title=\"STARTD_NAME is ignored if master or startd is started with -d flag\">#7585</a></span> in stable branch  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-17 13:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/35cf0513eca19d4b3bb37caf5358c7d5b572b07e\">[59396]</a></span>: Versions history for STARTD_NAME issue. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7585\" onclick=\"get_ticket_and_populate_wrapper('7585'); return false;\" title=\"STARTD_NAME is ignored if master or startd is started with -d flag\">#7585</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-09 11:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/020c8464abfd1f33d54e19f2334d71e18721df99\">[59289]</a></span>: Fix dynamic directories to not overwrite STARTD_NAME and to not keep expanding on restart. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7585\" onclick=\"get_ticket_and_populate_wrapper('7585'); return false;\" title=\"STARTD_NAME is ignored if master or startd is started with -d flag\">#7585</a></span>  (By zmiller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Apr-27 10:54", "status": "resolved", "created": "2020-Apr-08 08:23", "fixed_version": "2020-Apr-08 08:23", "broken_version": "v060000", "priority": "2", "subsystem": "DaemonMaster", "assigned_to": "zmiller", "derived_from": "", "creator": "zmiller", "rust": "", "customer_group": "users", "visibility": "public", "notify": "zmiller@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": "20200430"}