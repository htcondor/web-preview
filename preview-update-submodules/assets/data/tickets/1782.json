{"id": 1782, "title": "Ticket #1782: Report number of DAG nodes to dagman.out and classad", "description": "<blockquote>\nAfter DAGMan finishes parsing the DAG file(s), it should report the total number of nodes in the dagman.out file, and also put that value into its own classad.  (Suggested during today's LIGO phone conference.)</blockquote>", "remarks": "<blockquote>\nUpdated priority to match Todd's new scheme (1=fire, 2=soon, 3=time permitting, 4=not yet prioritized, 5=wishlist/ideas).\n\n<p></p><hr/>\n<em>2012-Mar-09 08:58:46 by nwp:</em> <br/>\n\nThis feature seems useless if <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2616\" onclick=\"get_ticket_and_populate_wrapper('2616'); return false;\" title=\"Create a command-line tool to communicate with DAGMan\">#2616</a></span> is implemented.\n\n<p></p><hr/>\n<em>2012-Dec-20 14:27:45 by wenger:</em> <br/>\n\nWould it also be useful to have some extra info in the classad, like the number of nodes in the queue, not ready, etc.?\n\n<p></p><hr/>\n<em>2012-Dec-20 14:46:37 by wenger:</em> <br/>\n\nThis is already in the dagman.out file.  There is a line like this:\n\n<p></p><pre>  Dag contains &lt;n&gt; total jobs\n</pre>\n\n<p>So it's just a matter of adding the info to the classad.\n\n</p><p></p><hr/>\n<em>2013-Mar-05 10:07:42 by pfc:</em> <br/>\n\nYes, adding this to the classad, along with the state of the DAG's execution (the number of nodes in the queue, not ready, etc) would be really useful.\n\n<p></p><hr/>\n<em>2013-Mar-06 16:01:48 by wenger:</em> <br/>\n\nHow about attribute names like this:\n<ul>\n<li>DAGNodesTotal\n</li><li>DAGNodesDone\n</li><li>DAGNodesPrerun\n</li><li>DAGNodesQueued\n</li><li>DAGNodesPostrun\n</li><li>DAGNodesReady\n</li><li>DAGNodesUnready\n</li><li>DAGNodesFailed\n</li></ul>\n\n<p></p><hr/>\n<em>2013-Mar-06 16:32:25 by wenger:</em> <br/>\n\nI just talked with Greg Thain about how DAGMan can actually edit its own classad.  He said basically do condor_qedit, or do what condor_qedit does under the hood.\n\n<p>He also asked an interesting question:  does DAGMan know whether it's a scheduler universe job?  In other words, what happens if you directly run condor_dagman from the command line?  I know that used to work, but I wonder what DAGMan gets as its job id in that case.\n\n</p><p>I'm thinking that I want to create a dagman_classadd.cpp/h to handle all of the classad-related stuff...\n\n</p><p></p><hr/>\n<em>2013-Mar-06 16:40:08 by wenger:</em> <br/>\n\nI'm also thinking that once I get this working I should see how long it takes to update the classad, and have a way to disable the updating if it's not real fast.\n\n<p></p><hr/>\n<em>2013-Mar-07 16:00:44 by wenger:</em> <br/>\n\nWorking on this on V7_9-gittrac_1782-branch.\n\n<p></p><hr/>\n<em>2013-Mar-21 17:31:17 by wenger:</em> <br/>\n\nI think this is all done, so I'm going to assign it to Nathan to review.\n\n<p></p><hr/>\n<em>2013-Mar-22 09:06:35 by nwp:</em> <br/>\n\nIt looks like this patch will disable running condor_dagman from the command line, something I have found useful for debugging.  condor_dagman won't be assigned a jobid, and then it will barf if strictness is sufficiently high.\n\n<p></p><hr/>\n<em>2013-Mar-22 09:11:09 by nwp:</em> <br/>\n\nYou do not check that _dagmanClassad is not null before calling Update.\n\n<p></p><hr/>\n<em>2013-Mar-22 10:15:09 by wenger:</em> <br/>\n\nOkay, I'll add a check for _dagmanClassad being NULL.  As far as running from the command line, this should only fail if you have the strictness level set to 3 (the highest level).  I guess I could get rid of the strictness level check, since if you're running from the command line you clearly don't expect to get anything updated in a classad.  Anything else?\n\n<p></p><hr/>\n<em>2013-Mar-22 11:13:49 by nwp:</em> <br/>\n\nNo, I think everything else looks fine.\n\n<p></p><hr/>\n<em>2013-Mar-22 13:43:33 by wenger:</em> <br/>\n\nOkay, I'll go ahead and merge unless you want to check the latest changes.  (BTW, I did test running DAGMan on the command line, and it worked okay -- as long as you have all the right arguments and environment.)\n\n<p></p><hr/>\n<em>2013-Mar-22 14:29:14 by nwp:</em> <br/>\n\nLooks fine to me. go ahead and merge.\n\n<p></p><hr/>\n<em>2013-Mar-22 15:52:36 by wenger:</em> <br/>\n\nThis is now merged to V7_9_5-branch.  I'll resolve the ticket as soon as I see that the builds are all okay.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=3596\" onclick=\"get_ticket_and_populate_wrapper('3596'); return false;\" title=\"Add *running* job count to classad and node status file\">#3596</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd <strong>running</strong> job count to classad and node status file</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3863\" onclick=\"get_ticket_and_populate_wrapper('3863'); return false;\" title=\"DAGMan shouldn't set logging flags when updating its job ad\">#3863</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDAGMan shouldn't set logging flags when updating its job ad</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-02 13:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/66a3eee292bea7e0ff207bdf82b014e1975f9291\">[35308]</a></span>: edit defns of new condor_dagman job <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> attributes, as well as move defns to manual section listing job attributes and alphabetize list ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1782\" onclick=\"get_ticket_and_populate_wrapper('1782'); return false;\" title=\"Report number of DAG nodes to dagman.out and classad\">#1782</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-22 13:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d5363f039b6aefaabe59c8f9fa0680ab4955c79f\">[35267]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1782\" onclick=\"get_ticket_and_populate_wrapper('1782'); return false;\" title=\"Report number of DAG nodes to dagman.out and classad\">#1782</a></span>: Minor fixes after code review by Nathan.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-21 17:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/35079ce0d7c024c6c0dcd0d590ed8b56b28c8f39\">[35257]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1782\" onclick=\"get_ticket_and_populate_wrapper('1782'); return false;\" title=\"Report number of DAG nodes to dagman.out and classad\">#1782</a></span>: Oops -- one more cleanup.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-21 17:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4898dd667e6fd5dcb7dbe96d99fb14b044f73a29\">[35256]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1782\" onclick=\"get_ticket_and_populate_wrapper('1782'); return false;\" title=\"Report number of DAG nodes to dagman.out and classad\">#1782</a></span>: Finished code cleanup, updated the manual (version history plus details).  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-14 16:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7bf53fa905bfb16df91ecab9a9134080f304500f\">[35166]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1782\" onclick=\"get_ticket_and_populate_wrapper('1782'); return false;\" title=\"Report number of DAG nodes to dagman.out and classad\">#1782</a></span>: added job_dagman_classad test to test this. (Forgot to git add the latest versions of some stuff the first time around.)  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-14 16:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5ec960bb0de60eb536979fd78426b84c111a8f8c\">[35165]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1782\" onclick=\"get_ticket_and_populate_wrapper('1782'); return false;\" title=\"Report number of DAG nodes to dagman.out and classad\">#1782</a></span>: added job_dagman_classad test to test this.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-11 17:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1663704bf8d95d3acf31e628bf63d4ac0d113307\">[35126]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1782\" onclick=\"get_ticket_and_populate_wrapper('1782'); return false;\" title=\"Report number of DAG nodes to dagman.out and classad\">#1782</a></span>: all cleaned up except for a couple of things I need to check; still needs documentation.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-11 16:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/98aade7f5af869b17e4c9f9c39f5d1c5ebff44b6\">[35122]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1782\" onclick=\"get_ticket_and_populate_wrapper('1782'); return false;\" title=\"Report number of DAG nodes to dagman.out and classad\">#1782</a></span>: mostly cleaned up -- just need a few more error checks, etc. We also print out the node status, and update the classad, at startup as soon as we have parsed the DAG and updated node status if there is a rescue DAG.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-08 17:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d70abc87cadf45c1070c8f93db2010dafc0daa5e\">[35113]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1782\" onclick=\"get_ticket_and_populate_wrapper('1782'); return false;\" title=\"Report number of DAG nodes to dagman.out and classad\">#1782</a></span>: got rid of most of the debug code.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-08 16:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4d46b52f62ac33c941a7777527aeb0535b741531\">[35112]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1782\" onclick=\"get_ticket_and_populate_wrapper('1782'); return false;\" title=\"Report number of DAG nodes to dagman.out and classad\">#1782</a></span>: got this to work now (still needs cleanup and removal of lots of debug code). The problem was that for DAGMan we're passing the command-line argument \"-l .\" (so that we don't cd into the regular LOG directory) -- but that was goofing up the SCHEDD_ADDRESS_FILE and SCHEDD_DAEMON_AD_FILE\u00a0[...]\n (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-07 16:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f33bf3c05c0d16e318eae5c7440e578476d3cdb9\">[35101]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1782\" onclick=\"get_ticket_and_populate_wrapper('1782'); return false;\" title=\"Report number of DAG nodes to dagman.out and classad\">#1782</a></span>: initial (not fully functional) version -- having trouble getting the schedd address -- following the example of condor_qedit doesn't work, I think because the daemoncore stuff in DAGMan has already created a Daemon object... (Also has a bunch of extra debug code in some of the daemon code.)\u00a0[...]\n (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Apr-02 13:19", "status": "defer", "created": "2010-Nov-19 14:10", "fixed_version": "2010-Nov-19 14:10", "broken_version": "v070504", "priority": "5", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "wenger@cs.wisc.edu, pfcouvar@syr.edu,pcouvare@caltech.edu", "due_date": ""}