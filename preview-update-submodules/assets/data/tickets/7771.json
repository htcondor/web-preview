{"id": 7771, "title": "Ticket #7771: Support spooled submits with the Submit object", "description": "<blockquote>\nThe old <code>Schedd.submit</code> interface supports spooled submits, but the new <code>Submit.queue</code> interface does not. It should.\n\n<p>API changes:\n\n</p><p></p><ul>\n<li>The <code>Submit.queue</code> and <code>Submit.queue_with_itemdata</code> methods both need a <code>spool</code> keyword argument that defaults to <code>False</code>.\n</li><li>We need to expose the <code>SubmitResult</code> method for capturing <code>ad_results</code>, which TJ says exists, but is not public.\n</li></ul>\n\n<p>Internals: whatever TJ says to do.\n\n</p><p></p><hr/>\nThe above is slightly a lie... it does kind of support it, but you have to do all the work manually...\n\n<p></p><div class=\"code\">\n<pre class=\"code\">TEN_DAYS = 60 * 60 * 24 * 10\nCOMPLETION_DATE = \"CompletionDate\"\n\nsub = htcondor.Submit(\n    {\n        \"executable\": \"/bin/cat\",\n        \"arguments\": \"README.md\",\n        \"transfer_input_files\": \"README.md\",\n        \"output\": \"test.out\",\n        \"error\": \"test.err\",\n        \"held\": \"true\",\n        \"My.HoldReason\": classad.quote(\"Spooling input files\"),\n        \"My.HoldReasonCode\": \"16\",\n        \"My.LeaveJobInQueue\": \"true\",\n        \"transfer_output_remaps\": classad.quote(\n            \"_condor_stdout=test.out ; _condor_stderr=test.err\"\n        ),\n    }\n)\n\nschedd = htcondor.Schedd()\n\nads = []\nwith schedd.transaction() as txn:\n    result = sub.queue(txn, ad_results=ads)\n\nschedd.spool(ads)\n</pre></div>\n\n\n<p>... and then later calling <code>schedd.retrieve</code>. Obviously we don't want to make users have to add so much nonsense to their submit descriptions.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Jul-30 17:32:47 by karpel:</em> <br/>\n\nForgot to mention: something interesting to note is that there's a modification I didn't have to make that <code>submit_utils</code> does, which if I do, makes it not work: changing the output and error file names to <code>_condor_std{out,err}</code>. I tried a few different ways, but they generally result in not getting them at all because the <code>transfer_output_remaps</code> don't seem to fire (I get files named <code>_condor_std{out,err}</code> in the spool directory).\n\n<p></p><hr/>\n<em>2020-Aug-04 11:46:59 by karpel:</em> <br/>\n\nThis is partial duplicate of <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=6790\" onclick=\"get_ticket_and_populate_wrapper('6790'); return false;\" title=\"Submit object in python bindings needs a spool flag\">#6790</a></span>\n\n<p></p><hr/>\n<em>2020-Sep-14 13:14:29 by johnkn:</em> <br/>\n\nThis is made obsolete by <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7853\" onclick=\"get_ticket_and_populate_wrapper('7853'); return false;\" title=\"python submit method on schedd object should take a Submit object\">#7853</a></span>?</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-04 12:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4810095869bac03b1a4e3cfa8f3ee0aa74614fec\">[60341]</a></span>: (<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=7771\" onclick=\"get_ticket_and_populate_wrapper('7771'); return false;\" title=\"Support spooled submits with the Submit object\">#7771</a></span>) document htcondor.Schedd.retrieve  (By Josh Karpel )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Oct-05 14:33", "status": "abandoned", "created": "2020-Jul-30 17:18", "fixed_version": "2020-Jul-30 17:18", "broken_version": "", "priority": "3", "subsystem": "PythonBinding", "assigned_to": "johnkn", "derived_from": "#6790", "creator": "karpel", "rust": "", "customer_group": "other", "visibility": "public", "notify": "karpel@wisc.edu, johnkn@cs.wisc.edu", "due_date": ""}