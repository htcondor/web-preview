{"id": 4884, "title": "Ticket #4884: Starter should export OMP_NUM_THREADS to job environment", "description": "<blockquote>\nPrograms built with OpenMP, including Matlab, gnu sort (!) and many others, look to the environment variable OMP_NUM_THREADS to determine how many threads to spawn.  If not set, they default to spawning as many threads as the machine has cores.  We are seeing a number of examples in CHTC and OSG where a user will submit a job with RequestCPUs = 1, and the openMP code will then spawn many cores.  If every job that lands on a machine does this, we end up with n^2 threads running, and a very slow machine.\n\n<p>By forcing OMP_NUM_THREADS to the number of cores provisioned on the machine, we should mitigate the damage this causes.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6606\" onclick=\"get_ticket_and_populate_wrapper('6606'); return false;\" title=\"Don't overwrite OMP_NUM_THREADS env variable if user has set it\">#6606</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDon't overwrite OMP_NUM_THREADS env variable if user has set it</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7296\" onclick=\"get_ticket_and_populate_wrapper('7296'); return false;\" title=\"Starter should export more vars than just OMP_NUM_THREADS\">#7296</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nStarter should export more vars than just OMP_NUM_THREADS</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-23 11:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/20ea5d452d153b1d861fa2279206bbf036f9216f\">[43439]</a></span>: edit and format 8.3.4 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4884\" onclick=\"get_ticket_and_populate_wrapper('4884'); return false;\" title=\"Starter should export OMP_NUM_THREADS to job environment\">#4884</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-12 10:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c34ef4ab4c71ffe92a055e1a66a771d818fecd6a\">[43343]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4884\" onclick=\"get_ticket_and_populate_wrapper('4884'); return false;\" title=\"Starter should export OMP_NUM_THREADS to job environment\">#4884</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-12 10:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6cb990bd5cf17befd159de8c7ca2eb3d82b9ec3f\">[43342]</a></span>: Export OMP_NUM_THREADS = cpus to the job environ <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4884\" onclick=\"get_ticket_and_populate_wrapper('4884'); return false;\" title=\"Starter should export OMP_NUM_THREADS to job environment\">#4884</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Nov-11 08:22", "status": "resolved", "created": "2015-Feb-12 10:43", "fixed_version": "2015-Feb-12 10:43", "broken_version": "v080000", "priority": "3", "subsystem": "DaemonsExecNode", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": "20150212"}