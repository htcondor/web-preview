{"id": 4093, "title": "Ticket #4093: RemoteGroupQuota incorrect in PREEMPTION_REQUIREMENTS with surplus", "description": "<blockquote>\nWith Group quotas and surplus sharing on, when PREEMPTION_REQUIREMENTS are evaluated, the attributes <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RemoteGroupQuota\" title=\"Remote Group Quota\">RemoteGroupQuota</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SubmitterGroupQuota\" title=\"Submitter Group Quota\">SubmitterGroupQuota</a></span> are set not to the configured quota value, but rather to the quota + alloted surplus.  This makes preemption decisions difficult.\n\n<p>To reproduce, set the following in the config file\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">GROUP_NAMES = group_physics, group_chemistry\nGROUP_QUOTA_group_physics = 20\nGROUP_QUOTA_group_chemistry = 10\nGROUP_ACCEPT_SURPLUS = true\nPREEMPTION_REQUIREMENTS = debug((SubmitterGroupResourcesInUse &lt; SubmitterGroupQuota) &amp;&amp; (RemoteGroupResourcesInUse &gt; RemoteGroupQuota) &amp;&amp; ( RemoteGroup =!= SubmitterGroup))\nNUM_CPUS = 0\n</pre></div>\n\n\n<p>Submit 40 jobs with +AccountingGroup = group_physics.someUser, and 30 should run.  Submit 40 more jobs with +AccountingGroup = group_chemistry.anotherUser, and none will run.  Look at the Negotiator log , and the classad debug will show\nthat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RemoteGroupQuota\" title=\"Remote Group Quota\">RemoteGroupQuota</a></span> is not 20 but 30, so the preemption will never fire.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Nov-21 14:59:19 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This change looks good.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Dec-03 09:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9f178965330aaec483d40a0c296337cf03ce95ed\">[38910]</a></span>: edit 8.0.5 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4093\" onclick=\"get_ticket_and_populate_wrapper('4093'); return false;\" title=\"RemoteGroupQuota incorrect in PREEMPTION_REQUIREMENTS with surplus\">#4093</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Nov-21 14:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f16b1231433200c26287072babab65dcbed924a8\">[38802]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4093\" onclick=\"get_ticket_and_populate_wrapper('4093'); return false;\" title=\"RemoteGroupQuota incorrect in PREEMPTION_REQUIREMENTS with surplus\">#4093</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Nov-21 14:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a57dc03c4439d9d61f1b23ddc0d07d22a55214d8\">[38799]</a></span>: Fix bug with PREEMPTION_REQUIREMENTS and surplus sharing <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4093\" onclick=\"get_ticket_and_populate_wrapper('4093'); return false;\" title=\"RemoteGroupQuota incorrect in PREEMPTION_REQUIREMENTS with surplus\">#4093</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Nov-22 09:27", "status": "resolved", "created": "2013-Nov-21 14:25", "fixed_version": "2013-Nov-21 14:25", "broken_version": "v080000", "priority": "1", "subsystem": "DaemonsCM", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "ben.cotton@cyclecomputing.com", "due_date": "20131122"}