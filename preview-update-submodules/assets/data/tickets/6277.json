{"id": 6277, "title": "Ticket #6277: Gridmanager submits jobs to wrong remote blahp with --rgahp args", "description": "<blockquote>\nWhen a user is submitting grid universe jobs to multiple remote batch systems via the remote_gahp, jobs can end up going to the wrong system. This happens when the grid_resource line contains command-line arguments for the remote_gahp that precede the user@hostname field.\n\n<p>When using grid-type batch to submit jobs to a remote cluster via ssh (aka bosco), the user can supply arguments in the grid_resource line that modify how the remote machine is contacted (which ssh keys to use, where the blahp is installed on the remote machine). These can be provided before or after the user@hostname field. The following are equivalent:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">grid_resource = batch slurm me@submit.foo.edu --rgahp-key bosco.rsa\n</pre></div>\n\n<div class=\"code\">\n<pre class=\"code\">grid_resource = batch slurm --rgahp-key bosco.rsa me@submit.foo.edu\n</pre></div>\n\n\n<p>But the gridmanager assumes only the first form will be used. For batch jobs, it only looks at the first three fields of grid_resource to determine which jobs should share the same gahp server. Thus, if the second form is used, jobs destined for different machines can all end up using the same remote blahp, which goes to only one of those machines.\n\n</p><p>The gridmanager should be changed so that the entire contents of grid_resource are used to determine if two jobs have the same destination (and can share a blahp instantiation).</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Jun-15 10:30:06 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Code looks fine and will solve the problem.  However, it will also create two GAHPs for the given example, which may be suboptimal.  Would it make more sense to sort the argument array before stringifying it into the GAHP name?\n\n</p><p></p><hr/>\n<em>2017-Jun-16 14:40:31 by jfrey:</em> <br/>\n\nA naive sort of the fields in <code>GridResource</code> could cause the gridmanager to conclude two values are equivalent when they aren't. For example, a user could store their ssh keys in a file whose name looks matches the hostname of one of their remote cluster submit nodes. And I don't want write an intelligent sort algorithm, which must be kept in sync with changes to the remote_gahp's command line arguments.\n\n<p>I believe it's acceptable if when a user submits two jobs with different but equivalent <code>GridResource</code> lines, they get two gahps.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-20 11:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4a17fc3a3d6f8f3757fc0a63e7d9cc5e1a9dee30\">[51752]</a></span>: Docs for jobs going to wrong blahp bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6277\" onclick=\"get_ticket_and_populate_wrapper('6277'); return false;\" title=\"Gridmanager submits jobs to wrong remote blahp with --rgahp args\">#6277</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-23 15:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1632ecf260a3e1481273dbc0366fbc6a93d6d1ff\">[50707]</a></span>: Consider all grid_resource fields for mapping batch jobs to gahps. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6277\" onclick=\"get_ticket_and_populate_wrapper('6277'); return false;\" title=\"Gridmanager submits jobs to wrong remote blahp with --rgahp args\">#6277</a></span> All arguments to the remote_gahp that appear in grid_resource may be significant for deciding that two jobs need seperate remote blahp invocations. Previously, only the first argument was considered. Not only can the user@hostname\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Jun-20 11:34", "status": "resolved", "created": "2017-May-22 16:30", "fixed_version": "2017-May-22 16:30", "broken_version": "v080500", "priority": "3", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "a31708", "customer_group": "fermi", "visibility": "public", "notify": "", "due_date": ""}