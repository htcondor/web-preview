{"id": 2275, "title": "Ticket #2275: Startd RANK will only preempt if user priorities allow it", "description": "<blockquote>\nA bug introduced back in v7.3.2 in support of slot weights appears to have broken the processing of startd RANK such that startd RANK preemption only occurs if the preempting user has sufficient user priority to claim another machine.\n\n<p>Scenario and Negotiator log snippet from condor-users that exhibits the problem:\n</p><div class=\"code\">\n<pre class=\"code\"> user A has an EUP of\n1000 and user B of 100000 and we have 8 slots user A gets all. However, we\nwant to give user B the possibility to move into certain slots and hence set\nthe machine RANK to something like this:\n\nRank = IfThenElse(WantGPU =?= true,1000,0)\n\n(also with prefix TARGET.)\n\nUser A does not have this set, should thus have a lower Rank than User B (me),\nhowever, it seems this does not help:\n\n06/28/11 14:25:55 Socket to carsten@test.atlas.local (&lt;10.20.40.16:35426&gt;)\nalready in cache, reusing\n06/28/11 14:25:55     Over submitter resource limit (0.000000, used 0.000000)\n... only consider startd ranks\n06/28/11 14:25:55     Sending SEND_JOB_INFO/eom\n06/28/11 14:25:55     Getting reply from schedd ...\n06/28/11 14:25:55     Got JOB_INFO command; getting classad/eom\n06/28/11 14:25:55     Request 00102.00000:\n06/28/11 14:25:55 matchmakingAlgorithm: limit 0.000000 used 0.000000 pieLeft\n0.000000\n\n06/28/11 14:25:55       Rejected 102.0 carsten@test.atlas.local\n&lt;10.20.40.16:35426&gt;: fair share exceeded\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Jun-28 14:58:31 by tannenba:</em> <br/>\n\nPatch below already pushed to V7_6-branch, assigning to Dan for a code review.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-28 17:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f84fb062cfb4f973b6ca610ff22db495214a1b28\">[22331]</a></span>: Added a test to confirm that startd rank trumps user priority. <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2275\" onclick=\"get_ticket_and_populate_wrapper('2275'); return false;\" title=\"Startd RANK will only preempt if user priorities allow it\">#2275</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-28 16:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e7c00bec5745952beae27cbeb22ae2e568763c17\">[22328]</a></span>: Another fix for startd rank trumping user priority. <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2275\" onclick=\"get_ticket_and_populate_wrapper('2275'); return false;\" title=\"Startd RANK will only preempt if user priorities allow it\">#2275</a></span> It should trump even when we are not only considering startd rank.  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-28 14:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f2b117af43eadff6fd3c5b1e4e3d443e3e5dbdbb\">[22311]</a></span>: If negotiating only for startd rank, do NOT check user priority limits. Preemption due to startd rank should trump user priority.\u00a0[...]\n (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Jun-29 13:19", "status": "defer", "created": "2011-Jun-28 11:27", "fixed_version": "2011-Jun-28 11:27", "broken_version": "v070302", "priority": "5", "subsystem": "Daemons", "assigned_to": "tannenba", "derived_from": "", "creator": "tannenba", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "tstclair@redhat.com,dan@hep.wisc.edu, tannenba@cs.wisc.edu,pcouvare@caltech.edu", "due_date": ""}