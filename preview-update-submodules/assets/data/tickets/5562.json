{"id": 5562, "title": "Ticket #5562: per-job history files may briefly appear to be empty or incomplete", "description": "<blockquote>\nWhen specifying <code>PER_JOB_HISTORY_DIR</code>, the per-job history files may briefly appear to be empty or incomplete if they are being read at the same time HTCondor is writing them.\n\n<p>Propose a patch to make writing of the per-job history files atomic by writing into a temporary file named <code>.history.xxx.tmp</code>, and then doing an atomic rename to <code>history.xxxx</code> after writing is complete.  If the atomic rename fails for whatever reason, the temporary file should be removed.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Mar-16 14:38:54 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This change looks good.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-15 18:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/84494861fd2ff0743b8a48ceff12401ef619e572\">[48034]</a></span>: Added version history blurb for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5562\" onclick=\"get_ticket_and_populate_wrapper('5562'); return false;\" title=\"per-job history files may briefly appear to be empty or incomplete\">#5562</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-15 17:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9a568addfe571b7a76760bb72f2c57a103997e18\">[48030]</a></span>: Write out per-job history files atomically. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5562\" onclick=\"get_ticket_and_populate_wrapper('5562'); return false;\" title=\"per-job history files may briefly appear to be empty or incomplete\">#5562</a></span> Make writing of the per-job history files atomic by first writing to a temp file and doing a rename. This prevents per-job history files from appearing to be empty or incomplete if they are being read at the same time HTCondor is writing them.  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Mar-16 15:48", "status": "resolved", "created": "2016-Mar-15 16:55", "fixed_version": "2016-Mar-15 16:55", "broken_version": "v080200", "priority": "3", "subsystem": "Libs", "assigned_to": "tannenba", "derived_from": "", "creator": "tannenba", "rust": "", "customer_group": "cern", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}