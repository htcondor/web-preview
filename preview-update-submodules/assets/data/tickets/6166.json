{"id": 6166, "title": "Ticket #6166: Add late materialization of jobs to the SCHEDD in 8.7", "description": "<blockquote>\nThis is the parent ticket for late materialization of jobs in the 8.7 and 8.9 series.  <a class=\"external\" href=\"https://docs.google.com/document/d/1p-Im8enK0LsPt4dxERt9r7YdLwKTuN0NHilfg41X1p8/edit#heading=h.4rs9ml96n935\">Design doc is in Google docs</a>.\n\n<p>Remaining work for 8.9 series\n\n</p><p></p><ul>\n<li>Have Schedd set x509 proxy attrs into the cluster ad\n</li><li>Add error handling into condor_submit/schedd for x509 proxy where the proxy file varies for each proc (this will not be allowed)\n</li><li>fix correctness issues with the use of param() calls while building the jobad. Most of these can be fixed by taking the param value into account while building the submit digest.\n<ul>\n<li>SUBMIT_ATTRS that are +Attr\n</li><li>JOB_DEFAULT_LEASE_DURATION\n</li><li>JOB_DEFAULT_NOTIFICATION\n</li><li>JOB_DEFAULT_REQUESTCPUS/DISK/MEMORY\n</li><li>APPEND_REQUIREMENTS\n</li><li>DEFAULT_RANK/APPEND_RANK\n</li><li>FILESYSTEM_DOMAIN\n</li><li>CREDD_HOST (windows only)\n</li></ul>\n</li><li>do not expand $RANDOM_*() macros at submit time.\n</li><li>allow remote submission (spooling)\n</li><li>split file transfer list into a shared files list and per-job files list. Adding this would probably make spooling easier.\n</li><li>apply SUBMIT_REQUIREMENTs (and SUBMIT_TRANSFORMs?) to the cluster ad\n</li><li>autocluster the cluster ad  when all job-specific attributes are not significant\n</li><li>materialize on match when all job-specific attributes are not significant\n</li><li>report non-materialized jobs as 'idle' jobs to condor_q -batch</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2020-Apr-10 07:46:13 by tim:</em> <br/>\n\nBulk change of target version from v080906 to v080907 using ticket-target-mover.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6181\" onclick=\"get_ticket_and_populate_wrapper('6181'); return false;\" title=\"condor_submit should use submit_utils\">#6181</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\ncondor_submit should use submit_utils</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6212\" onclick=\"get_ticket_and_populate_wrapper('6212'); return false;\" title=\"Milestone 1 for schedd late materialization\">#6212</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nMilestone 1 for schedd late materialization</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=6228\" onclick=\"get_ticket_and_populate_wrapper('6228'); return false;\" title=\"Milestone 2 for schedd late materialization\">#6228</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nMilestone 2 for schedd late materialization</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6246\" onclick=\"get_ticket_and_populate_wrapper('6246'); return false;\" title=\"job materialization in the schedd should not do file checks\">#6246</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\njob materialization in the schedd should not do file checks</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6272\" onclick=\"get_ticket_and_populate_wrapper('6272'); return false;\" title=\"condor_q reports wrong totals for materialized jobs\">#6272</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\ncondor_q reports wrong totals for materialized jobs</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6378\" onclick=\"get_ticket_and_populate_wrapper('6378'); return false;\" title=\"Milestone 3 for schedd late materialization\">#6378</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nMilestone 3 for schedd late materialization</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6723\" onclick=\"get_ticket_and_populate_wrapper('6723'); return false;\" title=\"Late Materialization jobs handle getenv=true incorrectly\">#6723</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nLate Materialization jobs handle getenv=true incorrectly</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=6724\" onclick=\"get_ticket_and_populate_wrapper('6724'); return false;\" title=\"condor_submit should determine spool files for late materialization\">#6724</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\ncondor_submit should determine spool files for late materialization</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6802\" onclick=\"get_ticket_and_populate_wrapper('6802'); return false;\" title=\"Document late materialization for the 8.8 series\">#6802</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDocument late materialization for the 8.8 series</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=6807\" onclick=\"get_ticket_and_populate_wrapper('6807'); return false;\" title=\"late materialization digest should support $RANDOM() expansions\">#6807</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nlate materialization digest should support $RANDOM() expansions</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6818\" onclick=\"get_ticket_and_populate_wrapper('6818'); return false;\" title=\"change submit keyword from materialize_max_idle to max_idle\">#6818</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nchange submit keyword from materialize_max_idle to max_idle</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6972\" onclick=\"get_ticket_and_populate_wrapper('6972'); return false;\" title=\"Add x509 proxy support with late materialized jobs\">#6972</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd x509 proxy support with late materialized jobs</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6999\" onclick=\"get_ticket_and_populate_wrapper('6999'); return false;\" title=\"submit digest Cmd should not be full path for all Grid and VM jobs\">#6999</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nsubmit digest Cmd should not be full path for all Grid and VM jobs</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7044\" onclick=\"get_ticket_and_populate_wrapper('7044'); return false;\" title=\"param calls in submit_utils should happen only when used by tools\">#7044</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nparam calls in submit_utils should happen only when used by tools</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7129\" onclick=\"get_ticket_and_populate_wrapper('7129'); return false;\" title=\"Late materialization may not generate correct requirements\">#7129</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nLate materialization may not generate correct requirements</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=7130\" onclick=\"get_ticket_and_populate_wrapper('7130'); return false;\" title=\"User requirements from submit file should get their own job attribute\">#7130</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nUser requirements from submit file should get their own job attribute</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7148\" onclick=\"get_ticket_and_populate_wrapper('7148'); return false;\" title=\"do not default to late materialization for single proc submissions\">#7148</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\ndo not default to late materialization for single proc submissions</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7166\" onclick=\"get_ticket_and_populate_wrapper('7166'); return false;\" title=\"Schedd should materialize more than one job per transaction\">#7166</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nSchedd should materialize more than one job per transaction</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7178\" onclick=\"get_ticket_and_populate_wrapper('7178'); return false;\" title=\"new materialization is not triggered when jobs begin to run\">#7178</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nnew materialization is not triggered when jobs begin to run</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7743\" onclick=\"get_ticket_and_populate_wrapper('7743'); return false;\" title=\"late materialize digest puts slice and from in the wrong order\">#7743</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nlate materialize digest puts slice and from in the wrong order</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2020-Oct-01 09:31", "status": "active", "created": "2017-Mar-02 17:09", "fixed_version": "2017-Mar-02 17:09", "broken_version": "", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}