{"id": 1579, "title": "Ticket #1579: Fix collector query expressions", "description": "<blockquote>\nQuery ads are sent to the collector to query for and invalidate groups of ads. They include a requirements expression that filters the desired ads. The collector does a one-way match between the query ad and the candidate ads. Clients use expressions with a mixture of TARGET-scoped and unscoped attribute references. These will cause problems when we start using new ClassAd's strict scoping rules.\n\n<p>The new standard will be that the requirements expression of query ads should not have any TARGET scoping. The expression will be evaluated directly in the context of each candidate ad. Here are some reasons why:\n</p><ul>\n<li>No current expression references attributes in the query ad\n</li><li>Most current expressions have no TARGET-scoping\n</li><li>Some expressions come from the user and won't have TARGET-scoping</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Aug-16 11:41:32 by jfrey:</em> <br/>\n\nPushed changes to master for 7.5.4. Query ads no longer use TARGET. scoping in their requirements. For now, the collector inserts TARGET. scoping and evaluates the expression using IsAHalfMatch(). This will be changed later.\n\n<p></p><hr/>\n<em>2010-Aug-16 16:34:07 by jfrey:</em> <br/>\n\nPushed more changes to master for 7.5.4. The collector no longer uses IsAHalfMatch() to filter ads for a query.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1580\" onclick=\"get_ticket_and_populate_wrapper('1580'); return false;\" title=\"Fix some generic ads from daemons\">#1580</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nFix some generic ads from daemons</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Aug-16 16:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/be7ec735356a8d026e75fbc97ab83f3101209feb\">[18808]</a></span>: Optimize query processing in collector <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1579\" onclick=\"get_ticket_and_populate_wrapper('1579'); return false;\" title=\"Fix collector query expressions\">#1579</a></span> Now that queries sent to the collector don't use TARGET. scoping, we can be more efficient in applying the filter expression to ads. We no longer use a match ad to do a one-way match. We cache a pointer to the expression and evaluate it directly against each\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Aug-16 11:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/72c93125ffd236e19ddb866316dd8515fa19f044\">[18801]</a></span>: Remove TARGET. from expressions in query ads to collector <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1579\" onclick=\"get_ticket_and_populate_wrapper('1579'); return false;\" title=\"Fix collector query expressions\">#1579</a></span> The requirements expression of query ads sent to the collector should no longer contain 'TARGET.' scoping for any attribute references. This is part of the transition to new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> scoping rules.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Aug-16 11:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6c17f0081414f3537515f8d1022fcb7732011111\">[18802]</a></span>: Remove option in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GenericQuery\" title=\"Generic Query\">GenericQuery</a></span> for adding TARGET. scoping <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1579\" onclick=\"get_ticket_and_populate_wrapper('1579'); return false;\" title=\"Fix collector query expressions\">#1579</a></span> The requirements expression of query ads sent to the collector should no longer contain 'TARGET.' scoping for any attribute references. Thus <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GenericQuery\" title=\"Generic Query\">GenericQuery</a></span> doesn't require this feature.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Nov-19 07:05", "status": "resolved", "created": "2010-Aug-13 15:34", "fixed_version": "2010-Aug-13 15:34", "broken_version": "v070502", "priority": "4", "subsystem": "", "assigned_to": "jfrey", "derived_from": "#1109", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}