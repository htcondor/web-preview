{"id": 1645, "title": "Ticket #1645: Windows matchmaking problems ImageSize/RequestMemory", "description": "<blockquote>\nThere are sporadic reports of jobs not matching machines that they should.  We haven't reproduced it yet, and have no reason to expect a problem, but there are enough reports that we should keep an eye on it.\n\n<p>The shared symptoms are: 1. jobs don't run, 2. condor_analyze (with the new, automatic better-analyze functionality) are pinning the blame on this (or a very similar) expression matching 0 machines:\n\n</p><p></p><div class=\"blockquote\">\n<table width=\"95%\"><tbody><tr><td>\u00a0</td><td>\n  \n  ( ( ( 1024 * target.Memory ) &gt;= 1250 ) &amp;&amp; ( ( 1024 * ceiling(ifThenElse(JobVMMemory isnt undefined,JobVMMemory,1.220703125000000E+000)) )\n&gt;= 1250 ) )\n</td></tr></tbody></table></div>\n\n\n<p>Reports:\n\n</p><p></p><ol>\n<li>condor-admin #20919 - Central manager/execute: 7.4.3, Win 64.  Submit : 7.4.3, Win 32.\n\n<p></p></li><li><a class=\"external\" href=\"https://lists.cs.wisc.edu/archive/condor-users/2010-September/msg00000.shtml\">condor-users user 1</a>.  Actual problem may be a firewall, but why did better-analyze suggest that the Memory/ImageSize/JobVMMemory part is invalid?\n\n<p></p></li><li><a class=\"external\" href=\"https://lists.cs.wisc.edu/archive/condor-users/2010-August/msg00225.shtml\">condor-users user 2</a>.</li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Sep-07 16:15:26 by matt:</em> <br/>\n\nIs anyone using debug() in their Requirements to figure this out?\n\n<p>qedit works wonders with debug()\n\n</p><p></p><hr/>\n<em>2010-Sep-07 16:22:06 by tstclair:</em> <br/>\n\nThis may be a wild goose chase, given that one user corrected his issues by altering firewall settings, and the expression was completely valid.\n\n<p>I can not repro as well.\n\n</p><p></p><hr/>\n<em>2010-Sep-08 15:49:51 by adesmet:</em> <br/>\n\nSomething is clearly wrong, but the broken part may be better-analyze.\n\n<p></p><hr/>\n<em>2010-Oct-04 09:32:50 by tannenba:</em> <br/>\n\nAccording to Dan Bradley: Data point - this problem impacts v7.4.2 but not v7.5.4.\n\n<p>Maybe the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> external is not current in v7.4.x on Windows?\n\n</p><p></p><hr/>\n<em>2010-Oct-04 17:03:12 by dwm:</em> <br/>\n\nWe had a case in August when an end-user was attempting to run a\nlarge number of jobs, but none of them were executing.  Here was the output of\n<code>-better-analyze</code> on one of them:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">-- Schedd: midnight.doc.ic.ac.uk : &lt;146.169.5.91:43500&gt;\n---\n600.000:  Run analysis summary.  Of 438 machines,\n     438 are rejected by your job's requirements\n       0 reject your job because of their own requirements\n       0 match but are serving users with a better priority in the pool\n       0 match but reject the job for unknown reasons\n       0 match but will not currently preempt their existing job\n       0 match but are currently offline\n       0 are available to run your job\n         No successful match recorded.\n         Last failed match: Sun Aug 22 18:27:55 2010\n         Reason for last match failure: no match found\n\nWARNING:  Be advised:\n    No resources matched request's constraints\n\nThe Requirements expression for your job is:\n\n( ( target.DoC_OS_Distribution == target.Ubuntu ) ) &amp;&amp;\n( target.Arch == \"INTEL\" ) &amp;&amp; ( target.OpSys == \"LINUX\" ) &amp;&amp;\n( target.Disk &gt;= DiskUsage ) &amp;&amp; ( ( ( target.Memory * 1024 ) &gt;= ImageSize ) &amp;&amp;\n( ( RequestMemory * 1024 ) &gt;= ImageSize ) ) &amp;&amp;\n( TARGET.FileSystemDomain == MY.FileSystemDomain )\n\n     Condition                         Machines Matched    Suggestion\n     ---------                         ----------------    ----------\n1   ( ( target.DoC_OS_Distribution == target.Ubuntu ) )\n                                       0                   REMOVE\n2   ( ( ( 1024 * target.Memory ) &gt;= 0 ) &amp;&amp; ( ( 1024 *\nceiling(ifThenElse(JobVMMemory isnt undefined,JobVMMemory,0.0)) ) &gt;= 0 )\n)\n                                       0                   REMOVE\n3   ( target.Arch == \"INTEL\" )        260\n4   ( target.OpSys == \"LINUX\" )       438\n5   ( target.Disk &gt;= 0 )              438\n6   ( TARGET.FileSystemDomain == \"doc.ic.ac.uk\" )438\n\n</pre></div>\n\n\n<p>(Note that <code>DoC_OS_Distribution</code> is a site-local machine value populated via a\nHawkeye script, and contains the output of <code>lsb_release -i -s</code>.)\n\n</p><p>The problem in this case was that the user had missed off quotes around the word <code>Ubuntu</code> in their Requirements expression -- so rather than checking that candidate execution machines had a DoC_OS_Distribution value of <code>\"Ubuntu\"</code>, it was in fact checking it against the value of the non-existent key, <code>target.Ubuntu</code>, and was thus failing.\n\n</p><p>When the user fixed this problem and resubmitted, the scheduling problem disappeared and the jobs ran.  (I'm afraid I didn't re-run the <code>-better-analyze</code> invocation to see if the erroneous second REMOVE instruction was still present.)\n\n</p><p>So, from my experience, this <em>appears</em> to be purely a presentation issue -- the actual matching behavior of the various Condor services appears to be operating as designed; it's just the analysis code which isn't fully evaluating the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> expressions completely/correctly.  The notion that this issue is preventing jobs to match <em>seems</em> to be a red herring -- at least, it was in my case!\n\n</p><p>Our Condor pool contains only Linux hosts; Windows is not involved. <code>condor_version</code> on a typical machine currently reports:\n</p><div class=\"code\">\n<pre class=\"code\">$CondorVersion: 7.4.2 Mar 30 2010 BuildID: 227044 $\n$CondorPlatform: X86_64-LINUX_DEBIAN50 $\n</pre></div>\n\n\n<p>(We're now mostly running on 64-bit Linux hosts, rather than the 32-bit that was prevalent at the time -- though we're still using the same binary release of Condor as before, so the above version string is otherwise accurate.)\n</p><hr/>\n<em>2010-Oct-27 16:39:01 by adesmet:</em> <br/>\n\nBulk change of target version from v070404 to v070405 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2013-Jun-04 14:54:48 by tannenba:</em> <br/>\n\nAs this is very likely a condorq -analyze presentation issue, and the condor_q -analyze was heavily refactored in the recent past, I am abandoning this ticket.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2013-Jun-04 14:55", "status": "abandoned", "created": "2010-Sep-07 14:58", "fixed_version": "2010-Sep-07 14:58", "broken_version": "v070403", "priority": "2", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com", "due_date": ""}