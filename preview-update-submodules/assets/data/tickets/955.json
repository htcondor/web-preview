{"id": 955, "title": "Ticket #955: Improve handling of timeout errors for cream jobs", "description": "<blockquote>\nSome Cream commands have failed with the following error message:\n<div class=\"code\">\n<pre class=\"code\">Error: Connection to service\n[https://stress3.chtc.wisc.edu:8443/ce-cream/services/CREAM2] failed:\nFaultString=[connection error] - FaultCode=[SOAP-ENV:Client] -\nFaultSubCode=[SOAP-ENV:Client] - FaultDetail=[Connection timed out]\n</pre></div>\n\n\n<p>The gridmanager responds by trying to cancel the cream job and putting the job on hold in the schedd.\n\n</p><p>The gridmanager should react more gracefully to these timeout failures. This can include retrying the command and pinging the resource. We could use try using a longer timeout. Currently, we use 60 seconds.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Nov-18 10:48:41 by jfrey:</em> <br/>\n\nHere are some other connection-related failure messages from the Cream client:\n\n<p></p><ul>\n<li>Connection refused:\n<div class=\"code\">\n<pre class=\"code\">Connection to service [https://stress2.chtc.wisc.edu:8443/ce-cream/services/CREAM2]\nfailed: FaultString=[connection error] - FaultCode=[SOAP-ENV:Client] -\nFaultSubCode=[SOAP-ENV:Client] - FaultDetail=[Connection refused]\n</pre></div>\n\n\n<p></p></li><li>Bad hostname:\n<div class=\"code\">\n<pre class=\"code\">Received NULL fault; the error is due to another cause:\nFaultString=[connection error] - FaultCode=[SOAP-ENV:Client] -\nFaultSubCode=[SOAP-ENV:Client] - FaultDetail=[Unknown host]\n</pre></div>\n\n</li></ul>\n\n<p></p><hr/>\n<em>2009-Nov-18 15:46:13 by jfrey:</em> <br/>\n\nPushed a change to V7_5-cream_hardening-branch to handle connection-related gahp command failures. They are retried several times, then a ping of the resource is requested. This works just like it does for gt2 and condor jobs.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1936\" onclick=\"get_ticket_and_populate_wrapper('1936'); return false;\" title=\"Improve handling of network errors for Cream jobs\">#1936</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nImprove handling of network errors for Cream jobs</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Mar-30 16:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0e0166ce69f858c7770fabf25cec17dbf726fa6b\">[21203]</a></span>: Retry CREAM REGISTER commands that fail due to network. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1931\" onclick=\"get_ticket_and_populate_wrapper('1931'); return false;\" title=\"Improve cream_gahp command batching\">#1931</a></span> This should have been part of <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=955\" onclick=\"get_ticket_and_populate_wrapper('955'); return false;\" title=\"Improve handling of timeout errors for cream jobs\">#955</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1936\" onclick=\"get_ticket_and_populate_wrapper('1936'); return false;\" title=\"Improve handling of network errors for Cream jobs\">#1936</a></span>, but the limit on submit attempts foiled the retries. Batching REGISTER commands makes this failure case frequently enough that we noticed it.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-18 15:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c4bfac8d44545efd815718a784ab6534c0311f40\">[16376]</a></span>: Improve handling of connection errors for cream jobs. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=955\" onclick=\"get_ticket_and_populate_wrapper('955'); return false;\" title=\"Improve handling of timeout errors for cream jobs\">#955</a></span> Cream gahp commands that fail due to connection-related problems are now retried. If they continue to fail, a ping of the resource is attempted to see if it is down. The number of retries and interval between them can be controlled with params\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-31 13:44", "status": "resolved", "created": "2009-Nov-16 15:24", "fixed_version": "2009-Nov-16 15:24", "broken_version": "v070400", "priority": "4", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "#897", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}