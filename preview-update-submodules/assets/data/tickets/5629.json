{"id": 5629, "title": "Ticket #5629: SCHEDD crash sending async updates across a reconfig", "description": "<blockquote>\nDuring testing of the 8.5.4 release candidate, the SCHEDD crashed just after a reconfig.  The problem appears to be that it was trying to continue processing an async update to the collector, but the updatedata had been freed by the act of reconfiguration.\n\n<p>In particular, the <code>misc_data</code> pointer passed to <code>UpdateData::startUpdateCallback</code> appears to point to memory that has been overwritten with garbage, most likely because this memory had already been freed.\n\n</p><p></p><div class=\"snip\">\n<pre class=\"sniplabel\">gdb backtrace from the core file</pre>\n<pre class=\"snip\">#0  0x00007fabe28e6204 in WriteCoreDump () from /usr/lib64/libcondor_utils_8_5_4.so\n#1  0x00007fabe28cc2e3 in linux_sig_coredump (signum=11) at\n/usr/src/debug/condor-8.5.4/src/condor_daemon_core.V6/daemon_core_main.cpp:735\n#2  &lt;signal handler called&gt;\n#3  0x0000003e2012b4d9 in __strcasecmp_l_sse42 () from /lib64/libc.so.6\n#4  0x00007fabe276761f in _putClassAd (sock=0x1abd62c0, ad=..., options=&lt;value optimized out&gt;) at\n/usr/src/debug/condor-8.5.4/src/condor_utils/classad_oldnew.cpp:771\n#5  0x00007fabe2893713 in DCCollector::finishUpdate (self=0x0, sock=0x1abd62c0, ad1=&lt;value optimized out&gt;, ad2=0x0)\n     at\n/usr/src/debug/condor-8.5.4/src/condor_daemon_client/dc_collector.cpp:279\n#6  0x00007fabe28962d9 in UpdateData::startUpdateCallback (success=&lt;value optimized out&gt;, sock=0x1abd62c0, misc_data=0x25bfd300)\n     at\n/usr/src/debug/condor-8.5.4/src/condor_daemon_client/dc_collector.cpp:369\n#7  0x00007fabe283876f in SecManStartCommand::doCallback (this=0x26512550, result=&lt;value optimized out&gt;) at\n/usr/src/debug/condor-8.5.4/src/condor_io/condor_secman.cpp:1159\n#8  0x00007fabe283f727 in SecManStartCommand::SocketCallback\n(this=0x26512550, stream=&lt;value optimized out&gt;)\n     at /usr/src/debug/condor-8.5.4/src/condor_io/condor_secman.cpp:2473\n#9  0x00007fabe28b3f21 in DaemonCore::CallSocketHandler_worker\n(this=0x2045eb0, i=12, default_to_HandleCommand=&lt;value optimized out&gt;, asock=&lt;value optimized out&gt;)\n     at\n/usr/src/debug/condor-8.5.4/src/condor_daemon_core.V6/daemon_core.cpp:4146\n#10 0x00007fabe28b40ad in\nDaemonCore::CallSocketHandler_worker_demarshall (arg=&lt;value optimized out&gt;)\n     at\n/usr/src/debug/condor-8.5.4/src/condor_daemon_core.V6/daemon_core.cpp:4105\n#11 0x00007fabe27bb3d0 in CondorThreads::pool_add (routine=&lt;value optimized out&gt;, arg=&lt;value optimized out&gt;, tid=&lt;value optimized out&gt;, descrip=&lt;value optimized out&gt;)\n     at /usr/src/debug/condor-8.5.4/src/condor_utils/condor_threads.cpp:1109\n#12 0x00007fabe28abb67 in DaemonCore::CallSocketHandler (this=0x2045eb0, i=@0x7fff15e4fa5c, default_to_HandleCommand=true)\n     at\n/usr/src/debug/condor-8.5.4/src/condor_daemon_core.V6/daemon_core.cpp:4093\n#13 0x00007fabe28af770 in DaemonCore::Driver (this=0x2045eb0) at\n/usr/src/debug/condor-8.5.4/src/condor_daemon_core.V6/daemon_core.cpp:3966\n#14 0x00007fabe28ce419 in dc_main (argc=1, argv=0x7fff15e50190) at\n/usr/src/debug/condor-8.5.4/src/condor_daemon_core.V6/daemon_core_main.cpp:2777\n#15 0x0000003e2001ed5d in __libc_start_main () from /lib64/libc.so.6\n#16 0x00000000004218d9 in _start ()\n</pre></div>\n\n\n<p>At present it is not clear whether this bug applies to stable as well.  The async update collector has been touched by many people, but the code most directly relevant to the data structures that have become invalid was first committed to the 8.3.8 branch.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2016-Nov-16 10:11", "status": "new", "created": "2016-Apr-14 11:54", "fixed_version": "2016-Apr-14 11:54", "broken_version": "v080500", "priority": "2", "subsystem": "Libs", "assigned_to": "tannenba", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}