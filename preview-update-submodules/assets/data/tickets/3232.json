{"id": 3232, "title": "Ticket #3232: Dedicated users not compatible with ssh-to-job.", "description": "<blockquote>\nWhen DEDICATED_EXECUTE_ACCOUNT_REGEXP is set, and the starter has started an SSH daemon for condor_ssh_to_job or condor_submit -interactive: if the original job's process (e.g., /bin/sleep) terminates, so does the SSH session.\n\n<p>This manifests itself as getting kicked out off the machine immediately when using condor_submit -interactive, because the default session set-up script kills the default sleep job.\n\n</p><p>Although we haven't looked, ToddT and I believe that this is happening because the 'kill all processes owned by this slot-user' code is firing when the original process dies, which takes out the SSH daemon.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Sep-25 18:09:51 by tannenba:</em> <br/>\n\nPatch committed below fixes the problem via the following algorithm:\n\n<p>When the starter sees a child it spawned exit, it normally immediately calls Kill_Family() to clean up the process tree for the job. Now, if execute login is dedicated is enabled, the starter will postpone killing the process family until there is only one child job under the starter.\n\n</p><p>Pushed to the V7_8-branch for v7.8.6, and merged into v7.9.1.  Assigning to GregT for code review.\n</p><hr/>\n<em>2012-Oct-25 17:52:16 by johnkn:</em> <br/>\n\nBulk change of target version from v070806 to v070807 using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Dec-05 16:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c88c1eb88aa582689264044cabbdd050f78e35b2\">[34296]</a></span>: minor editing/formatting change to version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3232\" onclick=\"get_ticket_and_populate_wrapper('3232'); return false;\" title=\"Dedicated users not compatible with ssh-to-job.\">#3232</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Dec-05 15:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/73740d778c9de2617ee6e5a85a0f1fdab8e786f0\">[34282]</a></span>: minor editing/formatting change to version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3232\" onclick=\"get_ticket_and_populate_wrapper('3232'); return false;\" title=\"Dedicated users not compatible with ssh-to-job.\">#3232</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-25 18:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/88c875caa26dffcd140b4717910a45c9ed4b5565\">[33495]</a></span>: Added blurb to version history for fix <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3232\" onclick=\"get_ticket_and_populate_wrapper('3232'); return false;\" title=\"Dedicated users not compatible with ssh-to-job.\">#3232</a></span>.  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-25 18:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e2dcec276be474d2e78a690a2673e98eb2b2678e\">[33493]</a></span>: Fix problems using ssh_to_job with DEDICATED_EXECUTE_ACCOUNT_REGEXP. Change the starter so if execute login is dedicated is enabled, the starter will postpone killing the process family until there is only one child job under the starter. This prevents sshd from being killed prematurely in interactive\u00a0[...]\n (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Dec-12 10:38", "status": "resolved", "created": "2012-Sep-17 17:52", "fixed_version": "2012-Sep-17 17:52", "broken_version": "v070800", "priority": "2", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "tlmiller@cs.wisc.edu tannenba@cs.wisc.edu", "due_date": ""}