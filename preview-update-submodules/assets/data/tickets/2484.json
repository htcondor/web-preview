{"id": 2484, "title": "Ticket #2484: Memory leak in Windows startd?", "description": "<blockquote>\nTJ decoded a stack trace from a 7.2.5 startd that had crashed on Windows, and it looks like a memory leak.\n\n<p></p><pre>  Address   Frame     Logical addr  Module\n  7D4F2366  0012F514  0001:00012366 C:\\WINDOWS\\syswow64\\kernel32.dll\n  004BCCDC  0012F54C  0001:000BBCDC C:\\condor\\bin\\condor_startd.exe _CxxThrowException+0x48\n  004B0695  0012F568  0001:000AF695 C:\\condor\\bin\\condor_startd.exe operator new+0x64\n  004476CC  0012F594  0001:000466CC C:\\condor\\bin\\condor_startd.exe _condorOutMsg::putn+0x22 src\\condor_io\\safemsg.cpp(663)+0xa\n  0042FCF7  0012F5DC  0001:0002ECF7 C:\\condor\\bin\\condor_startd.exe Stream::put+0x7c         src\\condor_io\\stream.cpp(1347)+0x9\n  00470474  0012F5F0  0001:0006F474 C:\\condor\\bin\\condor_startd.exe ClassAd::put+0x10        src\\classad.old\\classad.cpp(767)+0xb\n  004A78C5  0012F600  0001:000A68C5 C:\\condor\\bin\\condor_startd.exe DCCollector::finishUpdate+0x1b src\\condor_daemon_client\\dc_collector.cpp(386)+0x18\n  004A7E22  0012F66C  0001:000A6E22 C:\\condor\\bin\\condor_startd.exe UpdateData::startUpdateCallback+0x37\n  src\\condor_daemon_client\\dc_collector.cpp(484)+0xe 0043429SecManStartCommand::startCommand+0x2b src\\condor_io\\condor_secman.cpp(1080)+0xf\n  0043544E  0012F6C0  0001:0003444E C:\\condor\\bin\\condor_startd.exe SecMan::startCommand+0xa0 src\\condor_io\\condor_secman.cpp(969)+0x7\n  00482D2D  0012F73C  0001:00081D2D C:\\condor\\bin\\condor_startd.exe Daemon::startCommand+0x11a src\\condor_daemon_client\\daemon.cpp(512)\n  0048390A  0012F780  0001:0008290A C:\\condor\\bin\\condor_startd.exe Daemon::startCommand+0xf2 src\\condor_daemon_client\\daemon.cpp(558)+0x28\n  004839C0  0012F7B8  0001:000829C0 C:\\condor\\bin\\condor_startd.exe Daemon::startCommand_nonblocking+0x2e src\\condor_daemon_client\\daemon.cpp(594)\n  004A7F0C  0012F804  0001:000A6F0C C:\\condor\\bin\\condor_startd.exe DCCollector::sendUDPUpdate+0x7e src\\condor_daemon_client\\dc_collector.cpp(526)\n  004A877D  0012F8AC  0001:000A777D C:\\condor\\bin\\condor_startd.exe DCCollector::sendUpdate+0x247 src\\condor_daemon_client\\dc_collector.cpp(374)\n  00489366  0012F8D0  0001:00088366 C:\\condor\\bin\\condor_startd.exe CollectorList::sendUpdates+0x40 src\\condor_daemon_client\\daemon_list.cpp(256)+0x17\n  00451AE5  0012F8F4  0001:00050AE5 C:\\condor\\bin\\condor_startd.exe DaemonCore::sendUpdates+0x104 src\\condor_daemon_core.v6\\daemon_core.cpp(9526)+0x17\n  00418C43  0012F974  0001:00017C43 C:\\condor\\bin\\condor_startd.exe Resource::do_update+0x50 src\\condor_startd.v6\\resource.cpp(953)+0x17</pre>\n</blockquote>", "remarks": "<blockquote>\nWe have since recieved 2 more stack traces from the same source, one appears to be truncated.  but all 3 stack traces indicate that new is throwing inside various parts of condorOutMsg\n\n<p></p><pre>\tCall stack:\n\tAddress   Frame     Logical addr  Module\n\t7D4F237E  001208CC  0001:0001237E C:\\WINDOWS\\syswow64\\kernel32.dll\n\t004BCCDC  00120904  0001:000BBCDC C:\\Condor\\bin\\condor_startd.exe  _CxxThrowException+0x48\n\t004B0695  00120920  0001:000AF695 C:\\Condor\\bin\\condor_startd.exe  operator new+0x64\n\t004475E7  00120954  0001:000465E7 C:\\Condor\\bin\\condor_startd.exe  _condorOutMsg::_condorOutMsg+0xd\t src\\condor_io\\safemsg.cpp(616)+0xc\n\t0043B4ED  0012F56C  0001:0003A4ED C:\\Condor\\bin\\condor_startd.exe  SafeSock::sender_ip_str+0x7c\t\t src\\condor_io\\safe_sock.cpp(215)\n\t0048A382  0012F588  0001:00089382 C:\\Condor\\bin\\condor_startd.exe  ConvertDefaultIPToSocketIP+0x48   src\\condor_c++_util\\my_hostname.cpp(318)+0xd\n\t0048A4C2  0012F5AC  0001:000894C2 C:\\Condor\\bin\\condor_startd.exe  ConvertDefaultIPToSocketIP+0x1e   src\\condor_c++_util\\my_hostname.cpp(368)\n\t0046E2D1  0012F5DC  0001:0006D2D1 C:\\Condor\\bin\\condor_startd.exe  AttrList::put+0xb6\t\tsrc\\classad.old\\attrlist.cpp(2162)+0xd\n\t00470474  0012F5F0  0001:0006F474 C:\\Condor\\bin\\condor_startd.exe  ClassAd::put+0x10        src\\classad.old\\classad.cpp(767)+0xb\n\t004A78C5  0012F600  0001:000A68C5 C:\\Condor\\bin\\condor_startd.exe  DCCollector::finishUpdate+0x1b src\\condor_daemon_client\\dc_collector.cpp(386)+0x18\n\t004A7E22  0012F66C  0001:000A6E22 C:\\Condor\\bin\\condor_startd.exe  UpdateData::startUpdateCallback+0x37 src\\condor_daemon_client\\dc_collector.cpp(484)+0xe\n\t0043429E  0012F698  0001:0003329E C:\\Condor\\bin\\condor_startd.exe  SecManStartCommand::startCommand+0x2b src\\condor_io\\condor_secman.cpp(1080)+0xf\n\t0043544E  0012F6C0  0001:0003444E C:\\Condor\\bin\\condor_startd.exe  SecMan::startCommand+0xa0 src\\condor_io\\condor_secman.cpp(969)+0x7\n\t00482D2D  0012F73C  0001:00081D2D C:\\Condor\\bin\\condor_startd.exe  Daemon::startCommand+0x11a src\\condor_daemon_client\\daemon.cpp(512)\n\t0048390A  0012F780  0001:0008290A C:\\Condor\\bin\\condor_startd.exe  Daemon::startCommand+0xf2 src\\condor_daemon_client\\daemon.cpp(558)+0x28\n\t004839C0  0012F7B8  0001:000829C0 C:\\Condor\\bin\\condor_startd.exe  Daemon::startCommand_nonblocking+0x2e src\\condor_daemon_client\\daemon.cpp(594)\n\t004A7F0C  0012F804  0001:000A6F0C C:\\Condor\\bin\\condor_startd.exe  DCCollector::sendUDPUpdate+0x7e src\\condor_daemon_client\\dc_collector.cpp(526)\n\t004A877D  0012F8AC  0001:000A777D C:\\Condor\\bin\\condor_startd.exe  DCCollector::sendUpdate+0x247 src\\condor_daemon_client\\dc_collector.cpp(374)\n\t00489366  0012F8D0  0001:00088366 C:\\Condor\\bin\\condor_startd.exe  CollectorList::sendUpdates+0x40 src\\condor_daemon_client\\daemon_list.cpp(256)+0x17\n\t00451AE5  0012F8F4  0001:00050AE5 C:\\Condor\\bin\\condor_startd.exe  DaemonCore::sendUpdates+0x104 src\\condor_daemon_core.v6\\daemon_core.cpp(9526)+0x17\n\t00418C43  0012F974  0001:00017C43 C:\\Condor\\bin\\condor_startd.exe  Resource::do_update+0x50 src\\condor_startd.v6\\resource.cpp(953)+0x17\n</pre>\n\n<p></p><pre>\tCall stack:\n\tAddress   Frame     Logical addr  Module\n\t7D4F237E  001207A0  0001:0001237E C:\\WINDOWS\\syswow64\\kernel32.dll\n\t004BCCDC  001207D8  0001:000BBCDC C:\\Condor\\bin\\condor_startd.exe  _CxxThrowException+0x48\n\t004B0695  001207F4  0001:000AF695 C:\\Condor\\bin\\condor_startd.exe  operator new+0x64\n\t004475E7  00120828  0001:000465E7 C:\\Condor\\bin\\condor_startd.exe  _condorOutMsg::_condorOutMsg+0xd\t src\\condor_io\\safemsg.cpp(616)+0xc\n\t00450776  00120AE8  0001:0004F776 C:\\Condor\\bin\\condor_startd.exe  DaemonCore::Create_Process+0xd5 src\\condor_daemon_core.v6\\daemon_core.cpp(7181)+0x52</pre>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "incident", "last_change": "2013-Jan-28 15:30", "status": "new", "created": "2011-Sep-21 11:14", "fixed_version": "2011-Sep-21 11:14", "broken_version": "v070205", "priority": "5", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "tlmiller", "rust": "s8077", "customer_group": "support", "visibility": "public", "notify": "", "due_date": ""}