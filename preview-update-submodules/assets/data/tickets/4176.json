{"id": 4176, "title": "Ticket #4176: STARTD should not abort when it runs out of user defined resources", "description": "<blockquote>\nWhen resources other than CPU, DISK, SWAP, &amp; MEMORY are exhausted during STARTD slot allocation, the STARTD should not abort,  it should just create the slot without any of those resources.  Thus, if a machine has 8 CPUs but only 4 GPUs, by default a static configuration will create 8 slots, the first 4 of which will have a GPU assigned, and the second 4 will not.</blockquote>", "remarks": "<blockquote>\n<em>2014-Feb-03 15:44:58 by johnkn:</em> <br/>\n\nAfter some discussion with eje, it seems that consumption policy depends on being able to create slots without any disk. So the new policy will be to require at least 1 cpu and 1 mb of ram for each slot, and to abort when that cannot be fulfilled, but for all other resources, we treat auto and % declarations of slot resources as allowing 0 to be allocated.\n\n<p></p><hr/>\n<em>2014-Feb-04 15:44:56 by eje:</em> <br/>\n\nIt should be supporting zero cpu and zero memory, as well.  I wrote a regression test for that.\n\n<p></p><hr/>\n<em>2014-Feb-04 16:21:52 by johnkn:</em> <br/>\n\nnonzero cpu or memory is not a permitted slot configuration.  this is by design.\n\n<p></p><hr/>\n<em>2014-Feb-10 16:10:54 by eje:</em> <br/>\n\nIt's only allowed if some other resource is consumed.  That is, consuming <strong>some</strong> resource is required (it just isn't required to be disk, memory, or cpus).  And, only if a consumption policy is in play.\n\n<p></p><hr/>\n<em>2014-Feb-13 13:34:23 by eje:</em> <br/>\n\nsome more context:  the use-case behind allowing zero mem/disk/cpu was to support sub-core jobs.  Supporting non-integer resource values is arguably the ideal way to do this, but we assessed that as more invasive than just tweaking to allow zero resources, and allow user to create an extensible resource to represent resource accounting for number of allowed jobs.\n\n<p>It only came up when it was trying to create dynamic slots.  So, disallowing specifically on either p-slots or static slots should not get in the way of zero resource consumption policies, as zero resources only crop up on dynamic slots</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Feb-25 15:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2a19866fdc12c57468a454e89e7a72257bcd2255\">[39472]</a></span>: edit of 8.1.4 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4176\" onclick=\"get_ticket_and_populate_wrapper('4176'); return false;\" title=\"STARTD should not abort when it runs out of user defined resources\">#4176</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Feb-24 15:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ddd0ce961f28f9f80ba438471eb70d7cf273318c\">[39456]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4176\" onclick=\"get_ticket_and_populate_wrapper('4176'); return false;\" title=\"STARTD should not abort when it runs out of user defined resources\">#4176</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Feb-03 23:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0f4536831a06191133748f5a00344bad03373a4d\">[39305]</a></span>: STARTD does not abort when it runs out of resources for auto or % shares <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4176\" onclick=\"get_ticket_and_populate_wrapper('4176'); return false;\" title=\"STARTD should not abort when it runs out of user defined resources\">#4176</a></span> startd will enforce that all slots get at least 1 cpu and 1Mb of ram, but it will now allow slots to be created when 0 of disk or user defined resources when the allocation policy is AUTO or is % and the resource total is\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Feb-25 17:02", "status": "resolved", "created": "2014-Jan-24 09:51", "fixed_version": "2014-Jan-24 09:51", "broken_version": "v080000", "priority": "3", "subsystem": "DaemonsExecNode", "assigned_to": "johnkn", "derived_from": "#3386", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "johnkn@cs.wisc.edu, eje@cs.wisc.edu", "due_date": ""}