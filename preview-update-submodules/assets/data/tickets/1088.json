{"id": 1088, "title": "Ticket #1088: NeverCreateJobSandbox is wonky in Condor-C", "description": "<blockquote>\n<code>NeverCreateJobSandbox</code> introduces a subtle <code>Condor-C</code> issue.  Basically, the <code>NeverCreateJobSandbox</code> attribute gets set at submit time and then Condor-C copies this attribute into the remote job ad.  The value of <code>NeverCreateJobSandbox</code> may be inconsistent with the value of <code>remote_ShouldTransferFiles</code> used in the Condor-C submission.\n\n<p>This is not a terrible bug, because I don't think it hits in the normal Condor-C usage case where the original job and the remote job both use file transfer.  (But sorry I didn't think of this when we discussed this method of doing things, Will!)\n\n</p><p>How to reproduce:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">universe = grid\ngrid_resource = condor FULL_HOSTNAME COLLECTOR_HOST\nexecutable = /bin/date\noutput = simple.out\nerror = simple.err\nlog = simple.log\nremote_universe = vanilla\n+remote_requirements = True\n+remote_requirements = True\n+remote_ShouldTransferFiles = \"YES\"\n+remote_WhenToTransferOutput = \"ON_EXIT\"\n\nqueue\n</pre></div>\n\n\n<p>The starter fails with the following message:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">FileTransfer: DownloadFiles called on server side\n</pre></div>\n\n\n<p>This illustrates two problems:\n\n</p><p></p><ol>\n<li>The starter and the shadow do not use the same logic to determine whether file transfer should happen.  (Seems like this should be shared code in a static method of the file transfer object.)  Specifically, <code>JICShadow::initFileTransfer</code> does not pay attention to <code>NeverCreateJobSandbox</code>.  Either or both of the following should be done: A) the starter should use the same logic as the shadow to decide whether to do file transfer B) the shadow should set ShouldTransferFiles=\"NO\" if it is not consistent with <code>NeverCreateJobSandbox</code>.\n\n<p></p></li><li>Condor-C should be smart about <code>NeverCreateJobSandbox</code> when submitting the remote job (same logic as condor_submit).  Or this logic should be moved into the schedd.</li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Nov-23 11:25:29 by bbockelm:</em> <br/>\n\nOuch - just got hit by this one.\n\n<p>I would note that the \"how to reproduce\" is basically the same job as the example in the manual.\n\n</p><p>If this can't be fixed quickly, can we change the manual so the example is functional?\n\n</p><p></p><hr/>\n<em>2010-Nov-24 17:59:14 by danb:</em> <br/>\n\nThe solution I am trying is to get rid of <code>NeverCreateJobSandbox</code>.  In the file transfer object, rather than always creating the spool directory, it will only created when it is needed.  The schedd still creates/chowns the sandbox for spooled jobs and for jobs that specify <code>JobRequiresSandbox</code>.  For backward compatibility, it also does this for all parallel universe jobs.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Nov-24 18:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c2472a9fac464658d7d21cc731c49346e3a3d356\">[25793]</a></span>: Documented fix for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NeverCreateJobSandbox\" title=\"Never Create Job Sandbox\">NeverCreateJobSandbox</a></span> and Condor-C. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1088\" onclick=\"get_ticket_and_populate_wrapper('1088'); return false;\" title=\"NeverCreateJobSandbox is wonky in Condor-C\">#1088</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Nov-24 18:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/71f3af52cb3350e9629e6c22533cf66689ee138f\">[19490]</a></span>: Fixed Condor-C problem with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NeverCreateJobSandbox\" title=\"Never Create Job Sandbox\">NeverCreateJobSandbox</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1088\" onclick=\"get_ticket_and_populate_wrapper('1088'); return false;\" title=\"NeverCreateJobSandbox is wonky in Condor-C\">#1088</a></span> Got rid of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NeverCreateJobSandbox\" title=\"Never Create Job Sandbox\">NeverCreateJobSandbox</a></span>. Now the file transfer object only creates the spool directory if/when it is needed, rather than blindly creating a spool directory for all jobs. For file transfer, the spool directory is only needed when transferring\u00a0[...]\n (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Dec-06 11:46", "status": "resolved", "created": "2010-Jan-04 16:38", "fixed_version": "2010-Jan-04 16:38", "broken_version": "v070401", "priority": "4", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "#749", "creator": "danb", "rust": "", "customer_group": "other", "visibility": "public", "notify": "dan@hep.wisc.edu,willb@redhat.com,matt@cs.wisc.edu", "due_date": ""}