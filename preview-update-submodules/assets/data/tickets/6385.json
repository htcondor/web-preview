{"id": 6385, "title": "Ticket #6385: Always try to send alive messages to systemd on linux", "description": "<blockquote>\nSomeone on htcondor-users reports that their master daemon dies every 20 minutes on their ubuntu 14 machine. It turns out that systemd is killing the master because it's not reporting that it's alive. Ubuntu 14 doesn't use systemd as its init system by default, but can be configured to do so. Our code to send alive messages to systemd is only enabled if the related header and library files are present at compile time, which they aren't by default on ubuntu 14.\n\n<p>The code should be changed so that the daemon always tries to interact with systemd (if the requisite environment variables are set). The values we need at compile time (SD_LISTEN_FDS_START and LIBSYSTEMD_DAEMON_SO) are the same across all distros, so we can set defaults if the header and library files aren't present.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Sep-10 18:54:02 by tim:</em> <br/>\n\n<strong>CODE REVIEW:</strong> Thank you for the update. We should go farther and require systemd developer file for the build. I'll make a follow-up ticket for that.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-24 15:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c6496b65188917ae9d991a33d962cc4a81706c9f\">[52174]</a></span>: Docs for fix to work with systemd on all linux distros. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6385\" onclick=\"get_ticket_and_populate_wrapper('6385'); return false;\" title=\"Always try to send alive messages to systemd on linux\">#6385</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-24 15:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bd6208ecf5f1aa90930b40f6e4c9ac24a44aa1d5\">[52173]</a></span>: Always try to send alive messages to systemd on linux. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6385\" onclick=\"get_ticket_and_populate_wrapper('6385'); return false;\" title=\"Always try to send alive messages to systemd on linux\">#6385</a></span> Previously, this code was only enabled if the relevant header and library file were present at compile time. This caused a problem for a user on ubuntu 14, where systemd isn't part fo the normal configuration, but can be enabled. We don't need\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Sep-10 18:54", "status": "resolved", "created": "2017-Aug-24 14:21", "fixed_version": "2017-Aug-24 14:21", "broken_version": "", "priority": "3", "subsystem": "DaemonMaster", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "users", "visibility": "public", "notify": "", "due_date": ""}