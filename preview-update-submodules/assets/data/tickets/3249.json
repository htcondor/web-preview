{"id": 3249, "title": "Ticket #3249: cpus=auto doesn't work in multi slot environment", "description": "<blockquote>\nThe documentation claims that, with multiple SLOT_TYPEs defined, one should be able to set cpus=auto in the slot definition, but looking at the code, cpus=auto always means cpus=1.</blockquote>", "remarks": "<blockquote>\n<em>2012-Oct-09 10:03:53 by tstclair:</em> <br/>\n\nDo we have any details on this, b/c I'm pretty surprised by *this?  e.g. did it repro on 7.8.5?\n\n<p></p><hr/>\n<em>2012-Oct-09 11:14:17 by gthain:</em> <br/>\n\nLooking at the code, this has never worked.\n<hr/>\n<em>2012-Oct-25 17:52:16 by johnkn:</em> <br/>\n\nBulk change of target version from v070806 to v070807 using ./ticket-target-mover.\n<hr/>\n<em>2012-Dec-19 09:30:47 by johnkn:</em> <br/>\n\nBulk change of target version from v070807 to v070808 using ./ticket-target-mover.\n<hr/>\n<em>2013-Mar-28 17:16:00 by johnkn:</em> <br/>\n\nBulk change of target version from v070808 to v070809 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2013-Oct-31 09:25:28 by jfrey:</em> <br/>\n\nI've attached a patch that fixes this problem. Cpus are now treated like memory. After cpus are assigned to slots with explicit cpu shares, the remaining cpus are split evenly amongst slots with cpu=auto. All slots must have at least one cpu, and some cpus may go unassigned if they can't be divided evenly.\n\n<p></p><hr/>\n<em>2014-Jan-21 16:31:28 by gthain:</em> <br/>\n\n<strong class=\"two\">CODE REVIEW</strong> All looks good.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/808/auto_cpus.patch\">auto_cpus.patch</a>\n1914 bytes added by jfrey on 2013-Oct-31 14:17:36 UTC.\n<br/>\nPatch for allocation of cpus across slots. Now all cpus are divided evenly, instead of only 1 per slot.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Feb-18 16:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c0940677323b7ca46eb4875660155bb80d6e0fd9\">[39431]</a></span>: minor 8.1.4 version history item edit <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3249\" onclick=\"get_ticket_and_populate_wrapper('3249'); return false;\" title=\"cpus=auto doesn't work in multi slot environment\">#3249</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jan-23 08:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/edc50350562e9b69bdedf0bbe13b1c7d28687aaa\">[39215]</a></span>: Docs for cpus=auto change in SLOT_TYPE_* param. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3249\" onclick=\"get_ticket_and_populate_wrapper('3249'); return false;\" title=\"cpus=auto doesn't work in multi slot environment\">#3249</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jan-22 12:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c80b7b6c8bd00634e90f24304b7a94373b116d93\">[39210]</a></span>: Change meaning of cpus=auto when there are more slots than cpus. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3249\" onclick=\"get_ticket_and_populate_wrapper('3249'); return false;\" title=\"cpus=auto doesn't work in multi slot environment\">#3249</a></span> Previously, in a slot's resource allocation, cpus=auto always meant cpus=1. Now, cpus=auto works like other types of allocation. Cpus are first given to slots with specific allocation requests (exact numbers or fractional shares),\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Oct-04 17:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/708ac2500555d447428452fc1490d056f0d7460f\">[33590]</a></span>: Pull slot building code out into own file <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3249\" onclick=\"get_ticket_and_populate_wrapper('3249'); return false;\" title=\"cpus=auto doesn't work in multi slot environment\">#3249</a></span> this will help with testing this, it doesn't need to be in the main startd class  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Jan-23 08:56", "status": "resolved", "created": "2012-Oct-03 09:36", "fixed_version": "2012-Oct-03 09:36", "broken_version": "v070800", "priority": "5", "subsystem": "DaemonsExecNode", "assigned_to": "jfrey", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com", "due_date": ""}