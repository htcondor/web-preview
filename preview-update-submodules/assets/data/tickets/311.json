{"id": 311, "title": "Ticket #311: Allow for DaemonCore to free Register_DataPtr() data", "description": "<blockquote>\nCurrently daemon-core leaks any memory passed to it via <code>Register_DataPtr()</code>, because it does not know how to free it.  We need a general mechanism, probably in the form of a callback (destructor anyone?), since it is not always the case that a single daemon-core registered object is closed at once, such as in the case of <code>CancelAllTimers()</code>.</blockquote>", "remarks": "<blockquote>\n<em>2009-Mar-10 12:54:22 by burnett:</em> <br/>\n\nThis will first be added to daemon-core timers, and later integrated into the rest of the registered objects that can use the <code>Register_DataPtr()</code> mechanism (presumably this is all of them).\n\n<p></p><hr/>\n<em>2009-Mar-12 12:03:21 by burnett:</em> <br/>\n\nScratch the above.  The first round will take the form of a callback passed directly to the <code>Register_DataPtr()</code> call.  This way all daemon-core registered objects will be able to free their data pointer (rather than just the timers).  The callback parameter will default to <code>NULL</code>, so all existing code will continue to work as they have in the past.\n\n<p></p><hr/>\n<em>2009-Mar-12 15:13:47 by tannenba:</em> <br/>\n\nDon't forget <code>SetDataPtr()</code> as well.  Also, since this is going into the stable series, please use \"daemonCore\" style callbacks instead of introducing a new mechanism (i.e. stl functors) at this point.\n\n<p></p><hr/>\n<em>2009-Mar-19 11:27:35 by burnett:</em> <br/>\n\nOn a separate branch, <code>V7_2-release_data_ptr-branch</code>, I've added 'C' style dtor callbacks for daemoncore timers.  Once Todd adds his threading code, I'll merge it into <code>V7_2-branch</code> and the <code>master</code>.  In the future this new addition will go the way of the Dodo as we move to generic, template based functors for all daemoncore callbacks.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Mar-19 11:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3850ed4745d0ecff87537bcec08069682c52a272\">[14262]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=311\" onclick=\"get_ticket_and_populate_wrapper('311'); return false;\" title=\"Allow for DaemonCore to free Register_DataPtr() data\">#311</a></span>. Added an additional callback to daemoncore's timers to delete their data_ptr, if one exists.  (By Ben Burnett )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-31 13:40", "status": "resolved", "created": "2009-Mar-10 12:52", "fixed_version": "2009-Mar-10 12:52", "broken_version": "v070201", "priority": "2", "subsystem": "Daemons", "assigned_to": "burnett", "derived_from": "", "creator": "burnett", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}