{"id": 2805, "title": "Ticket #2805: KBDD broken on Windows, again", "description": "<blockquote>\nThe kbdd was broken yet again very, very early in the 7.6 series and remains broken in the 7.7 series.  How no one else seems to have noticed is completely beyond me at this point.  The issue is roughly the same.  The kbdd has its own main function, specifically, a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WinMain\" title=\"Win Main\">WinMain</a></span> function so that it creates a windowless \"Window\" application so that the user does not see anything visible.  In 7.6, somehow the daemon_core main overrode it even though in 7.4 and 7.5 the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WinMain\" title=\"Win Main\">WinMain</a></span> was functioning as expected, especially since I had to implement passing on of command line arguments through it to the daemon_core main.  In 7.7, the daemon_core main was moved into each specific daemon, including kbdd.  This new main again overrode the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WinMain\" title=\"Win Main\">WinMain</a></span> and in both cases kbdd ended up being built as a command line application instead of a Windows application.\n\n<p>Short term fix: In 7.6, override daemon_core's main with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WinMain\" title=\"Win Main\">WinMain</a></span> again.  In 7.7, just move the relevant code in the kbdd crt main into <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WinMain\" title=\"Win Main\">WinMain</a></span> and delete the crt main.\n\n</p><p>Long term fix: Replace kbdd with something that does not carry all of daemon_core's baggage and dependencies.  We do not need something so complicated just to watch and notify the startd of keyboard and mouse activity.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Feb-24 12:09:32 by johnkn:</em> <br/>\n\nthe patch does not turn kbdd on windows back into a Windows app. but it does replicate the code that tells dprintf not to except if there no log file.\n\n<p></p><hr/>\n<em>2012-Feb-24 12:16:00 by ziliang:</em> <br/>\n\nBut if it remains a console app, users are going to see a visible console floating there and are liable to just close it themselves.\n\n<p></p><hr/>\n<em>2013-Mar-20 15:30:10 by alderman:</em> <br/>\n\nWe (Cycle) are seeing this problem at a customer and would be happy to test any solutions if they become available.\n\n<p></p><hr/>\n<em>2013-Mar-21 21:04:25 by ziliang:</em> <br/>\n\nTJ, could you check the patch? I'm having problems packaging Condor on my laptop for some reason.\n\n<p></p><hr/>\n<em>2013-Mar-22 11:59:03 by johnkn:</em> <br/>\n\nI'm checking out the patch now.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/709/kbdd.patch\">kbdd.patch</a>\n1850 bytes added by ziliang on 2013-Mar-22 02:03:12 UTC.\n<br/>\nPatch adding back in \"windowless\" window version of kbdd.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-09 14:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b2927d0706f1d320a362cddafb0c7eed374c1d77\">[35356]</a></span>: add version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2805\" onclick=\"get_ticket_and_populate_wrapper('2805'); return false;\" title=\"KBDD broken on Windows, again\">#2805</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-22 16:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a40da64dbad60f9ceacffd8b990eca9e59f068e8\">[35272]</a></span>: Make the Windows version of the kbdd_daemon a windows app <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2805\" onclick=\"get_ticket_and_populate_wrapper('2805'); return false;\" title=\"KBDD broken on Windows, again\">#2805</a></span> so that it doesn't continue to create a visible console window. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Feb-13 17:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/331964bd1dc1aef33a3be1978b3dbedf93eb7296\">[30592]</a></span>: reinstate special case KBDD code for Windows to set the Run key in the registry and to continue on failure to log. This code was bypassed by the change that moved main out of daemon_core. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2805\" onclick=\"get_ticket_and_populate_wrapper('2805'); return false;\" title=\"KBDD broken on Windows, again\">#2805</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-May-21 14:26", "status": "resolved", "created": "2012-Feb-02 22:42", "fixed_version": "2012-Feb-02 22:42", "broken_version": "v070600", "priority": "1", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "ziliang", "rust": "", "customer_group": "users", "visibility": "public", "notify": "tstclair@redhat.com", "due_date": ""}