{"id": 1784, "title": "Ticket #1784: Newer hard disks may exceed MAX_INT in available size", "description": "<blockquote>\nWith modern hard drives and their increasing sizes, we may no longer be able to fit the kB value into integer space. As reported in the mentioned rust ticket, this leads (maybe among other things) to an annoying repeat of the error message\n\n<p></p><div class=\"code\">\n<pre class=\"code\">sysapi_disk_space_raw: Free disk space kbytes overflow, capping\nto INT_MAX\n</pre></div>\n\n\n<p>in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StartLog\" title=\"Start Log\">StartLog</a></span>.\n\n</p><p>Suggestion for a plan of action:\n</p><ul>\n<li>Revisiting of behavior if disk space available exceeds MAX_INT: Are there other possible problems?\n</li><li>Dealing differently with those error messages - sticking to one per start-up, rather than repeating it very frequently</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Nov-23 09:32:13 by matt:</em> <br/>\n\nWe should seriously consider introduction of units into the attribute name, providing DiskSizeMB and DiskSizeGB. The underlying APIs would have to support it, and GregT showed that <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> themselves may need modification to support &gt;32bit integral values.\n<hr/>\n<em>2011-Jan-27 14:50:47 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 16:20:02 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2011-Dec-12 16:32:03 by pfc:</em> <br/>\n\nOn 12-core systems with 24 slots, this fills the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StartLog\" title=\"Start Log\">StartLog</a></span> with thousands of lines of garbage... at 24 lines every 5 minutes, we see &gt;100k lines per month of just this message. :-p\n\n<p>The \"real\" fix (different units or 64-bit values) is not urgent and not worth spending lots of time on yet -- but if there's a ten-minute fix (like printing this message once at startup and not again) could you consider it for an upcoming release?\n\n</p><p>Thanks.\n\n</p><p></p><hr/>\n<em>2013-Aug-27 10:56:56 by johnkn:</em> <br/>\n\nThe 8.1.x series has <code>ClassAds</code> can store 64 bit values, and a wire protocol that will transfer 64 bit ints, so we can now finally get rid of the truncation of disk space and just put a 64 bit value in the <code>Disk</code> attribute.\n\n<p></p><hr/>\n<em>2013-Aug-28 14:15:21 by gthain:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>All changes look code.  Let's double check to see if the call in the old shadow is really needed, and remove the psuedo op if that function is truly dead code.\n\n</p><p>Also, do we really need the #ifdef STDC and pre-ansi C declaration?  If not, let's get rid of that also.\n\n</p><p></p><hr/>\n<em>2013-Sep-24 10:44:14 by smoler:</em> <br/>\n\nTicket placed back into the docpending state, as we need to document this change in the manual.  At the very least, a version history item is needed.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Oct-22 11:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6b764c543467ed267b61e68038feba0f4c14709f\">[37950]</a></span>: minor edit of 8.1.2 version history item <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1784\" onclick=\"get_ticket_and_populate_wrapper('1784'); return false;\" title=\"Newer hard disks may exceed MAX_INT in available size\">#1784</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Oct-15 09:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/568df2fc87e4bcc0d7d409692b5d74699888231c\">[37855]</a></span>: Version History for <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1784\" onclick=\"get_ticket_and_populate_wrapper('1784'); return false;\" title=\"Newer hard disks may exceed MAX_INT in available size\">#1784</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-27 22:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/570b6e3c208ec9ca59b677359b19780b1b9b99a5\">[37366]</a></span>: Publish Disk and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TotalDisk\" title=\"Total Disk\">TotalDisk</a></span> as 64bit int rather than capping at INT_MAX, <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=1784\" onclick=\"get_ticket_and_populate_wrapper('1784'); return false;\" title=\"Newer hard disks may exceed MAX_INT in available size\">#1784</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Oct-22 11:27", "status": "defer", "created": "2010-Nov-22 13:17", "fixed_version": "2010-Nov-22 13:17", "broken_version": "v070000", "priority": "5", "subsystem": "Libs", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "a21345", "customer_group": "ligo", "visibility": "public", "notify": "tstclair@redhat.com; johnkn@cs.wisc.edu,pcouvare@caltech.edu", "due_date": ""}