{"id": 5671, "title": "Ticket #5671: Linux kernel tuning script should set root_maxkeys and root_maxbytes", "description": "<blockquote>\nAs described in incident <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5657\" onclick=\"get_ticket_and_populate_wrapper('5657'); return false;\" title=\"Master failed to restart after upgrade to 8.5.5-366162\">#5657</a></span>, the condor_master may EXCEPT upon startup if the root user is unable to allocate a new linux kernel session keyring.\n\n<p>The problem is the quota for kernel keys is very very small in RHEL 6.0.  It was increased by default in RHEL 6.3 from 200 to 1M.\n\n</p><p>To help prevent incident <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5657\" onclick=\"get_ticket_and_populate_wrapper('5657'); return false;\" title=\"Master failed to restart after upgrade to 8.5.5-366162\">#5657</a></span> from re-occurring upon installation on RHEL 6.0, 6.1, or 6.2, propose that the HTCondor linux tuning script set the key quotas to the same as the defaults in RHEL 6.3.  Also suggest that the error message printed by the condor_master be more helpful in the event it cannot allocate a new keyring due to kernel quotas.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-May-11 17:49:45 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Looks good.\n\n</p><p>Minor quibbles: 'keying' in the comment on line 64 of the tuning script is probably supposed to be 'keyring'.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-May-27 16:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/63ce82cb26841596afc82194464a3e8d4457c265\">[48436]</a></span>: Version history blurb for keyring linux tuning. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5671\" onclick=\"get_ticket_and_populate_wrapper('5671'); return false;\" title=\"Linux kernel tuning script should set root_maxkeys and root_maxbytes\">#5671</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-May-27 15:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3c39d27dd4f5725413985d55e2170ddc5e189763\">[48434]</a></span>: Fix a spelling mistake in comment line of kernel tuning script. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5671\" onclick=\"get_ticket_and_populate_wrapper('5671'); return false;\" title=\"Linux kernel tuning script should set root_maxkeys and root_maxbytes\">#5671</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-May-11 16:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9c23b6e1bb3e9989bb0da8d1c15b60accc938db9\">[48380]</a></span>: Better error message if discard_session_keyring_on_startup fails. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5671\" onclick=\"get_ticket_and_populate_wrapper('5671'); return false;\" title=\"Linux kernel tuning script should set root_maxkeys and root_maxbytes\">#5671</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-May-11 16:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/93b524119bd908676ec980e0c10ef13764229860\">[48379]</a></span>: Linux kernel tuning script set root_maxkeys and root_maxbytes. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5671\" onclick=\"get_ticket_and_populate_wrapper('5671'); return false;\" title=\"Linux kernel tuning script should set root_maxkeys and root_maxbytes\">#5671</a></span>  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-May-27 16:03", "status": "resolved", "created": "2016-May-11 16:50", "fixed_version": "2016-May-11 16:50", "broken_version": "", "priority": "3", "subsystem": "DaemonMaster", "assigned_to": "tannenba", "derived_from": "#5657", "creator": "tannenba", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "egrasmick@wisc.edu, wiscmoate@gmail.com, tim@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}