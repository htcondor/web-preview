{"id": 874, "title": "Ticket #874: Xen support broken with libvirt library", "description": "<blockquote>\nThe move to link the vm-gahp against libvirt.a broke support for Xen and KVM VMs. Here a summary of the problems:\n<ul>\n<li>libvirt functions aren't called with euid root.\n</li><li>VM memory size is incorrect (given in MB instead of kB).\n</li><li>When using LIBVIRT_XML_SCRIPT, virConnectOpen() isn't called.\n</li><li>Handling of error strings needs improvement.\n</li></ul>\n\n<p>Rob Rati has a patch that gets Xen jobs running, but hasn't been tested for KVM yet.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Oct-21 10:17:38 by jfrey:</em> <br/>\n\nIt appears the patch will call virConnectOpen() twice when LIBVIRT_XML_SCRIPT isn't used. Other than that, it looks good to me.\n\n<p></p><hr/>\n<em>2009-Oct-21 16:57:28 by jfrey:</em> <br/>\n\nSome additional problems have been found. Rob Rati and Tim St Clair are working them out, should have a patch ready by end of tomorrow.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/118/vm.patch\">vm.patch</a>\n8716 bytes added by jfrey on 2009-Oct-21 15:16:45 UTC.\n<br/>\nRob's patch, emailed on Oct 20, 2009<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-23 15:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7f46883d5073173db252d3f92c898afe1a945bf5\">[16159]</a></span>: <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=874\" onclick=\"get_ticket_and_populate_wrapper('874'); return false;\" title=\"Xen support broken with libvirt library\">#874</a></span> Minor changes per code review w/Jamie  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-23 15:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d7960b406fc8a6fc7973883a727e19ed35a9bf68\">[16158]</a></span>: <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=874\" onclick=\"get_ticket_and_populate_wrapper('874'); return false;\" title=\"Xen support broken with libvirt library\">#874</a></span> Updated generic config, given param changes.  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-23 15:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6161145eb6d6fa7109daad911ff8b5dfe61e2324\">[16157]</a></span>: - Removed commented/ifdefed out code - Moved calling of isTransferedFile for xen kernel/initrd to just after they are verified to be valid paths in XenType::CreateConfigFile <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=874\" onclick=\"get_ticket_and_populate_wrapper('874'); return false;\" title=\"Xen support broken with libvirt library\">#874</a></span> Committer: Timothy St. Clair  (By Robert Rati )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-23 15:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f074485fee3da24315b22a56116d39eaf7619496\">[16156]</a></span>: Fixes for the VM Universe (KVM) related: <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=874\" onclick=\"get_ticket_and_populate_wrapper('874'); return false;\" title=\"Xen support broken with libvirt library\">#874</a></span> - Removal of instantiation of base splits to Xen of Kvm - Subdate submission and config params Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=861\" onclick=\"get_ticket_and_populate_wrapper('861'); return false;\" title=\"KVM submit and config params are a mess\">#861</a></span> - minor updates to .xml file. - updates to set_root_priv when accessing images.  (By Timothy St. Clair )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-23 15:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5eb147a75e18420867598f4ec2740024dd0ac8ef\">[16155]</a></span>: Numerous fixes for VM Universe jobs: <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=874\" onclick=\"get_ticket_and_populate_wrapper('874'); return false;\" title=\"Xen support broken with libvirt library\">#874</a></span> - libvirt operations that needed to run with root privs were running as non-root - Fixed VM memory size with or without using the LIBVIRT_XML_SCRIPT - Improved handling of libvirt error messages - Fixed numerous issues in the libvirt_simple_script. It should\u00a0[...]\n (By Robert Rati )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2009-Dec-26 20:20", "status": "resolved", "created": "2009-Oct-21 10:16", "fixed_version": "2009-Oct-21 10:16", "broken_version": "v070400", "priority": "1", "subsystem": "VM", "assigned_to": "rrati", "derived_from": "#688", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bkreuter@redhat.com, tstclair@redhat.com, matt@cs.wisc.edu,rrati@redhat.com", "due_date": ""}