{"id": 1118, "title": "Ticket #1118: Proper Target scoping in job ad expressions", "description": "<blockquote>\nWith the move to new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>, attribute references in job ad expressions need to have a 'target.' scope when referring to machine attributes. condor_submit should write proper expressions. The schedd should modify expressions to insert 'target.' on job submission when it detects it necessary. The negotiator will need to do the same to deal with older schedds.\n\n<p>AddExplicitTargetRefs() can be used to do this.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Jan-15 17:15:45 by matt:</em> <br/>\n\nWhat about Negotiator policy and Startd policy? It seems difficult to guess scope on those, meaning there would have to be user visible changes.\n\n<p></p><hr/>\n<em>2010-Jan-20 10:44:16 by jfrey:</em> <br/>\n\nI expect a few users will have to make changes in their expressions. We're developing lists of known machine and job attributes (including ones an admin adds via the config file) for the scoping decision. Where we miss one, we'll have a config param for the admin to amend the list.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-09 14:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/39ffc2bfbec673dbeb766f26cd42470f2d589934\">[17149]</a></span>: Force a TARGET scoping check in condor_startd for the machine ad. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1118\" onclick=\"get_ticket_and_populate_wrapper('1118'); return false;\" title=\"Proper Target scoping in job ad expressions\">#1118</a></span> ClassAd::AddTargetRefs() does a version check on the ad and returns immediately if the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CondorVersion\" title=\"Condor Version\">CondorVersion</a></span> attribute indicates 7.5.1 or higher. This assumes new Condor code does the scoping check before inserting expressions into ads.\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-04 11:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8870a2146c5bf3f338c881a3e3e9f17e3f1bec88\">[17095]</a></span>: Force a TARGET scoping check in condor_submit. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1118\" onclick=\"get_ticket_and_populate_wrapper('1118'); return false;\" title=\"Proper Target scoping in job ad expressions\">#1118</a></span> ClassAd::AddTargetRefs() does a version check on the ad and returns immediately if the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CondorVersion\" title=\"Condor Version\">CondorVersion</a></span> attribute indicates 7.5.1 or higher. This assumes new Condor code does the scoping check before inserting expressions into ads. Condor_submit works\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-21 23:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8768a3fafd757d81c2be16f9ab9c17c3759c839f\">[16950]</a></span>: Schedd adds TARGET scoping to job expressions when reading job queue log. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1126\" onclick=\"get_ticket_and_populate_wrapper('1126'); return false;\" title=\"Deploy TARGET scope correcting functions\">#1126</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1118\" onclick=\"get_ticket_and_populate_wrapper('1118'); return false;\" title=\"Proper Target scoping in job ad expressions\">#1118</a></span> This allows upgrading Condor with jobs in the queue.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-21 15:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8360683c72c13a4c04da3ff1adb674acc89558d4\">[16948]</a></span>: Schedd now adds TARGET scope on incoming expressions for new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1126\" onclick=\"get_ticket_and_populate_wrapper('1126'); return false;\" title=\"Deploy TARGET scope correcting functions\">#1126</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1118\" onclick=\"get_ticket_and_populate_wrapper('1118'); return false;\" title=\"Proper Target scoping in job ad expressions\">#1118</a></span> The schedd now checks expressions for proper TARGET scoping of attributes in the following: * machine ads from the negotiator * SetAttribute() * local and scheduler universe start expressions  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-20 21:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/63fe3c6faebf5e78cb5f6f5826fea4fedd9df96b\">[16942]</a></span>: Negotiator adds Target. scoping on all expressions. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1118\" onclick=\"get_ticket_and_populate_wrapper('1118'); return false;\" title=\"Proper Target scoping in job ad expressions\">#1118</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1126\" onclick=\"get_ticket_and_populate_wrapper('1126'); return false;\" title=\"Deploy TARGET scope correcting functions\">#1126</a></span> This includes job ads, machine ads, and matchmaking policy expressions from the config file.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-20 21:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5809902e8849db56decb426054d505c8f664e2f5\">[16941]</a></span>: Condor_submit now adds Target. scoping in job ad expressions. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1118\" onclick=\"get_ticket_and_populate_wrapper('1118'); return false;\" title=\"Proper Target scoping in job ad expressions\">#1118</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-15 16:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ab824baf9ba4d505a4197cb940e4617669f54a2d\">[16907]</a></span>: Use TARGET when writing the requirements expression. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1118\" onclick=\"get_ticket_and_populate_wrapper('1118'); return false;\" title=\"Proper Target scoping in job ad expressions\">#1118</a></span>  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Feb-05 15:42", "status": "resolved", "created": "2010-Jan-15 16:19", "fixed_version": "2010-Jan-15 16:19", "broken_version": "v070500", "priority": "4", "subsystem": "Unknown", "assigned_to": "jfrey", "derived_from": "#1126", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}