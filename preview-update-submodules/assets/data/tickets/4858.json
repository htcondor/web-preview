{"id": 4858, "title": "Ticket #4858: Recognize CurrentTime in native ClassAds", "description": "<blockquote>\nIn the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> compatibility class, we add a <code>CurrentTime</code> attribute to every ad, to emulate the special version from old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. This extra attribute shows up everywhere, even in ads that have no expression that might reference it. In several places, we remove it because it's in the way or causing problems, or we have to re-insert it after calling <code>Clear()</code>.\n\n<p>This was envisioned as a short-lived hack until we got all HTCondor users to use <code>time()</code> instead. After several years, that has not happened, so it's time for a better solution. We should have the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> library recognize <code>CurrentTime</code> the same way as <code>My</code>, except that the value would be the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> function <code>time()</code>.\n\n</p><p>The recognition of <code>CurrentTime</code> would be contingent on <code>_useOldClassAdSemantics</code> being set to true, so users of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> other than HTCondor wouldn't see it.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Mar-05 11:29:46 by jfrey:</em> <br/>\n\nThis is an internal change that doesn't need a version history entry.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-03 16:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/17602e31741009aa1657fad1765b6d0f0b6d3363\">[43521]</a></span>: Don't add explicit CurrentTime=time() in compat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4858\" onclick=\"get_ticket_and_populate_wrapper('4858'); return false;\" title=\"Recognize CurrentTime in native ClassAds\">#4858</a></span> Now that the new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> library treats <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CurrentTime\" title=\"Current Time\">CurrentTime</a></span> as a special attribute when in old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> mode, the compatibility layer no longer needs to add explicit <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CurrentTime\" title=\"Current Time\">CurrentTime</a></span> entries to ads.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-03 16:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/11e0ab931ef10afc8683893826382bfacf7f1da0\">[43520]</a></span>: Add special attribute <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CurrentTime\" title=\"Current Time\">CurrentTime</a></span> to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> library. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4858\" onclick=\"get_ticket_and_populate_wrapper('4858'); return false;\" title=\"Recognize CurrentTime in native ClassAds\">#4858</a></span> When old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> semantics are enabled, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CurrentTime\" title=\"Current Time\">CurrentTime</a></span> becomes a special attribute that evaluates to the current unix epoch time, and is equivalent to calling the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> function time().\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-03 16:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/540b481fac64d88971b87193dfbf8b185e8ab37e\">[43519]</a></span>: Add #defines for special attribute name strings. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4858\" onclick=\"get_ticket_and_populate_wrapper('4858'); return false;\" title=\"Recognize CurrentTime in native ClassAds\">#4858</a></span>  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Mar-05 11:29", "status": "resolved", "created": "2015-Jan-30 14:27", "fixed_version": "2015-Jan-30 14:27", "broken_version": "v080200", "priority": "3", "subsystem": "ClassAd", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}