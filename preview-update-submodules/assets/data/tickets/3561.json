{"id": 3561, "title": "Ticket #3561: Schedd can exit upon condor_rm -f of a parallel universe job", "description": "<blockquote>\nSchedd was restarted, and a couple of minutes later:\n\n<p></p><pre>   04/02/13 11:31:54 (pid:29501) In DedicatedScheduler::reaper pid 13935 has status 9\n   04/02/13 11:31:54 (pid:29501) ERROR \"ERROR no job status for 22975294.0 in DedicatedScheduler::reaper()!\" at line 978 in file /slots/01/dir_7267/userdir/src/condor_schedd.V6/dedicated_scheduler.cpp</pre>\n</blockquote>", "remarks": "<blockquote>\n<em>2013-Apr-02 15:11:53 by gthain:</em> <br/>\n\nThere's a race condition with condor_rm and condor_rm -f with dedicated scheduler jobs.  Reproduce with\n\n<p>condor_rm &lt;job_id&gt; ; condor_rm -f &lt;job_id&gt;\n\n</p><p></p><hr/>\n<em>2013-Apr-03 08:24:43 by gthain:</em> <br/>\n\nNote that this was introduced by <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2809\" onclick=\"get_ticket_and_populate_wrapper('2809'); return false;\" title=\"Rogue condor_shadows after condor_rm -forcex\">#2809</a></span>\n\n<p></p><hr/>\n<em>2013-Apr-03 11:48:32 by tannenba:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Couple issues -\n\n</p><p></p><ol>\n<li>Patch indeed solves the problem of incorrectly excepting if the job classad is gone once shadow is reaped in the dedicated scheduler.  But it no longer preserves the intended behavior of excepting if the job classad is still present and yet that job classad does not contain a job_status attribute.\n\n<p></p></li><li>Patch removes a block of code in the dedicated scheduler that removes a file named 'procgroup' in the IWD of the job.  Removing this code seems unrelated to the problem being fixed.  At the very least, this ticket should mention why this was removed (ideally it would have been put in as a separate commit, likely attached to a different ticket).\n</li></ol>\n\n<p></p><hr/>\n<em>2013-Apr-03 11:57:04 by gthain:</em> <br/>\n\nThe procgroup file was detritius from the MPI universe, which is no longer supported, and also assumed that the job ad was fully existing; an assumption which isn't valid in the newer condor_rm code.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-04 10:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5182b66eb299beaf2ba411adb8c1ae8195f68ba8\">[35332]</a></span>: fix formatting of 7.9.6 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3561\" onclick=\"get_ticket_and_populate_wrapper('3561'); return false;\" title=\"Schedd can exit upon condor_rm -f of a parallel universe job\">#3561</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-04 10:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6ba05e9d760a8eebd02a754b216fc92f8af38837\">[35330]</a></span>: minor edit and add ticket number to version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3561\" onclick=\"get_ticket_and_populate_wrapper('3561'); return false;\" title=\"Schedd can exit upon condor_rm -f of a parallel universe job\">#3561</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-03 08:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/20ba64ebc9b3703534cc3987b049a12e5f6a0556\">[35316]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3561\" onclick=\"get_ticket_and_populate_wrapper('3561'); return false;\" title=\"Schedd can exit upon condor_rm -f of a parallel universe job\">#3561</a></span> in the version history  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-03 08:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cd53892332d53e16a201a17517d69e361fd25586\">[35314]</a></span>: Fix schedd crash when condor_rm -f parallel universe jobs <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3561\" onclick=\"get_ticket_and_populate_wrapper('3561'); return false;\" title=\"Schedd can exit upon condor_rm -f of a parallel universe job\">#3561</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Apr-04 10:36", "status": "resolved", "created": "2013-Apr-02 14:53", "fixed_version": "2013-Apr-02 14:53", "broken_version": "v070800", "priority": "2", "subsystem": "Parallel", "assigned_to": "gthain", "derived_from": "", "creator": "tannenba", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "tannenba@cs.wisc.edu, bgore@cs.wisc.edu, nyehle@cs.wisc.edu", "due_date": ""}