{"id": 1558, "title": "Ticket #1558: Use non-blocking ldap api in nordugrid_gahp", "description": "<blockquote>\nThe nordugrid_gahp is single-threaded. It should not use any blocking apis that go over the network. Currently, it uses the blocking api for ldap. It should use the non-blocking version.\n\n<p>In ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1557\" onclick=\"get_ticket_and_populate_wrapper('1557'); return false;\" title=\"Gridmanager needs to strip port from nordugrid resource names for ldap\">#1557</a></span>, it's easy for the gahp to end connecting to a gsiftp server trying to do an ldap query. The result is deadlock between the two until one times out after 10 minutes. During that time, the gridmanager is blocked waiting for a response to a subsequent command from the gahp. Maybe the gridmanager should block waiting for responses from a gahp, but that's a problem for another day.</p></blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2010-Oct-20 16:03:30 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.\n<hr/>\n<em>2011-Jan-27 14:46:04 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 16:19:13 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2018-May-04 08:56:05 by jfrey:</em> <br/>\n\nThis problem bit the GlideinWMS factory at UCSD this week (htcondor-support #92719). Queries to one site's ldap server blocked for over a minute before failing. This caused the gridmanager to EXCEPT, as the gahp was unresponsive during that time. No jobs to any site could make progress.\n\n<p>We worked around the problem by increasing the gahp response timeout in the gridmanager:\n</p><div class=\"verbatim\">\n<pre>GRIDMANAGER_GAHP_RESPONSE_TIMEOUT = 120\n</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2018-May-04 08:56", "status": "new", "created": "2010-Aug-03 18:23", "fixed_version": "2010-Aug-03 18:23", "broken_version": "v070302", "priority": "5", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}