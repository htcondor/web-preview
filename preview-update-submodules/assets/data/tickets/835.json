{"id": 835, "title": "Ticket #835: Make ExprTree handling in old ClassAds more like new ClassAds", "description": "<blockquote>\nOne of the difficulties in writing a compatibility layer over new <span class=\"quote\">ClassAds</span> is that <span class=\"quote\">ExprTrees</span> are handled differently between old and new <span class=\"quote\">ClassAds</span>. In old <span class=\"quote\">ClassAds</span>, for each attribute in an ad, the assignment operator and attribute name are included in the <span class=\"quote\">ExprTree</span>. When a user retrieves an attribute's <span class=\"quote\">ExprTree</span>, that full tree is returned, including assignment operator and attribute name. In new <span class=\"quote\">ClassAds</span>, <span class=\"quote\">ExprTree</span> has no assignment operator. The tree contains only the value of each attribute, and the name is stored separately as a string.\n\n<p>We can ease the transition from old to new <span class=\"quote\">ClassAds</span> by having users of old <span class=\"quote\">ClassAds</span> handle <span class=\"quote\">ExprTrees</span> like with new <span class=\"quote\">ClassAds</span>. While the internal handling of <span class=\"quote\">ExprTrees</span> will remain the same, the API can be changed to only expose the attribute value portion of the <span class=\"quote\">ExprTree</span> and provide the attribute name as a separate string.\n\n</p><p>By also adding a free-standing function for unparsing an <span class=\"quote\">ExprTree</span> into a string, we can eliminate most calls on <span class=\"quote\">ExprTree</span> methods that don't have a transparent equivalent in new <span class=\"quote\">ClassAds</span>.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Oct-12 12:00:06 by jfrey:</em> <br/>\n\nWe'll need new versions of the following functions:\n<ul>\n<li>int AttrList::Insert( ExprTree* )\n</li><li><span class=\"quote\">ExprTree</span> <span class=\"quote\">*</span>AttrList::NextExpr()\n</li><li><span class=\"quote\">ExprTree</span> <span class=\"quote\">*</span>AttrList::NextDirtyExpr()\n</li><li>int Parse( const char*, ExprTree*&amp;, int <span class=\"quote\">*</span>)\n</li><li><span class=\"quote\">ExprTree</span> <span class=\"quote\">*</span>AttrList::Lookup( const char* )\n</li></ul>\n\n<p></p><hr/>\n<em>2009-Oct-12 15:08:16 by jfrey:</em> <br/>\n\nPushed changes to V7_3-new_classads-branch to add and use the following new functions for old <span class=\"quote\">ClassAds</span>:\n<ul>\n<li>int AttrList::ClassAd::Insert( const char*, ExprTree* )\n</li><li>ExprTree* AttrList::NextExpr( const char*&amp;, ExprTree*&amp; )\n</li><li>ExprTree* AttrList::NextDirtyExpr( const char*&amp;, ExprTree*&amp; )\n</li><li>ExprTree* AttrList::LookupExpr( const char* )\n</li><li>int Parse( const char*, MyString&amp;, ExprTree*&amp;, int* )\n</li></ul>\n\n<p></p><hr/>\n<em>2009-Oct-13 02:14:35 by jfrey:</em> <br/>\n\nPushed changes to V7_3-new_classads-branch that remove calls to the old <span class=\"quote\">AttrList</span> methods and make the methods private.\n\n<p></p><hr/>\n<em>2009-Oct-13 10:13:20 by jfrey:</em> <br/>\n\nPushed changes to V7_3-new_classads-branch to make the old Parse() function private to the old <span class=\"quote\">ClassAds</span> library.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-14 00:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c1fff552a98453af560d54a5e6302573aaf7f668\">[16048]</a></span>: Fix NextExpr() call in ClassAdXMLUnparser (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=835\" onclick=\"get_ticket_and_populate_wrapper('835'); return false;\" title=\"Make ExprTree handling in old ClassAds more like new ClassAds\">#835</a></span>)  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-13 11:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7b5a782ca391af677ce4cffc35804a45a69974cd\">[16035]</a></span>: Remove old Parse() from <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> tests. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=835\" onclick=\"get_ticket_and_populate_wrapper('835'); return false;\" title=\"Make ExprTree handling in old ClassAds more like new ClassAds\">#835</a></span>)  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-13 10:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9dadc002ab1aeb90cf292711f42d08096a6ea9c9\">[16031]</a></span>: Make the older Parse() function internal to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=835\" onclick=\"get_ticket_and_populate_wrapper('835'); return false;\" title=\"Make ExprTree handling in old ClassAds more like new ClassAds\">#835</a></span>) Also remove a couple last externals callers of the old Parse().  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-13 10:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a5449a7fb941210204f48f7964a9c07104138a26\">[16030]</a></span>: Fix some bad calls to ExprTreeToString(). (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=835\" onclick=\"get_ticket_and_populate_wrapper('835'); return false;\" title=\"Make ExprTree handling in old ClassAds more like new ClassAds\">#835</a></span>)  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-13 01:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0cc6838ead1e4360c39ff4a9812232b8171ccc50\">[16025]</a></span>: Remove older <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> methods from public API. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=835\" onclick=\"get_ticket_and_populate_wrapper('835'); return false;\" title=\"Make ExprTree handling in old ClassAds more like new ClassAds\">#835</a></span>) This includes fixing up the test suite.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-13 00:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/79feffd86819ff4b1c61dd19636cb6d7b1a819d5\">[16024]</a></span>: Add new Insert() and Lookup() methods to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CompatClassAd\" title=\"Compat Class Ad\">CompatClassAd</a></span>. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=835\" onclick=\"get_ticket_and_populate_wrapper('835'); return false;\" title=\"Make ExprTree handling in old ClassAds more like new ClassAds\">#835</a></span>)  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-13 00:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/aa78f4f1e7214734e895bdc2f064b0e50911783b\">[16023]</a></span>: Change CompatClassAd::NextDirtyExpr() to match old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=835\" onclick=\"get_ticket_and_populate_wrapper('835'); return false;\" title=\"Make ExprTree handling in old ClassAds more like new ClassAds\">#835</a></span>)  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-13 00:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e0a97d553601b8c0a29922d6ba06e32703c5b920\">[16021]</a></span>: Update more <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTree\" title=\"Expr Tree\">ExprTree</a></span> callsites with new API. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=835\" onclick=\"get_ticket_and_populate_wrapper('835'); return false;\" title=\"Make ExprTree handling in old ClassAds more like new ClassAds\">#835</a></span>)  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-12 15:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1df34453f80fc6598fb7a0509d9ce037cbc117aa\">[16017]</a></span>: Remove unneeded <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTree\" title=\"Expr Tree\">ExprTree</a></span> helper functions. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=835\" onclick=\"get_ticket_and_populate_wrapper('835'); return false;\" title=\"Make ExprTree handling in old ClassAds more like new ClassAds\">#835</a></span>)  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-12 15:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/48818e1dd68a4c3cff38b8e1abe50d254db830e1\">[16016]</a></span>: Use new API to handle <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTrees\" title=\"Expr Trees\">ExprTrees</a></span> like in new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=835\" onclick=\"get_ticket_and_populate_wrapper('835'); return false;\" title=\"Make ExprTree handling in old ClassAds more like new ClassAds\">#835</a></span>)  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-12 11:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7304adb54f28c9207d4cdf6066f362cf3f924cf3\">[16015]</a></span>: Add free-standing function to unparse an <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTree\" title=\"Expr Tree\">ExprTree</a></span>. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=835\" onclick=\"get_ticket_and_populate_wrapper('835'); return false;\" title=\"Make ExprTree handling in old ClassAds more like new ClassAds\">#835</a></span>)  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-12 11:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a3adeec9e63b910b087b3a48a6133b817a5bad88\">[16014]</a></span>: Add new ClassAd-like <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTree\" title=\"Expr Tree\">ExprTree</a></span> handling in old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=835\" onclick=\"get_ticket_and_populate_wrapper('835'); return false;\" title=\"Make ExprTree handling in old ClassAds more like new ClassAds\">#835</a></span>) Add new API calls in old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> that hide the assignment operator from each attribute's <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTree\" title=\"Expr Tree\">ExprTree</a></span>. Only the portion of the tree representing the attribute's value is used, with the attribute name handled as a separate string.\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Jan-31 13:41", "status": "resolved", "created": "2009-Oct-12 11:10", "fixed_version": "2009-Oct-12 11:10", "broken_version": "v070400", "priority": "4", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "#187", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}