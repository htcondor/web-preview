{"id": 3061, "title": "Ticket #3061: Don't create ec2 ssh keypair if user doesn't request it", "description": "<blockquote>\nIf the user doesn't set <code>ec2_keypair</code> in their submit file, the gridmanager will generate an ec2 ssh keypair for each job, whether or not the user requested a keypair via <code>ec2_keypair_file</code>. If the user doesn't set <code>ec2_keypair_file</code>, the gridmanager shouldn't create a keypair.</blockquote>", "remarks": "<blockquote>\n<em>2012-Nov-27 14:52:03 by tlmiller:</em> <br/>\n\n<div class=\"code\">\n<pre class=\"code\">diff --git a/src/condor_gridmanager/ec2job.cpp b/src/condor_gridmanager/ec2job.cpp\n\nindex 407ff2e..ec2ef15 100644\n--- a/src/condor_gridmanager/ec2job.cpp\n+++ b/src/condor_gridmanager/ec2job.cpp\n\n@@ -194,16 +194,12 @@ dprintf( D_ALWAYS, \"================================&gt; EC2Job::EC2Job 1 \\n\");\n\n    m_vm_check_times = 0;\n\n+   // Only generate a keypair if the user asked for one.\n    jobAd-&gt;LookupString( ATTR_EC2_KEY_PAIR, m_key_pair );\n-\n-   if (m_key_pair.empty())\n-   {\n-     m_should_gen_key_pair = true;\n-     if (!jobAd-&gt;LookupString( ATTR_EC2_KEY_PAIR_FILE, m_key_pair_file ))\n-     {\n-\tm_key_pair_file = NULL_FILE;\n-     }\n-   }\n+   jobAd-&gt;LookupString( ATTR_EC2_KEY_PAIR_FILE, m_key_pair_file );\n+   if( m_key_pair.empty() &amp;&amp; ! m_key_pair_file.empty() ) {\n+\tm_should_gen_key_pair = true;\n+    }\n\n    // In GM_HOLD, we assume HoldReason to be set only if we set it, so make\n    // sure it's unset when we start (unless the job is already held).\n</pre></div>\n\n\n<p></p><hr/>\n<em>2012-Dec-04 13:58:02 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This looks good.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Dec-17 13:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d291702a17c8b1cb21bc409384b50e9066fb2bbb\">[34416]</a></span>: clarified that these 7.8.7 bug fixes are for EC2 jobs in the grid universe ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3289\" onclick=\"get_ticket_and_populate_wrapper('3289'); return false;\" title=\"Grid manager prematurely destroys keypairs.\">#3289</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3061\" onclick=\"get_ticket_and_populate_wrapper('3061'); return false;\" title=\"Don't create ec2 ssh keypair if user doesn't request it\">#3061</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Dec-05 11:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4766b74a0302d17cdb2eb125009be94fa371d543\">[34277]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3061\" onclick=\"get_ticket_and_populate_wrapper('3061'); return false;\" title=\"Don't create ec2 ssh keypair if user doesn't request it\">#3061</a></span>) Don't create ec2 ssh keypair if user doesn't request it.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-Dec-05 11:30", "status": "resolved", "created": "2012-Jun-14 15:56", "fixed_version": "2012-Jun-14 15:56", "broken_version": "v070800", "priority": "2", "subsystem": "Grid", "assigned_to": "tlmiller", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "atlas", "visibility": "public", "notify": "jfrey@cs.wisc.edu, tstclair@redhat.com", "due_date": ""}