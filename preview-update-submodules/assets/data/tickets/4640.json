{"id": 4640, "title": "Ticket #4640: Bug if NEGTIATOR_CONSIDER_PREEMPTION is false", "description": "<blockquote>\nIf <code>NEGOTIATOR_CONSIDER_PREEMPTION</code> is False, the negotiator should stop negotiating after a schedd limit is hit and/or there are no more unclaimed slots.  CMS reports, however, that the negotiation cycle sometimes erroneously continues in these circumstances, resulting in the negotiation cycle taking much longer than would otherwise be required. ToddT did a code inspection, and it looks like a bug was introduced in <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2054\" onclick=\"get_ticket_and_populate_wrapper('2054'); return false;\" title='hfs looping on \"group quota exceeded\"'>#2054</a></span> that could trigger this behavior.</blockquote>", "remarks": "<blockquote>\n<em>2014-Nov-07 16:34:01 by bbockelm:</em> <br/>\n\nDid you mean to commit this line:\n\n<p>sleep(1) ;  // TODDT REMOVE ME!\n\n</p><p>?\n\n</p><p><em>Todd : No, that was a mistake, I removed that line...</em>\n\n</p><p></p><hr/>\n<em>2014-Nov-10 14:35:26 by tannenba:</em> <br/>\n\nAfter commit <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/16eccc9fedca019af20af4402ee9f533883fdfbf\">[41615]</a></span>, regression test <code>job_cp_cclim_acctgrp_basic_van</code> started failing due to a timeout.  Investigating.\n\n<p></p><hr/>\n<em>2014-Dec-02 10:59:45 by tannenba:</em> <br/>\n\nMay be useful for historical purposes to see <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=2952\" onclick=\"get_ticket_and_populate_wrapper('2952'); return false;\" title=\"submitter limit should be more aware of NEGOTIATOR_CONSIDER_PREEMPTION\">#2952</a></span></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-01 03:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b0e0dbecfac86e774fba4c6f64327ac8e7a6618c\">[41780]</a></span>: Effectively revert commit 16eccc9fe <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/16eccc9fedca019af20af4402ee9f533883fdfbf\">[41615]</a></span>. <span class=\"ticket\"><a class=\"active\" href=\"/wiki-archive/tickets/?ticket=4640\" onclick=\"get_ticket_and_populate_wrapper('4640'); return false;\" title=\"Bug if NEGTIATOR_CONSIDER_PREEMPTION is false\">#4640</a></span> Reverted because it broke a regression test, and ran out of time to fix before v8.3.2. So putting logic back to how it was for v8.3.2 and real fix will have to come in the next release.  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-07 17:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5bb9c1f287634ff6e7910cd86a6cc18b0f43a214\">[41621]</a></span>: Remove debug sleep() and fix round-off problem. <span class=\"ticket\"><a class=\"active\" href=\"/wiki-archive/tickets/?ticket=4640\" onclick=\"get_ticket_and_populate_wrapper('4640'); return false;\" title=\"Bug if NEGTIATOR_CONSIDER_PREEMPTION is false\">#4640</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-07 15:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/aee64fedadb5f4ac0a8fa3ece6e57eb8b4e26bce\">[41616]</a></span>: Add some helpful dprintf messages when negotiation skipped. <span class=\"ticket\"><a class=\"active\" href=\"/wiki-archive/tickets/?ticket=4640\" onclick=\"get_ticket_and_populate_wrapper('4640'); return false;\" title=\"Bug if NEGTIATOR_CONSIDER_PREEMPTION is false\">#4640</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-07 13:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/16eccc9fedca019af20af4402ee9f533883fdfbf\">[41615]</a></span>: Skip negotiation when negotiator_consider_preemption=false and limit too low. <span class=\"ticket\"><a class=\"active\" href=\"/wiki-archive/tickets/?ticket=4640\" onclick=\"get_ticket_and_populate_wrapper('4640'); return false;\" title=\"Bug if NEGTIATOR_CONSIDER_PREEMPTION is false\">#4640</a></span> We already had code to skip negotiation if the submitterLimit was lower than the cheapest slot, but the code assumed we always needed to consider preemption.  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Nov-09 13:44", "status": "active", "created": "2014-Oct-08 16:50", "fixed_version": "2014-Oct-08 16:50", "broken_version": "v080200", "priority": "3", "subsystem": "DaemonsCM", "assigned_to": "tannenba", "derived_from": "#4490", "creator": "tannenba", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "tannenba@cs.wisc.edu bbockelm@cse.unl.edu jletts@ucsd.edu", "due_date": ""}