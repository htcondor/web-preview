{"id": 2561, "title": "Ticket #2561: condor_startd did not properly initially invoke hibernation plugin", "description": "<blockquote>\nSome machines from our pool have problem with hibernation, so I decide to shutdown those idle machines. But with default configuration there is only <strong>S4</strong> among Hibernation Suported States.\n\n<p>After a while I found that plugin power_state did not recognize <strong>S5</strong> with \"pm-utils\", but only with \"/sys\".\n\n</p><p>I tried change configuration\n<strong>LINUX_HIBERNATION_METHOD</strong> =\"/sys\"\nan then also <strong>HIBERNATION_PLUGIN_ARGS</strong> = -m /sys\n<br/>\nBut neither of these things work correctly.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Nov-28 10:44:43 by danb:</em> <br/>\n\nThanks for the patch, Lukas!\n\n<p>In the manual, the behavior of HIBERNATION_PLUGIN_ARGS is explicitly defined: \"Used only when the condor_startd is <em>not</em> initially invoking the plug-in to determine the low power states supported.\"  So this patch would alter the defined behavior.  Unfortunately, I don't know why the behavior is defined the way it is.  Perhaps instead of changing it, we could add a new configuration variable HIBERNATION_PLUGIN_INIT_ARGS?\n\n</p><p>I agree that suppression of stderr is bad, because it makes debugging impossible.  However, I am concerned that by mixing stderr with stdout, we would introduce an implicit constraint on the behavior of the hibernation plugin: it must never emit any stderr output except in case of failure.  (And in case of failure, only the first line of stderr output is logged.)  I think to better handle this case, Condor should provide a popen-like implementation that provides separate stdout and stderr pipes.  In addition, it should provide a convenience function that correctly handles reading the full stdout and stderr output into strings and returning the status of the program.  I have made a ticket suggesting this: <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=2668\" onclick=\"get_ticket_and_populate_wrapper('2668'); return false;\" title=\"improve my_popen\">#2668</a></span>.\n\n</p><p></p><hr/>\n<em>2011-Dec-07 15:04:45 by tstclair:</em> <br/>\n\nWhat is the state of this it has a FiV of 7.7.4 and no commits.\n\n<p></p><hr/>\n<em>2011-Dec-14 15:58:00 by johnkn:</em> <br/>\n\nI discussed Dan's objections with him and we decided to go ahead and accept the patch from Lukas unmodified, the documentation will be changed to reflect the new behavior.\n\n<p></p><hr/>\n<em>2011-Dec-15 10:40:55 by smoler:</em> <br/>\n\nKaren documented changes with TJ's description of code change.</blockquote>", "derived_tickets": "", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/479/0001-StartdHibernator-should-use-HIBERNATION_PLUGIN_ARGS-.patch\">0001-StartdHibernator-should-use-HIBERNATION_PLUGIN_ARGS-.patch</a>\n1544 bytes added by slebodnik on 2011-Oct-19 11:12:23 UTC.\n<br/>\nOnly in method StartdHibernator::initialize() hibernation plugin is called with agrument <strong>ad</strong> to detect Hibernation Suported States. But additional command line arguments from <strong>HIBERNATION_PLUGIN_ARGS</strong> are ignored. This patch fix it.\n\n<p>Other repairs in patch:\n</p><ul>\n<li>my_popenv() will also return STDERR, because it was ignored. Therefore it was impossible find error from log files, if plugin was called with wrong arguments\nFor example: HIBERNATION_PLUGIN_ARGS = \"-m /sys\"\n</li><li>added debug print to help fix previous mistake\n</li></ul>\n<br/>\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-15 10:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f89a20f056ba7ebf21440989d4c02bb75e81a548\">[28804]</a></span>: version history item and updates to knob definitions HIBERNATION_PLUGIN and HIBERNATION_PLUGIN_ARGS ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2561\" onclick=\"get_ticket_and_populate_wrapper('2561'); return false;\" title=\"condor_startd did not properly initially invoke hibernation plugin\">#2561</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-14 15:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3f8230fb3821f4e4e0de5495a30841c384452044\">[28782]</a></span>: fix startd to pass arguments through to the hibernator, patch submitted by Lukas Slebodnik slebodnik@sors.com <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2561\" onclick=\"get_ticket_and_populate_wrapper('2561'); return false;\" title=\"condor_startd did not properly initially invoke hibernation plugin\">#2561</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Jan-08 12:55", "status": "resolved", "created": "2011-Oct-19 05:02", "fixed_version": "2011-Oct-19 05:02", "broken_version": "v070302", "priority": "3", "subsystem": "Daemons", "assigned_to": "johnkn", "derived_from": "", "creator": "slebodnik", "rust": "", "customer_group": "users", "visibility": "public", "notify": "lukas.slebodnik@intrak.sk,tannenba@cs.wisc.edu,dan@hep.wisc.edu,tstclair@redhat.com", "due_date": ""}