{"id": 960, "title": "Ticket #960: add heartbeat to CCB listener connection", "description": "<blockquote>\nCraig at Marquette observes problems where CCB listener connections are disconnected by the NAT and the daemon doesn't notice until over a day later.  We have seen similar behavior for one of the CHTC users.  Condor is fairly resilient in the face of network disconnects, but since it can take so long for the listener to notice the problem, this can lead to very inefficient operation.\n\n<p>Like all CEDAR connections, the CCB listener connection should already be using TCP KEEPALIVE, so I don't understand how it can take so long to notice the disconnect.  But even if TCP KEEPALIVE could address the problem, the default interval is not aggressive enough and it is not convenient to configure since it is a system-wide setting.  Therefore, CCB should do application-level heartbeats to detect disconnects earlier and possibly to keep the connection alive by generating a guaranteed minimum rate of activity that is easily configured.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Nov-17 10:01:20 by danb:</em> <br/>\n\nI resolved this by adding CCB_HEARTBEAT_INTERVAL in 7.5.0.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-17 10:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d01d8b728d1cce3bdcdb1a90205e59dd7d68a9a1\">[25124]</a></span>: Documented CCB_HEARTBEAT_INTERVAL. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=960\" onclick=\"get_ticket_and_populate_wrapper('960'); return false;\" title=\"add heartbeat to CCB listener connection\">#960</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-17 09:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9e159d1f914d7cd3215532e2f21de642c4bd7404\">[16352]</a></span>: Added CCB_HEARTBEAT_INTERVAL. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=960\" onclick=\"get_ticket_and_populate_wrapper('960'); return false;\" title=\"add heartbeat to CCB listener connection\">#960</a></span> This can help prevent the TCP connection to the CCB server from getting closed by firewalls due to inactivity and it can speed up detection of closed connections if they do happen.  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Jan-31 13:41", "status": "resolved", "created": "2009-Nov-17 09:40", "fixed_version": "2009-Nov-17 09:40", "broken_version": "v070500", "priority": "4", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}