{"id": 6964, "title": "Ticket #6964: Fix mismatch between alloc()/delete found in #6876 code review", "description": "<blockquote>\nMemory allocation/deallocation mismatch : Many of the data members in file transfer, include the output destination, are allocated with <code>strdup()</code> (sigh) but then deallocated in the dtor with <code>delete</code> (instead of free).  Seems like valgrind should have flagged this error years ago?  Maybe in practice the compiler does not care since the data type is <code>char *</code> ?</blockquote>", "remarks": "<blockquote>\n<em>2019-Jul-11 12:31:03 by coatsworth:</em> <br/>\n\nThis is fixed now, although I'm confused by Todd's comment. The <code>char* OutputDestination</code> that Brian added was indeed allocation with <code>strdup()</code> and then deallocated with <code>delete</code>, which is incorrect. I've changed this to <code>free()</code> now. However all the other <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> data members that are being deallocated with <code>delete</code> are of <code>StringList*</code> type and are allocated using <code>new</code> so I thought this was the correct way to do it? Why would valgrind be upset?\n\n<p>I'm marking this as resolved and adding Todd + Brian to the notify list so they can see this comment. Also this doesn't need a version history entry.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jul-11 12:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2aed6cddc159e8c2eedbad0ac0f6e5b5ea12e488\">[57399]</a></span>: Fixed memory deallocation mismatch for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=OutputDestination\" title=\"Output Destination\">OutputDestination</a></span> member in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6964\" onclick=\"get_ticket_and_populate_wrapper('6964'); return false;\" title=\"Fix mismatch between alloc()/delete found in #6876 code review\">#6964</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Jul-11 12:31", "status": "resolved", "created": "2019-Mar-25 14:48", "fixed_version": "2019-Mar-25 14:48", "broken_version": "v080901", "priority": "3", "subsystem": "FileTransfer", "assigned_to": "coatsworth", "derived_from": "#6876", "creator": "tim", "rust": "", "customer_group": "other", "visibility": "public", "notify": "coatsworth@cs.wisc.edu, tannenba@cs.wisc.edu, bbockelman@morgridge.org", "due_date": ""}