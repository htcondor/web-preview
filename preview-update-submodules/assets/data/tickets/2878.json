{"id": 2878, "title": "Ticket #2878: Provide specific concurrency limit in -analyze rejection message", "description": "<blockquote>\n(From Jon Thomas): Currenty condor_q -analyze and -better-analyze doesn't provide the specific\nconcurrency limit in the \"Reason for last match failure:\" message. It also\ndoesn't provide the details of potential machine matching when a concurrency\nlimit is the cause of the rejections. These details include cluster.proc, so\nwhen a job is rejected due to \"concurrency limit reached\", the output doesn't\nindicate which cluster.proc the message refers to.</blockquote>", "remarks": "<blockquote>\n<em>2012-Mar-15 17:14:30 by eje:</em> <br/>\n\nTEST:\n\n<p>using config:\n</p><div class=\"code\">\n<pre class=\"code\">NEGOTIATOR_DEBUG = D_ACCOUNTANT | D_FULLDEBUG\nNEGOTIATOR_INTERVAL = 20\nNEGOTIATOR_CYCLE_DELAY = 5\n\nNUM_CPUS = 10\n\nTEST1_LIMIT = 1\nTEST2_LIMIT = 1\n</pre></div>\n\n\n<p>spin up a pool, and submit a job cluster that should create a match failure from requirements expr, a match failure from test1-limit and a failure from test2-limit:\n</p><div class=\"code\">\n<pre class=\"code\">universe = vanilla\ncmd = /bin/sleep\nargs = 600\ntransfer_executable = false\nshould_transfer_files = if_needed\nwhen_to_transfer_output = on_exit\n# que a job that will fail due to reqs, not limits:\nrequirements = false\nqueue 1\nrequirements = true\n# one of these jobs will fail from test1 limit:\nconcurrency_limits = test1\nqueue 2\n# one of these jobs will fail from test2 limit:\nconcurrency_limits = test2\nqueue 2\n</pre></div>\n\n\n<p>After the jobs submit, you should see two jobs run, and three jobs remaining idle:\n</p><div class=\"code\">\n<pre class=\"code\">[eje@rorschach ~]$ condor_q\n\n\n-- Submitter: rorschach : &lt;192.168.1.2:41195&gt; : rorschach\n ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD\n   2.0   eje             3/15 15:01   0+00:00:00 I  0   0.0  sleep 600\n   2.1   eje             3/15 15:01   0+00:00:07 R  0   0.0  sleep 600\n   2.2   eje             3/15 15:01   0+00:00:00 I  0   0.0  sleep 600\n   2.3   eje             3/15 15:01   0+00:00:06 R  0   0.0  sleep 600\n   2.4   eje             3/15 15:01   0+00:00:00 I  0   0.0  sleep 600\n\n5 jobs; 0 completed, 0 removed, 3 idle, 2 running, 0 held, 0 suspended\n</pre></div>\n\n\n<p>The first job in the cluster should read as failing from its requirements:\n</p><div class=\"code\">\n<pre class=\"code\">$ condor_q -ana 2.0\n\n-- Submitter: rorschach : &lt;192.168.1.2:41195&gt; : rorschach\n---\n002.000:  Run analysis summary.  Of 10 machines,\n     10 are rejected by your job's requirements\n      0 reject your job because of their own requirements\n      0 match but are serving users with a better priority in the pool\n      0 match but reject the job for unknown reasons\n      0 match but will not currently preempt their existing job\n      0 match but are currently offline\n      0 are available to run your job\n\tNo successful match recorded.\n\tLast failed match: Thu Mar 15 15:02:10 2012\n\n\tReason for last match failure: no match found\n\nWARNING:  Be advised:\n   No resources matched request's constraints\n\nThe Requirements expression for your job is:\n\n( false ) &amp;&amp; ( TARGET.Arch == \"X86_64\" ) &amp;&amp; ( TARGET.OpSys == \"LINUX\" ) &amp;&amp;\n( TARGET.Disk &gt;= RequestDisk ) &amp;&amp;\n( ( TARGET.HasFileTransfer ) || ( TARGET.FileSystemDomain == MY.FileSystemDomain ) )\n\nJob ClassAd Requirements expression evaluates to false\n</pre></div>\n\n\n<p>The 2nd idle job should read as failing from test1 limit:\n</p><div class=\"code\">\n<pre class=\"code\">$ condor_q -ana 2.2\n\n\n-- Submitter: rorschach : &lt;192.168.1.2:41195&gt; : rorschach\n---\n002.002:  Run analysis summary.  Of 10 machines,\n      0 are rejected by your job's requirements\n      0 reject your job because of their own requirements\n      2 match but are serving users with a better priority in the pool\n      8 match but reject the job for unknown reasons\n      0 match but will not currently preempt their existing job\n      0 match but are currently offline\n      0 are available to run your job\n\tNo successful match recorded.\n\tLast failed match: Thu Mar 15 15:02:10 2012\n\n\tReason for last match failure: concurrency limit test1 reached\n</pre></div>\n\n\n<p>The 3rd idle job should read as failing due to test2 limit:\n</p><div class=\"code\">\n<pre class=\"code\">$ condor_q -ana 2.4\n\n-- Submitter: rorschach : &lt;192.168.1.2:41195&gt; : rorschach\n---\n002.004:  Run analysis summary.  Of 10 machines,\n      0 are rejected by your job's requirements\n      0 reject your job because of their own requirements\n      2 match but are serving users with a better priority in the pool\n      8 match but reject the job for unknown reasons\n      0 match but will not currently preempt their existing job\n      0 match but are currently offline\n      0 are available to run your job\n\tNo successful match recorded.\n\tLast failed match: Thu Mar 15 15:02:10 2012\n\n\tReason for last match failure: concurrency limit test2 reached\n</pre></div>\n\n\n<p>Prior to the enhancement condor_q -analyze will not indicate the name of the concurrency limit.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-15 17:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/11f0266d15aac3b9202b2a5127842784eed4a8ab\">[30929]</a></span>: ===VersionHistory:Complete=== ===GT=== <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=2878\" onclick=\"get_ticket_and_populate_wrapper('2878'); return false;\" title=\"Provide specific concurrency limit in -analyze rejection message\">#2878</a></span>  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-15 17:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6d076c3ce5c471aff8553e0984e96523e3f663af\">[30928]</a></span>: Enhanced negotiation to provide name of concurrency limits that cause match failure ===GT:Fixed=== <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=2878\" onclick=\"get_ticket_and_populate_wrapper('2878'); return false;\" title=\"Provide specific concurrency limit in -analyze rejection message\">#2878</a></span>  (By Erik Erlandson )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-Mar-15 17:27", "status": "review", "created": "2012-Mar-09 16:44", "fixed_version": "2012-Mar-09 16:44", "broken_version": "", "priority": "2", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "", "creator": "eje", "rust": "", "customer_group": "other", "visibility": "public", "notify": "eje@cs.wisc.edu, dan@hep.wisc.edu, tstclair@redhat.com, jthomas@redhat.com", "due_date": ""}