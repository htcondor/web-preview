{"id": 3302, "title": "Ticket #3302: condor_q -analyze takes a long time in chtc pool", "description": "<blockquote>\ncondor_q -analyze always contacts the NEGOTIATOR to get user-priorities.  This takes a very long time in CHTC (5 min?).  Todd thinks this is a regression and that the NEGOTIATOR used to respond to userprio requests asynchronously.\n\n<p>Also, the CMS jobs use a Requirements expression that condor_q -analyze doesn't deal with very well.  It ends up treating the meat of the expression - a clause with dozens of parens and many sub-clauses as a single item.</p></blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2012-Dec-11 16:40:34 by johnkn:</em> <br/>\n\nBulk change of target version from v070902 to v070903 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2012-Dec-21 12:09:20 by sfiligoi:</em> <br/>\n\nCan we also have an option to NOT contact the negotiator at all?\n\n<p>More often than not one wants to know if the job would match at all... the fact that other users may have a higher priority is a second level optimization.\n\n</p><p>While the result it would be partial, the difference in speed would be well worth the compromise.\n</p><hr/>\n<em>2013-Jan-22 10:54:51 by johnkn:</em> <br/>\n\nBulk change of target version from v070903 to v070904 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2013-Mar-05 11:07:03 by johnkn:</em> <br/>\n\nThe default for <code>condor_q -analyze</code> and <code>-better-analyze</code> is now to NOT contact the Negotiator.  This means that user priority is not part of analysis.\n\n<p>In order to have user prio be part of analysis, use the <code>-analyze:priority</code> or <code>-better-analyze:priority</code>. With this option enabled, the negotiator is contacted to fetch user priorities and user priorities are considered during analysis.\n\n</p><p></p><hr/>\n<em>2013-Mar-11 15:03:22 by tannenba:</em> <br/>\n\nSee also related ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3535\" onclick=\"get_ticket_and_populate_wrapper('3535'); return false;\" title=\"Fetching user priorities from negotiator takes a long time\">#3535</a></span>.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-21 13:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/96990b176ea9d9802292d9879f3bb4ad481000a0\">[35779]</a></span>: Change Condor to HTCondor in condor_q usage <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3302\" onclick=\"get_ticket_and_populate_wrapper('3302'); return false;\" title=\"condor_q -analyze takes a long time in chtc pool\">#3302</a></span> also move -constraint into the [restriction-list] section of usage ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jan-29 17:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9c00339947b11aa8bf103d29f517dfa8db0c53cf\">[34790]</a></span>: add -inputfile option to condor_userprio to fetch priorities from a file. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3302\" onclick=\"get_ticket_and_populate_wrapper('3302'); return false;\" title=\"condor_q -analyze takes a long time in chtc pool\">#3302</a></span>. this is meant to aid in testing condor_userprio and also condor_q -analyze. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jan-11 11:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0bc80fa228176d6288575814eb2239c34085a48d\">[34615]</a></span>: do condor_q -analyze without considering user priorities unless -analyze:priority is specified <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3302\" onclick=\"get_ticket_and_populate_wrapper('3302'); return false;\" title=\"condor_q -analyze takes a long time in chtc pool\">#3302</a></span> Includes some pruning of obsolete code and cleanup of argument parsing as well. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Nov-02 16:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d8c9463511f6348e8d37209768324e985b187498\">[33972]</a></span>: add -userprios argument to condor_q for use with -analyze, part of <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3302\" onclick=\"get_ticket_and_populate_wrapper('3302'); return false;\" title=\"condor_q -analyze takes a long time in chtc pool\">#3302</a></span> you can supply a text file containing user/submitter priorities (i.e. the output of condor_userprio -long), rather than query the negotiator for that information. Also changed the parsing of -jobads to accept as input the output\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-May-21 14:38", "status": "resolved", "created": "2012-Nov-02 09:45", "fixed_version": "2012-Nov-02 09:45", "broken_version": "v070900", "priority": "2", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "#3335", "creator": "johnkn", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "johnkn@cs.wisc.edu, isfiligoi@ucsd.edu, tstclair@redhat.com", "due_date": ""}