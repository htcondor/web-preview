{"id": 7782, "title": "Ticket #7782: Fix prioritization of commands in condor_c-gahp", "description": "<blockquote>\nCommands in the c-gahp that involve file transfer with the remote schedd can block faster, higher priority commands (like querying the status of the remote jobs). Since file transfer commands can take a long time and they don't block the remote schedd (it services them in a child process), we should make them lower priority in the c-gahp.\n\n<p>We already have two worker processes in the c-gahp, one dedicated to stage-in commands. We should use that dedicated worker for stage-out and proxy refresh commands as well. Also, we should limit the number of file transfer commands that we batch into a single request to the remote schedd, so that the worker can come up for air on a regular basis.\n\n</p><p>This is particularly important to the CMS glidein factor at UCSD. They are having problems when their jobs' x509 proxy is refreshed. Pushing the new proxy to the remote schedd could tie up the c-gahp for 40+ minutes. Making the proxy refresh request more efficient is the subject of another ticket (<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=4693\" onclick=\"get_ticket_and_populate_wrapper('4693'); return false;\" title=\"Condor-C should be smarter about proxy refresh\">#4693</a></span>).</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Oct-13 16:42:16 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This all looks good to me.\n\n</p><p>You'll need to document the new knobs, in addition to writing a release note; in documenting C_GAHP_MAX_FILE_REQUESTS, it seems like you need to be clear that it limits each different command (kind of file request) individually, to minimize confusion for anyone checking their logs.  Maybe something like \"When executing low-priority commands, HTCondor will do no more than this value of each command before checking for new high-priority commands.  Lowering this number should improve the responsiveness of high-priority commands, at the cost of some throughput.\"?</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-19 22:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2146054f485bd6ab5b142b15d870099a8f83dcf4\">[61526]</a></span>: Docs for new knob C_GAHP_MAX_FILE_REQUESTS. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7782\" onclick=\"get_ticket_and_populate_wrapper('7782'); return false;\" title=\"Fix prioritization of commands in condor_c-gahp\">#7782</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-04 19:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/34de223d3a4974a4ed153fbe1294167588c7107d\">[60365]</a></span>: Limit the number of file transfer requests the c-gahp does at a time <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7782\" onclick=\"get_ticket_and_populate_wrapper('7782'); return false;\" title=\"Fix prioritization of commands in condor_c-gahp\">#7782</a></span> A large bunch of file transfer requests (say pushing a refreshed proxy for all jobs) can block other requests for a long time. Now, after a small number of file transfer requests are completed, the results are returned and the\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-04 15:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/81c9311c4b69c51575ec46bec89ba223ff9f2be8\">[60364]</a></span>: Fix prioritization of commands in the c-gahp. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7782\" onclick=\"get_ticket_and_populate_wrapper('7782'); return false;\" title=\"Fix prioritization of commands in condor_c-gahp\">#7782</a></span> Now, all file transfer commands are done in one worker thread and everything else is done in the other thread.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Oct-19 23:04", "status": "resolved", "created": "2020-Aug-04 15:56", "fixed_version": "2020-Aug-04 15:56", "broken_version": "", "priority": "2", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}