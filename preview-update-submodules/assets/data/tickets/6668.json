{"id": 6668, "title": "Ticket #6668: Use LibreSSL on Mac OS 10.13 High Sierra", "description": "<blockquote>\nMacOS 10.13 (High Sierra) provides LibreSSL 2.2.7 as the default ssl library under /usr/lib. The older OpenSSL 0.9.8 used in older macOS versions is still available, but we should move away from it when feasible. One downside to switching to LibreSSL is that binaries built on macOS 10.13 won't run on older versions of macOS.\n\n<p>This work is initially on the branch V8_7-gt6668-macos-libressl.</p></blockquote>", "remarks": "<blockquote>\n<em>2018-May-03 10:57:23 by jfrey:</em> <br/>\n\nCondor and Globus have been patched and now build on macOS with LibreSSL.\nVOMS does not work with LibreSSL. It uses the following three functions, which were removed in LibreSSL:\n<ul>\n<li>ASN1_verify()\n</li><li>ASN1_sign()\n</li><li>ASN1_digest()\n</li></ul>\n\n<p>We can either drop support for VOMS in newer versions of macOS or figure out how to replace these function calls with equivalent code using the current LibreSSL APIs. I've been having trouble finding documentation for how to do the latter. A recent email to the htcondor-users mailing list asking about use of VOMS on macOS received no replies.\n\n</p><p></p><hr/>\n<em>2018-Jul-12 14:31:21 by jfrey:</em> <br/>\n\nI was able to provide alternate implementations for the OpenSSL functions that VOMS uses.\n\n<p></p><hr/>\n<em>2018-Jul-17 14:42:36 by jfrey:</em> <br/>\n\nSince we build our releases on older versions of macOS, which don't have LibreSSL, this change probably doesn't merit a version history entry.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6745\" onclick=\"get_ticket_and_populate_wrapper('6745'); return false;\" title=\"Fix voms when using libressl\">#6745</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nFix voms when using libressl</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jun-15 15:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b948c7d07d146a33f06ef3ae931404d221aa1d1a\">[55070]</a></span>: Remove 8.6 code to use old openssl version on macOS High Sierra. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6668\" onclick=\"get_ticket_and_populate_wrapper('6668'); return false;\" title=\"Use LibreSSL on Mac OS 10.13 High Sierra\">#6668</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-16 11:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f4894b1a6ff3aad15e85470a137bbdbb98d7d3ff\">[54939]</a></span>: Increment version of voms 2.0.13 external. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6668\" onclick=\"get_ticket_and_populate_wrapper('6668'); return false;\" title=\"Use LibreSSL on Mac OS 10.13 High Sierra\">#6668</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-15 16:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1a54cf20bad691d36d65ce01633c46810b26794f\">[54937]</a></span>: Update voms external for macOS to work wiht LibreSSL. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6668\" onclick=\"get_ticket_and_populate_wrapper('6668'); return false;\" title=\"Use LibreSSL on Mac OS 10.13 High Sierra\">#6668</a></span> Patch the voms source to supply replacements for opsnssl functions used by voms that were removed from libressl.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-03 10:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1f921630b2380d5e9e0f4c22d0132e9041492bc7\">[54825]</a></span>: Update Globus external for macOS to work with LibreSSL. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6668\" onclick=\"get_ticket_and_populate_wrapper('6668'); return false;\" title=\"Use LibreSSL on Mac OS 10.13 High Sierra\">#6668</a></span> The easiest way to do this was to update to Globus 6.0. The following changes were made in the process: * Rely on the libtool/ltdl that's included in Globus 6.0, instead of building our own copy. * Patch Globus code so that their ltdl.h header\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-03 10:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b60d9dbeba72b2b24b0d97e3d5f6266ba490488a\">[54824]</a></span>: Use LibreSSL on macOS 10.13 High Sierra and later. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6668\" onclick=\"get_ticket_and_populate_wrapper('6668'); return false;\" title=\"Use LibreSSL on Mac OS 10.13 High Sierra\">#6668</a></span> The \"current\" ssl/crypto libraries on macOS 10.13 are from LibreSSL 2.2.7. Switch the HTCondor build to use these instead of the libraries from OpenSSL 0.9.8.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-Jul-26 14:04", "status": "resolved", "created": "2018-May-03 10:13", "fixed_version": "2018-May-03 10:13", "broken_version": "", "priority": "3", "subsystem": "Security", "assigned_to": "jfrey", "derived_from": "#6653", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}