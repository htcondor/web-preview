{"id": 2627, "title": "Ticket #2627: Rhel 3 failures with dynamic kerberos libraries", "description": "<blockquote>\nWe've noticed that binaries built on old batlab machine nmi-0102 fail when run on machine nmi-0228.\nBoth are 32-bit RHEL 3 machines. nmi-0102 is Update 1 and nmi-0228 is Update 9. This is the error we see:\n<div class=\"code\">\n<pre class=\"code\">condor_version: relocation error: /usr/kerberos/lib/libgssapi_krb5.so.2: undefined symbol: krb5int_enc_arcfour\n</pre></div>\n\n\n<p>lld shows that the binary is using the local system's version of libgssapi_krb5.so, but the Condor-provided versions of libkrb5.so, libcom_err.so, and libk5crypto.so. Although the libraries have the same version numbers on both machines, mixing them is bad. If we force the binary to use only the system's libraries or only the libraries that come with Condor, the problem disappears.\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">% ldd condor_version\n...\n        libkrb5.so.3 =&gt; /home/jfrey/condor-7.7.3-381103-x86_rhas_3-unstripped/bin/../lib/condor/libkrb5.so.3 (0x007fa000)\n        libcom_err.so.3 =&gt; /home/jfrey/condor-7.7.3-381103-x86_rhas_3-unstripped/bin/../lib/condor/libcom_err.so.3 (0x00b5e000)\n        libk5crypto.so.3 =&gt; /home/jfrey/condor-7.7.3-381103-x86_rhas_3-unstripped/bin/../lib/condor/libk5crypto.so.3 (0x008dd000)\n...\n        libgssapi_krb5.so.2 =&gt; /usr/kerberos/lib/libgssapi_krb5.so.2 (0x0063a000)\n</pre></div>\n\n\n<p>We propose two changes to prevent the mixing of kerberos libraries from different systems:\n</p><ul>\n<li>Add <code>/usr/kerberos/lib[64]</code> to the RUNPATH for RHEL 3 builds.\n</li><li>Add <code>libgssapi_krb5.so</code> to the link line.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Nov-11 10:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9eec6c27b94561381fae32cb2832158e73037f27\">[28222]</a></span>: Prevent mixing of kerberos libraries on rhel3. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2627\" onclick=\"get_ticket_and_populate_wrapper('2627'); return false;\" title=\"Rhel 3 failures with dynamic kerberos libraries\">#2627</a></span> On rhel3, due to our runpath and link time settings, we end up using libgssapi_krb5 from the local system, and using the Condor-provided versions of libkrb5, libcom_err, and libk5crypto. Although the versions in the library filenames are the same across\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Nov-14 09:32", "status": "resolved", "created": "2011-Nov-09 17:28", "fixed_version": "2011-Nov-09 17:28", "broken_version": "v070702", "priority": "2", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "#1135", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}