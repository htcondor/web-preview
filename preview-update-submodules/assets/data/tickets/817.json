{"id": 817, "title": "Ticket #817: Return value of Parse() misused", "description": "<blockquote>\nThe return value of Parse() is being used incorrectly in a number of places. This isn't surprising, as it isn't documented anywhere. If the parsing is successful, 0 is returned and the second argument is modified to point at the resulting <span class=\"quote\">ExprTree</span>. If the parsing fails, the second argument is set to NULL and the position in the string at which parsing failed is returned. That position may be 0. So the success of the function call is given by by the value of the second argument, not the return value. But many callers assume that a return value of 0 means success and that the second argument subsequently points to a valid <span class=\"quote\">ExprTree</span>.\n\n<p>Condor_submit is the only caller that cares where the parsing failed. So to simplify the fix and avoid future errors, Parse() should be modified to always return non-zero on failure and accept a new optional int* argument, which will be modified to contain the location of the parsing failure.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Oct-05 14:53:42 by jfrey:</em> <br/>\n\nPushed a fix to V7_4-branch.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-05 17:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/30fae927d968367b71943ff4bdebbc48d4aed0fb\">[15913]</a></span>: Fix docs for Parse() and ParseClassAdEvalExpr(). <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=817\" onclick=\"get_ticket_and_populate_wrapper('817'); return false;\" title=\"Return value of Parse() misused\">#817</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-05 14:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a50ce91fee92277dca5813d51ca598d96489e81e\">[15907]</a></span>: Change return value of Parse() to match usage. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=817\" onclick=\"get_ticket_and_populate_wrapper('817'); return false;\" title=\"Return value of Parse() misused\">#817</a></span>  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-31 13:41", "status": "resolved", "created": "2009-Oct-05 14:15", "fixed_version": "2009-Oct-05 14:15", "broken_version": "v070400", "priority": "4", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}