{"id": 2509, "title": "Ticket #2509: condor_q -better crashes the negotiator for the first job", "description": "<blockquote>\nRemove accountant log, then restart condor.  Submit a job whose requirements are false, then run\n\n<p>condor_q -better &lt;job_id&gt;\n\n</p><p>The negotiator aborts with:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">\n09/28/11 17:07:00 Getting state information from the accountant\n09/28/11 17:07:00 ERROR \"Expected AcctLog entry \"Customer.&lt;none&gt;\" to exist\" at line 1153 in file /scratch/gthain/CONDOR_SRC/src/condor_negotiator.V6/Accountant.cpp\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Sep-28 18:24:38 by eje:</em> <br/>\n\nHappens only when GROUP_NAMES is undefined.  The (re)init logic needs some tweaking for the \"no groups\" code path to make sure \"&lt;none&gt;\" is properly handled, since it always exists.\n\n<p></p><hr/>\n<em>2011-Sep-29 12:12:28 by eje:</em> <br/>\n\nThis is a bug introduced by hierarchical group quotas, but was brought into sharp relief by <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1926\" onclick=\"get_ticket_and_populate_wrapper('1926'); return false;\" title=\"RFE: option for condor_userprio to report acctgrp stats hierarchically\">#1926</a></span>, which caused an exception when it didn't find an entry for group it was expecting to find.\n\n<p></p><hr/>\n<em>2011-Sep-29 12:16:09 by eje:</em> <br/>\n\nREPRO/TEST:\n\n<p>Configure a condor pool with no accounting groups.\n\n</p><p>Then, invoke condor_userprio while job que is still empty.  It will fail (and also cause the negotiator to throw an exception)\n</p><div class=\"code\">\n<pre class=\"code\">$ condor_userprio -all -allusers\nfailed to get classad from negotiator\n</pre></div>\n\n\n<p>after bug fix, condor_userprio will work correctly on startup with an empty queue:\n</p><div class=\"code\">\n<pre class=\"code\">$ condor_userprio -all -allusers\nLast Priority Update:  9/29 09:59\n                                    Effective   Real     Priority   Res   Total Usage       Usage            Last\nUser Name                           Priority  Priority    Factor    Used (wghted-hrs)    Start Time       Usage Time\n------------------------------      --------- -------- ------------ ----  ----------- ---------------- ----------------\n&lt;none&gt;                                   0.50     0.50         1.00    0         0.00 12/31/1969 17:00        ???\n------------------------------      --------- -------- ------------ ----  ----------- ---------------- ----------------\nNumber of users: 0                                                     0         0.00 12/31/1969 17:00        ???\n</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-31 12:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/89b33910509382dfbfc27e0a573f01f653d05dd8\">[28058]</a></span>: We're not using \"the Accountant\" in our descriptions. See <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2522\" onclick=\"get_ticket_and_populate_wrapper('2522'); return false;\" title='document the \"accountant\" so manual readers know what it is'>#2522</a></span> for that policydecision. It is also accepted practice to put the cause of the bug in the version history item. Both of these problems corrected with a rewrite. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2509\" onclick=\"get_ticket_and_populate_wrapper('2509'); return false;\" title=\"condor_q -better crashes the negotiator for the first job\">#2509</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-29 12:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bebe6204fd38f5c100453b2815fbd562559ed2d4\">[27466]</a></span>: ===VersionHistory:Completed=== ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2509\" onclick=\"get_ticket_and_populate_wrapper('2509'); return false;\" title=\"condor_q -better crashes the negotiator for the first job\">#2509</a></span>  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-29 12:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/166f2db7720f8260ca3d7ab3f0bede01810c18dd\">[27465]</a></span>: Fixed bug in Accountant init where table entries for accounting groups were not created on init/reconfig ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2509\" onclick=\"get_ticket_and_populate_wrapper('2509'); return false;\" title=\"condor_q -better crashes the negotiator for the first job\">#2509</a></span>  (By Erik Erlandson )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Sep-29 12:53", "status": "resolved", "created": "2011-Sep-28 17:29", "fixed_version": "2011-Sep-28 17:29", "broken_version": "v070506", "priority": "3", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "#1393", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "eje@cs.wisc.edu", "due_date": ""}