{"id": 6130, "title": "Ticket #6130: speed up reading a Classad from a socket", "description": "<blockquote>\nWe can dramatically speed up reading a classad from a socket by removing copies from the parsing code paths, and by pre-parsing literal values and inserting them into the ad without ever invoking the classad parser.  A bit more savings can be had by parsing the expressions lazily.\n\n<p>A new function, <code>getClassAdEx</code> will be added to classad_oldnew.cpp (where the code to read a classad from a socket currently lives) that can take an argument to enable these speedups,  and the code in the collector that handles updates will be changed to use these speedups.\n\n</p><p>With this change, the unparsed values  that we put into the classad cache will always be wire form, making it possible to unparse directly from the cache when we want to put a classad on the wire.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Feb-28 10:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/15a4e86229920687f7d3f36e3e6f07a13a2ee175\">[50216]</a></span>: Correct ticket number in version history <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6030\" onclick=\"get_ticket_and_populate_wrapper('6030'); return false;\" title=\"DEFAULT_JOB_MAX_RETRIES is not in param table\">#6030</a></span> -&gt; <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6130\" onclick=\"get_ticket_and_populate_wrapper('6130'); return false;\" title=\"speed up reading a Classad from a socket\">#6130</a></span>  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Feb-10 12:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4f7f23580c70c0cee0c860b4d8a20061279ccd93\">[50132]</a></span>: make a knob, COLLECTOR_GETAD_OPTIONS to tune/disable <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6130\" onclick=\"get_ticket_and_populate_wrapper('6130'); return false;\" title=\"speed up reading a Classad from a socket\">#6130</a></span> collector getad speedups. this should probably be a developer-only knob.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Feb-08 09:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/28b81eb22cb6e08fdebb6f55c7bc84ad4d3170db\">[50119]</a></span>: fix for test failures with <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6130\" onclick=\"get_ticket_and_populate_wrapper('6130'); return false;\" title=\"speed up reading a Classad from a socket\">#6130</a></span>. classad unparse out of cache is disabled with this commit.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Feb-07 12:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7c5fea894fd5bd7e9071b59713e1f4c3ff11dc0c\">[50115]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6130\" onclick=\"get_ticket_and_populate_wrapper('6130'); return false;\" title=\"speed up reading a Classad from a socket\">#6130</a></span>, speed up ingesting classads into the collector by Added a new getClassAdEx function to condor_utils, this function has options that allow for * optimized parsing and insert of literal attributes * lazy parsing via the classadCache * flags to control clearing the ad before parsing, and whether\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Feb-28 20:16", "status": "resolved", "created": "2017-Feb-07 11:48", "fixed_version": "2017-Feb-07 11:48", "broken_version": "", "priority": "4", "subsystem": "Libs", "assigned_to": "johnkn", "derived_from": "#6093", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}