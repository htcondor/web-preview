{"id": 2365, "title": "Ticket #2365: the switchboard fails", "description": "<blockquote>\nHi Dan,\n\n<p>I am running into problems with the pre-release build you gave me.\ncondor_root_switchboard seems to be broken.  The first problem is that\nit only accepts the uid, not the username that is specified in the\nprivsep_config.   The second problem is that it doesn't seem to\nunderstand the valid-dirs list.\n\n</p><p>My config:\n\n</p><p></p><div class=\"verbatim\">\n<pre>valid-caller-uids = tony_xen_factory\nvalid-caller-gids = tony_xen_factory\nvalid-target-uids = tony_xen_cms_frontend\nvalid-target-gids = tony_xen_cms_frontend\nvalid-dirs = /opt/glideinwms-prod/client-logs\nvalid-dirs = /opt/glideinwms-prod/client-proxies\nprocd-executable = /opt/glideinwms-prod/condor-wms/sbin/condor_procd\n</pre></div>\n\n\n<p>example command:\n\n</p><p></p><pre>   /opt/glideinwms-prod/condor-wms/bin/../sbin/condor_root_switchboard  mkdir 0 2\n</pre>\n\n<p>stdin (1):\n\n</p><p></p><pre>   user-uid=tony_xen_cms_frontend\\n\n</pre>\n\n<p>as soon as it encounters the new line it spits out the following error:\n\n</p><p></p><pre>   option 'user-uid' has an invalid uid in file: &lt;stdin&gt;:1\n</pre>\n\n<p>stdin (2):  (changed the user-uid to the numeric uid)\n   user-uid=4718\n   user-dir=/opt/glideinwms-prod/client-logs\n\n</p><p>As soon as EOF is hit, the following error occurs:\n\n</p><p></p><pre>   directory is not in list of valid dirs\n</pre>\n\n<p>I cannot set up glideinWMS with condor 7.7.1 right now because of this.\nAll the commands work with condor 7.6.1.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Aug-10 15:29:08 by zmiller:</em> <br/>\n\na bug in switchboard.unix.cpp causes the switchboard to always fail if the user-uid is specified as a username (e.g. \"zmiller\") instead of an integer (e.g. 24842).\n\n<p>it's a one character fix to change the call site of safe_strto_id() to safe_strto_uid().  there are no other call sites for safe_strto_id().  checkin will follow.\n\n</p><p></p><hr/>\n<em>2011-Aug-10 15:50:02 by zmiller:</em> <br/>\n\nafter some more investigation, it turns out this is a regression (although never released)... usernames did used to work until we changed the code to use the new safe_strto_uid functions.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-10 16:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8a468298ecbdef7902eed3647ca80b48394142af\">[26730]</a></span>: fixed a problem in the condor_root_switchboard that was introduced when changing parse_uid() calls to safe_strto_uid() calls. this was never released, so no version history is required. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2365\" onclick=\"get_ticket_and_populate_wrapper('2365'); return false;\" title=\"the switchboard fails\">#2365</a></span>)  (By Zach Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Aug-10 16:48", "status": "resolved", "created": "2011-Aug-08 17:05", "fixed_version": "2011-Aug-08 17:05", "broken_version": "v070701", "priority": "2", "subsystem": "", "assigned_to": "zmiller", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "fermi", "visibility": "public", "notify": "dan@hep.wisc.edu,tiradani@fnal.gov", "due_date": ""}