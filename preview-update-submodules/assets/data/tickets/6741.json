{"id": 6741, "title": "Ticket #6741: Implement Python bindings tests into condor_tests suite", "description": "<blockquote>\nWe have no continuous integration testing for the Python bindings. Brian Bockelman wrote some tests under <a class=\"file\" href=\"rlog?f=src/python-bindings/tests\">/src/python-bindings/tests</a> but these need to be run manually. Let's translate these so they run automatically under condor_tests.\n\n<p>We'll group them into modules structured the same way they are now. For example I'll start by implementing the classad test: python_bindings_classad.run. If any of the unit tests fail, we'll consider the whole module test failed. The stdout logging will indicate which specific unit tests caused it.</p></blockquote>", "remarks": "<blockquote>\n<em>2018-Oct-01 15:55:51 by tlmiller:</em> <br/>\n\nSee <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3878\" onclick=\"get_ticket_and_populate_wrapper('3878'); return false;\" title=\"Python Bindings Tests - Waiting on Brian B\">#3878</a></span>, for reference.\n\n<p></p><hr/>\n<em>2018-Oct-01 16:17:38 by tlmiller:</em> <br/>\n\nFYI: I cherry-picked all of the changes on the branch onto 8.7.10.\n\n<p>Notes on the quick hack, reference build ID 451062:\n\n</p><p><strong>General</strong>\n\n</p><p>We use the Linux path separator to construct some constants.  We should probably just use Perl's path concatenation function.  (Or rewrite the whole thing in Python, but MarkC's already working on that.)\n\n</p><p>Each of these would require further investigation; I'm only posting them here in case what I've seen ends up being useful to MarkC in his efforts, or if the hack test remains active for rather longer than I'm currently anticipating.\n\n</p><p><strong>Windows 10, Windows 8, Windows 7 (htcondor)</strong>\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">Traceback (most recent call last):\n  File \"C:\\condor\\execute\\dir_1168\\userdir\\condor_tests\\python_bindings\\htcondor_tests.py\", line 5, in &lt;module&gt;\n    import pwd\nImportError: No module named pwd\n</pre></div>\n\n\n<p>May be related to expected bug composing paths on Windows.\n\n</p><p><strong>Debian 9</strong>\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">Traceback (most recent call last):\n  File \"/slots/03/dir_15670/userdir/condor_tests/python_bindings/htcondor_tests.py\", line 689, in testTransaction\n    self.assertEqual(len(ads), 0)\nAssertionError: 1 != 0\n</pre></div>\n\n\n<p>This looks like the test didn't wait long enough for the job to exit the queue, given that the other tests all succeeded.\n\n</p><p><strong>MacOSX 10</strong>\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">Traceback (most recent call last):\n  File \"/Volumes/MacintoshHD2/condor/slot3/dir_57402/userdir/condor_tests/python_bindings/htcondor_tests.py\", line 623, in testTransaction\n    self.launch_daemons([\"SCHEDD\", \"COLLECTOR\", \"STARTD\", \"NEGOTIATOR\"])\n  File \"/Volumes/MacintoshHD2/condor/slot3/dir_57402/userdir/condor_tests/python_bindings/htcondor_tests.py\", line 131, in launch_daemons\n    self.waitLocalDaemon(daemon)\n  File \"/Volumes/MacintoshHD2/condor/slot3/dir_57402/userdir/condor_tests/python_bindings/htcondor_tests.py\", line 150, in waitLocalDaemon\n    raise RuntimeError(\"Waiting for daemon %s timed out.\" % daemon)\nRuntimeError: Waiting for daemon SCHEDD timed out.\n</pre></div>\n\n\n<p>This may just be load on the system, given that the other tests all succeeded.\n\n</p><p><strong>Redhat 7</strong>\n\n</p><p>This failure was epic, but characterized by connectivity issues, which seems odd.  Maybe a firewall issue?\n\n</p><p><strong>Ubuntu 16</strong>\n\n</p><p>Also an epic failure: every daemon start-up timed out.  No idea what happened here.  (\n\n</p><p><strong>Windows 10, Windows 8, Windows 7 (classad)</strong>\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">Can't spawn \"timed_cmd.exe -jgd -v -o python_bindings_classad.run.out -t 12M python python_bindings_classad.run\": No such file or directory at run_test.pl line 415, &lt;TF&gt; line 509.\n             python_bindings_classad.run run_test 336: 13:14:37 python_bindings_classad.run FAILED\n</pre></div>\n\n\n<p>Not sure what happened here.  Some sort of PATH or path issue preventing test start-up.</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6976\" onclick=\"get_ticket_and_populate_wrapper('6976'); return false;\" title=\"Fix python bindings tests\">#6976</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nFix python bindings tests</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-07 09:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/69d10e164d61f1884d9824e935ae68a819597a35\">[55955]</a></span>: Python bindings tests now run in Windows nightly builds (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-07 10:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ec6e28753669ad544cb4d05b888f51f39fb3e4bb\">[55858]</a></span>: Re-disabled python bindings tests in Windows (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-06 16:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/79699584016d9f6ea541f27ac1fe4a6e7808a00a\">[55857]</a></span>: Fixed sneaky merge conflict in python bindings tests (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-06 16:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a776a7fb5d11f830d764b687ac7356c51264d2b0\">[55856]</a></span>: Merged <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/670f71cd92a452314f70c5c691d0129e58fdbc5f\">[55472]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5bb3405ed2f76785efcb11621109fe5f2467f484\">[55473]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c022a8ae16c35b8846d414e4f2425d07d4108729\">[55847]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/109115bbe34ffb25bc97aa2f3da6a8f10433af1f\">[55848]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9a3d87a123f796f634bd163ee8eb0f6c2e180f2e\">[55849]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ee9bebe49d1e44322f2b232c70423902fbe663e0\">[55850]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/98009d639da4562b98930daf43c47f1431b7f92e\">[55851]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d9062a3a0ac21ebde7f6d250c65bacb7c629bcd9\">[55852]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a378fb5e93c1ffd33ff4b322357a994c9bbe8883\">[55853]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6a90a5f2b8d7178ae3cbd8c7d1bb9663b979033d\">[55854]</a></span>, Merged python bindings tests into master branch (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>) Conflicts: src/condor_tests/pytest/CondorTest.py  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-06 15:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6a90a5f2b8d7178ae3cbd8c7d1bb9663b979033d\">[55854]</a></span>: More cleanup (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-06 13:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a378fb5e93c1ffd33ff4b322357a994c9bbe8883\">[55853]</a></span>: Fixing broken merge, part 1 (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-06 13:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d9062a3a0ac21ebde7f6d250c65bacb7c629bcd9\">[55852]</a></span>: Merged <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/670f71cd92a452314f70c5c691d0129e58fdbc5f\">[55472]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5bb3405ed2f76785efcb11621109fe5f2467f484\">[55473]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b9ac32e80c684a53a04f1ffe76485f4c9d665122\">[55492]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ca015a9f181bd2675d73d6f1911073b4a56c1739\">[55493]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/85d6e80a9da2dafa3d08cc25dae41939c25f5273\">[55494]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6c19e63e558fc960da5c55f3a662731a94dee036\">[55495]</a></span>, Super ugly merge of python bindings tests, hope this works (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>)\u00a0[...]\n (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-06 12:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/98009d639da4562b98930daf43c47f1431b7f92e\">[55851]</a></span>: Implemented python_bindings_htcondor in pytest. Still lots to fix. (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Nov-13 16:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ee9bebe49d1e44322f2b232c70423902fbe663e0\">[55850]</a></span>: Adding refactor python bindings classad tests(#6741)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-17 10:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c6bd1b7acd957555159783c0cefb6e4c5193b620\">[55579]</a></span>: Added Python bindings tests to Windows skip list (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-01 10:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f11ff10eb7425578455bdd45635196333e409ca0\">[55511]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>) Build and test fixes...  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-01 10:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4a1d788fd252dac42e21a71c4262f68f8fe7e183\">[55510]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>) Use a quick-and-dirty wrapper to add (most of) BrianB's Python bindings tests for the 'htcondor' module.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-01 10:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0478b2c6d54cc01c5e2a083c76dc5bbf6dda18dc\">[55509]</a></span>: Added python_bindings_classad to CMakeLists (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>) Committer: Todd L Miller  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-01 10:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/667da412639d8c4d8201b4bb48aeb0c49ede4f5f\">[55508]</a></span>: Added python bindings classad unit tests (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>) Committer: Todd L Miller  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-28 14:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6c19e63e558fc960da5c55f3a662731a94dee036\">[55495]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>) Build and test fixes...  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-27 16:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ca015a9f181bd2675d73d6f1911073b4a56c1739\">[55493]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>) Use a quick-and-dirty wrapper to add (most of) BrianB's Python bindings tests for the 'htcondor' module.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-26 14:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5bb3405ed2f76785efcb11621109fe5f2467f484\">[55473]</a></span>: Added python_bindings_classad to CMakeLists (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Aug-16 15:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/670f71cd92a452314f70c5c691d0129e58fdbc5f\">[55472]</a></span>: Added python bindings classad unit tests (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6741\" onclick=\"get_ticket_and_populate_wrapper('6741'); return false;\" title=\"Implement Python bindings tests into condor_tests suite\">#6741</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-Oct-19 15:16", "status": "resolved", "created": "2018-Aug-16 14:02", "fixed_version": "2018-Aug-16 14:02", "broken_version": "", "priority": "3", "subsystem": "Tests", "assigned_to": "coatsworth", "derived_from": "", "creator": "coatsworth", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tannenba@cs.wisc.edu, johnkn@cs.wisc.edu, bbockelm@cse.unl.edu, tlmiller@cs.wisc.edu", "due_date": ""}