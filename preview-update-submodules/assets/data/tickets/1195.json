{"id": 1195, "title": "Ticket #1195: Break recursive dependency between nightly.pl and condor_nmi_submit", "description": "<blockquote>\nOne of the big vorticies of suckage in <span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=974\" onclick=\"get_ticket_and_populate_wrapper('974'); return false;\" title=\"NMI Glue is a Pit of Despair\">#974</a></span> is the chicken-and-egg dependency\nbetween nightly.pl, which builds our branches each night, and\ncondor_nmi_submit (henceforth known as cns).\n\n<p>The main problem is that a third party script produces a tags file on\nnmi-s006, then nightly.pl runs as a cronjob and checks out the master's copy\nof cns and runs it with the --nightly flag. Then, cns looks in the tags file,\nand for each branch checks out a copy of nmi_glue/SubmitInfo.pm, loads it for\neach branch, and submits the build.\n\n</p><p>This is obviously problematic since it fixates the master's copy of cns as\nauthoritative across all branches. This means a cns associated with a\nparticular branch is not utilized.\n\n</p><p>The way to fix it would be to have nightly.pl inspect the tags file and for\neach tag checkout the appropriate cns and whatever else it needs and just call\nthe cns as necessary for each branch. This would get rid of the chicken and\negg problem of which cns to use for the nightlies and go a long way to\ndisentangling the horror of <span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=974\" onclick=\"get_ticket_and_populate_wrapper('974'); return false;\" title=\"NMI Glue is a Pit of Despair\">#974</a></span>. The only problem at this point would be to\nmake sure every revision of the cns treats its command line arguments the same\nway for nightly.pl. That is a restriction with which we can easily live and\ncould probably be fixed if desired.\n\n</p><p><span class=\"section\"></span></p><h2>Milestones </h2>\n\n<p></p><ul>\n<li><strong>2010/05/11</strong>\n<ul>\n<li>Read the relevant code bases (nightly.pl, condor_nmi_submit) again. <strong>[DONE]</strong>\n</li><li>Rewrite nightly.pl <strong>[DONE]</strong>\n<ul>\n<li>Parse nightly tag file <strong>[DONE]</strong>\n</li><li>Checkout a new copy of the nmi glue per tag <strong>[DONE]</strong>\n</li><li>Submit a nightly build of Condor using that specific glue <strong>[DONE]</strong>\n</li></ul>\n</li><li>Rip out old code from condor_nmi_submit. <strong>[DONE]</strong>\n</li><li>Check it in to V7_4-branch and master. <strong>[DONE]</strong>\n</li><li>Fix cron jobs to run the new nightly script. <strong>[DONE]</strong>\n</li><li>Update the how to build on NMI pages for the new submission method. <strong>[DONE]</strong>\n</li><li>Make sure I didn't break anything. <strong>[DONE]</strong></li></ul>\n</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-May-06 16:41:21 by psilord:</em> <br/>\n\nThis is code complete and reasonably tested. Tomorrow I will enable the actual nightlies to use it and see what happens.\n\n<p></p><hr/>\n<em>2010-May-10 10:13:00 by psilord:</em> <br/>\n\nOk, I've written the scripts, checked it in, and installed it in the production system. We'll see tonight if it works properly.\n\n<p></p><hr/>\n<em>2010-May-11 14:22:01 by psilord:</em> <br/>\n\nIt seems to be working.\n\n<p></p><hr/>\n<em>2010-May-12 11:17:28 by psilord:</em> <br/>\n\nI did one last tweak to fix some typos, and made the <code>~cndrauto/condor/run_nightly-builds</code> script current to what is on the master.\n\n<p>Things seem to be working well, so this ticket is resolved.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-May-12 11:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5153b922f108f77cc7d71cd7aca928fbc946a86d\">[17975]</a></span>: Fixed some comments and debugging output to be more corect. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1195\" onclick=\"get_ticket_and_populate_wrapper('1195'); return false;\" title=\"Break recursive dependency between nightly.pl and condor_nmi_submit\">#1195</a></span>  (By Pete Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-May-07 11:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dff2ea9448725d8c81fd693f40c9af8a3c54adcc\">[17963]</a></span>: This checkin implements <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1195\" onclick=\"get_ticket_and_populate_wrapper('1195'); return false;\" title=\"Break recursive dependency between nightly.pl and condor_nmi_submit\">#1195</a></span>. The new script run_nightly_builds now reads the nightly tags file, checks out the correct nmi_tools associated with a nightly tag, and submits the build using that version of nmi_tools.\u00a0[...]\n (By Pete Keller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-May-12 11:19", "status": "resolved", "created": "2010-Feb-09 13:49", "fixed_version": "2010-Feb-09 13:49", "broken_version": "v070500", "priority": "4", "subsystem": "Packaging", "assigned_to": "psilord", "derived_from": "#974", "creator": "psilord", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu, psilord@cs.wisc.edu, tstclair@redhat.com", "due_date": "20100511"}