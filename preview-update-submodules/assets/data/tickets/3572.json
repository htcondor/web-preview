{"id": 3572, "title": "Ticket #3572: Daylight savings time causes master to restart on Windows", "description": "<blockquote>\nWhenever the computer changes the clocks for daylight savings time, the condor_master is fooled into believing that condor_master.exe has been updated and will restart condor on that machine.\n\n<p>This is caused by a circa 2007 workaround for a supposed bug in windows that would incorrectly adjust UTF file times for daylight savings time.  The windows bug no longer exists, so the workaround is now a bug.\n\n</p><p>UPDATE: 3/11/2014.  There is an additional problem that showed up when daylight savings time switched on 3/9/2014.  If the master timestamp is before daylight savings time, when daylight savings time kicks in the c-runtime and Windows appear to disagree about whether daylight savings should be added to the timestamp or not.  See the bug at <a class=\"external\" href=\"http://goo.gl/rBQjie\">http://goo.gl/rBQjie</a>\n\n</p><p>It seems likely that switching to the 2012 c-runtime will fix this, but it would be even safer to just fetch the master timestamp using pure windows API and never convert it to localtime at all.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Apr-15 11:47:28 by johnkn:</em> <br/>\n\nIn Vs2008, the bug in the c-runtime is that if daylight savings time changes <em>while process is running</em>, the values return for file ctime, atime, and mtime from stat and fstat will be off by 1 hour until _tzset is called.\n\n<p></p><hr/>\n<em>2014-Mar-10 16:49:56 by tannenba:</em> <br/>\n\nTJ, when you say above that \"the bug no longer exists\" in Windows, what do you mean?\n\n<p>In a few minutes of googling around, looks to me like the bug exists in Vs2008 runtime and was supposedly fixed in (solely) the Vs2010.\n\n</p><p>See <a class=\"external\" href=\"http://goo.gl/qdNKt9\">http://goo.gl/qdNKt9</a>\n\n</p><p>And see the bug microsoft bug report at <a class=\"external\" href=\"http://goo.gl/rBQjie\">http://goo.gl/rBQjie</a>\n\n</p><p>Is the runtime shipped with HTCondor the redistributable Vs2008 runtime of the redistributable Vs2010 ?</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-06 11:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9011f2de66ec372ffe49846a302d85089ce80562\">[41594]</a></span>: minor 8.2.4 version history item edit <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3572\" onclick=\"get_ticket_and_populate_wrapper('3572'); return false;\" title=\"Daylight savings time causes master to restart on Windows\">#3572</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-06 09:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/01e64aed1700808b6ff4be6d4de0620c7378f500\">[41589]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4638\" onclick=\"get_ticket_and_populate_wrapper('4638'); return false;\" title=\"Disk space machine attributes on Windows are incorrect\">#4638</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4634\" onclick=\"get_ticket_and_populate_wrapper('4634'); return false;\" title=\"condor_kbdd heap corruption\">#4634</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3572\" onclick=\"get_ticket_and_populate_wrapper('3572'); return false;\" title=\"Daylight savings time causes master to restart on Windows\">#3572</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-27 10:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/33d49a2ed3ba85bbd374d5007228fb0202fea639\">[41450]</a></span>: fix for daylight savings time causing condor_master to restart on Windows <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3572\" onclick=\"get_ticket_and_populate_wrapper('3572'); return false;\" title=\"Daylight savings time causes master to restart on Windows\">#3572</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-15 15:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c087f1cd08c7711ce7598044f499c7ec69f536f1\">[35409]</a></span>: better logging of new-binary-restart in the master for 7.9 series <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3572\" onclick=\"get_ticket_and_populate_wrapper('3572'); return false;\" title=\"Daylight savings time causes master to restart on Windows\">#3572</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-15 13:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4a38c44519ca7ee8b4402f872d99e0f30066a699\">[35406]</a></span>: Edit to 7.8.9 version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3572\" onclick=\"get_ticket_and_populate_wrapper('3572'); return false;\" title=\"Daylight savings time causes master to restart on Windows\">#3572</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-15 12:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/00e4ab3eef75d0ed4b411e6e15a7580a592bb97f\">[35404]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3572\" onclick=\"get_ticket_and_populate_wrapper('3572'); return false;\" title=\"Daylight savings time causes master to restart on Windows\">#3572</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-15 12:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d51861a1ba91f89a0dd96888a6e120dce0cf9cf6\">[35403]</a></span>: fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3572\" onclick=\"get_ticket_and_populate_wrapper('3572'); return false;\" title=\"Daylight savings time causes master to restart on Windows\">#3572</a></span>, daylight savings time causes master to restart on Windows ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Nov-06 09:45", "status": "resolved", "created": "2013-Apr-11 14:26", "fixed_version": "2013-Apr-11 14:26", "broken_version": "v080000", "priority": "1", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "s8279", "customer_group": "other", "visibility": "public", "notify": "johnkn@cs.wisc.edu", "due_date": ""}