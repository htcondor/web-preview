{"id": 7011, "title": "Ticket #7011: Add SciTokens support as an authorization method.", "description": "<blockquote>\nOnce we have a non-blocking TLS implementation, it should be relatively straightforward to provide a SCITOKENS authentication method.  When SCITOKENS is used, simply send the token from the client to the server and have the server perform authentication/authorization of the token as necessary.</blockquote>", "remarks": "<blockquote>\n<em>2019-Apr-21 22:23:06 by bbockelm:</em> <br/>\n\nHere's a short write-up of the approach: <a class=\"external\" href=\"https://docs.google.com/document/d/1udRe_NMhuvwLWgvUIiwhIZ75z1RfCRpm1YnGZaZIDUk/edit\">https://docs.google.com/document/d/1udRe_NMhuvwLWgvUIiwhIZ75z1RfCRpm1YnGZaZIDUk/edit</a>\n\n<p></p><hr/>\n<em>2019-May-08 12:55:53 by bbockelm:</em> <br/>\n\nCode merged.\n\n<p>Note I'm PURPOSELY not doing documentation right now as we might tinker with the config knobs.\n\n</p><p>Would like to chat with ToddT and TimT about how much exposure we want for the 8.9.2 release versus only sharing with beta users.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-27 20:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8f14aa4b704a70c2959a2dc70919f6d092b70971\">[56970]</a></span>: Add simple documentation for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span> auth'n. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span> Sufficient to note that it exists -- but still pretty minimal in order to further flesh out support in 8.9.3.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-10 14:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1abea684deda02d3ba2b2196a8ac0a3e14e6b44d\">[56858]</a></span>: Add support for passing a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciToken\" title=\"Sci Token\">SciToken</a></span> during submit. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span> This adds support to include a token filename in the job ad, allowing the subsequently-spawned GAHP to utilize it when submitting jobs to a remote HTCondor-CE.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 07:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/498e4749420fa3726a0dc4d311e79e8cf40516c9\">[56816]</a></span>: Remove unnecessary old buildfile for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 05:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0c76db1f310c7e50c5955910645d49ffea4fd3ee\">[56814]</a></span>: Fixup the cmake logic for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span> Now, if you request <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span> to be built - and the underlying library is not available - then we will fail the configuration instead of proceeding and silently ignoring your wishes.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 05:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f73eaab29419f4e4db3e0834056ff479b183e61e\">[56813]</a></span>: Have the server send a failure indicator for bad tokens. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span> This refactors some of the server logic so we parse the token before the last network message is passed. This way, if the server doesn't like the token itself (invalid format, expired, etc), it will send a failure back to the client.\u00a0[...]\n (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 00:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1b3bc21ae8859ceac6c63ffcbb37895c6e26a6da\">[56812]</a></span>: Fix builds when <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span> is disabled. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 00:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e8120e29aa6f24651b481292bfee57802a45eb41\">[56811]</a></span>: Disable <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span> by default. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 00:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/946d977b791a742a7ae3c637cd0beb733a20c20c\">[56810]</a></span>: Allow scitokens library to be dlopen'd in the shadow. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 00:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/58a9bcee582a5ee4fbb11c01d555921c6f5616c5\">[56808]</a></span>: Add support for mapping scopes to authorizations. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 00:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ea72eda7ca5fd07f88bb031fce382189cbd047e6\">[56809]</a></span>: Fix external builds with scitokens. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 00:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/96470ae86ea0f6a8aa25116573a73b8a06af49f3\">[56807]</a></span>: Fix initial <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span> implementation based on testing. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 00:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e96281fdbee280472c4e4e9c96c7822f86e13ed5\">[56806]</a></span>: Fixup: Map SCITOKENS string to correct int. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 00:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8bdc88fe467c1279db3cf9fd920bfcb8371a179a\">[56805]</a></span>: Verify <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciToken\" title=\"Sci Token\">SciToken</a></span> contents and integrate with auth'n. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 00:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2c7c8638053daf723e594b4d6fb0acf1d29c37fb\">[56804]</a></span>: Add support for a new \"SCITOKENS\" auth method. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span> This mode causes the client to provide a token, if available, to the remote server over a TLS connection. We do not currently parse or verify the token.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-08 00:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/14ca8920d58ef7b95411049593fb2f9c47492d56\">[56803]</a></span>: Add build support for scitokens external. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-01 13:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c119a7279db22ccab20a02bc5684bf12a01327ca\">[56722]</a></span>: Allow scitokens library to be dlopen'd in the shadow. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-20 22:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/33a38eba2e577ebf0f99e0602a735ceaf4571853\">[56682]</a></span>: Add support for mapping scopes to authorizations. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-20 22:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/082fb1c6f8d0cebc0b8fa7ced45d565b8bc9d6d3\">[56681]</a></span>: Fix initial <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span> implementation based on testing. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-20 22:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ae745eb599d540fc5ff5f12af8c4772ac0177a18\">[56680]</a></span>: Fixup: Map SCITOKENS string to correct int. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-20 22:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0dde486afea8e286cdd2d94b3998dfb395536794\">[56679]</a></span>: Bugfix: Avoid double-deleting the BIO object from OpenSSL. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-20 22:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e26e2fc4bff652690165f9430247b4a740c509f2\">[56678]</a></span>: Verify <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciToken\" title=\"Sci Token\">SciToken</a></span> contents and integrate with auth'n. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-20 22:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/90ac6fb1267627af12c66329df872d9da0255cd7\">[56677]</a></span>: Add support for a new \"SCITOKENS\" auth method. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span> This mode causes the client to provide a token, if available, to the remote server over a TLS connection. We do not currently parse or verify the token.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-20 22:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b6b6fe4437748489c5391c5e56e9f3c90dc27906\">[56676]</a></span>: Add build support for scitokens external. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7011\" onclick=\"get_ticket_and_populate_wrapper('7011'); return false;\" title=\"Add SciTokens support as an authorization method.\">#7011</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-May-27 20:38", "status": "resolved", "created": "2019-Apr-20 22:08", "fixed_version": "2019-Apr-20 22:08", "broken_version": "", "priority": "3", "subsystem": "", "assigned_to": "bbockelm", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "scitokens", "visibility": "public", "notify": "bbockelman@morgridge.org", "due_date": ""}