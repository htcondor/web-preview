{"id": 2680, "title": "Ticket #2680: add group_quota and group_priority info to condor_userprio -all (and i", "description": "<blockquote>\nAs Todd and I realized at the Oct-2011 DASWG meeting in Milwaukee, it's currently extremely difficult to understand current group priority settings.  Adding group_quota and group_priority info to condor_userprio -all would be a huge help.  Having it indented properly to indicate sub-groups would be even better.\n\n<p>condor_userprio will now default to outputing most columns in -hierarchical format if there are groups, and -flat format if there are no groups (other than &lt;none&gt;):\n\n</p><p>The default output for negotiators that have groups looks like this\n</p><div class=\"verbatim\">\n<pre>Last Priority Update:  1/6  13:40\nGroup                          Config    Effective   Priority   Res   Total Usage  Time Since\n  User Name                     Quota     Priority    Factor   In Use (wghted-hrs) Last Usage\n----------------------------- --------- ------------ --------- ------ ------------ ----------\nDuck                               2.00                             0         0.02    0+03:20\n  goose@crane.cs.wisc.edu                       0.50      1.00      0         0.02    0+03:20\nSedge                              4.00                             0         0.10    0+03:24\n  johnkn@crane.cs.wisc.edu                      0.50      1.00      0         0.12    0+03:24\n&lt;none&gt;                             0.00                             0         5.38    0+03:25\n  Sedge@crane.cs.wisc.edu                       0.50      1.00      0         0.05    0+03:25\n----------------------------- --------- ------------ --------- ------ ------------ ----------\nNumber of users: 3                                                  0         0.18    0+23:59\n</pre></div>\n\n\n<p>The default output for negotiators that have no groups is\n</p><div class=\"verbatim\">\n<pre>Last Priority Update:  1/6  13:39\n                            Effective   Priority   Res   Total Usage  Time Since\nUser Name                    Priority    Factor   In Use (wghted-hrs) Last Usage\n-------------------------- ------------ --------- ------ ------------ ----------\ngoose@crane.cs.wisc.edu            0.50      1.00      0         0.02    0+02:26\njohnkn@crane.cs.wisc.edu           0.50      1.00      0       832.87   18+03:35\n-------------------------- ------------ --------- ------ ------------ ----------\nNumber of users: 2                                     0       832.89\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Dec-19 10:54:48 by eje:</em> <br/>\n\nAdding quota would involve plumbing information about quota, which currently resides in the negotiator structure under the tree whose root is kept at hgq_root_group, into the accountant.\n\n<p>There are some policy questions here.  Which embodiment of \"quota\" do we want?   From the config file, quota can be either static or dynamic.  static quotas are in units of actual slots, while dynamic quotas are unitless factors from interval [0,1].  The HGQ algorithm translates these each neg-cycle into a quota in units of slots (possibly weighted).\n\n</p><p>My suggestion would be to insert the HGQ-algorithm's value for quota into the accountant, each cycle.  What this would mean would be that condor_userprio would give the user the quota value for each group from the most recent negotiation cycle.\n\n</p><p>Note, this value would then be either weighted or unweighted, depending on NEGOTIATOR_USE_SLOT_WEIGHTS.\n\n</p><p></p><hr/>\n<em>2011-Dec-29 14:34:31 by johnkn:</em> <br/>\n\nNegotiator groups have 3 different kinds of quota information, Effective, Config and Subtree.  And in order to display groups in negotiation order, condor_userprio needs the value of the group's sort_key.\n\n<p>Each group returned by the accountant in <span class=\"quote\">Accountant::ReportState</span> now includes 4 new attributes.\n\n</p><p></p><div class=\"verbatim\">\n<pre>EffectiveQuotaNN  float contents of the GroupEntry::quota field.\nConfigQuotaNN     float contents of the GroupEntry::config_quota field\nSubtreeQuotaNN    float contents of the GroupEntry::subtree_quota field\nGroupSortKeyNN    float contents of the GroupEntry::sort_key field.\n</pre></div>\n\n\n<p>condor_userprio keeps track of which fields were returned for it's query to the negotiator so that it can behave appropriately when talking to a negotiator that doesn't return this information.\n\n</p><p></p><hr/>\n<em>2012-Jan-04 12:59:07 by eje:</em> <br/>\n\nComments:\n<ul>\n<li>Is this targeted for 7.6.6?  (assuming that's a typo)\n</li><li>I think you need to check for both the end of pval and parg in IsArg()\n</li><li>Also might be nice to have IsArg() take 'const std::string&amp;' instead of 'char*', use iterators instead of ptrs, etc.   Still works fine if you call with 'char*' arguments.\n</li><li>should \"-flat\" explicitly turn off \"-hierarchical\"?  (seems like yes)\n</li><li>I think there's a typo:  \"heir\" --&gt; \"hier\"\n</li><li>I'd recommend -[hier]archical instead of -h[ierarchical]\n</li><li>It would be helpful to post test/demo examples of new features on the ticket (sort of like <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1926\" onclick=\"get_ticket_and_populate_wrapper('1926'); return false;\" title=\"RFE: option for condor_userprio to report acctgrp stats hierarchically\">#1926</a></span>)\n</li><li>Should also consider adding regression testing for new features, maybe log as separate ticket?\n</li></ul>\n\n<p>tangentially, I'd love to standardize on some argument-handling library, maybe for 7.9?  I've previously used boost::program_arguments, which isn't bad although it would violate current policy of avoiding boost libs requiring linking.  Also, I didn't love everything about it, maybe possible to do better.\n\n</p><p></p><hr/>\n<em>2012-Jan-04 17:49:35 by johnkn:</em> <br/>\n\n<ul>\n<li>7.6.6 is indeed a typo - fixed.\n</li><li>don't need to check for end of parg because when *parg == 0 it can't match *pval when *pval != 0.\n</li><li>yes -flat should explicitly turn off \"-hierarchical\"? I'll look into that.\n</li><li>\"heir\" is not a typo, I'm being forgiving of a common misspelling.\n</li><li>I might switch to -hier[archical] now that it's the default\n</li><li>Definitely need some tests for condor_userprio - in a separate ticket.\n</li></ul>\n\n<p></p><hr/>\n<em>2012-Jan-05 15:10:20 by nwp:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Here are my comments:\n\n</p><p>Version history needs a ticket number attached to it. (in <code>doc/version-history/7-7.history.tex</code>)\n\n</p><p>There is a comment that something needs to be done at line 854 in <code>src/condor_tools/user_prio.cpp</code>, but it is not clear what needs to be done.\n\n</p><p>It looks like a string is getting overwritten in <span class=\"quote\">PadToWidth</span> at line\n866 in <code>src/condor_tools/user_prio.cpp</code>; maybe that is OK, but it seems like\nyou want to use <code>&amp;pszDest[cchExist]</code> as the first argument of the memset.\n\n</p><p>Also in the same function, why use <code>cch-1</code>?  (If cch == cchExist, then you are trimming out the last character of <code>pszDest</code>).\n\n</p><p></p><hr/>\n<em>2012-Jan-10 09:55:08 by nwp:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Changes look good to me.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-24 14:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a375396a06ffc014e5807efd90098e7ec8206b10\">[29190]</a></span>: correcting/updating references to condor_userprio ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2680\" onclick=\"get_ticket_and_populate_wrapper('2680'); return false;\" title=\"add group_quota and group_priority info to condor_userprio -all (and i\">#2680</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-24 13:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ddaf7ecc1f4def2bbb5f2f8e64cb78f181b774eb\">[29188]</a></span>: overhaul of condor_userprio man page ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2680\" onclick=\"get_ticket_and_populate_wrapper('2680'); return false;\" title=\"add group_quota and group_priority info to condor_userprio -all (and i\">#2680</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-12 14:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e42d9271f035b42ed54ede986c6a3395733df527\">[29100]</a></span>: add to condor_userprio display for new the new SurplusPolicyNNN attribute added to negotiator userprio query <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2680\" onclick=\"get_ticket_and_populate_wrapper('2680'); return false;\" title=\"add group_quota and group_priority info to condor_userprio -all (and i\">#2680</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-12 10:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3e3657715e58e58e1fd8b6d1cd87817948c4f2e2\">[29090]</a></span>: change accountant attribute GroupAutoregroupNN to SurplusPolicyNN for condor_userprio <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2680\" onclick=\"get_ticket_and_populate_wrapper('2680'); return false;\" title=\"add group_quota and group_priority info to condor_userprio -all (and i\">#2680</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-12 09:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9aa3e742705f5e7cdc58fbee518e6d376a30e7b9\">[29085]</a></span>: add column to show accept_surplus and/or autoregroup state of groups in condor_userprio <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2680\" onclick=\"get_ticket_and_populate_wrapper('2680'); return false;\" title=\"add group_quota and group_priority info to condor_userprio -all (and i\">#2680</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-11 09:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9c92eb226af1698ecce3de2361e6ac1ea7443670\">[29060]</a></span>: add autoregen states to the information that negotiator sends to condor_userprio in support of <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2680\" onclick=\"get_ticket_and_populate_wrapper('2680'); return false;\" title=\"add group_quota and group_priority info to condor_userprio -all (and i\">#2680</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-10 14:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/70b60c6e701a334190439199c8f9923cf3c52094\">[29052]</a></span>: add reporting of group quota and sort_key to 7.6.6 negotiator for use by 7.7.5 condor_userprio change is in support of <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2680\" onclick=\"get_ticket_and_populate_wrapper('2680'); return false;\" title=\"add group_quota and group_priority info to condor_userprio -all (and i\">#2680</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-09 14:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6c8f0737e62a145b3ed074d48ace82996beecaa0\">[29035]</a></span>: fix sorting of groups for condor_userprio when in Hierarchial mode <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2680\" onclick=\"get_ticket_and_populate_wrapper('2680'); return false;\" title=\"add group_quota and group_priority info to condor_userprio -all (and i\">#2680</a></span>, groups sort by useage when displaying useage data, sort by priority when displaying priority data and there is no sort_key. minor fixes to useage printout. ===VersionHistory:Complete===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-06 14:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/08ac707b6ac0b437eeef9a04db59c40e16fcd8a4\">[29017]</a></span>: incorporate Nathan's notes from reviewing <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2680\" onclick=\"get_ticket_and_populate_wrapper('2680'); return false;\" title=\"add group_quota and group_priority info to condor_userprio -all (and i\">#2680</a></span>. make -most the default output for condor_userprio add a time-since-last-usage column. ===VersionHistory:Complete===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-05 14:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/840c8dcb7ab401acbc3c37133c84903c19a6ac41\">[29001]</a></span>: add version history for <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2680\" onclick=\"get_ticket_and_populate_wrapper('2680'); return false;\" title=\"add group_quota and group_priority info to condor_userprio -all (and i\">#2680</a></span> ===VersionHistory:Complete===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-29 15:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5a02ee5f38b25d60232ec4174f3fca7cdd2b52ee\">[28954]</a></span>: one last warning fix for condor userprio <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2680\" onclick=\"get_ticket_and_populate_wrapper('2680'); return false;\" title=\"add group_quota and group_priority info to condor_userprio -all (and i\">#2680</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-29 15:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/204c59f09bc16f2bc4b4c83413a9193440c31363\">[28953]</a></span>: warning fixes for condor_userprio <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2680\" onclick=\"get_ticket_and_populate_wrapper('2680'); return false;\" title=\"add group_quota and group_priority info to condor_userprio -all (and i\">#2680</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-29 14:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a03e06f7e14c4a54d413f49db8e71ef30992e08e\">[28949]</a></span>: Add group quota information to condor_userprio display. <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2680\" onclick=\"get_ticket_and_populate_wrapper('2680'); return false;\" title=\"add group_quota and group_priority info to condor_userprio -all (and i\">#2680</a></span>. modify accountant to return quota information and sort_key to condor_userprio. added 3 new columns of data to condor_userprio -all. re-factored code for building the display and for parsing command line arguments because it was getting out\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-Apr-17 14:59", "status": "defer", "created": "2011-Dec-01 21:02", "fixed_version": "2011-Dec-01 21:02", "broken_version": "", "priority": "5", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "", "creator": "pfc", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pfcouvar@syr.edu,tstclair@redhat.com, eje@cs.wisc.edu, johnkn@cs.wisc.edu,pcouvare@caltech.edu", "due_date": ""}