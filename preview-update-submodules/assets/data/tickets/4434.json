{"id": 4434, "title": "Ticket #4434: Arguments to remote_gahp aren't handled properly", "description": "<blockquote>\nThe remote_gahp script used by BOSCO for remote batch submissions supports several optional command line arguments to override the default settings for ssh credentials and the remote environment. There are a couple problems with using these arguments in the grid_resource attribute of a submit file.\n\n<p></p><ul>\n<li>The ssh credential arguments are ignored when remote_gahp invokes the helper script bosco_ssh_start.\n</li><li>The condor_gridmanager puts the arguments of remote_gahp in an unsupported order.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2014-Jul-02 17:06:20 by marco:</em> <br/>\n\nThere is a patched version fixing this problem in my fork of htcondor git, here is the branch:\n<a class=\"external\" href=\"https://github.com/mambelli/htcondor/tree/v8_2-bosco\">https://github.com/mambelli/htcondor/tree/v8_2-bosco</a>\n\n<p>Changes are in both remote_gahp and bosco_ssh_start\nCheers,\nMarco\n\n</p><p></p><hr/>\n<em>2014-Jul-11 10:47:25 by tannenba:</em> <br/>\n\nThanks for the patch, Marco!  Unfortunately, Parag reports things are still not working quite right when he tested the patch.  Could you please take a look?  The plan is once Parag reports the patch works for him, Jaime will merge the patches into the HTCondor stable release - hopefully on time for HTCondor v8.2.2.\n\n<p></p><hr/>\n<em>2014-Jul-15 10:29:15 by tannenba:</em> <br/>\n\nHi Marco, Parag - any news on this?  We are starting to think about code freezing for v8.2.2 end of this week or early next week, and hope this patch will make it in on time.  Thanks!\n\n<p></p><hr/>\n<em>2014-Jul-16 15:19:27 by jfrey:</em> <br/>\n\nMarco, I've fixed the gridmanager so that the name of the remote gahp binary (batch_gahp or condor_ft-gahp) is the last argument to remote_gahp. That should simplify the code in remote_gahp.\n\n<p></p><hr/>\n<em>2014-Jul-17 00:04:53 by marco:</em> <br/>\n\nWe are using the patch successfully both with condor 8.0.6 and 8.2.1. It would be great if these can be included in 8.2.2.\nThe problems we are having are not connected to these patches.\n\n<p>remote_gahp may require some changes if you change the position of the remote gahp binary.\n\n</p><p>Adding the name of the remote gahp binary at the end can simplify the remote_gahp script, even it it seems to be designed to support parameters for itself (before the host name) and parameters for the remote gahp binary (after the host name).\nSince batch_gahp or condor_ft-gahp seem to take no parameters there should be no problem.\n\n</p><p></p><hr/>\n<em>2014-Jul-18 11:28:01 by marco:</em> <br/>\n\nJaime,\nmy suggestion would be to use the option --rgahp-script REMOTE_CMD (batch_gahp or condor_ft-gahp) and add them right at the beginning as first 2 parameters. This would be unambiguous.\n\n<p>Anyway I just pushed a new version of remote_gahp that works in all cases:\n</p><ol>\n<li>REMOTE_CMD as $2, like in HTCondor &lt;= 8.2.1\n</li><li>REMOTE_CMD at the end like you mentioned in this ticket\n</li><li>REMOTE_CMD after the user@hostname\n</li><li>REMOTE_CMD added using option --rgahp-script REMOTE_CMD\n</li></ol>\n\n<p>Options 1 and 2 are treated in a section marked  WORKAROUND SECTION that is safe to remove in future HTCondor versions if only 3 and 4 happen.\n\n</p><p>Please use this version for the next HTCondor release (committed today):\n<a class=\"external\" href=\"https://github.com/mambelli/htcondor/blob/v8_2-bosco/src/condor_gridmanager/remote_gahp\">https://github.com/mambelli/htcondor/blob/v8_2-bosco/src/condor_gridmanager/remote_gahp</a>\n\n</p><p></p><hr/>\n<em>2014-Jul-18 14:00:21 by jfrey:</em> <br/>\n\nI'd prefer to keep the gridmanager ignorant of how the remote_gahp works.\n\n<p>I'll commit the changes to remote_gahp today.\n\n</p><p></p><hr/>\n<em>2014-Jul-18 14:29:07 by jfrey:</em> <br/>\n\nThe update remote_gahp doesn't work for me if I try to give it any --rgahp-... options. It fails on both mac and linux, usually with a \"Unknown remote command\" error.\n\n<p></p><hr/>\n<em>2014-Jul-18 14:57:15 by marco:</em> <br/>\n\nThere was a bug in the workaround when REMOTE_CMD was the last parameter.\nI fixed it and pushed to git (   18895fb..a973e46  v8_2-bosco -&gt; v8_2-bosco)\n\n<p></p><hr/>\n<em>2014-Jul-18 16:37:59 by jfrey:</em> <br/>\n\nI still can't get the remote_gahp to work when using any --rgahp-... arguments. It keeps trying to use the first --rgahp-... parameter as the REMOTE_CMD. I tried rewriting the argument parsing and now have a version that works with all of the permutations of specifying the REMOTE_CMD. I've attached a copy of remote_gahp with the new argument parsing and the changes for passing arguments to bosco_ssh_start.\n\n<p></p><hr/>\n<em>2014-Aug-05 13:29:12 by adesmet:</em> <br/>\n\n<strong>CODE REVIEW: Pass</strong>\n\n<p>No changes recommended.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/839/remote_gahp\">remote_gahp</a>\n5851 bytes added by jfrey on 2014-Jul-18 21:33:22 UTC.\n<br/>\nremote_gahp with simplified argument parsing<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jul-31 11:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/087db0a66c9db02d485faf938d0a1f1e65258103\">[40807]</a></span>: minor edits to 2 8.2.2 version history items <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4473\" onclick=\"get_ticket_and_populate_wrapper('4473'); return false;\" title=\"condor_ft-gahp doesn't work with older condor_gridmanager\">#4473</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4434\" onclick=\"get_ticket_and_populate_wrapper('4434'); return false;\" title=\"Arguments to remote_gahp aren't handled properly\">#4434</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jul-31 11:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f3c70eb9821cb302c078a79e95eaea9a8a0c8b34\">[40804]</a></span>: Docs for remote_gahp auth parameter handling bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4434\" onclick=\"get_ticket_and_populate_wrapper('4434'); return false;\" title=\"Arguments to remote_gahp aren't handled properly\">#4434</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jul-22 11:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/67319c15af56d3237ae31c9ea03b2db83423b9ed\">[40720]</a></span>: Fix authentication options in remote_gahp and bosco_ssh_start. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4434\" onclick=\"get_ticket_and_populate_wrapper('4434'); return false;\" title=\"Arguments to remote_gahp aren't handled properly\">#4434</a></span> If the user specifies non-default authentication options to the remote_gahp, it needs to pass those along to bosco_ssh_start. Committer: Jaime Frey  (By Marco Mambelli )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jul-22 11:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d334541f99ea7ca9ada845c153433adb00a344e6\">[40719]</a></span>: Simplify argument parsing in remote_gahp. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4434\" onclick=\"get_ticket_and_populate_wrapper('4434'); return false;\" title=\"Arguments to remote_gahp aren't handled properly\">#4434</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jul-16 15:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2a1ff80213d9a4b060f4fb987884ffc3892c1808\">[40687]</a></span>: Fix how arguments are passed to remote_gahp by the gridmanager. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4434\" onclick=\"get_ticket_and_populate_wrapper('4434'); return false;\" title=\"Arguments to remote_gahp aren't handled properly\">#4434</a></span> Now, for grid batch jobs that want to use remote_gahp, the options included in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GridResource\" title=\"Grid Resource\">GridResource</a></span> attribute are placed before the name of the remote gahp binary in the argument list for remote_gahp. These options are meant for remote_gahp,\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Aug-05 13:30", "status": "resolved", "created": "2014-Jul-01 10:21", "fixed_version": "2014-Jul-01 10:21", "broken_version": "v080000", "priority": "1", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "jfrey@cs.wisc.edu,marco@hep.uchicago.edu, burt@fnal.gov, parag@fnal.gov, tannenba@cs.wisc.edu", "due_date": ""}