{"id": 2803, "title": "Ticket #2803: condor_status -state time comparison wrong in face of clock skew", "description": "<blockquote>\ncondor_status -state will provide information about the amount of time a slot has been in its current state. On a machine with clock skew from the collector, this information will be inaccurate. This is because the duration calculation is based off <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LastHeardFrom\" title=\"Last Heard From\">LastHeardFrom</a></span> (Collector's timestamp on the ad), when it should be based off <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyCurrentTime\" title=\"My Current Time\">MyCurrentTime</a></span> (the node's timestamp).\n\n<p></p><div class=\"verbatim\">\n<pre>diff --git a/src/condor_status.V6/prettyPrint.cpp b/src/condor_status.V6/prettyPrint.cpp\nindex 233d724..bc22771 100644\n--- a/src/condor_status.V6/prettyPrint.cpp\n+++ b/src/condor_status.V6/prettyPrint.cpp\n@@ -814,7 +814,7 @@ formatElapsedTime( int t , AttrList *al )\n {\n        int     now;\n\n-       al-&gt;LookupInteger( ATTR_LAST_HEARD_FROM , now );\n+       al-&gt;LookupInteger( ATTR_MY_CURRENT_TIME , now );\n        t = now - t;\n        return format_time( t );\n }\n</pre></div>\n\n\n<p>Originally the code (0a57fab4: Tue Mar 3 21:20:46 1998) compared against condor_status' local time, which was also wrong. It was later updated (8a589453: Tue Mar 10 16:57:20 1998), to compare against <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LastHeardFrom\" title=\"Last Heard From\">LastHeardFrom</a></span>, which does not take skew into account.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2012-Feb-01 12:26", "status": "new", "created": "2012-Feb-01 12:26", "fixed_version": "2012-Feb-01 12:26", "broken_version": "v070600", "priority": "4", "subsystem": "Tools", "assigned_to": "", "derived_from": "", "creator": "matt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}