{"id": 7204, "title": "Ticket #7204: Fix SciTokens build and segfault", "description": "<blockquote>\nThis ticket is a placeholder for semi-urgent fixes for SCITOKENS support as we test the workflows for the HTCondor-CE.\n\n<p>So far, we have found:\n\n</p><p></p><ul>\n<li>Newest version of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span> changed the =const='ness of one header call, causing compilation failures.\n</li><li>The use of audiences in an otherwise-valid token can trigger a segfault.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2019-Aug-13 10:56:18 by bbockelm:</em> <br/>\n\nOther things found in the testing:\n\n<p></p><ul>\n<li><code>scitokens-cpp</code> is sensitive to the <em>lack</em> of a trailing newline.\n</li><li>Some HTCondor dprintf messages in the SSL auth are missing a trailing newline.  (Coincidental, but unrelated to the above!)\n</li></ul>\n\n<p></p><hr/>\n<em>2019-Aug-13 11:41:31 by bbockelm:</em> <br/>\n\nAnother item found in testing:\n\n<p></p><ul>\n<li><code>scitokens-cpp</code> does not appear to have a reasonable timeout when fetching the public keys.  It appeared to timeout eventually - but it should align with the HTCondor timeout.  May require changes on the <code>scitokens-cpp</code> API itself.\n</li><li>If <code>SCITOKENS</code> auth is required for the collector as well (in order to locate the schedd), the <code>alias</code> is not passed in the client, causing the SSL auth to fail.  This will require a condor change.\n</li></ul>\n\n<p></p><hr/>\n<em>2019-Sep-09 13:26:09 by tim:</em> <br/>\n\nNo docs. Don't compile with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span> (yet).\n\n<p></p><hr/>\n<em>2019-Sep-09 15:58:39 by tannenba:</em> <br/>\n\nI think v8.9.3 should compile with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span> support, since I believe OSG wants to start testing the HTCondor CE with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SciTokens\" title=\"Sci Tokens\">SciTokens</a></span>.  Why fork HTCondor between HTCondor.org and OSG over this?\n\n<p>Re docs, if docs aren't already in, please create child ticket to add documentation into the next release so it does not drop in the cracks....  but no need to hold up OSG beta testing of this work for documentation imho....</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-28 10:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1531b5a3f1f2185bc2d22d68195b31089c8ed0c7\">[57736]</a></span>: Fix newline endings. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7204\" onclick=\"get_ticket_and_populate_wrapper('7204'); return false;\" title=\"Fix SciTokens build and segfault\">#7204</a></span> Committer: Tim Theisen  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-28 10:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/af2ba222a941eafb62e558cef60af7f8000f7b7d\">[57735]</a></span>: Fix segfault when using audiences. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7204\" onclick=\"get_ticket_and_populate_wrapper('7204'); return false;\" title=\"Fix SciTokens build and segfault\">#7204</a></span> The audience list must end with a `nullptr`. Committer: Tim Theisen  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-28 10:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fdbb8f07b01bf92a1dac44195538d09a57d5d009\">[57734]</a></span>: Fix function pointer signature for new scitokens-cpp header. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7204\" onclick=\"get_ticket_and_populate_wrapper('7204'); return false;\" title=\"Fix SciTokens build and segfault\">#7204</a></span> Committer: Tim Theisen  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-15 14:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a964737cbdb11197cd442e31c6439c3e978d16a1\">[57675]</a></span>: Fix newline endings. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7204\" onclick=\"get_ticket_and_populate_wrapper('7204'); return false;\" title=\"Fix SciTokens build and segfault\">#7204</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-15 14:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9ffd1ccb3bd6d2ac818dd219c86223a32c5dea2e\">[57674]</a></span>: Fix segfault when using audiences. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7204\" onclick=\"get_ticket_and_populate_wrapper('7204'); return false;\" title=\"Fix SciTokens build and segfault\">#7204</a></span> The audience list must end with a `nullptr`.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-15 14:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/14b6e1086afbe14021c07cdc641f4cf652160eac\">[57673]</a></span>: Fix function pointer signature for new scitokens-cpp header. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7204\" onclick=\"get_ticket_and_populate_wrapper('7204'); return false;\" title=\"Fix SciTokens build and segfault\">#7204</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Oct-03 14:24", "status": "resolved", "created": "2019-Aug-13 09:31", "fixed_version": "2019-Aug-13 09:31", "broken_version": "v080902", "priority": "2", "subsystem": "", "assigned_to": "bbockelm", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelman@morgridge.org; tannenba@cs.wisc.edu", "due_date": ""}