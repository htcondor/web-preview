{"id": 4409, "title": "Ticket #4409: Improve statistics for tracking badput sources", "description": "<blockquote>\nCMS would like to start understanding where our badput comes from.  This has resulted in two requests:\n<ul>\n<li>For SCHEDD_COLLECT_STATS_BY_*, we noticed there isn't a count of running jobs.  We will want to be able to record this per-site in Ganglia so we can normalize failures by the number of running jobs at the site.\n</li><li>We currently record badput; I'd like to additionally see \"exceptional badput\".  That is, the amount of badput caused by ShadowException's.  This way, we can differentiate between users with silly jobs and sites with problems.\n</li></ul>\n\n<p>Thanks!</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Jun-20 16:12:09 by johnkn:</em> <br/>\n\nThere is <code>ShadowsRunning</code> and <code>TotalRunningJobs</code>,  also <code>JobsRunningRuntimes</code> and <code>JobsRunningSizes</code>.\n\n<p>If I remember correctly the reason there isn't a simple <code>JobsRunning</code> counter that works with <code>SCHEDD_COLLECT_STATS_BY_*</code> is that at the point in the code where we calculate <code>TotalJobsRunning</code> we don't have access to a job ad. This might be difficult to fix for the general case of <code>..BY_*</code> but would probably be much easier to fix for some specific cases.  Can I presume that you really only care about <code>..BY_USER</code>?\n\n</p><p></p><hr/>\n<em>2014-Jun-20 20:03:11 by bbockelm:</em> <br/>\n\nHi TJ,\n\n<p>Actually, we calculate these using MATCH_EXP_GLIDEIN_CMSSite.\n\n</p><p>For example, for jobs running at T1_DE_KIT, I see:\n\n</p><p>Cmssite_T1_DE_KIT_JobsRunningRuntimes = \"1, 0, 0, 1, 4, 6, 23, 27, 195, 0, 0, 0, 0, 0, 0\"\n\n</p><p>That somehow includes currently running jobs.  Is it not be possible to have the sum of this histogram?\n\n</p><p>Hm.  I just noticed that the same schedd has:\n\n</p><p><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobsRunningRuntimes\" title=\"Jobs Running Runtimes\">JobsRunningRuntimes</a></span> = \"0, 0, 0, 0, 0, 0, 1, 0, 3, 0, 0, 0, 0, 0, 0\"\n\n</p><p>Is something not getting reset?\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2014-Jun-23 10:48:10 by johnkn:</em> <br/>\n\nIs that a direct query to the schedd? or is that coming from the Collector?\n\n<p></p><hr/>\n<em>2014-Jun-23 14:51:07 by johnkn:</em> <br/>\n\nLooking at the code. It appears that <code>SCHEDD_COLLECT_STATS_BY_*</code> (and <code>..FOR_*</code>) status for histograms are not being reset.   It also appears that we could put an overall <code>JobsRunning</code> count here that at least would agree with the sums in these histograms. It probably would not agree with <code>TotalRunningJobs</code> most of the time because <code>TotalRunningJobs</code> is updated whenever a job starts or stops, while these histograms are  updated periodically when the SCHEDD does it's count_jobs() timer handler.\n\n<p></p><hr/>\n<em>2014-Jun-23 19:51:28 by bbockelm:</em> <br/>\n\nHi TJ,\n\n<p>I think it's OK if it doesn't necessarily agree with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TotalRunningJobs\" title=\"Total Running Jobs\">TotalRunningJobs</a></span>.\n\n</p><p></p><hr/>\n<em>2014-Jul-04 21:13:13 by bbockelm:</em> <br/>\n\nWhat about tracking \"exceptional badput\"?\n\n<p></p><hr/>\n<em>2014-Jul-07 09:32:33 by johnkn:</em> <br/>\n\nnew counter.  <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobsAccumExceptionalBadputTime\" title=\"Jobs Accum Exceptional Badput Time\">JobsAccumExceptionalBadputTime</a></span></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Aug-06 13:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/46fa7f805279bb6b5a6d16b9abc661808f07c7c3\">[40865]</a></span>: added the 8.3.0 bug fix version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4409\" onclick=\"get_ticket_and_populate_wrapper('4409'); return false;\" title=\"Improve statistics for tracking badput sources\">#4409</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Aug-06 13:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8561c65908ac01564ae60780c4e8c17dcfda2707\">[40863]</a></span>: complete documentation and add 8.3.0 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4409\" onclick=\"get_ticket_and_populate_wrapper('4409'); return false;\" title=\"Improve statistics for tracking badput sources\">#4409</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Aug-04 10:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6e739274176c83c84a285c4952fc8b7dc97ba2b6\">[40825]</a></span>: add defn of new schedd <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> attribute <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobsAccumExceptionalBadputTime\" title=\"Jobs Accum Exceptional Badput Time\">JobsAccumExceptionalBadputTime</a></span> in manual <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4409\" onclick=\"get_ticket_and_populate_wrapper('4409'); return false;\" title=\"Improve statistics for tracking badput sources\">#4409</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jun-24 09:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/66fee5d7c05f5a5d83912a4675c1cf093e01217d\">[40492]</a></span>: Improve statistics for tracking running jobs and badput sources <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4409\" onclick=\"get_ticket_and_populate_wrapper('4409'); return false;\" title=\"Improve statistics for tracking badput sources\">#4409</a></span> this commit fixes a bug in schedd statistics subsets (SCHEDD_COLLECT_STATS_BY_* and SCHEDD_COLLECT_STATS_FOR_*) that failed to reset the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobsRunningSizes\" title=\"Jobs Running Sizes\">JobsRunningSizes</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobsRunningRuntimes\" title=\"Jobs Running Runtimes\">JobsRunningRuntimes</a></span> histograms before the count_jobs iteration This commit\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Aug-11 13:30", "status": "resolved", "created": "2014-Jun-20 14:32", "fixed_version": "2014-Jun-20 14:32", "broken_version": "", "priority": "4", "subsystem": "DaemonsSubmitNode", "assigned_to": "johnkn", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "bbockelm@cse.unl.edu", "due_date": ""}