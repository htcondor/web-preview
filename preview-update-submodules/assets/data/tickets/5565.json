{"id": 5565, "title": "Ticket #5565: submit or config self reference using $F() expansion results in hang", "description": "<blockquote>\nIn the submit/config expansion code, self references are detected and expanded at parse time to prevent infinite recursion when expanding at runtime.  So lines like this are detected and expanded at parse time.\n\n<p></p><pre>   ENVIRONMENT = $(ENVIRONMENT) FOO=BAR\n</pre>\n\n<p>But this detection of self reference doesn't recognize the new $F() 'fileparts' expansion added in the 8.4 series.   Since it doesn't statements like this\n\n</p><p></p><pre>   ENVIRONMENT = \" $F(ENVIRONMENT) FOO=BAR \"\n</pre>\n\n<p>end up causing infinite recursion and a hang (and eventually a crash) when the submit/param code is asked to expand ENVIRONMENT.\n\n</p><p>The code that detects self reference should be enhanced to recognize the $F() macro expansions, and possibly other $ function macro expansions as well.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Jun-03 10:29:43 by tim:</em> <br/>\n\n<strong>CODE REVIEW:</strong> In lieu of code review, unit tests verify that the bug is not present. I did a cursory review. Although the code is touched in many places, my impression is that this is a simplification and just suitable for a stable release.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-May-31 11:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b6edfe610eeaba1d4ccaa8ffd7a650a7f3658d21\">[48447]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2720\" onclick=\"get_ticket_and_populate_wrapper('2720'); return false;\" title=\"condor_submit creating files with $$([])\">#2720</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5310\" onclick=\"get_ticket_and_populate_wrapper('5310'); return false;\" title=\"Subsystem-specific config params sometimes ignored\">#5310</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5565\" onclick=\"get_ticket_and_populate_wrapper('5565'); return false;\" title=\"submit or config self reference using $F() expansion results in hang\">#5565</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5656\" onclick=\"get_ticket_and_populate_wrapper('5656'); return false;\" title=\"history_helper doesn't work on Windows\">#5656</a></span>, and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5694\" onclick=\"get_ticket_and_populate_wrapper('5694'); return false;\" title=\"SUBMIT_ATTRS can't set JobLeaseDuration to an expression\">#5694</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-May-03 09:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e7fc3fc79f5389db187421b0b19b6d2f52cc8e49\">[48354]</a></span>: fix macro_expand to properly handle subsys and localname overrides for all $() and $func() expansions. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5565\" onclick=\"get_ticket_and_populate_wrapper('5565'); return false;\" title=\"submit or config self reference using $F() expansion results in hang\">#5565</a></span>  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Jun-03 10:29", "status": "resolved", "created": "2016-Mar-17 09:59", "fixed_version": "2016-Mar-17 09:59", "broken_version": "v080400", "priority": "3", "subsystem": "Libs", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "s8863", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}