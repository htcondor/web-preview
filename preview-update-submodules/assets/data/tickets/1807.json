{"id": 1807, "title": "Ticket #1807: Templated generic configuration file for staging purposes", "description": "<blockquote>\nThe people responsible for packaging want a templated generic configuration file to make replacement of configuration knobs easier.  The current methodology is either applying a patch or doing a search/replace on condor_config.generic.\n\n<p>Unix: With RPMs and DEBs, they are supposed to provide a ready to use configuration file for the program.  Depending on the distro or architecture, there will be variations within the configuration file which cannot be captured in a generic one.  This requires the configuration file to be patched/munged before inclusion in the RPM or DEB.\n\n</p><p>With tarballs, condor_configure creates local configuration files whose values override the defaults in the generic configuration file provided with the tarball.\n\n</p><p>Windows: A Windows configuration file needs to have all the Unix specific configuration knobs changed even before being modified by the installer.\n\n</p><p>Alternative solutions and their problems:\n\n</p><p>Patch: Maintain a separate patch for every platform that needs modification.  This is cumbersome, fragile, duplicates work, and when new developers come in they are generally not aware of these patches and may break all of them by tweaking config knobs.  This has already happened on Windows several times.\n\n</p><p>Local Config Files: Local configuration files are shipped or written by packages to override all of the values that are incorrect for a particular platform.  This is more acceptable on Linux, but on Windows would entail basically duplicating a large portion of the configuration file anyway since the generic configuration file is utterly unsuited for running a Windows Condor install.  In addition, this is confusing to users as suddenly the configuration file they see is a broken one and will cause problems if they try to reuse it or use it as a guideline for administrating Condor.\n\n</p><p>Proposed Solution:  A generic templated configuration file.\n\n</p><p>CMake has a macro substitution system that when given an input file will fill in placeholders in the input file and produce a sane output file.  All of the parameters are stored within a single CMake file instead of being scattered across multiple files or even directories.  The placeholders will be for values of configurations, not the name of the configuration knob.\n\n</p><p>This has an added advantage in the Windows installer, so that it does not have to be aware of the name of a configuration value in order to insert the correct value.  Case in point, when HOST_ALLOW_READ/WRITE/ADMINISTRATOR had the HOST_ prefix dropped in the configuration file, the old installer did not correctly modify ALLOW_READ/WRITE/ADMINISTRATOR and Condor failed to start because of an incorrectly generated configuration file.\n\n</p><p>Current work is on: master-template-config-branch</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Dec-15 09:24:34 by tstclair:</em> <br/>\n\nYou will want to follow the pattern that exists in the rest of condor's cmake system for templated files, to create a condor_config.generic.in\n\n<p>Variables which are variant, should use the @VARIABLE@ syntax similar to what is done in WiX, and config.h.in, then call cmakes replacement facility like:\n\n</p><p>configure_file(${CMAKE_CURRENT_SOURCE_DIR}condor_config.generic.in ${CONDOR_BINARY_DIR}condor_config @ONLY)\n\n</p><p>which can then be directly bundled with the package.\n\n</p><p>If there are variables which require overwrite based on an \"install process\", then simply use the \"installer\" write a couple of variables to the beginning of the file, and configure option set it to another variable, e.g.\n\n</p><p>####### condor_config.generic.in file:\n\n</p><p>RELEASE_DIR = @CONDOR_RELEASE_DIR@\n\n</p><p>######## condor_config file based on template w/installer\n\n</p><p>### Installer variables dropped at top of file.\n\n</p><p>WININSTALL_LOC = C:\\blah blah blah\n\n</p><p>###\n\n</p><p>RELEASE_DIR = $(WININSTALL_LOC)\n</p><hr/>\n<em>2011-Feb-01 16:20:02 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2012-Feb-02 17:19:30 by johnkn:</em> <br/>\n\nI have reviewed the patches and they look reasonable. Also the templated config has been working for several releases now.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Mar-02 13:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4dfacab967e6058c8605136969c20da369bc24f7\">[20878]</a></span>: Uncomment vm config entries and stub them properly. Ticket <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1807\" onclick=\"get_ticket_and_populate_wrapper('1807'); return false;\" title=\"Templated generic configuration file for staging purposes\">#1807</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-24 18:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bc5558f23b31a3848dddbd336265f24906260577\">[20755]</a></span>: Revert \"Fix typo in template config file. Ticket <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1807\" onclick=\"get_ticket_and_populate_wrapper('1807'); return false;\" title=\"Templated generic configuration file for staging purposes\">#1807</a></span>.\" This reverts commit 896186f6e43cea5a0f9fdb679d773465a2abbac8.  (By Thawan Kooburat )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-24 14:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/32f66967e1463d8a3e9e9fb41c95857a1ffb972c\">[20741]</a></span>: Fix HDFS definitions, Java cmake values, and stub VM entries in input template file. Ticket <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1807\" onclick=\"get_ticket_and_populate_wrapper('1807'); return false;\" title=\"Templated generic configuration file for staging purposes\">#1807</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-22 17:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/896186f6e43cea5a0f9fdb679d773465a2abbac8\">[20754]</a></span>: Fix typo in template config file. Ticket <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1807\" onclick=\"get_ticket_and_populate_wrapper('1807'); return false;\" title=\"Templated generic configuration file for staging purposes\">#1807</a></span>.  (By Thawan Kooburat )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-22 17:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9ed7ac0bf3f9ea0c47d5e335f6116a92c83eaa0b\">[20654]</a></span>: Fix character escapes in cmake variable overrides for templated config. Ticket <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1807\" onclick=\"get_ticket_and_populate_wrapper('1807'); return false;\" title=\"Templated generic configuration file for staging purposes\">#1807</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-22 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/200b3a08c1f31f1cdf6ebc2aeac9e681b68e5198\">[20650]</a></span>: Split generation of Windows config file into a generic and a installer template. Ticket <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1807\" onclick=\"get_ticket_and_populate_wrapper('1807'); return false;\" title=\"Templated generic configuration file for staging purposes\">#1807</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-15 14:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fec9ad175ba91b4a70427db55d5bc78cb3652c39\">[20421]</a></span>: Stub more values that need to be written by the MSI installer and replace values that differ between Windows and Linux. Ticket <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1807\" onclick=\"get_ticket_and_populate_wrapper('1807'); return false;\" title=\"Templated generic configuration file for staging purposes\">#1807</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-14 15:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c0e185a8086565e335382aef538c392bb743931b\">[20405]</a></span>: Add in a few placeholder Windows specific values in the input generic config file. Override more variables in CMake file for Windows. Ticket <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1807\" onclick=\"get_ticket_and_populate_wrapper('1807'); return false;\" title=\"Templated generic configuration file for staging purposes\">#1807</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-14 13:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/46eb8e85c1ec4d2af0683ebe0f71cae4184dfba2\">[20399]</a></span>: Add first pass of Windows configuration knob overrides to cmake. Ticket <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1807\" onclick=\"get_ticket_and_populate_wrapper('1807'); return false;\" title=\"Templated generic configuration file for staging purposes\">#1807</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jan-06 17:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3f4dd9269274b712d006e6a60dae3701f1f47662\">[19877]</a></span>: Add templated config file. Ticket <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1807\" onclick=\"get_ticket_and_populate_wrapper('1807'); return false;\" title=\"Templated generic configuration file for staging purposes\">#1807</a></span>.  (By Ziliang Guo )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Aug-04 11:49", "status": "stalled", "created": "2010-Dec-14 16:55", "fixed_version": "2010-Dec-14 16:55", "broken_version": "v070400", "priority": "4", "subsystem": "Packaging", "assigned_to": "ziliang", "derived_from": "", "creator": "ziliang", "rust": "", "customer_group": "other", "visibility": "public", "notify": "ziliang@cs.wisc.edu, kooburat@cs.wisc.edu, tstclair@redhat.com, tannenba@cs.wisc.edu, jfrey@cs.wisc.edu, johnkn@cs.wisc.edu", "due_date": ""}