{"id": 7856, "title": "Ticket #7856: Proxy refresh for Condor-C jobs ignores lifetime job attribute", "description": "<blockquote>\nWhen delegating a GSI proxy, the lifetime of the delegated proxy is controlled by config param DELEGATE_JOB_GSI_CREDENTIALS_LIFETIME and job attribute DelegateJobGSICredentialsLifetime. When a refresh proxy is forwarded for a Condor-C job (grid universe, type <code>condor</code>), the job attribute is ignored when doing the delegation in the c-gahp, but is consulted when the gridmanager calculates the lifetime of the delegated proxy.\n\n<p>This can result in the gridmanager thinking the delegated proxy has a longer lifetime that it actually does. This will delay when a proxy with a shortened lifetime needs to be refreshed, potentially until after the existing proxy expires.\n\n</p><p>CERN encountered this with some of their ATLAS jobs. The proxies have 4-day lifetimes and are refreshed once a day. Config parameter DELEGATE_JOB_GSI_CREDENTIALS_LIFETIME is set to the default of 24 hours. DelegateJobGSICredentialsLifetime is set to 0 in the job ads, indicating that the delegated proxies should have the full lifetime of the source proxy. The jobs are submitted with the full multi-day lifetime for the proxy. After the first refresh, the delegated proxy has a 24-hour lifetime, but the gridmanager thinks it has the full multi-day lifetime. Thus, the delegated proxy expires around the time the gridmanager will refresh it (when the source proxy is refreshed). To make matters worse, the destination schedd has a SYSTEM_PERIODIC_HOLD expression that triggers if the proxy expires.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Oct-14 13:31:14 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This looks good to me.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-19 23:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/275addc6b0b5904bc7702d02b2d3be1efba02408\">[61529]</a></span>: Docs for Condor-C proxy refresh ignoring lifetime attribute fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7856\" onclick=\"get_ticket_and_populate_wrapper('7856'); return false;\" title=\"Proxy refresh for Condor-C jobs ignores lifetime job attribute\">#7856</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-18 11:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ba6b02698bd66b9e3c596f1f4f70de179281a36b\">[61311]</a></span>: Fix printf() format warning. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7856\" onclick=\"get_ticket_and_populate_wrapper('7856'); return false;\" title=\"Proxy refresh for Condor-C jobs ignores lifetime job attribute\">#7856</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-15 11:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9a40cf215256cf3db903b112dbcf0f96803819f6\">[61299]</a></span>: Docs for Condor-C proxy refresh bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7856\" onclick=\"get_ticket_and_populate_wrapper('7856'); return false;\" title=\"Proxy refresh for Condor-C jobs ignores lifetime job attribute\">#7856</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-15 11:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1b958fad154081a0e5e3c58ad91d99d293d2c20c\">[61298]</a></span>: Fix proxy lifetime for Condor-C proxy refresh command. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7856\" onclick=\"get_ticket_and_populate_wrapper('7856'); return false;\" title=\"Proxy refresh for Condor-C jobs ignores lifetime job attribute\">#7856</a></span> Allow the gridmanager to set the lifetime of the proxy delegated for the CONDOR_JOB_REFRESH_PROXY c-gahp command. Without this, the gridmanager and c-gahp can have different ideas of what the lifetime will be (c-gahp doesn't know about DelegateJobGSICredentialsLifetime\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Oct-19 23:03", "status": "resolved", "created": "2020-Sep-14 11:38", "fixed_version": "2020-Sep-14 11:38", "broken_version": "", "priority": "3", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "cern", "visibility": "public", "notify": "", "due_date": ""}