{"id": 6946, "title": "Ticket #6946: DAGMan fails when retrying jobs using late materialization", "description": "<blockquote>\nIn <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6274\" onclick=\"get_ticket_and_populate_wrapper('6274'); return false;\" title=\"DAGMan doesn't work right with late materialization\">#6274</a></span> we added support for late materialization into DAGMan. This works correctly when nodes run successfully on the first try. However if a node fails, and DAGMan attempts to retry it, it produces the following error:\n\n<p>ERROR \"Job status is STATUS_DONE     , not STATUS_READY\"\n\n</p><p>We need to correctly update the status when a late materialization node fails, and make sure that it is able to retry correctly.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Aug-05 14:59:26 by coatsworth:</em> <br/>\n\nThis bug was being caused because the ProcessFactoryRemoveEvent() (aka. <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ProcessClusterRemoveEvent\" title=\"Process Cluster Remove Event\">ProcessClusterRemoveEvent</a></span>) method was always setting node status to STATUS_DONE, regardless of success or failure in the individual procs. I fixed this by handling node restarts at the cluster level, not the individual proc level.\n\n<p></p><hr/>\n<em>2019-Aug-06 12:50:45 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong> change looks good.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-26 15:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/59db0c2d8d1acb4e3aee3362111b7671667e30be\">[57728]</a></span>: Added version history (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6946\" onclick=\"get_ticket_and_populate_wrapper('6946'); return false;\" title=\"DAGMan fails when retrying jobs using late materialization\">#6946</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jul-31 10:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4712f1f5bae8be7238f5aaa2726aff365da9ddc6\">[57531]</a></span>: Take 2: DAGMan now retries failed multi-proc clusters at the cluster level, not the proc level, to fix late materialization bug (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6946\" onclick=\"get_ticket_and_populate_wrapper('6946'); return false;\" title=\"DAGMan fails when retrying jobs using late materialization\">#6946</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jul-30 13:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2fedfb0b612579f66f0e54d73d42adf518b6e229\">[57524]</a></span>: Revert \"DAGMan now retries failed multi-proc clusters at the cluster level, not the proc level, to fix late materialization bug (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6946\" onclick=\"get_ticket_and_populate_wrapper('6946'); return false;\" title=\"DAGMan fails when retrying jobs using late materialization\">#6946</a></span>)\" This reverts commit 1e24539979f53c4b79ee0ccee90a3c24ae699c5e.  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jul-30 12:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1e24539979f53c4b79ee0ccee90a3c24ae699c5e\">[57523]</a></span>: DAGMan now retries failed multi-proc clusters at the cluster level, not the proc level, to fix late materialization bug (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6946\" onclick=\"get_ticket_and_populate_wrapper('6946'); return false;\" title=\"DAGMan fails when retrying jobs using late materialization\">#6946</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Aug-26 15:42", "status": "resolved", "created": "2019-Mar-07 15:08", "fixed_version": "2019-Mar-07 15:08", "broken_version": "v080704", "priority": "2", "subsystem": "Dag", "assigned_to": "coatsworth", "derived_from": "#6274", "creator": "coatsworth", "rust": "", "customer_group": "other", "visibility": "public", "notify": "coatsworth@cs.wisc.edu", "due_date": ""}