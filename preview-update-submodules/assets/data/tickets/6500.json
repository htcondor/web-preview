{"id": 6500, "title": "Ticket #6500: startd should retry deletion of sandbox until it succeeds", "description": "<blockquote>\nWe have reports from the field from users of Windows pools that sometimes the job sandbox on the execute nodes is never cleaned up.  We know that this is possible when some process that is not tracked by HTCondor (antivirus?) is holding files or the sandbox directory itself open.\n\n<p>To mitigate this, the STARTD should remember sandboxes that it failed to delete and retry periodically until it succeeds.\n\n</p><p>The retry should use exponential backoff, trying frequently for the first few minutes and more infrequently as failures mount.\n\n</p><p>At some point in the future, this new cleanup retry mechanism should be expanded to retry cleanup of temporary user accounts and the registry/profile associated with them.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6524\" onclick=\"get_ticket_and_populate_wrapper('6524'); return false;\" title=\"startd may delete a starter object before the starter is reaped.\">#6524</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nstartd may delete a starter object before the starter is reaped.</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Mar-01 14:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a16e23a91143aa6504a6e36c06dd235c49926aee\">[54409]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6500\" onclick=\"get_ticket_and_populate_wrapper('6500'); return false;\" title=\"startd should retry deletion of sandbox until it succeeds\">#6500</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6532\" onclick=\"get_ticket_and_populate_wrapper('6532'); return false;\" title=\"condor_q should not batch jobs by executable\">#6532</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6287\" onclick=\"get_ticket_and_populate_wrapper('6287'); return false;\" title=\"condor_q -l does not sort jobs\">#6287</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6524\" onclick=\"get_ticket_and_populate_wrapper('6524'); return false;\" title=\"startd may delete a starter object before the starter is reaped.\">#6524</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6494\" onclick=\"get_ticket_and_populate_wrapper('6494'); return false;\" title=\"condor_q -tot -global shows no output\">#6494</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Dec-08 10:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/28385c3a6af4d0dd415ac1ab6d4c02db0679d106\">[52952]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6500\" onclick=\"get_ticket_and_populate_wrapper('6500'); return false;\" title=\"startd should retry deletion of sandbox until it succeeds\">#6500</a></span>, startd should retry deletion of the job sandbox until it succeeds. This commit does adds a new timer to the startd that processes a list of directories that it should continue to try and delete. Directories are added to the list when the startd fails to clean them up when it reaps the Starter.\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-Mar-01 14:41", "status": "resolved", "created": "2017-Dec-08 09:31", "fixed_version": "2017-Dec-08 09:31", "broken_version": "", "priority": "3", "subsystem": "", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "support", "visibility": "public", "notify": "", "due_date": ""}