{"id": 7750, "title": "Ticket #7750: Compat ClassAds GetReferences() doesn't handle subscript notation", "description": "<blockquote>\nIn the condor_utils functions GetReferences() and GetExprReferences(), we build two lists of attribute references within a given expression, one for references that resolve within the local ad and one for references that don't resolve. We want simple attribute names that would appear in the scope of the local ad or the scope of a potential match.\n\n<p>To accomplish that, we call classad::ClassAd::GetExternalReferences() and classad::ClassAd::GetInternalReferences() with fullNames=true. This returns a list of full attribute references, including scopes (e.g. <code>TARGET.Foo.Bar</code>). We then call TrimReferenceNames() to pare down the strings to the simple attribute name we want (e.g. <code>Foo</code>).\n\n</p><p>TrimReferenceNames() first trims off any leading scope names that point to the local or target ad (e.g. <code>TARGET</code>, <code>My</code>). It then trims off everything after a dot (including the dot), to ignore references into a nested ad. It does not handle subscript notation, so <code>Foo[0]</code> does not get trimmed to <code>Foo</code>, like it should.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Jul-29 10:06:51 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Fewer lines, fewer bugs, looks good to me!\n\n</p><p></p><hr/>\n<em>2020-Jul-29 10:08:57 by tlmiller:</em> <br/>\n\nA user will probably only see this fix if they use the subscript notation in an argument to <code>condor_status -af</code> (because the project will be wrong and they'll always get undefined), but I don't know if that warrants a release note.\n\n<p></p><hr/>\n<em>2020-Jul-29 11:44:14 by jfrey:</em> <br/>\n\nI was wondering how to word a release note without confusing users. If I do one, I think I'll make it vague, like \"fixed bug in -autoformat when using lists and nested ads\".</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-28 16:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cc787cd30a519694152d2899f79d94fb68e1f3ac\">[61358]</a></span>: Docs for GetReferences() bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7750\" onclick=\"get_ticket_and_populate_wrapper('7750'); return false;\" title=\"Compat ClassAds GetReferences() doesn't handle subscript notation\">#7750</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-28 13:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c2a07757accddaf95ad583c3904a3e379ab737d3\">[60260]</a></span>: Fix GetReferences() for subscript notation. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7750\" onclick=\"get_ticket_and_populate_wrapper('7750'); return false;\" title=\"Compat ClassAds GetReferences() doesn't handle subscript notation\">#7750</a></span> When an external reference refers to an attribute in a nested ad that's inside a list (e.g. B[3].C), GetReferences() returns 'B[3]' instead of 'B'. ClassAd::GetExternalReferences() returns the full attribute reference, as asked for. TrimReferenceNames()\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Sep-28 16:14", "status": "resolved", "created": "2020-Jul-23 15:04", "fixed_version": "2020-Jul-23 15:04", "broken_version": "", "priority": "3", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}