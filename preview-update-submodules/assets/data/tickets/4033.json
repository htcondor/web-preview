{"id": 4033, "title": "Ticket #4033: dollar expansion in config should suport default after colon", "description": "<blockquote>\nthe $$() expansion in submit supports $$(name:default) syntax, where if name is empty or not defined, default is used during expansion.\nThis syntax should also work with the $() expansion in both submit and config files.\n\n<p>In addition, the syntax $(foo:$(bar)) should also be supported, where if foo is empty or not defined, $(bar) is used.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Dec-04 15:40:57 by smoler:</em> <br/>\n\nNotes and examples:\nThis works for both submit and for configuration, but is only useful for configuration.\n\n<p>An example where neither <code>d</code> nor <code>f</code> are defined:\n</p><div class=\"verbatim\">\n<pre>  c = $(d:x)\n  a = b$(f:$(c))\n</pre></div>\n\nresults in\n<div class=\"verbatim\">\n<pre>  a = bx\n</pre></div>\n\n<strong>Don't forget the parenthesis.</strong>\n\n<p><strong>No nesting of defaults within a single line; in other words, one colon per line.</strong>\n\n</p><p>This feature is here to avoid a situation such as\n</p><div class=\"verbatim\">\n<pre>  CAP = $(NUMCPUS) - 1\n</pre></div>\n\nIf <code>NUMCPUS</code> is not defined, then the configuration with the text substitution becomes\n<div class=\"verbatim\">\n<pre>  CAP = -1\n</pre></div>\n\n\n<p></p><hr/>\n<em>2013-Dec-05 14:58:31 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>* When parsing a macro, you allow some characters in the default value that normally aren't allowed in a macro name. Was there any thought put into which extra characters are allowed and which aren't? It seems odd that one of the allowed characters is backslash, but forward slash is not allowed.\n\n</p><p></p><hr/>\n<em>2013-Dec-05 17:49:06 by johnkn:</em> <br/>\n\nISDDCHAR currently allows <strong>a-zA-Z0-9_.:/</strong> so those characters are already permitted inside the default. I added <strong>$ ,\\</strong> so that paths can be defaulted on windows, but I didn't give a lot of thought to other characters that might be desired.  Anthing not on this list can be achieved by using a temp param.\n\n<p></p><pre>     ANYTHING = &lt;anything goes&gt;\n     VALUE = $(MAIN:$(ANYTHING))\n</pre>\n\n<p></p><hr/>\n<em>2013-Dec-06 09:16:08 by jfrey:</em> <br/>\n\nAh, I didn't look at what ISDDCHAR() allowed. That seems like a reasonable set of characters. And as you say, you can get a arbitrary default with a second parameter.\n\n<p>Looks good.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Dec-05 09:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/12f174e28ac7684781e4e46f7d7c907b6e53d4b2\">[38938]</a></span>: add 8.1.3 version history item and document default value specification for macro substitution <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4033\" onclick=\"get_ticket_and_populate_wrapper('4033'); return false;\" title=\"dollar expansion in config should suport default after colon\">#4033</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Nov-06 16:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/49995879dc22e75bed4fdfda7f0a21343c13803e\">[38108]</a></span>: fix typo in previous commit to <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4033\" onclick=\"get_ticket_and_populate_wrapper('4033'); return false;\" title=\"dollar expansion in config should suport default after colon\">#4033</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Nov-04 13:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/26291da064c42eae648ac26abd4a405fca4f69a6\">[38089]</a></span>: add support for :default after param name in $(param) expansion <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4033\" onclick=\"get_ticket_and_populate_wrapper('4033'); return false;\" title=\"dollar expansion in config should suport default after colon\">#4033</a></span> this is similar to the :default support already available in $$ expansion but [classad-expression] is not allowed as a default, while $(other_param) is allowed. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Dec-16 10:34", "status": "resolved", "created": "2013-Nov-01 14:12", "fixed_version": "2013-Nov-01 14:12", "broken_version": "v080000", "priority": "3", "subsystem": "Libs", "assigned_to": "johnkn", "derived_from": "#3820", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "johnkn@cs.wisc.edu; jfrey@cs.wisc.edu", "due_date": ""}