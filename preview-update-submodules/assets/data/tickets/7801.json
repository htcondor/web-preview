{"id": 7801, "title": "Ticket #7801: Run singularity test before singularity job to check singularity works", "description": "<blockquote>\nWhen HTCondor runs a job under singularity the only way to get the exit value from the job inside the container is having it be passed through to the exit value of singularity.  The problem with this is we can't differentiate any problem with singularity from a problem with this job.\n\n<p>To help alleviate this problem, singularity supports a \"test\" command line option, which runs a predefined test inside the executable.  By default this is just exit 0.\n\n</p><p>When condor runs a singularity job we should first run \"singularity test\" to verify that all is well with the container.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Sep-29 10:08:36 by pfc:</em> <br/>\n\nGreg says this should be done in the next few weeks.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Nov-20 10:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0fb31fb5dd42b70f113acade2d725c0e78c549f8\">[61715]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7801\" onclick=\"get_ticket_and_populate_wrapper('7801'); return false;\" title=\"Run singularity test before singularity job to check singularity works\">#7801</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-28 14:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b0985c1b02e3d37ff94f1e3932f5ff7b833fe5c3\">[61571]</a></span>: When running singularity test, don't pass job args to test <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7801\" onclick=\"get_ticket_and_populate_wrapper('7801'); return false;\" title=\"Run singularity test before singularity job to check singularity works\">#7801</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-19 15:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ed619cbb689921880f22cd54da8ee116aaf34802\">[61517]</a></span>: Run singularity test before every singularity job <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7801\" onclick=\"get_ticket_and_populate_wrapper('7801'); return false;\" title=\"Run singularity test before singularity job to check singularity works\">#7801</a></span> If test returns non-zero, put job on hold. Don't run test if SINGULARITY_RUN_TEST_BEFORE_JOB is false (defaults to true)  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Nov-20 11:15", "status": "resolved", "created": "2020-Aug-18 09:47", "fixed_version": "2020-Aug-18 09:47", "broken_version": "v080800", "priority": "2", "subsystem": "", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "", "due_date": ""}