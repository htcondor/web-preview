{"id": 6265, "title": "Ticket #6265: PASSWORD authentication fails sporadically", "description": "<blockquote>\nWhen doing PASSWORD authentication on the server side, it appears to quit halfway through the process of authenticating and just \"declare success\".  It hasn't actually finished, and quits before it establishes a key.  The process then fails when trying to do key exchange (since no key has been created).</blockquote>", "remarks": "<blockquote>\n<em>2017-May-16 17:18:39 by zmiller:</em> <br/>\n\nWith logs from Andrew and a careful inspection of the code, this is exactly what is happening.  If any of the server reads block, the server enters a state machine for the conversation and properly returns control to daemoncore.  However, if none of the reads block in the initial round-trip, the server fails to enter the state machine and finish the authentication process.  Because it depends on the timing of network reads, the fact that this happens only sporadically makes sense.  Patch is very straightforward and will be committed ASAP.\n\n<p></p><hr/>\n<em>2017-May-17 11:43:47 by tannenba:</em> <br/>\n\nSince the non-blocking kerberos authentication code in <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5737\" onclick=\"get_ticket_and_populate_wrapper('5737'); return false;\" title=\"make kerberos authentication non-blocking\">#5737</a></span> was added at about the same time as the non-blocking password authentication code, and they follow the same pattern, I wonder if <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5737\" onclick=\"get_ticket_and_populate_wrapper('5737'); return false;\" title=\"make kerberos authentication non-blocking\">#5737</a></span> suffers from the same bug.\n\n<p></p><hr/>\n<em>2017-May-18 07:31:02 by zmiller:</em> <br/>\n\nI had the same thought.  I checked the Kerberos code and it does not have the same issue.\n\n<p></p><hr/>\n<em>2017-Jun-15 08:47:10 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Looks good, resolving</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-18 19:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7e36516efbc8bc8850a7102f6947574ac4f1c13f\">[50685]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6265\" onclick=\"get_ticket_and_populate_wrapper('6265'); return false;\" title=\"PASSWORD authentication fails sporadically\">#6265</a></span>) Fix Fedora build warnings  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-18 12:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a22efb3a8e2b5279f8c4bb0025fa2662a0eeae56\">[50679]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6265\" onclick=\"get_ticket_and_populate_wrapper('6265'); return false;\" title=\"PASSWORD authentication fails sporadically\">#6265</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-18 11:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b6bf8b776c9f41a2880aa00daa0c6274c9271376\">[50678]</a></span>: Force the PASSWORD authentication method to enter the non-blocking state machine. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6265\" onclick=\"get_ticket_and_populate_wrapper('6265'); return false;\" title=\"PASSWORD authentication fails sporadically\">#6265</a></span>  (By zmiller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Jun-15 08:48", "status": "resolved", "created": "2017-May-16 17:17", "fixed_version": "2017-May-16 17:17", "broken_version": "v080506", "priority": "1", "subsystem": "Security", "assigned_to": "zmiller", "derived_from": "#5602", "creator": "zmiller", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "tannenba@cs.wisc.edu, andrew.lahiff@stfc.ac.uk", "due_date": "20170517"}