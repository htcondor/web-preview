{"id": 5965, "title": "Ticket #5965: Add metaknobs at end of 8.5 series", "description": "<blockquote>\nWe should add some new metaknobs for the end of the 8.5 series.\n\n<p>put Suggestions and/or proposed metaknobs in comments.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Oct-13 13:16:07 by johnkn:</em> <br/>\n\nNow that we have arguments, we can have WANT_HOLD_IF (and PREEMPT_IF) metaknobs with arguments.  They would be used like this...\n<div class=\"snip\">\n<pre class=\"sniplabel\">example of want_hold_if metaknob use</pre>\n<pre class=\"snip\">testing_policy_metaknobs=1\nif $(testing_policy_metaknobs)\n\n   #cribbed from use POLICY : Preempt_If_Cpus_Exceeded, (and simplified - original is better but too long for a good example)\n   CpusUsage = CondorLoadAvg/TotalLoadAvg*$(DETECTED_CORES)\n   STARTD_ATTRS = $(STARTD_ATTRS) CpusUsage\n\n   CPU_EXCEEDED = CpusUsage &gt; Cpus+0.8\n   use POLICY : Want_Hold_If(CPU_EXCEEDED, 102, job used more cpus than it requested)\n\n   MEMORY_EXCEEDED = (MemoryUsage?:0) &gt; RequestMemory\n   use POLICY : Want_Hold_If(MEMORY_EXCEEDED, 103, job used more memory than it requested)\nendif\n</pre></div>\n\nThe metaknob definition is this\n<div class=\"code\">\n<pre class=\"code\">[$POLICY.WANT_HOLD_IF]\ndescription=Configure a conditional WANT_HOLD expression. args:(policy_knob, subcode, reason_text)\ndefault : @end\n  use Policy : WANT_PREEMPT_IF($(0))\n  if defined WANT_HOLD\n    WANT_HOLD = $($(1)) || $(WANT_HOLD)\n  else\n    WANT_HOLD = $($(1))\n  endif\n  WANT_HOLD_REASON = ifThenElse($($(1)), \"$(3+)\", $(WANT_HOLD_REASON:UNDEFINED))\n  WANT_HOLD_SUBCODE = ifThenElse($($(1)), $(2) , $(WANT_HOLD_SUBCODE:UNDEFINED))\n@end\n</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Nov-01 11:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d1d2f2ed3da4e964b06036580421e905ce12f10a\">[49506]</a></span>: fix bug in metaknob arg parsing when both + and : are used. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5965\" onclick=\"get_ticket_and_populate_wrapper('5965'); return false;\" title=\"Add metaknobs at end of 8.5 series\">#5965</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Oct-29 02:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/de3aa445428028bb6452c4a30d0b194dd03df2d0\">[49500]</a></span>: metaknob improvements. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5965\" onclick=\"get_ticket_and_populate_wrapper('5965'); return false;\" title=\"Add metaknobs at end of 8.5 series\">#5965</a></span>. $(LOCALNAME) is now a synonmy for $(SUBSYSTEM) when a local name is not set. some obsolete knobs removed. HOSTNAME, SUBSYSTEM &amp; LOCALNAME added to param table condor_config_val now properly handles metaknobs with arguments.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Oct-17 09:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2060598cb3c4445c20fbf83927bda76e97f10334\">[49442]</a></span>: add metaknobs, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5965\" onclick=\"get_ticket_and_populate_wrapper('5965'); return false;\" title=\"Add metaknobs at end of 8.5 series\">#5965</a></span>. <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=PartitionableSlot\" title=\"Partitionable Slot\">PartitionableSlot</a></span>, Want_hold_if, Preempt_if  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Dec-05 13:52", "status": "resolved", "created": "2016-Oct-13 13:05", "fixed_version": "2016-Oct-13 13:05", "broken_version": "", "priority": "3", "subsystem": "", "assigned_to": "johnkn", "derived_from": "#5975", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}