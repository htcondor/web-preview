{"id": 3108, "title": "Ticket #3108: wrong accounting of idle jobs", "description": "<blockquote>\nThere is some sort of bug (or misconfiguration) in dagman when handling \"SUSPENDING JOB\" event, where it increase idle count when even is received but does not seem to decrease when the job is unsuspended.\n\n<p>Users have seen this for multi-core jobs, the issue may be generic.  As time passes the count of idle jobs accumulates.  The only workaround has been to increase idle count.\n\n</p><p>An example freshly started dagman log:\n\n</p><p></p><div class=\"verbatim\">\n<pre>07/03/12 19:02:34 Note: 10275 total job deferrals because of -MaxIdle limit (20)\n07/03/12 19:04:29 Currently monitoring 1 Condor log file(s)\n07/03/12 19:04:29 Event: ULOG_EXECUTE for Condor Node CC7 (4877266.0.0)\n07/03/12 19:04:30 Number of idle job procs: 8\n07/03/12 19:04:30 Event: ULOG_JOB_SUSPENDED for Condor Node CC12 (4877150.0.0)\n07/03/12 19:04:30 Number of idle job procs: 9\n07/03/12 19:04:30 Event: ULOG_JOB_SUSPENDED for Condor Node CC10 (4877156.0.0)\n07/03/12 19:04:30 Number of idle job procs: 10\n07/03/12 19:04:30 Event: ULOG_JOB_SUSPENDED for Condor Node CC11 (4877151.0.0)\n07/03/12 19:04:30 Number of idle job procs: 11\n07/03/12 19:04:35 Currently monitoring 1 Condor log file(s)\n07/03/12 19:04:35 Event: ULOG_JOB_SUSPENDED for Condor Node CC8 (4877164.0.0)\n07/03/12 19:04:35 Number of idle job procs: 12\n07/03/12 19:04:35 Event: ULOG_JOB_SUSPENDED for Condor Node CC367 (4876711.0.0)\n07/03/12 19:04:35 Number of idle job procs: 13\n07/03/12 19:04:35 Event: ULOG_JOB_SUSPENDED for Condor Node CC368 (4876708.0.0)\n07/03/12 19:04:35 Number of idle job procs: 14\n07/03/12 19:04:35 Event: ULOG_JOB_SUSPENDED for Condor Node CC9 (4877159.0.0)\n07/03/12 19:04:35 Number of idle job procs: 15\n07/03/12 19:04:35 Event: ULOG_JOB_SUSPENDED for Condor Node CC13 (4877142.0.0)\n07/03/12 19:04:35 Number of idle job procs: 16\n07/03/12 19:04:35 Event: ULOG_IMAGE_SIZE for Condor Node CC9 (4877159.0.0)\n07/03/12 19:04:35 Event: ULOG_JOB_SUSPENDED for Condor Node CC389 (4876706.0.0)\n07/03/12 19:04:35 Number of idle job procs: 17\n07/03/12 19:04:35 Event: ULOG_IMAGE_SIZE for Condor Node CC8 (4877164.0.0)\n07/03/12 19:04:35 Event: ULOG_JOB_UNSUSPENDED for Condor Node CC12 (4877150.0.0)\n07/03/12 19:04:35 Event: ULOG_IMAGE_SIZE for Condor Node CC13 (4877142.0.0)\n07/03/12 19:04:35 Event: ULOG_JOB_UNSUSPENDED for Condor Node CC10 (4877156.0.0)\n07/03/12 19:04:35 Event: ULOG_JOB_UNSUSPENDED for Condor Node CC11 (4877151.0.0)\n07/03/12 19:04:41 Currently monitoring 1 Condor log file(s)\n07/03/12 19:04:41 Event: ULOG_EXECUTE for Condor Node CC6 (4877267.0.0)\n07/03/12 19:04:41 Number of idle job procs: 16\n07/03/12 19:04:41 Event: ULOG_EXECUTE for Condor Node CC5 (4877268.0.0)\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Jul-05 11:49:15 by nwp:</em> <br/>\n\nWith new changes from <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2807\" onclick=\"get_ticket_and_populate_wrapper('2807'); return false;\" title=\"Have DAGMan use a single node job user log file\">#2807</a></span>, condor_dagman will be ignoring suspension events in its calculations.  That does not affect this current bug though\n\n<p></p><hr/>\n<em>2012-Jul-05 18:46:02 by nwp:</em> <br/>\n\nI committed a simple change, and am running it through the test suite at <a class=\"external\" href=\"http://submit-2.batlab.org/nmi/results/details?runID=50818\">Batlab run 50818</a>.  If all goes well, I will push it and the change will be in condor version 7.8.2.\n<hr/>\n<em>2012-Aug-23 14:11:38 by zmiller:</em> <br/>\n\nBulk change of target version from v070802 to v070803 using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-16 12:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c831425ef328fa5d88cd3cf488f22defff27606f\">[32794]</a></span>: very minor edit to 7.8.2 version history item ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=3108\" onclick=\"get_ticket_and_populate_wrapper('3108'); return false;\" title=\"wrong accounting of idle jobs\">#3108</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-06 08:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fccbb139cb2e469e01e2cead5723602c1f5521c5\">[32597]</a></span>: Decrement idle count when job is unsuspended <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=3108\" onclick=\"get_ticket_and_populate_wrapper('3108'); return false;\" title=\"wrong accounting of idle jobs\">#3108</a></span> Also, add note about condor_continue in condor_suspend man page.  (By Nathan W. Panike )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Aug-23 14:11", "status": "defer", "created": "2012-Jul-05 10:34", "fixed_version": "2012-Jul-05 10:34", "broken_version": "v070800", "priority": "5", "subsystem": "Dag", "assigned_to": "nwp", "derived_from": "", "creator": "pfc", "rust": "a23691", "customer_group": "ligo", "visibility": "public", "notify": "volodya@mindspring.com, channa@perimeterinstitute.ca, pfcouvar@syr.edu,pcouvare@caltech.edu", "due_date": ""}