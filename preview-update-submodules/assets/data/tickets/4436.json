{"id": 4436, "title": "Ticket #4436: condor_collector start up failure with \"use role: personal\"", "description": "<blockquote>\nI discovered this on ingwe where zach has collector on 9618. Before specifying a non-standard port, my clients could not talk to his collector. I believe when I specified a non standard port my negotiator was not usable. I'll recheck that.</blockquote>", "remarks": "<blockquote>\nwith use role : personal in play, condor_host is 127.0.0.1 and condor_collector is\n127.0.0.1 and this is what master says as coming up:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">Master restart (GRACEFUL) is watching /scratch/bt/outoftree/release_dir/sbin/condor_master (mtime:1404146791)\n07/02/14 11:03:11 Warning: attempting to compare null hostnames in same_host.\n07/02/14 11:03:11 Collector port not defined, will use default: 9618\n07/02/14 11:03:11 Sock::bind failed: errno = 98 Address already in use\n07/02/14 11:03:11 Failed to listen(9618) on TCP/IPv4 command socket. Does this computer have IPv4 support?\n07/02/14 11:03:11 Warning: Failed to create IPv4 command socket.\n07/02/14 11:03:11 ERROR: Create_Process failed trying to start /scratch/bt/outoftree/release_dir/sbin/condor_collector\n07/02/14 11:03:11 restarting /scratch/bt/outoftree/release_dir/sbin/condor_collector in 10 seconds\n</pre></div>\n\n\n<p>When setting without the role to have all daemons, a condor_host as 127.0.0.1\nand collector_host = $condor_host:0 we get the same badness.\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\"> Warning: attempting to compare null hostnames in same_host.\n07/02/14 11:23:39 Collector port not defined, will use default: 9618\n07/02/14 11:23:39 Sock::bind failed: errno = 98 Address already in use\n07/02/14 11:23:39 Failed to listen(9618) on TCP/IPv4 command socket. Does this computer have IPv4 support?\n07/02/14 11:23:39 Warning: Failed to create IPv4 command socket.\n07/02/14 11:23:39 ERROR: Create_Process failed trying to start /scratch/bt/outoftree/release_dir/sbin/condor_collector\n07/02/14 11:23:39 restarting /scratch/bt/outoftree/release_dir/sbin/condor_collector in 10 seconds\n</pre></div>\n\n\n<p>However if the condor_host has a name: CONDOR_HOST = ingwe.cs.wisc.edu\nthe world is happy and all the daemons come up.\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">Master restart (GRACEFUL) is watching /scratch/bt/outoftree/release_dir/sbin/condor_master (mtime:1404146791)\n07/02/14 11:28:19 Started DaemonCore process \"/scratch/bt/outoftree/release_dir/sbin/condor_collector\", pid and pgroup = 10534\n07/02/14 11:28:19 Waiting for /scratch/bt/outoftree/release_dir/local.ingwe/log/.collector_address to appear.\n07/02/14 11:28:20 Found /scratch/bt/outoftree/release_dir/local.ingwe/log/.collector_address.\n</pre></div>\n\n\n<p></p><hr/>\n<em>2014-Jul-08 16:16:43 by adesmet:</em> <br/>\n\n<em>with use role : personal in play, condor_host is 127.0.0.1 and condor_collector is 127.0.0.1</em> - Appears to be a conflict over port 9618; I believe working as expected.\n\n<p><em>When setting without the role to have all daemons, a condor_host as 127.0.0.1 and collector_host = $condor_host:0 we get the same badness.</em> - Despite the request for port 0 (\"grab an arbitrary available port \"), tries for 9618 anyone. Wrong behavior.\n\n</p><p>My own testing (all addresses refer to the machine the configuration was running on.)\n\n</p><p><code>COLLECTOR_HOST=127.0.0.1</code> - Works as expected on port 9618.\n\n</p><p><code>COLLECTOR_HOST=puffin.cs.wisc.edu:0</code> - Works as expected on arbitrary port.\n\n</p><p><code>COLLECTOR_HOST=128.105.14.138:0</code> - Works as expected on arbitrary port.\n\n</p><p><code>COLLECTOR_HOST=127.0.0.1:0</code> - Erroneously tries to use port 9618\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">Warning: attempting to compare null hostnames in same_host.\nCollector port not defined, will use default: 9618\n</pre></div>\n\n\n<p><code>COLLECTOR_HOST=localhost:0</code> - Erroneously tries to use port 9618\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">Collector port not defined, will use default: 9618\n</pre></div>\n\n\n<p></p><hr/>\n<em>2014-Jul-08 16:59:35 by adesmet:</em> <br/>\n\nClosing this ticket. The two issues I believe this identifies have their own tickets:\n\n<p></p><ul>\n<li><span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=4451\" onclick=\"get_ticket_and_populate_wrapper('4451'); return false;\" title=\"compare null hostnames in same_host COLLECTOR_HOST 127.0.0.1\">#4451</a></span>: compare null hostnames in same_host COLLECTOR_HOST 127.0.0.1\n</li><li><span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4452\" onclick=\"get_ticket_and_populate_wrapper('4452'); return false;\" title=\"Collector port not defined, will use default: 9618 localhost 127.0.0.1\">#4452</a></span>: Collector port not defined, will use default: 9618 localhost 127.0.0.1</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "incident", "last_change": "2014-Aug-05 10:07", "status": "resolved", "created": "2014-Jul-02 11:17", "fixed_version": "2014-Jul-02 11:17", "broken_version": "v080002", "priority": "4", "subsystem": "Daemons", "assigned_to": "adesmet", "derived_from": "", "creator": "bt", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "bt@cs.wisc.edu", "due_date": ""}