{"id": 3291, "title": "Ticket #3291: Enable syslog output for dprintf", "description": "<blockquote>\nIt's been a long-standing request to have improved support for improving the integration between Condor and syslog.\n\n<p>Based on the new refactoring of dprintf code, it's possible to have multiple output targets - an opportunity for adding a syslog output.\n\n</p><p>In fact, the implementation is fairly trivial and this is implemented in <a class=\"external\" href=\"https://github.com/bbockelm/condor.git\">https://github.com/bbockelm/condor.git</a>, branch dprintf_syslog.\n\n</p><p></p><ul>\n<li>When the word \"SYSLOG\" is the target (for example: SCHEDD_LOG = SYSLOG), syslog integration is enabled.\n</li><li>Any output which would have been printed by condor logging is sent to syslog level INFO and facility DAEMON.\n</li><li>Control of the output contents is handled by the \"typical\" condor methods.\n</li></ul>\n\n<p>For example, from my /var/log/messages:\n\n</p><p></p><div class=\"verbatim\">\n<pre>Oct 24 20:46:07 rcf-bockelman condor_schedd[23308]: ******************************************************\nOct 24 20:46:07 rcf-bockelman condor_schedd[23308]: ** condor_schedd (CONDOR_SCHEDD) STARTING UP\nOct 24 20:46:07 rcf-bockelman condor_schedd[23308]: ** /home/bbockelm/projects/condor/src/condor_schedd.V6/condor_schedd\nOct 24 20:46:07 rcf-bockelman condor_schedd[23308]: ** SubsystemInfo: name=SCHEDD type=SCHEDD(5) class=DAEMON(1)\nOct 24 20:46:07 rcf-bockelman condor_schedd[23308]: ** Configuration: subsystem:SCHEDD local:&lt;NONE&gt; class:DAEMON\nOct 24 20:46:07 rcf-bockelman condor_schedd[23308]: ** $CondorVersion: 7.9.2 Oct 24 2012 PRE-RELEASE-UWCS $\nOct 24 20:46:07 rcf-bockelman condor_schedd[23308]: ** $CondorPlatform: X86_64-Fedora_17 $\nOct 24 20:46:07 rcf-bockelman condor_schedd[23308]: ** PID = 23308\nOct 24 20:46:07 rcf-bockelman condor_schedd[23308]: ** Log last touched time unavailable (Success)\nOct 24 20:46:07 rcf-bockelman condor_schedd[23308]: ******************************************************\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Oct-25 11:33:45 by johnkn:</em> <br/>\n\nThe implementation at  <a class=\"external\" href=\"https://github.com/bbockelm/condor.git\">https://github.com/bbockelm/condor.git</a>, branch dprintf_syslog looks like a good first cut for linux.\n\n<p>I'm not convinced if it's ok to make it impossible to write to a file called SYSLOG, but we may be changing the param mechanism to allow different log levels for different outputs.\n\n</p><p></p><hr/>\n<em>2012-Oct-30 20:16:08 by bbockelm:</em> <br/>\n\nHi TJ,\n\n<p>I just pushed a few changes that should prevent compilation on Windows.  However, I have no Windows box available to me - can you test it?\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2012-Nov-12 16:34:20 by johnkn:</em> <br/>\n\nTodd has some concerns about the consequences of turning on syslog output.\nIn particular:\n\n<p></p><ul>\n<li>can it ever block?\n</li><li>how are errors handled, does failure to log abort the daemon?\n</li><li>how does syslog respond to a full disk?\n</li></ul>\n\n<p>Please ammend the ticket description to respond to these questions.  -tj\n\n</p><p></p><hr/>\n<em>2012-Nov-12 17:59:03 by bbockelm:</em> <br/>\n\nHi John,\n\n<p>To answer your questions:\n</p><ul>\n<li>syslog works by writing to the /dev/log as a SOCK_DGRAM.  If the kernel buffer for the log fills up, then the sendto() call will block.\n</li><li>Errors are to log do not abort the daemon.\n</li><li>The behavior when the filesystem fills is implementation- and configuration-dependent.\n</li></ul>\n\n<p>Brian\n</p><hr/>\n<em>2012-Dec-11 16:40:19 by johnkn:</em> <br/>\n\nBulk change of target version from v070902 to v070903 using ./ticket-target-mover.\n<hr/>\n<em>2013-Jan-22 10:54:51 by johnkn:</em> <br/>\n\nBulk change of target version from v070903 to v070904 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2013-Jan-28 15:36:03 by bbockelm:</em> <br/>\n\nHi TJ,\n\n<p>Is there anything I can do to help move this forward?  From the ticket history, I'm not 100% sure what the next step forward is.\n\n</p><p>Brian\n</p><hr/>\n<em>2013-Mar-05 10:58:27 by johnkn:</em> <br/>\n\nBulk change of target version from v070904 to v070905 using ./ticket-target-mover.\n<hr/>\n<em>2013-Apr-22 11:10:10 by johnkn:</em> <br/>\n\nBulk change of target version from v070905 to v070906 using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Oct-31 13:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4f865dad1b983ecdadcb4d85ed3ad3e031055467\">[33949]</a></span>: Merged <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cf86dbaf75f4c81e406036b6695c717cf4fd1331\">[33946]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5b17f58b41722735bf1a7da34c728bfe3114479b\">[33947]</a></span>, <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d082fcc410b3729241dbe82912f526d51a96a2f5\">[33948]</a></span>, Merge remote-tracking branch 'github/dprintf_syslog' Provide an optional syslog target for dprintf. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3291\" onclick=\"get_ticket_and_populate_wrapper('3291'); return false;\" title=\"Enable syslog output for dprintf\">#3291</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Oct-30 18:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d082fcc410b3729241dbe82912f526d51a96a2f5\">[33948]</a></span>: Prevent dprintf_syslog from compiling on Windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3291\" onclick=\"get_ticket_and_populate_wrapper('3291'); return false;\" title=\"Enable syslog output for dprintf\">#3291</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Oct-24 20:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cf86dbaf75f4c81e406036b6695c717cf4fd1331\">[33946]</a></span>: First attempt at syslog code for dprintf. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3291\" onclick=\"get_ticket_and_populate_wrapper('3291'); return false;\" title=\"Enable syslog output for dprintf\">#3291</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Jul-28 13:10", "status": "resolved", "created": "2012-Oct-24 20:55", "fixed_version": "2012-Oct-24 20:55", "broken_version": "v070900", "priority": "3", "subsystem": "Daemons", "assigned_to": "johnkn", "derived_from": "#2933", "creator": "bbockelm", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "bbockelm@cse.unl.edu tstclair@redhat.com", "due_date": ""}