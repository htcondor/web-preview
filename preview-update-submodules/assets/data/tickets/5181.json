{"id": 5181, "title": "Ticket #5181: JobRouter thinks Condor-CE job is sandbox when it adopts orphan", "description": "<blockquote>\nIt appears that, when adopting orphan jobs (i.e., reconnecting to jobs after the process is restarted), the job router will assume jobs with SUBMIT_Iwd are sandboxed.\n\n<p>However, this doesn't appear to be a safe assumption.  I don't understand all the remapping rules, but it seems this is very common for remotely-submitted vanilla jobs (i.e., how HTCondor-CE works).\n\n</p><p>A better approach would be to add a \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=IsSandboxed\" title=\"Is Sandboxed\">IsSandboxed</a></span>\" attribute to the routed job and look for that when reconnecting.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Jul-29 08:51:06 by bbockelm:</em> <br/>\n\nTo test:\n<ul>\n<li>Submit a job remotely to a HTCondor-CE.\n</li><li>Wait for the job to be routed.\n</li><li>SIGTERM the job router process.\n</li><li>Wait for the job to be re-adopted by the job router and run to completion.\n</li></ul>\n\n<p>Without this patch, the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> will attempt to transfer a sandbox after completion and error out.  With this patch, the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> will cleanup \"normally\".\n\n</p><p>The title of the ticket currently refers to PBS, but it seems to bite all HTCondor-CE instances.  Will update accordingly.\n\n</p><p></p><hr/>\n<em>2015-Aug-03 13:53:29 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This fix looks good.\n\n</p><p></p><hr/>\n<em>2015-Aug-20 11:50:55 by jfrey:</em> <br/>\n\nThere is a workaround for this bug for people running older versions. They can add this line to all of their Job Router routes:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">Delete_SUBMIT_Iwd = true;\n</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-13 12:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8c5fd46400052a71c48106df3dad22c4fd725991\">[45608]</a></span>: add 8.2.9 version history item for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5181\" onclick=\"get_ticket_and_populate_wrapper('5181'); return false;\" title=\"JobRouter thinks Condor-CE job is sandbox when it adopts orphan\">#5181</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-03 15:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f8de152b3a61c9a8c428eb39950acb64a71ab21f\">[45456]</a></span>: Unconditionally remove SUBMIT_Iwd from routed job. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5181\" onclick=\"get_ticket_and_populate_wrapper('5181'); return false;\" title=\"JobRouter thinks Condor-CE job is sandbox when it adopts orphan\">#5181</a></span> The job router users the presence of SUBMIT_Iwd to detect sandboxed jobs when reconnecting to jobs post-restart.\u00a0[...]\n (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-29 08:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b6bf702137110a35ae95bcacf333fd1b25670b39\">[45430]</a></span>: Unconditionally remove SUBMIT_Iwd from routed job. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5181\" onclick=\"get_ticket_and_populate_wrapper('5181'); return false;\" title=\"JobRouter thinks Condor-CE job is sandbox when it adopts orphan\">#5181</a></span> The job router users the presence of SUBMIT_Iwd to detect sandboxed jobs when reconnecting to jobs post-restart.\u00a0[...]\n (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Aug-20 11:50", "status": "resolved", "created": "2015-Jul-28 21:37", "fixed_version": "2015-Jul-28 21:37", "broken_version": "", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "tim", "derived_from": "#4555", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu", "due_date": ""}