{"id": 1863, "title": "Ticket #1863: tar.gz problems in CMake/CPack", "description": "<blockquote>\nProblems with the new tar.gz packages created by CMake/CPack:\n\n<p></p><ol>\n<li>Fixed. <div class=\"strike\">\n<strike>Files are not owned by root.root (or local 0.0 equivalent)</strike></div>\n\n</li><li>Abandoned. Questionable benefit, AIX complications. <div class=\"strike\">\n<strike>Tar may not be using a large --blocking-factor, which has been shown to double packaging speed.  (Not known if this is a problem, as CPack uses an internal tar implementation.)</strike></div>\n\n</li><li>Fixed. <div class=\"strike\">\n<strike>The resulting tar is missing directory entries, causing warnings on some systems when untarring.  It may also lead to the directories not having the correct ownership. (Unconfirmed)</strike></div>\n\n</li><li>Fixed. <div class=\"strike\">\n<strike>Hard links aren't being used for the condor_tool binaries (vacate, vacate_job, release, reschedule, rm, checkpoint).</strike></div>\n\n</li><li>Verified, works fine. <div class=\"strike\">\n<strike>Needs investigation: Mac builds aren't using the \"-S -x\" options to strip. Our old build system claims, \"Hack: /usr/bin/strip on Mac OS 10.5 causes the condor_master to die inside the plugin initialization code. A message thread in the Boost mailing list suggests that running strip without -g or its equivalent removes more than just debugging symbols, possibly causing RTTI lookups to fail. The appropriate flags on Mac OS are '-S -x'.\"  MacOSX is passing tests, but this needs investigation.</strike></div>\n\n</li><li>Verified, works as intended: <div class=\"strike\">\n<strike>Confirm that you can take a core from a stripped binary and usefully use the matching unstripped with gdb.  If not, we may need to go back to shipping debug files (\"/usr/bin/objcopy --only-keep-debug A.exe A.dbg &amp;&amp; /usr/bin/objcopy --strip-unneeded A.exe &amp;&amp; /usr/bin/objcopy --add-gnu-debuglink=A.dbg A.exe\")</strike></div>\n\n</li><li>Could not reproduce. <div class=\"strike\">\n<strike>Is current solution of copying leaving bad file permissions?  Initial investigation can't reproduce; 7.5.5 is fine, nightly master builds are fine, a local workspace build are fine. Pinging psilord for more info.</strike></div>\n\n</li></ol>\n\n<p>Solved:\n</p><ul>\n<li><span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8d444bfb1cae2203b93db2b6eee867ef5ae4121a\">[19925]</a></span> 7.5.5 1, 2, 3 above.\n</li><li><span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/714013bebb89fd59f3dd9b2fe5d639af590b62d7\">[20059]</a></span> 7.5.5 The stripped binaries aren't stripped.\n</li></ul>\n\n<p>Remaining problems:\n\n</p><p></p><ul>\n<li>One of the AIX platforms can't untar the tarball. Does native AIX tar dislike the --blocking-factor?\n</li></ul>\n\n<p>To do later: (These should become new tickets if necessary when this is closed)\n\n</p><p></p><ul>\n<li>Re-add --blocking-factor.  Will require investigating AIX untar problems.  May need to not use the option on AIX. Moved to <span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=2124\" onclick=\"get_ticket_and_populate_wrapper('2124'); return false;\" title=\"Re-add --blocking-factor to tarball creation code?\">#2124</a></span></li></ul>\n</blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2011-Jan-27 14:50:47 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 16:20:02 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2011-Mar-30 15:24:43 by tstclair:</em> <br/>\n\nthis can likely be closed out now.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jan-25 17:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2bf642f8353cd0bde893ea014bc1a634e195e03b\">[20140]</a></span>: Report selected strip. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1863\" onclick=\"get_ticket_and_populate_wrapper('1863'); return false;\" title=\"tar.gz problems in CMake/CPack\">#1863</a></span>  (By Alan De Smet )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jan-25 15:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cbf9519a0b222fb5a42a020e8e37636f8e5860a0\">[20138]</a></span>: Restore -DCONDOR_PACKAGE_BUILD argument to cmake, it's necessary to get the output filename correct, otherwise both stripped and unstripped tarballs end up calling themselves stripped, and the stripped one never gets built (since the unstripped, misnamed one seems to fulfill the dependency). <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1863\" onclick=\"get_ticket_and_populate_wrapper('1863'); return false;\" title=\"tar.gz problems in CMake/CPack\">#1863</a></span>  (By Alan De Smet )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jan-25 09:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/407f83d41d7e1c3a3478b3fbc80483a94998eefe\">[20136]</a></span>: Revert \"Make hard links for several identical binaries instead of copies. This fixes a regression caused by the move to CMake <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1863\" onclick=\"get_ticket_and_populate_wrapper('1863'); return false;\" title=\"tar.gz problems in CMake/CPack\">#1863</a></span>\" This reverts commit cf1ca34ecc1f095e296c1409ce82d63170378dd7.  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jan-24 17:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cf1ca34ecc1f095e296c1409ce82d63170378dd7\">[20135]</a></span>: Make hard links for several identical binaries instead of copies. This fixes a regression caused by the move to CMake <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1863\" onclick=\"get_ticket_and_populate_wrapper('1863'); return false;\" title=\"tar.gz problems in CMake/CPack\">#1863</a></span>  (By Alan De Smet )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jan-20 16:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/714013bebb89fd59f3dd9b2fe5d639af590b62d7\">[20059]</a></span>: - Build unstripped tar.gz files with the same logic. The original bugs from <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1863\" onclick=\"get_ticket_and_populate_wrapper('1863'); return false;\" title=\"tar.gz problems in CMake/CPack\">#1863</a></span> were still present, this fixed it. - The stripped tarballs should now be stripped. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1863\" onclick=\"get_ticket_and_populate_wrapper('1863'); return false;\" title=\"tar.gz problems in CMake/CPack\">#1863</a></span>.  (By Alan De Smet )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jan-20 16:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/faad234810abe5f2cc2df3753642e604c1afb794\">[20058]</a></span>: Remove --blocking-factor from tar. May be causing problems on AIX. Worth future investigation, but not now. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1863\" onclick=\"get_ticket_and_populate_wrapper('1863'); return false;\" title=\"tar.gz problems in CMake/CPack\">#1863</a></span>  (By Alan De Smet )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Nov-21 15:55", "status": "resolved", "created": "2011-Jan-20 12:01", "fixed_version": "2011-Jan-20 12:01", "broken_version": "v070505", "priority": "2", "subsystem": "Packaging", "assigned_to": "adesmet", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": "20110412"}