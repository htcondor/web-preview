{"id": 353, "title": "Ticket #353: Fix streaming of input, output, etc. on Windows", "description": "<blockquote>\nOn Windows, when streaming input, output, etc. are requested in the submit file, the starter would crash upon launching the job's executable.\n\n<p>It turns out that we were closing fds that did not exist, when we should have been using the fd value as an index into the list of windows pipe handles.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Mar-27 13:06:36 by tannenba:</em> <br/>\n\nIs <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b1b2cc47fa8f132981aafac093472a3f02b71491\">[14292]</a></span> safe on Unix, or should there be an <code>#ifndef WIN32</code> in <code>condor_close()</code>?  On Unix, what does daemonCore-&gt;Close_Pipe() do differently than just a close?\n\n<p></p><hr/>\n<em>2009-Mar-27 13:49:23 by burnett:</em> <br/>\n\nIt appears that streaming I/O does not function on Windows. An account from NMI puts the first occurrence of the service not functioning at version 6.7.18, but it may have not worked for much longer than this, as the comment that mentioned it was only put in place after the first time NMI started testing streaming I/O on Windows.\n\n<p></p><hr/>\n<em>2009-Mar-27 14:04:16 by burnett:</em> <br/>\n\nI'm not sure if an <code>#ifdef</code> will make inherently \"safer\", but it seems, to me, that the logic for creating fds should all go through <code>DaemonCore</code>, so that we don't run into these cases where it is clear that <code>close()</code> is not system agnostic.\n\n<p></p><hr/>\n<em>2009-Mar-28 08:48:44 by gthain:</em> <br/>\n\nThis commit caused all kinds of test breakage, so I reverted it on the trunk.\n\n<p></p><hr/>\n<em>2009-Mar-30 14:08:05 by tannenba:</em> <br/>\n\nBen, any theories about all the breakage, and/or thoughts about what to do now? (obviously this ticket is not resolved, so re-opening it)\n\n<p></p><hr/>\n<em>2009-Mar-30 16:09:56 by burnett:</em> <br/>\n\nThat is really strange; I'll take a closer look at it in the morning.  It appeared that <code>daemonCore-&gt;*_Pipe()</code> family were doing the correct thing, from the looks of the <code>#ifdef</code> 'ery; perhaps, however, it doesn't work at all, or there are some special cases that it does not account for.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Mar-31 13:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c11974fceca428c1478bcd251830d01f70f34f78\">[14344]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=353\" onclick=\"get_ticket_and_populate_wrapper('353'); return false;\" title=\"Fix streaming of input, output, etc. on Windows\">#353</a></span>: Added <code>DaemonCore::Close_FD()</code> which will call the proper close mechanism for a given pipe or file fd.  (By Ben Burnett )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Mar-28 21:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/03034816357daf96de4ff5acc7fdbd5f29e9d9d2\">[14312]</a></span>: Revert \"Revert \"Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=353\" onclick=\"get_ticket_and_populate_wrapper('353'); return false;\" title=\"Fix streaming of input, output, etc. on Windows\">#353</a></span>: Changed all <code>condor_close()</code> calls to\"\" This reverts commit af778634d1ebd9a4c7b119cbb71ed0b6c6f1d675.  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Mar-28 21:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b9984f7e65dff7eb627cbcf426b6379a7fa080bc\">[14311]</a></span>: Revert \"Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=353\" onclick=\"get_ticket_and_populate_wrapper('353'); return false;\" title=\"Fix streaming of input, output, etc. on Windows\">#353</a></span>: Added condor_close() which will call the proper close mechanism,\" This reverts commit b1b2cc47fa8f132981aafac093472a3f02b71491.  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Mar-28 21:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9c7701c344ecb6c9cda768f8bdbb343ecdad715f\">[14308]</a></span>: Revert \"Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=353\" onclick=\"get_ticket_and_populate_wrapper('353'); return false;\" title=\"Fix streaming of input, output, etc. on Windows\">#353</a></span>: Forgot to update *nix imake file.\" This reverts commit 4a10a67b8e7bed18cd2370a7f739e5432d9a2290.  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Mar-28 21:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/24af1d7dd247a89fa27ffe160ab205fb1369d216\">[14307]</a></span>: Revert \"Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=353\" onclick=\"get_ticket_and_populate_wrapper('353'); return false;\" title=\"Fix streaming of input, output, etc. on Windows\">#353</a></span>: Changed all <code>condor_close()</code> calls to\" This reverts commit 636229b91c9a51782e0dfd367011705e2cf79750.  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Mar-27 20:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/af778634d1ebd9a4c7b119cbb71ed0b6c6f1d675\">[14302]</a></span>: Revert \"Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=353\" onclick=\"get_ticket_and_populate_wrapper('353'); return false;\" title=\"Fix streaming of input, output, etc. on Windows\">#353</a></span>: Changed all <code>condor_close()</code> calls to\" This reverts commit 636229b91c9a51782e0dfd367011705e2cf79750. Conflicts: src/condor_c++_util/Imakefile  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Mar-27 16:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/636229b91c9a51782e0dfd367011705e2cf79750\">[14299]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=353\" onclick=\"get_ticket_and_populate_wrapper('353'); return false;\" title=\"Fix streaming of input, output, etc. on Windows\">#353</a></span>: Changed all <code>condor_close()</code> calls to <code>daemonCore-&gt;Close_Pipe()</code> calls, since it does \"the right thing\".  (By Ben Burnett )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Mar-27 13:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4a10a67b8e7bed18cd2370a7f739e5432d9a2290\">[14297]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=353\" onclick=\"get_ticket_and_populate_wrapper('353'); return false;\" title=\"Fix streaming of input, output, etc. on Windows\">#353</a></span>: Forgot to update *nix imake file.  (By Ben Burnett )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Mar-27 11:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b1b2cc47fa8f132981aafac093472a3f02b71491\">[14292]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=353\" onclick=\"get_ticket_and_populate_wrapper('353'); return false;\" title=\"Fix streaming of input, output, etc. on Windows\">#353</a></span>: Added condor_close() which will call the proper close mechanism, be that a call to close() or daemonCore-&gt;Close_Pipe().  (By Ben Burnett )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-31 13:40", "status": "resolved", "created": "2009-Mar-27 11:05", "fixed_version": "2009-Mar-27 11:05", "broken_version": "v070201", "priority": "2", "subsystem": "Win32", "assigned_to": "burnett", "derived_from": "#342", "creator": "burnett", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}