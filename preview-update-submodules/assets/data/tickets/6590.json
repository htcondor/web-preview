{"id": 6590, "title": "Ticket #6590: condor_submit -i doesn't set Cpu usage with cgroups enabled.", "description": "<blockquote>\ncondor_submit -i doesn't set <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RemoteUserCpu\" title=\"Remote User Cpu\">RemoteUserCpu</a></span> and related attributes in the job ad when cgroups is enabled.</blockquote>", "remarks": "<blockquote>\n<em>2018-Mar-06 10:18:55 by gthain:</em> <br/>\n\nNote that this has been cherry-picked back to 8.6\n\n<p></p><hr/>\n<em>2018-Mar-08 09:00:31 by gthain:</em> <br/>\n\nThe condor_starter periodically polls the system for resource usage, including user cpu, system cpu, memory and disk usage.  With condor_submit -i, and with condor_ssh_to_job, which condor_submit -i is built on top of, there are effectively two jobs the starter is managing:  the job proper described in the submit file, and the interactive ssh work.\n\n<p>The sshproc is managed by a class named SSHDProc.  Previously, the SSHDProc didn't update the shadow with the resource usage of the processes under the sshd.\n\n</p><p></p><hr/>\n<em>2018-May-07 13:21:54 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p></p><ol>\n<li>Code Comments, ticket update.  Would be nice to have a comment explaining we only want to update usage attributes during an interactive job so we don't \"pollute\" the attributes of a batch job.\n\n<p></p></li><li>Introduces variable \"uses_cgroups\", which is set in multiple places but never accessed.  Seems like you could just revert <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/88d252d718a5b027a84fffd640d90778305b8540\">[54402]</a></span> and <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/03d95b70dc96e86d9d2e3b7a64e6c2d4d4392fb7\">[5443]</a></span>, as it appears these commits do not accomplish anything.\n\n<p></p></li><li>Needs documentation.</li></ol>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-11 14:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/eb4e2feaee46e464cea7882ec613c52c0c104c0a\">[54925]</a></span>: Remove errant history entry for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6590\" onclick=\"get_ticket_and_populate_wrapper('6590'); return false;\" title=\"condor_submit -i doesn't set Cpu usage with cgroups enabled.\">#6590</a></span>  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-10 06:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/78cbfc3c34db4d0ecf3a42d4d668279f2b0cde03\">[54901]</a></span>: submit -i jobs get cpu/memory accounting, not condor_ssh_to_job <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6590\" onclick=\"get_ticket_and_populate_wrapper('6590'); return false;\" title=\"condor_submit -i doesn't set Cpu usage with cgroups enabled.\">#6590</a></span> Committer: Tim Theisen  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-07 14:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6b9d33442268bf813400d9be623a811fbf8c2824\">[54872]</a></span>: Remove dead code <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6590\" onclick=\"get_ticket_and_populate_wrapper('6590'); return false;\" title=\"condor_submit -i doesn't set Cpu usage with cgroups enabled.\">#6590</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-07 13:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cf69453a9206e6e92b6bf07a4c6f5a627037bb78\">[54871]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6590\" onclick=\"get_ticket_and_populate_wrapper('6590'); return false;\" title=\"condor_submit -i doesn't set Cpu usage with cgroups enabled.\">#6590</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-03 10:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d7d203a32037de0d43f129c19eab970a944d4e39\">[54823]</a></span>: submit -i jobs get cpu/memory accounting, not condor_ssh_to_job <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6590\" onclick=\"get_ticket_and_populate_wrapper('6590'); return false;\" title=\"condor_submit -i doesn't set Cpu usage with cgroups enabled.\">#6590</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Mar-06 10:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e296ad22abe1eb67a23e0c7da066b63842a5108a\">[54443]</a></span>: Allow condor_submit -i to correctly do cpu accounting with cgroups on <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6590\" onclick=\"get_ticket_and_populate_wrapper('6590'); return false;\" title=\"condor_submit -i doesn't set Cpu usage with cgroups enabled.\">#6590</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Mar-01 10:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/88d252d718a5b027a84fffd640d90778305b8540\">[54402]</a></span>: Allow condor_submit -i to correctly do cpu accounting with cgroups on <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6590\" onclick=\"get_ticket_and_populate_wrapper('6590'); return false;\" title=\"condor_submit -i doesn't set Cpu usage with cgroups enabled.\">#6590</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-May-09 13:42", "status": "resolved", "created": "2018-Mar-01 10:16", "fixed_version": "2018-Mar-01 10:16", "broken_version": "v080600", "priority": "2", "subsystem": "DaemonsExecNode", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "support", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}