{"id": 4557, "title": "Ticket #4557: HTCondor-C should gracefully handle authentication issues", "description": "<blockquote>\nWhen a HTCondor-C submitter receives an authentication denied, the GAHP does not translate this appropriately to the gridmanager.  We expect the job should go on hold with an appropriate message (similar to GRAM).  Instead, the user gets a \"Globus resource down\"-style message and the job stays idle.</blockquote>", "remarks": "<blockquote>\n<em>2014-Oct-09 14:40:32 by jfrey:</em> <br/>\n\nDetecting and handling authentication failures is easy to do. The CEDAR network layer can return an error string describing the methods attempted and why they failed. The same is not true for authorization failures. If the daemon doesn't like the authenticated user id, it just closes the connection. No explanation is given to the client. The daemon could have crashed or had some other internal error as far as the client can tell.\n\n<p>Zach believes we can change the protocol so that the daemon informs the client that it is not authorized, but it is not a simple change.\n\n</p><p></p><hr/>\n<em>2014-Oct-09 14:50:58 by blin:</em> <br/>\n\nSolving the authentication bit should be enough to resolve this ticket. The authorization issue can probably be shoved into another ticket since it'll take longer.\n\n<p></p><hr/>\n<em>2014-Oct-09 15:02:49 by blin:</em> <br/>\n\nJaime pointed out that if we're using GSI, users will be mapped to 'gsi@unmapped' if they're not in the grid mapfile or GUMS, which means that the OSG actually does need a solution to authorization errors.\n\n<p></p><hr/>\n<em>2014-Oct-31 14:12:25 by jfrey:</em> <br/>\n\nFor the 8.2.x series, we'll assume that a failure on the first communication after authentication is probably a CEDAR authorization problem. For commands that the C-GAHP uses, we'll add \"probably an authorization failure\" to those error messages, which will be passed back to the gridmanager and the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=HoldReason\" title=\"Hold Reason\">HoldReason</a></span> in the job ad.\n\n<p></p><hr/>\n<em>2015-Feb-11 16:05:16 by bbockelm:</em> <br/>\n\nThis got released.  Can we call it \"resolved\"?\n\n<p></p><hr/>\n<em>2015-Apr-08 15:50:39 by tannenba:</em> <br/>\n\nBump?  Code review?\n\n<p></p><hr/>\n<em>2015-Apr-16 16:12:08 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>:  All good.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-04 10:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d660767b7fe5188ccc6c3dc17cd1a89fe45364e9\">[41570]</a></span>: minor 8.2.4 version history item edits for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4678\" onclick=\"get_ticket_and_populate_wrapper('4678'); return false;\" title=\"macro_expand() ignores default param values\">#4678</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4680\" onclick=\"get_ticket_and_populate_wrapper('4680'); return false;\" title=\"condor_gangliad always logs using gmetric on reconfig\">#4680</a></span>, and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4557\" onclick=\"get_ticket_and_populate_wrapper('4557'); return false;\" title=\"HTCondor-C should gracefully handle authentication issues\">#4557</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-31 14:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6c8c913211f202ce64ace3ef6d11a8f1f08d8672\">[41548]</a></span>: Docs for holding condor-c jobs on security failures. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4557\" onclick=\"get_ticket_and_populate_wrapper('4557'); return false;\" title=\"HTCondor-C should gracefully handle authentication issues\">#4557</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-31 14:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e2f52d06f199a43706288014662773f54348a048\">[41547]</a></span>: Hold Condor-C jobs on failures not due to the machine being down. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4557\" onclick=\"get_ticket_and_populate_wrapper('4557'); return false;\" title=\"HTCondor-C should gracefully handle authentication issues\">#4557</a></span> Examine the gahp error message to distinguish between dead machine and other failures (like authentication or authorization). On the latter, put the affected jobs on hold. Also, when retrying submissions due to GRIDMANAGER_CONNECT_FAILURE_RETRY_COUNT,\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-31 14:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d277fd7005e924a406292468f8aa0db1e6bba0a8\">[41545]</a></span>: Improve error messages for schedd client methods used by the c-gahp. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4557\" onclick=\"get_ticket_and_populate_wrapper('4557'); return false;\" title=\"HTCondor-C should gracefully handle authentication issues\">#4557</a></span> These methods are now more reliable about filling out the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CondorError\" title=\"Condor Error\">CondorError</a></span> object when an error occurs. When the error is probably due to a CEDAR authorization failure, that is now mentioned in the error message.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-31 14:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8530f83c89283963158f7620c6fe6eb030542b71\">[41546]</a></span>: Improve error propagation in the c-gahp. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4557\" onclick=\"get_ticket_and_populate_wrapper('4557'); return false;\" title=\"HTCondor-C should gracefully handle authentication issues\">#4557</a></span> In particular, pass a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CondorError\" title=\"Condor Error\">CondorError</a></span> object to ConnectQ(). And when an error is probably a CEDAR authorization failure, mention that in the error message.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Apr-16 16:12", "status": "resolved", "created": "2014-Aug-25 13:25", "fixed_version": "2014-Aug-25 13:25", "broken_version": "v080000", "priority": "2", "subsystem": "", "assigned_to": "jfrey", "derived_from": "#4555", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "blin@cs.wisc.edu, marian.zvada@cern.ch", "due_date": "20150410"}