{"id": 5469, "title": "Ticket #5469: Job Router handling of job policy exprs needs work", "description": "<blockquote>\nWhen the Job Router claims a job to route, it evaluates the periodic job policy expressions of the source job. It also forwards those expressions into the destination job, where the schedd (or one of its delegates) will evaluate those same expressions.\n\n<p>In many situations, the periodic remove expression will evaluate to True in both ads at about the same time, and there is a race as to which one will occur first. If it fires first in the source job, then the Job Router will remove the destination job and then let the source job leave the queue. If it fires first in the destination job, then the Job Router will return the source job to schedd control and try rerouting it later. Returning the job to the schedd may alter the ad such that the periodic remove will no longer fire. This can result in a loop of a source job being routed and aborted multiple times.\n\n</p><p>If the source job has the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TimerRemove\" title=\"Timer Remove\">TimerRemove</a></span> attribute (set by Condor-C when a job lease is used), then the initial lease time is forwarded to the destination job, but none of the lease renewals are forwarded. Thus, the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TimerRemove\" title=\"Timer Remove\">TimerRemove</a></span> will not fire in the source job, but will fire in the destination job after the initial lease expires. If the destination job cannot complete before the lease expiration that was set when that job was submitted expires, the job ends up in the loop described above.\n\n</p><p>The problem with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TimerRemove\" title=\"Timer Remove\">TimerRemove</a></span> can be easily solved by having the Job Router always remove this attribute from the destination job ad. It's unclear to me whether we can do the same for the other policy expressions, as they may be sensitive to the differences between the source and destination job ads.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5470\" onclick=\"get_ticket_and_populate_wrapper('5470'); return false;\" title=\"TimerRemove attribute broken\">#5470</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\n<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TimerRemove\" title=\"Timer Remove\">TimerRemove</a></span> attribute broken</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "todo", "last_change": "2016-Jan-11 16:21", "status": "active", "created": "2016-Jan-11 16:11", "fixed_version": "2016-Jan-11 16:11", "broken_version": "v080400", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "cern", "visibility": "public", "notify": "", "due_date": ""}