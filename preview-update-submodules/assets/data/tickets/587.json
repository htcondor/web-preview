{"id": 587, "title": "Ticket #587: Possibly allow elimination of ProcessId sleep at DAGMan startup", "description": "<blockquote>\nI'm not sure if this is a good idea or not, but it's requested in the associated RUST ticket.  If we do this, we'd have to decide what's the right thing to do if DAGMan sees a lock file at startup -- probably it needs to just continue, because that would be what we need to do in response to condor_hold/condor_release of DAGMan.</blockquote>", "remarks": "<blockquote>\nHmm, I'm thinking about this in conjucntion with the problem that the job_dagman_retry_recovery test has been failing on MacOS, because the ProcAPI::isAlive() function is returning UNCERTAIN, and we're having DAGMan quit in that case.  I'm thinking that a way to deal with this would be to also store the Condor ID of the DAGMan in the lock file, and if isAlive() returns UNCERTAIN, or if you haven't stored a ProcessID object in the lock file for speed, we could check whether our Condor ID is the same as the one in the lock file, and continue if it is (on the grounds that that most likely represents recovery mode).  (But we do need to keep the default to be that we quit if the process whose ProcessID is in the lock file is alive, because that dates back to LIGO's problem of the schedd sometimes accidentally restarting an extra DAGMan.)\n\n<p></p><hr/>\n<em>2015-Aug-05 11:56:34 by wenger:</em> <br/>\n\nMaybe either just change the Unique PID code to do the minimum (one second) sleep, or else replace the \"Unique PID\" stuff with the plain old OS PID...\n\n<p></p><hr/>\n<em>2015-Aug-05 11:58:48 by wenger:</em> <br/>\n\nNote:  Also fix the bug with the re-multiplying of DEFAULT_PRECISION_RANGE if the unique PID stuff gets called more than once.\n\n<p></p><hr/>\n<em>2015-Aug-05 12:52:40 by wenger:</em> <br/>\n\nOkay, I'm going to investigate making the sleep shorter for 8.3.8.  ToddT says look into changing this to creating a file in /var/lock and then getting a file lock on that file -- the lock will go away when the process does.\n\n<p></p><hr/>\n<em>2015-Aug-06 14:42:15 by wenger:</em> <br/>\n\nNotes from Brian Candler:\n\n<p>There seems to be legacy magic in there, or hooks to support systems\nwhich were planned but never implemented. For example: createProcessId\nhas a loop which waits for the value from generateControlTime to\nstabilise. However both the Linux and non-Linux versions of\ngenerateControlTime do nothing except set ctl_time=0. Similarly,\nProcessId::confirm just sets true.\n\n</p><p>This is all something to do with process \"birthdays\". Perhaps the idea\nwas to run on a system which can tell you when process IDs are being\nrecycled?\n\n</p><p></p><hr/>\n<em>2015-Aug-07 10:05:02 by wenger:</em> <br/>\n\nI'm going to change this ticket to reflect the creation of child ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5206\" onclick=\"get_ticket_and_populate_wrapper('5206'); return false;\" title=\"Reduce DAGMan startup sleep\">#5206</a></span>.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5206\" onclick=\"get_ticket_and_populate_wrapper('5206'); return false;\" title=\"Reduce DAGMan startup sleep\">#5206</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nReduce DAGMan startup sleep</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-06 17:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a1b519a335eb0b975ab2e9b83ae7f9dda2e17d76\">[45505]</a></span>: Gittrac <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=587\" onclick=\"get_ticket_and_populate_wrapper('587'); return false;\" title=\"Possibly allow elimination of ProcessId sleep at DAGMan startup\">#587</a></span>: Changed sleep from 12 to 3 seconds to at least make things better for 8.3.8; further improvements planned for 8.5 series.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jun-23 11:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b14520137d9415a6194c8d72c05385da8040fac1\">[24850]</a></span>: Made a change that should fix the job_dagman_retry_recovery failures on MacOS -- now, when DAGMan checks at startup for a conflicting DAGMan running on the same DAG, it continues rather than exiting if it's not sure whether the DAGMan that wrote the lock file is alive. (See gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=215\" onclick=\"get_ticket_and_populate_wrapper('215'); return false;\" title=\"Add a nightly test that tests DAG recovery\">#215</a></span>, <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=587\" onclick=\"get_ticket_and_populate_wrapper('587'); return false;\" title=\"Possibly allow elimination of ProcessId sleep at DAGMan startup\">#587</a></span>.)  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jun-23 11:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/780dc5bad411c8f9fc8d7b1b15cb054ffc7dd3d0\">[14946]</a></span>: Made a change that should fix the job_dagman_retry_recovery failures on MacOS -- now, when DAGMan checks at startup for a conflicting DAGMan running on the same DAG, it continues rather than exiting if it's not sure whether the DAGMan that wrote the lock file is alive. (See gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=215\" onclick=\"get_ticket_and_populate_wrapper('215'); return false;\" title=\"Add a nightly test that tests DAG recovery\">#215</a></span>, <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=587\" onclick=\"get_ticket_and_populate_wrapper('587'); return false;\" title=\"Possibly allow elimination of ProcessId sleep at DAGMan startup\">#587</a></span>.)  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Jun-01 13:45", "status": "stalled", "created": "2009-Jun-19 14:36", "fixed_version": "2009-Jun-19 14:36", "broken_version": "v070203", "priority": "3", "subsystem": "Dag", "assigned_to": "", "derived_from": "", "creator": "wenger", "rust": "a19398", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, zmiller@cs.wisc.edu, tannenba@cs.wisc.edu, coatsworth@cs.wisc.edu", "due_date": ""}