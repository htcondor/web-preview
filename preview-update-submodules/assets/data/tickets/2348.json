{"id": 2348, "title": "Ticket #2348: suppression of default RequestMemory requirements is flakey", "description": "<blockquote>\ncondor_submit inserts the following default requirements:\n\n<p></p><pre>   ( ( RequestMemory * 1024 ) &gt;= ImageSize )\n</pre>\n\n<p>This is problematic, because <code>ImageSize</code> for some jobs is quite a bit larger than the amount of physical RAM the job actually needs.\n\n</p><p>condor_submit tries to allow the user to override the default requirements.  In theory, any explicit reference to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> overrides the default, but this does not work in all cases.  If the user's unparsed requirement expression contains the characters \"memory\" not preceded by the letter \"t\" before it refers to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span>, the default requirement is always inserted.\n\n</p><p>Example that fails to suppress default:\n\n</p><p></p><pre>   TARGET.Memory &gt;= MY.RequestMemory\n</pre>\n\n<p>Example that successfully suppresses default:\n\n</p><p></p><pre>   MY.RequestMemory &lt;= TARGET.Memory</pre>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Aug-03 15:45:51 by danb:</em> <br/>\n\nThe deeper issue of sloppy attribute reference detection shall be dealt with in the dev series: see <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2350\" onclick=\"get_ticket_and_populate_wrapper('2350'); return false;\" title=\"condor_submit does sloppy checks for attribute references\">#2350</a></span>.\n\n<p></p><hr/>\n<em>2011-Aug-03 16:11:27 by matt:</em> <br/>\n\nThe approach sure looks better than the old one.\n\n<p></p><div class=\"code\">\n<pre class=\"code\">$ condor_version\n$CondorVersion: 7.6.1 May 31 2011 BuildID: RH-7.6.1-0.9.el6 $\n$CondorPlatform: X86_64-Fedora_13 $\n\n$ ./release_dir/bin/condor_version\n$CondorVersion: 7.6.3 Aug 03 2011 $\n$CondorPlatform: X86_64-Fedora_13 $\n\n\n$ echo \"cmd=/bin/true\\nhold=true\\nrequirements=RequestMemory =!= UNDEFINED\\nqueue\" | condor_submit\n$ echo \"cmd=/bin/true\\nhold=true\\nrequirements=TARGET.Memory &gt;= MY.RequestMemory\\nqueue\" | condor_submit\n$ echo \"cmd=/bin/true\\nhold=true\\nrequirements=MY.RequestMemory &lt;= TARGET.Memory\\nqueue\" | condor_submit\n\n$ condor_q -format \"%s\\n\" Requirements\n( RequestMemory =!= undefined )       &amp;&amp; ( TARGET.Arch == \"X86_64\" ) &amp;&amp; ( TARGET.OpSys == \"LINUX\" ) &amp;&amp; ( TARGET.Disk &gt;= DiskUsage ) &amp;&amp; ( ( TARGET.Memory * 1024 ) &gt;= ImageSize ) &amp;&amp; ( TARGET.FileSystemDomain == MY.FileSystemDomain )\n( TARGET.Memory &gt;= MY.RequestMemory ) &amp;&amp; ( TARGET.Arch == \"X86_64\" ) &amp;&amp; ( TARGET.OpSys == \"LINUX\" ) &amp;&amp; ( TARGET.Disk &gt;= DiskUsage ) &amp;&amp; ( ( RequestMemory * 1024 ) &gt;= ImageSize ) &amp;&amp; ( TARGET.FileSystemDomain == MY.FileSystemDomain )\n( MY.RequestMemory &lt;= TARGET.Memory ) &amp;&amp; ( TARGET.Arch == \"X86_64\" ) &amp;&amp; ( TARGET.OpSys == \"LINUX\" ) &amp;&amp; ( TARGET.Disk &gt;= DiskUsage ) &amp;&amp; ( TARGET.FileSystemDomain == MY.FileSystemDomain )\n\n\n$ echo \"cmd=/bin/true\\nhold=true\\nrequirements=RequestMemory =!= UNDEFINED\\nqueue\" | ./release_dir/bin/condor_submit\n$ echo \"cmd=/bin/true\\nhold=true\\nrequirements=TARGET.Memory &gt;= MY.RequestMemory\\nqueue\" | ./release_dir/bin/condor_submit\n$ echo \"cmd=/bin/true\\nhold=true\\nrequirements=MY.RequestMemory &lt;= TARGET.Memory\\nqueue\" | ./release_dir/bin/condor_submit\n\n$ condor_q -format \"%s\\n\" Requirements\n( RequestMemory =!= undefined )       &amp;&amp; ( TARGET.Arch == \"X86_64\" ) &amp;&amp; ( TARGET.OpSys == \"LINUX\" ) &amp;&amp; ( TARGET.Disk &gt;= DiskUsage ) &amp;&amp; ( ( TARGET.Memory * 1024 ) &gt;= ImageSize ) &amp;&amp; ( TARGET.FileSystemDomain == MY.FileSystemDomain )\n( TARGET.Memory &gt;= MY.RequestMemory ) &amp;&amp; ( TARGET.Arch == \"X86_64\" ) &amp;&amp; ( TARGET.OpSys == \"LINUX\" ) &amp;&amp; ( TARGET.Disk &gt;= DiskUsage ) &amp;&amp; ( TARGET.FileSystemDomain == MY.FileSystemDomain )\n( MY.RequestMemory &lt;= TARGET.Memory ) &amp;&amp; ( TARGET.Arch == \"X86_64\" ) &amp;&amp; ( TARGET.OpSys == \"LINUX\" ) &amp;&amp; ( TARGET.Disk &gt;= DiskUsage ) &amp;&amp; ( TARGET.FileSystemDomain == MY.FileSystemDomain )\n</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-03 14:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/374e953bbc734157aadeb8cd04b1822a34b76fa0\">[26599]</a></span>: Documented fix for suppression of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> requirements. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2348\" onclick=\"get_ticket_and_populate_wrapper('2348'); return false;\" title=\"suppression of default RequestMemory requirements is flakey\">#2348</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-03 14:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/00b64a263d92cb23a615c2928ac4c8813172f31e\">[26598]</a></span>: Fixed a problem with overriding the default <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> requirements. ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2348\" onclick=\"get_ticket_and_populate_wrapper('2348'); return false;\" title=\"suppression of default RequestMemory requirements is flakey\">#2348</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Aug-08 15:43", "status": "resolved", "created": "2011-Aug-03 12:44", "fixed_version": "2011-Aug-03 12:44", "broken_version": "v070404", "priority": "2", "subsystem": "", "assigned_to": "danb", "derived_from": "#1506", "creator": "danb", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "tstclair@redhat.com", "due_date": ""}