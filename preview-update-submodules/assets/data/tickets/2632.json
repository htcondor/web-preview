{"id": 2632, "title": "Ticket #2632: Condor ignores memory usage by processes that fork without exec", "description": "<blockquote>\nIn days of old when Linux threads were new, Condor over-reported memory usage by threaded programs, because it didn't know the processes were sharing memory.  To work around this, Condor was made to ignore memory usage by processes with the FORKNOEXEC process flag, because this flag was set for threads.  The down side, of course, is that it does not see memory usage by real processes that fork and do not exec.  This was deemed a small enough disadvantage, because it is common for forked sub-processes to share a lot of their memory with the parent anyway, so the same over-reporting problem applied.\n\n<p>Now that Linux threads no longer have the problem of being confused for processes, and we have PSS to avoid over-reporting memory usage by forked sub-processes, the FORKNOEXEC workaround should be removed.\n\n</p><p>To underscore this, an incident in GLOW occurred today in which an ATLAS job used too much memory in a forked sub-process.  Debugging the problem was made harder by the confusing fact that Condor was not seeing the bulk of the memory usage.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Nov-14 12:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/abf9b5d1b7d07329663790c24cd113dae485725e\">[28243]</a></span>: Stop ignoring memory usage by proccesses in linux with the forknoexec flag set. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2632\" onclick=\"get_ticket_and_populate_wrapper('2632'); return false;\" title=\"Condor ignores memory usage by processes that fork without exec\">#2632</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Nov-14 12:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/18e3f928b42388f1fa7ffb4f5503c648d07a15c0\">[28244]</a></span>: Documented fix for memory usage monitoring with forknoexec process flag. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2632\" onclick=\"get_ticket_and_populate_wrapper('2632'); return false;\" title=\"Condor ignores memory usage by processes that fork without exec\">#2632</a></span> ===VersionHistory:Complete===  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Nov-14 12:23", "status": "resolved", "created": "2011-Nov-14 11:58", "fixed_version": "2011-Nov-14 11:58", "broken_version": "v070000", "priority": "4", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "", "due_date": ""}