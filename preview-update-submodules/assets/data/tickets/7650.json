{"id": 7650, "title": "Ticket #7650: TasksMax should be larger in the systemd condor.service file", "description": "<blockquote>\nOSG ran into a problem when they could not spawn a shadow after 32k jobs were started. The <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TasksMax\" title=\"Tasks Max\">TasksMax</a></span> limit set by systemd came into effect. Earlier, we wanted to make this infinity, but some older versions of systemd did not parse that correctly. Now, all current versions of systemd work fine with infinity. So, let's make the originally intended change.</blockquote>", "remarks": "<blockquote>\n<em>2020-Jul-21 14:21:34 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Should the limits in systemd somehow be related to the limits HTCondor configures at runtime via  the script <a class=\"file\" href=\"rlog?f=src/condor_scripts/linux_kernel_tuning\">/src/condor_scripts/linux_kernel_tuning</a> ?\n\n</p><p>At first blush it seems strange that our kernel tuning script increases /proc/sys/fs/file-max to a value of X and yet systemd LimitNOFILE is set to a completely unrelated value of Y.\n\n</p><p>(also see code review under <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6645\" onclick=\"get_ticket_and_populate_wrapper('6645'); return false;\" title=\"Increase systemd TasksMax\">#6645</a></span>)\n\n</p><p></p><hr/>\n<em>2020-Jul-21 14:51:40 by tim:</em> <br/>\n\nI like the idea of matching the values in the Linux Kernel Tuning script.\n\n<p>This ticket was more about the task limits and the FD limit is what was causing Matyas grief.\n\n</p><p></p><hr/>\n<em>2020-Jul-31 18:56:58 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Patch <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/08ba5c4b83531c665c3c40a2637ceb259ef5efd2\">[60178]</a></span> looks good.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-21 15:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/08ba5c4b83531c665c3c40a2637ceb259ef5efd2\">[60178]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7650\" onclick=\"get_ticket_and_populate_wrapper('7650'); return false;\" title=\"TasksMax should be larger in the systemd condor.service file\">#7650</a></span>) Make condor.service file limits match the Linux kernel tuning script  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-21 14:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1253569c7039626430f20166211a313b47b20846\">[60176]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7650\" onclick=\"get_ticket_and_populate_wrapper('7650'); return false;\" title=\"TasksMax should be larger in the systemd condor.service file\">#7650</a></span>) Increase <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TasksMax\" title=\"Tasks Max\">TasksMax</a></span> and LimitNOFILE to 1,000,000  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-21 13:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9610f7e95c71784cb6840e661c30213dd080613c\">[60175]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7650\" onclick=\"get_ticket_and_populate_wrapper('7650'); return false;\" title=\"TasksMax should be larger in the systemd condor.service file\">#7650</a></span>) increase <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TasksMax\" title=\"Tasks Max\">TasksMax</a></span> and LimitNOFILE to 16777215  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-May-21 09:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/317632df8a2e0c74fac15292cb62a2ba0a53ed87\">[59704]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7650\" onclick=\"get_ticket_and_populate_wrapper('7650'); return false;\" title=\"TasksMax should be larger in the systemd condor.service file\">#7650</a></span>) increase <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TasksMax\" title=\"Tasks Max\">TasksMax</a></span> and LimitNOFILE to infinity  (By Tim Theisen )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Aug-02 07:14", "status": "resolved", "created": "2020-May-21 09:19", "fixed_version": "2020-May-21 09:19", "broken_version": "v080611", "priority": "3", "subsystem": "Packaging", "assigned_to": "tim", "derived_from": "", "creator": "tim", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "tannenba@cs.wisc.edu tlmiller@cs.wisc.edu matyas@cs.wisc.edu", "due_date": ""}