{"id": 3601, "title": "Ticket #3601: autofs doesn't work with 7.9", "description": "<blockquote>\nAs of <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3505\" onclick=\"get_ticket_and_populate_wrapper('3505'); return false;\" title=\"Leaking mount points, on filesystems originally mounted w/shared prop.\">#3505</a></span>, we unconditionally unshare the root filesystem namespace in the job.  This is needed for MOUNT_UNDER_SCRATCH, fuse mounts, and file system remaps.  Unfortuantely, this breaks autofs, because autofs lives in the root namespace.  Propose adding a knob to turn off unsharing.</blockquote>", "remarks": "<blockquote>\n<em>2013-Apr-29 16:03:00 by tstclair:</em> <br/>\n\nApplying a knob and defaulting to off is the simplest solution but this may affect others who rely on the unshare. (MOUNT_UNDER_SCRATCH, NAMED_CHROOT, etc.)\n\n<p></p><hr/>\n<em>2013-Apr-29 16:05:09 by tstclair:</em> <br/>\n\nMaybe default it on and selectively disable.?.?  That seems like a wiser choice.\n\n<p></p><hr/>\n<em>2013-Apr-29 16:29:08 by bbockelm:</em> <br/>\n\nHi,\n\n<p>These were all working prior to <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3505\" onclick=\"get_ticket_and_populate_wrapper('3505'); return false;\" title=\"Leaking mount points, on filesystems originally mounted w/shared prop.\">#3505</a></span>.  I think we regressed in 7.9.5.\n\n</p><p>UNL uses autofs fairly extensively and didn't hit issues when using MOUNT_UNDER_SCRATCH.\n\n</p><p>I'd propose fixing the underlying bug rather than add a knob.\n\n</p><p>Brian</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-20 14:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/59dedfc4e83ee875866d7aad144e0273c3287a9a\">[35768]</a></span>: defn of new knob PER_JOB_NAMESPACES in manual ===GT=== <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=3601\" onclick=\"get_ticket_and_populate_wrapper('3601'); return false;\" title=\"autofs doesn't work with 7.9\">#3601</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-07 17:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/aec470eec260f1cc6076fe6aa4eb8630e64665ac\">[35641]</a></span>: Edit many 7.9.6 version history items, including those for tickets (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3539\" onclick=\"get_ticket_and_populate_wrapper('3539'); return false;\" title=\"change recommended configuration for disabling preemption\">#3539</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3586\" onclick=\"get_ticket_and_populate_wrapper('3586'); return false;\" title=\"move python bindings out of contrib\">#3586</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3398\" onclick=\"get_ticket_and_populate_wrapper('3398'); return false;\" title=\"Batch GAHP cannot set remote memory or walltime requests\">#3398</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3560\" onclick=\"get_ticket_and_populate_wrapper('3560'); return false;\" title=\"improve dprintf code to support audit logs (time based rotation)\">#3560</a></span>, <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2949\" onclick=\"get_ticket_and_populate_wrapper('2949'); return false;\" title=\"peaceful shutdown cannot be escalated to graceful\">#2949</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3493\" onclick=\"get_ticket_and_populate_wrapper('3493'); return false;\" title=\"Audit Log for Condor schedds\">#3493</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3496\" onclick=\"get_ticket_and_populate_wrapper('3496'); return false;\" title=\"monitor file transfer i/o activity\">#3496</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3597\" onclick=\"get_ticket_and_populate_wrapper('3597'); return false;\" title=\"CPU affinity enforcement broken with partitionable slots\">#3597</a></span>, <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=3601\" onclick=\"get_ticket_and_populate_wrapper('3601'); return false;\" title=\"autofs doesn't work with 7.9\">#3601</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3579\" onclick=\"get_ticket_and_populate_wrapper('3579'); return false;\" title=\"condor_updates_stats doesn't work anymore\">#3579</a></span>,) and (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3570\" onclick=\"get_ticket_and_populate_wrapper('3570'); return false;\" title=\"Starter leaks FDs to file transfer plugin\">#3570</a></span>, <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=3588\" onclick=\"get_ticket_and_populate_wrapper('3588'); return false;\" title=\"DHCPREQUEST doesn't have the ending 0xff byte to mark end of options f\">#3588</a></span>)  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-06 14:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0820fec171113916fcdcae9810a0f2dc4d1c2770\">[35608]</a></span>: Document <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=3601\" onclick=\"get_ticket_and_populate_wrapper('3601'); return false;\" title=\"autofs doesn't work with 7.9\">#3601</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-29 16:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d07c75945a87130a3b9b98c8f963763d2a284fb3\">[35577]</a></span>: Ticket <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=3601\" onclick=\"get_ticket_and_populate_wrapper('3601'); return false;\" title=\"autofs doesn't work with 7.9\">#3601</a></span> Selectively use unshare only on remap and knob.  (By Timothy St. Clair )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Jun-03 15:42", "status": "review", "created": "2013-Apr-29 15:51", "fixed_version": "2013-Apr-29 15:51", "broken_version": "v070905", "priority": "2", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "a25445", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com, bbockelm@cse.unl.edu", "due_date": "20130613"}