{"id": 4181, "title": "Ticket #4181: IPv4/IPv6 mixed-mode collector end-to-end test NO_DNS=FALSE", "description": "<blockquote>\nThis is a repeat of <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4179\" onclick=\"get_ticket_and_populate_wrapper('4179'); return false;\" title=\"IPv4/IPv6 mixed-mode collector end-to-end test\">#4179</a></span>, but with NO_DNS=FALSE.\n\n<p>A IPv4-IPv6 mixed mode collector with clients which are IPv4-only, IPv6-only, and mixed-mode, works with NO_DNS=FALSE.  All clients are able to successfully advertise and query the collector; the collector node itself and the mixed-mode client could do so over both protocols.  Hostnames and IP addresses wboth work.\n\n</p><p>---\n\n</p><p>Commands are sorted by time.  The command prompt shows which host each command was run on.\n\n</p><p></p><ul>\n<li>debian-00 has IPv4 and IPv6 connectivity. It is the collector in these tests\n</li><li>debian-01 only has IPv6 connectivity.\n</li><li>debian-02 only has IPv4 connectivity.\n</li><li>debian-03 has IPv4 and IPv6 connectivity.\n</li></ul>\n\n<p><span class=\"section\"></span></p><h2>Setup </h2>\n\n<p>For the sake of simplicity, the output from \"<code>./condor_install --make-personal-condor</code>\" has been omitted.\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">debian-00$ tar xzf condor-8.1.3-219620-x86_64_Debian7-unstripped.tar.gz\ndebian-00$ cd condor-8.1.3-219620-x86_64_Debian7-unstripped/\ndebian-00$ ./condor_install --make-personal-condor\ndebian-00$ source condor.sh\ndebian-00$ ROOT=`pwd`\ndebian-00$ cat  &gt;&gt; etc/condor_config &lt;&lt;END\n&gt; # Turn on IPv6 support. (IPv4 support defaults to on.)\n&gt; ENABLE_IPV6 = TRUE\n&gt;\n&gt; LOCAL_DIR   = $ROOT/local\n&gt; LOCAL_CONFIG_FILE =\n&gt;\n&gt; # Simple security.\n&gt; ALLOW_WRITE_COLLECTOR = *\n&gt; ALLOW_READ_COLLECTOR = *\n&gt; END\ndebian-00$ mv local.`hostname` local\ndebian-00$ condor_collector -f -p 9618\n</pre></div>\n\n\n<p>At this point this debian-00 session is busy running the collector.  A new debian-00 session is started for further interactive testing\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">debian-00$ cd condor-8.1.3-219620-x86_64_Debian7-unstripped/\ndebian-00$ source condor.sh\ndebian-00$ cat &gt; condor_config.ipv4  &lt;&lt;END\n&gt; ENABLE_IPV4=TRUE\n&gt; ENABLE_IPV6=FALSE\n&gt; END\ndebian-00$ cat &gt; condor_config.ipv6  &lt;&lt;END\n&gt; ENABLE_IPV4=FALSE\n&gt; ENABLE_IPV6=TRUE\n&gt; END\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-01$ tar xzf condor-8.1.3-219620-x86_64_Debian7-unstripped.tar.gz\ndebian-01$ cd condor-8.1.3-219620-x86_64_Debian7-unstripped/\ndebian-01$ ./condor_install --make-personal-condor\ndebian-01$ source condor.sh\ndebian-01$ cat &gt; condor_config.ipv6  &lt;&lt;END\n&gt; ENABLE_IPV4=FALSE\n&gt; ENABLE_IPV6=TRUE\n&gt; END\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-02$ tar xzf condor-8.1.3-219620-x86_64_Debian7-unstripped.tar.gz\ndebian-02$ cd condor-8.1.3-219620-x86_64_Debian7-unstripped/\ndebian-02$ ./condor_install --make-personal-condor\ndebian-02$ source condor.sh\ndebian-02$ cat &gt; condor_config.ipv4  &lt;&lt;END\n&gt; ENABLE_IPV4=TRUE\n&gt; ENABLE_IPV6=FALSE\n&gt; END\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-03$ tar xzf condor-8.1.3-219620-x86_64_Debian7-unstripped.tar.gz\ndebian-03$ cd condor-8.1.3-219620-x86_64_Debian7-unstripped/\ndebian-03$ ./condor_install --make-personal-condor\ndebian-03$ source condor.sh\ndebian-03$ cat &gt; condor_config.ipv4  &lt;&lt;END\n&gt; ENABLE_IPV4=TRUE\n&gt; ENABLE_IPV6=FALSE\n&gt; END\ndebian-03$ cat &gt; condor_config.ipv6  &lt;&lt;END\n&gt; ENABLE_IPV4=FALSE\n&gt; ENABLE_IPV6=TRUE\n&gt; END\n</pre></div>\n\n\n<p><span class=\"section\"></span></p><h2>Submitting ads</h2>\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-00$ CONDOR_CONFIG=condor_config.ipv4 condor_advertise  -pool '&lt;192.168.122.105:9618&gt;' UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"1 test\"\n&gt; Name = \"IPv4 IP localhost\"\n&gt; END\nSent 1 of 1 ad to (null).\ndebian-00$ CONDOR_CONFIG=condor_config.ipv6 condor_advertise  -pool '&lt;[fc00::5054:ff:fef9:a254]:9618&gt;' UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"2 test\"\n&gt; Name = \"IPv6 IP localhost\"\n&gt; END\nSent 1 of 1 ad to (null).\ndebian-00$ CONDOR_CONFIG=condor_config.ipv4 condor_advertise  -pool debian-00 UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"3 test\"\n&gt; Name = \"IPv4 DNS localhost\"\n&gt; END\nSent 1 of 1 ad to debian-00.\ndebian-00$ CONDOR_CONFIG=condor_config.ipv6 condor_advertise  -pool debian-00 UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"4 test\"\n&gt; Name = \"IPv6 DNS localhost\"\n&gt; END\nSent 1 of 1 ad to debian-00.\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-01$ CONDOR_CONFIG=condor_config.ipv6 condor_advertise  -pool '&lt;[fc00::5054:ff:fef9:a254]:9618&gt;' UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"5 test\"\n&gt; Name = \"IPv6 IP remote\"\n&gt; END\nSent 1 of 1 ad to (null).\ndebian-01$ CONDOR_CONFIG=condor_config.ipv6 condor_advertise  -pool debian-00 UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"6 test\"\n&gt; Name = \"IPv6 DNS remote\"\n&gt; END\nSent 1 of 1 ad to debian-00.\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-02$ CONDOR_CONFIG=condor_config.ipv4 condor_advertise -pool '&lt;192.168.122.105:9618&gt;' UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"7 test\"\n&gt; Name = \"IPv4 IP remote\"\n&gt; END\nSent 1 of 1 ad to (null).\ndebian-02$ CONDOR_CONFIG=condor_config.ipv4 condor_advertise -pool debian-00 UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"8 test\"\n&gt; Name = \"IPv4 DNS remote\"\n&gt; END\nSent 1 of 1 ad to debian-00.\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-03$ CONDOR_CONFIG=condor_config.ipv4 condor_advertise -pool '&lt;192.168.122.105:9618&gt;' UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"9 test\"\n&gt; Name = \"IPv4(6) IP remote\"\n&gt; END\nSent 1 of 1 ad to (null).\ndebian-03$ CONDOR_CONFIG=condor_config.ipv4 condor_advertise -pool debian-00 UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"10 test\"\n&gt; Name = \"IPv4(6) DNS remote\"\n&gt; END\nSent 1 of 1 ad to debian-00.\ndebian-03$ CONDOR_CONFIG=condor_config.ipv6 condor_advertise -pool '&lt;[fc00::5054:ff:fef9:a254]:9618&gt;' UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"11 test\"\n&gt; Name = \"IPv6(4) IP remote\"\n&gt; END\nSent 1 of 1 ad to (null).\ndebian-03$ CONDOR_CONFIG=condor_config.ipv6 condor_advertise -pool debian-00 UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"12 test\"\n&gt; Name = \"IPv6(4) DNS remote\"\n&gt; END\nSent 1 of 1 ad to debian-00.\n</pre></div>\n\n\n<p><span class=\"section\"></span></p><h2>Query ads</h2>\n\n<p>Every call to <code>condor_status</code> returned the same response, reproduced below.  This response includes all advertisements expected, indicating that both advertising and querying for ads works fine.\n\n</p><p>Response:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">1 test IPv4 IP localhost\n10 test IPv4(6) DNS remote\n11 test IPv6(4) IP remote\n12 test IPv6(4) DNS remote\n2 test IPv6 IP localhost\n3 test IPv4 DNS localhost\n4 test IPv6 DNS localhost\n5 test IPv6 IP remote\n6 test IPv6 DNS remote\n7 test IPv4 IP remote\n8 test IPv4 DNS remote\n9 test IPv4(6) IP remote\n</pre></div>\n\n\n<p>Commands run:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">debian-00$ CONDOR_CONFIG=condor_config.ipv4 condor_status -pool '&lt;192.168.122.105:9618&gt;' -af Machine Name\ndebian-00$ CONDOR_CONFIG=condor_config.ipv4 condor_status -pool debian-00 -af Machine Name\ndebian-00$ CONDOR_CONFIG=condor_config.ipv6 condor_status -pool '&lt;[fc00::5054:ff:fef9:a254]:9618&gt;' -af Machine Name\ndebian-00$ CONDOR_CONFIG=condor_config.ipv6 condor_status -pool debian-00 -af Machine Name\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-01$ CONDOR_CONFIG=condor_config.ipv6 condor_status -pool '&lt;[fc00::5054:ff:fef9:a254]:9618&gt;' -af Machine Name\ndebian-01$ CONDOR_CONFIG=condor_config.ipv6 condor_status -pool debian-00 -af Machine Name\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-02$ CONDOR_CONFIG=condor_config.ipv4 condor_status -pool '&lt;192.168.122.105:9618&gt;' -af Machine Name\ndebian-02$ CONDOR_CONFIG=condor_config.ipv4 condor_status -pool debian-00 -af Machine Name\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-03$ CONDOR_CONFIG=condor_config.ipv4 condor_status -pool '&lt;192.168.122.105:9618&gt;' -af Machine Name\ndebian-03$ CONDOR_CONFIG=condor_config.ipv4 condor_status -pool debian-00 -af Machine Name\ndebian-03$ CONDOR_CONFIG=condor_config.ipv6 condor_status -pool '&lt;[fc00::5054:ff:fef9:a254]:9618&gt;' -af Machine Name\ndebian-03$ CONDOR_CONFIG=condor_config.ipv6 condor_status -pool debian-00 -af Machine Name\n</pre></div>\n\n\n<p></p><hr/>\nObsolete(ish) notes.  I was concerned I might need to get \"real\" DNS working.  It proved unnecessary.  This may change when we add security to the mix.\n<ul>\n<li><a class=\"external\" href=\"http://www.pfsense.org/\">http://www.pfsense.org/</a> - recommended as easy interface to DNSMasq, but requires a VM\n</li><li><a class=\"external\" href=\"http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html\">http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html</a>\n</li><li><a class=\"external\" href=\"http://cr.yp.to/djbdns/tinydns.html\">http://cr.yp.to/djbdns/tinydns.html</a>\n</li><li><a class=\"external\" href=\"http://www.dmarkweb.com/setting-up-a-local-network-dns-server-using-bind9-for-debian.html\">http://www.dmarkweb.com/setting-up-a-local-network-dns-server-using-bind9-for-debian.html</a></li></ul>\n</blockquote>", "remarks": "<blockquote>\nResolving to declutter IPv6 todo list.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "todo", "last_change": "2015-May-27 15:38", "status": "resolved", "created": "2014-Jan-27 17:06", "fixed_version": "2014-Jan-27 17:06", "broken_version": "", "priority": "2", "subsystem": "", "assigned_to": "adesmet", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "adesmet@cs.wisc.edu", "due_date": ""}