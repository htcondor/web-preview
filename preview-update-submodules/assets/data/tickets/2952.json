{"id": 2952, "title": "Ticket #2952: submitter limit should be more aware of NEGOTIATOR_CONSIDER_PREEMPTION", "description": "<blockquote>\nSubmitter limits can be set too high when NEGOTIATOR_CONSIDER_PREEMPTION is enabled, because the value of 'consider preemption' flag is not considered by the function that calculates limits.</blockquote>", "remarks": "<blockquote>\n<em>2012-Apr-25 12:16:20 by eje:</em> <br/>\n\nREPRO/TEST.\n\n<p>Configuration:\n</p><div class=\"code\">\n<pre class=\"code\">NEGOTIATOR_CONSIDER_PREEMPTION = FALSE\nNUM_CPUS = 5\nGROUP_NAMES = a\nGROUP_QUOTA_a = 5\n</pre></div>\n\n\n<p>Spin up pool.  Watch negotiator log:\n</p><div class=\"code\">\n<pre class=\"code\">$ tail -f NegotiatorLog | grep -e 'Phase 4..:' -e 'Negotiating with.* at' -e 'submitterLimit *='\n</pre></div>\n\n\n<p>Submit two jobs.  Allow the first to negotiate before submitting the second:\n</p><div class=\"code\">\n<pre class=\"code\">universe = vanilla\ncmd = /bin/sleep\nargs = 300\nshould_transfer_files = if_needed\nwhen_to_transfer_output = on_exit\n+AccountingGroup=\"a.u1\"\nqueue 1\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">universe = vanilla\ncmd = /bin/sleep\nargs = 300\nshould_transfer_files = if_needed\nwhen_to_transfer_output = on_exit\n+AccountingGroup=\"a.u2\"\nqueue 4\n</pre></div>\n\n\n<p>BEFORE FIX, you should see the following (2nd submitter limit is 5)\n</p><div class=\"code\">\n<pre class=\"code\">$ tail -f NegotiatorLog | grep -e 'Phase 4..:' -e 'Negotiating with.* at' -e 'submitterLimit *='\n04/25/12 10:08:20 Phase 4.1:  Negotiating with schedds ...\n04/25/12 10:08:20   Negotiating with a.u1@localdomain at &lt;192.168.1.2:33501&gt;\n04/25/12 10:08:20     submitterLimit    = 1.000000\n04/25/12 10:08:40 Phase 4.1:  Negotiating with schedds ...\n04/25/12 10:08:40   Negotiating with a.u2@localdomain at &lt;192.168.1.2:33501&gt;\n04/25/12 10:08:40     submitterLimit    = 5.000000\n</pre></div>\n\n\n<p>AFTER FIX, you should see (2nd submitter limit is 4)\n</p><div class=\"code\">\n<pre class=\"code\">$ tail -f NegotiatorLog | grep -e 'Phase 4..:' -e 'Negotiating with.* at' -e 'submitterLimit *='\n04/25/12 10:09:47 Phase 4.1:  Negotiating with schedds ...\n04/25/12 10:09:47   Negotiating with a.u1@localdomain at &lt;192.168.1.2:54831&gt;\n04/25/12 10:09:47     submitterLimit    = 1.000000\n04/25/12 10:10:07 Phase 4.1:  Negotiating with schedds ...\n04/25/12 10:10:07   Negotiating with a.u2@localdomain at &lt;192.168.1.2:54831&gt;\n04/25/12 10:10:07     submitterLimit    = 4.000000\n</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-28 13:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/013ff2288e9f89cba83af65c20b4fe73b06eda01\">[32518]</a></span>: minor edit of 7.9.0 version history item ===GT=== <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=2952\" onclick=\"get_ticket_and_populate_wrapper('2952'); return false;\" title=\"submitter limit should be more aware of NEGOTIATOR_CONSIDER_PREEMPTION\">#2952</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-25 12:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/be3a24b43cc120082bb2544fb954374a6a9278d4\">[31819]</a></span>: Made submitter limit logic more aware of NEGOTIATOR_CONSIDER_PREEMPTION and ignore_submitter_limit ===GT:Fixed=== <span class=\"ticket\"><a class=\"review\" href=\"/wiki-archive/tickets/?ticket=2952\" onclick=\"get_ticket_and_populate_wrapper('2952'); return false;\" title=\"submitter limit should be more aware of NEGOTIATOR_CONSIDER_PREEMPTION\">#2952</a></span>  (By Erik Erlandson )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Apr-25 13:49", "status": "review", "created": "2012-Apr-23 16:17", "fixed_version": "2012-Apr-23 16:17", "broken_version": "", "priority": "2", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "", "creator": "eje", "rust": "", "customer_group": "other", "visibility": "public", "notify": "eje@cs.wisc.edu, tstclair@redhat.com", "due_date": ""}