{"id": 5985, "title": "Ticket #5985: x509UserProxyExpiration job attribute is unreliable", "description": "<blockquote>\nx509UserProxyExpiration does not always match the expiration date of the current proxy and the HTCondor-CE uses this attribute to determine whether or not the job has a valid proxy.\n\n<p>In 8.4.9 this resulted in an issue where a factory was releasing a held job with a renewed proxy whose x509UserProxyExpiration attribute was not updated. Jaime says this specific issue is fixed in 8.5.7 but there are other instances where the expiration attribute does not reflect reality.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Nov-02 15:33:48 by tannenba:</em> <br/>\n\nSome action items on this ticket:\n\n<p></p><ol>\n<li>Jaime will write down (as a remark on this ticket) what attributes the job router will forward from a CE job to the routed job.\n\n<p></p></li><li>Currently the shadow will update the  x509UserProxyExpiration attribute when it forwards a refreshed proxy, but the gridmanager will not.  We think, for consistency, the gridmanager should also update this attribute.\n</li></ol>\n\n<p></p><hr/>\n<em>2016-Nov-02 16:05:51 by jfrey:</em> <br/>\n\nThe problem fixed in 8.5.7 was the following:\n\n<p>At the GlideinWMS factory, a Condor-C job is submitted destined for the CE schedd. The job is held for a long period of time, during which its original proxy expires, but the file is replaced with a fresh proxy. Once the job is released, it is submitted to the CE. The proxy expiration time in Condor-C job's ad is never updated, and the old value is propagated to the job ad in the CE schedd. This causes problems at the site, where they see a job whose proxy appears to have expired before the job was submitted.\n\n</p><p>This is fixed by <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5064\" onclick=\"get_ticket_and_populate_wrapper('5064'); return false;\" title=\"Set x509 job attributes from authenticated socket\">#5064</a></span>. Now, the CE schedd will set the proxy expiration time in its job ad based on the proxy it receives over the wire.\n\n</p><p></p><hr/>\n<em>2016-Nov-02 16:17:53 by jfrey:</em> <br/>\n\nOnce the routed job exists, no updated attribute values are forwarded from the CE job ad to the routed job ad. If the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobStatus\" title=\"Job Status\">JobStatus</a></span> of the CE job becomes HELD or REMOVED, then the job router removes the routed job and yields the CE job.\n\n<p></p><hr/>\n<em>2017-Mar-31 11:02:11 by blin:</em> <br/>\n\nWe encountered another case, child ticket here: <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6209\" onclick=\"get_ticket_and_populate_wrapper('6209'); return false;\" title=\"Job router retains stale copy of x509UserProxyExpiration\">#6209</a></span></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6209\" onclick=\"get_ticket_and_populate_wrapper('6209'); return false;\" title=\"Job router retains stale copy of x509UserProxyExpiration\">#6209</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nJob router retains stale copy of x509UserProxyExpiration</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2017-Mar-31 11:02", "status": "new", "created": "2016-Oct-28 13:55", "fixed_version": "2016-Oct-28 13:55", "broken_version": "", "priority": "4", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "#4882", "creator": "blin", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "blin@cs.wisc.edu", "due_date": ""}