{"id": 5183, "title": "Ticket #5183: schedds RESCHEDULE handler needs faster check for idle local jobs", "description": "<blockquote>\nThe SCHEDD can melt down when it has lots of jobs in the queue and new submit requests are happening frequently because each submit sends a RESCHEDULE command; and the handler for that command will walk the job queue looking for idle local jobs.\n\n<p>We've seen this walk take .25 seconds or more on a large schedd with many jobs ine the queue.  Not only does this limit the submit rate to 4/sec.  But it effectively also limits that job completion rate to 4/sec because of the way the self draining queues work (only one job can be removed from the queue per pump cycle).\n\n</p><p>Currently the schedd's RESCHEDULE command handler calls <code>WalkJobQueue(find_idle_local_jobs);</code>.  We should either fix that code to iterate faster (which we can easily do). or change the code so that it doesn't walk the entire job queue.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Aug-05 16:19:00 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>These changes look good.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-06 11:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/32adc41aaf5cfb5df691387298b3112568444fbb\">[45495]</a></span>: Add 8.3.8 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5183\" onclick=\"get_ticket_and_populate_wrapper('5183'); return false;\" title=\"schedds RESCHEDULE handler needs faster check for idle local jobs\">#5183</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-30 10:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/42512472979e9b6313e54b4b5a78bd601d9a0826\">[45434]</a></span>: make the schedd check for idle local jobs faster so that RESCHEDULE doesn't use so much time. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5183\" onclick=\"get_ticket_and_populate_wrapper('5183'); return false;\" title=\"schedds RESCHEDULE handler needs faster check for idle local jobs\">#5183</a></span> This commit changes find_idle_local_jobs to use the job object to quickly reject non-local jobs and makes the walk about an order of magnitude faster for schedds were most jobs are not scheduler or local\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Aug-25 13:43", "status": "resolved", "created": "2015-Jul-29 15:04", "fixed_version": "2015-Jul-29 15:04", "broken_version": "v080307", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "johnkn", "derived_from": "#5162", "creator": "johnkn", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}