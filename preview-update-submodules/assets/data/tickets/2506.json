{"id": 2506, "title": "Ticket #2506: collector performance problems at Purdue", "description": "<blockquote>\nBen Cotton reported collector performance problems for collectors running at Purdue.  Upgrading to 7.7.1 eliminated slow-down caused by sluggish CCB clients, but some 30s delays were still observed in queries.\n\n<p>One set of logs indicated that significant delays might be caused by keeping pool history in the collector.  They plan to migrate the keeping of pool history to a separate instance of the collector.\n\n</p><p>A different incident showed another type of problem:\n\n</p><p></p><div class=\"verbatim\">\n<pre>09/27/11 16:20:23 Calling HandleReq &lt;receive_query_cedar&gt; (0) for command 5 (QUERY_STARTD_ADS) from unauthenticated@unmapped &lt;172.18.42.224:51330&gt;\n09/27/11 16:20:28 Got QUERY_STARTD_ADS\n09/27/11 16:20:28 (Sending 8 ads in response to query)\n09/27/11 16:20:28 Return from HandleReq &lt;receive_query_cedar&gt; (handler: 5.115s, sec: 0.001s, payload: 0.000s)\n</pre></div>\n\n\n<p>In this case, a client sent QUERY_STARTD_ADS but then delayed 5s before sending the query classad.  This could be turned into a non-blocking read by using the new facility in daemoncore for registering commands that wait for a payload before calling the handler.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-28 12:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cd01c2fa0fda1ce85fa16157e1ec7ee67ad72b69\">[27452]</a></span>: Documented non-blocking improvements in collector. ===VersionHistory:Complete=== ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2506\" onclick=\"get_ticket_and_populate_wrapper('2506'); return false;\" title=\"collector performance problems at Purdue\">#2506</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-28 12:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/240c4f59e32e35e64c4c5a8c50be68818a66152a\">[27451]</a></span>: Reduce blocking in collector when clients are sluggish to send data. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2506\" onclick=\"get_ticket_and_populate_wrapper('2506'); return false;\" title=\"collector performance problems at Purdue\">#2506</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Aug-04 14:58", "status": "resolved", "created": "2011-Sep-27 16:30", "fixed_version": "2011-Sep-27 16:30", "broken_version": "v070701", "priority": "4", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "purdue", "visibility": "public", "notify": "dan@hep.wisc.edu, tstclair@redhat.com, eje@cs.wisc.edu", "due_date": ""}