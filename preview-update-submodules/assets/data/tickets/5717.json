{"id": 5717, "title": "Ticket #5717: Handle multiple negotiators in a single pool", "description": "<blockquote>\nThe global CMS pool has three negotiators, each matching a third of the machines in their pool. Most of HTCondor is built on the assumption that a pool has only one negotiator active at any time. Thus, the CMS configuration presents problems that we'd like to fix.\n\n<p></p><ul>\n<li>Config knob NEGOTIATOR_NAME to set Name attribute of negotiator ad. Otherwise, negotiator ads overwrite each other in the collector.\n<ul>\n<li>NEGOTIATOR_NAME should also show up in an attribute in the accounting ads, and be part of the hash key.\n</li></ul>\n</li><li>Add options to condor_userprio to specify which negotiator to query.\n<ul>\n<li>If specific negotiator not selected, and multiple negotiator ads returned by collector, contact all negotiators. [WONT CHANGE]\n</li><li>If specific negotiator not selected when querying accounting ads from the collector, show all accounting ads.</li></ul>\n</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2017-May-09 12:50:51 by jfrey:</em> <br/>\n\nOne annoyance with the new default negotiator name is that Condor assumes daemon names are fully-qualified hostnames if they don't have an '@' character. Thus, this doesn't work:\n<div class=\"code\">\n<pre class=\"code\">condor_status -negotiator NEGOTIATOR\n</pre></div>\n\n\n<p>And adding a -name option to condor_userprio would have similar problems:\n</p><div class=\"code\">\n<pre class=\"code\">condor_userprio -name NEGOTIATOR\n</pre></div>\n\n\n<p>The names for CMS's alternate negotiators (NEGOTIATORT1 and NEGOTIATORUS) are similarly affected.\n\n</p><p></p><hr/>\n<em>2017-May-11 13:53:30 by jfrey:</em> <br/>\n\nWe are changing the negotiator naming behavior to match that of master and schedd daemons. The default name is provided by default_daemon_name(). If an alternate name is configured, it's passed through build_valid_daemon_name(). The upshot is that the default negotiator name is the hostname, and an alternate name that doesn't have an '@' will have the hostname appended with an '@'.\n\n<p></p><hr/>\n<em>2017-May-15 16:16:08 by jfrey:</em> <br/>\n\n<strong>Status Update</strong>\n\n<p>Everything in this ticket has been implemented, except for querying of multiple negotiators.\n<code>condor_userprio</code> looks up one negotiator ad for locate. If there are multiple negotiator ads are present and the new -name option isn't used, then <code>condor_userprio</code> will receive one ad. Which ad it receives is undefined.\n\n</p><p>When <code>condor_userprio</code> talks to the negotiator and -name isn't used, it's similarly undefined which negotiator it will talk to.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-20 12:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/599f9605791ad69920bf14fd45029d41df3cb791\">[51755]</a></span>: Docs for handling multiple negotiators in a single pool. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5717\" onclick=\"get_ticket_and_populate_wrapper('5717'); return false;\" title=\"Handle multiple negotiators in a single pool\">#5717</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-26 09:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3ace6915aca19cf631b2a95d36b3aa7a93010012\">[50723]</a></span>: Docs for improved handling of multiple negotiators. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5717\" onclick=\"get_ticket_and_populate_wrapper('5717'); return false;\" title=\"Handle multiple negotiators in a single pool\">#5717</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-26 09:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f863c55ddf7e4496d97001f72074d64df2faa824\">[50722]</a></span>: Add -name to condor_userprio usage message. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5717\" onclick=\"get_ticket_and_populate_wrapper('5717'); return false;\" title=\"Handle multiple negotiators in a single pool\">#5717</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-11 13:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b771ab4fc530030893ee3dc8573f189981febaba\">[50636]</a></span>: Change negotiator naming to match naming for master and schedd. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5717\" onclick=\"get_ticket_and_populate_wrapper('5717'); return false;\" title=\"Handle multiple negotiators in a single pool\">#5717</a></span> The default negotiator name has been changed back to the hostname. Added command line argument -name to set the name. If a name is set via -name, -local-name or NEGOTIATOR_NAME, the value is passed through build_valid_daemon_name()\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-09 13:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b881d4d70df95977623b64c0e7e333b9192d31bd\">[50624]</a></span>: Support accouting ads from multiple negotiators in the collector. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5717\" onclick=\"get_ticket_and_populate_wrapper('5717'); return false;\" title=\"Handle multiple negotiators in a single pool\">#5717</a></span> Accounting ads now have a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NegotiatorName\" title=\"Negotiator Name\">NegotiatorName</a></span> attribute, which is the name of the sending negotiator. If present, this attribute is included in the collector's hash key for the ads.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-09 13:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/abc9c39b06f33aee687ccdfafc15b5f0ee0c50d6\">[50625]</a></span>: Add -name option to condor_userprio. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5717\" onclick=\"get_ticket_and_populate_wrapper('5717'); return false;\" title=\"Handle multiple negotiators in a single pool\">#5717</a></span> Specifies the name of the negotiator, for use when multiple negotiators are sending ads to the same collector.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Jun-20 12:46", "status": "resolved", "created": "2016-Jun-08 16:40", "fixed_version": "2016-Jun-08 16:40", "broken_version": "v080500", "priority": "3", "subsystem": "DaemonsCM", "assigned_to": "jfrey", "derived_from": "#5967", "creator": "jfrey", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}