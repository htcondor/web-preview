{"id": 2564, "title": "Ticket #2564: Machine after hibernation stay in Offline mode only few seconds", "description": "<blockquote>\nDuring hibernation machines with large amounts of physical memory sometimes happens, that the computer normally sent information to condor_collector about hibernation, but after few seconds condor_status show \"online\" information about machine and then machine successfully end hibernation process.\n\n<p>Result:\nMachine is hibernated, but condor_collector will remove information about</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Nov-28 11:17:09 by danb:</em> <br/>\n\nThanks for the patch, Lukas!\n\n<p>The fact that the offline ad may be lost because of a race condition between a hard-coded sleep(10) and the length of time it takes to hibernate is indeed totally unacceptable!  Your patch improves the situation by making the sleep configurable.  Of course, the underlying race condition remains.\n\n</p><p>I think we should go ahead and add your new configuration variable.  However, we should also fix the race condition.  I've made a new ticket suggesting the latter: <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=2669\" onclick=\"get_ticket_and_populate_wrapper('2669'); return false;\" title=\"race condition in hibernation\">#2669</a></span></p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=2669\" onclick=\"get_ticket_and_populate_wrapper('2669'); return false;\" title=\"race condition in hibernation\">#2669</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nrace condition in hibernation</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/481/0001-Added-ability-to-change-the-sleep-interval-before-re.patch\">0001-Added-ability-to-change-the-sleep-interval-before-re.patch</a>\n2137 bytes added by slebodnik on 2011-Oct-19 21:09:00 UTC.\n<br/>\nIn method ResMgr::checkHibernate( void ) after disabling resources there was hard coded 10 seconds sleep. After sleep expiration, it was presumed that the hibernation process was not successful and therefore all resource was re-enabled and collector updated. But hibernation was successful only last longer.\n\n<p>This patch add configuration variable HIBERNATION_WAIT_INTERVAL to override default value. And also add debug to find out information about early interruption of hibernation process.\n\n</p><p>Patch was created from latest 7.6 version and did not include documentation changes.\n<br/>\n</p></li></ul>\n</blockquote></body></html>", "check_ins": "", "type": "defect", "last_change": "2013-Jan-08 12:57", "status": "review", "created": "2011-Oct-19 15:41", "fixed_version": "2011-Oct-19 15:41", "broken_version": "v070200", "priority": "3", "subsystem": "Daemons", "assigned_to": "tannenba", "derived_from": "", "creator": "slebodnik", "rust": "", "customer_group": "users", "visibility": "public", "notify": "lukas.slebodnik@intrak.sk,tannenba@cs.wisc.edu,tstclair@redhat.com", "due_date": ""}