{"id": 4789, "title": "Ticket #4789: condor_ssh_to_job_shell_setup may broken for interactive jobs on Macs", "description": "<blockquote>\nFrom batlab-support #38868:\n\n<p></p><div class=\"verbatim\">\n<pre>When ssh'ing to exec-19.batlab.org, I got this error:\n\n[moate@submit-3 ~]$ nmi_ssh moate_submit-3.batlab.org_1418651787_28433\n/usr/local/condor/libexec/condor_ssh_to_job_shell_setup: line 16: /bin/grep:\nNo such file or directory\nWelcome to slot1@exec-19.batlab.org!\nYour condor job is running with pid(s) 37910.\n\nHere's the relevent shell code:\n15 # kill the dummy sleep job if this is an interactive job\n16 if /bin/grep -q '^InteractiveJob = true'\n\"${_CONDOR_SCRATCH_DIR}/.job.ad\"; then\n17  if [ \"${_CONDOR_JOB_PIDS}\" != \"\" ]; then\n18    /bin/kill \"${_CONDOR_JOB_PIDS}\" 2&gt;/dev/null\n19        _CONDOR_JOB_PIDS=\"\"\n20  fi\n21 fi\nOn the MAC platforms, grep is at /usr/bin/grep.\n\nNot sure what the impact of this is, if any.\n</pre></div>\n\n\n<p>Is there some reason to believe that grep won't be in the PATH?</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Feb-26 11:02:30 by moate:</em> <br/>\n\nStill having this issue on the few MACs for which nmi_ssh is functioning.\n\n<p></p><hr/>\n<em>2015-Feb-26 14:36:00 by tannenba:</em> <br/>\n\nShould now be fixed for the next release.  Thanks for the ping, Moate.\nAssigning to ToddM for code review since fix went into the stable series.\nCode review will likely take 30 seconds....\n\n<p></p><hr/>\n<em>2015-Feb-26 14:38:34 by tannenba:</em> <br/>\n\nSomething to keep in mind for the code review: script <code>condor_ssh_to_job_shell_setup</code> runs as priv_user_final, not as root or condor, so privilege escalation/path sanitation issues not a concern...\n\n<p></p><hr/>\n<em>2015-Feb-26 15:22:14 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>It would be safer to prepend to $PATH (defense-in-depth), rather than append, and better to check if they exist rather than assume, but there's nothing actually wrong with this.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Mar-03 10:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/762b40966ca2644586725511806056111a5dd322\">[43495]</a></span>: very minor formatting change to 8.2.8 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4789\" onclick=\"get_ticket_and_populate_wrapper('4789'); return false;\" title=\"condor_ssh_to_job_shell_setup may broken for interactive jobs on Macs\">#4789</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-26 14:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9fe8893faed0d19d10b713847337db7790178686\">[43468]</a></span>: Version history entry for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4789\" onclick=\"get_ticket_and_populate_wrapper('4789'); return false;\" title=\"condor_ssh_to_job_shell_setup may broken for interactive jobs on Macs\">#4789</a></span>. No additional documentation needed.  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-26 14:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f8ecdd691a287665dd35637e74903ac9e9d23591\">[43467]</a></span>: Remove /bin/grep not found warning upon ssh_to_job onto MacOS. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4789\" onclick=\"get_ticket_and_populate_wrapper('4789'); return false;\" title=\"condor_ssh_to_job_shell_setup may broken for interactive jobs on Macs\">#4789</a></span>  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Feb-26 15:26", "status": "resolved", "created": "2014-Dec-18 11:27", "fixed_version": "2014-Dec-18 11:27", "broken_version": "", "priority": "4", "subsystem": "DaemonsExecNode", "assigned_to": "tannenba", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "moate@sc.wisc.edu, tlmiller@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}