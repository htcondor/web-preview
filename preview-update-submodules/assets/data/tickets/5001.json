{"id": 5001, "title": "Ticket #5001: Automatically update proxy expiration attribute on renewal", "description": "<blockquote>\nRight now, when we update the proxy associated with a job in queue, it is a two step process:\n<ol>\n<li>Update the remote proxy (using the <code>Schedd::refreshGSIProxy</code> python binding).\n</li><li>Edit the job's classad to reflect the new value of the <code>x509userproxyexpiration</code> attribute.\n</li></ol>\n\n<p>Because this is two separate API calls, the process is not atomic.  Further, it is a \"gotcha\" to using the <code>refreshGSIProxy</code> method - naively, a caller would assume all related attributes are updated too.\n\n</p><p>Can <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> update be done schedd side along with the proxy update?</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Apr-13 08:02:19 by bbockelm:</em> <br/>\n\nCode to reference:\n\n<p><a class=\"external\" href=\"https://github.com/dmwm/CRABServer/blob/master/src/python/TaskWorker/Actions/Recurring/RenewRemoteProxies.py#L101\">https://github.com/dmwm/CRABServer/blob/master/src/python/TaskWorker/Actions/Recurring/RenewRemoteProxies.py#L101</a>\n\n</p><p></p><hr/>\n<em>2015-Apr-13 11:03:02 by jfrey:</em> <br/>\n\nYes, we should make this change. It should be easy.\n\n<p></p><hr/>\n<em>2015-Apr-13 17:34:32 by jfrey:</em> <br/>\n\nShould we also update the x509UserProxyExpiration attribute when the proxy file on disk has been updated (i.e. local submission and the user updates the file in place)?\n\n<p></p><hr/>\n<em>2015-Apr-13 19:43:11 by bbockelm:</em> <br/>\n\nQualitatively, the patch looks fine to me (did not test).\n\n<p>In terms of having HTCondor pick up updates automatically - is that easy?  I thought we didn't have the code infrastructure to do this right now...\n\n</p><p></p><hr/>\n<em>2015-Apr-14 09:40:54 by jfrey:</em> <br/>\n\nThe shadow and gridmanager check periodically for a renewed proxy, and could push an update of the expiration time to the schedd. Otherwise, there's no check. I'm leery of automatically updating the expiration time in only some situations.\n\n<p></p><hr/>\n<em>2015-Apr-14 09:48:44 by bbockelm:</em> <br/>\n\nSounds good.  I would also prefer to have the expiration time always updated (I was just curious about implementation costs).\n\n<p></p><hr/>\n<em>2015-Apr-29 15:20:21 by bbockelm:</em> <br/>\n\nPer phone call -\n\n<p>Jaime will commit this patch and do any other simple cases before 8.3.6 release.\n\n</p><p>Any remaining work items will be bumped to a separate ticket.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/874/proxy_update.patch\">proxy_update.patch</a>\n838 bytes added by jfrey on 2015-Apr-13 22:33:10 UTC.\n<br/>\nPatch to update x509UserProxyExpiration in job ad when updated proxy is forwarded to schedd via a CEDAR command.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-12 12:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/91795f333ee5eef154c8580ec45c6ba859c85bd6\">[44824]</a></span>: minor 8.3.6 version history item edit <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5001\" onclick=\"get_ticket_and_populate_wrapper('5001'); return false;\" title=\"Automatically update proxy expiration attribute on renewal\">#5001</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-11 15:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9b881d0a815bc98dddbd0e778727f2d6ed2e2427\">[44818]</a></span>: Docs for updating x509UserProxyExpiration on proy renewal. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5001\" onclick=\"get_ticket_and_populate_wrapper('5001'); return false;\" title=\"Automatically update proxy expiration attribute on renewal\">#5001</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-11 15:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/98514936e1a3e4e6f1966661ec99a674d6c3a643\">[44817]</a></span>: Update proxy expiration attribute when new proxy delegated. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5001\" onclick=\"get_ticket_and_populate_wrapper('5001'); return false;\" title=\"Automatically update proxy expiration attribute on renewal\">#5001</a></span> When a client provides an updated X509 proxy for a job via one of the schedd's CEDAR commands, update the x509UserProxyExpiration attribute in the job ad.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-May-14 16:34", "status": "resolved", "created": "2015-Apr-13 08:01", "fixed_version": "2015-Apr-13 08:01", "broken_version": "v080000", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "#4490", "creator": "bbockelm", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}