{"id": 2173, "title": "Ticket #2173: shared spooled executables fail to be removed", "description": "<blockquote>\nWhen the Owner attribute is set via +Owner=\"whatever\" in the submit file, the Owner attribute is not set in the cluster ad.  This results in failure to remove shared spooled executables when the cluster is destroyed.  The schedd attempts to remove the wrong filename.  For example, it attempts to remove \"spool/exe--CmdMD5-e362ddffeb559baea74611ffda321664\" instead of \"exe-dan-CmdMD5-e362ddffeb559baea74611ffda321664\".\n\n<p>I believe this issue began some time in the 7.5 series, but I have not confirmed.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-May-19 12:56:08 by danb:</em> <br/>\n\nThis problem could be resolved by moving the call to ickpt_share_try_removal() from ClusterCleanup() to DestroyProc().  This might also correctly handle the case where the Owner attribute is different for different jobs in a cluster.  The down side is that this will result in more file operations, which may degrade performance if the spool directory is on a slow filesystem.\n\n<p>A different solution would be to decree that the Owner attribute <em>must</em> be set in the cluster ad and is not allowed to be different for different jobs in the same cluster.  I'm not aware of any use-case where the Owner attribute varies between jobs in a cluster.\n\n</p><p></p><hr/>\n<em>2011-May-19 17:53:24 by danb:</em> <br/>\n\nDoing the file cleanup in DestroyProc() did not work, because the link count on the shared file is not decreased until the cluster is removed.  For the stable series, I did not feel inclined to decree that Owner cannot vary between jobs in a cluster.  Therefore, I made a very specific patch that just ensures the common case where Owner is the same for all jobs in a cluster correctly cleans up shared executables.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-19 17:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/138ad8975715b2d0f91d827dd61cf3679876f6a0\">[21923]</a></span>: Fixed problem cleaning up shared spooled executables. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2173\" onclick=\"get_ticket_and_populate_wrapper('2173'); return false;\" title=\"shared spooled executables fail to be removed\">#2173</a></span> ===VersionHistory=== If Owner was not set in the cluster ad, shared spooled executables were not correctly cleaned up.  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-May-19 17:53", "status": "resolved", "created": "2011-May-18 17:04", "fixed_version": "2011-May-18 17:04", "broken_version": "", "priority": "4", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "isfiligoi@ucsd.edu,dan@hep.wisc.edu,burt@fnal.gov,jfrey@cs.wisc.edu,jdost@ucsd.edu", "due_date": ""}