{"id": 6941, "title": "Ticket #6941: add a json output option to the userlog and event log", "description": "<blockquote>\nWe should have a key/value form for the event log and userlog. The current XML form is sort of that, but hard much harder to parse than simple key/value form would be.  Json would be a better choice, and since we already have classad -&gt; json unparser, this would be only a small amount of work.</blockquote>", "remarks": "<blockquote>\n<em>2019-May-30 11:30:23 by johnkn:</em> <br/>\n\nTwo options are added to the configuration for the userlog and for the eventlog.\nsee <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6936\" onclick=\"get_ticket_and_populate_wrapper('6936'); return false;\" title=\"job event log timestamps have no year, can appear to go backwards\">#6936</a></span> for the introduction of these configuration knobs.\n\n<p>Two knobs will be added, but not documented that allows a system administrator to opt in to ISO 8601 dates and/or UTC for all user job logs and for the global event log. These knobs will be\n\n</p><p></p><div class=\"snip\">\n<pre class=\"sniplabel\">config fragment</pre>\n<pre class=\"snip\"># this controls format of the EventLog\nEVENT_LOG_FORMAT_OPTIONS=UTC,ISO_DATE,SUB_SECOND\n# this sets default format options for job's Log and DagmanLog\nDEFAULT_USERLOG_FORMAT_OPTIONS=UTC,ISO_DATE,SUB_SECOND\n</pre></div>\n\npermitted values for these two knobs will be zero or one of these formatting case-insensitive values:\n\n<p></p><ul>\n<li>JSON - format events as json\n</li><li>XML - format events as xml\n</li><li>LEGACY - turn off UTC, ISO_DATE and SUB_SECOND flags so that older versions of HTCondor can read the userlog and/or eventlog.\n</li></ul>\n\n<p>and zero or more of the options case-insensitive flag values:\n\n</p><p></p><ul>\n<li>UTC - print the date and time as UTC with a trailing Z as the timezone\n</li><li>ISO_DATE - print the date as YYYY-MM-DD\n</li><li>SUB_SECOND - print a fractional seconds value\n</li></ul>\n\n<p>These options may be prefixed by a ! to turn the option off, although at present there is no need to do this because all options are set to off by default in the code.  In the 8.9 series, we plan to change the compile time default to <code>UTC,ISO_DATE</code> and at that time, an admin can go back to the older date/time format by configuring <code>!UTC,!ISO_DATE</code> or by configuration <code>LEGACY</code>\n\n</p><p></p><hr/>\n<em>2019-May-30 11:43:44 by johnkn:</em> <br/>\n\nCurrently, there is no way for the user to opt in to these formatting options for their own logs. the options can only be set by the schedd/shadow configuration.\n\n<p>There is a hack to allow the user to turn on json userlog.  If\nUserLogUseXML=2, then Json will be enabled rather than XML.  This hack is not supported by condor_submit however. so +UserLogUseXML must be used to get this behavior. this work will be <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=7082\" onclick=\"get_ticket_and_populate_wrapper('7082'); return false;\" title=\"User should be able to opt in to UTC, ISO_DATE, etc for userlog\">#7082</a></span></p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=7082\" onclick=\"get_ticket_and_populate_wrapper('7082'); return false;\" title=\"User should be able to opt in to UTC, ISO_DATE, etc for userlog\">#7082</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nUser should be able to opt in to UTC, ISO_DATE, etc for userlog</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-30 12:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b4319c7cded821e03ce496ee275f1288c16c6ec2\">[57008]</a></span>: doc and version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6941\" onclick=\"get_ticket_and_populate_wrapper('6941'); return false;\" title=\"add a json output option to the userlog and event log\">#6941</a></span>. version history and minor bugfix for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7044\" onclick=\"get_ticket_and_populate_wrapper('7044'); return false;\" title=\"param calls in submit_utils should happen only when used by tools\">#7044</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Mar-11 10:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b78b7f80d6657504b9e904c49697d3220572bcf4\">[56334]</a></span>: Add SUB_SECOND and JSON format options to the event log and userlog. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6941\" onclick=\"get_ticket_and_populate_wrapper('6941'); return false;\" title=\"add a json output option to the userlog and event log\">#6941</a></span>  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-May-30 13:02", "status": "resolved", "created": "2019-Mar-05 14:25", "fixed_version": "2019-Mar-05 14:25", "broken_version": "", "priority": "3", "subsystem": "", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}