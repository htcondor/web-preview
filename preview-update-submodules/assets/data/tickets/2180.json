{"id": 2180, "title": "Ticket #2180: Have the safe_open library be an external", "description": "<blockquote>\nCondor currently contains a modified copy of the safe_open library by the Mist group directly inside the condor_utils library.  This should be extracted to be an external, both to make updating the code easier if Mist releases new versions, and also more easily share any improvements Condor may make to the code.\n\n<p>The primary difficulty here is Condor weakened the security provided by safe_open for its own purposes.  Making safe_open \"safe\" again may break something in Condor, which will require careful testing.\n\n</p><p>Milestone 1: Build safe_open as a separate library from condor_utils and test its incorporation into Condor.\n\n</p><p>Milestone 2: Tweak safe_open as Windows has a different security model that eliminates many of the holes safe_open protects against in the first place.\n\n</p><p>Milestone 3: Make safe_open an externals and make sure the build process does not break.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Jul-14 13:40:27 by ziliang:</em> <br/>\n\nMilestones 1 and 2 completed.  Milestome 3 is halfway completed.  Full extraction as an external is deferred until I finish fixing an architectural problem inside the dprintf code.\n\n<p></p><hr/>\n<em>2011-Sep-20 21:02:40 by bbockelm:</em> <br/>\n\nWhat happens to us folks who use PROPER builds?  How will we get this library?\n\n<p></p><hr/>\n<em>2011-Sep-20 21:11:37 by ziliang:</em> <br/>\n\nThe library is living as a separate folder inside of the src dir right now.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-09 15:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/960c3876240dbf7f5193ad96f15cfa373bc62f1f\">[26698]</a></span>: Follow symlinks in access_euid(). <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span> Change safe_fopen_wrapper() to safe_fopen_wrapper_follow() in this function, as it's supposed to traverse symlinks for its checks. Without this change, Condor config files can't be symlinks.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-13 13:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5ec2ea18e988fe0f3c057697a29a16be44d67845\">[22446]</a></span>: Delete condor_open.cpp as it is no longer needed with the safefile library extracted. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-12 14:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ce76076632ee5f72930844778c7c7b3e09e09a9b\">[22427]</a></span>: Add build-aux folder to safefile directory. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-08 14:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/600a29c2b1706182ecfbee2c30a935407ddbc394\">[22386]</a></span>: Add extern c back into safe_id_range_list header file. Change permissions to +x for safefile configure script. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-06 16:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5e04d60572844a70fde7768f398eb31f279275cf\">[22374]</a></span>: Forgot to add configure script. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-06 15:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/884b56caca28107ef7221003db9ec40c449cc520\">[22372]</a></span>: Run configure on safefile files on Unix builds to make safefile replacement more drop-in. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-01 16:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/69a7b5bf523e79f89faf021bf16ac2acf75ed905\">[22357]</a></span>: Fix all safe_fopen callsites. New rules for safefile function usage. Use safe_open/fopen_wrapper_follow instead of just _wrapper if you wish to access a file through a symbolic link. Do not attempt to create a file through a symbolic link. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-22 15:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/54e1e8352a582e8bdb6a6e7fc2974bc7ee7897ad\">[22272]</a></span>: Fix errno modification in safe_open_no_create to fix opening of log files on Windows. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-16 16:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f24523918ff9cafc5c03e7fce57276eaa4e6a395\">[22217]</a></span>: Remove skip_whitespace_const hack in header. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-16 15:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/46e4cade6ae44af08f6986792d87c2e8b41b90ec\">[22216]</a></span>: Add safefile directory to include directory list. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-16 15:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/269840005c48326467c2d96dd921dd07a4d4cae6\">[22215]</a></span>: Add safefile directory under src. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-02 16:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a75b2407091583da0bca4f067cb84b4b67ef5f2f\">[22095]</a></span>: Replace more safe_open_wrapper callsites with safe_open_wrapper_follow. Remove safefile implementation in condor_open. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-02 13:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0d2b9ba8f096d1c514ae664f64bdb8e87d61cd89\">[22087]</a></span>: Replace all calls to safe_open_wrapper with safe_open_wrapper_follow to deal with symbolic links. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-26 13:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7655d41224a3c0b2c62641d75855b00a032e8409\">[21994]</a></span>: Have checkpoint libraries also include safefile code. Tweak privsep to also use safefile implementation instead of version copypasted into its safe.unix file. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-25 15:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d412aec985958b659a786993a476350d9b75b300\">[21982]</a></span>: More hacking of cmake files for testing standalone safefile library. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-23 14:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f8bab72eae1a8f2f626bee395bf51461e6da6a4e\">[21955]</a></span>: Test safe_open library as a separate library instead of embedding it inside the util library. Ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2180\" onclick=\"get_ticket_and_populate_wrapper('2180'); return false;\" title=\"Have the safe_open library be an external\">#2180</a></span>.  (By Ziliang Guo )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Sep-20 21:11", "status": "defer", "created": "2011-May-20 12:40", "fixed_version": "2011-May-20 12:40", "broken_version": "v070400", "priority": "3", "subsystem": "Libs", "assigned_to": "ziliang", "derived_from": "#2476", "creator": "ziliang", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}