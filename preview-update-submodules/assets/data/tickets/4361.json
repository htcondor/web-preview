{"id": 4361, "title": "Ticket #4361: DAGMan node status file (and other things?) don't work on Windows", "description": "<blockquote>\nThe job_dagman_abort-final-A, job_dagman_abort-final-B, and job_dagman_cycle-A tests are failing on Windows 8 because the rename of the temporary node status file to the \"real\" node status file fails.  TJ says that on Windows, the semantics are that a rename over an existing file always fails.  (We just discovered this because more DAGMan tests were recently turned on on Windows 8.)\n\n<p>This would also apply to the dot file, because we do the same \"write to temp file, then rename\" procedure for that.\n\n</p><p>I'm not quite sure whether to aim for 8.1.6 or 8.2.0 with the fix for this -- I guess it depends on how big a change it is...</p></blockquote>", "remarks": "<blockquote>\n<em>2014-May-25 18:08:58 by wenger:</em> <br/>\n\nCreated V8_2-gittrac_4361-branch for this.\n\n<p></p><hr/>\n<em>2014-May-29 16:38:22 by wenger:</em> <br/>\n\nI'm going to put the target back to 8.2.0, because the relevant tests are still failing.  I think the test failures are a test problem, rather than a reflection of a problem in the DAGMan functionality, but it's hard to be 100% sure the actual bug is fixed until I get the tests to actually work on Windows...\n\n<p></p><hr/>\n<em>2014-May-30 09:49:18 by wenger:</em> <br/>\n\nThe job_dagman_abort-final-A, job_dagman_abort-final-B, and job_dagman_cycle-A tests are still failing on Windows.\n\n<p>I'm getting errors like this in the relevant nodes.log files:\n\n</p><p></p><pre>  012 (008.000.000) 05/29 14:54:16 Job was held.\n          File 'C:\\condor\\execute\\dir_27232\\userdir\\condor_tests\n          \\./job_dagman_abort-final-A-nodeE.pl' is missing or not executable\n          Code 6 Subcode 13\n  ...\n</pre>\n\n<p>The reason for this is at least partly that pretty much all of the .pl files in condor_tests have permissions 644 on Windows.  But they don't <strong>all</strong> fail, interestingly enough.  My current guess is that the scheduler universe ones fail but the vanilla universe ones succeed.  (I wonder if something in vanilla universe makes sure the executable really <strong>is</strong> executable before trying to run it.)\n\n</p><p></p><hr/>\n<em>2014-Jun-03 09:15:01 by wenger:</em> <br/>\n\nOkay, yes, I temporarily changed the relevant test submit files from scheduler to vanilla universe, and things work...\n\n<p></p><hr/>\n<em>2014-Aug-07 11:47:03 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong> by zmiller:  Looks good</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=4394\" onclick=\"get_ticket_and_populate_wrapper('4394'); return false;\" title=\"Scheduler universe doesn't work right in tests on Windows\">#4394</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nScheduler universe doesn't work right in tests on Windows</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jun-03 14:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/66b55d9b16d21db99a4b7d344fb22789c7a0708b\">[40321]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4361\" onclick=\"get_ticket_and_populate_wrapper('4361'); return false;\" title=\"DAGMan node status file (and other things?) don't work on Windows\">#4361</a></span>: Added version history item to 8.2.1.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jun-03 10:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bf9595173211d054ecc77eca246dba62263164ec\">[40315]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4361\" onclick=\"get_ticket_and_populate_wrapper('4361'); return false;\" title=\"DAGMan node status file (and other things?) don't work on Windows\">#4361</a></span>: Fixed related DAGMan tests that were failing on Windows because of test problems (not DAGMan functionality).  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-May-29 13:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a5aaf7d0b16282f63a106ad28fbccac9047beb53\">[40263]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4361\" onclick=\"get_ticket_and_populate_wrapper('4361'); return false;\" title=\"DAGMan node status file (and other things?) don't work on Windows\">#4361</a></span>: Added comments explaining tolerant_unlinks before renames; added tolerant unlink when renaming old rescue DAG files.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-May-29 13:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/49a5c52d1d99822c38e743f78836199b0acf2ffa\">[40262]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4361\" onclick=\"get_ticket_and_populate_wrapper('4361'); return false;\" title=\"DAGMan node status file (and other things?) don't work on Windows\">#4361</a></span>: Fixed .pl files that don't work on Windows -- Windows doesn't like leading blank line or space between '#!' and '/usr/bin/env'.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-May-25 18:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/470298bf65496c0066a589a5c6163342a59e0514\">[40226]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4361\" onclick=\"get_ticket_and_populate_wrapper('4361'); return false;\" title=\"DAGMan node status file (and other things?) don't work on Windows\">#4361</a></span>: Added what should be a fix for this; need to do a build/test on Windows to verify it...  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Aug-07 11:47", "status": "resolved", "created": "2014-May-13 11:19", "fixed_version": "2014-May-13 11:19", "broken_version": "v080105", "priority": "1", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu", "due_date": ""}