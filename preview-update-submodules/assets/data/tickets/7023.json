{"id": 7023, "title": "Ticket #7023: Setting maximum history log file too large causes schedd crash", "description": "<blockquote>\nI suddenly have a large population of jobs with extremely large arguments and environment variable strings that also happen to execute quickly. I have historically kept long history logs on the head nodes. My previous settings enabled 100 days of history with no file greater than 1GB in size. In practice, a day's worth of history is never near 1GB. It's just there to go above the default 20MB decisively.\n\n<p></p><div class=\"verbatim\">\n<pre>ENABLE_HISTORY_ROTATION = True\nROTATE_HISTORY_DAILY    = True\nMAX_HISTORY_LOG         = 1000000000\nMAX_HISTORY_ROTATIONS   = 100\n</pre></div>\n\n\n<p>But these settings suddenly became problematic because these jobs were creating 10 1GB files per day! So I tried\n\n</p><p></p><div class=\"verbatim\">\n<pre>MAX_HISTORY_LOG         = 10000000000\nMAX_HISTORY_ROTATIONS   = 7\n</pre></div>\n\n\n<p>and the schedd crashed hard!\n\n</p><p></p><div class=\"verbatim\">\n<pre>05/01/19 14:00:46 (pid:3570401) Got SIGHUP.  Re-reading config files.\n05/01/19 14:00:46 (pid:3570401) Loading classad userMap 'ValidSearchTags' ts=1556737202 from /etc/condor/accounting/valid_tags\n05/01/19 14:00:46 (pid:3570401) Loading classad userMap 'ValidSearchUsers' ts=1556737201 from /etc/condor/accounting/valid_users\n05/01/19 14:00:46 (pid:3570401) ERROR \"MAX_HISTORY_LOG in the condor configuration is out of bounds for an integer (10000000000).  Please set it to an integer in the range -214\n7483648 to 2147483647 (default 20971520).\" at line 2202 in file /slots/20/dir_547223/userdir/.tmploK3AG/BUILD/condor-8.9.1/src/condor_utils/condor_config.cpp\n05/01/19 14:00:46 (pid:3570401) Cron: Killing all jobs\n05/01/19 14:00:46 (pid:3570401) CronJobList: Deleting all jobs\n05/01/19 14:00:46 (pid:3570401) Cron: Killing all jobs\n05/01/19 14:00:46 (pid:3570401) CronJobList: Deleting all jobs\n</pre></div>\n\n\n<p>It seems to me that the schedd should do something better than completely crash when the value for MAX_HISTORY_LOG is out of bounds.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-May-01 16:01:11 by tpdownes:</em> <br/>\n\nWhat I'm trying to do is reasonably guarantee that I always retain a day's worth of history before the nightly cronjob that rsyncs the data off. By setting the file size to be very large, it gives me a good chance of doing that while also having the max rotations be set low.\n\n<p></p><hr/>\n<em>2019-May-15 13:17:58 by tannenba:</em> <br/>\n\nGregT is now able to reproduce this</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jul-02 14:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/27c6724799af78ca09b2675a0a4191601a7b5807\">[57280]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7023\" onclick=\"get_ticket_and_populate_wrapper('7023'); return false;\" title=\"Setting maximum history log file too large causes schedd crash\">#7023</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-13 16:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2c99f21eae8a2da5aebfed8337dd70882d29e0bb\">[57152]</a></span>: Allow schedd history files to be &gt; 2Gb <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7023\" onclick=\"get_ticket_and_populate_wrapper('7023'); return false;\" title=\"Setting maximum history log file too large causes schedd crash\">#7023</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Jul-02 14:20", "status": "resolved", "created": "2019-May-01 15:55", "fixed_version": "2019-May-01 15:55", "broken_version": "v080901", "priority": "2", "subsystem": "", "assigned_to": "gthain", "derived_from": "", "creator": "tpdownes", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "", "due_date": ""}