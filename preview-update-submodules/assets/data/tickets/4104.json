{"id": 4104, "title": "Ticket #4104: Really large DAG test (DAG-level NOOP jobs) are too slow", "description": "<blockquote>\n(I think this has been true for a while, but I just looked at it more carefully.)\n\n<p>Anyhow, the \"really large DAG\" test uses almost all DAG-level NOOP jobs, which means that the jobs aren't even really submitted to Condor (DAGMan just writes some fake events to the appropriate log file(s)).\n\n</p><p>Anyhow, even with the DAG-level NOOP jobs, DAGMan only seems to be able to \"run\" about five jobs a second, at best, which seems awfully slow.  (I'm pretty sure this is significantly slower than it used to be, but unfortunately I don't have specific records.)  Also, this is running with the log file on local disk, so it's not a matter of AFS slowness or something like that.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Dec-06 16:51:00 by wenger:</em> <br/>\n\nOkay, it's the condor_fsync() when writing events that is the problem.  Pretty reliably, about every fifth to tenth one takes about a whole second(!).\n\n<p></p><hr/>\n<em>2013-Dec-09 10:13:30 by wenger:</em> <br/>\n\nOh, yeah -- this is on RHEL 6.4.  I wonder if RHEL 5 didn't have this problem (or at least it wasn't as bad) -- if that's true, it would explain why the test used to be faster...  (Unfortunately, I don't remember whether the slowdown happened at the same time my desktop machine was switched to RHEL 6.)\n\n<p></p><hr/>\n<em>2013-Dec-09 17:51:29 by wenger:</em> <br/>\n\nOkay, I changed the create_large_dag script to turn off fsyncing of the user log file(s).  That at least fixes things for the test, although it doesn't fix the underlying problem.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Dec-09 15:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6e177fce04a8c37b23006754cccacf5fbfbd9c53\">[38961]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4104\" onclick=\"get_ticket_and_populate_wrapper('4104'); return false;\" title=\"Really large DAG test (DAG-level NOOP jobs) are too slow\">#4104</a></span>: Turned off user event log file syncing for \"large\" and \"really large\" DAG tests -- makes them run ~20 times faster.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Aug-04 11:57", "status": "resolved", "created": "2013-Dec-06 10:20", "fixed_version": "2013-Dec-06 10:20", "broken_version": "v080102", "priority": "2", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu", "due_date": ""}