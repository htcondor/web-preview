{"id": 2067, "title": "Ticket #2067: monitor PSS memory usage by jobs", "description": "<blockquote>\nCMS has requested that batch systems provide better measures of memory usage than the traditional RSS and VSIZE.\n\n<p><a class=\"external\" href=\"http://elmer.web.cern.ch/elmer/memory.html\">http://elmer.web.cern.ch/elmer/memory.html</a>\n\n</p><p>PSS (proportional set size) has been specifically requested.  This divides the virtual memory of the process by the number of processes sharing that memory.  PSS is available in /proc/&lt;pid&gt;/smaps as of RHEL5/SL5.\n\n</p><p>There are still some deficiencies with PSS, if one is using it as the sole means of estimating memory requirements, but these are not new problems.  These deficiencies also exist with VSIZE.  They are:\n\n</p><p></p><ol>\n<li>some of the memory counted in PSS could be swapped out without significantly degrading performance\n\n<p></p></li><li>large memory mapped files add to the virtual memory size but aren't necessarily required to be resident in memory for good performance\n\n<p></p></li><li>memory in the filesystem cache needed for good performance of the application is not accounted for\n</li></ol>\n\n<p>In other words, PSS and VSIZE are neither an upper or lower bound on the working set size of the application in the general case.\n\n</p><p>In addition, there is an awkwardness in the interpretation of PSS when there are multiple jobs on the machine.  In some situations, one might want to just adjust for the sharing between processes in the same job, not sharing between all processes on the system.  PSS adjusts for system-wide sharing, not within-job sharing.\n\n</p><p>Despite these shortcomings, I think we should implement reporting of PSS.  PSS provides information not available in existing metrics reported by Condor.  The Linux community considered this information useful enough to add PSS reporting to the kernel.  The LHC community requested batch systems to pass this information along.  So far, none have.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Apr-26 16:08:01 by danb:</em> <br/>\n\nThis ticket was stalled until now due to other tasks that came up.\n\n<p></p><hr/>\n<em>2011-May-04 06:40:17 by bbockelm:</em> <br/>\n\nHi Dan,\n\n<p>Any progress?\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2011-May-04 09:41:39 by danb:</em> <br/>\n\nDelayed, but in progress.  Hope to finish soon.\n\n<p></p><hr/>\n<em>2011-May-17 12:29:27 by danb:</em> <br/>\n\nI committed a patch that reports PSS in the job attribute <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ProportionalSetSizeKb\" title=\"Proportional Set Size Kb\">ProportionalSetSizeKb</a></span>.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-28 09:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/49b5146145da4a356b6cb36aaa709b1c26dad8fc\">[26155]</a></span>: Edit and place into alphabetical order definition of new attribute <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ProportionalSetSizeKb\" title=\"Proportional Set Size Kb\">ProportionalSetSizeKb</a></span>. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2067\" onclick=\"get_ticket_and_populate_wrapper('2067'); return false;\" title=\"monitor PSS memory usage by jobs\">#2067</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-17 12:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ee1a1840bf45c156594a4dc35cf901328889d2cd\">[26104]</a></span>: Documented <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ProportionalSetSizeKb\" title=\"Proportional Set Size Kb\">ProportionalSetSizeKb</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2067\" onclick=\"get_ticket_and_populate_wrapper('2067'); return false;\" title=\"monitor PSS memory usage by jobs\">#2067</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-17 12:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/64fe1ce5afe910da9575fc0287c6b89fe0c85f02\">[21875]</a></span>: Add rounding of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ProportionalSetSizeKb\" title=\"Proportional Set Size Kb\">ProportionalSetSizeKb</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2067\" onclick=\"get_ticket_and_populate_wrapper('2067'); return false;\" title=\"monitor PSS memory usage by jobs\">#2067</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-13 21:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d308ebcfa8387e56c184ce5075cb79a388b7c784\">[21872]</a></span>: Added monitoring of proportional set size (PSS). <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2067\" onclick=\"get_ticket_and_populate_wrapper('2067'); return false;\" title=\"monitor PSS memory usage by jobs\">#2067</a></span> The advantage of this over VSIZE is that the sum of PSS across the processes in a job does not double-count pages that are shared between those processes.  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-May-17 12:29", "status": "resolved", "created": "2011-Apr-18 10:47", "fixed_version": "2011-Apr-18 10:47", "broken_version": "", "priority": "2", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "matt@cs.wisc.edu, tstclair@redhat.com, burt@fnal.gov", "due_date": "20110510"}