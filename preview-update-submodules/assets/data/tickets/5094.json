{"id": 5094, "title": "Ticket #5094: More improvements for preemption of partitionable slots", "description": "<blockquote>\nSome improvements to ALLOW_PSLOT_PREEMPTION that weren't ready in time for 8.3.6:\n\n<p></p><ul>\n<li>When using CONSUMPTION_POLICY, match dslots to only one request\n</li><li>Work with SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION=True\n<ul>\n<li>Startd didn't properly escape child claim ids that contain quotes\n</li><li>Assume startd understands extra claim ids if no version info\n</li></ul>\n</li><li>Don't do pslot preemption check if NEGOTIATOR_CONSIDER_PREEMPTION=False\n</li><li>Only send pslot claim id in MATCH_INFO message\n</li><li>Allow pslot preemption to be enabled just from negotiator's config file</li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5207\" onclick=\"get_ticket_and_populate_wrapper('5207'); return false;\" title=\"Backwards compatibility for pslot preemption\">#5207</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nBackwards compatibility for pslot preemption</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-20 12:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c750b50f52d6c1203c287ac72690cbb8a1a3d504\">[45345]</a></span>: 8.3.7 version history item, defn of new knob, and defns of new machine <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> attributes for pslot preemption <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-17 12:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c1a0deffc109917778480eeba54007faa9c33916\">[45337]</a></span>: minor formatting of 8.3.7 doc <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-07 15:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/80a1aa66cdca46fd359d4ab1f86e575ca0ce2101\">[45245]</a></span>: Update docs for ALLOW_PSLOT_PREEMPTION to reflect changes in 8.3.7. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-19 13:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1e70b419203a0e6391d4146df8a189f9ff7c8e2a\">[45108]</a></span>: Fix job_local_resources test to expect rollup attributes. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-19 11:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/84b3f6f0826f3b5c9811dec02e03d8bd8751d499\">[45101]</a></span>: Capitalize 'Child' in startd rollup attribute names. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-18 13:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/58fe3f922d2a9f440f6bbe2202a8058ddf18e93d\">[45098]</a></span>: Startd and schedd always allow pslot preemption. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> Allow pslot preemption to be enabled just by setting ALLOW_PSLOT_PREEMPTION for the negotiator. The schedd now always signals that it can accept multiple claim ids. The startd ad always includes child dslot rollup information. This can be suppressed\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/728685246fcea1e3e551b3a94ff9687886ba5559\">[45081]</a></span>: fix fedora warning for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span> Conflicts: src/condor_q.V6/queue.cpp Committer: Jaime Frey  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d901d2fbdbeb5d1abf923061bd2006951fb9817a\">[45080]</a></span>: Minor pslot preemption cleanup in the negotiator. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span> Ignore the extra claim ids when clearing entries in the claimIds map and sending MATCH_INFO to the startd.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/daa515005ee6317dc60094a3a0d27bafd93b629d\">[45079]</a></span>: Don't do pslot preemption when NEGOTIATOR_CONSIDER_PREEMPTION=False <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9222b7664f03b10aa58fdb965b56555ff1432b1a\">[45078]</a></span>: Make pslot preemption work with CONSUMPTION_POLICY. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span> When the pslot can be matched multiple times, ensure that we only hand out each dslot claim once. Only put pslot claims with complete child claim information into childClaimHash.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/59fd6d20ca87b0605dd5d810968a3e69a68d93d4\">[45077]</a></span>: Make pslot preemption work with match password authentication. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span> Properly escape claim ids containing quotes in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ChildClaimIds\" title=\"Child Claim Ids\">ChildClaimIds</a></span>. The schedd can't determine the startd's version from the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ReliSock\" title=\"Reli Sock\">ReliSock</a></span>. Assume the startd is new enough to understand extra claim ids. The claim attempt will fail anyway\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-14 18:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/66fd8d66bde8e7c481fbdcef7bef26bd8821331f\">[45044]</a></span>: fix fedora warning for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span>, fix mismatched line endings in queue.cpp  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-12 09:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/94993eb04bfa91dfa8fa35428cb3cc76a9dfced8\">[45035]</a></span>: Minor pslot preemption cleanup in the negotiator. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> Ignore the extra claim ids when clearing entries in the claimIds map and sending MATCH_INFO to the startd.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-12 09:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5738619fbe9624920472208d3f4028b6fb39b23e\">[45034]</a></span>: Don't do pslot preemption when NEGOTIATOR_CONSIDER_PREEMPTION=False <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-12 09:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/be6eac51f26efef0ebcb200d341c4db36fc98946\">[45033]</a></span>: Make pslot preemption work with CONSUMPTION_POLICY. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> When the pslot can be matched multiple times, ensure that we only hand out each dslot claim once. Only put pslot claims with complete child claim information into childClaimHash.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-12 09:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/98a268cdf31017c01f6a7b3aaff5649d6c8c6009\">[45032]</a></span>: Make pslot preemption work with match password authentication. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> Properly escape claim ids containing quotes in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ChildClaimIds\" title=\"Child Claim Ids\">ChildClaimIds</a></span>. The schedd can't determine the startd's version from the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ReliSock\" title=\"Reli Sock\">ReliSock</a></span>. Assume the startd is new enough to understand extra claim ids. The claim attempt will fail anyway if it\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Aug-07 13:55", "status": "resolved", "created": "2015-Jun-11 18:21", "fixed_version": "2015-Jun-11 18:21", "broken_version": "v080306", "priority": "4", "subsystem": "DaemonsExecNode", "assigned_to": "jfrey", "derived_from": "#4942", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}