{"id": 4888, "title": "Ticket #4888: Recent statistics for collector", "description": "<blockquote>\nA number of metrics for our collector are Fairly Useless because they are summations over since collector startup.\n\n<p>In partiular, I'd like to see Recent* versions of:\n</p><ul>\n<li><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UpdatesLost\" title=\"Updates Lost\">UpdatesLost</a></span> and UpdatesLost_*\n</li><li>DCNameResolve*.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2015-Feb-16 10:12:07 by johnkn:</em> <br/>\n\nLike all of the other metrics, the intended use pattern is that the values will fetched periodically and integrated over time by code outside of the collector. This permits different consumers of the stats to have different time windows, and for time windows to change over time.  The recent windowed stats give only one time window for all clients.\n\n<p>That said, its a trivial change to add recent window values to any of these stats.\n\n</p><p>I should also point out that because the collector doesn't have code to create its ad on the fly in response to a query, It's pointless to have a recent window smaller than the update rate.\n\n</p><p></p><hr/>\n<em>2015-Feb-16 13:59:50 by bbockelm:</em> <br/>\n\nYes - it would also be my preference to have the consumer (in this case, Ganglia) do all the transfer binning and calculate the derivative.\n\n<p>Unfortunately, that's broken in current versions of Ganglia.  This will be much appreciated in the meantime.  It can be a crude calculation (as we hopefully can use the raw stat within the next 12 months).\n\n</p><p></p><hr/>\n<em>2015-Apr-29 15:14:20 by bbockelm:</em> <br/>\n\nHi TJ -\n\n<p>Discussing in the CMS/HTCondor call - any update here?  Still relatively high priority here.\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2015-Apr-29 15:15:13 by tannenba:</em> <br/>\n\nBump.... we do want this for v8.3.6...\n\n<p></p><hr/>\n<em>2015-May-05 14:22:20 by johnkn:</em> <br/>\n\nI have converted <code>DCNameResolve</code> to a stats_entry_recent&lt;Probe&gt;, thus producing <code>RecentDCNameResolve</code> and <code>RecentDCNameResolveRuntime</code> stats. The same for the <code>Fast</code>, <code>Slow</code> and <code>Fail</code> flavors of <code>DCNameResolve</code>.\n\n<p>This should be considered a <strong>temporary</strong> change, because aggregating in gangila would be better.  Consequently, the old code is still there, just #ifdef'd out.\n\n</p><p>I have also converted many of the collector's <code>Updates</code> stats from a form that predates the generic_stats template classes into generic_stats; then I added recent windowed stats for those.  The Update stats that are published into the individual daemon ads are unchanged.  But aggregate update stats that are published into the collector ad have been converted to stats_entry_recent&lt;Probe&gt;.\n\n</p><p>New attributes in the collector ad as the result of this change.\n\n</p><p></p><pre>    UpdatesInitial          int      number of initial updates\n    UpdatesLostRatio        double   ratio of updates to lost updates. 1 is all lost\n    UpdatesLostMax          int      largest number of lost updates in a single update\n    SubmitterAds            int      number of submitter ads\n    SubmitterAdsPeak        int      largest number of submitter ads seen\n    StartdAds               int      number of startd ads\n    StartdAdsPeak           int      largest number of startd ads seen\n</pre>\n\n<p>For now, the Updates attributes have values with names beginning with \"Recent\" that are values over the last 1200 seconds.\n\n</p><p></p><hr/>\n<em>2015-Jul-29 21:32:26 by bbockelm:</em> <br/>\n\nIs this ticket finished?\n\n<p>It's in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DocPending\" title=\"Doc Pending\">DocPending</a></span> state but I see documentation commits.\n\n</p><p></p><hr/>\n<em>2015-Jul-30 10:19:41 by johnkn:</em> <br/>\n\nit's finished for now.  We still want to remove the temporary 'recent' window stats once we have ganglia (or condor view) doing the differencing.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-24 18:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e844445120d9a8935c77ee7ab4b4bfa131957a13\">[45152]</a></span>: correct <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> defns of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StartdAds\" title=\"Startd Ads\">StartdAds</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SubmitterAds\" title=\"Submitter Ads\">SubmitterAds</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4888\" onclick=\"get_ticket_and_populate_wrapper('4888'); return false;\" title=\"Recent statistics for collector\">#4888</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-24 11:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1090c6b277d4e8f109d40ae08e900a65a4d392a8\">[45143]</a></span>: add last detail to doc of <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4888\" onclick=\"get_ticket_and_populate_wrapper('4888'); return false;\" title=\"Recent statistics for collector\">#4888</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-23 11:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ba0af65852d4903449851cd93637b4800b40d444\">[45123]</a></span>: Definitions of new collector <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> attributes <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4888\" onclick=\"get_ticket_and_populate_wrapper('4888'); return false;\" title=\"Recent statistics for collector\">#4888</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-05 16:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/67b3bbe7821ecc88df68373d91d76133d09e79e7\">[44993]</a></span>: minor edit on 8.3.6 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4888\" onclick=\"get_ticket_and_populate_wrapper('4888'); return false;\" title=\"Recent statistics for collector\">#4888</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-05 12:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/83456439da457f35e0fdbfa0ac76e67c3796d11c\">[44990]</a></span>: Fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4888\" onclick=\"get_ticket_and_populate_wrapper('4888'); return false;\" title=\"Recent statistics for collector\">#4888</a></span> recognition of collectors own ad and broken calculation of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NumStartdAds\" title=\"Num Startd Ads\">NumStartdAds</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NumSubmitterAds\" title=\"Num Submitter Ads\">NumSubmitterAds</a></span> this commit also adds version history for 4888.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-05 14:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2311e8e641cc65c8d52f2b4089f2cff4e2a4d84a\">[44789]</a></span>: fix previous commit to <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4888\" onclick=\"get_ticket_and_populate_wrapper('4888'); return false;\" title=\"Recent statistics for collector\">#4888</a></span> to use a custom Publish method for updates lost stats ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-04 16:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0f333874ebef640997ae43c189555efaee96afb3\">[44788]</a></span>: publish recent-windowed stats for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UpdatesLost\" title=\"Updates Lost\">UpdatesLost</a></span> in collector <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4888\" onclick=\"get_ticket_and_populate_wrapper('4888'); return false;\" title=\"Recent statistics for collector\">#4888</a></span> also publish recent-windowed stats for DNS <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NameResolve\" title=\"Name Resolve\">NameResolve</a></span> stats this change also removes the useless <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UpdatesHistory\" title=\"Updates History\">UpdatesHistory</a></span> attributes for the various hashtables in the collector ad. and replaces it with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UpdatesLostAvg\" title=\"Updates Lost Avg\">UpdatesLostAvg</a></span> <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UpdatesLostMax\" title=\"Updates Lost Max\">UpdatesLostMax</a></span> attributes.\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Jul-30 15:48", "status": "resolved", "created": "2015-Feb-14 08:46", "fixed_version": "2015-Feb-14 08:46", "broken_version": "", "priority": "2", "subsystem": "DaemonsCM", "assigned_to": "johnkn", "derived_from": "#4490", "creator": "bbockelm", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "bbockelm@cse.unl.edu", "due_date": ""}