{"id": 1922, "title": "Ticket #1922: crash in IPVerify::Verify when DNS returns NULL for host aliases", "description": "<blockquote>\nThe OSG glidein factory observed collector crashes with the following stack dump:\n\n<p></p><div class=\"verbatim\">\n<pre>condor_collector(_ZN8IpVerify6VerifyE12DCpermissionPK11sockaddr_inPKcP8MyStringS7_+0x3c0)[0x8155244]\ncondor_collector(_ZN6SecMan6VerifyE12DCpermissionPK11sockaddr_inPKcP8MyStringS7_+0x28)[0x815e17c]\ncondor_collector(_ZN10DaemonCore6VerifyEPKc12DCpermissionPK11sockaddr_inS1_+0x4a)[0x81223e6]\ncondor_collector(_ZN10DaemonCore9HandleReqEP6StreamS1_+0x8b4)[0x8124c54]\ncondor_collector(_ZN10DaemonCore24CallSocketHandler_workerEibP6Stream+0x324)[0x8123d84]\ncondor_collector(_ZN10DaemonCore35CallSocketHandler_worker_demarshallEPv+0x1d)[0x8123a51]\ncondor_collector(_ZN13CondorThreads8pool_addEPFvPvES0_PiPKc+0x27)[0x81c947b]\ncondor_collector(_ZN10DaemonCore17CallSocketHandlerERib+0xbf)[0x8123893]\ncondor_collector(_ZN10DaemonCore6DriverEv+0xf98)[0x8123524]\ncondor_collector(main+0xbbc)[0x813429c]\n/lib/tls/libc.so.6(__libc_start_main+0xd3)[0xb76e93]</pre></div>\n\n\n<p>The line where it is crashing appears to be this:\n\n</p><p></p><div class=\"verbatim\">\n<pre>thehost = *(aliases++);\n</pre></div>\n\n\n<p>I believe aliases must be NULL or uninitialized.\n\n</p><p>This bug may be much older than 7.5.5.  I haven't investigated to see how old it is.  The conditions that could lead to this problem are slightly different in the new IPv6 code, so it is possible that the problem was introduced in 7.5.4 when the IPv6 code went in.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Feb-21 16:50:00 by danb:</em> <br/>\n\nI did further analysis of the problem at UCSD.  The problem appears to be triggered by sporadic DNS failures.  condor_gethostbyname_ipv6() does two lookups, one to getaddrinfo() and one to gethostbyname().  If the former succeeds but the latter fails, this could result in aliases being NULL in <code>IpVerify::Verify()</code>.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2413\" onclick=\"get_ticket_and_populate_wrapper('2413'); return false;\" title=\"infinite loop in ipverify\">#2413</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\ninfinite loop in ipverify</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-21 16:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9a1b7497bfea7dca4a3803f3d888bd0ac2784cae\">[25927]</a></span>: Improved documentation of crash in IpVerify::Verify. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1922\" onclick=\"get_ticket_and_populate_wrapper('1922'); return false;\" title=\"crash in IPVerify::Verify when DNS returns NULL for host aliases\">#1922</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-21 15:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1b1603974388941a1cb4340241e2a6a2df547a73\">[25926]</a></span>: Documented fix for crash in IPVerify::Verify when host aliases are NULL. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1922\" onclick=\"get_ticket_and_populate_wrapper('1922'); return false;\" title=\"crash in IPVerify::Verify when DNS returns NULL for host aliases\">#1922</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-21 15:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b66359919e437a086aca6cfb3423151909afb8bf\">[20592]</a></span>: Fix a crash in IPVerify::Verify() when host alias list is NULL. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1922\" onclick=\"get_ticket_and_populate_wrapper('1922'); return false;\" title=\"crash in IPVerify::Verify when DNS returns NULL for host aliases\">#1922</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Feb-21 16:50", "status": "resolved", "created": "2011-Feb-21 14:56", "fixed_version": "2011-Feb-21 14:56", "broken_version": "v070505", "priority": "2", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}