{"id": 7231, "title": "Ticket #7231: Add dataflow jobs to HTCondor", "description": "<blockquote>\nLIGO would like an optional \"dataflow\" mode, wherein jobs whose declared output files all exist and whose mtimes are all later than the declared input files mtimes would be skipped.  This allows a quick re-run of large workflows.</blockquote>", "remarks": "<blockquote>\n<em>2019-Oct-14 17:20:02 by coatsworth:</em> <br/>\n\nI've completed a code prototype for this dataflow mode that seems to work well. ToddT asked me to put together a design document, although it's straightforward and simple enough that I'm just going to explain it here in the ticket.\n\n<p>We can implement this dataflow mode almost entirely in the condor_shadow, after the condor_schedd has claimed a resource. Before the shadow activates the claim (and hence invokes the condor_starter) it checks if the declared output files are newer than the claimed input files. It does this by sending the job ad to a static function in the <code>FileTransfer</code> object called <code>AreOutputFileNewerThanInputFiles()</code> (this needs a better name).\n\n</p><p>If the output files are newer, the <code>shadow_v61_main.cpp::startShadow()</code> function sets a few attributes in the job ad to indicated the job completed successfully, then invokes the <code>BaseShadow::shutDown()</code> method. This skips the process execution and drops us off at the point where the shadow is about to exit. We ensure that both \"Job submitted\" and \"Job terminated\" events show up in the log so that DAGMan can process these jobs correctly.\n\n</p><p>The prototype I've put together seems to work just fine, so unless anybody has objections to this approach I'll start working on production code shortly.\n\n</p><p></p><hr/>\n<em>2019-Dec-03 10:07:33 by pfc:</em> <br/>\n\nAs soon as this is released, the ball is in LIGO's court to test it.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7488\" onclick=\"get_ticket_and_populate_wrapper('7488'); return false;\" title=\"Dataflow jobs should also check executables and standard input\">#7488</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDataflow jobs should also check executables and standard input</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-10 11:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5fc4b30beeb0e29695e391f41e3aa524ae898c0f\">[60114]</a></span>: Removed stray debug message (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7231\" onclick=\"get_ticket_and_populate_wrapper('7231'); return false;\" title=\"Add dataflow jobs to HTCondor\">#7231</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jun-25 13:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f8065b2cf23b651a3b275f6dd8e520cc606a6239\">[59998]</a></span>: Fixed bugs with dataflow job detection (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7231\" onclick=\"get_ticket_and_populate_wrapper('7231'); return false;\" title=\"Add dataflow jobs to HTCondor\">#7231</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jun-25 13:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/03c9045730f3a352006e89c6940805e16ba04c64\">[59996]</a></span>: Added ornithology test for dataflow jobs (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7501\" onclick=\"get_ticket_and_populate_wrapper('7501'); return false;\" title=\"Add new Python-based test framework\">#7501</a></span>) (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7231\" onclick=\"get_ticket_and_populate_wrapper('7231'); return false;\" title=\"Add dataflow jobs to HTCondor\">#7231</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Dec-16 17:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5469a55c94007b5ba8d435fdd138e07c31ab1bf3\">[58669]</a></span>: Added documentation + version history (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7231\" onclick=\"get_ticket_and_populate_wrapper('7231'); return false;\" title=\"Add dataflow jobs to HTCondor\">#7231</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Nov-05 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4763e90254ef4c092698d270731978a6b2bbb625\">[58374]</a></span>: Fixed memory leak in FileTransfer::IsDataflowJob (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7231\" onclick=\"get_ticket_and_populate_wrapper('7231'); return false;\" title=\"Add dataflow jobs to HTCondor\">#7231</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-31 11:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c8d55cd6f97622b3f9e95bfbce8448146d87716c\">[58304]</a></span>: Added knob, cleanup + better error checking (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7231\" onclick=\"get_ticket_and_populate_wrapper('7231'); return false;\" title=\"Add dataflow jobs to HTCondor\">#7231</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-29 15:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/84cbb566b72d432706ffe66fd35237ad028eb2d9\">[58287]</a></span>: Added logic to identify dataflow jobs, removed debug code (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7231\" onclick=\"get_ticket_and_populate_wrapper('7231'); return false;\" title=\"Add dataflow jobs to HTCondor\">#7231</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-25 13:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ee5a55f74b3cd392d43122ff31ee97897a576c6e\">[58269]</a></span>: Initial dataflow plumbing, need to remove debug messaging (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7231\" onclick=\"get_ticket_and_populate_wrapper('7231'); return false;\" title=\"Add dataflow jobs to HTCondor\">#7231</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Dec-16 17:14", "status": "resolved", "created": "2019-Sep-04 14:12", "fixed_version": "2019-Sep-04 14:12", "broken_version": "v080900", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "coatsworth", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "coatsworth@cs.wisc.edu, tannenba@cs.wisc.edu, gthain@cs.wisc.edu, pcouvare@caltech.edu", "due_date": ""}