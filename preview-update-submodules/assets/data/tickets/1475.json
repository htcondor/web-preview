{"id": 1475, "title": "Ticket #1475: Gridmanager misidentifying gram2 servers as gram5", "description": "<blockquote>\nIgor Sfiligoi reports that when using Condor 7.5.2 to submit jobs to gram2 servers, the gridmanager identifies a few of them as gram5. This causes it to disable its throttle on running jobmanagers, making it easy to swamps those servers.\n\n<p>I've looked at some of Igor's log files, which show the gridmanager misidentifying osg-east.hms.harvard.edu as gram5. The grid monitor code disables itself before the gram version command is run. The version command properly indicates that the server is gram2. The jobs are submitted with a grid-type of 'gt2'. I can't figure out why the <span class=\"quote\">GlobusResource</span> object has the server marked as being gram5.\n\n</p><p>Here are the relevant lines from the gridmanager log:\n</p><div class=\"code\">\n<pre class=\"code\">06/23/10 14:40:52 [20899] gahp server not up yet, delaying ping\n...\n06/23/10 14:40:52 [20899] grid_monitor for osg-east.hms.harvard.edu:2119 entering CheckMonitor\n06/23/10 14:40:52 [20899] Disabling grid_monitor for GRAM5 server osg-east.hms.arvard.edu:2119\n...\n06/23/10 14:40:57 [20899] GAHP[21092] &lt;- 'GRAM_GET_JOBMANAGER_VERSION 4 osg-east.hms.harvard.edu:2119'\n06/23/10 14:40:57 [20899] GAHP[21092] -&gt; 'S'\n06/23/10 14:40:58 [20899] GAHP[21092] &lt;- 'RESULTS'\n06/23/10 14:40:58 [20899] GAHP[21092] -&gt; 'R'\n06/23/10 14:40:58 [20899] GAHP[21092] -&gt; 'S' '1'\n06/23/10 14:40:58 [20899] GAHP[21092] -&gt; '4' '91'\n06/23/10 14:40:58 [20899] resource osg-east.hms.harvard.edu:2119 is now up\n</pre></div>\n\n\n<p>I've failed to reproduce this on my machine submitting to the same server.\n\n</p><p>Making the grid monitor code delay until the version check is done before deciding anything would fix the bad behavior, but that doesn't resolve the source of the problem (why the <span class=\"quote\">GlobusResource</span> object thinks the server is gram5 before the version check in some situations).</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Jun-29 17:26:06 by jfrey:</em> <br/>\n\nPushed a fix to master for 7.5.4 that delays disabling of the grid monitor until after the server's version has been checked.\n\n<p></p><hr/>\n<em>2010-Oct-20 14:04:51 by jfrey:</em> <br/>\n\nWe haven't fully figured out what happened on Igor's machine, but the changes made in 7.5.4 should prevent any negative effects if it happens again.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1653\" onclick=\"get_ticket_and_populate_wrapper('1653'); return false;\" title=\"Make gridmanager detection of gram version more cautious\">#1653</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nMake gridmanager detection of gram version more cautious</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-29 16:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a21b30244d208854fc2861fa2b486a116e51bbad\">[18524]</a></span>: Prevent grid monitor being disabled for gt2 jobs <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1475\" onclick=\"get_ticket_and_populate_wrapper('1475'); return false;\" title=\"Gridmanager misidentifying gram2 servers as gram5\">#1475</a></span> It was possible for the gridmanager to initially misidentify a gt2 server as gt5 and permanently disable the grid monitor for that server. Now, disabling of the grid monitor is only done if the server's gram version has been checked.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Aug-04 11:52", "status": "resolved", "created": "2010-Jun-28 17:14", "fixed_version": "2010-Jun-28 17:14", "broken_version": "v070502", "priority": "2", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "s7928", "customer_group": "osg", "visibility": "public", "notify": "", "due_date": ""}