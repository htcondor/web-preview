{"id": 6142, "title": "Ticket #6142: Bad hold reason leaves grid jobs un-held", "description": "<blockquote>\nWhen the gridmanager uses the gahp's stderr in a hold reason, it removes newlines but not carriage returns. The schedd rejects the resulting hold reason. The gridmanager interprets this as meaning the job is no longer in the queue, and doesn't set any more attributes, including the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobStatus\" title=\"Job Status\">JobStatus</a></span> of HELD. Thus, the gridmanager repeatedly attempts and fails to put the job on hold.\n\n<p>The gridmanager's giving up after a failed SetAttribute() can cause other problems where the gridmanager thinks multiple attributes have been saved in the schedd when they haven't.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Feb-13 11:03:22 by jfrey:</em> <br/>\n\nFor now, when SetAttribute() fails but the job is still in the queue, the gridmanager will log the error but continue as if it succeeded. We should think about what, if anything, the gridmanager can do about such errors.\n\n<p></p><hr/>\n<em>2017-Feb-28 11:17:50 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Changes look good.  I agree with the sentiment in the previous comment, which should probably become its own ticket so that we don't forget about it.  (The child ticket, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6143\" onclick=\"get_ticket_and_populate_wrapper('6143'); return false;\" title=\"Improve errno values in queue-managment api\">#6143</a></span>, eliminates the potential concern of adding another round-trip to the schedd, and is also a worthwhile general improvement.)</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6143\" onclick=\"get_ticket_and_populate_wrapper('6143'); return false;\" title=\"Improve errno values in queue-managment api\">#6143</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nImprove errno values in queue-managment api</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Feb-28 11:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bad1501035459ecaa54374895ae42be07a787f54\">[50224]</a></span>: Docs for bad hold reason leaving grid jobs unheld bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6142\" onclick=\"get_ticket_and_populate_wrapper('6142'); return false;\" title=\"Bad hold reason leaves grid jobs un-held\">#6142</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Feb-13 11:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c45a94768eb9ec4bf6583c20eb5d3e8141d11f74\">[50141]</a></span>: Improve error checking in gridmanager when SetAttribute() fails. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6142\" onclick=\"get_ticket_and_populate_wrapper('6142'); return false;\" title=\"Bad hold reason leaves grid jobs un-held\">#6142</a></span> When SetAttribute() fails, verify job is no longer in queue before skipping subsequent SetAttribute() calls. If the job is still present, log the failure, but keep going with more SetAttribute() calls.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Feb-13 10:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1d98426f967cc2589b7c639370cc291f6d1ee844\">[50140]</a></span>: Remove carriage returns from gahp stderr. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6142\" onclick=\"get_ticket_and_populate_wrapper('6142'); return false;\" title=\"Bad hold reason leaves grid jobs un-held\">#6142</a></span> We use the stderr in the job hold reason, and carriage returns aren't allowed in old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> strings.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Feb-28 11:32", "status": "resolved", "created": "2017-Feb-13 10:54", "fixed_version": "2017-Feb-13 10:54", "broken_version": "v080500", "priority": "3", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}