{"id": 2843, "title": "Ticket #2843: Have Starter set MemoryUsage into the job ad", "description": "<blockquote>\nThe STARTER needs to set or update the <strong><span class=\"quote\">MemoryUsed</span></strong> attribute in the job ad, and the value needs to be reported into the user log so that users can learn what their actual memory requirements are.\n\n<p>The value set into <span class=\"quote\">MemoryUsed</span> should be configurable on the execute node, on the theory that different operating systems may have a different 'best measure' of memory used.  The current plan is to use <strong><span class=\"quote\">ResidentSetSize</span></strong> on Linux and Windows.\n\n</p><p>Note that the <span class=\"quote\">ResidentSetSize</span> attribute has been defined as the sum of the MAX working set values for the process tree, not the current values.  This will tend to overstate memory used, but not quite so much as <span class=\"quote\">ImageSize</span> does.\n\n</p><p>In order for users to learn what to set for <code>request_memory</code> in their submit file, we should report the value changes for <span class=\"quote\">MemoryUsed</span> into the user log just as we report changes in <span class=\"quote\">ImageSize</span>. These extra values will be added to the end of the existing updated <span class=\"quote\">ImageSize</span> event (so it is fully backwards compatible).</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Mar-15 16:01:28 by johnkn:</em> <br/>\n\n<span class=\"quote\">MemoryUsage</span> as well as <span class=\"quote\">ResidentSet</span> and (if available) <span class=\"quote\">ProportionalSetSize</span> will be reported in the user log as additional lines for the <span class=\"quote\">ImageSize</span> update event.\n\n<p></p><div class=\"verbatim\">\n<pre>006 (221.000.000) 03/15 12:31:10 Image size of job updated: 96268\n        95  -  Memory Usage of job (Mb)\n        96268  -  Resident Set Size of job (Kb)\n</pre></div>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2900\" onclick=\"get_ticket_and_populate_wrapper('2900'); return false;\" title=\"new -wide option for condor_q\">#2900</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nnew -wide option for condor_q</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-12 11:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dbc91c63400cb4cfc9630d0e2bcd550dd899235b\">[31639]</a></span>: version history item for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> ===VersionHistory:Complete===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-09 15:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8d751998293b518b1f8604e33a771892d1129768\">[31567]</a></span>: Update defns of attributes <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestCpus\" title=\"Request Cpus\">RequestCpus</a></span>, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestDisk\" title=\"Request Disk\">RequestDisk</a></span>, and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-09 12:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dd8caabdc698faef119d0ac56073f05afb695d4c\">[31555]</a></span>: Add defn of knob JOB_DEFAULT_REQUESTMEMORY ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-06 10:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/792cf20f28bfb1df58e5183cfbd4859674d74e38\">[31530]</a></span>: fix code to check for empty list of parametized resources in userlog printing code <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> ===VersionHistory:none===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-06 09:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/44e3a146541d449580fee2a8ba9978cee59cada9\">[31528]</a></span>: don't print out headers for Partitionable resource use/request unless when there is no usage information to print. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-05 14:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ad760cd0dd380c0f8468852f85e521a34dd52d94\">[31522]</a></span>: fix bug in event log reader for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MemoryUsage\" title=\"Memory Usage\">MemoryUsage</a></span> RSS &amp; PSS fields of IMAGESIZE event <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> ===VersionHistory:None=== bug never shipped.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-04 12:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b876ace5dad19ee16e43976f240cefc5ba81a483\">[31106]</a></span>: partial documentation of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span> and its implications ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-04 11:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5cd3ca3fc54f9fed2e30c90f1bea38215beb42c6\">[31105]</a></span>: write <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MemoryUsage\" title=\"Memory Usage\">MemoryUsage</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestMemory\" title=\"Request Memory\">RequestMemory</a></span>, as well as other partitionable resources into the user log at the job terminate event and at the job vacate event. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-29 10:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0afafb654044aac48ddf767ac1d4182037c4f765\">[31031]</a></span>: change userlog text for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MemoryUsage\" title=\"Memory Usage\">MemoryUsage</a></span>, etc in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ImageSize\" title=\"Image Size\">ImageSize</a></span> update event so that the attribute names are mentioned in the user log. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-21 13:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ce4dcacb397763ebdbb349548130cda29b825a1d\">[30982]</a></span>: Add defn of new job attribute <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MemoryUsage\" title=\"Memory Usage\">MemoryUsage</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-20 12:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2e5d88652c16a67d34f67d9abfca6649305de7e1\">[30976]</a></span>: condor_q prints SIZE field of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MemoryUsage\" title=\"Memory Usage\">MemoryUsage</a></span> value; defns for MEMORY_USAGE_METRIC and MEMORY_USAGE_METRIC_VM; add ticket number to version history item. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-20 10:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/01b024423c7794110309197eec02bdaca731a5ef\">[30973]</a></span>: use perl flip-flop to discard optional lines in lib_eventlog.run and xml test <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-19 15:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ba4010993ccd7373b8fc13b7187f5717abac9208\">[30969]</a></span>: print out x_read_joblog output in lib_eventlog test so we can figure out how to update the test for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-19 09:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cdbad6f3621d40d0d3317041275a9232a23a0a5e\">[30951]</a></span>: ignore Job Ad Information if it follows Job Image Size Changed in basic eventlog test <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-16 16:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/729404d9405487ab9d5a2c051a14a40acf84f690\">[30947]</a></span>: fix typo in test script lib_eventlog.run. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-16 09:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b32f48ba5c01401e6794a7f27e507e679ff2cbca\">[30941]</a></span>: change simple eventlog tests to tolerate Image Size update messages, change to userlog caused by <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-15 16:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c2601f0db1df9e6869b7fe66070e7c6c9595922a\">[30921]</a></span>: report value of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MemoryUsage\" title=\"Memory Usage\">MemoryUsage</a></span>, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ResidentSetSize\" title=\"Resident Set Size\">ResidentSetSize</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ProportionalSetSize\" title=\"Proportional Set Size\">ProportionalSetSize</a></span> in the user log as part of the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ImageSize\" title=\"Image Size\">ImageSize</a></span> update event. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-05 17:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c28f2aab1b9add9725dc9d86b84125d8e73bc275\">[30811]</a></span>: fix <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MemoryUsage\" title=\"Memory Usage\">MemoryUsage</a></span> to be an expression rather than string value, and fix it so that it propagates from the shadow into the schedd. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Mar-01 15:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3687539f9a635c220c0a8b6cd6fd638793e454bd\">[30765]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span>. Have starter set <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MemoryUsage\" title=\"Memory Usage\">MemoryUsage</a></span> into the job ad.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Feb-28 17:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/87f2faee6d524cf36717a21f0900cb9bf6b57d94\">[30741]</a></span>: Have starter set <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MemoryUsage\" title=\"Memory Usage\">MemoryUsage</a></span> into job ad based on new params. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2843\" onclick=\"get_ticket_and_populate_wrapper('2843'); return false;\" title=\"Have Starter set MemoryUsage into the job ad\">#2843</a></span> Added MEMORY_USAGE_METRIC and MEMORY_USAGE_METRIC_VM to the default praram table for Vanilla and VM universes respectively. Also updated condor_q to display <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MemoryUsage\" title=\"Memory Usage\">MemoryUsage</a></span> rather than <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ImageSize\" title=\"Image Size\">ImageSize</a></span> if it is available, and added the -wide option\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-Apr-17 14:04", "status": "resolved", "created": "2012-Feb-23 14:06", "fixed_version": "2012-Feb-23 14:06", "broken_version": "v070705", "priority": "3", "subsystem": "", "assigned_to": "johnkn", "derived_from": "#2842", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com", "due_date": ""}