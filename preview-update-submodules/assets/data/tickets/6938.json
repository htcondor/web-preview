{"id": 6938, "title": "Ticket #6938: submit_utils broken Requirements for request zero of a custom resource", "description": "<blockquote>\nNOTE: the original title of this ticket was <strong>TARGET.GPUs not defined to be 0 by default</strong>\n\n<p>This might be resolved by 8.8/8.9, but in 8.7.10 \"GPUs\" appears not to be defined by default for partitionable slots. This has the effect that the comparison:\n\n</p><p></p><div class=\"verbatim\">\n<pre>The Requirements expression for job 793272.000 is\n\n    (TARGET.Arch == \"X86_64\") &amp;&amp; (TARGET.OpSys == \"LINUX\") &amp;&amp; (TARGET.Disk &gt;= RequestDisk) &amp;&amp; (TARGET.Memory &gt;= RequestMemory) &amp;&amp; (TARGET.GPUs &gt;= RequestGPUs) &amp;&amp;\n    ((TARGET.FileSystemDomain == MY.FileSystemDomain) || (TARGET.HasFileTransfer))\n</pre></div>\n\n\n<p>can't succeed even though RequestGpus=0.\n\n</p><p></p><div class=\"verbatim\">\n<pre>    DiskUsage = 75\n    FileSystemDomain = \"nemo.phys.uwm.edu\"\n    RequestDisk = DiskUsage\n    RequestGPUs = 0\n    RequestMemory = 2048\n\nThe Requirements expression for job 793272.000 reduces to these conditions:\n\n         Slots\nStep    Matched  Condition\n-----  --------  ---------\n[0]         190  TARGET.Arch == \"X86_64\"\n[1]         190  TARGET.OpSys == \"LINUX\"\n[3]         190  TARGET.Disk &gt;= RequestDisk\n[5]         190  TARGET.Memory &gt;= RequestMemory\n[7]           0  TARGET.GPUs &gt;= RequestGPUs\n[9]         190  TARGET.FileSystemDomain == MY.FileSystemDomain\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2019-Mar-01 16:30:44 by tpdownes:</em> <br/>\n\nObviously this is a somewhat weird thing for a user to do, but I could imagine LIGO going a direction where we want every job to have a defined value for RequestCpus/Memory/Gpus for simplicity of post-facto analysis.\n\n<p></p><hr/>\n<em>2019-Apr-10 15:16:42 by pfc:</em> <br/>\n\nTom, can you work around this with <div class=\"verbatim\">\n<pre>(TARGET.GPUs =?= UNDEFINED &amp;&amp; (TARGET.GPUs &gt;= RequestGPUs))</pre></div>\n?\n\n<p></p><hr/>\n<em>2019-May-08 13:37:45 by gthain:</em> <br/>\n\nThe HTCondor team will fix this in 8.8\n\n<p></p><hr/>\n<em>2019-Jul-31 14:44:43 by johnkn:</em> <br/>\n\nthis can be fixed in configuration by LIGO.  just add\n<div class=\"snip\">\n<pre class=\"sniplabel\">config fragment</pre>\n<pre class=\"snip\">GPUs=0\nSTARTD_ATTRS = $(STARTD_ATTRS), GPUs\n</pre></div>\n\nto config of all of the nodes.\n\n<p>This will advertise GPUs=0 on machines that don't run <code>condor_gpu_detection</code>,\nOn machines that do run detection, the value of GPUs will be overridden by the detected value\n\n</p><p></p><hr/>\n<em>2019-Aug-06 13:29:37 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>I think <code>if( string_is_double_param(...) &amp;&amp; val &gt; 0 )</code> would be clearer, but whatever.  This should work fine.\n\n</p><p></p><hr/>\n<em>2019-Aug-08 16:31:41 by johnkn:</em> <br/>\n\nI improved the comment.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7192\" onclick=\"get_ticket_and_populate_wrapper('7192'); return false;\" title=\"better submit_utils Requirements generation for custom resources\">#7192</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nbetter submit_utils Requirements generation for custom resources</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-29 16:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c63a13e257cd58745841b11515412603a5adc803\">[57739]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6938\" onclick=\"get_ticket_and_populate_wrapper('6938'); return false;\" title=\"submit_utils broken Requirements for request zero of a custom resource\">#6938</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-08 16:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a817658d0459e5551eba6682635998b977819e08\">[57638]</a></span>: better comment for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6938\" onclick=\"get_ticket_and_populate_wrapper('6938'); return false;\" title=\"submit_utils broken Requirements for request zero of a custom resource\">#6938</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-06 13:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/15686871aba8345a7b50ca9f57ef585545438a54\">[57608]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7192\" onclick=\"get_ticket_and_populate_wrapper('7192'); return false;\" title=\"better submit_utils Requirements generation for custom resources\">#7192</a></span>, a 8.9 implemetation of <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6938\" onclick=\"get_ticket_and_populate_wrapper('6938'); return false;\" title=\"submit_utils broken Requirements for request zero of a custom resource\">#6938</a></span>, better Requrements generation for custom resources in submit_utils ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-06 11:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/79d2e23e1bea9ecca520b1b89aded531fd4ea280\">[57604]</a></span>: fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6938\" onclick=\"get_ticket_and_populate_wrapper('6938'); return false;\" title=\"submit_utils broken Requirements for request zero of a custom resource\">#6938</a></span>, submit_utils makes broken requirements for a request of zero of a custom resource ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Aug-29 16:10", "status": "resolved", "created": "2019-Mar-01 16:29", "fixed_version": "2019-Mar-01 16:29", "broken_version": "v080710", "priority": "4", "subsystem": "", "assigned_to": "johnkn", "derived_from": "", "creator": "tpdownes", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pcouvare@caltech.edu", "due_date": ""}