{"id": 2262, "title": "Ticket #2262: HGQ sanity check on recursive allocation is checking wrong variable", "description": "<blockquote>\nThis should be checking fabs(s), not fabs(surplus):\n\n<p></p><pre>            double s = hgq_allocate_surplus(groups[j], allocated[j]);\n            if (fabs(surplus) &gt; 0.00001) {\n                dprintf(D_ALWAYS, \"group quotas: WARNING: allocate-surplus (3):\nsurplus= %g\\n\", s);\n            }\n</pre>\n\n<p>In cases where there is remaining surplus, this will output the warning message\nfor no good reason.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Jun-22 13:40:25 by eje:</em> <br/>\n\nrepro/test\n\n<p>Use this config:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">CLAIM_WORKLIFE = 0\nNEGOTIATOR_CONSIDER_PREEMPTION = FALSE\nNEGOTIATOR_DEBUG = D_FULLDEBUG\n\nNEGOTIATOR_USE_SLOT_WEIGHTS = FALSE\n\nGROUP_QUOTA_MAX_ALLOCATION_ROUNDS = 1\n\nNEGOTIATOR_INTERVAL = 30\nSCHEDD_INTERVAL = 15\n\nNUM_CPUS = 20\n\nGROUP_NAMES = a, b, a.a1\nGROUP_QUOTA_a = 10\nGROUP_QUOTA_b = 10\nGROUP_QUOTA_a.a1 = 5\n\nGROUP_ACCEPT_SURPLUS = TRUE\n</pre></div>\n\n\n<p>Submit the following job, that invokes the use of surplus for \"a.a1\" (but does not use all of it)\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">universe = vanilla\ncmd = /bin/sleep\nargs = 60\nshould_transfer_files = if_needed\nwhen_to_transfer_output = on_exit\n+AccountingGroup=\"a.a1.user\"\nqueue 7\n</pre></div>\n\n\n<p>Before fix: the sanity check looks at the wrong variable, and emits a warning message even though it worked correctly\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">$ tail -f NegotiatorLog | grep WARNING\n06/22/11 11:20:14 group quotas: WARNING: allocate-surplus (3): surplus= 0\n</pre></div>\n\n\n<p>After fix: the spurious warning will not appear.\n\n</p><p></p><hr/>\n<em>2011-Aug-02 10:56:12 by psilord:</em> <br/>\n\nThe variable being checked in the patch is the correct one. Reviewed by psilord.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/387/gt2262-surplus-check.patch\">gt2262-surplus-check.patch</a>\n692 bytes added by eje on 2011-Jun-22 18:35:57 UTC.\n<br/>\nFixes surplus sanity check so it examines the correct variable.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-22 13:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e66c9bb46862c6364e165ec40c14588f41c3e0b5\">[22266]</a></span>: ===VersionHistory=== Fixed surplus allocation check to examine the right variable. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2262\" onclick=\"get_ticket_and_populate_wrapper('2262'); return false;\" title=\"HGQ sanity check on recursive allocation is checking wrong variable\">#2262</a></span>  (By Erik Erlandson )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Aug-02 10:56", "status": "resolved", "created": "2011-Jun-22 12:52", "fixed_version": "2011-Jun-22 12:52", "broken_version": "v070600", "priority": "2", "subsystem": "Daemons", "assigned_to": "psilord", "derived_from": "", "creator": "eje", "rust": "", "customer_group": "other", "visibility": "public", "notify": "eje@cs.wisc.edu", "due_date": ""}