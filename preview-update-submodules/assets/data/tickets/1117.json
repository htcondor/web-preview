{"id": 1117, "title": "Ticket #1117: Query ads to the collector should have proper TARGET scoping", "description": "<blockquote>\nQueries to the collector consist of a query ad with a requirements expression that matches the ads the client is interested in. The collector performs a one-way matching operation to find the desired ads. Some of the attribute references in the requirements expression lack a 'target' scope, though they want to refer to attributes in the target ads. This works fine in old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>, but fails with new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>.\n\n<p>As part of the switch to new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>, both the collector and its clients should ensure that the query ad's requirements expression has the proper scoping for its attribute references. After enough time, these checks could be removed from the collector.\n\n</p><p>The collector daemon and the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CondorQuery\" title=\"Condor Query\">CondorQuery</a></span> object should call AddExplicitTargetRefs() on the query ad.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-20 16:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/21a18fdae5642436255ae3b3380f34d7cf9bcb87\">[16940]</a></span>: Enforce correct TARGET scoping in queries to the collector. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1117\" onclick=\"get_ticket_and_populate_wrapper('1117'); return false;\" title=\"Query ads to the collector should have proper TARGET scoping\">#1117</a></span> Both the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CondorQuery\" title=\"Condor Query\">CondorQuery</a></span> class and the collector now call AddExplicitTargetRefs() on the query ad to ensure it will evaluate properly with new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-18 10:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4e6c33202ce82fd91dd8028e84a0f9647229925e\">[16912]</a></span>: <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GenericQuery\" title=\"Generic Query\">GenericQuery</a></span> now takes an <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTree\" title=\"Expr Tree\">ExprTree</a></span> instead of a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1116\" onclick=\"get_ticket_and_populate_wrapper('1116'); return false;\" title=\"Queue-management constraints shouldn't use TARGET scoping\">#1116</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1117\" onclick=\"get_ticket_and_populate_wrapper('1117'); return false;\" title=\"Query ads to the collector should have proper TARGET scoping\">#1117</a></span> This simplifies the CondorQ class, which doesn't want the expression created by <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GenericQuery\" title=\"Generic Query\">GenericQuery</a></span> to be in an ad. It also reduces the rewriting of the expression for proper Target scoping in new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Feb-05 15:42", "status": "resolved", "created": "2010-Jan-15 16:05", "fixed_version": "2010-Jan-15 16:05", "broken_version": "v070500", "priority": "4", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "#1126", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}