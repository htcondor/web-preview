{"id": 1982, "title": "Ticket #1982: IPv6 branch: job_ckpt_io-async_std broken: ./tmp already exists", "description": "<blockquote>\nNote: this is a nonpublic, never released branch.  It will eventually be merged into master once problems like this are sorted out.\n\n<p>./tmp exists when job_ckpt_io-async_std tries to run.  This is a fatal error.  See <a class=\"external\" href=\"http://nmi-s006.cs.wisc.edu/rundir/m/2011/03/m_nmi-s006.cs.wisc.edu_1299801231_31219/userdir/nmi:x86_rhas_3/job_ckpt_io-async_std-1.out\">http://nmi-s006.cs.wisc.edu/rundir/m/2011/03/m_nmi-s006.cs.wisc.edu_1299801231_31219/userdir/nmi:x86_rhas_3/job_ckpt_io-async_std-1.out</a> for an example.\n\n</p><p>./tmp is a directory, and when the tests finish, it is and contains the following:\n</p><div class=\"code\">\n<pre class=\"code\">drwxr-xr-x 4 4096 Mar 11 03:30 tmp\ndrwxr-xr-x 3 4096 Mar 11 05:06 tmp/condorLocks\ndrwxr-xr-x 3 4096 Mar 11 04:35 tmp/condorLocks/34\ndrwxr-xr-x 2 4096 Mar 11 04:01 tmp/condorLocks/34/38\n-rw-r--r-- 1    0 Mar 11 04:01 tmp/condorLocks/34/38/451316.lockc\ndrwxr-xr-x 2 4096 Mar 11 01:18 tmp/full_dir\n</pre></div>\n\n\n<p>The contents suggest two people using ./tmp:\n</p><ol>\n<li>condorLocks: File locking.\n<ul>\n<li>The file locking code uses this directory under tmp_dir_path() if it can't find LOCAL_DISK_LOCKDIR (<a class=\"file\" href=\"rlog?f=src/condor_utils/file_lock.cpp\">/src/condor_utils/file_lock.cpp</a> 679 FileLock::GetTempPath). tmp_dir_path will try in order, param(\"TMP_DIR\"), param(\"TEMP_DIR\"), and then /tmp. (<a class=\"file\" href=\"rlog?f=src/condor_utils/directory_util.cpp\">/src/condor_utils/directory_util.cpp</a> 30 tmp_dir_path).\n</li><li>I <em>think</em> ./TestingPersonalCondor/condor_config(.local) is being used, and that sets TMP_DIR=$(LOG)/tmp. LOG is $(LOCAL_DIR/log). LOCAL_DIR is the full path to ./TestingPersonalCondor/local, as expected.  And sure enough, ./TestingPersonalCondor/local/log/tmp exists and contains condorLocks and general evidence of the locking system being used. So, <em>who is getting the wrong idea to use ./?</em>\n</li><li>tmp/condorLocks could be created by an earlier test, in which case we don't know which configuration is in use.  So far, no luck correlating timestamps on the files with matching start times and durations in the NMI reports; the timestamps don't agree with each other at all.\n</li><li>Guilty party is almost certainly job_dagman*.run.  The various condor_dagmans started by those tests somehow decide that CWD(?) is the appropriate place for log files.\n</li></ul>\n</li><li>full_dir: <a class=\"file\" href=\"rlog?f=src/condor_unit_tests/OTEST_StatInfo.cpp\">/src/condor_unit_tests/OTEST_StatInfo.cpp</a> and <a class=\"file\" href=\"rlog?f=src/condor_unit_tests/OTEST_Directory.cpp\">/src/condor_unit_tests/OTEST_Directory.cpp</a> will create a directory by this name.  A <em>very</em> casual check suggests that it should be deleted when the test finishes; needs further investigation.</li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Jul-16 13:39:24 by adesmet:</em> <br/>\n\nOld, likely out of date, no recent reports since merge. Abandoning.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2012-Jul-16 13:39", "status": "abandoned", "created": "2011-Mar-17 15:04", "fixed_version": "2011-Mar-17 15:04", "broken_version": "", "priority": "4", "subsystem": "Tests", "assigned_to": "adesmet", "derived_from": "#9", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}