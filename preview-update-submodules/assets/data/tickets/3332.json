{"id": 3332, "title": "Ticket #3332: Negotiator cycle delay drift", "description": "<blockquote>\n<div class=\"verbatim\">\n<pre>There seems to be 3-4 secs of time that is not included in the default NEGOTIATOR_CYCLE_DELAY from end of cycle to beginning or cycle.\n\nIf a reschedule is used the timer is reset to reflect the DELAY.\n\nNEGOTIATOR_CYCLE_DELAY=NEGOTIATOR_INTERVAL=30\n\n05/09/12 18:35:38 ---------- Finished Negotiation Cycle ----------\n05/09/12 18:35:41 SECMAN: resuming command 60010 MATCH_INFO ...\n...\n05/09/12 18:35:41 PERMISSION GRANTED to condor from host 192.168.134.154 for command 421 (Reschedule)...\n...\n05/09/12 18:36:08 ---------- Started Negotiation Cycle ----------\n\n3+27=30 secs\n\n05/09/12 18:38:29 ---------- Finished Negotiation Cycle ----------\n05/09/12 18:38:32 SECMAN: resuming command 60010 MATCH_INFO...\n...\n05/09/12 18:39:02 ---------- Started Negotiation Cycle ----------\n\n3+30=33 secs\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Nov-30 17:31:33 by eje:</em> <br/>\n\nTest new behavior:\n\n<p>Use the following configuration:\n</p><div class=\"code\">\n<pre class=\"code\">INSERT_NEGOTIATOR_CYCLE_TEST_DURATION = 10\nNEGOTIATOR_CYCLE_DELAY = 15\nNEGOTIATOR_INTERVAL = 30\n</pre></div>\n\n\n<p>No jobs need to be submitted.  Spin up a pool and watch the negotiator log:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">$ tail -f NegotiatorLog | grep -e '\\-\\-\\-\\-\\-'</pre></div>\n\n\n<p>Tou should see that with the negotiator cycle duration of 10 seconds, the interval between negotiator cycle starts is 30 seconds (as configured), and the interval between end of one cycle and beginning of next is 20 seconds:\n</p><div class=\"code\">\n<pre class=\"code\">11/30/12 16:09:32 ---------- Started Negotiation Cycle ----------\n11/30/12 16:09:42 ---------- Finished Negotiation Cycle ----------\n11/30/12 16:10:02 ---------- Started Negotiation Cycle ----------\n11/30/12 16:10:12 ---------- Finished Negotiation Cycle ----------\n11/30/12 16:10:32 ---------- Started Negotiation Cycle ----------\n</pre></div>\n\n\n<p>Now, set INSERT_NEGOTIATOR_CYCLE_TEST_DURATION = 20, and restart the negotiator.  You should now see that the minimum inter-cycle delay (NEGOTIATOR_CYCLE_DELAY = 15) takes effect.  The time from start of one cycle to the start of the next is now 35 seconds, and the interval between end of one cycle and start of next is 15 seconds:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">11/30/12 16:07:07 ---------- Started Negotiation Cycle ----------\n11/30/12 16:07:27 ---------- Finished Negotiation Cycle ----------\n11/30/12 16:07:42 ---------- Started Negotiation Cycle ----------\n11/30/12 16:08:02 ---------- Finished Negotiation Cycle ----------\n11/30/12 16:08:17 ---------- Started Negotiation Cycle ----------\n</pre></div>\n\n\n<p></p><hr/>\n<em>2013-Jan-07 16:23:01 by johnkn:</em> <br/>\n\nSeems like a pointless change to me, but don't see that it causes any problems. approved.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Dec-06 15:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/42931ff27114f4e0ea9c6d6de19fcbf0c2cecc79\">[34322]</a></span>: Rewrote version history item of this not-a-bug change to better state what the change implemented. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3332\" onclick=\"get_ticket_and_populate_wrapper('3332'); return false;\" title=\"Negotiator cycle delay drift\">#3332</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Nov-30 17:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/68a3a47dfaade3da63bbcc800a48718a63e56bc8\">[34241]</a></span>: Added a timer reset at end of negotiation cycle to reduce delay drift ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3332\" onclick=\"get_ticket_and_populate_wrapper('3332'); return false;\" title=\"Negotiator cycle delay drift\">#3332</a></span>  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Nov-30 17:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bde7e74c8d4d469047808f94f67321f4cbd48732\">[34242]</a></span>: ===VersionHistory:Completed=== ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3332\" onclick=\"get_ticket_and_populate_wrapper('3332'); return false;\" title=\"Negotiator cycle delay drift\">#3332</a></span>  (By Erik Erlandson )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Jan-07 16:23", "status": "resolved", "created": "2012-Nov-20 14:12", "fixed_version": "2012-Nov-20 14:12", "broken_version": "", "priority": "3", "subsystem": "Daemons", "assigned_to": "johnkn", "derived_from": "", "creator": "eje", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu, jthomas@redhat.com, eje@cs.wisc.edu, tstclair@redhat.com", "due_date": ""}