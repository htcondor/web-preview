{"id": 6135, "title": "Ticket #6135: Support Subject Alternative Names in gsi and ssl handling", "description": "<blockquote>\nHTCondor GSI (and SSL?) authentication should honor the Subject Alternative Names in x509 certificates.  See ticket <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=6127\" onclick=\"get_ticket_and_populate_wrapper('6127'); return false;\" title=\"GSI hostname checks are broken, confusing, do not comply with RFC 2818\">#6127</a></span> for details.\n\n<p>Note that this may be as easy as simply updating the Globus/GSI libraries used by HTCondor, as Globus has of late been doing work to be more RFC compliant.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Aug-24 14:01:53 by blin:</em> <br/>\n\nIt looks like this is still broken. I tested this with HTCondor 8.6.5 on fermicloud329.fnal.gov and a hostcert with a subject of condor-san-test-2.fnal.gov and a SAN containing fermicloud329.fnal.gov. Here's a snippet from the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MasterLog\" title=\"Master Log\">MasterLog</a></span>:\n\n<p></p><pre>   08/24/17 13:58:59 ZKM: successful mapping to condor-san-test-2.fnal.gov@daemon.opensciencegrid.org\n   08/24/17 13:58:59 PERMISSION DENIED to condor-san-test-2.fnal.gov@daemon.opensciencegrid.org from host 131.225.154.219 for command 60008 (DC_CHILDALIVE), access level DAEMON: reason: DAEMON authorization policy contains no matching ALLOW entry for this request; identifiers used for this host: 131.225.154.219,fermicloud329.fnal.gov, hostname size = 1, original ip address = 131.225.154.219\n</pre>\n\n<p>Let me know if you need any other info.\n\n</p><p></p><hr/>\n<em>2017-Aug-24 15:14:50 by zmiller:</em> <br/>\n\nAre you sure this error is relevant to this ticket?\n\n<p>This appears to be a case of <code>condor-san-test-2.fnal.gov@daemon.opensciencegrid.org</code> not matching anything in your <code>ALLOW_DAEMON</code> list.\n\n</p><p>Or are you saying that HTCondor shouldn't be using <code>condor-san-test-2.fnal.gov@daemon.opensciencegrid.org</code> but instead be using some other name that is present in the X509v3 Subject Alternative Name?\n\n</p><p>In any case, no code has changed to date in HTCondor as a result of this ticket, so it is indeed probably still broken.  I am just not sure this is the bug you are bumping into.\n\n</p><p></p><hr/>\n<em>2017-Aug-24 15:16:25 by zmiller:</em> <br/>\n\nAh, scrap my above comment.  I see the discrepancy now.\n\n<p>And as I said, yes it is still broken.\n\n</p><p></p><hr/>\n<em>2017-Dec-08 16:11:34 by jfrey:</em> <br/>\n\nMy testing shows that support for Subject Alternative Names is working as expected for the GSI authentication method, and has been since we updated the version of Globus we use to 6.0 (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5520\" onclick=\"get_ticket_and_populate_wrapper('5520'); return false;\" title=\"Update Globus external to 6.0\">#5520</a></span>). That is, when the client in a CEDAR security exchange verifies that the hostname of the server appears in the server's X.509 certificate, it will examine DNS names in the Subject Alternative Names in addition to a hostname in the primary Subject Name.\n\n<p>In Tom Downes' original report of the problem, the alternative names in his certificate don't match the primary name (pcdev2.* vs pcdev1.*). Assuming he didn't accidentally copy text from two different machines, that would explain why he was getting the initial errors he reported.\n\n</p><p>The current SAN support does not allow you to use the alternative names when mapping an X.509 principle to a Condor principle. In other words, in the Condor mapfile and ALLOW settings, you can only refer to the primary subject name of a GSI principle. Brian Lin's report of the problem appears to expect to be able to refer to the alternative names in the mapping and authorization phases of CEDAR security.\n\n</p><p></p><hr/>\n<em>2017-Dec-13 16:01:18 by jfrey:</em> <br/>\n\nI'm resolving this ticket as the intended SAN support is working.\n\n<p></p><hr/>\n<em>2017-Dec-13 18:18:41 by blin:</em> <br/>\n\nAs discussed during today's OSG-Flightworthy meeting, this ticket can be closed</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/1008/ce_config.txt\">ce_config.txt</a>\n47278 bytes added by jfrey on 2017-Dec-13 17:27:00 UTC.\n<br/>\nCondor configuration from Brian Lin's testing.<br/>\n</li><li><a href=\"../files/1009/condor_mapfile\">condor_mapfile</a>\n949 bytes added by jfrey on 2017-Dec-13 19:12:28 UTC.\n<br/>\nCondor mapfile used in Brian Lin's testing<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "", "type": "enhance", "last_change": "2017-Dec-13 21:12", "status": "abandoned", "created": "2017-Feb-08 15:43", "fixed_version": "2017-Feb-08 15:43", "broken_version": "", "priority": "2", "subsystem": "Security", "assigned_to": "jfrey", "derived_from": "#4882", "creator": "tannenba", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu tannenba@cs.wisc.edu jfrey@cs.wisc.edu zmiller@cs.wisc.edu", "due_date": ""}