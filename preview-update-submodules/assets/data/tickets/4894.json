{"id": 4894, "title": "Ticket #4894: Report memory usage of VMs incorrect.", "description": "<blockquote>\nFrom <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4338\" onclick=\"get_ticket_and_populate_wrapper('4338'); return false;\" title=\"Investigate reporting memory usage of VMs\">#4338</a></span>:\n\n<p>Broken in testing on CHTC.  Sometimes a VMU job will report correctly:\n\n</p><p></p><div class=\"verbatim\">\n<pre>006 (171360.000.000) 12/16 13:25:37 Image size of job updated: 2097152\n\t2097152  -  ResidentSetSize of job (KB)\n...\n</pre></div>\n\n\n<p>sometimes it will get\n\n</p><p></p><div class=\"verbatim\">\n<pre>006 (171404.000.000) 12/16 13:28:47 Image size of job updated: 8029125568646952238\n\t959329332  -  ResidentSetSize of job (KB)\n...\n</pre></div>\n\n\n<p>which is wrong in at least two ways.\n\n</p><p>I see two things worth investigating: the conversion from unsigned long to long long when adding the memory value to the string before sending it to the starter, and the starter converting that value into a signed long int, instead.  Second, the data structure in question is never zeroed; perhaps in certain cases the memory usage field is never filled out and we're picking arbitrary garbage off the stack?\n\n</p><p>Was only able to reproduce once; analysis indicated the problem was probably occurring in shadow or the schedd, and may be the result of a race condition (although that doesn't make a whole lot of sense, since neither of those have VMU-specific code; maybe the unmasking factor is that the VMU doesn't send a memory size update until well after the initial execution report?).</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Feb-17 14:25:22 by tlmiller:</em> <br/>\n\n<strong>Documentation</strong>\n\n<p>Full documentation must be written when this bug is fixed, because we haven't told anyone about this yet.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2015-Aug-14 13:38", "status": "new", "created": "2015-Feb-17 14:05", "fixed_version": "2015-Feb-17 14:05", "broken_version": "v080302", "priority": "4", "subsystem": "DaemonsExecNode", "assigned_to": "tlmiller", "derived_from": "#4338", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}