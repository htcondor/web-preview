{"id": 7432, "title": "Ticket #7432: Job router should use a list of job transforms for the route", "description": "<blockquote>\nThe <code>JobRouter</code> should use the same configuration model and syntax for routes that the schedd does for <code>JOB_TRANSFORMs</code>\n\n<p>This is a follow-on to work to apply the routes in the order in which they are declared.\n\n</p><p>There will be new knobs\n</p><ul>\n<li><code>JOB_ROUTER_PRE_ROUTE_TRANSFORM_NAMES</code> a list of transforms that will be applied in order when an incoming job matches a route but before the routing transform is applied.\n</li><li><code>JOB_ROUTER_POST_ROUTE_TRANSFORM_NAMES</code> a list of transforms that will be applied in order after a route transform is applied\n</li></ul>\n\n<p>Names in these two knobs will refer to pre-and post route transforms defined by\n<code>JOB_ROUTER_TRANSFORM_&lt;name&gt;</code> knobs. These knobs will allow, but not require <code>REQUIREMENTS</code> statements, so that not all pre/post route transforms need be applied to all jobs that are routed.\n\n</p><p>There will be a new knob <code>JOB_ROUTER_USE_DEPRECATED_ROUTER_ENTRIES</code> that will default to true for now, but will be set to false some time in the future.  When this knob is false, the <code>JobRouter</code> will longer parse the 3 <code>JOB_ROUTER_ENTRIES*</code> knobs and the <code>JOB_ROUTER_DEFAULTS</code> knob, and will generate a warning if any of these are configured.\n\n</p><p>Google doc for job router config redesign: <a class=\"external\" href=\"https://docs.google.com/document/d/1IkEV907Jsc2Wu6HIhhrH9QdFTiGkFzuUn5CTVPRZzNs/edit?usp=sharing\">https://docs.google.com/document/d/1IkEV907Jsc2Wu6HIhhrH9QdFTiGkFzuUn5CTVPRZzNs/edit?usp=sharing</a></p></blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2020-Apr-10 07:46:37 by tim:</em> <br/>\n\nBulk change of target version from v080906 to v080907 using ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-21 14:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/27c6c2d43d909d19ebcdd62fc9036b4363ebcd58\">[59437]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7432\" onclick=\"get_ticket_and_populate_wrapper('7432'); return false;\" title=\"Job router should use a list of job transforms for the route\">#7432</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jan-17 11:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a8317b2a95f83a786fc0d5c6f6060ed96bbafb3f\">[58864]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7432\" onclick=\"get_ticket_and_populate_wrapper('7432'); return false;\" title=\"Job router should use a list of job transforms for the route\">#7432</a></span>, add knobs to default <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxIdleJobs\" title=\"Max Idle Jobs\">MaxIdleJobs</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxJobs\" title=\"Max Jobs\">MaxJobs</a></span> for all routes update manual for new/changes configuration knobs for job router.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jan-14 14:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/377dd553620b507cf484d05592d1c28efbc6e9e6\">[58841]</a></span>: some docs formatting corrections for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7432\" onclick=\"get_ticket_and_populate_wrapper('7432'); return false;\" title=\"Job router should use a list of job transforms for the route\">#7432</a></span>. add transforms to the index page for misc-concepts  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jan-14 14:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d69bd145d1534d7a14849ab2881d09aaab448030\">[58840]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7432\" onclick=\"get_ticket_and_populate_wrapper('7432'); return false;\" title=\"Job router should use a list of job transforms for the route\">#7432</a></span>, revise the job router documentation for the switch to transform language. add a new page to the docs under misc-concepts for the transform language.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jan-13 09:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a9bd1d55695acfa427022436594ba2a3370554b3\">[58834]</a></span>: fix memory leak in job router. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7432\" onclick=\"get_ticket_and_populate_wrapper('7432'); return false;\" title=\"Job router should use a list of job transforms for the route\">#7432</a></span> add test for job router using job transform syntax JOB_ROUTER_XFORM  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jan-07 15:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bc97a9b35475dd917e194a23fa9c256444efd4a8\">[58812]</a></span>: add basic job router test for JOB_ROUTER_ROUTE_NAMES rename xform_utils function that converts old job router routes so that name reflects what it actually does. remove dead code from condor_transform_ads (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7432\" onclick=\"get_ticket_and_populate_wrapper('7432'); return false;\" title=\"Job router should use a list of job transforms for the route\">#7432</a></span>)  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Dec-16 11:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5f0c2b9a06131c65a30d399d26c7b200186a5be3\">[58664]</a></span>: initial commit for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7432\" onclick=\"get_ticket_and_populate_wrapper('7432'); return false;\" title=\"Job router should use a list of job transforms for the route\">#7432</a></span>, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> using <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=XformUtils\" title=\"Xform Utils\">XformUtils</a></span>, the same library code as schedd JOB_TRANSFORMs. This commit adds an optional new configuration syntax for the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> where routes are defined as of a list of transforms. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Apr-21 14:42", "status": "resolved", "created": "2019-Dec-13 13:55", "fixed_version": "2019-Dec-13 13:55", "broken_version": "", "priority": "3", "subsystem": "", "assigned_to": "johnkn", "derived_from": "#7284", "creator": "johnkn", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "blin@cs.wisc.edu", "due_date": ""}