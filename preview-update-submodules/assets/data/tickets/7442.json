{"id": 7442, "title": "Ticket #7442: Get cgroup memory usage from memory.usage_in_bytes, not rss fields", "description": "<blockquote>\nToday, when cgroups are enabled, the memory usage by a job come from summing the total_rss, total_mapped_file, and total_swap fields of the memory cgroup.  However, this is not the total amount of physical memory used.  There are several other sources of memory, like kernel data structure, caches, etc.\n\n<p>In addition to under-reporting memory, the memory limit that we currently report is less than the limit used to kill processes that have reached their provisioned limit.  This causes all kinds of surprises with users, and difficulty with condor, which ignores the OOM killer, if it thinks the job is under the allocation.\n\n</p><p>Therefore, we will switch the memory reporting to the field memory.usage_in_bytes, which is the total physical memory used by processes in the cgroup, and the limit against which the OOM is checked.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-May-18 11:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f2e270199c62c737d43e0909344f0f88915f816b\">[59670]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7442\" onclick=\"get_ticket_and_populate_wrapper('7442'); return false;\" title=\"Get cgroup memory usage from memory.usage_in_bytes, not rss fields\">#7442</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7453\" onclick=\"get_ticket_and_populate_wrapper('7453'); return false;\" title=\"Advertise SubmitterShare in Accouting ad\">#7453</a></span>) Version history entries for 8.9.7  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-13 10:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b2583c3cee6531bd600b0962cb823cf0a14798fe\">[59338]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7442\" onclick=\"get_ticket_and_populate_wrapper('7442'); return false;\" title=\"Get cgroup memory usage from memory.usage_in_bytes, not rss fields\">#7442</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Dec-23 09:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8f94d477ba85b5ac0de196e3a07ae2fd3f730b00\">[58743]</a></span>: Return memory.usage_in_bytes from memory cgroup <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7442\" onclick=\"get_ticket_and_populate_wrapper('7442'); return false;\" title=\"Get cgroup memory usage from memory.usage_in_bytes, not rss fields\">#7442</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Apr-13 10:50", "status": "resolved", "created": "2019-Dec-23 09:15", "fixed_version": "2019-Dec-23 09:15", "broken_version": "v080905", "priority": "2", "subsystem": "", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "", "due_date": ""}