{"id": 5101, "title": "Ticket #5101: Infinite loop in non-blocking authentication", "description": "<blockquote>\nWhen doing non-blocking authentication, a daemon can go into an infinite loop retrying and failing the same method, quickly eating up all memory with an ever-growing error stack object.\n\n<p>The problem occurs in Authentication::authenticate_continue() on the server side of the connection in non-blocking mode. To trigger, a call to handshake() returns \"would block\" and the subsequent call to the chosen authentication method's authenticate() call returns failure. The next time (and all future times) through the while loop in authenticate_continue(), we don't call handshake() and retry the previous authentication method, which fails because the two sides are now out-of-sync. As the server spins in the loop, it devours memory adding errors to the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CondorError\" title=\"Condor Error\">CondorError</a></span> object.\n\n</p><p>It appears the infinite loop can be broken if SEC_x_AUTHENTICATION_TIMEOUT is set to something other than \"unlimited\". The manual states that the default value of SEC_DEFAULT_AUTHENTICATION_TIMEOUT is 20, but the actual default is \"unlimited\" for both 8.2 and 8.3.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-19 12:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4cc5ba49e12633f451567d4ad9325defe67d35f0\">[45105]</a></span>: fix minor typo in 8.3.6 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5101\" onclick=\"get_ticket_and_populate_wrapper('5101'); return false;\" title=\"Infinite loop in non-blocking authentication\">#5101</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-19 12:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/45c1f6b79e3a3c0887cda3c9de1c21914f9c5e85\">[45103]</a></span>: to avoid merging woes, add directly to 8.3.6: default of SEC_*_AUTHENTICATION_TIMEOUT is currently unlimited, not 20s. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5101\" onclick=\"get_ticket_and_populate_wrapper('5101'); return false;\" title=\"Infinite loop in non-blocking authentication\">#5101</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-19 11:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/95f126fc9eb5ad85cefc65ed3aff0540919afe21\">[45102]</a></span>: default of SEC_*_AUTHENTICATION_TIMEOUT is currently unlimited, not 20s. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5101\" onclick=\"get_ticket_and_populate_wrapper('5101'); return false;\" title=\"Infinite loop in non-blocking authentication\">#5101</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-19 11:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8fecec43709ceffdeebd90f1c80e97dfd98093fa\">[45100]</a></span>: Docs for infinite loop during authentication bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5101\" onclick=\"get_ticket_and_populate_wrapper('5101'); return false;\" title=\"Infinite loop in non-blocking authentication\">#5101</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-16 23:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e61a60db47655b798075504503c1273aba40753d\">[45087]</a></span>: Fix inifite loop when doing non-blocking authentication. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5101\" onclick=\"get_ticket_and_populate_wrapper('5101'); return false;\" title=\"Infinite loop in non-blocking authentication\">#5101</a></span> Always call Authentication::handshake() after an authentication method fails on the server side. Otherwise, we can end up in an infinite loop eating up memory with an ever-increasing error stack object.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Jun-19 11:24", "status": "resolved", "created": "2015-Jun-16 23:02", "fixed_version": "2015-Jun-16 23:02", "broken_version": "v080301", "priority": "1", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "#4137", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}