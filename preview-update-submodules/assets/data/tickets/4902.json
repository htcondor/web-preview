{"id": 4902, "title": "Ticket #4902: OnExitHold on windows in local universe broken", "description": "<blockquote>\nGiven the following submit file and script, when ON_EXIT_HOLD is true, it runs, gets evicted and runs again continually.\n\n<p></p><div class=\"code\">\n<pre class=\"code\">universe = local\nexecutable = x_time.pl\nlog = job_core_onexithold_local.user_log.23976.1\nhold = False\narguments = 5\nnotification = never\n\n\non_exit_hold = (time() - QDate) &gt; 1\n\nqueue 1\n</pre></div>\n\n<div class=\"code\">\n<pre class=\"code\">#!/usr/bin/env perl\n##**************************************************************\n##\n## Copyright (C) 1990-2007, Condor Team, Computer Sciences Department,\n## University of Wisconsin-Madison, WI.\n##\n## Licensed under the Apache License, Version 2.0 (the \"License\"); you\n## may not use this file except in compliance with the License.  You may\n## obtain a copy of the License at\n##\n##    http://www.apache.org/licenses/LICENSE-2.0\n##\n## Unless required by applicable law or agreed to in writing, software\n## distributed under the License is distributed on an \"AS IS\" BASIS,\n## WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n## See the License for the specific language governing permissions and\n## limitations under the License.\n##\n##**************************************************************\n\n\n##\n## Simply prints out the current Unix timestamp\n## Yet if a second arg exists, it writes it to a file.\n##\nif($ARGV[1]) {\n\topen(WR,\"&gt;&gt;$ARGV[1]\") or die \"Can not open $ARGV[1]:$!\\n\";\n\tprint WR time().\"\\n\";\n\tclose(WR);\n} else {\n\tprint time().\"\\n\";\n}\n\n##\n## We can be told to sleep for a bit as well\n##\nif ( $ARGV[0] ) {\n\tsleep( $ARGV[0] );\n}\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2015-Feb-19 15:04:41 by jfrey:</em> <br/>\n\nFor all local universe jobs in the test suite, the schedd says that the starter exit with exception ACCESS_VIOLATION. The schedd then reruns the job repeatedly. The starter log says that it's exiting with the appropriate exit code to tell the schedd what to do with the job (let it leave the queue, rerun it, put it on hold).\nThe starter is probably crashing at exit due to code run in DC_Exit() or a global destructor.\n\n<p>Most of the tests for local universe succeed because the starter writes the appropriate user log events before exiting, so the test thinks everything is fine.\n\n</p><p></p><hr/>\n<em>2015-Feb-27 10:51:07 by jfrey:</em> <br/>\n\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4909\" onclick=\"get_ticket_and_populate_wrapper('4909'); return false;\" title=\"Make tear-down methods safe to call after DaemonCore is deleted\">#4909</a></span> should fix this problem.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-19 13:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/71a025d525eaec1b9ca54ff1d28e23683671c256\">[43420]</a></span>: Add version history item for 2 8.3.3 known bugs. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4902\" onclick=\"get_ticket_and_populate_wrapper('4902'); return false;\" title=\"OnExitHold on windows in local universe broken\">#4902</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4856\" onclick=\"get_ticket_and_populate_wrapper('4856'); return false;\" title=\"Enable ENCRYPT_EXECUTE_DIRECTORY on Linux and from submit file\">#4856</a></span>  (By Karen Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-May-15 13:08", "status": "resolved", "created": "2015-Feb-19 12:41", "fixed_version": "2015-Feb-19 12:41", "broken_version": "v080303", "priority": "4", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "#4520", "creator": "bt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bt@cs.wisc.edu", "due_date": ""}