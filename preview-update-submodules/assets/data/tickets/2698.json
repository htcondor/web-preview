{"id": 2698, "title": "Ticket #2698: Allow Condor to manage chroots", "description": "<blockquote>\nFor CMS, we have a need to continue to provide a SL5 environment at sites that switch to SL6.\n\n<p>PBS already has the ability to invoke chroot prior to launching jobs.  I propose to add a similar mechanism to Condor, based upon the work started in <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2015\" onclick=\"get_ticket_and_populate_wrapper('2015'); return false;\" title=\"Take advantage of filesystem namespaces\">#2015</a></span>.\n\n</p><p>Patch to follow.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Dec-27 17:52:07 by gthain:</em> <br/>\n\nbrian:\n\n<p>did you forget a .h file from the most recent commit?  I pushed this commit (with enough to get it to work_, but it would be nice if the ticket had the .h file.\n\n</p><p></p><hr/>\n<em>2011-Dec-28 15:10:17 by tannenba:</em> <br/>\n\nWondering how this was tested, since before commit <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9bc6044c2185450308ae9f03b7a0ded6d2b139ee\">[28937]</a></span> the startd would simply crash due to lack of correct memory management re data member MachAttributes::m_named_chroot.\nIf config param NAMED_CHROOT was not defined, it would crash when it inserted a classad attribute with an uninitialized value.  If NAMED_CHROOT was defined, then it would crash since m_named_chroot pointed to the value of a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyString\" title=\"My String\">MyString</a></span> that was out of scope. Stuff like this being pushed worries me...\n\n<p></p><hr/>\n<em>2011-Dec-28 18:14:23 by bbockelm:</em> <br/>\n\nHi Todd,\n\n<p>This is my fault, sorry.  When I attached the patch, I accidentally dropped the diff to the header ResAttributes.h (which declared m_named_chroot as a std::string).  Greg was trying to be helpful (I'm off work until Jan 3 and avoiding email to some extent) and added it in as a \"char *\" instead.\n\n</p><p>Unfortunately, the difference between std::string (which is how I tested it locally) and \"char *\" was enough to cause&amp;#160;the initialization issue.\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2012-Apr-09 10:24:28 by tstclair:</em> <br/>\n\nIt looks like all the docs have been done for some time, I'm sure if I'm wrong someone will kick back ;-)</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/503/chroot_v1.patch\">chroot_v1.patch</a>\n6351 bytes added by bbockelm on 2011-Dec-07 22:47:37 UTC.\n<br/>\nInitial patch.  Notes:\n   *: It's important that chroot is only called if all the paths are owned by root.  Who is responsible for checking this - the sysadmin or condor?\n   *: The available chroot names are not currently advertised by the startd ad.  What attribute name is suggested?<br/>\n</li><li><a href=\"../files/510/chroot_advertise.patch\">chroot_advertise.patch</a>\n1456 bytes added by bbockelm on 2011-Dec-19 23:00:46 UTC.\n<br/>\nAdditional patch for this ticket - advertise the possible chroots in the starter ad.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Feb-15 12:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bcac6c3f0aa8c7aeaa8211e907167a2a3ab55ec4\">[30617]</a></span>: Document new params for NAMED_CHROOT and MOUNT_UNDER_SCRATCH in param table <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2698\" onclick=\"get_ticket_and_populate_wrapper('2698'); return false;\" title=\"Allow Condor to manage chroots\">#2698</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-28 15:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9bc6044c2185450308ae9f03b7a0ded6d2b139ee\">[28937]</a></span>: Fixed uninitialized memory bug causing startd to crash on startup. Problem was in new chroot support. No version history update needed, as this fixes a bug in code that was not yet released. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2698\" onclick=\"get_ticket_and_populate_wrapper('2698'); return false;\" title=\"Allow Condor to manage chroots\">#2698</a></span> ===VersionHistory:None===  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-27 17:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9755218d1142974b9002c44f465f61771f568359\">[28930]</a></span>: Final commit for named chroots <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2698\" onclick=\"get_ticket_and_populate_wrapper('2698'); return false;\" title=\"Allow Condor to manage chroots\">#2698</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-14 15:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/01e2ee195b4fdcedcd95c3af419c465c008873b1\">[28788]</a></span>: documentation for starter's new job chroot-ability ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2698\" onclick=\"get_ticket_and_populate_wrapper('2698'); return false;\" title=\"Allow Condor to manage chroots\">#2698</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-12 13:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/91b70f1c24a0381c34cceb05a26cad3f989562ad\">[28722]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2698\" onclick=\"get_ticket_and_populate_wrapper('2698'); return false;\" title=\"Allow Condor to manage chroots\">#2698</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-12 11:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/852ff2290a9d7dc37575c97b8e4448375ca808eb\">[28716]</a></span>: Initial commit of chroot code <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2698\" onclick=\"get_ticket_and_populate_wrapper('2698'); return false;\" title=\"Allow Condor to manage chroots\">#2698</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-May-03 09:15", "status": "resolved", "created": "2011-Dec-07 16:41", "fixed_version": "2011-Dec-07 16:41", "broken_version": "", "priority": "4", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "tstclair@redhat.com", "due_date": ""}