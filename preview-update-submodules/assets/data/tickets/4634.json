{"id": 4634, "title": "Ticket #4634: condor_kbdd heap corruption", "description": "<blockquote>\nThis was reported by CAE. The KBDD is crashing when it is started with an error 0xC0000374, which is the heap corruption error reported by the Windows kernel. This error pretty much only happens when using the HeapXXX apis.\n\n<p>They report that the crash only happens when the condor bin directory is not in the path.  Here's the stack trace (using an 8.2.3 release build)\n\n</p><p></p><pre>     ntdll.dll!_RtlReportCriticalFailure@8\u001e()    Unknown\n     ntdll.dll!_RtlpReportHeapFailure@4\u001e()    Unknown\n     ntdll.dll!_RtlpLogHeapFailure@24\u001e()    Unknown\n     ntdll.dll!_RtlFreeHeap@12\u001e()    Unknown\n     KernelBase.dll!_GlobalFree@4\u001e()    Unknown\n     condor_kbdd.exe!WinMain(HINSTANCE__ * hInstance, HINSTANCE__ * hPrevInstance, char * lpCmdLine, int nShowCmd) Line 244    C++\n     condor_kbdd.exe!__tmainCRTStartup() Line 528    C\n     [External Code]\n     [Frames below may be incorrect and/or missing, no symbols loaded for kernel32.dll]</pre>\n</blockquote>", "remarks": "<blockquote>\n<em>2014-Oct-06 11:06:19 by gthain:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Looks good to me.  Internet search confirms that GetCommandLineW() returns a pointer that shouldn't be freed.  There's no other places in HTCondor code that free the return value of this function.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-06 11:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/28ecce3476ce02788cf6b856b8c21b3e7cd96b03\">[41593]</a></span>: minor 8.2.4 version history item edit <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4634\" onclick=\"get_ticket_and_populate_wrapper('4634'); return false;\" title=\"condor_kbdd heap corruption\">#4634</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-06 09:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/01e64aed1700808b6ff4be6d4de0620c7378f500\">[41589]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4638\" onclick=\"get_ticket_and_populate_wrapper('4638'); return false;\" title=\"Disk space machine attributes on Windows are incorrect\">#4638</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4634\" onclick=\"get_ticket_and_populate_wrapper('4634'); return false;\" title=\"condor_kbdd heap corruption\">#4634</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3572\" onclick=\"get_ticket_and_populate_wrapper('3572'); return false;\" title=\"Daylight savings time causes master to restart on Windows\">#3572</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-02 14:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f5b13f51f6375b5a26516c2c853e63e899f9189b\">[41319]</a></span>: fix windows heap trashing bug in the condor_kbdd on Windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4634\" onclick=\"get_ticket_and_populate_wrapper('4634'); return false;\" title=\"condor_kbdd heap corruption\">#4634</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Nov-06 10:11", "status": "resolved", "created": "2014-Oct-02 12:01", "fixed_version": "2014-Oct-02 12:01", "broken_version": "v080000", "priority": "2", "subsystem": "Daemons", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}