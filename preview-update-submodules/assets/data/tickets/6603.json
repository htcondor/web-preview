{"id": 6603, "title": "Ticket #6603: HTCondor can't run jobs when HTCondor is started in a docker container", "description": "<blockquote>\nIf condor is started inside a docker container, the default settings give it uid 0, but many of the rootly capabilities are removed.  In particular, the cgroups are mounted read-only, so no new cgroups can be created.  As condor 8.6 now uses cgroups if they are visible, this creates problem.\n\n<p>Users can work around this by starting the docker container with the --privilege flag today.  This ticket will change the starter to check not just that the starter has root, but also the appropriate capability to create new cgroups.</p></blockquote>", "remarks": "<blockquote>\n<strong>CODE_REVIEW</strong> : change looks good.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-04 11:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/53ad5d114db147a0377a255bd15ddb8be996a768\">[54838]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6603\" onclick=\"get_ticket_and_populate_wrapper('6603'); return false;\" title=\"HTCondor can't run jobs when HTCondor is started in a docker container\">#6603</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Mar-14 13:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/255d48a5581245ab0f4ff00bd690a5c3d7831e58\">[54504]</a></span>: Check that starter has CAP_SYSADMIN before trying to create group <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6603\" onclick=\"get_ticket_and_populate_wrapper('6603'); return false;\" title=\"HTCondor can't run jobs when HTCondor is started in a docker container\">#6603</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2018-May-09 13:42", "status": "resolved", "created": "2018-Mar-14 13:09", "fixed_version": "2018-Mar-14 13:09", "broken_version": "v080700", "priority": "3", "subsystem": "DaemonsExecNode", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}