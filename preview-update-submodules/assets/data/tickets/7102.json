{"id": 7102, "title": "Ticket #7102: schedd crashed on ARM due to clone's stack alignment", "description": "<blockquote>\nSteffen from AEI reports that a remote condor_history query consistently crashes the schedd.  Stack trace shows it is in the clone_fn call.  Setting USE_CLONE_TO_EXEC_PROCESSES = false makes the crash stop.\n\n<p>Documentation reveals that on ARM (and perhaps other architectures?) the stack passed to clone has to be 16 byte aligned.  It won't hurt, and will probably help a bit do this these on all architectures.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Jul-08 11:34:12 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>When you calculate <code>child_stack_ptr</code>, you need to include the extra 16 bytes in your array indexing. Otherwise, after masking out the lowest four bits in the address, the top end of the stack (lowest address) can end up outside of the declared array.\n\n</p><p>You only need 15 bytes of padding, not that having 16 hurts.\n\n</p><p></p><hr/>\n<em>2019-Jul-09 16:27:38 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>The change looks good.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jul-09 08:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d82cecb4dda731b3a881b6d3932709894037abd1\">[57354]</a></span>: Fixes for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7102\" onclick=\"get_ticket_and_populate_wrapper('7102'); return false;\" title=\"schedd crashed on ARM due to clone's stack alignment\">#7102</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-19 11:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/06bb46156b9a96a90458c79bbc18ee7eb2b921e5\">[57171]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7102\" onclick=\"get_ticket_and_populate_wrapper('7102'); return false;\" title=\"schedd crashed on ARM due to clone's stack alignment\">#7102</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-10 09:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8544d647ffa77aaf9864543d4cbc14e2c89ad961\">[57130]</a></span>: When clone'ing align stack pointer to 16 bytes <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7102\" onclick=\"get_ticket_and_populate_wrapper('7102'); return false;\" title=\"schedd crashed on ARM due to clone's stack alignment\">#7102</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Jul-09 16:27", "status": "resolved", "created": "2019-Jun-10 09:34", "fixed_version": "2019-Jun-10 09:34", "broken_version": "v080000", "priority": "3", "subsystem": "", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}