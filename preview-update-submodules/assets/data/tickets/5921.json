{"id": 5921, "title": "Ticket #5921: MATCH info dropped from user log on claim reuse", "description": "<blockquote>\nCMS is seeing MATCH info dropped very frequently from its user logs - this is unfortunate, as our job tracking mechanism appears to ignore the job in the case of missing information.  This further wreaks havoc downstream in CMS land.\n\n<p>The MATCH info gets to the job's user log via <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobAdInformationAttrs\" title=\"Job Ad Information Attrs\">JobAdInformationAttrs</a></span>; we have 8 attributes requested.  7 show up in all jobs while the last one, MATCH_EXP_JOBGLIDEIN_CMSSite (pulling JOBGLIDEIN_CMSSite from the matched job), is frequently missing.\n\n</p><p>Best I can figure, this happens only when claims are reused.  Is there something \"different\" about who writes the various job events when claims are reused?</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Sep-26 13:07:19 by bbockelm:</em> <br/>\n\nFWIW, here's how we setup this particular <code>MATCH_EXP_</code> variable:\n<div class=\"verbatim\">\n<pre># condor_history -match 1 -l 37584.25 | grep JOBGLI\nJobAdInformationAttrs = \"JobStatus,QDate,EnteredCurrentStatus,JobStartDate,DESIRED_Sites,ExtDESIRED_Sites,WMAgent_JobID,MATCH_EXP_JOBGLIDEIN_CMSSite\"\nMATCH_EXP_JOBGLIDEIN_CMSSite = \"T2_US_Nebraska\"\nJOBGLIDEIN_CMSSite = \"$$([ifThenElse(GLIDEIN_CMSSite is undefined, \\\"Unknown\\\", GLIDEIN_CMSSite)])\"\n</pre></div>\n\nWhere <code>GLIDEIN_CMSSite</code> is from the machine ad.  So, this might be also related to <code>$$</code> expansion.\n\n<p></p><hr/>\n<em>2016-Sep-26 15:36:18 by bbockelm:</em> <br/>\n\nLowering the priority here - it seems to only trigger if there's a separate race condition that triggers.\n\n<p>We will focus on avoiding the original race condition.\n\n</p><p>NOTE: this problem seems to be due to the fact that the <code>MATCH_EXP_</code> attributes are persisted in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> - but are missing from the ad sent to the shadow.  There must be some cases where they do make it to the shadow (original claim?  Job restarted?) because this approach periodically works.\n\n</p><p>The issue is trivial to reproduce, but it's easy to argue CMS shouldn't be looking at these attributes in the first place.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2016-Sep-26 15:36", "status": "new", "created": "2016-Sep-26 12:58", "fixed_version": "2016-Sep-26 12:58", "broken_version": "", "priority": "3", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}