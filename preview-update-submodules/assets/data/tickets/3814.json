{"id": 3814, "title": "Ticket #3814: RemoteSysCpu has impossibly large values", "description": "<blockquote>\nfrom <a class=\"external\" href=\"https://ticket.grid.iu.edu/goc/16096\">https://ticket.grid.iu.edu/goc/16096</a>\n\n<p></p><ul>\n<li>The problem certainly seems to lie with HTCondor itself, not Gratia or the charting code. We see actual HTCondor log records with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RemoteSysCpu\" title=\"Remote Sys Cpu\">RemoteSysCpu</a></span> set to 2147483648, which is suspiciously close to 32-bit MAXINT.\n</li><li>If the problem can be found and fixed soon, a bug fix could become part of HTCondor 8.0.2.\n</li><li>Depending on the nature of the fix, there may be an update to HTCondor 7.8 and/or a patch to the OSG packaging of HTCondor 7.8.8.\n</li><li>If it is not possible to fix HTCondor in a reasonable timeframe, we could patch Gratia itself to ignore the records with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RemoteSysCpu\" title=\"Remote Sys Cpu\">RemoteSysCpu</a></span> = 2147483648. This would mean some data loss, but at least the obviously false records would not affect overall statistics.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2013-Jul-31 14:38:49 by johnkn:</em> <br/>\n\na check of the history file on submit-1 CHTC, shows 4 jobs that have unbelievable CPU usage values:\n\n<p></p><div class=\"verbatim\">\n<pre>     JobId      RemoteSysCpu      RemoteUserCpu   CumulativeSlotTime\n28906547.0   6,329,339,392.0   12,409,271,296.0          8,712,786.0\n28962959.0  14,982,681,600.0    3,468,979,456.0          6,607,614.0\n29021300.0     638,206,784.0   17,812,955,136.0          4,739,298.0\n29021303.0  18,136,133,632.0      315,638,368.0          5,043,288.0\n</pre></div>\n\n\n<p>All of these jobs are owned by the same user, all were running on one of the GZK machines, but not all on the same machine. all had <code>RequestCpus</code> of 6\n\n</p><p></p><hr/>\n<em>2013-Aug-02 16:16:51 by johnkn:</em> <br/>\n\n<span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4f9c14f7a3519ae10593af75170ac8f17747084d\">[37081]</a></span> needs very careful review because it's a change in stable.\n\n<p></p><hr/>\n<em>2013-Aug-05 14:16:54 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>These changes look good, except for the following points:\n\n</p><p></p><ul>\n<li>In <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AttrListPrintMask\" title=\"Attr List Print Mask\">AttrListPrintMask</a></span>, the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FloatCustomFmt\" title=\"Float Custom Fmt\">FloatCustomFmt</a></span> function signature now takes a double instead of a float. But when it's used, the caller passes in a float. AttrListPrintMask::calc_widths() and AttrListPrintMask::display() should be modified to compute a double and call the function using that value.\n\n<p></p></li><li>In prettyPrint.cpp, the declaration of formatFloat() is modified to change a float argument to a double, but the definition is not. The definition should be modified as well.\n</li></ul>\n\n<p></p><hr/>\n<em>2013-Aug-08 10:08:36 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>The new changes address the issues I had with the initial commit. <strong>Thumbs up</strong>\n\n</p><p></p><hr/>\n<em>2013-Sep-03 16:16:38 by johnkn:</em> <br/>\n\nHTCondor 8.0.2 has changes that <strong>might</strong> fix this bug.  What we need now is to have 8.0.2 deployed in the places where we have seen this bug.  Then someone needs to check and see if we are still getting unreasonably large values or not.\n\n<p></p><hr/>\n<em>2013-Sep-03 16:33:43 by cat:</em> <br/>\n\nAccording to the ticket, submit-1 on CHTC was affected by this issue, so we can look for the large values there, right?\n\n<p></p><hr/>\n<em>2013-Sep-13 11:20:20 by tannenba:</em> <br/>\n\nWe hope/think the below commit fixed the problem, but hard to tell for sure because no solid repro. Moving from pending to resolved; ticket will be reopened if we see the problem again.\n\n<p></p><hr/>\n<em>2013-Sep-17 16:08:19 by tim:</em> <br/>\n\nTanya Levshina (from OSG) reports in (JIRA Ticket) SOFTWARE-1132 that this is still a problem with HTCondor 8.0.2\n\n<p></p><hr/>\n<em>2013-Sep-18 09:32:25 by cat:</em> <br/>\n\nTo add some detail....\n\n<p>Tanya Levshina &lt;tlevshin@fnal.gov&gt; is indeed reporting more crazy data. I will try to attach a condor_history record with sample data in a minute.\n\n</p><p>There is <a class=\"external\" href=\"https://ticket.grid.iu.edu/goc/17090\">a new GOC ticket</a> with information about the OSG side of the problem. However, not all of that ticket is interesting here, because it concerns our changes to Gratia to suppress the clearly invalid data.\n\n</p><p></p><hr/>\n<em>2013-Sep-18 13:42:40 by bbockelm:</em> <br/>\n\nJust as a curious observation - they reported system CPU as 18446744476; an unsigned 64-bit int maxes out at 18446744073709551616.  The numbers don't line up, of course, but the fact the first 8 digits max is quite intriguing.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=3915\" onclick=\"get_ticket_and_populate_wrapper('3915'); return false;\" title=\"Classad time_t values should be changed from double to int64\">#3915</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nClassad time_t values should be changed from double to int64</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/804/39691901.0.out.txt\">39691901.0.out.txt</a>\n6723 bytes added by cat on 2013-Sep-18 14:33:20 UTC.\n<br/>\ncondor_history sample from 8.0.2 with bad Remote*Cpu data.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Sep-19 10:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/41caf3c37fbc29f125cc4e617e4625e398d76e80\">[37671]</a></span>: minor edit to 8.0.3 version history item <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=3814\" onclick=\"get_ticket_and_populate_wrapper('3814'); return false;\" title=\"RemoteSysCpu has impossibly large values\">#3814</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Sep-13 11:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fe74875533b026c0bba0d88f2506e2e74c60989b\">[37592]</a></span>: weasel worded version history for <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=3814\" onclick=\"get_ticket_and_populate_wrapper('3814'); return false;\" title=\"RemoteSysCpu has impossibly large values\">#3814</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-07 18:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/df54685cf1d6ce43ebdeef05450fcd8984976dbe\">[37124]</a></span>: additional conversions of float to double for <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=3814\" onclick=\"get_ticket_and_populate_wrapper('3814'); return false;\" title=\"RemoteSysCpu has impossibly large values\">#3814</a></span>. ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-02 16:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4f9c14f7a3519ae10593af75170ac8f17747084d\">[37081]</a></span>: for <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=3814\" onclick=\"get_ticket_and_populate_wrapper('3814'); return false;\" title=\"RemoteSysCpu has impossibly large values\">#3814</a></span>, remove all unnecessary type conversions of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RemoteSysCpu\" title=\"Remote Sys Cpu\">RemoteSysCpu</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RemoteUserCpu\" title=\"Remote User Cpu\">RemoteUserCpu</a></span> and like attributes ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Feb-05 11:01", "status": "defer", "created": "2013-Jul-25 17:41", "fixed_version": "2013-Jul-25 17:41", "broken_version": "v080000", "priority": "4", "subsystem": "Libs", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "johnkn@cs.wisc.edu, cat@cs.wisc.edu", "due_date": ""}