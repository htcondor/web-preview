{"id": 6869, "title": "Ticket #6869: scitokens: Abandon ZKM_QUERY_CREDS", "description": "<blockquote>\nLooking at the RPC protocol (<code>ZKM_QUERY_CREDS</code>) between <code>condor_submit</code> and the <code>condor_credd</code> for token submission, I have come to the conclusion it is unfixable:\n\n<p></p><ul>\n<li>There is no mechanism for an error message to be passed or for the credd to otherwise indicate an error has occurred.\n</li><li>It's named <code>ZKM_QUERY_CREDS</code>.\n</li><li>It's narrowly limited to the web workflow, which is not necessarily always going to be the case.\n</li></ul>\n\n<p>The code is 90% salvageable, however, as we simply just need to tweak the protocol to make it more flexible.  I propose we instead:\n\n</p><p></p><ul>\n<li>Create a new command int that is not literally named after the developer.\n</li><li>In the new command int, we have it respond with a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> instead of a string.  This should allow for error messages, among other things.\n</li><li>Do the normal protocol evolution based on the version of the remote <code>condor_credd</code>.\n</li></ul>\n\n<p>By responding with a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>, we can indicate that <code>condor_submit</code> should respond to missing credentials by having the job start off on hold -- and we can record which credentials are missing!\n\n</p><p>Once we evolve this protocol slightly, we have more flexibility to do things like make OAuth tokens compatible with Pegasus and provide a reasonable Python binding to the credd.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2019-May-06 16:00", "status": "new", "created": "2019-Jan-17 09:56", "fixed_version": "2019-Jan-17 09:56", "broken_version": "", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "jpatton", "derived_from": "#6513", "creator": "bbockelm", "rust": "", "customer_group": "scitokens", "visibility": "public", "notify": "bbockelman@morgridge.org; tannenba@cs.wisc.edu", "due_date": ""}