{"id": 2406, "title": "Ticket #2406: Input files are transferred with output when job is spooled", "description": "<blockquote>\nIf a job's files are stored in the spool directory, then when output files are transferred from the starter to the shadow, all input files are transferred. Normally, unmodified input files are not transferred as part of the job's output. The normal ways a job's files end up in the spool directory are when it's submitted by Condor-C or by condor_submit with the -spool or -remote argument.\n\n<p><span class=\"subsection\"></span></p><h3>Milestones </h3>\n\n<p></p><ul>\n<li>Determine why input files are transferred as output only when a job is spooled. <strong>[DONE]</strong>\n</li><li>Fix it. <strong>[DONE]</strong>\n</li><li>Code review.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Aug-25 13:16:05 by jfrey:</em> <br/>\n\nThis is happening because the shadow adds all files in the job spool directory to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TransferIntermediate\" title=\"Transfer Intermediate\">TransferIntermediate</a></span> in the job ad that it sends to the starter. Since the FileTransfer's file catalog isn't stored persistently, we need to change how the shadow consults it.\n\n<p></p><hr/>\n<em>2011-Aug-25 15:14:28 by jfrey:</em> <br/>\n\nI have a patch that fixes this bug by having the shadow tell the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> object to create a file catalog if the job's files are spooled. This will cause the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> to not add unmodified input files to the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TransferIntermediate\" title=\"Transfer Intermediate\">TransferIntermediate</a></span> attribute.\n\n<p></p><hr/>\n<em>2011-Sep-23 15:19:49 by danb:</em> <br/>\n\nCode review:\n\n<p>I don't see how this works, but I'm probably just not understanding things due to the complexity of the file transfer object.  The transfer object in the shadow builds a file catalog of all the spooled files.  Then it generates a list of intermediate files, excluding those in the catalog.  Doesn't that mean it excludes everything in the spool, including both the input files (good) and the intermediate files (bad)?\n\n</p><p>--Dan\n\n</p><p></p><hr/>\n<em>2012-Jun-14 15:40:11 by jfrey:</em> <br/>\n\nWhen the job's input files are spooled, it should be ok to treat intermediate files as input files in the shadow. They should be sent to the starter and they don't have to be transferred back to the shadow if they're not modified. Their final location is the spool directory as far as the shadow is concerned.\n\n<p></p><hr/>\n<em>2012-Jun-14 15:44:38 by jfrey:</em> <br/>\n\nThere's a possible security problem due to this bug. If the job has an x509 proxy, it may be transferred in the clear along with the output files.\n\n<p></p><hr/>\n<em>2012-Jun-20 16:35:37 by jfrey:</em> <br/>\n\nThe file named in the X509UserProxy job attribute is explicitly not transferred as an output file in the file transfer object. If a proxy is listed as an ordinary input file, then it will be transferred in both directions, but not delegated. If Condor is going treat such input files specially, it will need assistance identifying them from the user.\n<hr/>\n<em>2012-Aug-23 14:09:08 by zmiller:</em> <br/>\n\nBulk change of target version from v070802 to v070803 using ./ticket-target-mover.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2423\" onclick=\"get_ticket_and_populate_wrapper('2423'); return false;\" title=\"FileTransfer shouldn't back-date file modification times\">#2423</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\n<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> shouldn't back-date file modification times</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/447/file_xfer.patch\">file_xfer.patch</a>\n1965 bytes added by jfrey on 2011-Aug-25 20:12:52 UTC.\n<br/>\nPatch to fix transferring of input files as output.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-16 10:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5bbf55d9a39c34192d8243fc063b786bc666ab80\">[32783]</a></span>: minor edit to 7.8.2 version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2406\" onclick=\"get_ticket_and_populate_wrapper('2406'); return false;\" title=\"Input files are transferred with output when job is spooled\">#2406</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jun-21 16:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8b4672e2ae101927746bdc38341a5b9115b39c58\">[32451]</a></span>: Input files no longer transferred as output files. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2406\" onclick=\"get_ticket_and_populate_wrapper('2406'); return false;\" title=\"Input files are transferred with output when job is spooled\">#2406</a></span> If a job's input files were stored in the spool directory, then the starter would transfer all input files along with the output files after job completion. This is because the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> object in the shadow considered all files in the spool\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Aug-23 14:09", "status": "resolved", "created": "2011-Aug-22 13:15", "fixed_version": "2011-Aug-22 13:15", "broken_version": "v070600", "priority": "2", "subsystem": "Unknown", "assigned_to": "jfrey", "derived_from": "#1376", "creator": "jfrey", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "matt@cs.wisc.edu, tstclair@redhat.com", "due_date": "20110824"}