{"id": 1735, "title": "Ticket #1735: AccountGroup can't be set by SUBMIT_EXPRS", "description": "<blockquote>\nWhen using accounting groups, the typical form is something like this in the submit file:\n<div class=\"code\">\n<pre class=\"code\">+AccountGroup=\"group_staff.adesmet\"\n</pre></div>\n\n\n<p>Both halves are necessary for proper prioritization.\n\n</p><p>A given submit machine might be exclusively used by a single group.  The admin might want to automatically add the correct group, reducing mistakes.  The admin might try something like this in his configuration:\n</p><div class=\"code\">\n<pre class=\"code\">AccountingGroup = strcat(\"group_staff.\", Owner)\nSUBMIT_EXPRS = $(SUBMIT_EXPRS) AccountingGroup\n</pre></div>\n\n\n<p>This doesn't work, as <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AccountingGroup\" title=\"Accounting Group\">AccountingGroup</a></span> is only ever read with AttrList::LookupString, not AttrList::EvalString.\n\n</p><p>Proposed: an administrator should be able to automatically add a suitable <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AccountingGroup\" title=\"Accounting Group\">AccountingGroup</a></span> to jobs using SUBMIT_EXPRS.\n\n</p><p><span class=\"section\"></span></p><h2>Option 1: EvalString</h2>\n\n<p>Change all uses of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LookupString\" title=\"Lookup String\">LookupString</a></span> on ATTR_ACCOUNTING_GROUP to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=EvalString\" title=\"Eval String\">EvalString</a></span>.\n\n</p><p>Pros: Leverages existing Condor functionality.  Potentially allows further clever tricks with other functions an attributes.\n\n</p><p>Cons: The policy to set is non-obvious.  The <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AccountingGroup\" title=\"Accounting Group\">AccountingGroup</a></span> might change when re-evaluated; will that cause problems?  (Already a potential problem thanks to condor_qedit, but with an expression it might change while the negotiator is considering it.)\n\n</p><p><span class=\"section\"></span></p><h2>Option 2: Break user off of AccountingGroup</h2>\n\n<p>If the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AccountingGroup\" title=\"Accounting Group\">AccountingGroup</a></span> lacks a specific user (say AccountingGroup=\"group_condor.\") assume the Owner of the job.\n\n</p><p>Pros: Simple to use, both for job submitters and admins.\n\n</p><p>Cons: May require changing a bunch of code; ATTR_ACCOUNTING_GROUP is looked up about 13 times in our code base. They would presumably need to be replaced with a unified \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GetAccountingGroupFromClassAd\" title=\"Get Accounting Group From Class Ad\">GetAccountingGroupFromClassAd</a></span>\"\n\n</p><p><span class=\"section\"></span></p><h2>Option 3: Break AccountingGroup into two fields</h2>\n\n<p>Instead of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AccontingGroup\" title=\"Acconting Group\">AccontingGroup</a></span> containing the user and the group, have it only contain the group and add <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AccountingGroupUser\" title=\"Accounting Group User\">AccountingGroupUser</a></span> to hold the user name.  eje has an extended proposal that includes this at <a class=\"external\" href=\"https://lists.cs.wisc.edu/archive/condor-devel/2012-January/msg00017.shtml\">https://lists.cs.wisc.edu/archive/condor-devel/2012-January/msg00017.shtml</a></p></blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2011-Jan-27 14:50:47 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 16:20:02 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2012-Jan-04 19:42:13 by bbockelm:</em> <br/>\n\nLocally, we solve this by using _CONDOR environment variables in the user's default profile that add in the output of \"id -u\".\n\n<p>See also: <a class=\"external\" href=\"https://condor-wiki.cs.wisc.edu/index.cgi/tktview?tn=2728\">https://condor-wiki.cs.wisc.edu/index.cgi/tktview?tn=2728</a></p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "todo", "last_change": "2012-Jan-12 18:03", "status": "new", "created": "2010-Oct-25 17:19", "fixed_version": "2010-Oct-25 17:19", "broken_version": "v070400", "priority": "4", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "adesmet", "rust": "a21170", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}