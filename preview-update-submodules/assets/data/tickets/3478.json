{"id": 3478, "title": "Ticket #3478: shared_port on dynamic port fails after restart", "description": "<blockquote>\nIf shared_port is using a dynamic port, and the master is using shared port, then if shared_port dies, all subsequent attempts to restart it on a different port fail, because the newly started shared_port tries to send a keepalive to the master by connecting to the address of the old shared port.</blockquote>", "remarks": "<blockquote>\n<em>2013-Feb-04 16:23:00 by danb:</em> <br/>\n\nThe submitted patch allows shared_port to restart and communicate with the master.  There will still be transient communication problems until the address of the old instance of shared_port works its way out of the system.  Daemons periodically refresh their address to incorporate changes to the shared_port address, which may include dynamic info such as CCB stuff.  Expect up to 10 minutes of chaos.  Bottom line: it is still best not to use a dynamic shared port.\n\n<p>An additional improvement could be made.  The master could remember the dynamic port that was chosen for shared_port (or any other daemon, for that matter), and it could attempt to reuse this port in subsequent restarts.  That is orthogonal to this patch, which is still needed in the worst case.\n\n</p><p></p><hr/>\n<em>2013-May-21 16:29:49 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Patch looks good, thanks.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-01 12:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/074d0a5e0138019e4e3a1ca8fd6d54fb97f991dc\">[35039]</a></span>: Minor edit to 7.8.8 version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3478\" onclick=\"get_ticket_and_populate_wrapper('3478'); return false;\" title=\"shared_port on dynamic port fails after restart\">#3478</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Feb-04 16:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b8f253053631001c8b6d062f20c55a654822a2e5\">[34841]</a></span>: Improved shared_port docs with respect to configuration of the port number. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3478\" onclick=\"get_ticket_and_populate_wrapper('3478'); return false;\" title=\"shared_port on dynamic port fails after restart\">#3478</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Feb-04 16:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9723b28407f5872580a83369bb89b156e50e29a3\">[34838]</a></span>: Fixed restart of shared_port when using a dynamic port. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3478\" onclick=\"get_ticket_and_populate_wrapper('3478'); return false;\" title=\"shared_port on dynamic port fails after restart\">#3478</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-May-21 16:30", "status": "resolved", "created": "2013-Feb-04 15:58", "fixed_version": "2013-Feb-04 15:58", "broken_version": "v070500", "priority": "2", "subsystem": "", "assigned_to": "tannenba", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "atlas", "visibility": "public", "notify": "dan@hep.wisc.edu,tannenba@cs.wisc.edu", "due_date": ""}