{"id": 3143, "title": "Ticket #3143: A few missing dep checks for UW builds", "description": "<blockquote>\nI tried doing a UW build on a fresh, minimal Fedora box, and found the cmake dependency checks have a few holes in them for externals:\n\n<p></p><ol>\n<li><div class=\"strike\">\n<strike>The box didn't have wget installed; this was not tested, so obviously all externals failed.  Cmake should have tested for this case.</strike></div>\n\n</li><li><div class=\"strike\">\n<strike>gsoap requires bison-devel to be installed so liby is present.  cmake did not test for this.</strike></div>\n\n</li><li><div class=\"strike\">\n<strike>For deltacloud, I needed to also install libpam and libxml2.  cmake did not test for this.</strike></div>\n\n</li><li><div class=\"strike\">\n<strike>Globus wouldn't build without perl-Archive-Tar.  cmake did not test for this.</strike></div>\n\n</li><li>At \"make -j5\", the gt2_gahp failed to build due to missing Globus headers - globus external was being installed in parallel.  I think there might be a missing dependency between the two.\n</li><li><div class=\"strike\">\n<strike>blahp requires libtoolize</strike></div>\n\n</li><li><div class=\"strike\">\n<strike>deltacloud_gahp requires libxml2 to build successfully, but cmake does not require this.  Because of (2), I was able to get cmake to enable deltacloud but disable libxml2.</strike></div>\n\n</li><li>Similar to (4), it's possible to start building the cream_gahp before the cream external finished building.\n</li></ol>\n\n<p>Most of the issues seem to be due to how bare-bones the Fedora box was and the fact I was starting all externals from scratch.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Jul-19 11:01:45 by bbockelm:</em> <br/>\n\nAnother issue (switched a RHEL5 box to get stdu to compile, so I missed it the first time): machdep.LINUX.cpp.o requires asm/page.h.  Presence of this header is not checked for by cmake.\n\n<p></p><hr/>\n<em>2012-Jul-20 13:42:38 by tstclair:</em> <br/>\n\nI'm confused by <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=3\" onclick=\"get_ticket_and_populate_wrapper('3'); return false;\" title=\"Customize GitTrac\">#3</a></span>.. How did deltacloud-devel not pull in all the deps.\n\n<p></p><hr/>\n<em>2012-Jul-20 13:45:11 by tstclair:</em> <br/>\n\nretract, I see it now.\n\n<p></p><hr/>\n<em>2012-Jul-20 14:35:51 by tstclair:</em> <br/>\n\nkicking to jfrey for the rest of the issues.\n<hr/>\n<em>2012-Oct-22 14:59:59 by zmiller:</em> <br/>\n\nBulk change of target version from v070901 to v070902 using ./ticket-target-mover.\n<hr/>\n<em>2012-Dec-11 16:38:39 by johnkn:</em> <br/>\n\nBulk change of target version from v070902 to v070903 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2013-Jan-03 23:56:51 by jfrey:</em> <br/>\n\nI started with a bare-bones Fedora 17 installation and added checks in the cmake files for all dependencies on missing external packages.\n\n<p></p><hr/>\n<em>2013-Jan-04 06:59:40 by bbockelm:</em> <br/>\n\nHi Jaime,\n\n<p>I tried rebuilding with your fixes.  I hit the \"make -j5\" issue mentioned above and the build bombed as expected.\n\n</p><p>However, when I now rebuild, I get interactive prompts at the patch step (see below).\n\n</p><p>Looking at the patch manpage, I think you want to use the \"-N\" flag, which allows this step to move on if the patch has already been applied.\n\n</p><p>Brian\n\n</p><p></p><div class=\"verbatim\">\n<pre>[  2%] Performing patch step for 'gsoap'\npatching file gsoap/Makefile.in\nReversed (or previously applied) patch detected!  Assume -R? [n]\n</pre></div>\n\n\n<p></p><hr/>\n<em>2013-Jan-04 11:12:06 by jfrey:</em> <br/>\n\nI tried replicating the behavior you described. I killed the build process in the middle of making the gsoap external. When I restarted it, cmake skipped the patch step and went straight to the make step. Perhaps you got very unlucky and your build died in the middle of applying the patches to the gsoap source.\n\n<p>Even if this situation is rare, adding -N to the patch calls would improve things.\n</p><hr/>\n<em>2013-Mar-05 10:58:27 by johnkn:</em> <br/>\n\nBulk change of target version from v070904 to v070905 using ./ticket-target-mover.\n<hr/>\n<em>2013-Apr-22 11:10:10 by johnkn:</em> <br/>\n\nBulk change of target version from v070905 to v070906 using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/668/condor_gt3143.patch\">condor_gt3143.patch</a>\n24860 bytes added by bbockelm on 2013-Jan-04 13:51:40 UTC.\n<br/>\nAllow patch commands to be re-run.  Also, tell CMake which script generates param_info.c - helps with partial builds.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jan-04 16:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3f6c1c354ada231995c2f98c08d46a62c6599d7c\">[34531]</a></span>: Add -N to patch so partial external builds can be re-run, pt 2. <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=3143\" onclick=\"get_ticket_and_populate_wrapper('3143'); return false;\" title=\"A few missing dep checks for UW builds\">#3143</a></span> Missed one external in previous commit.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jan-04 14:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e9ae404732d7897990954c94cce3649d02940384\">[34530]</a></span>: Add -N to patch so partial external builds can be re-run. <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=3143\" onclick=\"get_ticket_and_populate_wrapper('3143'); return false;\" title=\"A few missing dep checks for UW builds\">#3143</a></span> Also, tell CMake which script generates param_info.c - helps with partial builds. Committer: Jaime Frey  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jan-03 23:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/250eec659f6b4477816e835a97c04aadf76c1917\">[34526]</a></span>: Add dependency checks in cmake files. <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=3143\" onclick=\"get_ticket_and_populate_wrapper('3143'); return false;\" title=\"A few missing dep checks for UW builds\">#3143</a></span> Check for the following programs/libraries and fail at configuration time if they're required but missing: libpam, bison, flex, autoconf, automake, libtoolize, perl Archive::Tar, perl Digest::MD5, libcurl, libltdl, libxml2, libexpat, libuuid, libdl.a  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Apr-22 11:10", "status": "stalled", "created": "2012-Jul-19 09:27", "fixed_version": "2012-Jul-19 09:27", "broken_version": "v070800", "priority": "3", "subsystem": "Packaging", "assigned_to": "jfrey", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bbockelm@cse.unl.edu, tstclair@redhat.com, jfrey@cs.wisc.edu", "due_date": ""}