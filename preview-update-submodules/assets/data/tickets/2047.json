{"id": 2047, "title": "Ticket #2047: Locking code stuck in infinite loop", "description": "<blockquote>\nWe observered dagman stuck in an infinite loop this am on submit.chtc.wisc.edu   stack trace showed:\n\n<p></p><div class=\"verbatim\">\n<pre>where\n#0  0x00000039a930bdbe in open64 () from /lib64/tls/libpthread.so.0\n#1  0x000000000059b2db in safe_create_keep_if_exists (fn=0xd2d3860 \"/tmp/condorLocks/68/38/613104503952250.lockc\", flags=2, mode=438)\n    at /home/condor/execute/dir_23073/userdir/src/condor_utils/condor_open.cpp:153\n#2  0x00000000005aacb0 in rec_touch_file (path=0xd2d3860 \"/tmp/condorLocks/68/38/613104503952250.lockc\", file_mode=438, directory_mode=511, pos=44)\n    at /home/condor/execute/dir_23073/userdir/src/condor_utils/directory_util.cpp:132\n#3  0x00000000005b14e6 in FileLock::initLockFile (this=0xd329d90, useLiteralPath=false) at /home/condor/execute/dir_23073/userdir/src/condor_utils/file_lock.cpp:255\n#4  0x00000000005b118f in FileLock (this=0xd329d90, path=0xd395360 \"/home/serbin/BIORUN9/DagRunLocation/reduction104/crunch9/crunch.log\", deleteFile=96, useLiteralPath=false)\n    at /home/condor/execute/dir_23073/userdir/src/condor_utils/file_lock.cpp:195\n#5  0x00000000005d4585 in ReadUserLog::OpenLogFile (this=0xd2e5360, do_seek=144, read_header=true)\n    at /home/condor/execute/dir_23073/userdir/src/condor_utils/read_user_log_state.h:168\n#6  0x00000000005d4e69 in ReadUserLog::ReopenLogFile (this=0xd2e5360, restore=true) at /home/condor/execute/dir_23073/userdir/src/condor_utils/read_user_log.cpp:795\n#7  0x00000000005d41f2 in ReadUserLog::InternalInitialize (this=0xd2e5360, max_rotations=2, check_for_rotation=false, restore=true, enable_header_read=254, read_only=false)\n    at /home/condor/execute/dir_23073/userdir/src/condor_utils/read_user_log.cpp:382\n#8  0x00000000005d4047 in ReadUserLog::InternalInitialize (this=0xd2e5360, state=@0xd42c540, set_rotations=false, max_rotations=0, read_only=false)\n    at /home/condor/execute/dir_23073/userdir/src/condor_utils/read_user_log.cpp:310\n#9  0x00000000005d3f10 in ReadUserLog::initialize (this=0xd2d3860, state=@0x2, read_only=false) at /home/condor/execute/dir_23073/userdir/src/condor_utils/read_user_log.cpp:251\n#10 0x00000000005d3b1c in ReadUserLog (this=0xd2e5360, state=@0xd42c540, read_only=false) at /home/condor/execute/dir_23073/userdir/src/condor_utils/read_user_log.cpp:150\n#11 0x00000000005d300d in ReadMultipleUserLogs::monitorLogFile (this=0xa69ec8, logfile=\n      {Data = 0xd2d9a60 \"/home/serbin/BIORUN9/DagRunLocation/reduction104/crunch9/crunch.log\", dummy = 0 '\\0', Len = 67, capacity = 67, tokenBuf = 0x0, nextToken = 0x0},\n    truncateIfFirst=96, errstack=@0x7fbfffeee0) at /home/condor/execute/dir_23073/userdir/src/condor_utils/read_multiple_logs.cpp:1045\n#12 0x00000000004da065 in Job::MonitorLogFile (this=0x2392260, condorLogReader=@0x7fbfffeee0, storkLogReader=@0x7bb2bb, nfsIsError=true, recovery=true,\n    defaultNodeLog=0xa69c40 \"/home/serbin/BIORUN9/DagRunLocation/FWE.dag.rescue001.nodes.log\") at /home/condor/execute/dir_23073/userdir/src/condor_dagman/job.h:372\n#13 0x00000000004c6f9b in Dag::ProcessJobProcEnd (this=0xa69de0, job=0x2392260, recovery=false, failed=false) at /home/condor/execute/dir_23073/userdir/src/condor_dagman/dag.cpp:890\n#14 0x00000000004c6aea in Dag::ProcessTerminatedEvent (this=0xa69de0, event=0xd423220, job=0x2392260, recovery=false)\n    at /home/condor/execute/dir_23073/userdir/src/condor_dagman/dag.cpp:779\n#15 0x00000000004c684a in Dag::ProcessOneEvent (this=0xa69de0, logsource=0, outcome=37298784, event=0xd423220, recovery=false, done=@0x7fbffff0cf)\n    at /home/condor/execute/dir_23073/userdir/src/condor_dagman/dag.cpp:586\n#16 0x00000000004c6546 in Dag::ProcessLogEvents (this=0xa69de0, logsource=0, recovery=false) at /home/condor/execute/dir_23073/userdir/src/condor_dagman/dag.cpp:455\n#17 0x00000000004d3517 in condor_event_timer () at /home/condor/execute/dir_23073/userdir/src/condor_dagman/dagman_main.cpp:1186\n#18 0x00000000004fdd38 in TimerManager::Timeout (this=0x9e7600) at /home/condor/execute/dir_23073/userdir/src/condor_daemon_core.V6/timer_manager.cpp:422\n#19 0x00000000004e9ef3 in DaemonCore::Driver (this=0xa13ab0) at /home/condor/execute/dir_23073/userdir/src/condor_daemon_core.V6/daemon_core.cpp:3091\n#20 0x00000000004fc222 in main (argc=13, argv=0x7fbffff770) at /home/condor/execute/dir_23073/userdir/src/condor_daemon_core.V6/daemon_core_main.cpp:2377\n\n</pre></div>\n\n\n<p>Note that the directory /tmp/condorLocks/68/ existed but /tmp/condorLocks/68/38 did not.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-08 14:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0a30bfe08c34cddcaca16784ee8737e4297e587d\">[21306]</a></span>: Turn file touch function into an iterative one If a process deletes parts of the directory structure while loop is going, it will restart from scratch and retry up to three times (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2047\" onclick=\"get_ticket_and_populate_wrapper('2047'); return false;\" title=\"Locking code stuck in infinite loop\">#2047</a></span>)  (By Cathrin Weiss )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Nov-21 15:27", "status": "resolved", "created": "2011-Apr-08 10:53", "fixed_version": "2011-Apr-08 10:53", "broken_version": "v070600", "priority": "1", "subsystem": "Unknown", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com", "due_date": ""}