{"id": 7407, "title": "Ticket #7407: Support session tokens for presigned S3 URLs", "description": "<blockquote>\nBrianB has a user willing to manage her own session token, so it shouldn't be hard to add support for passing it through to the crypto layer.</blockquote>", "remarks": "<blockquote>\n<em>2019-Dec-03 17:36:51 by tlmiller:</em> <br/>\n\nUse <code>+EC2SessionToken</code> to set the name of the file containing the session token, like the access and secret keys.  The value <em>must</em> be quoted.\n\n<p></p><div class=\"code\">\n<pre class=\"code\">universe = vanilla\nexecutable = /bin/sleep\ntransfer_executable = false\narguments = 1\n\n# aws_region = us-east-1\naws_access_key_id_file = TestRole.access\naws_secret_access_key_file = TestRole.secret\n+EC2SessionToken = \"TestRole.session\"\n\nshould_transfer_files = always\n\ntransfer_input_files = s3://bucket/key\ntransfer_output_files = key\n\nqueue\n</pre></div>\n\n\n<p></p><hr/>\n<em>2019-Dec-03 17:38:08 by tlmiller:</em> <br/>\n\nShould this have a submit command?  It seems like such a partial solution.\n\n<p></p><hr/>\n<em>2019-Dec-04 10:40:27 by bbockelm:</em> <br/>\n\n@tlmiller:\n\n<p></p><ul>\n<li>Were you able to test this at all?  Or should we pull in the user to help testing?\n</li><li>Given we want to hand this off to a user, can we also add the first-class alias for the submit file language (e.g., <code>aws_session_token</code>)\n</li></ul>\n\n<p></p><hr/>\n<em>2019-Dec-04 13:21:17 by tlmiller:</em> <br/>\n\n<ul>\n<li>I did basic functionality testing (<code>aws sts assume-role...</code>), and it does work, but we should certainly ask the user to verify that it works for her and her use case before we get too excited about it.\n</li><li>My plan is to create a ticket to add the submit command tied for v8.9.6, and revisit the issue after we've gotten some validation and feedback.  I'll think about it some more; maybe calling it <code>aws_session_token_file</code> isn't so bad, because it does rather imply that you have to obtain one for yourself.  (Do we want to automatically include, or have as an option, a credentials-timeout?)\n</li></ul>\n\n<p></p><hr/>\n<em>2019-Dec-04 13:26:54 by bbockelm:</em> <br/>\n\n&gt; I did basic functionality testing (aws sts assume-role...),\n\n<p>Great!  We were certainly going to have the user look at it ASAP, but I feel more confident if she's the second, not the first...\n\n</p><p>&gt;  I'll think about it some more; maybe calling it aws_session_token_file isn't so bad\n\n</p><p>I think it's perfectly fine.  Given that there are no ways to automate this for the user (it's all custom NIH code), exposing just the fundamental piece is OK with me.\n\n</p><p></p><hr/>\n<em>2019-Dec-04 13:28:07 by tlmiller:</em> <br/>\n\nI'd like to delay (further) documentation until 8.9.6 (see <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=7410\" onclick=\"get_ticket_and_populate_wrapper('7410'); return false;\" title=\"UI for presigned S3 URL session tokens\">#7410</a></span>) or at least until the user has verified that this works for them.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=7410\" onclick=\"get_ticket_and_populate_wrapper('7410'); return false;\" title=\"UI for presigned S3 URL session tokens\">#7410</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nUI for presigned S3 URL session tokens</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Dec-18 13:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/93818939f4ed20287db7d524545032128c678252\">[58708]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7407\" onclick=\"get_ticket_and_populate_wrapper('7407'); return false;\" title=\"Support session tokens for presigned S3 URLs\">#7407</a></span>) Documentation.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Dec-04 07:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/56a588dd665f29e05d7ba2b0879b167cbb2ed62d\">[58588]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7407\" onclick=\"get_ticket_and_populate_wrapper('7407'); return false;\" title=\"Support session tokens for presigned S3 URLs\">#7407</a></span>) Add session tokens to the presigning code. Pass the job ad attribute EC2SessionToken through to it. Committer: Tim Theisen  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Dec-03 17:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2234099fbbb0f7178fb25e870c0f05bacd2ffc67\">[58583]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7407\" onclick=\"get_ticket_and_populate_wrapper('7407'); return false;\" title=\"Support session tokens for presigned S3 URLs\">#7407</a></span>) Add session tokens to the presigning code. Pass the job ad attribute EC2SessionToken through to it.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Dec-20 15:00", "status": "resolved", "created": "2019-Dec-03 17:27", "fixed_version": "2019-Dec-03 17:27", "broken_version": "", "priority": "1", "subsystem": "FileTransfer", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, bbockelman@morgridge.org", "due_date": ""}