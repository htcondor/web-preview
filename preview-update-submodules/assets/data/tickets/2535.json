{"id": 2535, "title": "Ticket #2535: deltacloud test failure in new NMI on x86_64_rhap_6.1", "description": "<blockquote>\nHere's the error I see:\n\n<p>11/10/10 12:34:59: Saw job abort cluster 001 job 000\njob_deltacloud_basic: FAILURE (job aborted by user)\n11/10/10 12:34:59: CT:job_deltacloud_basic: FAILED\njob_deltacloud_basic: CondorTest::RunTest() failed\nbad\n\n</p><p>Here's the test I see it from.  It is happening every time the test executes.\n\n</p><p><a class=\"external\" href=\"http://submit-2.batlab.org/results/task-details.php?platform=nmi:x86_64_rhap_6.1&amp;task=job_deltacloud_basic-1&amp;type=test&amp;runid=16710\">http://submit-2.batlab.org/results/task-details.php?platform=nmi:x86_64_rhap_6.1&amp;task=job_deltacloud_basic-1&amp;type=test&amp;runid=16710</a></p></blockquote>", "remarks": "<blockquote>\n<em>2011-Oct-11 10:00:42 by kronenfe:</em> <br/>\n\nThis is also happening on x86_64_deb_6 now\n\n<p><a class=\"external\" href=\"http://submit-2.batlab.org/results/task-details.php?platform=nmi:x86_64_deb_6.0&amp;task=job_deltacloud_basic-1&amp;type=test&amp;runid=16808\">http://submit-2.batlab.org/results/task-details.php?platform=nmi:x86_64_deb_6.0&amp;task=job_deltacloud_basic-1&amp;type=test&amp;runid=16808</a>\n\n</p><p></p><hr/>\n<em>2011-Oct-11 10:10:58 by jfrey:</em> <br/>\n\nI looked at the x86_64_rhap_6.1 failure linked above. The deltacloud_gahp is reporting <code>Deltacloud_Init_Failure: Failed to perform transfer: Server returned nothing (no headers, no data)</code>. The deltacloudd server doesn't have any unusual messages in its output.\n\n<p></p><hr/>\n<em>2011-Oct-11 10:21:09 by jfrey:</em> <br/>\n\nIn the x86_64_deb_6 test failure linked above, the deltacloudd server prints this error:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">!! Unexpected error while processing request: undefined method `map' for nil:NilClass\nundefined method `map' for nil:NilClass\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-accept-0.4.4/lib/rack/accept/header.rb:32:in `join'\n        /slots/07/127.0.0.1 - - [10/Oct/2011 22:39:50] \"GET /api HTTP/1.1\" 200 1004 83.4296\n127.0.0.1 - - [10/Oct/2011 22:41:17] \"GET /api HTTP/1.1\" 200 1004 88.9771\n127.0.0.1 - - [10/Oct/2011 22:41:28] \"GET /api HTTP/1.1\" 200 1004 35.6574\nn `to_s'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-1.3.4/lib/rack/showexceptions.rb:96:in `inspect'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-1.3.4/lib/rack/showexceptions.rb:96:in `inspect'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-1.3.4/lib/rack/showexceptions.rb:96:in `h'\n        (erb):272:in `block in pretty'\n        (erb):269:in `each'\n        (erb):269:in `pretty'\n        /slots/07/dir_11980/userdir/condor_tests/ruby/lib/ruby/1.9.1/erb.rb:753:in `eval'\n        /slots/07/dir_11980/userdir/condor_tests/ruby/lib/ruby/1.9.1/erb.rb:753:in `result'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-1.3.4/lib/rack/showexceptions.rb:88:in `pretty'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/sinatra-1.3.1/lib/sinatra/showexceptions.rb:30:in `rescue in call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/sinatra-1.3.1/lib/sinatra/showexceptions.rb:21:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud/server/lib/sinatra/rack_driver_select.rb:45:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud/server/lib/sinatra/rack_matrix_params.rb:85:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud/server/lib/sinatra/rack_runtime.rb:36:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud/server/lib/sinatra/rack_etag.rb:41:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-accept-0.4.4/lib/rack/accept/context.rb:22:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-protection-1.1.4/lib/rack/protection/xss_header.rb:22:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-protection-1.1.4/lib/rack/protection/path_traversal.rb:16:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-protection-1.1.4/lib/rack/protection/json_csrf.rb:17:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-protection-1.1.4/lib/rack/protection/base.rb:47:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-protection-1.1.4/lib/rack/protection/xss_header.rb:22:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-1.3.4/lib/rack/logger.rb:15:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-1.3.4/lib/rack/commonlogger.rb:20:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-1.3.4/lib/rack/head.rb:9:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/rack-1.3.4/lib/rack/methodoverride.rb:24:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/sinatra-1.3.1/lib/sinatra/base.rb:1334:in `block in call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/sinatra-1.3.1/lib/sinatra/base.rb:1403:in `synchronize'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/sinatra-1.3.1/lib/sinatra/base.rb:1334:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/thin-1.2.11/lib/thin/connection.rb:84:in `block in pre_process'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/thin-1.2.11/lib/thin/connection.rb:82:in `catch'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/thin-1.2.11/lib/thin/connection.rb:82:in `pre_process'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/eventmachine-0.12.10/lib/eventmachine.rb:1060:in `call'\n        /slots/07/dir_11980/userdir/condor_tests/deltacloud_gems/gems/eventmachine-0.12.10/lib/eventmachine.rb:1060:in `block in spawn_threadpool'\n22:35:20 - Watching /slots/07/dir_11980/userdir/condor_tests/deltacloud/server/**/*.{rb,js,css,scss,sass,erb,html,haml,ru}\n</pre></div>\n\n\n<p></p><hr/>\n<em>2011-Oct-11 20:09:18 by jfrey:</em> <br/>\n\nI've done some additional interactive testing on x86_64_deb_6. Everything works fine on the old batlab machine nmi-v030. On the new batlab machine exec-2, the deltacloudd server is very slow to respond, and manual testing using wget results in repeated timeouts and wget sometimes never succeeding to retrieve a page.\n\n<p>I copied my ruby+gems installation from nmi-v030 to exec-2 and get the same bad performance as the installation I built on exec-2. But if I strace ruby, it starts responding instantly to client queries. If I start the deltacloudd normally and start a client query with wget, it hangs as usual. If I then attach with strace to the ruby child process that's running the thin gem, the query is completed within a second.\n\n</p><p></p><hr/>\n<em>2011-Oct-11 20:36:51 by jfrey:</em> <br/>\n\nHere's how you can debug this outside of Condor:\n<ul>\n<li>Install ruby, its gems, and the deltacloud server code as the test does.\n</li><li>Start the deltacloudd server as the test does\n</li><li>Run <code>wget --http-user=mockuser --http-passwd=mockpassword <span class=\"quote\">http://localhost:3001/api/instances</span></code>\n</li></ul>\n\n<p></p><hr/>\n<em>2011-Oct-12 12:56:07 by jfrey:</em> <br/>\n\nI've done some manual testing on the x86_64_rhap_6.1 machine exec-13.batlab.org. The deltacloud server behaves the same as on exec-2. Normally, the client times out waiting for a reply. But if I attached to the server with strace, it replies immediately to client queries.\n\n<p></p><hr/>\n<em>2011-Oct-17 12:49:19 by jfrey:</em> <br/>\n\nI've emailed the deltacloud guys for ideas as to what may be wrong.\n\n<p></p><hr/>\n<em>2011-Oct-19 13:29:31 by jfrey:</em> <br/>\n\nAt the direction of Chris Lalancette, I've created a bug ticket in Apache's system: <a class=\"external\" href=\"https://issues.apache.org/jira/browse/DTACLOUD-99\">https://issues.apache.org/jira/browse/DTACLOUD-99</a>\n\n<p></p><hr/>\n<em>2016-Mar-11 14:07:44 by jfrey:</em> <br/>\n\nSince we're planning to drop support for deltacloud, I'm closing this ticket.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "todo", "last_change": "2016-Mar-11 14:07", "status": "abandoned", "created": "2011-Oct-10 15:05", "fixed_version": "2011-Oct-10 15:05", "broken_version": "v070703", "priority": "2", "subsystem": "", "assigned_to": "jfrey", "derived_from": "", "creator": "kronenfe", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}