{"id": 802, "title": "Ticket #802: VM configuration status changes have delayed visibility", "description": "<blockquote>\nDescription of problem:\nThe new VM_RECHECK_INTERVAL parameter force condor to check again VM\nconfiguration status after the specified amount of time.\n\n<p>If VM support was disabled (xend/libvirtd not running) but it is enabled again\nafter the interval is elapsed, the new status is not sent to the Collector.\n\n</p><p>Steps to Reproduce:\n1. Configure condor enabling VM support, disable xend/libvirtd and start\ncondor.\n2. Re-enable xend/libvirtd, wait for VM_RECHECK_INTERVAL seconds and check\nagain condor_status -long.\n\n</p><p>Actual results:\nMost of the time\ncondor_status -long\ncontains HasVM = FALSE, even if\ncondor_status -long -direct &lt;vmnode&gt;\nreports HasVM = TRUE. The status is updated after a while.\n\n</p><p>Expected results:\ncondor_status -long should report the new status, i.e. an update should be\ntriggered on a state change for HasVM.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Oct-01 07:58:56 by tstclair:</em> <br/>\n\nInitial Investigation:\n\n<p>-------- Begin Manual Excerpt (Note the <strong>bold</strong>)\n\n</p><p>VM_RECHECK_INTERVAL\n\n</p><p>An integer number of seconds that defaults to 600 (ten minutes),\nrepresenting the amount of time the condor_startd waits after a virtual machine\nerror as reported by the condor_starter, and before checking a final time on\nthe status of the virtual machine. If the check fails, Condor disables starting\nany new vm universe jobs by removing the <strong>VM_Type</strong> attribute from the machine\n<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>.\n\n</p><p>-------- End Manual Excerpt\n\n</p><p>When I looked into the code and re-read the statement it is rather literal, it\nonly adjusts the VM_Type attribute.  It appears to me that HasVM will be\nupdated the next time the classAd is \"published\", which it appears can happen\nfor several reasons.\n\n</p><p>Desired functionality is to publish the data on the event.  Patch will be forthcoming.\n\n</p><p></p><hr/>\n<em>2009-Oct-02 17:03:35 by danb:</em> <br/>\n\nTim,\n\n<p>Looks good to me!  My only minor nitpick is a case of whitespace being messed with in a completely unrelated function.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/105/802.txt\">802.txt</a>\n840 bytes added by tstclair on 2009-Oct-02 20:03:35 UTC.\n<br/>\nUpdate to publish add when vm detected.  <br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-02 15:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9a52f38cc20a59f37ce7495ea05504a38a0f154f\">[15897]</a></span>: Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=802\" onclick=\"get_ticket_and_populate_wrapper('802'); return false;\" title=\"VM configuration status changes have delayed visibility\">#802</a></span>: publish updates in a timely manner when changes are detected.  (By Timothy St. Clair )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-04 09:16", "status": "resolved", "created": "2009-Oct-01 07:57", "fixed_version": "2009-Oct-01 07:57", "broken_version": "v070302", "priority": "3", "subsystem": "VM", "assigned_to": "tstclair", "derived_from": "", "creator": "tstclair", "rust": "", "customer_group": "users", "visibility": "public", "notify": "matt@cs.wisc.edu, dan@hep.wisc.edu", "due_date": ""}