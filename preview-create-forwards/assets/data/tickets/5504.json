{"id": 5504, "title": "Ticket #5504: condor_off -peaceful does not contact all requested machines", "description": "<blockquote>\nCERN reports that\n\n<p>condor_off on a long list of hosts resulted in blackholing of remote commands\n\n</p><p>condor_off tells us it sent the command but the remote worker's\n<span class=\"quote\">MasterLog</span> and <span class=\"quote\">StartLog</span> show no sign of receiving the SIG.\n\n</p><p>With the list of hosts below:\n\n</p><p>b66657dc3a is the first machine which never received the remote\ncommand and all machines after it never received the command either.\n\n</p><p></p><div class=\"term\">\n<pre class=\"term\">&gt; [root@condorcm1 ~]# _condor_TOOL_DEBUG=D_FULLDEBUG,D_TOOL,D_NETWORK\n&gt; condor_off -debug -startd -peaceful b60bbafd29.cern.ch\n&gt; b614a59e0d.cern.ch b614d7132c.cern.ch b618fd3336.cern.ch\n&gt; b61c2a1593.cern.ch b6229ba56a.cern.ch b62e4aa937.cern.ch\n&gt; b632ffd4b8.cern.ch b63458c885.cern.ch b63d84a9bd.cern.ch\n&gt; b64de37984.cern.ch b64df27b67.cern.ch b64e83e36f.cern.ch\n&gt; b653be9f64.cern.ch b66522de9e.cern.ch b66657dc3a.cern.ch\n&gt; b668feea3f.cern.ch b66958d600.cern.ch b66a8ee2a4.cern.ch\n&gt; b66b3a6ea3.cern.ch b6726a3f2e.cern.ch b677678e2c.cern.ch\n&gt; b678bf9f3a.cern.ch b681f1df5f.cern.ch b685a8a045.cern.ch\n&gt; b68795210d.cern.ch b68ab3f6d6.cern.ch b69253548a.cern.ch\n&gt; b698950123.cern.ch b69c75592f.cern.ch b6a17d2a8f.cern.ch\n&gt; b6adce05fa.cern.ch b6b378995f.cern.ch b6b89c5201.cern.ch\n&gt; b6c4eb1d76.cern.ch b6c92182e4.cern.ch b6cabfd84e.cern.ch\n&gt; b6d12aca9c.cern.ch b6d3f0693a.cern.ch b6d6c64ba7.cern.ch\n&gt; b6e0e47635.cern.ch b6e50d7efd.cern.ch b6e97351a5.cern.ch\n&gt; b6eb4fd61d.cern.ch b6ebb20807.cern.ch b6ec5c9f7d.cern.ch\n&gt; b6ec666b8e.cern.ch b6ecb4c7b7.cern.ch b6f02c0a30.cern.ch\n&gt; b6f2d95746.cern.ch b6f3be71c7.cern.ch b6f46b170a.cern.ch\n&gt; b6b03189be.cern.ch &gt; gen009.dbg 2&gt;&amp;1\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2016-Feb-08 11:15:54 by johnkn:</em> <br/>\n\nI notice that the output of condor_off claims to have sent the command to 52 of the 53 machines. The last one is missing from the output.\n\n<p></p><hr/>\n<em>2016-Feb-08 11:39:52 by johnkn:</em> <br/>\n\nlog has a message:\n\n<p></p><pre>   Can't find address for startd b6b03189be.cern.ch Perhaps you need to query another pool.\n</pre>\n\n<p>which explains why it never tries to send a message to the last machine at least.\n\n</p><p></p><hr/>\n<em>2016-Feb-08 17:06:52 by johnkn:</em> <br/>\n\nSo far my examination of the dbg log shows no failure messages and no difference in the pattern of condor_read and condor_write for successful vs. unsuccessful machines.\n\n<p></p><hr/>\n<em>2016-Feb-09 16:01:02 by johnkn:</em> <br/>\n\nFurther investigation shows that what is happening here is that condor_off is sending the \"next off  is peaceful\" command to all but one of the startds listed on the command line.  Then since it can't locate the last startd, it exits - without ever telling any master that it should shut down a startd.\n\n<p>As a fix for stable, I propose that condor_off should be keeping a list of unresolved startd's,  and it should only talk to the master for those startds that it was able to send the \"next off is peaceful\" command.\n\n</p><p></p><hr/>\n<em>2017-Jun-26 14:29:07 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>: Has been in released code since 8.4.5.  Resolving.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-21 14:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/38767a3d051dfd09c5760492d5f8709827db6ba5\">[48065]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5552\" onclick=\"get_ticket_and_populate_wrapper('5552'); return false;\" title=\"Propagate memory and disk usage in Condor-C and Job Router\">#5552</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5535\" onclick=\"get_ticket_and_populate_wrapper('5535'); return false;\" title=\"Partitionable slots can sometimes provision too little disk\">#5535</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5555\" onclick=\"get_ticket_and_populate_wrapper('5555'); return false;\" title=\"Broken LOWPORT/HIGHPORT on Windows.\">#5555</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5504\" onclick=\"get_ticket_and_populate_wrapper('5504'); return false;\" title=\"condor_off -peaceful does not contact all requested machines\">#5504</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Feb-09 17:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/470ab93d120815bed04bdaf8ab91c3fb285ec2fd\">[47583]</a></span>: fix <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5504\" onclick=\"get_ticket_and_populate_wrapper('5504'); return false;\" title=\"condor_off -peaceful does not contact all requested machines\">#5504</a></span>. by changing condor_tool (condor_off) so that when doing -peaceful and not all names can be resolved, it talks to all of the machines that it can and prints an error at the end listing the machines that could not be contacted. Before this patch it would send the 'next off is peaceful' message\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "incident", "last_change": "2017-Jun-26 14:30", "status": "resolved", "created": "2016-Feb-08 11:12", "fixed_version": "2016-Feb-08 11:12", "broken_version": "v080308", "priority": "3", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "cern", "visibility": "public", "notify": "johnkn@cs.wisc.edu, ben.dylan.jones@cern.ch, iain.steers@cern.ch, tannenba@cs.wisc.edu", "due_date": ""}