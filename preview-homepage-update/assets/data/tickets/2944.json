{"id": 2944, "title": "Ticket #2944: condor_hold of a parallel job causes it to go away", "description": "<blockquote>\n<div class=\"code\">\n<pre class=\"code\">ondor_q\n\n\n-- Submitter: gthain@chevre.cs.wisc.edu : &lt;128.105.121.33:40550&gt; : chevre.cs.wisc.edu\n ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD\n 208.0   gthain          4/16 11:40   0+00:00:53 R  0   0.0  sleep 3600\n\n1 jobs; 0 completed, 0 removed, 0 idle, 1 running, 0 held, 0 suspended\nbash-3.2$ ps auxww | grep 3600\ngthain   25788  0.0  0.0   3804   452 ?        SNs  11:44   0:00 condor_exec.exe 3600\ngthain   25789  0.0  0.0   3804   448 ?        SNs  11:44   0:00 condor_exec.exe 3600\ngthain   25790  0.0  0.0   3804   452 ?        SNs  11:44   0:00 condor_exec.exe 3600\ngthain   25791  0.0  0.0   3804   452 ?        SNs  11:44   0:00 condor_exec.exe 3600\ngthain   25792  0.0  0.0   3804   452 ?        SNs  11:44   0:00 condor_exec.exe 3600\ngthain   25793  0.0  0.0   3804   452 ?        SNs  11:44   0:00 condor_exec.exe 3600\ngthain   25794  0.0  0.0   3804   448 ?        SNs  11:44   0:00 condor_exec.exe 3600\ngthain   25795  0.0  0.0   3804   448 ?        SNs  11:44   0:00 condor_exec.exe 3600\ngthain   25796  0.0  0.0   3804   452 ?        SNs  11:44   0:00 condor_exec.exe 3600\ngthain   25798  0.0  0.0   3804   452 ?        SNs  11:44   0:00 condor_exec.exe 3600\ngthain   25899  0.0  0.0  61168   780 pts/4    S+   11:44   0:00 grep 3600\nbash-3.2$ condor_hold 208\nCluster 208 held.\nbash-3.2$ condor_q\n\n\n-- Submitter: gthain@chevre.cs.wisc.edu : &lt;128.105.121.33:40550&gt; : chevre.cs.wisc.edu\n ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD\n\n0 jobs; 0 completed, 0 removed, 0 idle, 0 running, 0 held, 0 suspended\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Apr-16 13:45:29 by tstclair:</em> <br/>\n\nhow far back does *this go?  (release)\n\n<p></p><hr/>\n<em>2012-Apr-16 15:10:24 by tstclair:</em> <br/>\n\ncould you please ref the delta which caused this to vomit?\n\n<p></p><hr/>\n<em>2012-Apr-17 10:38:43 by gthain:</em> <br/>\n\nThe problem started when we started to push all dirty attributes of the job ad from the shadow to the schedd.  In the PU, and only the PU, we mark the ATTR_JOB_STATUS as running at startup.  This marked ATTR_JOB_STATUS as dirty, and JOB_STATUS was updated to the schedd during the next update.\n\n<p>However, when a job is put on hold by the tool, the schedd marks the job as held in it's copy, then tells the shadow to evict the job.  The shadow doesn't know if the job is to be held or removed, it just gets job off the machine.  Before the shadow exits, it updates the job ad, which reverts the ATTR_JOB_STATUS state back to running.  Then, when the schedd's reaper is called, it doesn't know the job was held, so it removes it.\n\n</p><p>I haven't done git archeology, but I believe this was initially caused by the condor_suspend/resume code.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-11 15:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6fb98082a19d25a2d71714282059af2fc1530185\">[35383]</a></span>: Incorrect ticket number identified in version history. Was <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2944\" onclick=\"get_ticket_and_populate_wrapper('2944'); return false;\" title=\"condor_hold of a parallel job causes it to go away\">#2944</a></span>, and is now corrected to be <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2992\" onclick=\"get_ticket_and_populate_wrapper('2992'); return false;\" title=\"Have Condor manage OOM\">#2992</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-10 16:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f6ef274b508f656c3d693907738f17d92443a25f\">[35371]</a></span>: edit 7.9.6 version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2944\" onclick=\"get_ticket_and_populate_wrapper('2944'); return false;\" title=\"condor_hold of a parallel job causes it to go away\">#2944</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-17 10:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/788da3af63c0eb275fcc5931c9755d7f96e2bf3f\">[31681]</a></span>: Fix problem causing condor_hold to remove parallel jobs <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2944\" onclick=\"get_ticket_and_populate_wrapper('2944'); return false;\" title=\"condor_hold of a parallel job causes it to go away\">#2944</a></span> Rely on the schedd setting the ATTR_JOB_STATUS to running, not the shadow,just like in vanilla  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-May-11 14:34", "status": "resolved", "created": "2012-Apr-16 12:00", "fixed_version": "2012-Apr-16 12:00", "broken_version": "v070706", "priority": "2", "subsystem": "Parallel", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com", "due_date": ""}