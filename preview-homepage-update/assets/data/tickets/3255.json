{"id": 3255, "title": "Ticket #3255: Implement JobPrioArray and JobPrioArrayOverflow attrs in submitter ad", "description": "<blockquote>\nAs a development milestone in support of honoring job priorities across multiple schedds,\nmodify the Schedd to report <code>JobPrioArray</code> and <code>JobPrioArrayOverflow</code> attributes. See the parent ticket for design document and further details.</blockquote>", "remarks": "<blockquote>\n<em>2012-Oct-05 14:24:24 by tannenba:</em> <br/>\n\nTesting...\n\n<p>Set the following config knobs:\n\n</p><p></p><pre>   use_global_job_prios = true\n   max_global_job_prios = 4\n</pre>\n\n<p>Then submit jobs from a mix of users (or accounting groups) and job priorities, with at least one submitter going the defined <code>max_global_job_prios</code> and one submitter not.\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">\nC:\\home\\tannenba\\condor\\build_79\\test&gt;cat test1.sub\nexecutable = c:\\utils\\date.exe\ninitialdir = c:\\temp\n+AccountingGroup = \"groupA\"\npriority = 1\nqueue 1\npriority = 5\nqueue 3\npriority = 10\nqueue 3\npriority = -5\nqueue 2\npriority = 15\nqueue\n\nC:\\home\\tannenba\\condor\\build_79\\test&gt;cat test2.sub\nexecutable = c:\\utils\\date.exe\ninitialdir = c:\\temp\n+AccountingGroup = \"groupB\"\npriority = 100\nqueue 1\npriority = 50\nqueue 3\npriority = -5\nqueue 2\n\nC:\\home\\tannenba\\condor\\build_79\\test&gt;condor_submit test1.sub\nSubmitting job(s)\n..........\n10 job(s) submitted to cluster 124.\n\nC:\\home\\tannenba\\condor\\build_79\\test&gt;condor_submit test2.sub\nSubmitting job(s)\n......\n6 job(s) submitted to cluster 125.\n\n</pre></div>\n\n\n<p>So the above results in two submitter ads.  Check the attributes <code>JobPrioArray</code> and <code>JobPrioArrayOverflow</code> for correctness.\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">C:\\home\\tannenba\\condor\\build_79\\test&gt;condor_status -submit\n\nName                 Machine      Running IdleJobs HeldJobs\n\ngroupA@ToddsThinkpad ToddsThink         0       10        0\ngroupB@ToddsThinkpad ToddsThink         0        6        0\n                           RunningJobs           IdleJobs           HeldJobs\n\ngroupA@ToddsThinkpad                 0                 10                  0\ngroupB@ToddsThinkpad                 0                  6                  0\n\n               Total                 0                 16                  0\n\nC:\\home\\tannenba\\condor\\build_79\\test&gt;condor_status -l -submit groupA@ToddsThinkpad | grep JobPrioArray\nJobPrioArrayOverflow = 5\nJobPrioArray = \"15,10,5,1\"\n\nC:\\home\\tannenba\\condor\\build_79\\test&gt;condor_status -l -submit groupB@ToddsThinkpad | grep JobPrioArray\nJobPrioArray = \"100,50,-5\"\n\n</pre></div>\n\n\n<p>Note only the first job has a <code>JobPrioArrayOverflow</code> attribute because it has five unique priorities and the limit was configured to be four. Also note <code>JobPrioArray</code> priories are sorted large to small.\n\n</p><p></p><hr/>\n<em>2012-Oct-08 14:30:50 by tannenba:</em> <br/>\n\nNote - this is an implementation milestone ticket. See master ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3218\" onclick=\"get_ticket_and_populate_wrapper('3218'); return false;\" title=\"Support JobPrio scope across multiple schedulers\">#3218</a></span> for code review, documentation, etc.\n\n<p></p><hr/>\n<em>2012-Oct-09 14:39:41 by gthain:</em> <br/>\n\nI've reviewed this part of the code ticket, and it looks good.  A couple of questions:  There's some wonky copy-and-paste issues with the param table, in particular the URL parameter and version parameters.\n\n<p>Also, should we make the publication of these parameter dependent on the knob?  Seems like more code paths.  Why not always publish the job prio arrays, and only conditionally act on them.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Oct-08 14:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0d185d37012e2c84c65b55a8abffd3a0cd1294f3\">[33601]</a></span>: Add <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobPrioArray\" title=\"Job Prio Array\">JobPrioArray</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobPrioArrayOverflow\" title=\"Job Prio Array Overflow\">JobPrioArrayOverflow</a></span> attrs to submitter ad. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3255\" onclick=\"get_ticket_and_populate_wrapper('3255'); return false;\" title=\"Implement JobPrioArray and JobPrioArrayOverflow attrs in submitter ad\">#3255</a></span> These attributes are used by the negotiator to honor job priories across multiple schedds. This commit also introduces a consolidated method to create a submitter ad, removing code clones. Parent ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3218\" onclick=\"get_ticket_and_populate_wrapper('3218'); return false;\" title=\"Support JobPrio scope across multiple schedulers\">#3218</a></span>  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-Oct-09 14:39", "status": "resolved", "created": "2012-Oct-05 13:44", "fixed_version": "2012-Oct-05 13:44", "broken_version": "", "priority": "2", "subsystem": "Daemons", "assigned_to": "tannenba", "derived_from": "#3218", "creator": "tannenba", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "eje@cs.wisc.edu, tstclair@redhat.com, matt@cs.wisc.edu, dan@hep.wisc.edu, bbockelm@cse.unl.edu, sfiligoi@fnal.gov, tannenba@cs.wisc.edu", "due_date": "20121005"}