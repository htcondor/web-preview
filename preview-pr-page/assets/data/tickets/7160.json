{"id": 7160, "title": "Ticket #7160: condor_history should optimize the search for a single job by id", "description": "<blockquote>\n<code>condor_history</code> can take a very long time because when operating from a constraint, it must search the entire history file looking for matches.  This is made worse by the fact that parsing classad is very slow, so much so that grep of the same file is at least an order of magnitude faster than running <code>condor_history</code>.\n\n<p>We could optimize the search for a single job in the history file in two ways.\n</p><ol>\n<li>parse only the banner between classads and only parse the full ad when the banner matches the query.\n</li><li>stop at the first match when the query is for a single job by id.\n</li></ol>\n\n<p>This optimization is complicated by the fact that condor_history is always operating using a constraint expression, this is especially true for remote history.\n\n</p><p>But we could analyze the constraint expression, detect when it is of the form\n\n</p><p></p><pre>   ClusterId == &lt;number&gt; &amp;&amp; ProcId == &lt;number&gt;\n</pre>\n\n<p>and then optimize the case when the constraint expression is equivalent to this.\nand convert this into a search for a single job by id.\n\n</p><p>We could also optimize the case when expression refers only to <code>ClusterId</code> <code>ProcId</code> and <code>Owner</code>, as this information is in the banner between job classads.</p></blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2020-Apr-10 07:46:37 by tim:</em> <br/>\n\nBulk change of target version from v080906 to v080907 using ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jul-23 16:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/29a6aa75343a421b89ba66a3ad6d1f44aac1e0af\">[57450]</a></span>: in support of <span class=\"ticket\"><a class=\"active\" href=\"/wiki-archive/tickets/?ticket=7160\" onclick=\"get_ticket_and_populate_wrapper('7160'); return false;\" title=\"condor_history should optimize the search for a single job by id\">#7160</a></span>, add classad helper functions <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTreeIsAttrCmpLiteral\" title=\"Expr Tree Is Attr Cmp Literal\">ExprTreeIsAttrCmpLiteral</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTreeIsJobIdConstraint\" title=\"Expr Tree Is Job Id Constraint\">ExprTreeIsJobIdConstraint</a></span> these are hooked into condor_q -dry for testing and to show how to use them. ===VersionHistory:none===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Nov-09 12:31", "status": "active", "created": "2019-Jul-23 14:37", "fixed_version": "2019-Jul-23 14:37", "broken_version": "", "priority": "4", "subsystem": "Tools", "assigned_to": "jfrey", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}