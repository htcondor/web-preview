{"id": 37, "title": "Ticket #37: Bad schedd cron argument causes schedd to EXCEPT", "description": "<blockquote>\n(This replaces Drupal <span class=\"drupalnode\"><a href=\"http://drupal-old.batlab.cs.wisc.edu/node/1440\">1440 (backup)</a> <a href=\"http://nmi.cs.wisc.edu/node/1440\">1440 (public)</a></span>)\n\n<p>An invalid schedd cron argument will cause the schedd to EXCEPT. Once in this state, the schedd will EXCEPT every time it starts. This could be used by a user with submit permissions as a denial of service attack. More likely it will just be an annoyance.\n\n</p><p>Say that you have the following as part of a schedd cron job:\n</p><div class=\"code\">\n<pre class=\"code\">CronMinute=#/4</pre></div>\n\n\n<p>The schedd will EXCEPT with:\n</p><div class=\"code\">\n<pre class=\"code\">3/31 13:45:52 (pid:13081) Invalid parameter value \u2018#/4\u2019 for\nCronMinute3/31 13:45:52 (pid:13081) Job 31.0 put on hold: Invalid cron\nschedule parameters:\nInvalid parameter value \u2018#/4\u2019 for CronMinute\n\n3/31 13:45:52 (pid:13081) Refusing attempt to add \u2018HoldReason\u2019 =\n\u2018\u201cInvalid cron schedule parameters:\nInvalid parameter value \u2018#/4\u2019 for CronMinute\n\u201c\u2019 to record \u201931.0\u2019 as it contains a newline, which is not allowed.\n3/31 13:45:52 (pid:13081) ERROR \u201cwrite inside a transaction failed, errno = 25\u201d at line 67 in file log_transaction.C</pre></div>\n\n\n<p>The problem is that the code is trying to set <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=HoldReason\" title=\"Hold Reason\">HoldReason</a></span> to a string including two newlines. <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> values can NEVER have newlines (at least in the schedd, because it will corrupt the job queue log file). So the schedd EXCEPTs.\n\n</p><p>The change probably needs to be made around line 12701 in Scheduler::calculateCronTabSchedule in condor_schedd.V6/schedd.C. The lines in question read:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">MyString reason( \u201cInvalid cron schedule parameters:\\n\u201d ); if ( cronTab != NULL ) { reason += cronTab-&gt;getError(); } else { reason += error; }\n</pre></div>\n\n\n<p>There are two errant newlines, one in the initializer for &amp;#8220;reason&amp;#8221;, as well as one returned at the end of either &amp;#8220;error&amp;#8221; or &amp;#8220;cronTab-&gt;getError()&amp;#8221;. Both must be removed.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Jul-01 11:02:05 by psilord:</em> <br/>\n\nThis should go into V7_4-branch.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1485\" onclick=\"get_ticket_and_populate_wrapper('1485'); return false;\" title=\"Bad schedd cron argument is checked for incorrectly in condor_submit\">#1485</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nBad schedd cron argument is checked for incorrectly in condor_submit</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2008-Sep-22 14:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fb32bb241f4eb8b76213cecf18145a2d84490aff\">[11705]</a></span>: Remove newlines from chrondor <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=HoldReason\" title=\"Hold Reason\">HoldReason</a></span>, they make the schedd EXCEPT  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jul-02 14:55", "status": "resolved", "created": "2009-Jan-16 11:07", "fixed_version": "2009-Jan-16 11:07", "broken_version": "", "priority": "2", "subsystem": "", "assigned_to": "slauson", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "slauson@cs.wisc.edu psilord@cs.wisc.edu matt@cs.wisc.edu", "due_date": ""}