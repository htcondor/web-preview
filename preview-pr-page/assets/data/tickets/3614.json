{"id": 3614, "title": "Ticket #3614: Job Exit Code to Class Ad", "description": "<blockquote>\n<strong class=\"three\">Ensure Job Exit Code gets to Classad</strong>\n\n<p><strong>job_exitcode_to_classad</strong>\n\n</p><p>There are several checks within this test. One to check for the expected\nvalue into the terminate event and another that the terminate event will\nget into the exitcode classad.\n\n</p><p>I wanted to do it within the context of Check::SimpleJob::RunCheck\n\n</p><p>I also wanted to have RunTest/RunDagTest give me the cluster id rather\nthen predict it.\n\n</p><p>This required being able to pass a callback into <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DoTest\" title=\"Do Test\">DoTest</a></span> where this value is saved. There is a big comment at the top of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DoTest\" title=\"Do Test\">DoTest</a></span> on how this was done such\nthat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RunTest\" title=\"Run Test\">RunTest</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RunDagTest\" title=\"Run Dag Test\">RunDagTest</a></span> would still work without any test suite changes.\nShort explanation is that in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DoTest\" title=\"Do Test\">DoTest</a></span>, if the 4th parameter is defined, it is a callback.\n\n</p><p>This is one of many callbacks which can be used now in SimpleJob::RunCheck.\n\n</p><p>Its also possible to give it something other then a sleep job.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-15 12:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/81e2bb38bbd0927ed6fab4ac950383044e401674\">[35738]</a></span>: Suspected a race condition in getting jobs exit or failure status and the job being out of the queue and history being available. Added a function to watch the queue for being empty before usinf condor_history. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3614\" onclick=\"get_ticket_and_populate_wrapper('3614'); return false;\" title=\"Job Exit Code to Class Ad\">#3614</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-15 12:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bda9a69a02c6366e8ba4450d37c86c581ccfbba8\">[35735]</a></span>: Undor prints <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3614\" onclick=\"get_ticket_and_populate_wrapper('3614'); return false;\" title=\"Job Exit Code to Class Ad\">#3614</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-15 12:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f591772f649e424ec35d9a9a55f62674da81b598\">[35732]</a></span>: This job script simply sets the exit code <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3614\" onclick=\"get_ticket_and_populate_wrapper('3614'); return false;\" title=\"Job Exit Code to Class Ad\">#3614</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-15 12:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/34cc4465bd16ca48b50eacd240121e5e1f15ecb3\">[35731]</a></span>: Addded exitcode test <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3614\" onclick=\"get_ticket_and_populate_wrapper('3614'); return false;\" title=\"Job Exit Code to Class Ad\">#3614</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-15 11:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/67a0ba32999210b0e2a6f7ee4451b8dc4aa15eee\">[35729]</a></span>: Fixed it so that if <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DoTest\" title=\"Do Test\">DoTest</a></span> gets a defined 4th parameter it is a callback because the test wants the cluster id of the test it just submitted. This works from calls to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RunTest\" title=\"Run Test\">RunTest</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RunDagTest\" title=\"Run Dag Test\">RunDagTest</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3614\" onclick=\"get_ticket_and_populate_wrapper('3614'); return false;\" title=\"Job Exit Code to Class Ad\">#3614</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-15 11:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/995c95eac7c903f1b3e10895454741ce37fb8be4\">[35730]</a></span>: Use SimpleJob::RunCheck and verify both the expected terminate value AND that it is in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClaasAdd\" title=\"Claas Add\">ClaasAdd</a></span> <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExitCode\" title=\"Exit Code\">ExitCode</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3614\" onclick=\"get_ticket_and_populate_wrapper('3614'); return false;\" title=\"Job Exit Code to Class Ad\">#3614</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-15 11:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/93a05209d5bb48a6d0dae7d87ce04e5dbf935330\">[35728]</a></span>: Change and add functions to simple job again. You can capture more events, run something other then sleep(a script to set the exit code for this test) and you can pass in a callback to have the CondorTest.pm pass back the cluster id of the job it just submitted. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3614\" onclick=\"get_ticket_and_populate_wrapper('3614'); return false;\" title=\"Job Exit Code to Class Ad\">#3614</a></span>  (By Bill Taylor )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Aug-06 12:03", "status": "resolved", "created": "2013-May-08 14:37", "fixed_version": "2013-May-08 14:37", "broken_version": "", "priority": "2", "subsystem": "Tests", "assigned_to": "bt", "derived_from": "#3594", "creator": "bt", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "johnkn@cs.wisc.edu", "due_date": ""}