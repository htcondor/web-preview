{"id": 897, "title": "Ticket #897: CREAM Hardening", "description": "<blockquote>\nTo date, Condor-G's support for submitting to the CREAM service has only been tested with a small number of jobs in ideal conditions. We need to do additional testing that approximates conditions that may be encountered in production use. This includes using thousands of jobs and inducing failures on both client and server.\n\n<p>The following scenarios should be covered:\n</p><ul>\n<li>Steady influx of new jobs at same rate that completed jobs leave the queue.\n</li><li>Sudden influx of several thousand new jobs.\n</li><li>Sudden removal of several thousand jobs.\n</li><li>Failure of client machine (software hard-killed and restarted).\n</li><li>Failure of server machine (software hard-killed and restarted).\n</li></ul>\n\n<p>Code changes for this work should be committed to <code>V7_5-cream_hardening-branch</code>. Bug fixes may go to <code>V7_4-branch</code> on a case-by-base basis.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Nov-16 15:12:40 by jfrey:</em> <br/>\n\nOn Nov 13, I ran a test run that kept 1500 cream jobs in the queue, submitting new jobs as old ones completed. A total of 20600 jobs ran. Here are some issues that came up:\n\n<p></p><ul>\n<li><span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=958\" onclick=\"get_ticket_and_populate_wrapper('958'); return false;\" title=\"Prioritizing GAHP commands\">#958</a></span> When the initial 1500 job entered the queue, all jobs had to finish the REGISTER command before any could complete their submission with the START command. This is due to the way the GAHP code in the gridmanager queues commands. We either need to reintroduce MAX_PENDING_SUBMITS or prioritize GAHP commands. Other grid types are affected by this.\n\n<p></p></li><li><span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=954\" onclick=\"get_ticket_and_populate_wrapper('954'); return false;\" title=\"Improve hold reason when cream job fails\">#954</a></span> Cream reported several jobs as failed, either due to a proxy expiring (which shouldn't have been true) or files contents changing unexpectedly. The gridmanager ended up putting the jobs on hold with 'Unspecified gridmanager error' as the reason. The gridmanager should use the failure message returned by Cream. If possible, we should also understand how these errors occurred.\n\n<p></p></li><li><span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=955\" onclick=\"get_ticket_and_populate_wrapper('955'); return false;\" title=\"Improve handling of timeout errors for cream jobs\">#955</a></span> A couple cream commands failed with a 'Connection timed out' error. If the REGISTER or START command failed, the job went on hold with the timeout as the hold reason. If another command failed, the gridmanager tried to cancel and purge the job. The purged failed (due to the known problem of CANCEL not working) and the job went on hold with a hold reason about the PURGE failing. The gridmanager should handle these failures more gracefully, possibly retrying the command that timed out. We could use try using a longer timeout. Currently, we use 60 seconds.</li></ul>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=893\" onclick=\"get_ticket_and_populate_wrapper('893'); return false;\" title=\"Require GRIDFTP_URL_BASE for CREAM jobs\">#893</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nRequire GRIDFTP_URL_BASE for CREAM jobs</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=895\" onclick=\"get_ticket_and_populate_wrapper('895'); return false;\" title=\"Conversion of CREAM resource names broken in condor_submit\">#895</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nConversion of CREAM resource names broken in condor_submit</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=912\" onclick=\"get_ticket_and_populate_wrapper('912'); return false;\" title=\"Static buffer in cream_gahp command processing\">#912</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nStatic buffer in cream_gahp command processing</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=913\" onclick=\"get_ticket_and_populate_wrapper('913'); return false;\" title=\"CREAM GAHP commands need overhaul\">#913</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nCREAM GAHP commands need overhaul</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=932\" onclick=\"get_ticket_and_populate_wrapper('932'); return false;\" title=\"Bad string escaping in gahps\">#932</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nBad string escaping in gahps</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=938\" onclick=\"get_ticket_and_populate_wrapper('938'); return false;\" title=\"Cream Gahp should batch requests\">#938</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nCream Gahp should batch requests</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=939\" onclick=\"get_ticket_and_populate_wrapper('939'); return false;\" title=\"Issue single status command for all cream jobs\">#939</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nIssue single status command for all cream jobs</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=940\" onclick=\"get_ticket_and_populate_wrapper('940'); return false;\" title=\"Batch leases for cream jobs\">#940</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nBatch leases for cream jobs</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=941\" onclick=\"get_ticket_and_populate_wrapper('941'); return false;\" title=\"Don't notify all cream jobs on proxy renewal in gridmanager\">#941</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDon't notify all cream jobs on proxy renewal in gridmanager</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=954\" onclick=\"get_ticket_and_populate_wrapper('954'); return false;\" title=\"Improve hold reason when cream job fails\">#954</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nImprove hold reason when cream job fails</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=955\" onclick=\"get_ticket_and_populate_wrapper('955'); return false;\" title=\"Improve handling of timeout errors for cream jobs\">#955</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nImprove handling of timeout errors for cream jobs</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=958\" onclick=\"get_ticket_and_populate_wrapper('958'); return false;\" title=\"Prioritizing GAHP commands\">#958</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nPrioritizing GAHP commands</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=972\" onclick=\"get_ticket_and_populate_wrapper('972'); return false;\" title=\"Fault recovery during cream job submission broken\">#972</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nFault recovery during cream job submission broken</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1062\" onclick=\"get_ticket_and_populate_wrapper('1062'); return false;\" title=\"Improve error handling when purging cream jobs\">#1062</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nImprove error handling when purging cream jobs</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=2041\" onclick=\"get_ticket_and_populate_wrapper('2041'); return false;\" title=\"Cream status commands timing out\">#2041</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nCream status commands timing out</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-12 16:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f1a46559e798214e720c94bf9aa1802468f8b726\">[16310]</a></span>: Add V7_5-CREAM_HARDENING-BRANCH to version string. <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=897\" onclick=\"get_ticket_and_populate_wrapper('897'); return false;\" title=\"CREAM Hardening\">#897</a></span>  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Jan-31 13:48", "status": "new", "created": "2009-Nov-03 13:56", "fixed_version": "2009-Nov-03 13:56", "broken_version": "v070400", "priority": "4", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}