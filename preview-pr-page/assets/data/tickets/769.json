{"id": 769, "title": "Ticket #769: Gridmanager jobs stuck in endless loop updating schedd", "description": "<blockquote>\nAt several points during a Job object's life in the gridmanager, it needs to wait for changes to the job ad to be made persistent on disk (via the schedd). Currently, the job object triggers a connection to the schedd to update all dirty attributes in the job ad, verifies that the ad has no dirty attributes, then continues operation. If the ad still has dirty attributes, the job object triggers another connection to the schedd and waits.\n\n<p>The connection to the schedd and the return of control to the job object occur in separate daemon-core handlers. In between these handlers, other code can make unrelated changes to the job ad, causing the job object to request a subsequent, unnecessary, update to the schedd. Under a heavy load of gt2 jobs, we have observed jobs get stuck in an endless loop trying to push the <span class=\"quote\">GridJobId</span> attribute to the schedd, due to regular changes to <span class=\"quote\">LastRemoteStatusUpdate</span> triggered by grid monitor status updates.\n\n</p><p>The job objects need to check for the clean/dirty status of the specific attribute(s) they want pushed to the schedd.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-08 13:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/061c20f90e3aaa469bd9359e1b731ba8724ad831\">[15956]</a></span>: Improve schedd ad updates in the gridmanager. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=769\" onclick=\"get_ticket_and_populate_wrapper('769'); return false;\" title=\"Gridmanager jobs stuck in endless loop updating schedd\">#769</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=771\" onclick=\"get_ticket_and_populate_wrapper('771'); return false;\" title=\"Schedd updates in gridmanager causes extra load\">#771</a></span> Fix some problems in how job ad changes are pushed to the schedd that were revealed by BNL's testing with tens of thousands of jobs: * When a job object wants a job ad change to be pushed to the schedd, it can say whether its <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=EvaluateState\" title=\"Evaluate State\">EvaluateState</a></span> timer\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-31 13:41", "status": "resolved", "created": "2009-Sep-23 14:16", "fixed_version": "2009-Sep-23 14:16", "broken_version": "v070400", "priority": "3", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "#760", "creator": "jfrey", "rust": "", "customer_group": "atlas", "visibility": "public", "notify": "", "due_date": ""}