{"id": 7014, "title": "Ticket #7014: Vanila universe checkpoint on eviction by default", "description": "<blockquote>\nVanilla Universe checking pointing for job eviction should be enabled by default and leave it to users to opt out if so desired.\n\n<p></p><hr/>\nOur proposal is to (a) make vanilla universe check pointing first-class in the submit language and (b) simplify the interface.  Specifically, all the user will have to set is <code>CheckpointExitCode</code> (name subject to change); HTCondor will take care of the details.  This will <em>not</em> by default set <code>when_to_transfer_files</code> to <code>ON_EXIT_OR_EVICT</code>; the vanilla universe check pointing implementation will be changed so that this is not necessary.  If we did make transferring the checkpoint on eviction the default, then the default would be to require checkpoint updates to be atomic, which seems like a good way to cause problems.\n\n<p>Implementation-wise, we presently anticipate the following:\n</p><ul>\n<li>changing the submit utils to transform <code>CheckpointExitCode</code> into <code>SuccessCheckpointExitCode</code> and <code>WantFTOnCheckpoint</code>;\n</li><li>changing the starter so that <code>WantFTOnCheckpoint</code> being set will force intermediate file transfer regardless of the setting of <code>when_to_transfer_files</code>;\n</li><li>(optionally) changing the starter so that the presence of <code>SuccessCheckpointExitCode</code> implies <code>WantFTOnCheckpoint</code>;\n</li><li>changing the startd to advertise the ability to transfer files on checkpoint, and changing submit utils to add that requirement to the job.\n</li></ul>\n\n<p>See <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7031\" onclick=\"get_ticket_and_populate_wrapper('7031'); return false;\" title=\"Make CheckpointExitCode a first-class submit command.\">#7031</a></span>.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Apr-24 13:48:47 by tlmiller:</em> <br/>\n\nI think this means, specifically, that setting <code>CheckpointSig</code> does not set or override <code>KillSig</code>.\n\n<p></p><hr/>\n<em>2019-Apr-24 13:51:45 by tlmiller:</em> <br/>\n\nOnce we actually remove standard universe for good, we can switch 'ckpt or syscalls' to 'checkpointing' (and short name to 'ckpt', not 'std').  [Referring to string constants in gittrac.]\n\n<p></p><hr/>\n<em>2019-May-01 13:21:30 by pfc:</em> <br/>\n\nWe will defer this until Todd Miller's application-level checkpointing HOWTO is complete, and then re-asses how much this trips up users.\n\n<p></p><hr/>\n<em>2019-May-01 13:25:18 by tlmiller:</em> <br/>\n\nThis may be a lower priority once <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7022\" onclick=\"get_ticket_and_populate_wrapper('7022'); return false;\" title=\"Document checkpointing in the vanilla universe\">#7022</a></span> is done.\n\n<p></p><hr/>\n<em>2019-May-02 15:48:49 by tlmiller:</em> <br/>\n\nSorry -- I've lost context on this ticket, and I'm no longer sure what my first comment meant.\n\n<p>Is this ticket referring to requiring the user to set <code>when_to_transfer_files</code> to <code>ON_EXIT_OR_EVICT</code> when setting <code>+WantFTOnCheckpoint</code>?  If so, see <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7031\" onclick=\"get_ticket_and_populate_wrapper('7031'); return false;\" title=\"Make CheckpointExitCode a first-class submit command.\">#7031</a></span> -- we think that the user shouldn't have to specify it, but that it shouldn't be enable by default (because it relaxes the requirement for atomic checkpoints).\n\n</p><p></p><hr/>\n<em>2019-May-08 13:34:45 by tannenba:</em> <br/>\n\nThe idea here is if the user specifies a checkpoint exit status, then we know they want to transfer ON_EXIT_OR_EVIT.  Why make the user set both?  Also, if they set the knobs in conflict with each other, submit should throw an error.\n\n<p></p><hr/>\n<em>2019-May-08 14:06:45 by tlmiller:</em> <br/>\n\n&gt; The idea here is if the user specifies a checkpoint exit status, then we know\n&gt; they want to transfer ON_EXIT_OR_EVICT.\n\n<p>If we adopt the proposal that ON_EXIT_OR_EVICT should be orthogonal to vanilla-universe checkpointing -- which would allow vanilla-universe checkpoints to be update non-atomically -- then I would expect many users would not want to set ON_EXIT_OR_EVICT, because atomic updates may be hard or tedious to arrange.\n\n</p><p></p><hr/>\n<em>2019-Jun-14 17:11:20 by tlmiller:</em> <br/>\n\nSee <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7031\" onclick=\"get_ticket_and_populate_wrapper('7031'); return false;\" title=\"Make CheckpointExitCode a first-class submit command.\">#7031</a></span>.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2019-Jun-14 17:11", "status": "resolved", "created": "2019-Apr-24 13:25", "fixed_version": "2019-Apr-24 13:25", "broken_version": "", "priority": "3", "subsystem": "DaemonsExecNode", "assigned_to": "tlmiller", "derived_from": "", "creator": "anderson", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "peter.couvares@ligo.org, tlmiller@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}