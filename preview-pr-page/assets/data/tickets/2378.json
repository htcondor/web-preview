{"id": 2378, "title": "Ticket #2378: Standalone checkpointing test failing on 32-bit rhel5", "description": "<blockquote>\nWhen the zlib external was removed and the system's zlib used in its place, the standalone checkpointing test (job_ckpt_standalone_std) started failing on the 32-bit rhel 5 machine nmi-0099. The test continued to work on all other platforms and on the 32-bit rhel 5.6 machine nostos.cs.wisc.edu.\n\n<p>The current proposed solution is to re-add the zlib external, but only use it for creating standard universe executables.\n\n</p><p><span class=\"subsection\"></span></p><h3>Milestones </h3>\n<ul>\n<li>Re-add zlib external\n</li></ul>\n\n<p><span class=\"subsection\"></span></p><h3>How to Reproduce</h3>\n\n<p></p><ul>\n<li>Build the tests with <code>make tests</code> to produce the binary <code>job_ckpt_standalone_std.cndr.exe</code>.\n\n<p></p></li><li>Run the test binary as follows\n<div class=\"code\">\n<pre class=\"code\">setarch i386 -L -B -R ./job_ckpt_standalone_std.cndr.exe \\\n  -_condor_aggravate_bugs -_condor_D_CKPT -_condor_D_FULLDEBUG \\\n  -_condor_D_ALWAYS -_condor_ckpt \\\n  ./job_ckpt_standalone_std.cndr.exe.ckpt\n</pre></div>\n\n\n<p></p></li><li>The program should checkpoint and exit with signal 12 (shell $? = 140). The last line of stdout will be 'About to checkpoint...' and the last line of stderr will be 'Ckpt exit'.\n\n<p></p></li><li>Resume the program like so\n<div class=\"code\">\n<pre class=\"code\">setarch i386 -L -B -R ./job_ckpt_standalone_std.cndr.exe \\\n  -_condor_aggravate_bugs -_condor_D_CKPT -_condor_D_FULLDEBUG \\\n  -_condor_D_ALWAYS -_condor_restart \\\n  ./job_ckpt_standalone_std.cndr.exe.ckpt\n</pre></div>\n\n\n<p></p></li><li>The program should exit with exit code 0. The last line of stdout should be 'SUCCESS'. The last line of stderr should be 'About to return to user code'. On 32-bit rhel 5, the program instead exits with signal 6 after printing this to stderr:\n<div class=\"code\">\n<pre class=\"code\">User Job - $CondorPlatform: I686-RedHat_5 $\nUser Job - $CondorVersion: 7.7.1 Aug 11 2011 BuildID: UW_development PRE-RELEASE-UWCS $\nCondor: Notice: Will restart from ./job_ckpt_standalone_std.cndr.exe.ckpt.0\nRead headers OK\nRead SegMap[0](DATA) OK\nRead SegMap[1](STACK) OK\nRead all SegMaps OK\nReading compressed segments...\nRestoring a DATA segment\nFound a DATA block, increasing heap from 0x81ed000 to 0x85ee000\nAbout to overwrite 4825088 bytes starting at 0x8154000(DATA)\n*** stack smashing detected ***: &lt;unknown&gt; terminated\nAborted\n</pre></div>\n</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Aug-15 11:36:05 by jfrey:</em> <br/>\n\nThis bug never appeared in a release, so no version history entry is required.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-12 13:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2c387cc575edcac299d0e03bbb3d33a4075c3c2e\">[26747]</a></span>: Fix standalone checkpointing on 32-bit rhel 5. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2378\" onclick=\"get_ticket_and_populate_wrapper('2378'); return false;\" title=\"Standalone checkpointing test failing on 32-bit rhel5\">#2378</a></span> When using the OS's zlib to link standard universe binaries, resuming from a stand-alone checkpoint causes a crash on 32-bit rhel 5 (though not on 5.6). To solve this, re-add the zlib external, but only use it for linking standard universe binaries.\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Aug-15 11:36", "status": "resolved", "created": "2011-Aug-12 10:11", "fixed_version": "2011-Aug-12 10:11", "broken_version": "v070701", "priority": "2", "subsystem": "Tests", "assigned_to": "jfrey", "derived_from": "#1135", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": "20110816"}