{"id": 1098, "title": "Ticket #1098: Inconsistent treatment of undefined periodic expressions", "description": "<blockquote>\nWhen <span class=\"quote\">PeriodicHold=undefined</span>, the schedd ignores it.  The <code>GridManager</code>, <code>JobRouter</code>, and shadow, on the hand, all put the job on hold with something like the following hold reason (taken from an example where it was the <code>GridManager</code> that did it).  \"The UNKNOWN (never set) <code>PeriodicHold</code> expression '' evaluated to UNDEFINED\"\n\n<p>This inconsistency made it hard to understand behavior observed by Brian Bockelman in his submission of grid universe jobs.\n\n</p><p>In my opinion, two things should be fixed:\n\n</p><p></p><ol>\n<li>the schedd should put jobs on hold when periodic expressions are undefined\n\n<p></p></li><li>the hold reason should be less confusing\n</li></ol>\n\n<p>In the <code>GridManager</code>, the responsible code is in basejob.cpp:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">    case UNDEFINED_EVAL:\n\tJobHeld( reason.Value() );\n        SetEvaluateState();\n\tbreak;\n</pre></div>\n\n\n<p><code>JobRouter.cpp</code>:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">        case UNDEFINED_EVAL:\n            ret_val = SetJobHeld(job-&gt;src_ad, reason.Value());\n            break;\n</pre></div>\n\n\n<p>In shadow_user_policy.cpp:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">    case UNDEFINED_EVAL:\n            /*\n               If a given policy expression was undefined, the user\n               screwed something up and they better deal with it.  We\n               don't just want the job to leave the queue...\n            */\n        shadow-&gt;holdJob( reason.Value(), CONDOR_HOLD_CODE_JobPolicyUndefined, 0\\\n );\n   \tbreak;\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Jan-08 17:22:39 by matt:</em> <br/>\n\nSimilar problems have been seen with WANT_SUSPEND, see <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1001\" onclick=\"get_ticket_and_populate_wrapper('1001'); return false;\" title=\"Default WANT_SUSPEND policy goes UNDEFINED, startd EXCEPTs\">#1001</a></span>.\n\n<p>I think UNDEFINED should mean False/ignore, which has the nice bonus of not requiring all jobs to have all policy expressions defined.\n\n</p><p>A set of functions for extracting policy consistently across the code base seems even more useful now that this has been hit on the job policy side as well.\n</p><hr/>\n<em>2010-Aug-23 17:07:50 by adesmet:</em> <br/>\n\nBulk change of target version from v070402 to v070404 using ./ticket_target_mover.\n<hr/>\n<em>2010-Oct-27 16:39:01 by adesmet:</em> <br/>\n\nBulk change of target version from v070404 to v070405 using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2012-Oct-17 12:12", "status": "new", "created": "2010-Jan-08 16:13", "fixed_version": "2010-Jan-08 16:13", "broken_version": "v070401", "priority": "4", "subsystem": "Daemons", "assigned_to": "", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "other", "visibility": "public", "notify": "dan@hep.wisc.edu", "due_date": ""}