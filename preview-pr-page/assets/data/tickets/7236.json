{"id": 7236, "title": "Ticket #7236: Allow  maxjobs per workflow to be changed for running workflows", "description": "<blockquote>\nStuart wants the ability to edit maxjobs per workflow for running workflows. Stuart wants jobs to be aggressively evicted in LIFO (last in, first out) order to get below the specified max.</blockquote>", "remarks": "<blockquote>\n<em>2019-Sep-04 14:35:46 by anderson:</em> <br/>\n\nI would also like users (or cluster admins) to be able to change -maxidle for a running DAG as well.\n\n<p></p><hr/>\n<em>2019-Sep-19 14:58:26 by coatsworth:</em> <br/>\n\nWe've been discussing for some time about how to edit the properties of an in-progress DAG.\n\n<p>The ideal solution would be to make a new tool called <strong>condor_dagedit</strong>, which opens a socket connection to the condor_dagman process and sends it commands. So you could tell it to change <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxJobs\" title=\"Max Jobs\">MaxJobs</a></span>, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxIdle\" title=\"Max Idle\">MaxIdle</a></span> or really anything else this way. Unfortunately this also requires significant engineering effort, meaning it's is unlikely to happen anytime soon, if ever.\n\n</p><p>Another approach is for condor_dagedit to write a new event to the dagman event log, indicating that the value of an attribute has changed. Then when dagman scans the log, it takes action upon seeing the event. One advantage is that the change is persistent, it will be replayed in the event of dagman abort/recovery. A disadvantage is this must be run from the machine that submitted the job, it cannot be done remotely.\n\n</p><p>A third approach (which we like the best) is to skip making a new tool entirely. Instead we can just set these attributes via the condor_dagman job ad, then use condor_qedit to change the values. Every time that dagman updates its job ad with information about nodes completed, nodes ready, etc., it also checks if the other attributes (<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxJobs\" title=\"Max Jobs\">MaxJobs</a></span>, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxIdle\" title=\"Max Idle\">MaxIdle</a></span>, etc) have changed. If so, it updates its internal attributes. This approach is probably the easiest and fastest. The biggest problem is that dagman doesn't check in with the schedd very often, so it could take several minutes for the update to kick in (this can be tweaked, at the cost of heavier impact on the schedd).\n\n</p><p>Any thoughts on these?\n\n</p><p></p><hr/>\n<em>2019-Sep-19 15:03:44 by pfc:</em> <br/>\n\nThe third approach sounds great to me, and has the advantage that the current value is easy to inspect.  As for the frequency with which DAGMan checks, can't it be asked/forced to do so via another command if the user is impatient?   (I.e. condor_reconfig -dagman, or if that isn't sensible, a custom condor_dag_refresh akin to condor_reschedule?)\n\n<p></p><hr/>\n<em>2019-Oct-24 17:45:11 by coatsworth:</em> <br/>\n\nThis finished now and checked into our master branch, it will ship in the v8.9.5 release. I'm going to set this ticket to docpending so I can add documentation to the manual before closing it.\n\n<p>For a quick reference, you can now edit a running <code>condor_dagman</code> instance by setting values for any of the following attributes in the job ad:\n\n</p><p></p><ul>\n<li><code>DAGMan_MaxJobs</code>\n</li><li><code>DAGMan_MaxIdle</code>\n</li><li><code>DAGMan_MaxPreScripts</code>\n</li><li><code>DAGMan_MaxPostScripts</code>\n</li></ul>\n\n<p>When DAGMan notices that any of these attributes has a changed value, it will update its internal setting accordingly.\n\n</p><p></p><hr/>\n<em>2019-Nov-12 15:52:20 by coatsworth:</em> <br/>\n\nMarking as complete for now, some follow up work happening in <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7368\" onclick=\"get_ticket_and_populate_wrapper('7368'); return false;\" title=\"DAGMan should have option to evict jobs on MaxJobs changes\">#7368</a></span></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7368\" onclick=\"get_ticket_and_populate_wrapper('7368'); return false;\" title=\"DAGMan should have option to evict jobs on MaxJobs changes\">#7368</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDAGMan should have option to evict jobs on <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxJobs\" title=\"Max Jobs\">MaxJobs</a></span> changes</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Nov-12 14:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/eb1ef9a0451e7b58a9a4a2791b6762085f111ee9\">[58434]</a></span>: Added documentation + version history (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7236\" onclick=\"get_ticket_and_populate_wrapper('7236'); return false;\" title=\"Allow  maxjobs per workflow to be changed for running workflows\">#7236</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-25 11:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8ef415c6ef36382e7dec51f14e5b481546a0027b\">[58268]</a></span>: Removed unused debug variable (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7236\" onclick=\"get_ticket_and_populate_wrapper('7236'); return false;\" title=\"Allow  maxjobs per workflow to be changed for running workflows\">#7236</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-24 16:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/37d9c468d10ebd9493f5dda5f0a5a7fe496d64f8\">[58261]</a></span>: Added ability to edit running condor_dagman instances by editing job ad (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7236\" onclick=\"get_ticket_and_populate_wrapper('7236'); return false;\" title=\"Allow  maxjobs per workflow to be changed for running workflows\">#7236</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Nov-12 15:52", "status": "resolved", "created": "2019-Sep-04 14:34", "fixed_version": "2019-Sep-04 14:34", "broken_version": "v080900", "priority": "3", "subsystem": "Dag", "assigned_to": "coatsworth", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "coatsworth@cs.wisc.edu, gthain@cs.wisc.edu, pcouvare@caltech.edu, anderson@ligo.caltech.edu, tannenba@cs.wisc.edu, bbockelman@morgridge.org", "due_date": ""}