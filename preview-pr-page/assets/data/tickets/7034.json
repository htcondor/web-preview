{"id": 7034, "title": "Ticket #7034: condor_off -peaceful broken", "description": "<blockquote>\nLook like <code>condor_off -peaceful</code> broke in v8.7.10 ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6697\" onclick=\"get_ticket_and_populate_wrapper('6697'); return false;\" title=\"coordinated retirement while draining breaks HOLD_IF_MEMORY_EXCEEDED\">#6697</a></span> commit <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/01a31788f984bc8bda2bb2d6b2b35a9150e991f2\">[55260]</a></span>.\n\n<p>Specifically, -peaceful now acts just like -graceful if MAXJOBRETIREMENTTIME=0 in condor_config on the startd, which is the default setting.  This means with the default configuration, upon sending a condor_off -peaceful jobs will incorrectly get sent a SIGTERM after their max vacate time expires.\n\n</p><p><span class=\"subsection\"></span></p><h3>Immediate workaround</h3>\n\n<p>Until this bug is patched, if a site currently does not customize MAXJOBRETIREMENTTIME, a suggested workaround would be to add the following into the condor_config used by execute nodes\n\n</p><p></p><pre>   MAXJOBRETIREMENTTIME = 1\n</pre>\n\n<p>A side effect of this workaround is there will be a 1 second delay when/if HTCondor wants to preempt a job due to policy reasons.  But it should enable -peaceful to work as expected.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-May-09 13:53:16 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Patch looks good, resolving.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-09 14:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/29007d66cfb387ac5ad46882e20546a3b36754b3\">[56831]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7034\" onclick=\"get_ticket_and_populate_wrapper('7034'); return false;\" title=\"condor_off -peaceful broken\">#7034</a></span>) Release notes and documentation.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-09 13:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0add38461ee91167d897dfd516fa2f618dcfb633\">[56830]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7034\" onclick=\"get_ticket_and_populate_wrapper('7034'); return false;\" title=\"condor_off -peaceful broken\">#7034</a></span>) An MJRT of -1 now means preempt immediately, even if you're in a peaceful shutdown. Update PREEMPT_IF to use this value so that [PREEMPT|HOLD]_IF_[MEMORY|CPU]_EXCEEDED work as expected.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-May-09 16:41", "status": "resolved", "created": "2019-May-02 17:18", "fixed_version": "2019-May-02 17:18", "broken_version": "v080710", "priority": "1", "subsystem": "DaemonsExecNode", "assigned_to": "tlmiller", "derived_from": "", "creator": "tannenba", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pcouvare@caltech.edu, tannenba@cs.wisc.edu, tlmiller@cs.wisc.edu", "due_date": ""}