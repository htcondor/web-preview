{"id": 3556, "title": "Ticket #3556: Lark - Fix network accounting for bridge mode", "description": "<blockquote>\nThere's some obscure Linux setting which prevents iptables from seeing packets on bridges.\n\n<p>The default is like this to prevent the host networking from applying firewalls to the VM guests.\n\n</p><p>The lark use case is different - we want the packets to pass through the firewall for network accounting and/or any firewalling the sysadmin wants to perform on the job.\n\n</p><p>Find the right switch and flip it.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Mar-26 12:26:50 by bbockelm:</em> <br/>\n\nLooks like this is a bit more difficult than simply passing the bridged frames through iptables.\n\n<p>Right now, when that is done, the kernel appears to lose track of which device is sourcing/sinking the packet.  So, this policy no longer works:\n\n</p><p></p><div class=\"verbatim\">\n<pre>Chain tester (1 references)\n pkts bytes target     prot opt in     out     source               destination\n    0     0            all  --  e_tester !e_tester  anywhere             anywhere            /* Outgoing */\n    0     0            all  --  !e_tester e_tester  anywhere             anywhere            /* Incoming */\n</pre></div>\n\n\n<p>Instead, we need to use IP addresses - which implies refactoring the network accounting (for NAT mode, we can just refer to the interface name)</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-26 17:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6345938118c8cbafe7ae95958691abe25334c2f8\">[46467]</a></span>: Fix iptables configuration for bridge mode. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3556\" onclick=\"get_ticket_and_populate_wrapper('3556'); return false;\" title=\"Lark - Fix network accounting for bridge mode\">#3556</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "todo", "last_change": "2013-Mar-26 17:05", "status": "resolved", "created": "2013-Mar-26 11:52", "fixed_version": "2013-Mar-26 11:52", "broken_version": "", "priority": "4", "subsystem": "", "assigned_to": "bbockelm", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "lark", "visibility": "public", "notify": "", "due_date": ""}