<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="HTCondor Homepage">
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/web-preview/preview-release/assets/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/web-preview/preview-release/assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/web-preview/preview-release/assets/images/favicons/favicon-16x16.png">
    <link rel="manifest" href="/web-preview/preview-release/assets/images/favicons/site.webmanifest">
    <link rel="mask-icon" href="/web-preview/preview-release/assets/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/web-preview/preview-release/assets/images/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/web-preview/preview-release/assets/images/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <!-- Primary Meta Tags -->
    <meta name="title" content="HTCondor">
    <meta name="description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://htcondor.org/">
    <meta property="og:title" content="HTCondor">
    <meta property="og:description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">
    <meta property="og:image" content="https://htcondor.org/assets/images/HTC.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://htcondor.org/">
    <meta property="twitter:title" content="HTCondor">
    <meta property="twitter:description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">
    <meta property="twitter:image" content="https://htcondor.org/assets/images/HTC.png">

    <title>Dag Jobs On Same Machine</title>

    <script src="/web-preview/preview-release/assets/js/sitewide.js" type="text/javascript" defer></script>
    <script src="/web-preview/preview-release/assets/js/bootstrap.js" type="text/javascript"></script>
    <script src="/web-preview/preview-release/assets/js/lunr.js" type="text/javascript" async></script>
    <script src="/web-preview/preview-release/assets/js/search_bar.js" type="text/javascript" async></script>
    <script src="/web-preview/preview-release/assets/js/default.js" type="text/javascript" defer></script>

    

    

    <meta name="robots" content="noindex">

    

    <link href="/web-preview/preview-release/assets/css/style-v1.css" media="screen, tv, projection" title="Default" rel="stylesheet">
    

</head>
<body class="vh-100 d-flex flex-column">

<!-- For non-visual user agents: -->
<a id="skip-link" href="#main-copy">Skip to main content.</a>

<header id="header">
    <div class="mb-4 container">
        <div class="row">
            <div class="col-12">
                <nav class="navbar navBar navbar-expand-lg navbar-light w-100">
                    <a href="/web-preview/preview-release/index.html" class="d-none d-md-inline"><img height="75" alt="Condor High Throughput Computing" src="/web-preview/preview-release/assets/images/CondorTitle.png" style="border:0"></a>
                    <a href="/web-preview/preview-release/index.html" class="d-inline d-md-none"><img height="65" alt="Condor High Throughput Computing" src="/web-preview/preview-release/assets/images/HTCondor_red_blk.svg" style="border:0"></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mb-2 mb-lg-0 ms-auto mt-auto">
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-release/">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-release/new">News</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-release/downloads">Downloads</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-release/publications">Publications</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="mailto:htcondor-admin@cs.wisc.edu">Contact Us</a>
                            </li>
                            <li class="nav-item">
                                <div id="main-search-bar" class="search-bar">
                                    <input type="text" class="form-control" placeholder="Loading..." aria-describedby="button-addon2">
                                    <div class="results-dropdown" class="results-dropdown w-100">
                                        <div class="search-results" ></div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</header>
<main id="main-copy" tabindex="-1">
    <div class="container mb-4">
    <h1>Dag Jobs On Same Machine</h1>
<div id="content">
 A question that is often asked about DAGs is this:  how can I make
two or more DAG node jobs run on the same machine?  (Typically this
is because the first job generates large temporary files that are
to be used by the second job, and it is desirable to avoid having
to transfer those files between machines.)
 <p>
  This document presents a way to ensure that consecutive DAG nodes
run on the same machine, without pre-selecting a specific machine.
 </p>
 <p>
  (Note: this document refers to a jobs for a parent and a child node
running on the same machine; but the scheme can be easily extended
to any number of descendants.)
 </p>
 <p>
  <strong>
   The basic scheme
  </strong>
  :
 </p>
 <p>
  The parent node has a POST script that determines which machine the
node job ran on; this script then outputs a file containing the
machine name, and that file is incorporated into the submit file of
the child node job (and any subsequent jobs that should run on that
machine) in such a way that the child job is required to run on
that machine.
 </p>
 <p>
  This scheme takes advantage of claim leases (see
  <a class="external" href="http://research.cs.wisc.edu/htcondor/manual/v8.5/3_5Policy_Configuration.html#35520">
   http://research.cs.wisc.edu/htcondor/manual/v8.5/3_5Policy_Configuration.html#35520
  </a>
  ),
which DAGMan automatically sets to last for 20 seconds after the end
of a node job, if the node has children.  The claim lease allows a
second job from the same user to run on the execute machine without
having to go through a negotiation cycle.
 </p>
 <p>
  (Note that the duration of the claim lease can be changed by changing
the setting of the DAGMAN_HOLD_CLAIM_TIME configuration macro, as
in the example below.)
 </p>
 <p>
  <strong>
   Caveats
  </strong>
  :
 </p>
 <p>
 </p>
 <ul>
  <li>
   It is always possible for another job submitted by the same user
to "steal" the machine before the child job runs on it.  (In other
words, the child job is required to run on the designated machine,
but that machine is not required to run only the child job.)
(The job that does the "stealing" could be an entirely separate
job submitted by the same user, or another job from the same
DAG, if that job is not assigned to a specific machine.)
   <p>
   </p>
  </li>
  <li>
   (If DAGMAN_HOLD_CLAIM_TIME is sufficiently long, it is not possible
for a job from a different user to "steal" the machine.)
   <p>
   </p>
  </li>
  <li>
   For this scheme to work, the child job must have requirements
that will match whatever machine the parent job runs on.  (Ideally,
the two jobs should have identical requirements.)  If the child
job's requirements do
   <strong>
    not
   </strong>
   match the machine the parent ran on
(for example, the child job requires more memory), the child job
will never run, and, therefore, the DAG will never complete.
   <p>
   </p>
  </li>
  <li>
   Also, if the relevant machine encounters some problem that prevents
the child job from running, the DAG will never complete, because the
child job is not allowed to be run by any other machine.
   <p>
   </p>
  </li>
  <li>
   The jobs to be run on the same machine should belong to nodes
that have an immediate parent/child relationship in the DAG --
otherwise the claim lease is likely to expire before the child
job can run, if the machine is not "stolen" by another job.
   <p>
   </p>
  </li>
  <li>
   The submit file include feature that this example uses was
added in version 8.3.5.  If you are running an earlier
version of HTCondor, you can use a similar scheme, but the parent
node POST script would have to write out the entire submit file
for the child node job.
  </li>
 </ul>
 <p>
  <strong>
   Example
  </strong>
  :
 </p>
 <p>
  (This is a shortened version of the example in the attached tar file.)
 </p>
 <p>
  # File: example.dag
 </p>
 <p>
 </p>
 <pre>  config example.config
</pre>
 <p>
 </p>
 <pre>  job A0 nodeA.sub
  vars A0 node="$(JOB)"
  script post A0 post.pl B0 $JOBID
</pre>
 <p>
 </p>
 <pre>  job B0 nodeB0.sub
  vars B0 node="$(JOB)"
</pre>
 <p>
 </p>
 <pre>  parent A0 child B0
</pre>
 <p>
  # File: example.config
 </p>
 <p>
 </p>
 <pre>  DAGMAN_HOLD_CLAIM_TIME = 60
</pre>
 <p>
  # File: nodeA.sub
 </p>
 <p>
 </p>
 <pre>  executable = /bin/hostname
  output = $(node).out
  queue
</pre>
 <p>
  # File: nodeB0.sub
 </p>
 <p>
 </p>
 <pre>  executable = /bin/hostname
  output = $(node).out
  # Unfortunately, we can't use $(node) in the include file name.
  include : B0.inc
  requirements = TARGET.Name == $(my_machine)
  queue
</pre>
 <p>
  # File: post.pl
 </p>
 <p>
 </p>
 <pre>  #!/usr/bin/env perl
</pre>
 <p>
 </p>
 <pre>  $outfile = $ARGV[0] . ".inc";
</pre>
 <p>
 </p>
 <pre>  if (-e $outfile) {
         system("rm -f $outfile");
  }
</pre>
 <p>
 </p>
 <pre>  open(OUT, "&gt;$outfile") or die "Couldn't open output file $outfile: $!";
  $host = `condor_history $ARGV[1] -af LastRemoteHost -limit 1`;
  chomp $host;
  print OUT "my_machine = \"$host\"\n";
  close(OUT);
</pre>
 <p>
  On *nix systems, you should be able to copy and paste the example
above, or download the attached example tar file, and run the
example DAG without modification.  On Windows you will have to
make some small changes to the example for it to work.
 </p>
 <h3>
  Attachments:
 </h3>
 <blockquote>
  <ul>
   <li>
    <a href="attach_get/962/same_machine_example.tgz">
     same_machine_example.tgz
    </a>
    938 bytes added by wenger on 2016-Aug-11 22:34:09 UTC.
    <br/>
    Example DAG that forces each child node to run on the same machine that its parent ran on.
    <br/>
   </li>
  </ul>
 </blockquote>
</div>

</div>
</main>
<div id="footer" class="border-top mt-auto">
    <div class="container py-4">
        <div class="row">
            <div class="col text-center">
                For comments or questions about this website, please email
                <a href="mailto:htcondor-admin@cs.wisc.edu">htcondor-admin@cs.wisc.edu</a><br />
                This work is supported by <a href="https://www.nsf.gov/div/index.jsp?div=OAC">NSF</a> under Cooperative Agreement <a href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=2030508">OAC-2030508</a> as part of the <a href="https://path-cc.io/">PATh Project</a>. <br />
                <script type="text/javascript">
                    document.write("Updated &raquo; "+lastMod(document.lastModified))
                </script>
            </div>
        </div>
    </div>
</div>



</body>
</html>
