{"id": 7781, "title": "Ticket #7781: Add a SCRIPT HOLD feature to DAGMan", "description": "<blockquote>\nA couple different people have been asking about adding a mechanism into DAGMan that will execute a script when jobs go on hold.\n\n<p>Initially we talked about executing the POST script when jobs go on hold, but this results in really ugly semantics and conditions in the code that can only lead to pain and sorrow.\n\n</p><p>Instead, we propose adding a brand new HOLD script into <strong>condor_dagman</strong> that can be defined in a .dag file as follows:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">SCRIPT HOLD [JobName | ALL_NODES] ExecutableName [arguments]\n</pre></div>\n\n\n<p>This script will execute using similar mechanics to the pre and post scripts. One major difference is it will have no bearing on the final status of the node; whether or not a hold script succeeds, the dag will continue processing as per usual.\n\n</p><p>A design doc is available here: <a class=\"external\" href=\"https://docs.google.com/document/d/1HkdeFP-yrYUEEPHoSqGzJFc-lZy_Nf1Qqi3NMJ4rc8I/edit#\">https://docs.google.com/document/d/1HkdeFP-yrYUEEPHoSqGzJFc-lZy_Nf1Qqi3NMJ4rc8I/edit#</a></p></blockquote>", "remarks": "<blockquote>\n<em>2020-Nov-18 10:23:53 by tim:</em> <br/>\n\nMoved to <a class=\"external\" href=\"https://opensciencegrid.atlassian.net/browse/HTCONDOR-65\">https://opensciencegrid.atlassian.net/browse/HTCONDOR-65</a></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Nov-18 15:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/99300b55d0685269799e67650e970e911f2bed1c\">[61689]</a></span>: Added version history + fixed conf for jira extension (<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=7781\" onclick=\"get_ticket_and_populate_wrapper('7781'); return false;\" title=\"Add a SCRIPT HOLD feature to DAGMan\">#7781</a></span>) (HTCONDOR-65)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Nov-18 10:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6439614c8e31c253597eda6111380f926dcab0f6\">[61687]</a></span>: Added documentation (<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=7781\" onclick=\"get_ticket_and_populate_wrapper('7781'); return false;\" title=\"Add a SCRIPT HOLD feature to DAGMan\">#7781</a></span>) (HTCONDOR-65)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-15 15:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/853e839ffab83ec1e169b66b5cf3e11d63101216\">[61300]</a></span>: Added POST script check, initialized event name in dagman jobstate logging (<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=7781\" onclick=\"get_ticket_and_populate_wrapper('7781'); return false;\" title=\"Add a SCRIPT HOLD feature to DAGMan\">#7781</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-15 08:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ba6b5cf5106b561cacb8df88acbf1e07fa0f6b16\">[61297]</a></span>: Fix fedora warning about missing breaks in <span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=7781\" onclick=\"get_ticket_and_populate_wrapper('7781'); return false;\" title=\"Add a SCRIPT HOLD feature to DAGMan\">#7781</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-14 16:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d5da764349b51a2830030a096e6b1a8d51f3d348\">[61294]</a></span>: Fixed bug in max running scripts logic (<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=7781\" onclick=\"get_ticket_and_populate_wrapper('7781'); return false;\" title=\"Add a SCRIPT HOLD feature to DAGMan\">#7781</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-11 11:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ecd78e35119a970f5545f18ce1b0b6e82b9ac922\">[61293]</a></span>: Fixed logic errors with jobstate event log writing (<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=7781\" onclick=\"get_ticket_and_populate_wrapper('7781'); return false;\" title=\"Add a SCRIPT HOLD feature to DAGMan\">#7781</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-10 12:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/07c32cbd1ed67da07d256528ffebe57ebb7c73eb\">[61270]</a></span>: Added basic hold script reaper, doesn't need to do much (<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=7781\" onclick=\"get_ticket_and_populate_wrapper('7781'); return false;\" title=\"Add a SCRIPT HOLD feature to DAGMan\">#7781</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-03 17:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/228e7ce92e07cc587227cc39e602e532e9ce8808\">[61212]</a></span>: Completed DAGMan SCRIPT HOLD plumbing + basic functionality working correctly (<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=7781\" onclick=\"get_ticket_and_populate_wrapper('7781'); return false;\" title=\"Add a SCRIPT HOLD feature to DAGMan\">#7781</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-01 16:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/faf9c857f3c80086c713ce9a27dc88d7e18cd2cc\">[61210]</a></span>: Added basic SCRIPT HOLD plumbing, still not working correctly (<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=7781\" onclick=\"get_ticket_and_populate_wrapper('7781'); return false;\" title=\"Add a SCRIPT HOLD feature to DAGMan\">#7781</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-17 11:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/960994bfe8ad43fd5cd6e2a12e160ef87f40034b\">[60468]</a></span>: Refactored condor_dagman to accommodate more than two script types (<span class=\"ticket\"><a class=\"abandoned\" href=\"/wiki-archive/tickets/?ticket=7781\" onclick=\"get_ticket_and_populate_wrapper('7781'); return false;\" title=\"Add a SCRIPT HOLD feature to DAGMan\">#7781</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Nov-18 10:24", "status": "abandoned", "created": "2020-Aug-04 15:30", "fixed_version": "2020-Aug-04 15:30", "broken_version": "", "priority": "3", "subsystem": "Dag", "assigned_to": "coatsworth", "derived_from": "", "creator": "coatsworth", "rust": "s101113", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}