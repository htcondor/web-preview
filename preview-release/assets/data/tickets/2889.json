{"id": 2889, "title": "Ticket #2889: NMI glue leaving log files behind in /tmp on MacOS", "description": "<blockquote>\nThe new BaTLab MacOS machine has files in /tmp that were created by Condor and not removed when Condor was shut down.  I asked Jaime about this and he didn't think that Condor would leave files behind, so could someone else please investigate?\n\n<p>Here's the state of /tmp on exec-18 and some helpful output of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CondorVersion\" title=\"Condor Version\">CondorVersion</a></span> and a listing of any Condor binaries running on the machine.  As of now all slots are idle.\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">exec-18:tmp batlab-admin$ ls -lrt\ntotal 53200\ndrwx------  3 _spotlight    wheel       102 Mar  9 10:57 launchd-142.v98mrs\ndrwx------  3 slot3         wheel       102 Mar  9 12:16 launchd-61328.and0fU\ndrwx------  3 slot6         wheel       102 Mar  9 12:16 launchd-62672.IZcfyP\ndrwx------  3 slot1         wheel       102 Mar  9 12:18 launchd-73516.h2v68u\ndrwx------  3 slot7         wheel       102 Mar  9 12:21 launchd-22939.J1y5sn\ndrwx------  3 slot4         wheel       102 Mar  9 13:04 launchd-60028.YHWl7Z\ndrwx------  3 slot5         wheel       102 Mar  9 13:15 launchd-88306.QrLnUF\ndrwx------  3 slot4         wheel       102 Mar  9 13:26 launchd-24001.ESM6L4\ndrwx------  3 slot2         wheel       102 Mar  9 13:57 launchd-68318.ooVKLv\ndrwx------  3 slot5         wheel       102 Mar  9 14:02 launchd-71714.sDBqNX\ndrwx------  3 slot3         wheel       102 Mar  9 14:07 launchd-74706.hwc8GM\ndrwx------  3 slot5         wheel       102 Mar  9 15:25 launchd-86874.Sy32zu\ndrwx------  3 slot5         wheel       102 Mar  9 15:32 launchd-2534.3jaSn9\ndrwx------  3 slot7         wheel       102 Mar  9 20:34 launchd-51000.8z6EzK\ndrwx------  3 slot7         wheel       102 Mar  9 20:54 launchd-16798.UFBOVq\ndrwx------  3 slot2         wheel       102 Mar  9 21:24 launchd-41599.w0rDSb\ndrwx------  3 slot4         wheel       102 Mar  9 21:26 launchd-42230.BfKc2j\ndrwx------  3 slot7         wheel       102 Mar  9 21:49 launchd-14561.8mp3vx\ndrwx------  3 slot8         wheel       102 Mar  9 21:54 launchd-44924.XcU4EI\ndrwx------  3 slot6         wheel       102 Mar  9 22:00 launchd-60658.LZD9NL\ndrwx------  3 slot8         wheel       102 Mar  9 22:05 launchd-78929.8oxunO\ndrwx------  3 slot1         wheel       102 Mar  9 22:08 launchd-88311.TTHjrl\ndrwx------  3 slot6         wheel       102 Mar  9 22:10 launchd-90054.Zrb889\ndrwx------  3 slot2         wheel       102 Mar  9 22:13 launchd-92481.8mxbmi\ndrwx------  3 slot3         wheel       102 Mar  9 22:20 launchd-97738.PZMdEX\ndrwx------  3 slot1         wheel       102 Mar 10 06:09 launchd-77640.5XR2h9\ndrwx------  3 slot1         wheel       102 Mar 10 10:58 launchd-40421.NfY08Z\ndrwx------  3 slot1         wheel       102 Mar 10 19:00 launchd-70562.DDrQPb\ndrwx------  3 slot1         wheel       102 Mar 11 19:09 launchd-69047.il3e3g\ndrwx------  3 slot2         wheel       102 Mar 11 23:27 launchd-6705.5ReYyi\ndrwx------  3 slot1         wheel       102 Mar 11 23:40 launchd-78484.MOA1hE\ndrwx------  3 slot1         wheel       102 Mar 11 23:46 launchd-90567.4OtXvI\ndrwx------  3 slot2         wheel       102 Mar 12 11:00 launchd-69937.JptRjH\n-rw-r--r--  1 slot3         wheel    210050 Mar 12 11:43 CGAHPWorkerLog.slot3\n-rw-r--r--  1 slot3         wheel    333178 Mar 12 11:43 CGAHPLog.slot3\ndrwx------  3 slot5         wheel       102 Mar 12 15:59 launchd-49071.SEYFzy\ndrwx------  3 slot1         wheel       102 Mar 12 17:49 launchd-33693.kBGVqZ\n-rw-r--r--  1 slot1         wheel    405363 Mar 13 13:55 CGAHPWorkerLog.slot1\n-rw-r--r--  1 slot1         wheel    614887 Mar 13 13:55 CGAHPLog.slot1\n-rw-r--r--  1 batlab-admin  wheel  24078387 Mar 13 14:54 results.tar.gz\ndrwxr-xr-x  7 batlab-admin  wheel       238 Mar 13 14:56 public\n-rw-r--r--  1 slot4         wheel    131729 Mar 13 15:51 CGAHPWorkerLog.slot4\n-rw-r--r--  1 slot4         wheel    189489 Mar 13 15:51 CGAHPLog.slot4\ndrwx------  3 slot6         wheel       102 Mar 13 17:27 launchd-34101.cyI1f7\ndrwx------  3 slot7         wheel       102 Mar 13 17:31 launchd-52509.hGGLOq\n-rw-r--r--  1 slot5         wheel    138200 Mar 13 17:43 CGAHPWorkerLog.slot5\n-rw-r--r--  1 slot5         wheel    208708 Mar 13 17:43 CGAHPLog.slot5\n-rw-r--r--  1 slot6         wheel    140581 Mar 13 18:54 CGAHPWorkerLog.slot6\n-rw-r--r--  1 slot6         wheel    227793 Mar 13 18:54 CGAHPLog.slot6\n-rw-r--r--  1 slot7         wheel    207814 Mar 13 18:57 CGAHPWorkerLog.slot7\n-rw-r--r--  1 slot7         wheel    324352 Mar 13 18:57 CGAHPLog.slot7\ndrwx------  3 slot1         wheel       102 Mar 13 20:50 launchd-5243.QaUP3A\ndrwxr-xr-x  2 slot5         wheel        68 Mar 13 21:37 slot5-condor-test-sock\ndrwxrwxrwx  6 slot4         wheel       204 Mar 14 01:53 condorLocks\ndrwx------  3 batlab-admin  wheel       102 Mar 14 09:30 launchd-92763.TC5iPk\ndrwx------  3 _sshd         wheel       102 Mar 14 09:33 launchd-93370.DDHBfJ\n\nexec-18:tmp batlab-admin$ condor_version\n$CondorVersion: 7.7.4 Nov 03 2011 BuildID: 382880 PRE-RELEASE-UWCS $\n$CondorPlatform: x86_64_macos_10.6-updated $\n\nexec-18:tmp batlab-admin$ ps -efl | grep condor\n  999 37499    96   0 Fri11AM ??         6:36.15 condor_startd -f     4104  31  0  2453872   9172 -      Ss   ffffff8014235dc0\n    0 37551 37499   0 Fri11AM ??         1:33.46 condor_procd -A      4004  31  0  2441312  12244 -      S    ffffff8019e9aec0\n  501 94180 93191   0  9:39AM ttys000    0:00.01 grep condor          4006  31  0  2435176    676 -      R+   ffffff80174baec0\n\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Mar-16 11:28:56 by matt:</em> <br/>\n\nThis looks like the NMI Glue wrapping the test suite leaving log files behind. <strong>NOT</strong> Condor leaving files behind.\n\n<p>You will probably find similar files on other systems.\n\n</p><p>The glue should be fixed to put log files in the provided scratch directory, which Condor does clean up.\n\n</p><p></p><hr/>\n<em>2012-Mar-16 11:29:24 by matt:</em> <br/>\n\nThere is nothing in this ticket that is especially private, I'm changing it to public.\n\n<p></p><hr/>\n<em>2012-May-09 09:42:14 by kronenfe:</em> <br/>\n\nI submitted a fix to move the CGAHP files out of /tmp.\n\n<p>The launchd directories appear to be Mac specific directories containing just a socket.  They aren't specific to Condor.  When I logged into exec-18 and ran 'ls' in /tmp I saw these directories getting created - and also quickly removed - for my user 'kronenfe'.\n\n</p><p>Unless Becky objects, I believe I've moved the necessary files and I'll close this ticket once I verify my CGAHP change.\n\n</p><p>-scot\n\n</p><p></p><hr/>\n<em>2012-May-10 09:12:15 by kronenfe:</em> <br/>\n\nI confirmed that the tests still work after my change.  Resolving this.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-09 09:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c51aabcd558662a4681f23eb1d22d421be5d15db\">[31965]</a></span>: Fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2889\" onclick=\"get_ticket_and_populate_wrapper('2889'); return false;\" title=\"NMI glue leaving log files behind in /tmp on MacOS\">#2889</a></span> - move CGAHP log and lock files out of /tmp to avoid collisions between tests running on multiple slots (or possibly parallel tests in the future)  (By Scot Kronenfeld )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-May-10 14:55", "status": "resolved", "created": "2012-Mar-14 09:49", "fixed_version": "2012-Mar-14 09:49", "broken_version": "v070704", "priority": "1", "subsystem": "Tests", "assigned_to": "kronenfe", "derived_from": "", "creator": "bgietzel", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "bgietzel@cs.wisc.edu, tannenba@cs.wisc.edu, gthain@cs.wisc.edu, johnkn@cs.wisc.edu", "due_date": ""}