{"id": 4432, "title": "Ticket #4432: Make COLLECTOR_PORT a config knob", "description": "<blockquote>\nIn HTCondor-CE, we use a different default collector port (9619) than HTCondor's default (mostly to avoid a conflict between the CE and the site batch system).\n\n<p>Unfortunately, all the client tools assume port 9618; for example,\n\n</p><p>condor_status -pool foo.example.com\n\n</p><p>uses port 9618 with no way to override.\n\n</p><p>We keep a very small wrapper around HTCondor binaries (condor_ping becomes condor_ce_ping) for the client to make sure that the appropriate config files are used.  Hence, we could set a config knob such as:\n\n</p><p>COLLECTOR_PORT=9619\n\n</p><p>and have all the condor tools use that.  Unfortunately, COLLECTOR_PORT is a C++ #define and not a config knob.  Can this be changed?</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Jul-01 11:18:44 by tannenba:</em> <br/>\n\nThere are a few already existing ways that the tools can contact a collector on an alternate port:\n\n<p></p><ol>\n<li>You can specify a port on the command line, e.g.\n   condor_status -pool foo.edu:9619\n\n<p></p></li><li>You can specify a port in the config file for  <code>CONDOR_HOST</code>, e.g. <code>CONDOR_HOST = foo.edu:9619</code>\n\n<p></p></li><li>When the collector starts up, it will drop a file <code>log/.collector_address</code> that contains the address and port the collector is listening on.  If a client tool is told to connect to port 0 for the collector, perhaps by setting\n<code>CONDOR_HOST = foo.edu:0</code>\nin the config file, this tells the tool to lookup the actual port number to use in the <code>.collector_address</code> file.\n</li></ol>\n\n<p>Are any of the above mechanisms applicable to what you want to do?  Or do you still really want a COLLECTOR_PORT config knob.  I am not against adding one if pre-existing functionality cannot do the job, but wanted to check.\n\n</p><p></p><hr/>\n<em>2014-Jul-01 11:28:27 by bbockelm:</em> <br/>\n\nYeah - none of those quite capture what I'm trying to do.  Site admins are checking the config of their HTCondor-CE from a separate node by running:\n\n<p></p><div class=\"verbatim\">\n<pre>condor_ce_ping -pool foo.example.com -name foo.example.com\n</pre></div>\n\n\n<p>Since it's a remote CE host (and possibly one of several), probably can eliminate options (2) and (3) outlined above.\n\n</p><p>Option (1) works, but I want to have things \"work by default\".  The site admin was confused because he doesn't have to specify the default port for running condor_ping against his site but he has to specify the default port (9619) for condor_ce_ping.\n\n</p><p></p><hr/>\n<em>2014-Jul-14 19:57:44 by bbockelm:</em> <br/>\n\nPushed as V8_1-gt4432.  Todd, can you review?\n\n<p></p><hr/>\n<em>2014-Jul-15 12:46:10 by bbockelm:</em> <br/>\n\n<strong>Code Review</strong> (from Todd and Jaime on phone):\n<ul>\n<li>Let's go ahead and document this.\n</li><li>In the param table, allow \"0\" (for binding to a random port).\n</li><li>Add back COLLECTOR_PORT as a define to not scatter 9618 constant.\n</li><li>Consensus was that this shouldn't break std univ.</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Aug-29 13:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9cd2a0325d9343f5960aa944d029cbc3f6e8b7a1\">[41063]</a></span>: edits for new COLLECTOR_PORT knob <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4432\" onclick=\"get_ticket_and_populate_wrapper('4432'); return false;\" title=\"Make COLLECTOR_PORT a config knob\">#4432</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Aug-28 12:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e38c73025aaa897aaf210355773eced6e388edcf\">[41057]</a></span>: For param COLLECTOR_PORT, 65536 isn't a valid port number. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4432\" onclick=\"get_ticket_and_populate_wrapper('4432'); return false;\" title=\"Make COLLECTOR_PORT a config knob\">#4432</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jul-16 08:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/afe3f0233a8244d582cac2319c707df350b7c72b\">[40667]</a></span>: Code touch-up and documentation as identified in the review. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4432\" onclick=\"get_ticket_and_populate_wrapper('4432'); return false;\" title=\"Make COLLECTOR_PORT a config knob\">#4432</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jul-16 08:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3e96c37b4cf1e053033c0ad28a42028da263bcc5\">[40666]</a></span>: Have COLLECTOR_PORT be a configuration knob. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4432\" onclick=\"get_ticket_and_populate_wrapper('4432'); return false;\" title=\"Make COLLECTOR_PORT a config knob\">#4432</a></span> This is designed for applications which are built as wrappers around HTCondor and want to emulate the default port behavior in the tools. Examples are OSG's RSV and HTCondor-CE.\u00a0[...]\n (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jul-16 08:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f7e5dccab04c93e9caaa86c7bb0c65f7eb8efc03\">[40956]</a></span>: Code touch-up and documentation as identified in the review. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4432\" onclick=\"get_ticket_and_populate_wrapper('4432'); return false;\" title=\"Make COLLECTOR_PORT a config knob\">#4432</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jul-14 19:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4e1de88aff9be05e7d3b53d3f0e2c9edaa5245dc\">[40648]</a></span>: Have COLLECTOR_PORT be a configuration knob. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4432\" onclick=\"get_ticket_and_populate_wrapper('4432'); return false;\" title=\"Make COLLECTOR_PORT a config knob\">#4432</a></span> This is designed for applications which are built as wrappers around HTCondor and want to emulate the default port behavior in the tools. Examples are OSG's RSV and HTCondor-CE.\u00a0[...]\n (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Jul-16 08:45", "status": "resolved", "created": "2014-Jun-30 21:24", "fixed_version": "2014-Jun-30 21:24", "broken_version": "", "priority": "3", "subsystem": "DaemonsCM", "assigned_to": "tannenba", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu tannenba@cs.wisc.edu", "due_date": ""}