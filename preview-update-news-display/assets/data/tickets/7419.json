{"id": 7419, "title": "Ticket #7419: Cleanup crufty man page creation in CMake", "description": "<blockquote>\nWhen working on some man pages for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7361\" onclick=\"get_ticket_and_populate_wrapper('7361'); return false;\" title=\"Write manpages for condor_token_*\">#7361</a></span>, I noticed that our man page creation is filled with Rube Goldberg-esque gadgetry for what appears to be a fairly simple process.\n\n<p>Things I noticed:\n\n</p><p></p><ul>\n<li>Manpages only build in-source, which would break Todd's Docker images that suggest to mount the source code directory read-only.\n</li><li>If the in-source outputs are present, then re-running CMake will disable the creation of the manpages.  So, if you ever switch branches - or otherwise touch CMakeLists.txt, you must \"rm -rf\" all the manpage build products.  There is a comment from 2009 saying that this crazy setup is for an \"old version of NMI\".  Hopefully the need is passed!\n</li><li>CMake actually only gets as far as invoking a Makefile; the latter simply runs a single command\n</li><li>The CMake custom_command does not provide the right dependencies, meaning the docs are re-generated on every build -- even if no source files have changed.\n</li></ul>\n\n<p>I suspect a lot of this is coming from the old manual build -- which was far more complex.  For 8.9, it appears far simpler to invoke sphinx-build directly and with the appropriate command line arguments to place the build products in the build directory.\n\n</p><p>Here's some documentation I found to help this along: <a class=\"external\" href=\"https://eb2.co/blog/2012/03/sphinx-and-cmake-beautiful-documentation-for-c---projects/\">https://eb2.co/blog/2012/03/sphinx-and-cmake-beautiful-documentation-for-c---projects/</a></p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2019-Dec-09 10:14", "status": "new", "created": "2019-Dec-09 10:14", "fixed_version": "2019-Dec-09 10:14", "broken_version": "", "priority": "3", "subsystem": "Packaging", "assigned_to": "tim", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bbockelman@morgridge.org tannenba@cs.wisc.edu", "due_date": ""}