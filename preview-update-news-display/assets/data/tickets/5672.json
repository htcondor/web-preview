{"id": 5672, "title": "Ticket #5672: auth code problems in 8.5.5", "description": "<blockquote>\nIn OSG we did the 8.5.5 pre-release smoke test and ran into an issue, for details see: <a class=\"external\" href=\"https://jira.opensciencegrid.org/browse/SOFTWARE-2327\">https://jira.opensciencegrid.org/browse/SOFTWARE-2327</a>\n\n<p>The error was:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">SECMAN:2010:Received \"DENIED\" from server for user unauthenticated@unmapped using\nno authentication method, which may imply host-based security.  Our address was\n'::1', and server's address was '::1'.  Check your ALLOW settings and IP\nprotocols.\nCan't send Reconfig command to local master\n</pre></div>\n\n\n<p>Tim T said Zach would need to look.  Tim can add more comments also as he might have a better idea about the problem.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-May-12 16:24:15 by zmiller:</em> <br/>\n\nDefinitely smells like an IPv6 issues, so I am reassigning to Todd Miller.\n\n<p></p><hr/>\n<em>2016-May-12 16:58:01 by edquist:</em> <br/>\n\n<div class=\"code\">\n<pre class=\"code\">COMMAND: condor_reconfig -debug\nEXIT STATUS: 1\nSTANDARD OUTPUT:\n05/12/16 12:13:41 condor_read() failed: recv(fd=3) returned -1, errno = 104 Connection reset by peer, reading 5 bytes from &lt;[::1]:9618&gt;.\n05/12/16 12:13:41 IO: Failed to read packet header\n05/12/16 12:13:41 SECMAN: no classad from server, failing\nERROR\nSECMAN:2007:Failed to end classad message.\nCan't send Reconfig command to local master\nSTANDARD ERROR: [none]\n</pre></div>\n\n\n<p></p><hr/>\n<em>2016-May-23 14:44:40 by edquist:</em> <br/>\n\nAttaching logs &amp; config from a successful 8.5.4 run...\n\n<p></p><hr/>\n<em>2016-May-26 14:53:58 by tlmiller:</em> <br/>\n\nSo the biggest problem in the logs was that the shared port daemon wasn't working.\n\n<p>Turning off SELinux (completely -- disabled rather than permissive-mode) resolved that issue.  Experimentation revealed that starting HTCondor from the shell also avoided the problem, which suggests that systemd is Up To Something(TM).  (I was also fiddling with turning off the HTCondor \"socket\" system service-thing, but in retrospect I'm not sure that was actually doing anything -- I think \"stopping\" the socket service-thing was actually a no-op.)\n\n</p><p>However, even with the shared port daemon working, the authorization failure was still occurring.  This isn't surprising, given that ::1 really wasn't in the authorized list.  Since the client tools didn't use ::1 when HTCondor was started from the shell, I suspect the problem is how inheriting the socket from system means that HTCondor's command socket and configuration may disagree with each other.\n\n</p><p>Additionally, systemd binds both IPv4 and IPv6 to the same listen socket.  We distinctly chose not to do this in the HTCondor networking code, and may have odd problems a result.    For instance, I'm guessing that the address of the command port made it into the address file, and ::1 is the best we could do with such a weird hybrid entity.\n\n</p><p>See ticket <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=5690\" onclick=\"get_ticket_and_populate_wrapper('5690'); return false;\" title=\"systemd socket activation causes host-based security grief\">#5690</a></span>.\n\n</p><p>This ticket is otherwise resolved by disabling socket activation in the packaging for systemd-enabled distributions.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/941/condor-log-config.tgz\">condor-log-config.tgz</a>\n183935 bytes added by edquist on 2016-May-12 21:59:48 UTC.\n<br/>\nattaching tarball for /etc/condor and /var/log/condor dirs<br/>\n</li><li><a href=\"../files/942/condor-logs-8.5.4-success.tgz\">condor-logs-8.5.4-success.tgz</a>\n82950 bytes added by edquist on 2016-May-23 19:45:07 UTC.\n<br/>\nlogs &amp; config from a successful 8.5.4 run<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "", "type": "incident", "last_change": "2016-Jul-16 09:46", "status": "resolved", "created": "2016-May-12 15:23", "fixed_version": "2016-May-12 15:23", "broken_version": "v080505", "priority": "4", "subsystem": "Security", "assigned_to": "tlmiller", "derived_from": "", "creator": "edquist", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "tim@cs.wisc.edu, edquist@cs.wisc.edu, zmiller@cs.wisc.edu, tlmiller@cs.wisc.edu, blin@cs.wisc.edu", "due_date": ""}