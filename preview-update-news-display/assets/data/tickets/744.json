{"id": 744, "title": "Ticket #744: Node job abnormal term + recovery mode + node retries -> DAGMan error", "description": "<blockquote>\nLIGO just ran into the problem that, when DAGMan goes into recovery mode, and hits a node job that terminated abnormally and has retries, DAGMan hits a fatal error (this is from the dagman.out file):\n\n<p></p><pre>  9/11 23:55:23 Event: ULOG_JOB_TERMINATED for Condor Node6cc7c3f0914d5f352145006fcf860a4d (762838.0)\n  9/11 23:55:23 Node 6cc7c3f0914d5f352145006fcf860a4d job proc (762838.0) failed with signal 11.\n  9/11 23:55:23 Retrying node 6cc7c3f0914d5f352145006fcf860a4d (retry #1 of 1)...\n  9/11 23:55:23 Number of idle job procs: 0\n  9/11 23:55:23 ERROR \"Searched for node for cluster 762838; got -1!!\" at line 1151 in file dag.cpp\n</pre>\n\n<p>Note that if the node job fails but exits normally (e.g., returns a non-zero exit code rather than gets killed by a signal), DAGMan handles things correctly.\n\n</p><p>Here are the relevant parts of the node job log:\n\n</p><p></p><pre>  000 (762838.000.000) 09/11 00:54:30 Job submitted from host: &lt;10.20.30.1:34870&gt;\n      DAG Node: 6cc7c3f0914d5f352145006fcf860a4d\n  ...\n  &lt;lots of unimportant stuff cut&gt;\n  005 (762838.000.000) 09/11 16:58:05 Job terminated.\n          (0) Abnormal termination (signal 11)\n          (0) No core file\n                  Usr 0 00:00:00, Sys 0 00:00:00  -  Run Remote Usage\n                  Usr 0 00:00:00, Sys 0 00:00:00  -  Run Local Usage\n                  Usr 0 09:48:20, Sys 0 00:00:39  -  Total Remote Usage\n                  Usr 0 00:00:00, Sys 0 00:00:00  -  Total Local Usage\n          329  -  Run Bytes Sent By Job\n          743770368  -  Run Bytes Received By Job\n          0  -  Total Bytes Sent By Job\n          0  -  Total Bytes Received By Job\n  ...\n  009 (762838.000.000) 09/11 16:58:05 Job was aborted by the user.\n  ...</pre>\n</blockquote>", "remarks": "<blockquote>\nHmm -- now I'm not sure whether recovery mode has anything to do with it.  You certainly get the error in recovery mode, but it looks like you may get pretty much the same error when you're not in recovery mode.\n\n<p>Okay, it turns out that the critical thing is the \"Job was aborted by the user\" event -- we don't get that most of the time, and that goofs up DAGMan.\n\n</p><p>This is now fixed for 7.4.0.  (See also the new job_dagman_abnormal_term_recovery_retries test).</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Sep-16 16:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/08db7982a8c16efa61267bbe7d2d7512e576a8f5\">[24985]</a></span>: Fixed gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=744\" onclick=\"get_ticket_and_populate_wrapper('744'); return false;\" title=\"Node job abnormal term + recovery mode + node retries -&gt; DAGMan error\">#744</a></span> (abnormal termination + recovery mode + node retries causes DAGMan error); enabled the related job_dagman_abnormal_term_recovery_retries test.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Sep-16 16:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7c6a7bf783d99b3a84aba7aaf8d1794da426bd6e\">[15702]</a></span>: Fixed gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=744\" onclick=\"get_ticket_and_populate_wrapper('744'); return false;\" title=\"Node job abnormal term + recovery mode + node retries -&gt; DAGMan error\">#744</a></span> (abnormal termination + recovery mode + node retries causes DAGMan error); enabled the related job_dagman_abnormal_term_recovery_retries test.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Sep-15 18:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ec9f059c8558dd5d8af807d9cab2dc9430989aca\">[15701]</a></span>: Added job_dagman_abnormal_term_recovery_retries test (for gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=744\" onclick=\"get_ticket_and_populate_wrapper('744'); return false;\" title=\"Node job abnormal term + recovery mode + node retries -&gt; DAGMan error\">#744</a></span>) -- currently commented out because I don't have a fix yet.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2009-Dec-26 20:23", "status": "defer", "created": "2009-Sep-15 15:27", "fixed_version": "2009-Sep-15 15:27", "broken_version": "v070203", "priority": "5", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "s7835", "customer_group": "ligo", "visibility": "public", "notify": "wenger@cs.wisc.edu, psilord@cs.wisc,edu,pcouvare@caltech.edu", "due_date": ""}