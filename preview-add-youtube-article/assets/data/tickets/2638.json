{"id": 2638, "title": "Ticket #2638: MAX_<SUBSYS>_<LEVEL>_LOG not honored", "description": "<blockquote>\nParameters of the form MAX_&lt;SUBSYS&gt;_&lt;LEVEL&gt;_LOG in the config file are not honored. Debug level-specific log files (those set via &lt;SUBSYS&gt;_&lt;LEVEL&gt;_LOG) grow without bound. This was reported by Igor Sfiligoi and confirmed by Jaime Frey.\n\n<p>Igor's original email:\n</p><div class=\"code\">\n<pre class=\"code\">Seems like\nMAX_&lt;subsys&gt;_&lt;level&gt;_LOG\nis not honored.\n\nWe had set\nGRIDMANAGER_FULLDEBUG_LOG=$(GRIDMANAGER_LOG).fulldebug\nMAX_GRIDMANAGER_FULLDEBUG_LOG=1000000\nGRIDMANAGER_DEBUG=$(GRIDMANGER_DEBUG) D_FULLDEBUG\n\nbut the fulldebug files are now way too big!\n\n[gfactory@glidein:/tmp]$ ls -lrS\n...\n-rw-r--r--  1 condor  condor   30272306 Nov 11 20:46 GridmanagerLog.schedd_glideins3.fecms.fulldebug\n-rw-r--r--  1 condor  condor   30819112 Nov 11 20:46 GridmanagerLog.schedd_glideins7.fecms.fulldebug\n-rw-r--r--  1 condor  condor   30862403 Nov 11 20:46 GridmanagerLog.schedd_glideins19.fecms.fulldebug\n-rw-r--r--  1 condor  condor   47644375 Nov 11 20:46 GridmanagerLog.schedd_glideins18.fecms.fulldebug\n-rw-r--r--  1 condor  condor   48050678 Nov 11 20:46 GridmanagerLog.schedd_glideins17.fecms.fulldebug\n-rw-r--r--  1 condor  condor   50295843 Nov 11 20:46 GridmanagerLog.schedd_glideins10.fecms.fulldebug\n-rw-r--r--  1 condor  condor  118487712 Nov 11 20:46 GridmanagerLog.schedd_glideins15.fecms.fulldebug\n\nAre we doing anything wrong?\n</pre></div>\n\n\n<p>The maximum file size for the various daemon logs are stored in an array of off_t named <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxLog\" title=\"Max Log\">MaxLog</a></span>. Both dprintf.cpp and dprintf_config.cpp reference this array. The problem is that _FILE_OFFSET_BITS is #defined to 64 at the top of dprintf.cpp but not dprintf_config.cpp. Setting this macro this way causes off_t to change from a 32-bit value to a 64-bit value on 32-bit versions of linux. So the two source files think the elements in the array are different sizes.</p></blockquote>", "remarks": "<blockquote>\nI have reviewed this change and I approve it -tj</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/495/dprintf.patch\">dprintf.patch</a>\n414 bytes added by jfrey on 2011-Nov-16 17:07:57 UTC.\n<br/>\nPatch to fix dprintf rotation bug.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Nov-16 18:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/eb95781be427b234d2d562e42e93bee87482507b\">[28285]</a></span>: Fix config param MAX_&lt;SUBSYS&gt;_&lt;LEVEL&gt;_LOG on 32-bit linux. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2638\" onclick=\"get_ticket_and_populate_wrapper('2638'); return false;\" title=\"MAX_&lt;SUBSYS&gt;_&lt;LEVEL&gt;_LOG not honored\">#2638</a></span> Ensure that the off_t MaxLog[] uses the same size of off_t in both files where it's used. ===VersionHistory:Complete===  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Nov-21 11:54", "status": "resolved", "created": "2011-Nov-15 16:05", "fixed_version": "2011-Nov-15 16:05", "broken_version": "v070600", "priority": "4", "subsystem": "Daemons", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "s8096", "customer_group": "cms", "visibility": "public", "notify": "sfiligoi@fnal.gov,tstclair@redhat.com", "due_date": ""}