{"id": 4556, "title": "Ticket #4556: UDP invalidations can be sent to hosts without a UDP command socket", "description": "<blockquote>\nCurrently, if SEC_INVALIDATE_SESSIONS_VIA_TCP is set to false (default is true), then UDP-based invalidations will always be sent - even if the daemon's sinful string indicates no UDP command port is available.  This could be fixed with the patch below:\n\n<p></p><div class=\"verbatim\">\n<pre>--- a/src/condor_daemon_core.V6/daemon_core.cpp\n+++ b/src/condor_daemon_core.V6/daemon_core.cpp\n@@ -10660,7 +10660,7 @@ void DaemonCore::send_invalidate_session ( const char* sinful, const char* sessi\n        msg-&gt;setSuccessDebugLevel(D_SECURITY);\n        msg-&gt;setRawProtocol(true);\n\n-       if( m_invalidate_sessions_via_tcp ) {\n+       if( !daemon-&gt;hasUDPCommandPort() || m_invalidate_sessions_via_tcp ) {\n                msg-&gt;setStreamType(Stream::reli_sock);\n        }\n        else {\n</pre></div>\n\n\n<p>This logic goes against the sysadmin's wishes - but should be OK because these are non-blocking and the logic is consistent with how the schedd sends vacate messages to the startd.  We have not observed this to be a problem \"in the wild\" so a fix only on master would be fine.</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Aug-26 14:18:15 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This change looks good.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-05 12:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/73e0573672abfd514ee86fb93c76727255298c1c\">[43264]</a></span>: edits to 8.2.7 version history items <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4737\" onclick=\"get_ticket_and_populate_wrapper('4737'); return false;\" title=\"Fix-up python / classad object conversion\">#4737</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4556\" onclick=\"get_ticket_and_populate_wrapper('4556'); return false;\" title=\"UDP invalidations can be sent to hosts without a UDP command socket\">#4556</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=4760\" onclick=\"get_ticket_and_populate_wrapper('4760'); return false;\" title=\"Ignore additional files in config directory\">#4760</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Feb-05 11:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/342764956bc61cf2191683d48cfda52a13028856\">[43263]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4737\" onclick=\"get_ticket_and_populate_wrapper('4737'); return false;\" title=\"Fix-up python / classad object conversion\">#4737</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4556\" onclick=\"get_ticket_and_populate_wrapper('4556'); return false;\" title=\"UDP invalidations can be sent to hosts without a UDP command socket\">#4556</a></span> and <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=4760\" onclick=\"get_ticket_and_populate_wrapper('4760'); return false;\" title=\"Ignore additional files in config directory\">#4760</a></span>  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-16 13:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/90de41d00b0af8b74926c14ddbbb2fd0afaf3295\">[42262]</a></span>: Do not try to send a UDP invalidation to daemons where we know there is no UDP port. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4556\" onclick=\"get_ticket_and_populate_wrapper('4556'); return false;\" title=\"UDP invalidations can be sent to hosts without a UDP command socket\">#4556</a></span> Committer: Tim Theisen  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Aug-26 15:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c9da37810eb3fae7b7a727670785e5d698973b5c\">[41045]</a></span>: Do not try to send a UDP invalidation to daemons where we know there is no UDP port. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4556\" onclick=\"get_ticket_and_populate_wrapper('4556'); return false;\" title=\"UDP invalidations can be sent to hosts without a UDP command socket\">#4556</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Feb-05 13:51", "status": "resolved", "created": "2014-Aug-25 13:17", "fixed_version": "2014-Aug-25 13:17", "broken_version": "", "priority": "4", "subsystem": "", "assigned_to": "tim", "derived_from": "#4555", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "blin@cs.wisc.edu", "due_date": ""}