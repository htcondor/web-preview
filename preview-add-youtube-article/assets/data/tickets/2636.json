{"id": 2636, "title": "Ticket #2636: removing startd cron job causes startd to crash", "description": "<blockquote>\nI removed two startd cron jobs and ran condor_reconfig.  The startd crashed.\n\n<p>One or more of the cron jobs was running at the time, which may explain the problem.\n\n</p><p></p><div class=\"verbatim\">\n<pre>11/14/11 17:03:20 Killing job 0x132df430 'TEST_MACHINE'\n11/14/11 17:03:20 Erasing iterator\n11/14/11 17:03:20 Deleting job 0x132df430\n11/14/11 17:03:20 CronJob: Deleting job 'TEST_MACHINE' (/opt/hawkeye/test_machine/bin/test_machine_hawkeye), timer 8\n11/14/11 17:03:20 Killing job 0x132dda30 'TEST_MACHINE_MONITOR'\n11/14/11 17:03:20 Erasing iterator\n11/14/11 17:03:20 Deleting job 0x132dda30\n11/14/11 17:03:20 CronJob: Deleting job 'TEST_MACHINE_MONITOR' (/opt/hawkeye/test_machine/bin/test_machine_hawkeye), timer 9\nStack dump for process 9191 at timestamp 1321311809 (10 frames)\ncondor_startd(dprintf_dump_stack+0x56)[0x5cdb66]\ncondor_startd(_Z18linux_sig_coredumpi+0x4d)[0x5192dd]\n/lib64/libpthread.so.0[0x2b37f953ab70]\ncondor_startd(_ZN10DaemonCore10CallReaperEiPKcii+0x118)[0x500828]\ncondor_startd(_ZN10DaemonCore17HandleProcessExitEii+0x1a7)[0x513077]\ncondor_startd(_ZN10DaemonCore24HandleDC_SERVICEWAITPIDSEi+0x2e)[0x5131de]\ncondor_startd(_ZN10DaemonCore6DriverEv+0x1ec)[0x50bdbc]\ncondor_startd(main+0xe47)[0x51ba57]\n/lib64/libc.so.6(__libc_start_main+0xf4)[0x2b37f9764994]\ncondor_startd(__gxx_personality_v0+0x401)[0x4cb0d9]\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Nov-16 11:31:02 by danb:</em> <br/>\n\nI was able to reproduce the problem by creating a cron job that sleeps for a long time.  If I remove that cron job and reconfig the startd, the startd crashes when it tries to call the reaper, which is a member function of an object that has been deleted.  One problem is that <code>DaemonCore::Cancel_Reaper()</code> did not actually unregister the reaper.  I have created a patch that fixes that and avoids the crash.\n\n<p></p><hr/>\n<em>2011-Nov-16 11:32:06 by danb:</em> <br/>\n\nThe problem likely goes back before 7.6.4.  I haven't bothered to trace the history of it.\n\n<p></p><hr/>\n<em>2011-Dec-12 16:04:15 by johnkn:</em> <br/>\n\nI notice that this patch doesn't free the <em>reap_descrip</em> and <em>handler_descrip</em> strings, but Register_Reaper does free them so this is not actually a leak.\n\n<p>Other than that, this looks good to me. -tj</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Nov-17 11:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/63c1644675a9e01d48ed2a7b4f56dacda8dc7dbf\">[28298]</a></span>: edits of 7.6.5 version history items. Matt: run a spell checker! ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2579\" onclick=\"get_ticket_and_populate_wrapper('2579'); return false;\" title=\"Issues in load_avg.cpp and Linux 3.x kernel\">#2579</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2636\" onclick=\"get_ticket_and_populate_wrapper('2636'); return false;\" title=\"removing startd cron job causes startd to crash\">#2636</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2603\" onclick=\"get_ticket_and_populate_wrapper('2603'); return false;\" title=\"Condor_q -analyze chokes on string attributes that end in backslash\">#2603</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Nov-16 11:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e1d298d751dca79a322a1ec875d06617f2f6448d\">[28274]</a></span>: Documented fix for startd crash when running cron job is removed. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2636\" onclick=\"get_ticket_and_populate_wrapper('2636'); return false;\" title=\"removing startd cron job causes startd to crash\">#2636</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Nov-16 11:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/afa2658d7d45ea109f0320919ebff4cf3a0cabd9\">[28273]</a></span>: Fix startd crash when running cron job is removed. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2636\" onclick=\"get_ticket_and_populate_wrapper('2636'); return false;\" title=\"removing startd cron job causes startd to crash\">#2636</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Dec-12 17:09", "status": "resolved", "created": "2011-Nov-14 17:16", "fixed_version": "2011-Nov-14 17:16", "broken_version": "v070604", "priority": "2", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "dan@hep.wisc.edu", "due_date": ""}