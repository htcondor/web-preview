{"id": 7489, "title": "Ticket #7489: HTCondor can't annex Spot", "description": "<blockquote>\nOn January 24, 2020, we received a user report that <code>condor_annex</code> could no longer use Spot instances.  After reproducing the initial user report, and having made no changes to the code, we contacted the Head of AWS Research to see what was going on.  He put us in contact with the Principal Developer Advocate for EC2 Spot, who was quickly able to tell us:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">The dev team tracked things down. A change was rolled out that flipped the\nparameters to UpperCamelCase (i.e. \"tagSpecificationSet\" to\n\"TagSpecificationSet\", \"groupSet\" to \"GroupSet\", \"blockDeviceMapping\" to\n\"BlockDeviceMapping\").\n</pre></div>\n\n\n<p>We made the obvious changes to the code, confirmed that they solved the problem, and had pre-releases ready for distribution the next day.</p></blockquote>", "remarks": "<blockquote>\n<em>original description:</em> <br/>\n\nDaniel Corbett wrote on 2020 January 24 to say that he was getting the following error when trying to use <code>condor_annex</code> with Spot Fleet:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\\n\n&lt;Response&gt;\n&lt;Errors&gt;&lt;Error&gt;<code>UnknownParameter</code>\n&lt;Message&gt;The parameter groupSet is not recognized&lt;/Message&gt;\n&lt;/Error&gt;&lt;/Errors&gt;\n&lt;RequestID&gt;6e371b3b-bdd9-4df6-a0e1-a9c4b8d57d1e&lt;/RequestID&gt;\n&lt;/Response&gt;\n</pre></div>\n\n\n<p>The problem was trivial to reproduce on our resources, but did not happen as a result of any code changes that we made or configuration changes made by Daniel.\n\n</p><p><em>2020-Feb-04 22:41:34 by tlmiller:</em> <br/>\n\nAfter a brief phone call, the Principal Developer Advocate for EC2 Spot wrote:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">The dev team tracked things down. A change was rolled out that flipped the\nparameters to UpperCamelCase (i.e. \"tagSpecificationSet\" to\n\"TagSpecificationSet\", \"groupSet\" to \"GroupSet\", \"blockDeviceMapping\" to\n\"BlockDeviceMapping\").\n</pre></div>\n\n\n<p>A quick smoke-tests seems to verify this.  Patches forthcoming.\n\n</p><p></p><hr/>\n<em>2020-Feb-04 23:27:21 by tlmiller:</em> <br/>\n\nPatches pushed, under the assumption that the additional testing tomorrow won't find any problems.  Should mean that we can make pre-releases available tomorrow.\n\n<p></p><hr/>\n<em>2020-Feb-05 14:03:58 by tlmiller:</em> <br/>\n\nAdditional testing looks good.\n\n<p></p><hr/>\n<em>2020-Feb-06 15:39:58 by tlmiller:</em> <br/>\n\nBecause the protocol change was only from a lower to an upper case letter, it may be possible to fix older binaries by editing the string constants in place.  The following pair of commands did the trick on a binary built from the top of the 8.9.5 release branch (assuming ec2_gahp is in your PATH):\n\n<p></p><div class=\"code\">\n<pre class=\"code\">perl -p -i -e 's/groupSet\\./GroupSet./' `which ec2_gahp`\nperl -p -i -e 's/tagSpecificationSet\\.1\\./TagSpecificationSet.1./' `which ec2_gahp`\n</pre></div>\n\n\n<p>These commands (or the equivalent invocations of <code>sed</code>, if you don't have perl installed) may work on other version of the <code>ec2_gahp</code> as well; it's not particularly likely that the bytes of those two strings collide with any binary code.  However, you should certainly make a back-up copy of the ec2_gahp first.  You can check to make sure that only two bytes were change by running <code>hexdump</code> on the ec2_gahp before and after and comparing them:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">cp `which ec2_gahp` ec2_gahp.backup\nhexdump `which ec2_gahp` &gt; unmodified.dump\nperl -p -i -e 's/groupSet\\./GroupSet./' `which ec2_gahp`\nperl -p -i -e 's/tagSpecificationSet\\.1\\./TagSpecificationSet.1./' `which ec2_gahp`\nhexdump `which ec2_gahp` &gt; modified.dump\ndiff -u unmodified.dump modified.dump\n</pre></div>\n\n\n<p>The diff should show only two changed lines.\n</p><hr/>\n<em>2020-Apr-10 07:43:03 by tim:</em> <br/>\n\nBulk change of target version from v080808 to v080809 using ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-22 13:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5e5ac5ad5dd81cca6c3498113bb6b3c72bb193c7\">[59020]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7489\" onclick=\"get_ticket_and_populate_wrapper('7489'); return false;\" title=\"HTCondor can't annex Spot\">#7489</a></span>) Documentation. And a documentation fix.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-04 23:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9f0f843d26bf246b465ee64352a4115d24840916\">[58901]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7489\" onclick=\"get_ticket_and_populate_wrapper('7489'); return false;\" title=\"HTCondor can't annex Spot\">#7489</a></span>) Remove stray newline (again -- lost while cherry-picking).  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-04 23:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d947e6f415d273828f3dbbf5968b0759ba2a595c\">[58899]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7489\" onclick=\"get_ticket_and_populate_wrapper('7489'); return false;\" title=\"HTCondor can't annex Spot\">#7489</a></span>) Remove stray newline. AWS documentation was updated to suggest that arrays of parameters should start at 1. As a result of an unannounced change at AWS, convert lowerCamelCase parameter names to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UpperCamelCase\" title=\"Upper Camel Case\">UpperCamelCase</a></span> parameter names.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Apr-10 07:43", "status": "resolved", "created": "2020-Feb-04 22:34", "fixed_version": "2020-Feb-04 22:34", "broken_version": "", "priority": "1", "subsystem": "Annex", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "a99485", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}