{"id": 7422, "title": "Ticket #7422: Fix NEGOTIATOR_DEPTH_FIRST with custom SLOT_WEIGHT", "description": "<blockquote>\n<code>NEGOTIATOR_DEPTH_FIRST</code> assumes that <code>SLOT_WEIGHT</code> is set to the default value of <code>Cpus</code>. If the slot weight expression is set differently, it will mis-count the number of jobs that will fit in a pslot. It also will over-count the number of jobs by one if the pslot's <code>Cpus</code> isn't a multiple of the job's <code>RequestCpus</code>.</blockquote>", "remarks": "<blockquote>\n<em>2019-Dec-20 16:16:24 by gthain:</em> <br/>\n\n<strong>CODE REVIEW</strong>  Going forward, we should use std::min and std::max instead of macros, but otherwise fine.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Dec-10 14:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ea506eb55e05d9ebf37a059a2ffbb79ca2ddea4b\">[58630]</a></span>: Docs for NEGOTIATOR_DEPTH_FIRST with SLOT_WEIGHT bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7422\" onclick=\"get_ticket_and_populate_wrapper('7422'); return false;\" title=\"Fix NEGOTIATOR_DEPTH_FIRST with custom SLOT_WEIGHT\">#7422</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Dec-10 14:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/95a4263ac9586dcb953b5e6ad9f368efac18ea5e\">[58629]</a></span>: Fix NEGOTIATOR_DEPTH_FIRST with custom SLOT_WEIGHT. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7422\" onclick=\"get_ticket_and_populate_wrapper('7422'); return false;\" title=\"Fix NEGOTIATOR_DEPTH_FIRST with custom SLOT_WEIGHT\">#7422</a></span> The negotiator's calculation of how many jobs fit in a pslot should not be affected by slot weight. Also, it now looks at requested memory and doesn't over count by one if the division doesn't come out evenly.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Dec-20 16:16", "status": "resolved", "created": "2019-Dec-10 14:38", "fixed_version": "2019-Dec-10 14:38", "broken_version": "v080507", "priority": "2", "subsystem": "DaemonsCM", "assigned_to": "gthain", "derived_from": "#5884", "creator": "jfrey", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}