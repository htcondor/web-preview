{"id": 2555, "title": "Ticket #2555: master sends UDP collector updates when collector doesn't accept UDP", "description": "<blockquote>\nIn the personal condor used by the new batlab to run the user's tasks, it was observed that the shared port daemon received unregistered commands:\n\n<p></p><pre>   10/14/11 11:30:21 Received UDP command (2) (UNREGISTERED COMMAND!) from  &lt;128.104.103.16:29282&gt;\n</pre>\n\n<p>This is because the master was trying to use UDP to send updates to the collector, even though the collector had a shared-port address, which means it does not support UDP.  Why didn't the master automatically switch to using TCP, like all other daemons?  Because the collector's port is configured as 0 in the config file.  This has the special meaning that the address should be looked up in the collector address file.  The first time the master does this, the address file doesn't exist yet.  The next time it does this, the reading of the address file is done by a different piece of code.  This other code does not check to see if the address supports UDP, so the default setting is used.  Since the collector is using a shared port, when the master incorrectly tries to send UDP messages to the collector, it actually ends up sending them to the shared port server, which doesn't recognize the commands.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-17 13:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27860\">[27860]</a></span>: Fix problem in which master tries to use UDP to update collector that has no UDP port. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2555\" onclick=\"get_ticket_and_populate_wrapper('2555'); return false;\" title=\"master sends UDP collector updates when collector doesn't accept UDP\">#2555</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-17 13:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=27861\">[27861]</a></span>: Documented fix for problem in which master tries to use UDP to update collector that has no UDP port. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2555\" onclick=\"get_ticket_and_populate_wrapper('2555'); return false;\" title=\"master sends UDP collector updates when collector doesn't accept UDP\">#2555</a></span> ===VersionHistory:Complete===  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Oct-17 13:38", "status": "resolved", "created": "2011-Oct-17 13:09", "fixed_version": "2011-Oct-17 13:09", "broken_version": "v070501", "priority": "4", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "", "due_date": ""}