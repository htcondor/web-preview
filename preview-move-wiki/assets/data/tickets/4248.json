{"id": 4248, "title": "Ticket #4248: Node status counts are incorrect after DAG abort", "description": "<blockquote>\nOn a DAG abort, the counts of the nodes in various statuses doesn't seem to get correctly updated -- it seems like the node that caused the abort is counted as unready, not failed.  For example, this node status file is generated by job_dagman_abort-A:\n\n<p></p><pre>  BEGIN 1394131261 (Thu Mar  6 12:41:01 2014)\n  Status of nodes of DAG(s): job_dagman_abort-A.dag\n</pre>\n\n<p></p><pre>  JOB A STATUS_DONE      ()\n  JOB B STATUS_DONE      ()\n  JOB C STATUS_ERROR     (Job proc (751.0.0) failed with status 5)\n  JOB D STATUS_UNREADY   ()\n</pre>\n\n<p></p><pre>  Nodes total: 4\n  Nodes done: 2\n  Nodes pre: 0\n  Nodes queued: 0\n  Nodes post: 0\n  Nodes ready: 0\n  Nodes un-ready: 2\n  Nodes failed: 0\n</pre>\n\n<p></p><pre>  DAG status: STATUS_ERROR     (success)\n  Next scheduled update: none\n  END 1394131261 (Thu Mar  6 12:41:01 2014)\n</pre>\n\n<p>Note that node C is correctly listed as failed at the top, but the status counts at the bottom do not reflect that (the status counts in the dagman.out file are also incorrect).\n\n</p><p>(Also note the goofy overall DAG status...)</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Mar-10 14:00:05 by wenger:</em> <br/>\n\nNote:  I'm working on this on V8_0-gittrac_4209-branch in conjunction with <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4209\" onclick=\"get_ticket_and_populate_wrapper('4209'); return false;\" title=\"DAG final node goofs up node status file\">#4209</a></span>.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jun-03 12:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=40323\">[40323]</a></span>: Minor 8.0.7 edits and a clarafication about DAG FINAL nodes. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4209\" onclick=\"get_ticket_and_populate_wrapper('4209'); return false;\" title=\"DAG final node goofs up node status file\">#4209</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4248\" onclick=\"get_ticket_and_populate_wrapper('4248'); return false;\" title=\"Node status counts are incorrect after DAG abort\">#4248</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-20 12:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39668\">[39668]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4209\" onclick=\"get_ticket_and_populate_wrapper('4209'); return false;\" title=\"DAG final node goofs up node status file\">#4209</a></span> / <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4248\" onclick=\"get_ticket_and_populate_wrapper('4248'); return false;\" title=\"Node status counts are incorrect after DAG abort\">#4248</a></span>: Updated the manual; also a couple of very minor fixes to the related tests.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-18 12:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39655\">[39655]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4209\" onclick=\"get_ticket_and_populate_wrapper('4209'); return false;\" title=\"DAG final node goofs up node status file\">#4209</a></span> / <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4248\" onclick=\"get_ticket_and_populate_wrapper('4248'); return false;\" title=\"Node status counts are incorrect after DAG abort\">#4248</a></span>: Hopefully the final version except for manual changes -- all tests now pass except for job_dagman_abort-B.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-17 17:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39647\">[39647]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4209\" onclick=\"get_ticket_and_populate_wrapper('4209'); return false;\" title=\"DAG final node goofs up node status file\">#4209</a></span> / <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4248\" onclick=\"get_ticket_and_populate_wrapper('4248'); return false;\" title=\"Node status counts are incorrect after DAG abort\">#4248</a></span> / <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=4253\" onclick=\"get_ticket_and_populate_wrapper('4253'); return false;\" title=\"DAGMan abort-dag-on test improvement\">#4253</a></span>: Changed job_dagman_abort-B to hit a slighly different variation -- the test now fails because DAGMan doesn't handle this corner case correctly.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-17 15:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39644\">[39644]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4209\" onclick=\"get_ticket_and_populate_wrapper('4209'); return false;\" title=\"DAG final node goofs up node status file\">#4209</a></span> / <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4248\" onclick=\"get_ticket_and_populate_wrapper('4248'); return false;\" title=\"Node status counts are incorrect after DAG abort\">#4248</a></span>: All tests now pass; still need to do lots of cleanup. Fixed a bunch of the tests because STATUS_UNREADY is now STATUS_NOT_READY in the node status file, to be consistent.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-11 17:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39581\">[39581]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4209\" onclick=\"get_ticket_and_populate_wrapper('4209'); return false;\" title=\"DAG final node goofs up node status file\">#4209</a></span> / <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4248\" onclick=\"get_ticket_and_populate_wrapper('4248'); return false;\" title=\"Node status counts are incorrect after DAG abort\">#4248</a></span>: Added new job_dagman_cycle-A test (passes, but not yet enabled); added checking of node status file to job_dagman_final-I (fails, dammit!).  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-09 18:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39580\">[39580]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4209\" onclick=\"get_ticket_and_populate_wrapper('4209'); return false;\" title=\"DAG final node goofs up node status file\">#4209</a></span> / <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4248\" onclick=\"get_ticket_and_populate_wrapper('4248'); return false;\" title=\"Node status counts are incorrect after DAG abort\">#4248</a></span>: All tests now pass; still need to do lots of cleaning up, and checking to make sure I haven't introduced any new errors... (Made some changes to the abort tests to make them more deterministic -- but we should add an abort test that makes sure an abort removes other running jobs.)\u00a0[...]\n (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-06 16:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39547\">[39547]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4209\" onclick=\"get_ticket_and_populate_wrapper('4209'); return false;\" title=\"DAG final node goofs up node status file\">#4209</a></span> / <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4248\" onclick=\"get_ticket_and_populate_wrapper('4248'); return false;\" title=\"Node status counts are incorrect after DAG abort\">#4248</a></span>: Better testing for node status file problems: added some new tests, and added checking of the node status file to job_dagman_abort-A. (Note that new tests aren't enabled yet -- they should be enabled when this is all merged to 8.1/master.)  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Oct-12 16:24", "status": "resolved", "created": "2014-Mar-06 12:51", "fixed_version": "2014-Mar-06 12:51", "broken_version": "v080006", "priority": "2", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "#4209", "creator": "wenger", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "wenger@cs.wisc.edu, bbockelm@cse.unl.edu, johnkn@cs.wisc.edu", "due_date": ""}