{"id": 5770, "title": "Ticket #5770: Audit log reads job proxy as wrong user", "description": "<blockquote>\nWhen the input sandbox is received by the schedd, it attempts to read the job's proxy as the condor user for the audit log. Now that the job's spool directory can be born owned by the job owner, this file access needs to be done as the job owner when appropriate. Otherwise, it will fail, as the proxy has restrictive file permissions.</blockquote>", "remarks": "<blockquote>\n<em>2016-Jul-01 11:03:52 by tannenba:</em> <br/>\n\nIn addition to when the input sandbox is received by the schedd, doesn't the audit log code also want to read the proxy whenever an updated proxy is pushed to the schedd?  Perhaps that is a second place where the code will need to be changed to chown to the user first.\n\n<p></p><hr/>\n<em>2016-Jul-01 11:20:54 by jfrey:</em> <br/>\n\nThe schedd already does the right thing when receiving an updated proxy. It checks the ownership of the job's spool directory and switches to user priv if necessary for both writing the proxy and reading it for the audit log.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jul-01 11:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48722\">[48722]</a></span>: Docs for audit log proxy reading bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5770\" onclick=\"get_ticket_and_populate_wrapper('5770'); return false;\" title=\"Audit log reads job proxy as wrong user\">#5770</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jul-01 11:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48721\">[48721]</a></span>: Read proxy as correct user for audit log on input transfer. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5770\" onclick=\"get_ticket_and_populate_wrapper('5770'); return false;\" title=\"Audit log reads job proxy as wrong user\">#5770</a></span> If the job's spool directory is owned by the user, then switch to user priv for accessing the proxy file for the audit log. Also, call uninit_user_ids() if we bail out early due to failure.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Jul-01 11:26", "status": "resolved", "created": "2016-Jul-01 10:58", "fixed_version": "2016-Jul-01 10:58", "broken_version": "v080500", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "#5226", "creator": "jfrey", "rust": "", "customer_group": "cern", "visibility": "public", "notify": "iain.steers@cern.ch,tannenba@cs.wisc.edu", "due_date": ""}