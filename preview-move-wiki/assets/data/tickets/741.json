{"id": 741, "title": "Ticket #741: Code Cleanup: WIN32 DAGMan hack in schedd.cpp", "description": "<blockquote>\nThis appears in schedd.cpp, and from the sounds of it should not anymore.\n\n<p></p><div class=\"code\">\n<pre class=\"code\">#ifdef WIN32\n\t\t\t/*\tThis is a small patch so when DAGMan jobs are removed\n\t\t\t\ton Win32, jobs submitted by the DAGMan are removed as well.\n\t\t\t\tThis patch is small and acceptable for the 6.8 stable series,\n\t\t\t\tbut for v6.9 and beyond we should remove this patch and have things\n\t\t\t\twork on Win32 the same way they work on Unix.  However, doing this\n\t\t\t\twas deemed to much code churning for a stable series, thus this\n\t\t\t\tsimpler but temporary patch.  -Todd 8/2006.\n\t\t\t*/\n\t\tint job_universe = CONDOR_UNIVERSE_MIN;\n\t\tGetAttributeInt(job_id.cluster, job_id.proc,\n\t\t\t\t\t\tATTR_JOB_UNIVERSE, &amp;job_universe);\n\t\tif ( job_universe == CONDOR_UNIVERSE_SCHEDULER ) {\n\t\t\tMyString constraint;\n\t\t\tconstraint.sprintf( \"%s == %d\", ATTR_DAGMAN_JOB_ID,\n\t\t\t\t\t\t\t\tjob_id.cluster );\n\t\t\tabortJobsByConstraint(constraint.Value(),\n\t\t\t\t\"removed because controlling DAGMan was removed\",\n\t\t\t\ttrue);\n\t\t}\n#endif\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2010-Oct-20 15:59:08 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2011-Jan-22 13:48:58 by wenger:</em> <br/>\n\nNote: I haven't tested this, but it looks to me like on Windows, a condor_hold of a DAGMan job will remove all of the DAG's node jobs, which is different than the behavior on other platforms.\n\n<p></p><hr/>\n<em>2011-Feb-08 16:09:37 by psilord:</em> <br/>\n\nI will review the work for this ticket with Kent at 2pm Feb 9th, 2011.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/266/gt741.dif\">gt741.dif</a>\n5292 bytes added by wenger on 2011-Jan-26 21:49:50 UTC.\n<br/>\nThis is a diff with the proposed changes.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jan-27 12:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ef6ac440f663a7eed7d657b169e08b7239a7d87f\">[25854]</a></span>: Fixed gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=741\" onclick=\"get_ticket_and_populate_wrapper('741'); return false;\" title=\"Code Cleanup: WIN32 DAGMan hack in schedd.cpp\">#741</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1490\" onclick=\"get_ticket_and_populate_wrapper('1490'); return false;\" title=\"condor_hold + condor_rm of DAG goofs things up\">#1490</a></span> -- DAG child job removal code in the schedd now works for all platforms, but only when removing a job, not holding it, etc.; it looks for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ChildRemoveConstraint\" title=\"Child Remove Constraint\">ChildRemoveConstraint</a></span> in the removed job's classad, and removes jobs matching that constraint.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jan-27 12:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9f20f6a431f21dd39b6791cc97c5339608d750e6\">[20148]</a></span>: Fixed gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=741\" onclick=\"get_ticket_and_populate_wrapper('741'); return false;\" title=\"Code Cleanup: WIN32 DAGMan hack in schedd.cpp\">#741</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1490\" onclick=\"get_ticket_and_populate_wrapper('1490'); return false;\" title=\"condor_hold + condor_rm of DAG goofs things up\">#1490</a></span> -- DAG child job removal code in the schedd now works for all platforms, but only when removing a job, not holding it, etc.; it looks for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ChildRemoveConstraint\" title=\"Child Remove Constraint\">ChildRemoveConstraint</a></span> in the removed job's classad, and removes jobs matching that constraint.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Feb-09 17:43", "status": "resolved", "created": "2009-Sep-15 06:16", "fixed_version": "2009-Sep-15 06:16", "broken_version": "v070000", "priority": "1", "subsystem": "Daemons", "assigned_to": "psilord", "derived_from": "#1284", "creator": "matt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu, wenger@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": "20110209"}