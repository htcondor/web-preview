{"id": 6198, "title": "Ticket #6198: File Transfer does not perform integrity checking", "description": "<blockquote>\nThe manual implies that setting up network privacy and integrity checking via knobs like\n\n<p></p><pre>   SEC_DEFAULT_INTEGRITY=REQUIRED\n   SEC_DEFAULT_ENCRYPTION=REQUIRED\n</pre>\n\n<p>will result in integrity and encryption of a job's sandbox that is transferred via HTCondor File transfer (i.e. transfer_input_files, etc).\n\n</p><p>The reality is that File Transfer will honor the encryption settings, but will <em>not</em> honor the integrity settings.  Integrity checks do work correctly on all HTCondor communications <em>except</em> for transferring job files.\n\n</p><p>The reason for this is CEDAR (HTCondor's network communication library) packetizes TCP streams and sends the integrity checksum in the packet header; however, CEDAR's get_file() and put_file() methods which are used by File Transfer are implemented as a raw unpacketized stream for performance reasons.\n\n</p><p>So I guess the bad news is integrity checking does not and never has worked on job file transfers.  The good news is integrity checking is not \"broken\" per se, and still works correctly to protect the integrity of HTCondor daemon-to-daemon and tool-to-daemon communications.\n\n</p><p>At the very least, we need to immediately document this (unexpected) behavior in the Manual for all active versions of HTCondor. That is the purpose for this documentation ticket.  A separate enhancement ticket should be created to enhance File Transfer to perform integrity checks per file, and perhaps attempt a limited number of retransmissions for files that fail the check.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Mar-21 13:45:47 by tannenba:</em> <br/>\n\nMade documentation change to Manual on V8_4-branch, V8_6-branch, and master branch.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-21 13:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/751df7eaaafb974b7d22eaadc49f5165cc2115f4\">[50351]</a></span>: Document that File Transfer will not do integrity checking. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6198\" onclick=\"get_ticket_and_populate_wrapper('6198'); return false;\" title=\"File Transfer does not perform integrity checking\">#6198</a></span> The SEC_DEFAULT_INTEGRITY knob has no impact of file transfers because CEDAR's get_file() and put_file() do not do any buffering or packetizing.  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "doc", "last_change": "2017-Mar-21 13:55", "status": "resolved", "created": "2017-Mar-21 13:38", "fixed_version": "2017-Mar-21 13:38", "broken_version": "v080000", "priority": "3", "subsystem": "FileTransfer", "assigned_to": "tannenba", "derived_from": "", "creator": "tannenba", "rust": "a31460", "customer_group": "osg", "visibility": "public", "notify": "rynge@isi.edu bbockelm@cse.unl.edu tannenba@cs.wisc.edu", "due_date": ""}