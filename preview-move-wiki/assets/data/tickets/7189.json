{"id": 7189, "title": "Ticket #7189: Output and error logs lost across job restarts", "description": "<blockquote>\n<div class=\"snip\">\n<pre class=\"sniplabel\">Episode 2</pre>\n<pre class=\"snip\">Did you know that self-checkpointing jobs overwrite stderr and stdout after an\neviction/rematch, rather than appending?\n</pre></div>\n\n\n<p></p><div class=\"snip\">\n<pre class=\"sniplabel\">later clarification</pre>\n<pre class=\"snip\">If you job uses \u201cwhen_to_transfer_output = ON_EXIT_OR_EVICT\u201d and is evicted, the\nstderr and stdout get overwritten (or re-written?). I know that some jobs using\n\u2018ON_EXIT_OR_EVICT\u2019 may not be self-checkpointing, but for jobs that ARE, it\u2019s\nkind of absurd that stderr/stdout aren\u2019t appended.\n</pre></div>\n\n\n<p>Added submit command <code>erase_output_and_error_on_restart</code>, which defaults to true.  The submit command <em>does not</em> append to the named output and error files if they already exist on disk; it only preserves them across restarts, and only if <code>when_to_transfer_output</code> is set to <code>ON_EXIT_OR_EVICT</code>.  We could work around that if we needed to, at the cost of a considerably more complicated patch.\n\n</p><p>Notes:\n\n</p><p></p><ul>\n<li>We don't have to make this the default (with a config knob for backwards\n    compatibility); it's easy enough to set the default with a submit transform.\n    We may even be able to set that up as a meta-knob.\n</li><li>Partly because of this (we shouldn't warn if you're over-riding a default),\n    don't warn if <code>erase...</code> is false and <code>when...</code> isn't <code>ON_EXIT_OR_EVICT</code>.\n</li></ul>\n\n<p>Action items:\n\n</p><p></p><ul>\n<li>Come up with a better name.\n</li><li>Test what happens with a job using a shared file system.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2019-Oct-08 17:36:34 by tlmiller:</em> <br/>\n\nDocumentation complete.  Would still like to test what happens on shared filesystems (and just document the result).\n\n<p></p><hr/>\n<em>2019-Oct-16 14:16:37 by tlmiller:</em> <br/>\n\nTested file transfer with the following job, by letting it get started, calling <code>condor_vacate_job</code> on it, and then rescheduling it.\n\n<p></p><div class=\"file\">\n<pre class=\"filelabel\">counter.submit</pre>\n<pre class=\"file\">executable              = ./counter.sh\ntransfer_executable     = true\nshould_transfer_files   = true\nwhen_to_transfer_output = on_exit_or_evict\nuniverse                = vanilla\n\nlog                     = counter/log\noutput                  = counter/out\nerror                   = counter/err\n\nerase_output_and_error_on_restart = FALSE\n\nqueue 1\n</pre></div>\n\n\n<p>Did the same thing to the following job, and it worked just as well.  (Test was run a personal condor, not using a multihost shared file system.)\n\n</p><p></p><div class=\"file\">\n<pre class=\"filelabel\">counter-shared-fs.submit</pre>\n<pre class=\"file\">executable              = /home/tlmiller/Work/third.condor/test/counter.sh\ntransfer_executable     = false\nshould_transfer_files   = false\nuniverse                = vanilla\n\nlog                     = counter/log\noutput                  = counter/out\nerror                   = counter/err\n\nerase_output_and_error_on_restart = FALSE\n\nqueue 1\n</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-11 14:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58142\">[58142]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7189\" onclick=\"get_ticket_and_populate_wrapper('7189'); return false;\" title=\"Output and error logs lost across job restarts\">#7189</a></span>) Removed unprintable character in version history  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-11 14:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58140\">[58140]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7189\" onclick=\"get_ticket_and_populate_wrapper('7189'); return false;\" title=\"Output and error logs lost across job restarts\">#7189</a></span>) Documentation. Committer: Tim Theisen  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-08 14:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58054\">[58054]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7189\" onclick=\"get_ticket_and_populate_wrapper('7189'); return false;\" title=\"Output and error logs lost across job restarts\">#7189</a></span>) Documentation.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-03 19:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57574\">[57574]</a></span>: (<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=754\" onclick=\"get_ticket_and_populate_wrapper('754'); return false;\" title=\"Option for jobs that run multiple times to append to output and error\">#754</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7189\" onclick=\"get_ticket_and_populate_wrapper('7189'); return false;\" title=\"Output and error logs lost across job restarts\">#7189</a></span>) Provisionally rename to \"erase_output_and_error_on_restart\", defaulting to true.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jul-16 17:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57571\">[57571]</a></span>: (<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=754\" onclick=\"get_ticket_and_populate_wrapper('754'); return false;\" title=\"Option for jobs that run multiple times to append to output and error\">#754</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7189\" onclick=\"get_ticket_and_populate_wrapper('7189'); return false;\" title=\"Output and error logs lost across job restarts\">#7189</a></span>) Implement append_output_and_error for vanilla-universe jobs.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Oct-16 14:16", "status": "resolved", "created": "2019-Aug-06 12:07", "fixed_version": "2019-Aug-06 12:07", "broken_version": "", "priority": "2", "subsystem": "DaemonsExecNode", "assigned_to": "tlmiller", "derived_from": "#7158", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}