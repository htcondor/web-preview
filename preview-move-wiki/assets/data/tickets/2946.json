{"id": 2946, "title": "Ticket #2946: Enforce strict FIFO of parallel jobs even with remote submission", "description": "<blockquote>\nThe Dedicated Scheduler runs parallel jobs in a FIFO manner.  However, when jobs are submitted remotely, and their input is spooled, the dedicated scheduler will only run the jobs that have finished spooling their input.  Therefore, it is possible that a job with a later cluster id will be ready to run before a job with an earlier cluster ids.\n\n<p>This will introduce a parameter that will cause very strict FIFO even in this case -- idle dedicated jobs will wait for earlier jobs to finish spooling before being considered to run.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Sep-26 13:40:51 by tstclair:</em> <br/>\n\ncommit here.. is this done?\n\n<p></p><hr/>\n<em>2013-May-20 14:55:43 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Logic of the patch seems flawed.  Patch has\n</p><div class=\"code\">\n<pre class=\"code\">ClassAd *spoolingInJob = GetJobByConstraint(fifoConstraint.c_str());\nif (spoolingInJob) {\n   spoolingInJob-&gt;LookupInteger(ATTR_CLUSTER_ID, cluster_causing_skippage);\n}\n</pre></div>\n\n\n<p>The above code will find <em>some</em> cluster that meets the fifo constraint, but will not find the <em>smallest</em> cluster that meets the fifo constraint.  Seem like as written, the patch will fail to work correctly if three jobs are submitted (job 1.0, 2.0, 3.0) and lets say 1.0 and 3.0 are still spooling.  Isn't it possible that job 2.0 will be able to run if <code>GetJobByConstraint()</code> happens to return 3.0 ?  Shouldn't the code patch iterate through all the jobs that match the constraint and store the one with the lowest cluster id?\n\n</p><p>Also there are no documentation commits for this ticket.  (or regression tests).\n\n</p><p></p><hr/>\n<em>2013-May-20 17:24:43 by gthain:</em> <br/>\n\nHOWTO reproduce:\n\n<p>in the condor_config, set\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">DEDICATED_SCHEDULER_WAIT_FOR_SPOOLER = true\n</pre></div>\n\n\n<p>Spin up a personal condor, and submit several parallel jobs.  Put them all on hold with a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=HoldReasonCode\" title=\"Hold Reason Code\">HoldReasonCode</a></span> of 16 (HOLD_CODE_SpoolingInput)\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">$condor_hold -a\n$condor_qedit gthain HoldReasonCode 16\n\n</pre></div>\n\n\n<p>Then, submit a new parallel job, and check for the following message in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SchedLog\" title=\"Sched Log\">SchedLog</a></span>:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">05/20/13 17:22:45 (pid:11678) Job 377.0 is spooling input files, will block all 381.0 until spooling completes\n05/20/13 17:22:45 (pid:11678) Job 377.0 is spooling input files, will block all 379.0 until spooling completes\n05/20/13 17:22:45 (pid:11678) Found no idle dedicated job(s)\n</pre></div>\n\n\n<p>Release all the job, making sure to first set the hold code to something other than 16, so that condor_release will work, and watch the jobs match and run.\n\n</p><p></p><hr/>\n<em>2013-May-21 11:38:07 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW #2</strong>\n\n<p><span class=\"chng\"><a href=\"chngview?cn=35771\">[35771]</a></span> looks good, thanks.  Note that  <span class=\"chng\"><a href=\"chngview?cn=35771\">[35771]</a></span> is being released in v8.0.0.\n\n</p><p>Switching ticket to docpending...\n\n</p><p></p><hr/>\n<em>2013-May-23 10:58:26 by gthain:</em> <br/>\n\nand docs are complete</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-29 16:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35936\">[35936]</a></span>: add version history item and minor edit to defn of new knob: DEDICATED_SCHEDULER_WAIT_FOR_SPOOLER ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2946\" onclick=\"get_ticket_and_populate_wrapper('2946'); return false;\" title=\"Enforce strict FIFO of parallel jobs even with remote submission\">#2946</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-21 10:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35773\">[35773]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2946\" onclick=\"get_ticket_and_populate_wrapper('2946'); return false;\" title=\"Enforce strict FIFO of parallel jobs even with remote submission\">#2946</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-20 17:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=35771\">[35771]</a></span>: Fixes from code review <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2946\" onclick=\"get_ticket_and_populate_wrapper('2946'); return false;\" title=\"Enforce strict FIFO of parallel jobs even with remote submission\">#2946</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-19 10:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=31744\">[31744]</a></span>: Add support for DEDICATED_SCHEDULER_WAIT_FOR_SPOOLER <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2946\" onclick=\"get_ticket_and_populate_wrapper('2946'); return false;\" title=\"Enforce strict FIFO of parallel jobs even with remote submission\">#2946</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-May-23 10:58", "status": "resolved", "created": "2012-Apr-19 10:07", "fixed_version": "2012-Apr-19 10:07", "broken_version": "v070000", "priority": "3", "subsystem": "Parallel", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "s8126", "customer_group": "support", "visibility": "public", "notify": "gthain@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}