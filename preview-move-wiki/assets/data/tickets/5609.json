{"id": 5609, "title": "Ticket #5609: Docker universe should advertise cpu usage", "description": "<blockquote>\nCurrently, docker universe jobs report wall time, but not cpu (user or system) time.  The procd can't measure these directly, as the actual job is rooted under the docker server, which is not a child of the starter.\n\n<p>The docker stats API exposes job and cpu runtime, but not all the way to the CLI tools.  So, to get the usage, HTCondor will need to either call the API directly, which we have not done for previous docker integration, or get the usage directory from the container's cgroup.  We've been uneager to do the latter, because we'd like the cgroup that docker uses to be somewhat abstracted from HTCondor.\n\n</p><p>Another issue is that the stats api doesn't report usage for containers that have been stopped or exited.  This means that the starter will need to poll for usage, and will miss any usage that happens between the last polling period and job exit.  The starter will poll these statistics more frequently than the job update interval in order to minimize such lossage.\n\n</p><p>The api exposes both user and system cpu, which the starter will insert in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RemoteSysCpu\" title=\"Remote Sys Cpu\">RemoteSysCpu</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RemoteUserCpu\" title=\"Remote User Cpu\">RemoteUserCpu</a></span>, in seconds.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Apr-08 13:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48190\">[48190]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5609\" onclick=\"get_ticket_and_populate_wrapper('5609'); return false;\" title=\"Docker universe should advertise cpu usage\">#5609</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Apr-08 13:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48189\">[48189]</a></span>: Docker universe now measure user and sys cpu usage <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5609\" onclick=\"get_ticket_and_populate_wrapper('5609'); return false;\" title=\"Docker universe should advertise cpu usage\">#5609</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Apr-08 13:21", "status": "resolved", "created": "2016-Apr-07 10:45", "fixed_version": "2016-Apr-07 10:45", "broken_version": "v080500", "priority": "2", "subsystem": "DaemonsExecNode", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}