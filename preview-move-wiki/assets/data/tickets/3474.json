{"id": 3474, "title": "Ticket #3474: DAGMan jobs and Condor-C", "description": "<blockquote>\nIgor reports that when using multiple logs with DAGMan and submitting to grid universe Condor, one gets:\n<div class=\"verbatim\">\n<pre>012 (4326.000.000) 01/30 16:25:52 Job was held.\n       Failed to initialize user log to /dev/null or &lt;path to DAGManNodesLog&gt;\n       Code 22 Subcode 0\n</pre></div>\n\n\n<p>Igor also reports this reproduces 100% of the time.\n\n</p><p>It appears that the code for multiple logs was added by nwp on commit 2834e640.  See also htcondor-support #8256.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Feb-01 14:53:25 by sfiligoi:</em> <br/>\n\nJust to be clear:\nThe path of the dagmanlog is valid (and is not /dev/null).\n\n<p>The message is just misleading.\n\n</p><p></p><hr/>\n<em>2013-Feb-01 15:03:48 by nwp:</em> <br/>\n\nCan you provide a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobAd\" title=\"Job Ad\">JobAd</a></span> where this is happening?  It will help in debugging.\n\n<p></p><hr/>\n<em>2013-Feb-01 15:19:50 by sfiligoi:</em> <br/>\n\nSubmit file with problems:\n<div class=\"code\">\n<pre class=\"code\">universe = grid\ngrid_resource = condor red.unl.edu red.unl.edu:9619\n\nexecutable = a.sh\noutput = a.out.$(Cluster).$(Process)\nerror = a.err.$(Cluster).$(Process)\nlog = a.log\nDAGManNodesLog=b.log\n\nShouldTransferFiles = YES\nWhenToTransferOutput = ON_EXIT\n\nx509userproxy = /home/sfiligoi/.globus/x509_igor_cms\n\nqueue 1\n</pre></div>\n\n\n<p>Submit file without problems:\n</p><div class=\"code\">\n<pre class=\"code\">universe = grid\ngrid_resource = condor red.unl.edu red.unl.edu:9619\n\nexecutable = a.sh\noutput = a.out.$(Cluster).$(Process)\nerror = a.err.$(Cluster).$(Process)\nlog = a.log\n\nShouldTransferFiles = YES\nWhenToTransferOutput = ON_EXIT\n\nx509userproxy = /home/sfiligoi/.globus/x509_igor_cms\n\nqueue 1\n</pre></div>\n\n\n<p></p><hr/>\n<em>2013-Feb-01 15:46:03 by nwp:</em> <br/>\n\nQuestion ought to be \"What is Condor-C doing that it gives a hoot about DAGManNodesLog?\"\n\n<p></p><hr/>\n<em>2013-Feb-01 16:36:17 by wenger:</em> <br/>\n\nYeah, that's was I was wondering.  I don't know why Condor-C should care about this...  (I initially thought that an invalid path was goofing things up, but Igor says any path, even valid, for DAGManNodesLog causes problems.)\n\n<p></p><hr/>\n<em>2013-Feb-01 17:20:23 by bbockelm:</em> <br/>\n\nIsn't it as simple as just removing this attribute from the job by default when Condor-C is used?\n\n<p>Igor, what happens if you add the following to the submit file:\n\n</p><p>+remote_ DAGManNodesLog = /dev/null\n\n</p><p>?\n\n</p><p></p><hr/>\n<em>2013-Feb-01 17:47:29 by bbockelm:</em> <br/>\n\nIgor asked me to explain more thoroughly -\n\n<p>Condor-C will copy all the attributes from the submit schedd to the remote schedd by default.  In particular, DAGManNodesLog is copied to the remote side.  In particular, if you have the htcondor-ce-client installed, you can do this:\n\n</p><p></p><div class=\"verbatim\">\n<pre>_condor_SUBMIT_EXPRS=DAGManNodesLog _condor_DAGManNodesLog=\"/tmp/baz/boo\" condor_ce_run red.unl.edu:9619 echo \"hello world\"\n</pre></div>\n\n\n<p>On the remote side:\n\n</p><p></p><div class=\"verbatim\">\n<pre>[root@red ~]# condor_ce_q uscmsPool018 -held\n\n\n-- Submitter: red.unl.edu : &lt;129.93.239.129:9620?sock=8556_0571_4&gt; : red.unl.edu\n ID       OWNER          HELD_SINCE  HOLD_REASON\n43851.0   uscmsPool018    2/1  17:40 Failed to initialize user log to /dev/null or /tmp/baz/boo\n\n1 jobs; 0 completed, 0 removed, 0 idle, 0 running, 1 held, 0 suspended\n</pre></div>\n\n\n<p>(I made it so the /tmp/baz/ directory was root-owned on the CE but the user could write into it on the submit node).  Then, on the submit side:\n\n</p><p></p><div class=\"verbatim\">\n<pre>[bbockelm@hcc-briantest rpmbuild]$ condor_q -held\n\n\n-- Submitter: hcc-briantest.unl.edu : &lt;129.93.244.208:33351&gt; : hcc-briantest.unl.edu\n ID      OWNER          HELD_SINCE  HOLD_REASON\n 132.0   bbockelm        2/1  17:41 Failed to initialize user log to /dev/null or /tmp/baz/boo\n\n1 jobs; 0 completed, 0 removed, 0 idle, 0 running, 1 held, 0 suspended\n</pre></div>\n\n\n<p>While we're at it, can we change the hold reason on the submit side to reflect where the hold is coming from?\n\n</p><p></p><hr/>\n<em>2013-Feb-01 19:03:25 by nwp:</em> <br/>\n\nIf both the userlog and the DAGManNodesLog are /dev/null, DAGMan will not get the events that track the job's progress. DAGMan will never see a job be submitted, execute, and terminate.\n\n<p></p><hr/>\n<em>2013-Feb-04 12:16:41 by nwp:</em> <br/>\n\nFrom a discussion on #discomp: the plan should be to have Condor-C suppress the DAGManNodesLog attribute, verify that that works correctly, and write a job_dagman_condorc regression test to make sure it continues to work correctly.\n\n<p></p><hr/>\n<em>2013-Feb-19 15:42:54 by wenger:</em> <br/>\n\nI think the initial description is a bit unclear/incorrect -- if I remember correctly, the problem happens when DAGMan uses the <strong>single</strong> default log file for all of the node jobs; if you just have DAGMan use the log files specified in the submit files, things work okay.  So it fails with the default log file, but works if you have multiple log files (it should also work if you specify the <strong>same</strong> log file in each submit file -- it's the \"default log\" specification that goofs things up.\n\n<p></p><hr/>\n<em>2013-Feb-25 15:49:00 by nwp:</em> <br/>\n\nCan Igor or Brian try condor-c with the attached patch?\n\n<p></p><hr/>\n<em>2013-Mar-29 11:08:44 by jfrey:</em> <br/>\n\nThis problem was triggered by <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=2807\" onclick=\"get_ticket_and_populate_wrapper('2807'); return false;\" title=\"Have DAGMan use a single node job user log file\">#2807</a></span> with the addition of the DAGManNodesLog job attribute. We need to strip this attribute when submitting a Condor-C job to a remote schedd.\n\n<p></p><hr/>\n<em>2013-Mar-29 11:49:00 by nwp:</em> <br/>\n\nThis shows we need a DAGMAN/CondorC regression test.\n\n<p></p><hr/>\n<em>2013-Mar-29 11:56:04 by wenger:</em> <br/>\n\nJust a reminder, stripping off the attribute at the Condor-C level will goof up DAGMan, because it will still expect events to be written to the \"workflow log\".\n\n<p>If DAGMan can correctly recognize a job as Condor-C, it can just turn off the \"workflow log\" option at the job level in the DAG, and that would solve the problem.  My brain is still pretty spacey today -- can we do this just by looking for \"universe = grid\" in the submit file?  If so, it's a pretty easy fix just in DAGMan...\n\n</p><p></p><hr/>\n<em>2013-Mar-29 13:50:50 by jfrey:</em> <br/>\n\nThe job submitted by DAGMan would still have the DAGManNodesLog attribute and events for the job would still be written. It's only in the new job submitted by the gridmanager where DAGManNodesLog is omitted. The new job isn't being monitored by DAGMan.\n\n<p></p><hr/>\n<em>2013-Mar-29 14:23:25 by wenger:</em> <br/>\n\nOkay, that seems fine, then -- I thought the stripping off of the attribute would prevent DAGMan from seeing the events in the \"workflow log\".\n\n<p></p><hr/>\n<em>2013-Apr-02 16:03:02 by jfrey:</em> <br/>\n\nI verified that when a HTCondor-C job has dagman_log set, the DAGMan log contains entries only for the HTCondor-C job, and not the new job submitted by the c-gahp.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/685/condorc-daglog.patch\">condorc-daglog.patch</a>\n580 bytes added by jfrey on 2013-Feb-19 21:03:53 UTC.\n<br/>\nFix Condor-C jobs that have DAGManNodesLog set.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-11 13:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0fbb9ddd7fe1bcdb39ec2920aa02d36f58d95dc0\">[35378]</a></span>: better formatting of 7.9.6 version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3474\" onclick=\"get_ticket_and_populate_wrapper('3474'); return false;\" title=\"DAGMan jobs and Condor-C\">#3474</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-02 16:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4f6ce198ce5663e163885c9a2ddf3541384ad108\">[35312]</a></span>: Version history for Condor-C DAGMan log bug. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3474\" onclick=\"get_ticket_and_populate_wrapper('3474'); return false;\" title=\"DAGMan jobs and Condor-C\">#3474</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Mar-29 11:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1d0935b8d3af071cb6b3404ae6203549cca48cfd\">[35290]</a></span>: Remove DAGManNodesLog attribute from Condor-C jobs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3474\" onclick=\"get_ticket_and_populate_wrapper('3474'); return false;\" title=\"DAGMan jobs and Condor-C\">#3474</a></span> This attribute specifies a log that job events should be written to. For Condor-C, it doesn't make sense to propogate this to the remote job ad. In fact, it will cause problems.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Apr-17 14:08", "status": "resolved", "created": "2013-Feb-01 14:48", "fixed_version": "2013-Feb-01 14:48", "broken_version": "v070900", "priority": "4", "subsystem": "Dag", "assigned_to": "nwp", "derived_from": "#3275", "creator": "bbockelm", "rust": "s8256", "customer_group": "osg", "visibility": "public", "notify": "wenger@cs.wisc.edu jfrey@cs.wisc.edu bbockelm@cse.unl.edu, sfiligoi@fnal.gov", "due_date": ""}