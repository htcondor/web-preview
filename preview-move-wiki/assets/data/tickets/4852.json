{"id": 4852, "title": "Ticket #4852: Have -maxcores (or maxprocs?) limit in DAGMan", "description": "<blockquote>\nAs per discussion on today's LIGO phone call -- have a throttle in DAGMan that's like maxjobs, except that if a submit file does \"queue 10\" that counts as 10 towards the limit, not 1.\n\n<p>Hmm -- one thing I'm thinking is that we should stop submitting when we've hit the limit, not before.  (In other words, if maxcores is 100, the current count is 95, and the next submit file queues 10, we should go ahead and submit it.)  There are two reasons for this:\n</p><ol>\n<li>So we don't totally starve things (e.g., maxcores is 50 and all submit files queue 100).\n</li><li>In the above scenario, if we don't submit the \"queue 10\" job, should we go looking for ready jobs that queue &lt;= 5 procs?  That seems like a level of complication I'd like to avoid.</li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2015-Jan-27 19:37:51 by bbockelm:</em> <br/>\n\nSeems like there's a bit of a naming issue - \"cores\" seems to refer to \"CPU cores\".\n\n<p>How does \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxCores\" title=\"Max Cores\">MaxCores</a></span>\" interact with \"RequestCPUs\"?\n\n</p><p>Maybe rename current \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxClusters\" title=\"Max Clusters\">MaxClusters</a></span>\" and change \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxJobs\" title=\"Max Jobs\">MaxJobs</a></span>\" to what you propose above?\n\n</p><p></p><hr/>\n<em>2015-Jan-28 10:20:26 by wenger:</em> <br/>\n\nOr maybe this could be -MaxProcs?  I don't really like the idea of renaming existing flags...\n\n<p></p><hr/>\n<em>2015-Jun-02 13:03:30 by wenger:</em> <br/>\n\nActually, I'd kind of like to add a new flag called <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxClusters\" title=\"Max Clusters\">MaxClusters</a></span> that means the same thing as <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxJobs\" title=\"Max Jobs\">MaxJobs</a></span>.  <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxJobs\" title=\"Max Jobs\">MaxJobs</a></span> would stick around for a while (so existing DAGs work), but would be deprecated in favor of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxClusters\" title=\"Max Clusters\">MaxClusters</a></span>.  Then eventually we'd get rid of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxJobs\" title=\"Max Jobs\">MaxJobs</a></span>, and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxClusters\" title=\"Max Clusters\">MaxClusters</a></span> would be more clear as to what it means...\n\n<p></p><hr/>\n<em>2015-Dec-19 11:22:23 by wenger:</em> <br/>\n\nMaybe the new flag should be -maxprocs?\n\n<p></p><hr/>\n<em>2017-Mar-28 15:27:36 by wenger:</em> <br/>\n\nCreated V8_7-gittrac_4852-branch for this.\n\n<p></p><hr/>\n<em>2017-Mar-28 16:21:03 by wenger:</em> <br/>\n\nHmm -- I wanted to call the command-line argument -maxprocs (I don't like -maxcores).  But it turns out we already accept \"-maxpr\" for -maxprescripts, so we can't use -maxprocs.  Have to think about an alternative...</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-29 12:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50370\">[50370]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=4852\" onclick=\"get_ticket_and_populate_wrapper('4852'); return false;\" title=\"Have -maxcores (or maxprocs?) limit in DAGMan\">#4852</a></span>: Did basic implementation; still needs more implementation and test.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Mar-28 16:21", "status": "defer", "created": "2015-Jan-27 14:16", "fixed_version": "2015-Jan-27 14:16", "broken_version": "v080303", "priority": "5", "subsystem": "Dag", "assigned_to": "", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "tpdownes@gravity.phys.uwm.edu, wenger@cs.wisc.edu, zmiller@cs.wisc.edu,pcouvare@caltech.edu", "due_date": ""}