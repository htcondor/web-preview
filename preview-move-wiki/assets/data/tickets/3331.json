{"id": 3331, "title": "Ticket #3331: startd exception when matched while in drained state", "description": "<blockquote>\nA race condition can result in the startd receiving a match info message from the negotiator for a slot that is in the <code>Drained</code> state.  A slot in this state cannot be matched, so the negotiator must have been working with an older version of the slot ad from before it entered this state.\n\n<p>When this happens, the startd EXCEPTs with the following message:\n\n</p><p></p><pre>   ERROR \"match_info() called with unexpected state (Drained)\" at line 2082 in file /slots/05/dir_12000/userdir/src/condor_startd.V6/command.cpp\n</pre>\n\n<p>This problem was observed at Fermilab.</p></blockquote>", "remarks": "<blockquote>\nReview: changes look good to me.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Nov-20 11:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=34158\">[34158]</a></span>: Fixed exception in statd when receiving match info while in Drained state. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3331\" onclick=\"get_ticket_and_populate_wrapper('3331'); return false;\" title=\"startd exception when matched while in drained state\">#3331</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Dec-19 10:28", "status": "resolved", "created": "2012-Nov-20 11:43", "fixed_version": "2012-Nov-20 11:43", "broken_version": "v070705", "priority": "2", "subsystem": "", "assigned_to": "johnkn", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "bholzm@fnal.gov,dan@hep.wisc.edu", "due_date": ""}