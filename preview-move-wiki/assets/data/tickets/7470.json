{"id": 7470, "title": "Ticket #7470: HTCondor broken on AWS Fargate as setrlimit EXCEPTS w/o cap_resource", "description": "<blockquote>\nWhen HTCondor starts as root, it tries to increase the number of file descriptors that various daemons have via the MAX_FILE_DESCRIPTORS, SCHEDD_MAX_FILE_DESCRIPTORS, SHARED_PORT_MAX_FILE_DESCRIPTORS and others.  The defaults in the param table for these are 4096.  If it fails to raise the limit, it EXCEPTs.\n\n<p>However, containers started in AWS Fargate have a hard limit of 1024 fds, and do not have CAP_SYS_RESOURCE, which is needed to raise the limit, even though they have uid = 0.  Because of this, most HTCondor daemons EXCEPT on startup on Fargate.\n\n</p><p>We will fix this by making the failure to raise the limits non-fatal.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Apr-27 10:43:29 by tim:</em> <br/>\n\n<strong>CODE REVIEW:</strong> Looks good</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-27 09:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/010dc54482e45ffad452c9dcfaab7cef72ba80df\">[59504]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7470\" onclick=\"get_ticket_and_populate_wrapper('7470'); return false;\" title=\"HTCondor broken on AWS Fargate as setrlimit EXCEPTS w/o cap_resource\">#7470</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jan-09 09:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1bf847311daf63c24e49e5035e05053161631c62\">[58815]</a></span>: Make failure to setrlmit fds non-fatal <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7470\" onclick=\"get_ticket_and_populate_wrapper('7470'); return false;\" title=\"HTCondor broken on AWS Fargate as setrlimit EXCEPTS w/o cap_resource\">#7470</a></span> This allows HTCondor to run out of the box on AWS Fargate and other container based system that prohibit us from raising fd limits, and set them low.  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Apr-27 10:43", "status": "resolved", "created": "2020-Jan-09 09:06", "fixed_version": "2020-Jan-09 09:06", "broken_version": "v080800", "priority": "1", "subsystem": "", "assigned_to": "tim", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}