{"id": 899, "title": "Ticket #899: ALLOW_CONFIG=* as used by condor_config_val -rset is broken", "description": "<blockquote>\n<div class=\"verbatim\">\n<pre>config:\nENABLE_RUNTIME_CONFIG = TRUE\nALLOW_CONFIG = *\nSETTABLE_ATTRS_CONFIG = *\n\ntest:\n$ condor_config_val -neg -rset A=1\nAttempt to set configuration \"A=1\" on negotiator robin.local &lt;127.0.0.1:44380&gt; failed.\n\nNegotiatorLog:\n...\n[note: no \"allow CONFIG: */*\" log messages]\n...\n11/03 15:11:12 PERMISSION GRANTED to unauthenticated user from host 127.0.0.1 for command 60003 (DC_CONFIG_RUNTIME), access level ALLOW: reason:\n11/03 15:11:12 PERMISSION DENIED to unauthenticated user from host 127.0.0.1 for remote config A, access level CONFIG: reason: CONFIG authorization policy denies all access\n</pre></div>\n\n\n<p></p><div class=\"verbatim\">\n<pre>config:\nENABLE_RUNTIME_CONFIG = TRUE\nALLOW_CONFIG = not.a.host, *\nSETTABLE_ATTRS_CONFIG = *\n\ntest:\n$ condor_config_val -neg -rset A=1\nSuccessfully set configuration \"A=1\" on negotiator robin.local &lt;127.0.0.1:51738&gt;.\n\nNegotaitorLog:\n...\n11/03 15:11:30 allow CONFIG:  */* */not.a.host\n...\n11/03 15:11:33 Adding to resolved authorization table: */127.0.0.1: CONFIG\n11/03 15:11:33 PERMISSION GRANTED to unauthenticated user from host 127.0.0.1 for remote config A, access level CONFIG: reason: CONFIG authorization policy allows IP address 127.0.0.1; identifiers used for this remote host: 127.0.0.1,robin.local,robin,localhost.localdomain,localhost\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2009-Nov-03 17:36:09 by matt:</em> <br/>\n\nKnown workarounds:\n\n<p></p><div class=\"verbatim\">\n<pre>ALLOW_CONFIG = *.*\nALLOW_CONFIG = *, somethingthatdoesntexist\n</pre></div>\n\n\n<p></p><hr/>\n<em>2009-Nov-03 19:17:10 by danb:</em> <br/>\n\nThis same behavior appears to be true in 7.2.4.\n\n<p>I think the responsible code in condor_ipverify.cpp is here:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">        // Treat a \"*\", \"*/*\" for USERALLOW_XXX as if it's just\n        // undefined.\n</pre></div>\n\n\n<p>This code is not consistent with the fact that ALLOW_CONFIG defaults to denying all rather than allowing all.\n\n</p><p>This case does not happen to be one of the ones tested by condor_tests/lib_auth_config_tests, but it should be easy to add it.\n\n</p><p></p><hr/>\n<em>2009-Nov-03 22:36:42 by matt:</em> <br/>\n\nSecurity documentation could use some cleaning. READ/WRITE/OWNER/CONFIG/etc are referred to as Permission Levels, Security Levels or Authroization Levels depending on where in the manual you happen to be reading.\n\n<p></p><hr/>\n<em>2009-Nov-03 22:44:08 by danb:</em> <br/>\n\nAnother case that I would consider to be broken:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">DENY_CONFIG = blah\n</pre></div>\n\n\n<p>That causes everyone except for blah to be allowed, even though the default for CONFIG is supposed to be to deny all unless they are explicitly added to the allow list.\n\n</p><p></p><hr/>\n<em>2009-Nov-03 22:47:15 by matt:</em> <br/>\n\nSETTABLE_ATTRS is possibly an overly flexible set of parameters. First, it uses a deprecated SUBSYS_ instead of SUBSYS. notation. Second, it can work with any authorization level, e.g SETTABLE_ATTRS_OWNER checks for OWNER authorization while SETTABLE_ATTRS_CONFIG checks for CONFIG authorization. This flexibility allows for SETTABLE_ATTRS_OWNER=A,B,C and SETTABLE_ATTRS_CONFIG=X,Y,Z to be configured at the same time. However, what's the practical utility of being able to do this.\n\n<p>I propose a simplification, updating and making the configuration more clear.\n\n</p><p>First, the SUBSYS_ notation should be removed. SUBSYS. will work automatically.\n\n</p><p>Second, the _&lt;Authorization Level&gt; should be removed and all SETTABLE_ATTRS should always require the CONFIG level.\n\n</p><p></p><hr/>\n<em>2009-Nov-03 22:50:52 by matt:</em> <br/>\n\nIt seems SUBSYS_ has already been disabled. The manual needs to be updated.\n\n<p></p><div class=\"verbatim\">\n<pre>commit a56c825ff6ec67f5d5135bd75da6d26591853f6e\nAuthor: Peter Keller &lt;psilord@cs.wisc.edu&gt;\nDate:   Tue Jul 21 13:37:21 2009 -0500\n\n    Initial checkin (by Pete) of grand unified param feature as described in #12\n    This passes the test suites except for something which seemed to have been\n    broken when the branch was made.\n\n...\n-  if( subsys ) {\n-     param_name = subsys;\n-     param_name += \"_SETTABLE_ATTRS_\";\n-  } else {\n+/* XXX Comment this out and let subsys.SETTABLE_ATTRS_* work instead */\n+/*   if( subsys ) {*/\n+/*      param_name = subsys;*/\n+/*      param_name += \"_SETTABLE_ATTRS_\";*/\n+/*   } else {*/\n      param_name = \"SETTABLE_ATTRS_\";\n-  }\n+/*   }*/\n...\n</pre></div>\n\n\n<p></p><hr/>\n<em>2009-Nov-03 23:04:14 by danb:</em> <br/>\n\nIn addition, things can be broken when using combinations of ALLOW and HOSTALLOW where one or the other is set to * but not both.  Example:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">HOSTALLOW_WRITE = blah\nALLOW_WRITE = *\n</pre></div>\n\n\n<p>That is supposed to be equivalent to the concatenation of the two lists, but instead the * is ignored and only blah is allowed.\n\n</p><p></p><hr/>\n<em>2009-Nov-03 23:06:53 by danb:</em> <br/>\n\nI have pushed a patch to V7_4-branch that addresses all of the problems mentioned so far in this ticket except for Matt's note that docs need to be improved and his complaint about SETTABLE_ATTRS stuff.\n\n<p>The original bug appears to go back to 2002 or earlier, according to some digging that Matt did.\n\n</p><p></p><hr/>\n<em>2009-Nov-03 23:24:16 by matt:</em> <br/>\n\nI have filed 3 separate tickets for (<span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=901\" onclick=\"get_ticket_and_populate_wrapper('901'); return false;\" title=\"DOC: Authorization level documentation needs to be made consistent\">#901</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=902\" onclick=\"get_ticket_and_populate_wrapper('902'); return false;\" title=\"SUBSYS_SETTABLE_ATTRS no longer valid configuration\">#902</a></span> <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=903\" onclick=\"get_ticket_and_populate_wrapper('903'); return false;\" title=\"Remove authorization levels from SETTABLE_ATTRS\">#903</a></span>) the three issues raised in these remarks. I'll mark this ticket as resolved.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=901\" onclick=\"get_ticket_and_populate_wrapper('901'); return false;\" title=\"DOC: Authorization level documentation needs to be made consistent\">#901</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDOC: Authorization level documentation needs to be made consistent</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=902\" onclick=\"get_ticket_and_populate_wrapper('902'); return false;\" title=\"SUBSYS_SETTABLE_ATTRS no longer valid configuration\">#902</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nSUBSYS_SETTABLE_ATTRS no longer valid configuration</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=903\" onclick=\"get_ticket_and_populate_wrapper('903'); return false;\" title=\"Remove authorization levels from SETTABLE_ATTRS\">#903</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nRemove authorization levels from SETTABLE_ATTRS</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-04 10:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25089\">[25089]</a></span>: Documented fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=899\" onclick=\"get_ticket_and_populate_wrapper('899'); return false;\" title=\"ALLOW_CONFIG=* as used by condor_config_val -rset is broken\">#899</a></span>.  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-03 22:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=16223\">[16223]</a></span>: Added test of ALLOW_CONFIG=* which is broken as described in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=899\" onclick=\"get_ticket_and_populate_wrapper('899'); return false;\" title=\"ALLOW_CONFIG=* as used by condor_config_val -rset is broken\">#899</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-03 22:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=16224\">[16224]</a></span>: Fixed ALLOW_CONFIG=* problem described in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=899\" onclick=\"get_ticket_and_populate_wrapper('899'); return false;\" title=\"ALLOW_CONFIG=* as used by condor_config_val -rset is broken\">#899</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2009-Dec-23 11:38", "status": "resolved", "created": "2009-Nov-03 17:18", "fixed_version": "2009-Nov-03 17:18", "broken_version": "v070200", "priority": "1", "subsystem": "Security", "assigned_to": "danb", "derived_from": "", "creator": "matt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu dan@hep.wisc.edu zmiller@cs.wisc.edu tannenba@cs.wisc.edu psilord@cs.wisc.edu", "due_date": ""}