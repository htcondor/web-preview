{"id": 6069, "title": "Ticket #6069: DAG status file is wrong if all submit attempts fail for final node", "description": "<blockquote>\n(See the job_dagman_final-K test.)\n\n<p>All submit attempts fail for the final node, but the DAG status file has a final status of\n\n</p><p></p><pre>  DagStatus = 3; /* \"STATUS_SUBMITTED ()\" */</pre>\n</blockquote>", "remarks": "<blockquote>\n<em>2017-May-18 17:01:00 by coatsworth:</em> <br/>\n\nIt turns out this problem wasn't limited to Final nodes, it affected regular nodes also. If the last node in a DAG failed to submit, condor_dagman would exit before realizing the status file was outdated.\n\n<p>I've added a very simple fix, flagging the status file for update after submit failures. This could go in any number of places; let me know if the method I chose makes sense.\n\n</p><p>Also I figured this should go into 8.6 instead of 8.7 since it's a bug fix. Hope that sounds okay.\n\n</p><p>My code in the V8_6-gt6069-dag-status-final-fails branch.\n\n</p><p></p><hr/>\n<em>2017-May-23 12:51:26 by wenger:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>The code looks fine.\n\n</p><p>A couple of things:\n</p><ul>\n<li>There should be a version history item documenting that the bug got fixed.\n</li><li>You should fix the job_dagman_final-K test (just change it to look for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DagStatus\" title=\"Dag Status\">DagStatus</a></span> = 6), uncomment it in CMakeLists.txt, and run a build/test on all platforms.\n</li></ul>\n\n<p></p><hr/>\n<em>2017-May-23 12:55:03 by wenger:</em> <br/>\n\nOh, yeah -- note that I changed \"fixed version\" to v080604, so this should get merged into the 8.6 branch, and, obviously, the version history entry should go into 8.6.\n\n<p></p><hr/>\n<em>2017-Jun-13 15:44:55 by coatsworth:</em> <br/>\n\nI've added the test, and updated the documentation as requested by Kent. Ran a build and test on batlab, everything seems to work fine.\n\n<p>My RHEL 7 system can't test making the documentation due to some compatibility errors, however I tried running a `make local.html` on a batlab submit machine and it went fine. So I think we're good here.\n\n</p><p></p><hr/>\n<em>2017-Jun-13 16:39:09 by tim:</em> <br/>\n\n<strong>CODE REVIEW:</strong> Looks safe and effective.\n\n<p></p><hr/>\n<em>2017-Jun-13 16:41:00 by tim:</em> <br/>\n\n<strong>DOC REVIEW:</strong> complete</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-13 13:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51710\">[51710]</a></span>: Added bug fix to docs (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6069\" onclick=\"get_ticket_and_populate_wrapper('6069'); return false;\" title=\"DAG status file is wrong if all submit attempts fail for final node\">#6069</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-13 11:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51707\">[51707]</a></span>: Added error code fix + tests (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6069\" onclick=\"get_ticket_and_populate_wrapper('6069'); return false;\" title=\"DAG status file is wrong if all submit attempts fail for final node\">#6069</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-12 18:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51705\">[51705]</a></span>: Added test (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6069\" onclick=\"get_ticket_and_populate_wrapper('6069'); return false;\" title=\"DAG status file is wrong if all submit attempts fail for final node\">#6069</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-18 16:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50683\">[50683]</a></span>: Added flag to update status file after submit failures (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6069\" onclick=\"get_ticket_and_populate_wrapper('6069'); return false;\" title=\"DAG status file is wrong if all submit attempts fail for final node\">#6069</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Jun-13 16:41", "status": "resolved", "created": "2016-Dec-22 12:29", "fixed_version": "2016-Dec-22 12:29", "broken_version": "v080410", "priority": "2", "subsystem": "Dag", "assigned_to": "coatsworth", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, coatsworth@cs.wisc.edu", "due_date": ""}