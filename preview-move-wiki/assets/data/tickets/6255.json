{"id": 6255, "title": "Ticket #6255: Update systemd configuration to start Condor after time sync", "description": "<blockquote>\nWe noticed that condormaster would restart on CentOS 7 when it\ndetected a time change at boot (log below). (This is a problem b/c it\ncauses a high rate of failure for job reconnects.)\n\n<p>We were able to delay condor's start until after the system clock was\nupdated by adding a dependency of 'time-sync.target' in condor's systemd\nservice file.\n\n</p><p>After=syslog.target network-online.target nslcd.service ypbind.service\ntime-sync.target\n\n</p><p></p><div class=\"verbatim\">\n<pre>05/03/17 04:44:20 Master restart (PEACEFUL) is watching /usr/sbin/condor_master (mtime:1485281319)\n05/03/17 04:44:20 Started DaemonCore process \"/usr/sbin/condor_schedd\", pid and pgroup = 2406\n05/03/17 09:44:45 The system clocked jumped 17965 seconds unexpectedly. Restarting all daemons\n05/03/17 09:44:45 Sent SIGTERM to SCHEDD (pid 2406)\n05/03/17 09:44:45 Preen pid is 5523\n05/03/17 09:44:48 AllReaper unexpectedly called on pid 2406, status 0.\n05/03/17 09:44:48 The SCHEDD (pid 2406) exited with status 0\n05/03/17 09:44:48 All daemons are gone.  Restarting.\n05/03/17 09:44:48 Restarting master right away.\n05/03/17 09:44:48 Doing exec( \"/usr/sbin/condor_master\" )\n05/03/17 09:44:48 ******************************************************\n05/03/17 09:44:48 ** condor_master (CONDOR_MASTER) STARTING UP\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2017-Jun-13 11:55:54 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Change looks good.\n\n</p><p></p><hr/>\n<em>2017-Jun-19 17:15:40 by tim:</em> <br/>\n\n<strong>DOC REVIEW:</strong> OK</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-19 17:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5a58f3355115cfa008d25d9b6a5b31f03821e3b4\">[51738]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6255\" onclick=\"get_ticket_and_populate_wrapper('6255'); return false;\" title=\"Update systemd configuration to start Condor after time sync\">#6255</a></span> and other minor edits  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-22 15:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/51a83683d719590b82a784e1778b4353a4a59b82\">[50700]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6255\" onclick=\"get_ticket_and_populate_wrapper('6255'); return false;\" title=\"Update systemd configuration to start Condor after time sync\">#6255</a></span>) Systemd: Start up after time-sync. Prevents spurious master restarts.  (By Tim Theisen )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Jun-19 17:15", "status": "resolved", "created": "2017-May-10 16:57", "fixed_version": "2017-May-10 16:57", "broken_version": "", "priority": "3", "subsystem": "Packaging", "assigned_to": "tim", "derived_from": "", "creator": "tim", "rust": "a31689", "customer_group": "other", "visibility": "public", "notify": "cwseys@physics.wisc.edu", "due_date": ""}