{"id": 4607, "title": "Ticket #4607: Always update node status file", "description": "<blockquote>\nRight now, we have some code in dag.cpp (see Dag::DumpNodeStatus) that prints out:\n\n<p>\"Node status file not updated because it is not yet outdated\"\n\n</p><p>then skips the printing out the node file.  <strong>However</strong>, there's a very important thing we miss by not writing out the update -- the last updated timestamp.  Since querying the status of the DAGMan job in the condor_q is quite unreliable (schedds at scale... sigh), we'd be able to skip the query if DAGMan never skipped the node status file.  We would look at the timestamp and, if it's more than N minutes old, then query the schedd for the DAGMan job status.\n\n</p><p>Why not trust that DAGMan always writes out the node status file?\n</p><ol>\n<li>This assumes there are no future bugs in DAGMan in the hold / remove path.\n</li><li>This assumes that no sneaky admin did a \"kill -9\" on condor_dagman.\n</li><li>Belt and suspenders!  It's the HTCondor way.  More seriously - we need something that emulates a job lease in a distributed system like this.\n</li></ol>\n\n<p>It would be perfectly acceptable for this behavior to be a HTCondor config parameter.</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Sep-25 10:39:36 by wenger:</em> <br/>\n\nActually, now that I think about it, I'd rather add it to the node status\nfile specification in the DAG file, as opposed to making it a new config\nparam.  So it would be something like this:\n\n<p></p><pre>  NODE_STATUS_FILE statusFileName [minimumUpdateTime] [ALWAYS_UPDATE]</pre>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-11 15:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/464f259135ecbf186ad2efad4f1185cf6c5593be\">[41627]</a></span>: minor edit of new DAGMan ALWAYS-UPDATE feature in version 8.3.2 <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4607\" onclick=\"get_ticket_and_populate_wrapper('4607'); return false;\" title=\"Always update node status file\">#4607</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Sep-25 16:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3e10f70becc8c499f9b40e75b05e0bba4e37262e\">[41248]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4607\" onclick=\"get_ticket_and_populate_wrapper('4607'); return false;\" title=\"Always update node status file\">#4607</a></span>: Added ALWAYS-UPDATE functionality to the DAGMan node status file; added version history item and updated the DAGMan manual chapter. Also added ALWAYS-UPDATE to the job_dagman_node_status test, although the test doesn't actually check that we update the file every time.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Sep-25 16:52", "status": "resolved", "created": "2014-Sep-24 10:01", "fixed_version": "2014-Sep-24 10:01", "broken_version": "v080300", "priority": "1", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "#4490", "creator": "bbockelm", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "bbockelm@cse.unl.edu", "due_date": ""}