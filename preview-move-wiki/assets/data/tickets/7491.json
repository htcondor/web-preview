{"id": 7491, "title": "Ticket #7491: Interactive negotiator in CHTC slower than expected", "description": "<blockquote>\nIn CHTC, we wanted interactive and build jobs to start executing quickly. We have a set of execute machines dedicated to these jobs, but the normal negotiation process was taking much longer than desired (multiple minutes instead of ~5 seconds). To improve this, we tried adding a second, \"interactive\", negotiator that only matches interactive/build jobs to their dedicate slots.\n\n<p>Details can be read in RT #99072.\n\n</p><p><span class=\"subsection\"></span></p><h3>Issues </h3>\nWith the new negotiator, it still took over a minute for interactive jobs to start executing. Investigation revealed several problems:\n\n<p></p><ul>\n<li>The Spalding lab's schedd was firewalled, causing repeated 30-second failed attempts to connect. This affected both negotiators.\n\n<p></p></li><li>The interactive negotiator often didn't receive a RESCHEDULE command when new jobs were submitted. Thus, it often waited the standard 60 seconds between negotiation cycles. This is due to code in the schedd that sends the RESCHEDULE to one negotiator, not expecting that there could be multiple negotiators.\n</li></ul>\n\n<p><span class=\"subsection\"></span></p><h3>Improvements </h3>\n\n<p>The following changes in configuration and code may be considered to improve the performance of the interactive negotiator.\n\n</p><p></p><ul>\n<li>Ban the Spalding submit machine until firewall issues can be resolved. <strong>DONE</strong>\n\n<p></p></li><li>Configure a separate collector for the interactive negotiator and have only CHTC schedds flock to it. <strong>IN PROGRESS</strong>\n\n<p></p></li><li>Add new option in the negotiator to constrain the submitter ads it fetches. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7490\" onclick=\"get_ticket_and_populate_wrapper('7490'); return false;\" title=\"Allow negotiator to filter submitter ads\">#7490</a></span>\n\n<p></p></li><li>Once <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7490\" onclick=\"get_ticket_and_populate_wrapper('7490'); return false;\" title=\"Allow negotiator to filter submitter ads\">#7490</a></span> is deployed, have interactive negotiator only pull submitter ads from CHTC schedds. Maybe implement way for submitter ads to indicate that they have interactive jobs, for further filtering.\n\n<p></p></li><li>Change NEGOTIATOR_CYCLE_DELAY  and possibly NEGOTIATOR_INTERVAL to 5 seconds.\n\n<p></p></li><li>Change negotiator to do non-blocking connections to schedds during the prefetch phase.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "incident", "last_change": "2020-Feb-05 16:26", "status": "new", "created": "2020-Feb-05 16:26", "fixed_version": "2020-Feb-05 16:26", "broken_version": "", "priority": "4", "subsystem": "", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "", "due_date": ""}