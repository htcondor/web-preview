{"id": 3280, "title": "Ticket #3280: glexec jobs go on hold after x509 update", "description": "<blockquote>\nWhen the shadow delegates an updated x509 proxy to the execute side, the job goes on hold soon after with the hold reason, \"Proxy about to expire\", even though the updated proxy is not about to expire and nor was the old proxy that was replaced.\n\n<p>One workaround is to use long-duration proxies and (if using DELEGATE_JOB_GSI_CREDENTIALS=True) to disable the shadow's shortening of the lifetime of the proxies it delegates:\n\n</p><p>DELEGATE_JOB_GSI_CREDENTIALS_LIFETIME = 0\n\n</p><p>I believe the cause of this problem is the following line in the starter:\n\n</p><p></p><pre>        time_t expiration = x509_proxy_expiration_time(path.Value());\n</pre>\n\n<p>The path that the starter is passing into the function x509_proxy_expiration_time() is the value of X509UserProxy in the job ad.  That is probably not the correct path on the execute node.  Nothing is logged to tell us if there is an error reading the proxy, because there is no error checking to see if the call to x509_proxy_expiration_time() failed.  The -1 in the following message gives us a hint that it is indeed failing to read the proxy:\n\n</p><p></p><pre>    Attempt to refresh X509 proxy succeeded.\n    Set timer 12 for PROXY_EXPIRING to -1</pre>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Oct-18 17:16:47 by zmiller:</em> <br/>\n\nchanges look good, but now i am wondering if this code gets called when the proxy is transferred initially (not just when it's updated after the job starts).  if so, how did this work before?  if you run a \"sleep 600\" job with a 5 minute proxy, does the timer correctly fire?\n\n<p></p><hr/>\n<em>2012-Oct-18 17:32:02 by danb:</em> <br/>\n\nI confirm that if the proxy is never refreshed, it appears that the timer is never set.  The proxy expires and no action is taken by the starter to put the job on hold.\n\n<p></p><hr/>\n<em>2012-Oct-19 14:58:01 by danb:</em> <br/>\n\nI have created a new ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3283\" onclick=\"get_ticket_and_populate_wrapper('3283'); return false;\" title=\"glexec job not put on hold when proxy expires\">#3283</a></span> to track the separate problem of the initial proxy expiring.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Dec-05 16:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/116fb986517f97c733a6d2204117046726475bcb\">[34294]</a></span>: minor edit of version history item. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3280\" onclick=\"get_ticket_and_populate_wrapper('3280'); return false;\" title=\"glexec jobs go on hold after x509 update\">#3280</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Dec-05 15:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c28e1c0982c28b4b290c7b35b1873d5177d28ba8\">[34285]</a></span>: minor edit of version history item. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3280\" onclick=\"get_ticket_and_populate_wrapper('3280'); return false;\" title=\"glexec jobs go on hold after x509 update\">#3280</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Oct-18 17:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dfab53bc6ac410e0d9da97829828a000a7af6f42\">[33701]</a></span>: Fixed incorrect handling of refreshed proxies when using glexec. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3280\" onclick=\"get_ticket_and_populate_wrapper('3280'); return false;\" title=\"glexec jobs go on hold after x509 update\">#3280</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Oct-29 13:34", "status": "resolved", "created": "2012-Oct-18 14:55", "fixed_version": "2012-Oct-18 14:55", "broken_version": "v070800", "priority": "2", "subsystem": "", "assigned_to": "danb", "derived_from": "#235", "creator": "danb", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "isfiligoi@ucsd.edu,dan@hep.wisc.edu,zmiller@cs.wisc.edu", "due_date": ""}