{"id": 6880, "title": "Ticket #6880: Python bindings don't build with python 3", "description": "<blockquote>\nThe Boost 1.66 python bindings don't build with the python 3.7 that's commonly available on linux distros. This can be fixed with some small patches to Boost. There are two problems here, which both must be addressed.\n\n<p>First, the signature of _PyUnicode_AsString() changed in python 3.7, and a use in Boost needs to add a cast. This is a back-port of a fix in later versions of Boost.\n\n</p><p>Second, the python 3 include directory in rhel and fedora includes an 'm' suffix (i.e. <code>/usr/include/python-3.7m</code>). This indicates that python was built with the pymalloc custom allocator. The Boost python module thinks the directory doesn't have an 'm', and fails to build. This is a long-standing bug that others have hacked around by telling boost where the directory is.\n\n</p><p>Multiple issue tickets about python include directory name bug in boost:\n</p><ul>\n<li><a class=\"external\" href=\"https://svn.boost.org/trac10/ticket/6826\">https://svn.boost.org/trac10/ticket/6826</a>\n</li><li><a class=\"external\" href=\"https://svn.boost.org/trac10/ticket/11120\">https://svn.boost.org/trac10/ticket/11120</a>\n</li><li><a class=\"external\" href=\"https://github.com/boostorg/build/pull/250\">https://github.com/boostorg/build/pull/250</a>\n</li><li><a class=\"external\" href=\"https://github.com/boostorg/python/issues/187\">https://github.com/boostorg/python/issues/187</a></li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2019-Jan-29 16:25:50 by jpatton:</em> <br/>\n\n<strong>CODE REVIEW</strong>: The code changes look good to me, and I was able to compile a htcondor python bindings wheel package with Python 3.7 without doing anything weird with the <code>${PYTHON_ROOT}/include/python3.7m</code> directory. Initial tests with installing the wheel package in my and karpel's Python 3.7 environments look good as well.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-29 12:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56090\">[56090]</a></span>: Handle Boost bug on Python include directory names. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6880\" onclick=\"get_ticket_and_populate_wrapper('6880'); return false;\" title=\"Python bindings don't build with python 3\">#6880</a></span> Python include directory names can have an 'm' and/or 'u' suffix, reflecting how the libraries were built. Boost's automatic detection of the include directory doesn't handle this properly, so we need to tell it what the correct value is.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-29 12:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56089\">[56089]</a></span>: Patch Boost 1.66 to build with Python 3.7. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6880\" onclick=\"get_ticket_and_populate_wrapper('6880'); return false;\" title=\"Python bindings don't build with python 3\">#6880</a></span> This is a back-port of a change in later versions of Boost, necessitated by a change in a Python API function.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Mar-25 14:36", "status": "resolved", "created": "2019-Jan-24 14:50", "fixed_version": "2019-Jan-24 14:50", "broken_version": "", "priority": "3", "subsystem": "PythonBinding", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "karpel@wisc.edu,jpatton@cs.wisc.edu", "due_date": ""}