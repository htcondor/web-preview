{"id": 2892, "title": "Ticket #2892: Shadow, spool_version file approach don't work with multi-schedd setup", "description": "<blockquote>\nI've run in to an issue with the condor_shadow, spool_version file and a multi-schedd setup.\n\n<p>My shadows are failing to run with the error:\n\n</p><p></p><pre>\t03/15/12 11:00:55 ERROR \"According to /mnt/condor_data/spool/spool_version, the SPOOL directory is written in spool version 0, but I only support versions back to 1.\n\t\" at line 67 in file /home/condor/execute/dir_2782/userdir/src/condor_utils/spool_version.cpp\n</pre>\n\n<p>The condor_config file is vanilla from 7.6.6 save for RELEASE_DIR and LOCAL_DIR being set to my specific locations. The condor_config.local file looks as such:\n\n</p><p></p><pre>\tDAEMON_LIST = MASTER\n\tMASTER.USE_PROCD = True\n</pre>\n\n<p></p><pre>\tSHADOW_LOG = $(LOG)/ShadowLog.$(PID)\n</pre>\n\n<p></p><pre>\t# Define the first SCHEDD on this machine\n\tSCHEDD1 = $(SCHEDD)\n\tSCHEDD1_ARGS = -f -local-name Q1\n\tSCHEDD1_LOG = $(LOG)/ScheddLog.1\n\tSCHEDD1_SPOOL = $(SPOOL)/1\n\tSCHEDD.Q1.SCHEDD_NAME = Q1@$(HOSTNAME)\n\tSCHEDD.Q1.SPOOL = $(SCHEDD1_SPOOL)\n\tSCHEDD.Q1.SCHEDD_LOG = $(SCHEDD1_LOG)\n\tSCHEDD.Q1.SCHEDD_ADDRESS_FILE = $(SCHEDD1_SPOOL)/.schedd_address\n\tSCHEDD.Q1.SCHEDD_DAEMON_AD_FILE = $(SCHEDD1_SPOOL)/.schedd_classad\n\tSCHEDD.Q1.HISTORY = $(SCHEDD1_SPOOL)/history\n</pre>\n\n<p></p><pre>\tDAEMON_LIST = $(DAEMON_LIST), SCHEDD1\n\tVALID_SPOOL_FILES = $(VALID_SPOOL_FILES), 1\n</pre>\n\n<p></p><pre>\t# Make the q1@&lt;hostname&gt; schedd the default if the user doesn't use a -name option\n\tSCHEDD_HOST = Q1@$(HOSTNAME)\n</pre>\n\n<p></p><pre>\t# Define the second SCHEDD on this machine\n\tSCHEDD2 = $(SCHEDD)\n\tSCHEDD2_ARGS = -f -local-name Q2\n\tSCHEDD2_LOG = $(LOG)/ScheddLog.2\n\tSCHEDD2_SPOOL = $(SPOOL)/2\n\tSCHEDD.Q2.SCHEDD_NAME = Q2@$(HOSTNAME)\n\tSCHEDD.Q2.SPOOL = $(SCHEDD2_SPOOL)\n\tSCHEDD.Q2.SCHEDD_LOG = $(SCHEDD2_LOG)\n\tSCHEDD.Q2.SCHEDD_ADDRESS_FILE = $(SCHEDD2_SPOOL)/.schedd_address\n\tSCHEDD.Q2.SCHEDD_DAEMON_AD_FILE = $(SCHEDD2_SPOOL)/.schedd_classad\n\tSCHEDD.Q2.HISTORY = $(SCHEDD2_SPOOL)/history\n</pre>\n\n<p></p><pre>\tDAEMON_LIST = $(DAEMON_LIST), SCHEDD2\n\tVALID_SPOOL_FILES = $(VALID_SPOOL_FILES), 2\n</pre>\n\n<p>My LOCAL_DIR layout is:\n\n</p><p></p><pre>\tspool/\n\t\t1/\n\t\t\t.schedd_address\n\t\t\t.schedd_classad\n\t\t\tjob_queue.log\n\t\t\tlocal_univ_execute\n\t\t\tspool_version\n\t\t2/\n\t\t\t.schedd_address\n\t\t\t.schedd_classad\n\t\t\tjob_queue.log\n\t\t\tlocal_univ_execute\n\t\t\tspool_version\n\tlog/\n\tlock/\n\tconfig/\n\tcondor_config.local\n</pre>\n\n<p>If I copy one of those spool_version files to the $(LOCAL_DIR)/spool directory everything works as expected.\n\n</p><p>Why isn't the SPOOL setting from the multi-schedd propagated to the condor_shadow daemons on startup? They seem to be taking their settings directly from the condor_config/condor_config.local files instead of inheriting the environment the condor_schedd that spawned them. Does the schedd not rewrite the SCHEDD.&lt;name&gt;.SPOOL setting to SPOOL in the environment of sub-processes so they see that specific scheduler's settings at not the (wrong) global settings?\n\n</p><p>Is there a way to make this happen using the named config syntax?</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "todo", "last_change": "2012-Mar-15 11:41", "status": "new", "created": "2012-Mar-15 11:41", "fixed_version": "2012-Mar-15 11:41", "broken_version": "v070606", "priority": "2", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "", "creator": "ichesal", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}