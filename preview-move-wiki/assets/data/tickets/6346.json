{"id": 6346, "title": "Ticket #6346: condor_store_cred won't accept registration of dedicated user cred.", "description": "<blockquote>\n<span class=\"subsection\"><h3>Problem description</h3></span>\n\n<p>I'm using a setup of HTCondor on Windows which executes jobs using a dedicated user account (SLOT_USER). I can't use the standard \"transient\" accounts as the user account used for the jobs needs special privileges which I configured for the dedicated account.\n\n</p><p>I used to register the dedicated account credentials on execution machines using condor_store_cred. This worked fine in Condor version 8.4.x and earlier.\n\n</p><p>When switching from HTCondor version 8.4.7 to 8.6.4 the setup stopped working though and the condor_store_cred failed to store the credentials of the dedicated account and printed its standard error message:\n\n</p><p>\"Operation failed. Make sure your ALLOW_WRITE setting includes this host.\"\n\n</p><p>Digging through the source I found a part which was introduced in the 8.6 series as it seems:\n\n</p><p>condor-8.6.4/src/condor_utils/store_cred.cpp (line 725):\n// We don't allow one user to set another user's credential\n\n</p><p>The code part which follows leads to the failure. As this breaks the existing feature of having a dedicated user account on Windows to run the jobs I think that this should be considered as a bug. One may argue that the setup still works and one has to log in using the dedicated account but this makes the setup really cumbersome.\n\n</p><p><span class=\"subsection\"></span></p><h3>Proposed fix</h3>\n\n<p>To address the above, we can add a configuration knob that would allow the admin to say who, if anyone, is allowed to run condor_store_cred for other users.  So after this change, to get the behavior you used to have in v8.4, you would put into your condor_config something like:\n\n</p><p></p><pre>    CRED_SUPER_USERS = *\n</pre>\n\n<p>Or to only allow specific users -\n\n</p><p></p><pre>    CRED_SUPER_USERS = mike, todd</pre>\n</blockquote>", "remarks": "<blockquote>\n<em>2017-Jul-14 10:14:22 by tim:</em> <br/>\n\nThis behavior changed in 8.5.8 with changes for ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5984\" onclick=\"get_ticket_and_populate_wrapper('5984'); return false;\" title=\"Don't allow one user to store credentials for another user\">#5984</a></span>\n\n<p></p><hr/>\n<em>2018-Dec-19 11:26:10 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong> : change looks good.  although I think the comparison should always be case-insensitive because a pool may be mixed windows/Linux but you will only have 1 credd.\n\n<p></p><hr/>\n<em>2018-Dec-20 10:27:58 by jfrey:</em> <br/>\n\nTJ and I discussed the case sensitive comparison and decided any changes can wait, and should probably include other places in the code with similar concerns.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7624\" onclick=\"get_ticket_and_populate_wrapper('7624'); return false;\" title=\"clean up client to CredD interface for user impersonation\">#7624</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nclean up client to CredD interface for user impersonation</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-20 10:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55901\">[55901]</a></span>: Docs for new CRED_SUPER_USERS param. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6346\" onclick=\"get_ticket_and_populate_wrapper('6346'); return false;\" title=\"condor_store_cred won't accept registration of dedicated user cred.\">#6346</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-11 11:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55884\">[55884]</a></span>: Allow some users to do store_cred for other accounts. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6346\" onclick=\"get_ticket_and_populate_wrapper('6346'); return false;\" title=\"condor_store_cred won't accept registration of dedicated user cred.\">#6346</a></span> Reintroduce config param CRED_SUPER_USERS from the old credd. It is a list of users who are allowed to store credentials for any user. Wildcards are recognized. User domain is not considered, so it should not be included in entries of this list.\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2018-Dec-20 10:28", "status": "resolved", "created": "2017-Jul-14 03:35", "fixed_version": "2017-Jul-14 03:35", "broken_version": "v080508", "priority": "1", "subsystem": "DaemonsExecNode", "assigned_to": "jfrey", "derived_from": "", "creator": "f.wolfheimer", "rust": "s94740", "customer_group": "support", "visibility": "public", "notify": "f.wolfheimer@googlemail.com, tannenba@cs.wisc.edu", "due_date": ""}