{"id": 3927, "title": "Ticket #3927: how do I know if my collector is unable to keep up with incoming ads?", "description": "<blockquote>\nThis issue should ultimately be resolved via a documentation update either in the manual or the wiki.\n\n<p>The question is: what exactly can/should I monitor in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CollectorLog\" title=\"Collector Log\">CollectorLog</a></span> or collector ad to tell me if the collector is dropping updates, how many it's dropping, and at what rate?\n\n</p><p>The reason I need to know is that I'm trying to ratchet down my CLASSAD_LIFETIME in order to deal with a very large pool of opportunistic resources that regularly come and go without warning (<span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3926\" onclick=\"get_ticket_and_populate_wrapper('3926'); return false;\" title=\"how can I set CLASSAD_LIFETIME=121 and not miss any ads?\">#3926</a></span>).  But I don't know how far I can ratchet down CLASSAD_LIFETIME and *_UPDATE_INTERVAL before the collector is unable to keep up and starts to drop incoming ads, because I don't know how to monitor that.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Jan-12 10:09:25 by smoler:</em> <br/>\n\nTo monitor this information, use\n\n<p></p><pre>   condor_status -l &lt;machine name&gt;  | condor_updates_stats --interval=300\n</pre>\n\n<p>This will list state changes of received versus missed updates to the collector.\n\n</p><p></p><hr/>\n<em>2015-Jan-12 13:23:49 by pfc:</em> <br/>\n\nBelow is the output from the first machine I chose at random to examine.  Is there any obvious reason why slot1 could be seeing two orders of magnitude more dropped updates than any other slot?\n\n<p></p><div class=\"verbatim\">\n<pre>-bash-4.1# condor_status -l spice002  | condor_updates_stats --interval=300\n*** Name/Machine = 'slot1@spice002.sugar.phy.syr.edu' MyType = 'Machine' ***\n Type: Main\n   Stats: Total=24688, Seq=24690, Lost=587 (2.38%)\n     0 @ Mon Jan 12 14:17:46 2015: Ok\n  ...\n    98 @ Mon Jan 12 06:07:46 2015: Missed\n    99 @ Mon Jan 12 06:02:46 2015: Ok\n  ...\n   127 @ Mon Jan 12 03:42:46 2015: Ok\n\n*** Name/Machine = 'slot2@spice002.sugar.phy.syr.edu' MyType = 'Machine' ***\n Type: Main\n   Stats: Total=24133, Seq=24132, Lost=14 (0.06%)\n     0 @ Mon Jan 12 14:17:47 2015: Ok\n  ...\n   127 @ Mon Jan 12 03:42:47 2015: Ok\n\n*** Name/Machine = 'slot3@spice002.sugar.phy.syr.edu' MyType = 'Machine' ***\n Type: Main\n   Stats: Total=24148, Seq=24147, Lost=12 (0.05%)\n     0 @ Mon Jan 12 14:17:48 2015: Ok\n  ...\n   127 @ Mon Jan 12 03:42:48 2015: Ok\n\n*** Name/Machine = 'slot4@spice002.sugar.phy.syr.edu' MyType = 'Machine' ***\n Type: Main\n   Stats: Total=26394, Seq=26393, Lost=31 (0.12%)\n     0 @ Mon Jan 12 14:17:49 2015: Ok\n  ...\n   127 @ Mon Jan 12 03:42:49 2015: Ok\n\n*** Name/Machine = 'slot5@spice002.sugar.phy.syr.edu' MyType = 'Machine' ***\n Type: Main\n   Stats: Total=29088, Seq=29087, Lost=20 (0.07%)\n     0 @ Mon Jan 12 14:17:50 2015: Ok\n  ...\n   127 @ Mon Jan 12 03:42:50 2015: Ok\n</pre></div>\n\n\n<p></p><hr/>\n<em>2015-Jan-12 14:29:47 by gthain:</em> <br/>\n\nIs this with UDP or TCP updates?  I'm beginning to think that we should always up date with TCP.\n\n<p></p><hr/>\n<em>2015-Jan-12 14:33:37 by pfc:</em> <br/>\n\nCurrently, UPDATE_COLLECTOR_WITH_TCP = False\n\n<p>Should I anticipate enabling TCP updates on a pool with ~10k nodes?\n\n</p><p></p><hr/>\n<em>2015-Jan-12 14:34:40 by pfc:</em> <br/>\n\nAnd to circle back to my original question, how can I tell if my collector is unable to keep up with the rate of updates (with TCP <strong>or</strong> UDP), and differentiate that from dropped packets that have nothing to do with the collector itself?\n\n<p></p><hr/>\n<em>2015-Jan-12 15:24:55 by gthain:</em> <br/>\n\nI'd run condor_status -collector -l\n\n<p>and look for the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCoreDutyCycle\" title=\"Daemon Core Duty Cycle\">DaemonCoreDutyCycle</a></span> parameter.  This measures the percent of time servicing command handler, timers, signals and pipes, and not otherwise idle.\n\n</p><p></p><hr/>\n<em>2015-Jan-12 16:12:36 by bbockelm:</em> <br/>\n\nGreg - that one can be a bit misleading as UDP may drop packets even with lower duty cycle (simply depending on update rates and socket buffer size).\n\n<p>PFC - personally, I go with TCP updates.  In such case, I find it easier to debug load issues.  In the case of TCP updates, Greg's advice is bulletproof.\n\n</p><p></p><hr/>\n<em>2015-Sep-22 15:30:49 by gthain:</em> <br/>\n\nSee also <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5170\" onclick=\"get_ticket_and_populate_wrapper('5170'); return false;\" title=\"condor_reconfig zeros update SequenceNumber, looks like dropped update\">#5170</a></span>: condor_reconfig zeros update <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SequenceNumber\" title=\"Sequence Number\">SequenceNumber</a></span>, looks like dropped update which may have been exacerbating this problem.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-16 10:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e8faa236fb8791c5b8e18a5474234c77c661a1dc\">[42255]</a></span>: Add NEGOTIATOR_UPDATE_INTERVAL to param table <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3927\" onclick=\"get_ticket_and_populate_wrapper('3927'); return false;\" title=\"how do I know if my collector is unable to keep up with incoming ads?\">#3927</a></span> param has been in the code forever, just needed param table entry  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "doc", "last_change": "2015-Sep-22 15:30", "status": "defer", "created": "2013-Sep-17 15:41", "fixed_version": "2013-Sep-17 15:41", "broken_version": "v080002", "priority": "5", "subsystem": "DaemonsCM", "assigned_to": "gthain", "derived_from": "", "creator": "pfc", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pfcouvar@syr.edu,pcouvare@caltech.edu", "due_date": ""}