{"id": 7414, "title": "Ticket #7414: Use callbacks to implement curl_plugin timeout", "description": "<blockquote>\nIn <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7316\" onclick=\"get_ticket_and_populate_wrapper('7316'); return false;\" title=\"Poor performance from curl_plugin\">#7316</a></span> we addressed a performance bug in the <code>curl_plugin</code> by adding a version check for the libcurl library.\n\n<p>A better way to work around this bug (for all versions of libcurl) would be to use callbacks to abort a transfer if it's taking too long. I don't know exactly what the implementation looks like right now, so I'll do some homework and will update this ticket with details shortly.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Jan-02 17:35:22 by coatsworth:</em> <br/>\n\nHi Brian, I've written some code that users SIGALRM and callbacks to track progress of a file transfer. The good news is that it's straightforward and easy to identify when a transfer is not making progress. The bad news is that it's difficult to actually abort the transfer, put an error message in the output and then exit the process with a non-zero code.\n\n<p>I've looked around online for other approaches. The best suggestion I've been is to use the libcurl <code>CURLOPT_PROGRESSFUNCTION</code> callback, which is called at regular time intervals (whether or not progress is actually being made) with information about current progress. We can implement our timeout logic in the callback function, and if the transfer isn't moving forward, just return a non-zero code and libcurl will abort the transfer. There's more information here:\n\n</p><p><a class=\"external\" href=\"https://curl.haxx.se/libcurl/c/CURLOPT_PROGRESSFUNCTION.html\">https://curl.haxx.se/libcurl/c/CURLOPT_PROGRESSFUNCTION.html</a>\n\n</p><p>Let me know if you think this makes sense, or you have other ideas.\n</p><hr/>\n<em>2020-Apr-10 07:46:37 by tim:</em> <br/>\n\nBulk change of target version from v080906 to v080907 using ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-16 14:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59371\">[59371]</a></span>: Added version history (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7414\" onclick=\"get_ticket_and_populate_wrapper('7414'); return false;\" title=\"Use callbacks to implement curl_plugin timeout\">#7414</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jan-10 16:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58831\">[58831]</a></span>: Implemented callback-based timeouts in curl_plugin (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7414\" onclick=\"get_ticket_and_populate_wrapper('7414'); return false;\" title=\"Use callbacks to implement curl_plugin timeout\">#7414</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Apr-16 14:37", "status": "resolved", "created": "2019-Dec-05 11:01", "fixed_version": "2019-Dec-05 11:01", "broken_version": "v080904", "priority": "3", "subsystem": "FileTransfer", "assigned_to": "coatsworth", "derived_from": "#7316", "creator": "coatsworth", "rust": "", "customer_group": "other", "visibility": "public", "notify": "coatsworth@cs.wisc.edu, bbockelman@morgridge.org", "due_date": ""}