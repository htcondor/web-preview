{"id": 2449, "title": "Ticket #2449: Identify the \"home pool\" for flocked scheduler and submitter ads", "description": "<blockquote>\nI've hit an interesting problem with flocked jobs, where one pool is set to flock to another, in that: unless I have prior knowledge of how the pools are setup (which schedulers were in which pool <em>before</em> any flocking occured) I can't tell where a scheduler is located based on the scheduler or submitter ads querying a pool.\n\n<p>I have a contrived example here of two pools: mbprolinux and imaclinux. Each pool has on scheduler and a startd advertising exactly one slot. The mbprolinux is set to flock jobs to the imaclinux pool.\n\n</p><p>If I submit 2 very long sleep jobs to the mbprolinux linux pool, wait until the jobs are running, and then query the pools for scheduler and submitter information, I can't tell which pool the scheduler and submitter belong to because the data is essentially duplicated in both pool's collectors. There's no \"home pool\" attribute on the ads that would indicate when a scheduler or submitter ad isn't coming from a schedd that's \"native\" to that pool. Or conversely: there's no \"is a flocked scheduler/submitter\" ad to indicate it's from away.\n\n</p><p>I've attached the classad output for a few scenarios to highlight my problem:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">condor_status -schedd -l -pool imaclinux mbprolinux &gt; imaclinux-mbprolinux-schedd.txt\ncondor_status -schedd -l pool mbprolinux mbprolinux &gt; mbprolinux-mbprolinux-schedd.txt\n</pre></div>\n\n\n<p>Diff those two files above to see that they're essentially indistinguishable. The diff is:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">16c16\n&lt; UpdatesTotal = 12\n---\n&gt; UpdatesTotal = 16\n35c35\n&lt; UpdatesSequenced = 11\n---\n&gt; UpdatesSequenced = 15\n</pre></div>\n\n\n<p>And also:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">condor_status -submitter -l -pool imaclinux mbprolinux &gt; imaclinux-mbprolinux-submitter.txt\ncondor_status -submitter -l pool mbprolinux mbprolinux &gt; mbprolinux-mbprolinux-submitter.txt\n</pre></div>\n\n\n<p>Also indistinguishable with a diff of:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">14c14\n&lt; UpdatesTotal = 11\n---\n&gt; UpdatesTotal = 14\n31c31\n&lt; UpdatesSequenced = 10\n---\n&gt; UpdatesSequenced = 13\n44c44\n&lt; SubmitterTag = \"imaclinux\"\n---\n&gt; SubmitterTag = \"\"\n</pre></div>\n\n\n<p>Would it be possible to add some indicator attributes to these ads that would let you find the home pool for a submitter or scheduler ad when you query a collector? So that I could query the imaclinux pool and know that the mbprolinux scheduler and submitter ads in this pool were from a machine that wasn't part of this pool, that they were a result of flocking.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/457/schedd-and-submitter-ads.zip\">schedd-and-submitter-ads.zip</a>\n3682 bytes added by ichesal on 2011-Sep-09 20:52:50 UTC.\n<br/>\nThe scheduler and submitter ads from the two pools that show how things are indistinguishable once flocking beings to occur.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "", "type": "enhance", "last_change": "2011-Sep-09 15:52", "status": "new", "created": "2011-Sep-09 15:52", "fixed_version": "2011-Sep-09 15:52", "broken_version": "v070601", "priority": "4", "subsystem": "Daemons", "assigned_to": "tannenba", "derived_from": "", "creator": "ichesal", "rust": "", "customer_group": "other", "visibility": "public", "notify": "dclayton@cyclecomputing.com", "due_date": ""}