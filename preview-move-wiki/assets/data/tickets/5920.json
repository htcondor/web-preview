{"id": 5920, "title": "Ticket #5920: Blocking log event reads with Python bindings can return prematurely", "description": "<blockquote>\nBlocking reads of log events (i.e. read an event with no specified timeout) are broken with the Python bindings, using either the <code>LogReader</code> or <code>EventIterator</code> classes.\n\n<p>For example, with EventIterator.poll, when given a positive timeout argument it seems to work fine. But if timeout is the default value of -1, it returns within a second with no event:\n\n</p><p>The following code will demonstrate the bug:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">x = htcondor.read_events(open('EventLog'))\n\nfor _ in x: pass  # fire through all events so nothing's left\n\nx.poll(4000)  # blocks for 4 seconds as expected\n\nx.poll()  # should block indefinitely but returns after a second\n</pre></div>\n\n\n<p>In addition, sub-second <code>LogReader</code> blocking polling on platforms without inotify (mac, windows) is also broken for no good reason.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Sep-26 11:20:42 by gthain:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Looks good, tests now run fine.\n\n</p><p>Note that the PDF version of the manual truncates sections of the tables describing the python bindings.  Suggest that we reformat python bindings documentation to be similar to the perl api.  Then remove the perl api documentation.</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=5927\" onclick=\"get_ticket_and_populate_wrapper('5927'); return false;\" title=\"Improve Python API documentation\">#5927</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nImprove Python API documentation</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-23 13:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7daf8dcc5c1393b92eaab7a2d833d51564e3d274\">[49280]</a></span>: Version history blurb for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5920\" onclick=\"get_ticket_and_populate_wrapper('5920'); return false;\" title=\"Blocking log event reads with Python bindings can return prematurely\">#5920</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-23 13:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fe68d7548bb1a8b4397a1fba764df8abc9800d03\">[49279]</a></span>: Fix sub-second <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LogReader\" title=\"Log Reader\">LogReader</a></span> polling on mac, windows platforms. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5920\" onclick=\"get_ticket_and_populate_wrapper('5920'); return false;\" title=\"Blocking log event reads with Python bindings can return prematurely\">#5920</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-23 13:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6ea8412efac6a71cf46cc24625d57dceaba1f21c\">[49278]</a></span>: Fix util lib call Sleep(milliseconds), and start using it. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5920\" onclick=\"get_ticket_and_populate_wrapper('5920'); return false;\" title=\"Blocking log event reads with Python bindings can return prematurely\">#5920</a></span> Our util lib Sleep() function, used to sleep X milliseconds, was acutally sleeping for usecs and also didn't work for anything more than one second. Also no declaration. Sigh.  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-23 12:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5461d5936cca3569cac1c558cda7c6e0965654ea\">[49277]</a></span>: Fix bugs polling for log events from Python with no timeout. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5920\" onclick=\"get_ticket_and_populate_wrapper('5920'); return false;\" title=\"Blocking log event reads with Python bindings can return prematurely\">#5920</a></span> For example, EventIterator.poll should block forever with a default timeout value of -1, but before this patch it actually would return after one second with no event.  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Sep-26 12:04", "status": "resolved", "created": "2016-Sep-23 12:06", "fixed_version": "2016-Sep-23 12:06", "broken_version": "v080400", "priority": "3", "subsystem": "PythonBinding", "assigned_to": "tannenba", "derived_from": "", "creator": "tannenba", "rust": "a30640", "customer_group": "chtc", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}