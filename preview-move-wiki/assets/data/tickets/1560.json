{"id": 1560, "title": "Ticket #1560: fix \"unknown negotiator\" problem", "description": "<blockquote>\nFor better or worse, when flocking is enabled, the schedd needs to know which flocking level it is dealing with when negotiating.  If it can't figure it out, the schedd refuses to negotiate, with the message \"unknown negotiator\".\n\n<p>The schedd's algorithm for identifying the negotiator requires the admin to set NEGOTIATOR_HOST and/or FLOCK_NEGOTIATOR_HOSTS to something with a DNS entry matching the peer address observed by the schedd when receiving a connection from the negotiator.\n\n</p><p><span class=\"section\"></span></p><h2>Proposal </h2>\n\n<p>Have the schedd insert a \"tag\" into the submitter ad.  When the negotiator connects to the schedd to negotiate, it should present this tag.  By choosing a tag that uniquely identifies the flocking level (e.g. the collector name), the schedd can use it to identify which flocking level is being negotiated.  Nothing special has to be done for multi-homed negotiators or negotiators that run on a different host from the collector.  The algorithm doesn't even assume that there is only one negotiator per collector.\n\n</p><p>This can also make FLOCK_NEGOTIATOR_HOSTS optional in the schedd.  It's only use would be for identifying older negotiators and as a macro in the config file for authorization policy.  By not setting it at all, the admin can have the schedd query the address of the negotiator (for sending RESCHEDULE) rather than relying on the config file for the address.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Aug-05 10:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/be2027d7c9c9046debc33dbdc2c171717439e91d\">[25606]</a></span>: Documented fix for \"unknown negotiator\" problem. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1560\" onclick=\"get_ticket_and_populate_wrapper('1560'); return false;\" title='fix \"unknown negotiator\" problem'>#1560</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Aug-05 09:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e765cb0bfe2275edf25ae9c9941b1153eb2864a2\">[18724]</a></span>: Fixed the \"unknown negotiator\" problem. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1560\" onclick=\"get_ticket_and_populate_wrapper('1560'); return false;\" title='fix \"unknown negotiator\" problem'>#1560</a></span> For better or worse, when flocking is enabled, the schedd needs to know which flocking level it is dealing with when negotiating. If it can't figure it out, the schedd refuses to negotiate, with the message \"unknown negotiator\".\u00a0[...]\n (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Aug-05 10:32", "status": "resolved", "created": "2010-Aug-05 09:38", "fixed_version": "2010-Aug-05 09:38", "broken_version": "v070000", "priority": "4", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "a20855", "customer_group": "batlab", "visibility": "public", "notify": "dan@hep.wisc.edu", "due_date": ""}