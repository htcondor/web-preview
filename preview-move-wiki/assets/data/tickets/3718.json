{"id": 3718, "title": "Ticket #3718: Detect invalid interpreter in script", "description": "<blockquote>\nIt's not-so-uncommon for a user to specify a bad interpreter in a shell script they submit to condor:\n\n<p></p><div class=\"verbatim\">\n<pre>#!/bin/bsh\n</pre></div>\n\n\n<p>When this happens, the user gets the following hold message:\n\n</p><p></p><div class=\"verbatim\">\n<pre>Error from slot3@hcc-briantest.unl.edu: Failed to execute '/tmp/foo': (errno=2: 'No such file or directory')\n</pre></div>\n\n\n<p>This is incredibly misleading - anyone who hasn't memorized every HTCondor failure mode will immediately think /tmp/foo doesn't exist and look for filesystem issues.  That's certainly what I do!\n\n</p><p>I propose to adopt the error handling logic for this case from /bin/bash and properly detect the bad interpreter.  Here's my proposed hold message:\n\n</p><p></p><div class=\"verbatim\">\n<pre>[bbockelm@hcc-briantest condor]$ condor_q -held\n\n\n-- Submitter: hcc-briantest.unl.edu : &lt;129.93.244.208:44063&gt; : hcc-briantest.unl.edu\n ID       OWNER          HELD_SINCE  HOLD_REASON\n23319.0   bbockelm        6/24 21:51 Error from slot3@hcc-briantest.unl.edu: Failed to execute '/tmp/foo': invalid interpreter (/bin/blah) specified on first line of script (errno=2: 'No such file or directory')\n\n1 jobs; 0 completed, 0 removed, 0 idle, 0 running, 1 held, 0 suspended\n</pre></div>\n\n\n<p>Patch on the V8_1-bad-interpreter branch.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Jun-24 22:01:35 by bbockelm:</em> <br/>\n\ngthain, ready for review.\n\n<p></p><hr/>\n<em>2013-Jun-25 10:19:42 by gthain:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Can we close script_fd?  I know we're on our way out at this point, but not closing it will annoy our static analyzers.\n\n</p><p>What happens in the case where there's a space between #! and the interpreter?  IIRC, is that a distinct error?\n\n</p><p>Should we put the job on hold in this case or not?  Is it more likely for someone to misspell /usr/bin/perl, or to land on one machine in the pool that doesn't have perl?\n\n</p><p></p><hr/>\n<em>2013-Jun-25 13:04:36 by bbockelm:</em> <br/>\n\n<ul>\n<li>Having the space in \"#! /bin/bash\" appears to be acceptable.  Job runs fine.\n</li><li>I'll fix the script_fd.\n</li><li>I think putting things on hold is the most appropriate way forward - it mimics what happens with other exec errors.  It's just an improvement in the error message, not a change in semantics.\n</li></ul>\n\n<p>If you're OK with it, I propose fixing the fd leak and pushing.\n\n</p><p></p><hr/>\n<em>2013-Jun-25 15:14:13 by gthain:</em> <br/>\n\nAFter talking this over with todd, he'd really profer that this just go into the starter.\n\n<p></p><hr/>\n<em>2013-Jun-25 16:47:56 by bbockelm:</em> <br/>\n\nWhat's the thinking behind that?\n\n<p>As we're just improving the error message, should benefit all <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> users.\n\n</p><p></p><hr/>\n<em>2015-Apr-09 19:50:29 by bbockelm:</em> <br/>\n\nTalked to ToddT; he disclaims any knowledge of the preference of putting it into the Starter itself.  Yay for old age!\n\n<p>I'm going to fix script_fd, run it through NMI, and merge on up.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-05 13:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44991\">[44991]</a></span>: Version history items for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3718\" onclick=\"get_ticket_and_populate_wrapper('3718'); return false;\" title=\"Detect invalid interpreter in script\">#3718</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5021\" onclick=\"get_ticket_and_populate_wrapper('5021'); return false;\" title=\"Missing RPM dependencies in condor-static-shadow\">#5021</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5035\" onclick=\"get_ticket_and_populate_wrapper('5035'); return false;\" title=\"Incorporate OSG changes\">#5035</a></span>  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-10 07:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44580\">[44580]</a></span>: Add logic to detect exec failure due to an invalid interpreter. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3718\" onclick=\"get_ticket_and_populate_wrapper('3718'); return false;\" title=\"Detect invalid interpreter in script\">#3718</a></span> Previously, if you had an invalid interpreter name, you would get an error along the lines of:\u00a0[...]\n (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-09 22:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44576\">[44576]</a></span>: Add logic to detect exec failure due to an invalid interpreter. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3718\" onclick=\"get_ticket_and_populate_wrapper('3718'); return false;\" title=\"Detect invalid interpreter in script\">#3718</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jun-24 22:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=36669\">[36669]</a></span>: Add logic to detect exec failure due to an invalid interpreter. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3718\" onclick=\"get_ticket_and_populate_wrapper('3718'); return false;\" title=\"Detect invalid interpreter in script\">#3718</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Jun-05 13:25", "status": "resolved", "created": "2013-Jun-24 21:56", "fixed_version": "2013-Jun-24 21:56", "broken_version": "", "priority": "4", "subsystem": "DaemonsExecNode", "assigned_to": "bbockelm", "derived_from": "#4882", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "", "due_date": ""}