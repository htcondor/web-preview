{"id": 6984, "title": "Ticket #6984: Tickets of Execution", "description": "<blockquote>\nThe startd should record -- for the job's post script, in the job ad, and in the job event log -- which entity ordered it terminate the job, when, and by which method it received the order.\n\n<p>See the <a class=\"external\" href=\"https://docs.google.com/document/d/1d6Fafm4T-tzPyhLefHXnYYdDmurhOzCoeycbsq-m--Q\">design doc</a>; this ticket includes only the first three milestones (and setting _CONDOR_HOW_CODE in the post-script's environment).  This was done to give SWAMP a chance to test the code before the rest of the work was done.  See <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=7099\" onclick=\"get_ticket_and_populate_wrapper('7099'); return false;\" title=\"(more) Tickets of Execution\">#7099</a></span> for the remainder of the work.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-May-07 18:44:05 by tlmiller:</em> <br/>\n\nAlthough round-tripping a job event log through Python is a good and necessary test, it doesn't actually verify that the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobEvent\" title=\"Job Event\">JobEvent</a></span> objects have the correct values (since the internal C++ objects are used in the test).  A partial approach, also probably independently worthwhile, is to round-trip through JSON to check the toClassAd()/initFromClassAd() pairs; it's not immediately clear how to check the Python <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobEvent\" title=\"Job Event\">JobEvent</a></span> object values quickly (although we may have a test for that which could be extended to ToE tags easily).\n\n<p></p><hr/>\n<em>2019-May-07 19:16:15 by tlmiller:</em> <br/>\n\nConsider adding milestone 3.5: automated tests for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobTerminatedEvent\" title=\"Job Terminated Event\">JobTerminatedEvent</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobAbortEvent\" title=\"Job Abort Event\">JobAbortEvent</a></span>.\n\n<p></p><hr/>\n<em>2019-Jun-03 10:44:47 by tlmiller:</em> <br/>\n\nAssuming that post-script authors mostly only care about the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=HowCode\" title=\"How Code\">HowCode</a></span>, we set _CONDOR_HOW_CODE (?) in its environment.\n\n<p></p><hr/>\n<em>2019-Jun-08 21:33:17 by tlmiller:</em> <br/>\n\nNB (for the documenation): keeping a job in the queue can cause multiple (identical) ToE tags to appear for a single job: once when terminated, once when removed, and once when force-removed.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=7099\" onclick=\"get_ticket_and_populate_wrapper('7099'); return false;\" title=\"(more) Tickets of Execution\">#7099</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\n(more) Tickets of Execution</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jul-12 13:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57408\">[57408]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Documentation and release note.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-07 13:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57124\">[57124]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Don't try to read the ToE tag if the preceeding optional line's read already found the end-of-event marker.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-06 17:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57122\">[57122]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Remove unnecessary and Fedora-confusing reference from <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTree\" title=\"Expr Tree\">ExprTree</a></span> * argument in both <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> classes' Insert() implementation. Move Windows definitions of timegm(), localtime_r(), and gmtime_r() into utc_time.h.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-06 12:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57119\">[57119]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Insert _CONDOR_HOW_CODE into the environment of the post script.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jun-06 11:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57118\">[57118]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) libcondorapi needs ToE.cpp, too.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-07 19:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56793\">[56793]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Add Toe::Tag class to share event reading and writing code between different event types. Fix broken calls to InsertAttr() that were converting <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> pointers to bool (?!). Implement initFromClassAd()/toClassAd() for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobAbortedEvent\" title=\"Job Aborted Event\">JobAbortedEvent</a></span>. Completes Milestone 3.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-07 19:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56792\">[56792]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Don't evaluate nested classads when generating Python objects.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-24 18:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56790\">[56790]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Write job termination ToE tags to the (user) log. First pass at startd-generated event.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-13 22:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56620\">[56620]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Ignore, rather than crash, when the ToE attribute is not a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-13 22:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56619\">[56619]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Add ToE tag to classad conversion routines.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-13 21:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56618\">[56618]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Make JobTerminatedEvent::readEvent() marginally less fragile.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-12 16:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56617\">[56617]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Update <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobTerminatedEvent\" title=\"Job Terminated Event\">JobTerminatedEvent</a></span> to read the ToE tag.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-11 15:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56580\">[56580]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Issue to ToE tag in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=OsProc\" title=\"Os Proc\">OsProc</a></span> rather than <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserProc\" title=\"User Proc\">UserProc</a></span> to avoid issue ToE tags for pre- and post- scripts.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-10 17:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56564\">[56564]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Most of the second half of Milestone 2. Still need to update the event log reader; much testing remains.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-10 00:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56552\">[56552]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) First half of Milestone 2.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-09 18:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56551\">[56551]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6984\" onclick=\"get_ticket_and_populate_wrapper('6984'); return false;\" title=\"Tickets of Execution\">#6984</a></span>) Milestone 1.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Jul-12 13:40", "status": "resolved", "created": "2019-Apr-09 18:10", "fixed_version": "2019-Apr-09 18:10", "broken_version": "", "priority": "3", "subsystem": "DaemonsExecNode", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}