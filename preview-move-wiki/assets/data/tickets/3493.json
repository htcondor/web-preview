{"id": 3493, "title": "Ticket #3493: Audit Log for Condor schedds", "description": "<blockquote>\nFor the HTCondor-CE and other traceability requirements, OSG would like to have better audit capabilities for HTCondor.\n\n<p>Broadly, we would like to be able to gather at the schedd a log of actions that can be traced back to the users. We will add a new audit log that is designed to be easily grep-able and rotates based on time.\n\n</p><p><span class=\"subsection\"></span></p><h3>Milestones </h3>\n\n<p></p><ul>\n<li>[2 days] Identify commands to be logged, including additional information (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3563\" onclick=\"get_ticket_and_populate_wrapper('3563'); return false;\" title=\"Schedd commands to audit\">#3563</a></span>)\n</li><li>[1 day] Add D_AUDIT debug category and AUDIT_LOG config params (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3560\" onclick=\"get_ticket_and_populate_wrapper('3560'); return false;\" title=\"improve dprintf code to support audit logs (time based rotation)\">#3560</a></span>)\n</li><li>[1 day] Add and expose connection and security information in CEDAR\n</li><li>[2 days] Log network and security audit information\n</li><li>[2 days] Log command-specific audit information (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3563\" onclick=\"get_ticket_and_populate_wrapper('3563'); return false;\" title=\"Schedd commands to audit\">#3563</a></span>)\n</li><li>[1 day] Make identity attributes in job ad immutable (note: this is now just a would be nice; it is not required because the audit log will already contain immutable values)\n</li><li>[2 days] Add time-based daemon log rotation (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3560\" onclick=\"get_ticket_and_populate_wrapper('3560'); return false;\" title=\"improve dprintf code to support audit logs (time based rotation)\">#3560</a></span>)\n</li><li>[1 day] Documentation\n</li></ul>\n\n<p></p><div>\n<table border=\"1\" cellpadding=\"2\" cellspacing=\"0\" summary=\"EMBED: Status Table of Derived Tickets\">\n<caption>\n  <a href=\"rptview?rn=86\" rel=\"nofollow\" title=\"EMBED: Status Table of Derived Tickets\">EMBED: Status Table of Derived Tickets</a>\n</caption>\n<tbody><tr>\n<td colspan=\"11\"><form action=\"rptview\" method=\"GET\">\n<input name=\"rn\" type=\"hidden\" value=\"86\"/>\nTN: <input name=\"TN\" type=\"text\" value=\"3493\"/>\n<input type=\"submit\" value=\"Go\"/>\n</form></td></tr> \n<tr>\n<th><a href=\"rptview?rn=86&amp;order_by=2&amp;order_dir=ASC&amp;TN=3493\">Developer</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=3&amp;order_dir=ASC&amp;TN=3493\">#</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=4&amp;order_dir=ASC&amp;TN=3493\">Status</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=5&amp;order_dir=ASC&amp;TN=3493\">Type</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=6&amp;order_dir=ASC&amp;TN=3493\">Pri</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=7&amp;order_dir=ASC&amp;TN=3493\">Created</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=8&amp;order_dir=ASC&amp;TN=3493\">Changed</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=9&amp;order_dir=ASC&amp;TN=3493\">Target</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=10&amp;order_dir=ASC&amp;TN=3493\">Due Date</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=11&amp;order_dir=ASC&amp;TN=3493\">Days left</a></th>\n<th><a href=\"rptview?rn=86&amp;order_by=12&amp;order_dir=ASC&amp;TN=3493\">Title</a></th>\n</tr>\n<tr bgcolor=\"#c8c8c8\">\n<td valign=\"top\">\njohnkn\n</td>\n<td valign=\"top\"><a href=\"tktview?tn=3560,86\">3560</a></td>\n<td valign=\"top\">\nresolved\n</td>\n<td valign=\"top\">\nenhance\n</td>\n<td valign=\"top\">\n2\n</td>\n<td valign=\"top\">\n2013 Apr\n</td>\n<td valign=\"top\">\n2015 Aug\n</td>\n<td valign=\"top\">\nv070906\n</td>\n<td valign=\"top\">\u00a0</td>\n<td valign=\"top\">\u00a0</td>\n<td valign=\"top\">\nimprove dprintf code to support audit logs (time based rotation)\n</td>\n</tr>\n<tr bgcolor=\"#c8c8c8\">\n<td valign=\"top\">\nzmiller\n</td>\n<td valign=\"top\"><a href=\"tktview?tn=3568,86\">3568</a></td>\n<td valign=\"top\">\nresolved\n</td>\n<td valign=\"top\">\nenhance\n</td>\n<td valign=\"top\">\n3\n</td>\n<td valign=\"top\">\n2013 Apr\n</td>\n<td valign=\"top\">\n2013 May\n</td>\n<td valign=\"top\">\nv070906\n</td>\n<td valign=\"top\">\u00a0</td>\n<td valign=\"top\">\u00a0</td>\n<td valign=\"top\">\nAdd and expose connection and security information in CEDAR\n</td>\n</tr>\n<tr bgcolor=\"#c8c8c8\">\n<td valign=\"top\">\nsamf\n</td>\n<td valign=\"top\"><a href=\"tktview?tn=3563,86\">3563</a></td>\n<td valign=\"top\">\nresolved\n</td>\n<td valign=\"top\">\nenhance\n</td>\n<td valign=\"top\">\n3\n</td>\n<td valign=\"top\">\n2013 Apr\n</td>\n<td valign=\"top\">\n2013 May\n</td>\n<td valign=\"top\">\nv070906\n</td>\n<td valign=\"top\">\u00a0</td>\n<td valign=\"top\">\u00a0</td>\n<td valign=\"top\">\nSchedd commands to audit\n</td>\n</tr>\n</tbody></table></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2013-Apr-03 14:48:12 by jfrey:</em> <br/>\n\nWork for this ticket and its children should be committed to branch V7_9-gt3493_audit_log-branch.\n\n<p></p><hr/>\n<em>2013-Apr-05 10:17:55 by tannenba:</em> <br/>\n\nI would like it confirmed/tested that the audit log works (1) with syslog (it should since it is all built on top of dprintf, yes? and (2) with condor_fetchlog. Thanks.\n\n<p></p><hr/>\n<em>2013-Nov-12 14:03:12 by tannenba:</em> <br/>\n\nThis needs documentation.\n\n<p>As an example on how to use it, put this in the config file:\n\n</p><p></p><pre>   SCHEDD_AUDIT_LOG = $(LOG)/AuditLog\n   MAX_SCHEDD_AUDIT_LOG = 1d\n   MAX_NUM_SCHEDD_AUDIT_LOG = 10\n</pre>\n\n<p>This will result in 10 day audit history.</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3560\" onclick=\"get_ticket_and_populate_wrapper('3560'); return false;\" title=\"improve dprintf code to support audit logs (time based rotation)\">#3560</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nimprove dprintf code to support audit logs (time based rotation)</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3563\" onclick=\"get_ticket_and_populate_wrapper('3563'); return false;\" title=\"Schedd commands to audit\">#3563</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nSchedd commands to audit</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3568\" onclick=\"get_ticket_and_populate_wrapper('3568'); return false;\" title=\"Add and expose connection and security information in CEDAR\">#3568</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd and expose connection and security information in CEDAR</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/715/AuditLogDesignDoc.docx\">AuditLogDesignDoc.docx</a>\n121385 bytes added by jfrey on 2013-Apr-02 16:20:33 UTC.\n<br/>\nNew design document for audit log.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Dec-10 10:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3a6cc3bbb53b8543d113c0dd2f4a16973983fa91\">[38969]</a></span>: define config knobs SCHEDD_AUDIT_LOG, MAX_SCHEDD_AUDIT_LOG, and MAX_NUM_SCHEDD_AUDIT_LOG in the manual. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3493\" onclick=\"get_ticket_and_populate_wrapper('3493'); return false;\" title=\"Audit Log for Condor schedds\">#3493</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-07 17:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/aec470eec260f1cc6076fe6aa4eb8630e64665ac\">[35641]</a></span>: Edit many 7.9.6 version history items, including those for tickets (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3539\" onclick=\"get_ticket_and_populate_wrapper('3539'); return false;\" title=\"change recommended configuration for disabling preemption\">#3539</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3586\" onclick=\"get_ticket_and_populate_wrapper('3586'); return false;\" title=\"move python bindings out of contrib\">#3586</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3398\" onclick=\"get_ticket_and_populate_wrapper('3398'); return false;\" title=\"Batch GAHP cannot set remote memory or walltime requests\">#3398</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3560\" onclick=\"get_ticket_and_populate_wrapper('3560'); return false;\" title=\"improve dprintf code to support audit logs (time based rotation)\">#3560</a></span>, <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=2949\" onclick=\"get_ticket_and_populate_wrapper('2949'); return false;\" title=\"peaceful shutdown cannot be escalated to graceful\">#2949</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3493\" onclick=\"get_ticket_and_populate_wrapper('3493'); return false;\" title=\"Audit Log for Condor schedds\">#3493</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3496\" onclick=\"get_ticket_and_populate_wrapper('3496'); return false;\" title=\"monitor file transfer i/o activity\">#3496</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3597\" onclick=\"get_ticket_and_populate_wrapper('3597'); return false;\" title=\"CPU affinity enforcement broken with partitionable slots\">#3597</a></span>, <span class=\"ticket\"><a class=\"review\" href=\"/tickets?ticket=3601\" onclick=\"get_ticket_and_populate_wrapper('3601'); return false;\" title=\"autofs doesn't work with 7.9\">#3601</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3579\" onclick=\"get_ticket_and_populate_wrapper('3579'); return false;\" title=\"condor_updates_stats doesn't work anymore\">#3579</a></span>,) and (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3570\" onclick=\"get_ticket_and_populate_wrapper('3570'); return false;\" title=\"Starter leaks FDs to file transfer plugin\">#3570</a></span>, <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=3588\" onclick=\"get_ticket_and_populate_wrapper('3588'); return false;\" title=\"DHCPREQUEST doesn't have the ending 0xff byte to mark end of options f\">#3588</a></span>)  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-May-07 15:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/87acfe501bce4f72e10910619f55f2ce266d537c\">[35634]</a></span>: Version history for audit log. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3493\" onclick=\"get_ticket_and_populate_wrapper('3493'); return false;\" title=\"Audit Log for Condor schedds\">#3493</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-04 11:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/21e6ea05d78ad34bfb57ddc2152de601390220b6\">[35333]</a></span>: Change fill-in call in audit_log() to work with Sock objects. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3493\" onclick=\"get_ticket_and_populate_wrapper('3493'); return false;\" title=\"Audit Log for Condor schedds\">#3493</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-03 15:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f30bb6bf15fbd325195e83a46ccfad840f720b7a\">[35327]</a></span>: Add audit_log() function for the Condor-CE audit log. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3493\" onclick=\"get_ticket_and_populate_wrapper('3493'); return false;\" title=\"Audit Log for Condor schedds\">#3493</a></span> This definition ensures that the relevant connection id is always included in a predictable format in each message.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Dec-11 09:38", "status": "resolved", "created": "2013-Feb-14 13:57", "fixed_version": "2013-Feb-14 13:57", "broken_version": "", "priority": "2", "subsystem": "", "assigned_to": "jfrey", "derived_from": "#3275", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu", "due_date": ""}