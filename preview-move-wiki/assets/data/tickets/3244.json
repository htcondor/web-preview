{"id": 3244, "title": "Ticket #3244: >1 instance of a local universe job started in parallel", "description": "<blockquote>\n<div class=\"verbatim\">\n<pre>% fgrep 54088797 /var/log/condor/StarterLog*\n09/28/12 11:09:55 (54088797.0)  Starter running a job under a schedd listening at &lt;10.14.0.18:51441&gt;\n09/28/12 11:09:55 (54088797.0)  Starter running a local job with no shadow\n09/28/12 11:09:55 (54088797.0)  Reading job ClassAd from \"STDIN\"\n09/28/12 11:09:55 (54088797.0)  Found ClassAd data in \"STDIN\"\n09/28/12 11:09:55 (54088797.0)  setting the orig job name in starter\n09/28/12 11:09:55 (54088797.0)  setting the orig job iwd in starter\n09/28/12 11:09:55 (54088797.0)  Done setting resource limits\n09/28/12 11:09:55 (54088797.0)  Job 54088797.0 set to execute immediately\n09/28/12 11:09:55 (54088797.0)  Starting a LOCAL universe job with ID: 54088797.0\n09/28/12 11:09:55 (54088797.0)  IWD: /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc\n09/28/12 11:09:55 (54088797.0)  Input file: /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/in/in.54\n09/28/12 11:09:55 (54088797.0)  Output file: /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/output/coinc.54\n09/28/12 11:09:55 (54088797.0)  Error file: /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/err/err.coinc.54\n09/28/12 11:09:55 (54088797.0)  Renice expr \"10\" evaluated to 10\n09/28/12 11:09:55 (54088797.0)  About to exec /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/compile_coinc.sh\n09/28/12 11:09:55 (54088797.0)  Running job as user root\n09/28/12 11:09:55 (54088797.0)  Create_Process succeeded, pid=32563\n10/01/12 09:50:03 (54088797.0)  Starter running a job under a schedd listening at &lt;10.14.0.18:51441&gt;\n10/01/12 09:50:03 (54088797.0)  Starter running a local job with no shadow\n10/01/12 09:50:03 (54088797.0)  Reading job ClassAd from \"STDIN\"\n10/01/12 09:50:03 (54088797.0)  Found ClassAd data in \"STDIN\"\n10/01/12 09:50:03 (54088797.0)  setting the orig job name in starter\n10/01/12 09:50:03 (54088797.0)  setting the orig job iwd in starter\n10/01/12 09:50:03 (54088797.0)  Done setting resource limits\n10/01/12 09:50:03 (54088797.0)  Job 54088797.0 set to execute immediately\n10/01/12 09:50:03 (54088797.0)  Starting a LOCAL universe job with ID: 54088797.0\n10/01/12 09:50:03 (54088797.0)  IWD: /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc\n10/01/12 09:50:03 (54088797.0)  Input file: /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/in/in.54\n10/01/12 09:50:03 (54088797.0)  Output file: /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/output/coinc.54\n10/01/12 09:50:03 (54088797.0)  Error file: /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/err/err.coinc.54\n10/01/12 09:50:06 (54088797.0)  Renice expr \"10\" evaluated to 10\n10/01/12 09:50:06 (54088797.0)  About to exec /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/compile_coinc.sh\n10/01/12 09:50:06 (54088797.0)  Running job as user root\n10/01/12 09:50:06 (54088797.0)  Create_Process succeeded, pid=19306\n10/02/12 03:49:04 (54088797.0)  Starter running a job under a schedd listening at &lt;10.14.0.18:51441&gt;\n10/02/12 03:49:04 (54088797.0)  Starter running a local job with no shadow\n10/02/12 03:49:04 (54088797.0)  Reading job ClassAd from \"STDIN\"\n10/02/12 03:49:04 (54088797.0)  Found ClassAd data in \"STDIN\"\n10/02/12 03:49:04 (54088797.0)  setting the orig job name in starter\n10/02/12 03:49:04 (54088797.0)  setting the orig job iwd in starter\n10/02/12 03:49:04 (54088797.0)  Done setting resource limits\n10/02/12 03:49:04 (54088797.0)  Job 54088797.0 set to execute immediately\n10/02/12 03:49:04 (54088797.0)  Starting a LOCAL universe job with ID: 54088797.0\n10/02/12 03:49:04 (54088797.0)  IWD: /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc\n10/02/12 03:49:04 (54088797.0)  Input file: /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/in/in.54\n10/02/12 03:49:04 (54088797.0)  Output file: /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/output/coinc.54\n10/02/12 03:49:04 (54088797.0)  Error file: /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/err/err.coinc.54\n10/02/12 03:49:06 (54088797.0)  Renice expr \"10\" evaluated to 10\n10/02/12 03:49:06 (54088797.0)  About to exec /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/compile_coinc.sh\n10/02/12 03:49:06 (54088797.0)  Running job as user root\n10/02/12 03:49:06 (54088797.0)  Create_Process succeeded, pid=12315\n\n% ps auwx | fgrep 32563\nvolodya  32563  0.0  0.0  10460   416 ?        SNs  Sep28   0:00 /bin/bash /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/compile_coinc.sh\n% ps auwx | fgrep 19306\nvolodya  19306  0.0  0.0  10460   688 ?        SNs  Oct01   0:00 /bin/bash /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/compile_coinc.sh\n% ps auwx | fgrep 12315\nvolodya  12315  0.0  0.0  10460   588 ?        SNs  03:49   0:00 /bin/bash /mnt/qfs1/volodya/britta/S6.low_f0a.1800-1825.combined/coinc/compile_coinc.sh\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Oct-02 14:37:22 by pfc:</em> <br/>\n\nAll of the daemon logs, pstree output, etc. as of this afternoon is captured in ~pfcouvar/condor-badness-10000 on ldas-pcdev1.ligo.caltech.edu, which Todd should have login access to.\n\n<p></p><hr/>\n<em>2012-Oct-03 12:26:19 by nwp:</em> <br/>\n\nThis seems like this could be related to <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3156\" onclick=\"get_ticket_and_populate_wrapper('3156'); return false;\" title=\"IMPOSSIBLE: status for job\">#3156</a></span>.  If one of the local universe jobs completes, and the schedd tries to restart one of the \"copies\", you will get a similar error message.  But, I notice the schedd's are different machines...\n<hr/>\n<em>2012-Oct-25 17:52:16 by johnkn:</em> <br/>\n\nBulk change of target version from v070806 to v070807 using ./ticket-target-mover.\n<hr/>\n<em>2012-Dec-19 09:30:47 by johnkn:</em> <br/>\n\nBulk change of target version from v070807 to v070808 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2013-Mar-05 08:23:08 by pfc:</em> <br/>\n\nJust to confirm, is this stalled because you can't figure out how it could have happened, and we can't reproduce it on demand?\n\n<p></p><hr/>\n<em>2013-Mar-11 11:10:06 by gthain:</em> <br/>\n\nThanks to the eagle eyes of our LIGO friends, who caught this in action before schedd logs rolled over, we can see what happened:  At:\n\n<p>3/10/13, at 14:45:45, it looks like there was a problem with NFS on pcdev2:\n\n</p><p>03/10/13 14:45:45 (pid:17173) warning: setting <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserUid\" title=\"User Uid\">UserUid</a></span> to 5517, was 5294 previously\n03/10/13 15:38:03 (pid:17173) Error: chdir(/mnt/zfs3/stochastic/S5_Recolored_aLIGO/condor) failed: No such file or directory\n\n</p><p>Note the warning at 14:45:45 is superflous, but it looks like the chdir to /mnt/zfs3/stochastic/S5_Recolored_aLIGO/condor took almost an hour before it failed.  Perhaps there was a different filesystem causing the hang between there?  In any case, the schedd was blocked for 53 minutes.\n\n</p><p>Then, a rather large amount of backlogged work started happening, and the schedd noticed that it had not heard from any of its children in the CHILD_ALIVE timeout, and killed them all, assuming that they were hung.  While this is merely annoying for children of the schedd which are shadows, it is really bad for the local universe starters, as it just kill -9s them, so there's no chance for the starter to clean up the job.\n\n</p><p>We'll have to think about the right way in HTCondor to fix this, but in the short term, on the submit machine, you should be able to set\n\n</p><p>NOT_RESPONDING_TIMEOUT\n\n</p><p>to some very large value.  The default is 3600 (seconds), perhaps 10x that would fix your immediate problems.\n</p><hr/>\n<em>2013-Mar-28 17:16:00 by johnkn:</em> <br/>\n\nBulk change of target version from v070808 to v070809 using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jun-27 17:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/745d6d30051b064efe0887b505747052fdb24a41\">[36706]</a></span>: Fix LIGO found problems related to local universe blocking on NFS <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3244\" onclick=\"get_ticket_and_populate_wrapper('3244'); return false;\" title=\"&gt;1 instance of a local universe job started in parallel\">#3244</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Aug-04 12:08", "status": "defer", "created": "2012-Oct-02 13:58", "fixed_version": "2012-Oct-02 13:58", "broken_version": "v070804", "priority": "5", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "", "creator": "pfc", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pfcouvar@syr.edu, anderson@ligo.caltech.edu, tstclair@redhat.com,pcouvare@caltech.edu", "due_date": ""}