{"id": 1743, "title": "Ticket #1743: condor_ssh_to_job is harmful during stage-in", "description": "<blockquote>\nIf condor_ssh_to_job is done during the transfer of input files, the starter gets confused when the sshd process exits.  It thinks the job is done, so it tries to do the final update (which blocks because the shadow is doing file transfer).  Once the file transfer finishes, the starter's attempt to do the final update goes ahead, but then the starter hits an exception:\n\n<p></p><div class=\"verbatim\">\n<pre>10/29/10 15:33:33 ERROR \"FileTransfer::UpLoadFiles called during active transfer!\n</pre></div>\n\n\n<p>Furthermore, when using privsep, the sshd_setup script fails when file transfer is happening, because the sandbox is owned by condor rather than the user.\n\n</p><p></p><div class=\"verbatim\">\n<pre>10/28/10 17:56:51 START_SSHD failed: condor_ssh_to_job_sshd_setup failed: Failed to create /var/lib/condor/execute/slot5/dir_29041/.condor_ssh_to_job_1\n</pre></div>\n\n\n<p><span class=\"section\"></span></p><h2>How To Fix</h2>\n\n<p>It seems best to have the starter reject ssh attempts during file transfer.  It may also be a good idea to reject ssh attempts until the job has started, since the starter may get confused if sshd is ever the first and only task that it is managing.  Either way, we should understand why the starter gets confused and also fix that, because it seems like the logic must be buggy.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Nov-02 10:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25771\">[25771]</a></span>: Documented fix for condor_ssh_to_job during file transfer. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1743\" onclick=\"get_ticket_and_populate_wrapper('1743'); return false;\" title=\"condor_ssh_to_job is harmful during stage-in\">#1743</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Nov-01 17:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=19290\">[19290]</a></span>: Fix for ssh_to_job during file transfer. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1743\" onclick=\"get_ticket_and_populate_wrapper('1743'); return false;\" title=\"condor_ssh_to_job is harmful during stage-in\">#1743</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Nov-02 10:43", "status": "resolved", "created": "2010-Oct-29 15:52", "fixed_version": "2010-Oct-29 15:52", "broken_version": "v070400", "priority": "4", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu", "due_date": ""}