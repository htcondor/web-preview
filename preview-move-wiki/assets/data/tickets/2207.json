{"id": 2207, "title": "Ticket #2207: condor_read() failed: recv() returned -1, errno = 107 Transport endpoi", "description": "<blockquote>\nThe master occasionally complains:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">06/02/11 13:51:54 condor_read() failed: recv() returned -1, errno = 107 Transport endpoint is not connected, reading 4 bytes from .\n06/02/11 13:51:54 condor_read() failed: recv() returned -1, errno = 107 Transport endpoint is not connected, reading 5 bytes from .\n06/02/11 13:51:54 IO: Failed to read packet header\n06/02/11 13:51:54 DaemonCore: Can't receive command request from  (perhaps a timeout?)\n</pre></div>\n\n\n<p>This may be a result of the IPv6 stage 2 merge; need to investigate the past.\n\n</p><p>This will sometimes bite other daemons as they start up; they'll fail to connect to the Master and will exit.  Usually when the master restarts them, they are fine.\n\n</p><p>Typical complaints from a startd:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">06/02/11 14:41:42 condor_write(): Socket closed when trying to write 510 bytes to daemon at &lt;128.105.185.14:34463&gt;, fd is 8\n06/02/11 14:41:42 Buf::write(): condor_write() failed\n06/02/11 14:41:42 SECMAN: failed to end classad message\n06/02/11 14:41:42 ChildAliveMsg: failed to send DC_CHILDALIVE to parent daemon at &lt;128.105.185.14:34463&gt; (try 1 of 3): SECMAN:2007:\nFailed to end classad message.\n</pre></div>\n\n\n<p>This also bit the command line tools; the master rejected several commands in a row with errors like the above.  After a while the problem cleared itself up.\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">% condor_restart\nERROR\nSECMAN:2007:Failed to end classad message.\nCan't send Restart command to local master\n% condor_restart\nERROR\nSECMAN:2007:Failed to end classad message.\nCan't send Restart command to local master\n% condor_off -master\nERROR\nSECMAN:2007:Failed to end classad message.\nCan't send Kill-Daemon command to local master\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Jun-02 14:39:44 by adesmet:</em> <br/>\n\nerrno 107 = ENOTCONN. \"The socket is associated with a connection-oriented protocol and has not been connected (see connect(2) and accept(2)).\"\n\n<p></p><hr/>\n<em>2011-Jun-02 15:57:33 by adesmet:</em> <br/>\n\nWorking theory: accept is failing in condor_accept (<a class=\"file\" href=\"rlog?f=src/condor_utils/condor_sockfunc.cpp\">/src/condor_utils/condor_sockfunc.cpp</a> 15).  It's failing because len is being passed in uninitialized.  It should be initialized to sizeof(sockaddr_storage).\n\n<p></p><hr/>\n<em>2011-Jun-02 16:03:52 by adesmet:</em> <br/>\n\nHahahahaha, condor_accept is never called, anywhere.  Why it appeared in my backtrace is a mystery for the ages.\n\n<p></p><hr/>\n<em>2011-Jun-02 16:18:50 by adesmet:</em> <br/>\n\nAh, missed a change when I git pulled.  664ba4f1994652030555795e2c1123fb4b724ca0 (gthain's revert of m's change) removed the condor_accept.  Probably as a quick fix to the core problem.  I think my fix is more correct, need to check with gthain.\n\n<p></p><hr/>\n<em>2011-Jun-22 14:48:28 by adesmet:</em> <br/>\n\nFixed in <span class=\"chng\"><a href=\"chngview?cn=22264\">[22264]</a></span></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-22 11:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=22264\">[22264]</a></span>: use condor_accept instead of accept. Also fix a bug in condor_accept. Which, since we weren't using it, wasn't user visible. This is ongoing IPv6 work, strictly behind the scenes, no user visible changes ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=9\" onclick=\"get_ticket_and_populate_wrapper('9'); return false;\" title=\"IPv6: clean up old tickets\">#9</a></span> Also <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2207\" onclick=\"get_ticket_and_populate_wrapper('2207'); return false;\" title=\"condor_read() failed: recv() returned -1, errno = 107 Transport endpoi\">#2207</a></span>  (By Alan De Smet )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-02 16:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=22112\">[22112]</a></span>: Fix \"condor_read() failed: recv() returned -1, errno = 107 Transport endpoint is not connected, reading 4 bytes from .\" bug. Not ever released in buggy form, no version history needed. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2207\" onclick=\"get_ticket_and_populate_wrapper('2207'); return false;\" title=\"condor_read() failed: recv() returned -1, errno = 107 Transport endpoi\">#2207</a></span> ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2207\" onclick=\"get_ticket_and_populate_wrapper('2207'); return false;\" title=\"condor_read() failed: recv() returned -1, errno = 107 Transport endpoi\">#2207</a></span>  (By Alan De Smet )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Jun-22 14:49", "status": "resolved", "created": "2011-Jun-02 14:11", "fixed_version": "2011-Jun-02 14:11", "broken_version": "v070700", "priority": "1", "subsystem": "Daemons", "assigned_to": "adesmet", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}