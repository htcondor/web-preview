{"id": 6221, "title": "Ticket #6221: Allow alternate spool locations for job sandbox directories", "description": "<blockquote>\nThere are situations where we'd like the job sandbox directories to reside somewhere other than the SPOOL directory, and that location can vary based on attributes in the job ad. One case is Argonne National Lab, where all jobs belong to a project allocation and files (of any notable size) should reside under a project-specific directory tree.\n\n<p>Another case is the HTCondor-CE in OSG. When submitting into a batch system that doesn't support file transfer, the CE's SPOOL directory must reside on a shared filesystem that either doesn't have root-squash or is hosted on the CE machine. Having the job sandbox live under the user's home directory and never chowned to/from the condor user could relax this restriction.\n\n</p><p>For an initial implementation, we'll focus on the Argonne case, which is a little simpler. Only the job sandbox directories will be relocatable. The alternate location will be determined by a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> expression evaluated against the job ad, provided via the config file. If the expression evaluates to a string, then the result is used as an alternate SPOOL base directory. Otherwise, the regular SPOOL directory is used as normal.\n\n</p><p>The alternate spool location is assumed to exist and have the same owner and permissions as the regular spool directory. The usual directory hierarchy is created in the alternate location for the job sandbox directories. Standard universe checkpoint files will reside in the alternate location, but the ickpt file (the spooled executable when copy_to_spool=true) will remain in the regular spool directory. Other job-specific files, like the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyProxy\" title=\"My Proxy\">MyProxy</a></span> password file, will also remain in the regular spool directory.\n\n</p><p>Concerns with the current implementation:\n</p><ul>\n<li>Undefined behavior if alternate spool value for a job changes over the job's lifetime.\n</li><li>Setting config knob to a plain pathname (without quotes) will fail, an easy mistake to make\n</li><li>Alternate spool location must exist and have same owner/permissions as main spool directory.\n</li><li>getJobSpoolPath() now does two param() calls and one expression parse (if knob is set) on every invocation.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jun-20 14:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=51761\">[51761]</a></span>: Docs for ALTERNATE_JOB_SPOOL. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6221\" onclick=\"get_ticket_and_populate_wrapper('6221'); return false;\" title=\"Allow alternate spool locations for job sandbox directories\">#6221</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-17 11:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50656\">[50656]</a></span>: Remove unused variable. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6221\" onclick=\"get_ticket_and_populate_wrapper('6221'); return false;\" title=\"Allow alternate spool locations for job sandbox directories\">#6221</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-16 15:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50653\">[50653]</a></span>: Add attribute showing a job was submitted via SOAP. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6221\" onclick=\"get_ticket_and_populate_wrapper('6221'); return false;\" title=\"Allow alternate spool locations for job sandbox directories\">#6221</a></span> The new attribute, SOAPJob, is needed to disable the new alternate spool directory feature, which doesn't work with SOAP jobs.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-16 15:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50654\">[50654]</a></span>: Split gen_ckpt_name() calls between two new functions. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6221\" onclick=\"get_ticket_and_populate_wrapper('6221'); return false;\" title=\"Allow alternate spool locations for job sandbox directories\">#6221</a></span> Building the path to a spooled executable, or ickpt, file is now done with GetSpooledExecutablePath(), which requires only the cluster id.\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-16 15:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50655\">[50655]</a></span>: Add ALTERNATE_JOB_SPOOL config knob <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6221\" onclick=\"get_ticket_and_populate_wrapper('6221'); return false;\" title=\"Allow alternate spool locations for job sandbox directories\">#6221</a></span> ALTERNATE_JOB_SPOOL is an expression evaluated against the job ad. If it evaluates to a string, that string is used as an alternate value for SPOOL when determining the job's spool directory or checkpoint file. The alternate directory is assumed to exist and\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Jun-20 14:05", "status": "resolved", "created": "2017-Apr-11 11:02", "fixed_version": "2017-Apr-11 11:02", "broken_version": "", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}