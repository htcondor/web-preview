{"id": 1857, "title": "Ticket #1857: sysapi_phys_mem() failing on AIX (nmi-build31)", "description": "<blockquote>\nSince the 7.5.5 upgrade yesterday, the startd has been failing at startup. The log is littered with:\n<div class=\"code\">\n<pre class=\"code\">01/20/11 09:23:28 Error computing physical memory with calc_phys_mem().\n                MEMORY parameter not defined in config file.\n                Try setting MEMORY to the number of megabytes of RAM.\n01/20/11 09:23:28 ERROR \"Can't compute physical memory.\" at line 69 in file /home/condor/execute/dir_178504/userdir\n/src/condor_startd.V6/ResAttributes.cpp\n</pre></div>\n\n\n<p>A diff of of phys_mem.cpp vs. phys_mem.c (from 7.5.4):\n</p><div class=\"code\">\n<pre class=\"code\">diff --git a/src/condor_sysapi/phys_mem.cpp b/src/condor_sysapi/phys_mem.cpp\nindex 7b67a05..515feb9 100644\n--- a/src/condor_sysapi/phys_mem.cpp\n+++ b/src/condor_sysapi/phys_mem.cpp\n@@ -222,14 +222,14 @@ sysapi_phys_memory_raw_no_param(void)\n\n        /* get me the various memory entries that represent the full amount of\n                memory on the machine */\n-    mret = odm_get_obj(cuat, \"name like mem? AND attribute='size'\",\n+    mret = (struct CuAt *)odm_get_obj(cuat, \"name like mem? AND attribute='size'\",\n                &amp;mem_ent, ODM_FIRST);\n-    while(mret != NULL)\n+    while(mret != NULL &amp;&amp; (int)mret != -1)\n     {\n                /* This value appears to be in Megabytes. */\n                memory_size += atoi(mem_ent.value);\n\n-        mret = odm_get_obj(cuat, NULL, &amp;mem_ent, ODM_NEXT);\n+        mret = (struct CuAt *)odm_get_obj(cuat, NULL, &amp;mem_ent, ODM_NEXT);\n     }\n\n     if (odm_close_class(cuat) &lt; 0)\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2011-Feb-01 16:20:02 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2020-Jul-31 14:36:33 by jfrey:</em> <br/>\n\nAIX support was dropped a long time ago.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "defect", "last_change": "2020-Jul-31 14:36", "status": "abandoned", "created": "2011-Jan-20 09:38", "fixed_version": "2011-Jan-20 09:38", "broken_version": "v070505", "priority": "2", "subsystem": "Daemons", "assigned_to": "", "derived_from": "", "creator": "nleroy", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "", "due_date": ""}