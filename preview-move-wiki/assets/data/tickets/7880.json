{"id": 7880, "title": "Ticket #7880: condor_chirp on windows aborts in c-rutime after successful command", "description": "<blockquote>\nG-Research reports that when they upgraded to 8.8.9, condor_chirp on Windows began to exit with status -1073740791 which is STATUS_STACK_BUFFER_OVERRUN, even when the command was successful.\n\n<p>In attempting to reproduce the problem, I discovered that condor_chirp 8.8.7, 8.8.9 and 8.9.9 would all exit with an error status (but a different one) in the c-runtime process teardown code while trying to close open files.\n\n</p><p>This does not seem to be because anything in condor_chirp changes, but rather because Microsoft changed the c-runtime to automatically call _fcloseall() after main exits.\n\n</p><p>condor_chirp has always done something that is technically illegal - it calls fdopen twice against the same fd.  This results in an error when the second FILE* is closed because the first one closed the underlying file.  On Linux error is quitely ignored, and on Windows it was as well for many years, but a recenty it began to cause an abort instead.  We believe that a recent update of Windows is what changed.\n\n</p><p>If we fix the underlying bug - the incorrect re-use of an fd, the abort no longer happens.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Oct-13 15:30:58 by gthain:</em> <br/>\n\n<strong>CODE REVIEW</strong>  Looks good.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-19 15:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61516\">[61516]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7880\" onclick=\"get_ticket_and_populate_wrapper('7880'); return false;\" title=\"condor_chirp on windows aborts in c-rutime after successful command\">#7880</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-07 10:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61439\">[61439]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7880\" onclick=\"get_ticket_and_populate_wrapper('7880'); return false;\" title=\"condor_chirp on windows aborts in c-rutime after successful command\">#7880</a></span>, explicitly close both file streams  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Oct-07 09:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61438\">[61438]</a></span>: fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7880\" onclick=\"get_ticket_and_populate_wrapper('7880'); return false;\" title=\"condor_chirp on windows aborts in c-rutime after successful command\">#7880</a></span>, condor_chirp on windows aborts after successful command  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Oct-19 16:09", "status": "resolved", "created": "2020-Oct-07 09:14", "fixed_version": "2020-Oct-07 09:14", "broken_version": "v080800", "priority": "2", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "support", "visibility": "public", "notify": "", "due_date": ""}