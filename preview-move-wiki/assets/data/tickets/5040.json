{"id": 5040, "title": "Ticket #5040: condor_gpu_discover -config should set count of GPUs", "description": "<blockquote>\nIt can be hard to configure a execute node to create GPU slots from a variable number of GPUs.  <code>condor_gpu_discovery</code> could be called as a script in the config file, if it were to set a config macro to the number of GPUs detected, then this job would be easier.\n\n<p>currently condor_gpu_discovery -config sets a config macro to the list of ids of the GPUs detected, it should also set NUM_DETECTED_GPUs to the number of items in the list.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-May-06 10:14:32 by johnkn:</em> <br/>\n\n<code>condor_gpu_discovery -config</code> now returns\n\n<p></p><pre>    DetectedGPUs=CUDA0, CUDA1, CUDA2\n    NUM_DETECTED_GPUs=3\n</pre>\n\n<p>If it detects 3 CUDA GPUs.  So you can add this to your config\n\n</p><p></p><pre>    include : $(LIBEXEC)/condor_gpu_discovery -config |\n    NUM_SLOTS_TYPE_1 = 1\n    SLOT_TYPE_1_PARTITIONABLE = true\n    NUM_SLOTS_TYPE_2 = $(NUM_DETECTED_GPUS)\n    SLOT_TYPE_2 = GPUs=1, CPUs=2, Mem=500, Disk=1/$(DETECTED_CORES)\n</pre>\n\n<p>This will give 1 static slot per GPU, and one partitionable slot that has\nall of the remaining resources.</p></blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-03 14:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44946\">[44946]</a></span>: minor edit of 8.3.6 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5040\" onclick=\"get_ticket_and_populate_wrapper('5040'); return false;\" title=\"condor_gpu_discover -config should set count of GPUs\">#5040</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-02 15:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44933\">[44933]</a></span>: version history and doc for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5040\" onclick=\"get_ticket_and_populate_wrapper('5040'); return false;\" title=\"condor_gpu_discover -config should set count of GPUs\">#5040</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-06 10:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44791\">[44791]</a></span>: add NUM_DETECTED_GPUs to the output of condor_gpu_detection -config <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5040\" onclick=\"get_ticket_and_populate_wrapper('5040'); return false;\" title=\"condor_gpu_discover -config should set count of GPUs\">#5040</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Jun-04 14:54", "status": "resolved", "created": "2015-May-06 10:08", "fixed_version": "2015-May-06 10:08", "broken_version": "", "priority": "3", "subsystem": "Libs", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}