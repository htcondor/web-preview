{"id": 3012, "title": "Ticket #3012: Schedd aborts if spool directory is not writable", "description": "<blockquote>\nThe schedd aborts with the log below if you set the spool directory to something unwritable.\n\n<p>This appears to have been introduced in 5a106f5d by Dan.\n\n</p><p>Certainly a rare case, but it should exit with an error instead of an abort.\n\n</p><p>Looks like the same thing happens if the daemon cannot open its log file.\n\n</p><p></p><div class=\"verbatim\">\n<pre>05/28/12 12:15:44 (pid:23449) ******************************************************\n05/28/12 12:15:44 (pid:23449) ** condor_schedd (CONDOR_SCHEDD) STARTING UP\n05/28/12 12:15:44 (pid:23449) ** /home/cse496/bbockelm/projects/condor/src/condor_schedd.V6/condor_schedd\n05/28/12 12:15:44 (pid:23449) ** SubsystemInfo: name=SCHEDD type=SCHEDD(5) class=DAEMON(1)\n05/28/12 12:15:44 (pid:23449) ** Configuration: subsystem:SCHEDD local:Shadow class:DAEMON\n05/28/12 12:15:44 (pid:23449) ** $CondorVersion: 7.9.0 Apr 27 2012 PRE-RELEASE-UWCS $\n05/28/12 12:15:44 (pid:23449) ** $CondorPlatform: X86_64-CentOS_5.8 $\n05/28/12 12:15:44 (pid:23449) ** PID = 23449\n05/28/12 12:15:44 (pid:23449) ** Log last touched 5/28 12:13:27\n05/28/12 12:15:44 (pid:23449) ******************************************************\n05/28/12 12:15:44 (pid:23449) Using config source: /etc/condor/condor_config\n05/28/12 12:15:44 (pid:23449) Using local config sources:\n05/28/12 12:15:44 (pid:23449)    /etc/condor/config.d/00personal_condor.config\n05/28/12 12:15:44 (pid:23449)    /etc/condor/config.d/01-local\n05/28/12 12:15:44 (pid:23449)    /etc/condor/config.d/04-red-external\n05/28/12 12:15:44 (pid:23449)    /etc/condor/config.d/60condor-qmf.config\n05/28/12 12:15:44 (pid:23449)    /etc/condor/config.d/61aviary.config\n05/28/12 12:15:44 (pid:23449)    /etc/condor/config.d/99-osg-ce.conf\n05/28/12 12:15:44 (pid:23449)    /etc/condor/config.d/99_gratia.conf\n05/28/12 12:15:44 (pid:23449) DaemonCore: command socket at &lt;129.93.239.174:46546&gt;\n05/28/12 12:15:44 (pid:23449) DaemonCore: private command socket at &lt;129.93.239.174:46546&gt;\n05/28/12 12:15:44 (pid:23449) DaemonCore: ERROR: Can't open address file /var/lib/condor/spool/shadow/.schedd_address.new\n05/28/12 12:15:44 (pid:23449) Setting maximum accepts per cycle 8.\n05/28/12 12:15:44 (pid:23449) DaemonCore: ERROR: Can't open address file /var/lib/condor/spool/shadow/.schedd_address.new\n05/28/12 12:15:44 (pid:23449) History file rotation is enabled.\n05/28/12 12:15:44 (pid:23449)   Maximum history file size is: 20971520 bytes\n05/28/12 12:15:44 (pid:23449)   Number of rotated history files is: 2\n05/28/12 12:15:44 (pid:23449) Logging per-job history files to: /var/lib/gratia/data\n05/28/12 12:15:44 (pid:23449) initLocalStarterDir(): mkdir(/var/lib/condor/spool/shadow/local_univ_execute) failed: No such file or directory (errno 2)\n05/28/12 12:15:44 (pid:23449) Failed to execute /usr/sbin/condor_shadow.std, ignoring\n05/28/12 12:15:44 (pid:23449) Can't open directory \"/var/lib/condor/spool/shadow\" as PRIV_CONDOR, errno: 2 (No such file or directory)\n05/28/12 12:15:44 (pid:23449) ERROR \"Failed to open /var/lib/condor/spool/shadow/spool_version for writing.\n\" at line 93 in file /home/cse496/bbockelm/projects/condor/src/condor_utils/spool_version.cpp\nStack dump for process 23449 at timestamp 1338225344 (13 frames)\n/usr/lib64/libcondor_utils_7_9_0.so(dprintf_dump_stack+0x100)[0x2addec5256d8]\n/usr/lib64/libcondor_utils_7_9_0.so[0x2addec465a58]\n/lib64/libpthread.so.0[0x3b9800ebe0]\n/lib64/libc.so.6(gsignal+0x35)[0x3b97030285]\n/lib64/libc.so.6(abort+0x110)[0x3b97031d30]\n/usr/lib64/libcondor_utils_7_9_0.so(_EXCEPT_+0x1bf)[0x2addec5242c1]\n/usr/lib64/libcondor_utils_7_9_0.so(WriteSpoolVersion(char const*, int, int)+0xad)[0x2addec4eae3d]\ncondor_schedd(InitJobQueue(char const*, int)+0xb1c)[0x4a2146]\ncondor_schedd(main_init(int, char**)+0x309)[0x48a105]\n/usr/lib64/libcondor_utils_7_9_0.so(dc_main(int, char**)+0x1e17)[0x2addec5fdc1b]\ncondor_schedd(main+0x56)[0x489d6c]\n/lib64/libc.so.6(__libc_start_main+0xf4)[0x3b9701d994]\ncondor_schedd(CronJobMgr::JobExited(CronJob const&amp;)+0xa1)[0x4458c9]\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "todo", "last_change": "2012-May-28 12:48", "status": "new", "created": "2012-May-28 12:48", "fixed_version": "2012-May-28 12:48", "broken_version": "", "priority": "4", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bbockelm@cse.unl.edu", "due_date": ""}