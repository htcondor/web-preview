{"id": 4937, "title": "Ticket #4937: Fix time zone handling in ClassAds", "description": "<blockquote>\nWhen parsing an absTime value that doesn't have a time zone offset, the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> library calculates the start and end of DST in the local time zone incorrectly. The times of switching to/from DST are off by the local zone's offset from UTC.\n\n<p><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AbsTime\" title=\"Abs Time\">AbsTime</a></span> values within that several-hour window will be converted to the wrong UTC time (off by an hour in either direction).\n\n</p><p>In time zones that follow the US's DST rules, this bug can be observed by evaluating the following expression:\n</p><div class=\"verbatim\">\n<pre>absTime(\"2002-10-27T17:30:00\")-absTime(\"2002-10-27T02:30:00\")\n</pre></div>\n\n\n<p>The result should be </p><div class=\"verbatim\">\n<pre>relTime(\"15:00:00\")</pre></div>\n\n\n<p>With the bug, the result is </p><div class=\"verbatim\">\n<pre>relTime(\"16:00:00\")</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2015-Mar-13 11:23:36 by jfrey:</em> <br/>\n\nAlso, the time zone part of an absTime value is unparsed incorrectly. The hours and minutes of the time zone offset should be separated by a colon.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Mar-17 13:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/133994e786997c8c9aaf3ebf2b5355299c0b18dc\">[43609]</a></span>: Docs for DST bug fixes with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> timestamps. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4936\" onclick=\"get_ticket_and_populate_wrapper('4936'); return false;\" title=\"Fix time zone handling in python bindings\">#4936</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4937\" onclick=\"get_ticket_and_populate_wrapper('4937'); return false;\" title=\"Fix time zone handling in ClassAds\">#4937</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Mar-13 11:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/852f6a15d41c5b28baafd9f1ee4ee5b44a4bdd49\">[43581]</a></span>: Fix canonical form of time zone offset in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> absTime values. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4937\" onclick=\"get_ticket_and_populate_wrapper('4937'); return false;\" title=\"Fix time zone handling in ClassAds\">#4937</a></span> In the canonical representation of an absTime value, the time zone offset value should have a colon separating the hours and minutes. The colon is optional and values without it will still be accepted.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Mar-13 11:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/74b390a3b5d00b89ed63d410f1bb78dc989c0a28\">[43580]</a></span>: Fix time zone DST handling in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> absTime values. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4937\" onclick=\"get_ticket_and_populate_wrapper('4937'); return false;\" title=\"Fix time zone handling in ClassAds\">#4937</a></span> When parsing an absTime value that doesn't have a time zone offset, Literal::MakeAbsTime() was calculating the start and end of DST in the local time zone incorrectly. The times of switching to/from DST were off by the local zone's offset from\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Mar-17 13:33", "status": "resolved", "created": "2015-Mar-13 11:08", "fixed_version": "2015-Mar-13 11:08", "broken_version": "v080100", "priority": "3", "subsystem": "ClassAd", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}