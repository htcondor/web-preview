{"id": 52, "title": "Ticket #52: Condor Connection Broker (CCB)", "description": "<blockquote>\nThis ticket will hold information about CCB, the Condor Connection Broker. The sinful string for a daemon now includes all contact information. This includes public address, private network info, and CCB info.\n\n<p>We plan on CCB essentially replacing GCB at some point in the v7.3.x development series.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Jan-21 15:21:48 by tannenba:</em> <br/>\n\nSome wisdom (snagged from a message from Dan to Igor on 1/21/09):\n\n<p>I have not yet had time to optimize the security session in the connection to the collector.  So if a daemon is advertising itself to the same collector as is acting as its CCB server, there will currently be two authentication's per daemon.  (Because the first one is DAEMON level and the second one is ADVERTISE_STARTD or ADVERTISE_MASTER, which implies DAEMON, but is not implied by DAEMON.)  Client's wishing to request a connection from a daemon do so at READ authorization level when they talk to the CCB server.  I don't recall whether that requires authentication in your setup or not.\n\n</p><p>I found that there were a number of places where having the CCB info in a separate attribute was problematic, because Condor passes around address strings rather than full daemon classads in some cases.  Therefore, the CCB info is always packed into the address string.  As things stand, that means daemons with CCB turned on are incompatible with other condor components from before 7.3.0.  Same goes for daemons with a private network name defined, because I had to pack that into the address as well.  Even in the GCB case, that helps, because of all the places where the extra contact information was slipping through the cracks.\n\n</p><p></p><hr/>\n<em>2009-Mar-10 17:55:02 by danb:</em> <br/>\n\nUnfortunately, I just discovered that CCB doesn't work at all with standard universe.  Why?  Because the sockets that the shadow opens to communicate with the starter are created by connecting to the startd.  It doesn't connect to the startd's command port (or all would be well).  Instead, the startd creates two new listen ports and the shadow connects to those.  One solution would be to have the shadow create the connections by connecting (in advance of ACTIVATE_CLAIM) to the startd command port with some kind of command that indicates to the startd that it should just hold on to those connections until ACTIVATE_CLAIM happens.  There are other possible solutions, but I think this one would be the simplest.\n\n<p>If that problem were solved, it would be possible to run standard universe jobs on a private execute node from a public submit node.  It would still not be possible to run on a public execute node from a private submit node (or with a private checkpoint server).  The reason is that the checkpoint is sent to the shadow (or checkpoint server) by creating a new connection, but the shadow and checkpoint server are not daemonCore, so this connection cannot be reversed via CCB.</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=317\" onclick=\"get_ticket_and_populate_wrapper('317'); return false;\" title=\"Make CCB work with standard universe\">#317</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nMake CCB work with standard universe</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Mar-09 18:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=14201\">[14201]</a></span>: Improved CCB cient-side error message. When the client requests a connection to a target daemon that has recently disconnected from the CCB server, the client was just being rejected without a helpful error message being sent back. (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span>)  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-09 12:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13781\">[13781]</a></span>: Avoid creating a CCB reconnect file if it is just empty. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-09 12:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13782\">[13782]</a></span>: CCB server tells target daemon its public IP address. Previously, the CCBListener filled in the address of the CCB server when building the full CCB contact info. However, it is more flexible to have the CCB server fill in this info, so it can do things behind the scenes that CCBListener is not aware\u00a0[...]\n (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-05 16:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13768\">[13768]</a></span>: Use TCP instead of UDP when talking to a daemon via CCB. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span> Previously, admins were expected to twiddle various knobs to change bits of the condor protocol from UDP to TCP, because UDP is not supported by either GCB or CCB. That's automatic now when using CCB.  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Feb-05 15:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13765\">[13765]</a></span>: Added MAX_FILE_DESCRIPTORS. Miron wants ability to require at startup that there are sufficient file descriptors (e.g. for CCB). <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span> (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-26 15:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13609\">[13609]</a></span>: Added CCB, the Condor Connection Broker. (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span>) The sinful string for a daemon now includes all contact information. This includes public address, private network info, and CCB info.  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-25 20:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13587\">[13587]</a></span>: Special handling of CCBClient trying to connect to CCB server in same daemon. (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span>)  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-25 10:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13585\">[13585]</a></span>: Fixed memory leak in CCB. (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span>)  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-24 14:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13584\">[13584]</a></span>: CCB reconnect record sweep was happening far too often. (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span>)  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-21 22:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13545\">[13545]</a></span>: Registration of CCB listener must happen with fresh security session. Otherwise, when CCB server restarts, we try to use stale security sessions to reconnect, and the server cannot send us a reply message indicating that the session is invalid. (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span>)  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-21 17:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13543\">[13543]</a></span>: Another constipation fix for the windows compiler. (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span>)  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-21 15:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13537\">[13537]</a></span>: Fixed private network handling and url-encoding (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span>).  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-21 11:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13532\">[13532]</a></span>: Constipation fix for windows compilation of CCB (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span>).  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-20 15:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13512\">[13512]</a></span>: Adding CCB to windows build. (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span>)  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jan-20 15:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=13511\">[13511]</a></span>: Added CCB, the Condor Connection Broker. The sinful string for a daemon now includes all contact information. This includes public address, private network info, and CCB info. (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=52\" onclick=\"get_ticket_and_populate_wrapper('52'); return false;\" title=\"Condor Connection Broker (CCB)\">#52</a></span>)  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Jan-31 13:16", "status": "resolved", "created": "2009-Jan-21 09:07", "fixed_version": "2009-Jan-21 09:07", "broken_version": "", "priority": "2", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "tannenba", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}