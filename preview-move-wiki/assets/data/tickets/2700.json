{"id": 2700, "title": "Ticket #2700: Centralize tool functionality into a tool core", "description": "<blockquote>\nSeveral tools share initialization steps and have duplicate code across all of them as a result. Creating a single location for this code will reduce duplication and also help reduce tedious changes when the functions called by all the tools end up changing.\n\n<p></p><ul>\n<li>V7_7-tool_core-branch\n</li></ul>\n\n<p>Steps:\n</p><ul>\n<li>Unify debug, version, help, address, and pool options. The debug option at least needs to be unified before attempting to do further work on the dprintf code, as changing dprintf_config currently entails changing over a dozen callsites all doing the same thing.\n</li><li>Identify what else is shared amongst tools.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Dec-20 14:38:22 by ziliang:</em> <br/>\n\nCommon/Semi-common options\n<ul>\n<li>-address\n</li><li>-debug\n</li><li>-help\n</li><li>-name: complication, name is sometimes daemon name, sometimes hostname\n</li><li>-pool: central manager hostname\n</li><li>-version\n</li></ul>\n\n<p>Tools\n</p><ul>\n<li>advertise: does not have -address or -name options\n</li><li>config_val: no -version, -debug is not mentioned in the usage but exists, -name refers to daemon name, even though we have -master, -startd, -schedd, etc\n</li><li>cod_tool: -name is startd hostname\n</li><li>fetch_log: no -addr\n</li><li>wait: no -addr, no -pool, no -name\n</li><li>check_user_log: not needed\n</li><li>history: only has -help and -debug, -debug is not mentioned in usage\n</li><li>transfer_data: -name means schedd name, -debug documentation is commented out\n</li><li>store_cred: no -version, -d instead of -debug, -h instead of -help, -n instead of -name for specific machine hostname, no -addr, no -pool\n</li><li>submit: -name is schedd name, -addr is schedd address, no -version, -debug present but not documented\n</li><li>status: -version not documented, no -addr, condor_status is considerably more complex and seems to have order dependencies for arguments\n</li><li>rm: -debug present but documentation commented out, -name is schedd name\n</li><li>qedit: has dependency on specific ordering of arguments, might not be able to merge its argument handling\n</li><li>q: has -addr, not documented, -debug is documented in usage, but does not warn user that we also need a debug flag, -name is schedd name\n</li><li>preen: only has -debug\n</li><li>test_auth: instead of name, has daemontype to get daemon name, otherwise only has -debug\n</li></ul>\n\n<p></p><hr/>\n<em>2012-Jan-16 13:31:04 by ziliang:</em> <br/>\n\nLessons learned: match_prefix is a lie.  Created match_prefix_real to compensate due to concerns about existing usages of match_prefix in places besides argument parsing.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-24 16:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=29191\">[29191]</a></span>: Fix up is_arg function in tool_core and argument handling in condor_submit. Ticket <span class=\"ticket\"><a class=\"pending\" href=\"/tickets?ticket=2700\" onclick=\"get_ticket_and_populate_wrapper('2700'); return false;\" title=\"Centralize tool functionality into a tool core\">#2700</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-18 16:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=29149\">[29149]</a></span>: Clean up code to be more consistent and fix a few bugs. Ticket <span class=\"ticket\"><a class=\"pending\" href=\"/tickets?ticket=2700\" onclick=\"get_ticket_and_populate_wrapper('2700'); return false;\" title=\"Centralize tool functionality into a tool core\">#2700</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-18 14:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=29144\">[29144]</a></span>: Rewrite argument handling incorporating TJ's feedback. Not using match_prefix anymore, going to see what breaks. Ticket <span class=\"ticket\"><a class=\"pending\" href=\"/tickets?ticket=2700\" onclick=\"get_ticket_and_populate_wrapper('2700'); return false;\" title=\"Centralize tool functionality into a tool core\">#2700</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-17 13:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=29130\">[29130]</a></span>: Revert \"Implement a match_prefix function that does not switch which input is tested and use it in argument handling. Mark usage functions as static. Ticket <span class=\"ticket\"><a class=\"pending\" href=\"/tickets?ticket=2700\" onclick=\"get_ticket_and_populate_wrapper('2700'); return false;\" title=\"Centralize tool functionality into a tool core\">#2700</a></span>.\" This reverts commit 933ee5b1fbae0a1217bc0de718455b71f5f6055c.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-16 13:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=29120\">[29120]</a></span>: Implement a match_prefix function that does not switch which input is tested and use it in argument handling. Mark usage functions as static. Ticket <span class=\"ticket\"><a class=\"pending\" href=\"/tickets?ticket=2700\" onclick=\"get_ticket_and_populate_wrapper('2700'); return false;\" title=\"Centralize tool functionality into a tool core\">#2700</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-14 14:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=29118\">[29118]</a></span>: Use strstr instead of match_prefix for -a handling in condor_submit due to broken semantic in match_prefix. Ticket <span class=\"ticket\"><a class=\"pending\" href=\"/tickets?ticket=2700\" onclick=\"get_ticket_and_populate_wrapper('2700'); return false;\" title=\"Centralize tool functionality into a tool core\">#2700</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-13 12:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=29111\">[29111]</a></span>: Stop using and remove uninitialized pointer in condor_rm, tweak parsing to handle ambiguity between -addr and -append due to screwed up match_prefix semantics. Ticket <span class=\"ticket\"><a class=\"pending\" href=\"/tickets?ticket=2700\" onclick=\"get_ticket_and_populate_wrapper('2700'); return false;\" title=\"Centralize tool functionality into a tool core\">#2700</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-11 15:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=29071\">[29071]</a></span>: Convert first pass of converting tools to use tool core argument parsing. Ticket <span class=\"ticket\"><a class=\"pending\" href=\"/tickets?ticket=2700\" onclick=\"get_ticket_and_populate_wrapper('2700'); return false;\" title=\"Centralize tool functionality into a tool core\">#2700</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-11 15:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=29070\">[29070]</a></span>: Add tool_core files. Ticket <span class=\"ticket\"><a class=\"pending\" href=\"/tickets?ticket=2700\" onclick=\"get_ticket_and_populate_wrapper('2700'); return false;\" title=\"Centralize tool functionality into a tool core\">#2700</a></span>.  (By Ziliang Guo )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Jan-28 15:35", "status": "pending", "created": "2011-Dec-08 18:26", "fixed_version": "2011-Dec-08 18:26", "broken_version": "", "priority": "5", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "", "creator": "ziliang", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}