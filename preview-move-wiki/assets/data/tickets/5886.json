{"id": 5886, "title": "Ticket #5886: make the http file transfer plugin retry on certain errors", "description": "<blockquote>\nSometimes http transfers fail for any number of reasons.  If we can detect that it's a transient error (a network error or server overloaded, as opposed to say, 404 not found), then the plugin should retry some number of times, perhaps with a small delay, and hide the failure if the transfer ultimately succeeds.</blockquote>", "remarks": "<blockquote>\n<em>2016-Oct-05 15:24:07 by tannenba:</em> <br/>\n\nI'd like to see a design document for this work ahead of coding, and I'd like Zach to review it, so that we are all on the same page for what \"retries\" means (how many retries? how quickly should they happen? in what cases will a retry be attempted vs not attempted?).\n\n<p></p><hr/>\n<em>2016-Oct-05 15:43:32 by tannenba:</em> <br/>\n\nRandom thought -  GNU wget has several options and algorithms in support of retries.  From the wget docs:\n\n<p></p><div class=\"blockquote\">\n<table width=\"95%\"><tbody><tr><td>\u00a0</td><td>\n  \n   Wget has been designed for robustness over slow or unstable network connections; if a download fails due to a network problem, it will keep retrying until the whole file has been retrieved. If the server supports regetting, it will instruct the server to continue the download from where it left off.\n</td></tr></tbody></table></div>\n\n\n<p>May be good to learn/understand wget's retry wisdom when working on the plan for our own retry algorithm.  And/or maybe we simply want to use wget in place of curl in the file transfer plugin :).\n\n</p><p></p><hr/>\n<em>2016-Nov-07 14:44:06 by jpatton:</em> <br/>\n\nIs there a particular reason why the curl plugin's <code>SupportedMethods</code> do not include \"https\"? (This was throwing me off in some testing, see also e.g. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4692\" onclick=\"get_ticket_and_populate_wrapper('4692'); return false;\" title=\"URL transfer plugin and should_transfer_files broken if input URL only\">#4692</a></span>. <code>condor_q -better</code> suggests removing  <code>( TARGET.HasFileTransfer &amp;&amp; stringListMember(\"https\",HasFileTransferPluginMethods) )</code>, which is pretty unhelpful)\n\n<p></p><hr/>\n<em>2017-Jun-26 14:26:42 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>:  Looked at all the commits.  Looks good!\n\n<p></p><hr/>\n<em>2017-Sep-21 14:05:00 by coatsworth:</em> <br/>\n\nLooks like this is already in the version history: <a class=\"external\" href=\"http://research.cs.wisc.edu/htcondor/manual/v8.7/11_2Development_Release.html#tex2html123\">http://research.cs.wisc.edu/htcondor/manual/v8.7/11_2Development_Release.html#tex2html123</a>\n\n<p></p><hr/>\n<em>2017-Sep-21 14:10:26 by tim:</em> <br/>\n\nYou are right. Resolving.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7259\" onclick=\"get_ticket_and_populate_wrapper('7259'); return false;\" title=\"curl_plugin should not attempt partial retries when behind a proxy\">#7259</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\ncurl_plugin should not attempt partial retries when behind a proxy</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-25 15:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50724\">[50724]</a></span>: Fixed upload functionality (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5886\" onclick=\"get_ticket_and_populate_wrapper('5886'); return false;\" title=\"make the http file transfer plugin retry on certain errors\">#5886</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-11 11:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50711\">[50711]</a></span>: Hooked HTTP resume tests into Perl code (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5886\" onclick=\"get_ticket_and_populate_wrapper('5886'); return false;\" title=\"make the http file transfer plugin retry on certain errors\">#5886</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-11 10:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50631\">[50631]</a></span>: Added support for HTTP resumes + two test cases (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5886\" onclick=\"get_ticket_and_populate_wrapper('5886'); return false;\" title=\"make the http file transfer plugin retry on certain errors\">#5886</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-08 11:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50617\">[50617]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=50605\">[50605]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=50606\">[50606]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=50607\">[50607]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=50608\">[50608]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=50609\">[50609]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=50610\">[50610]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=50611\">[50611]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=50612\">[50612]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=50613\">[50613]</a></span>, Resolved conflict in condor_Tests CMakeLists (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5886\" onclick=\"get_ticket_and_populate_wrapper('5886'); return false;\" title=\"make the http file transfer plugin retry on certain errors\">#5886</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-18 14:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50616\">[50616]</a></span>: Cleaned up test (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5886\" onclick=\"get_ticket_and_populate_wrapper('5886'); return false;\" title=\"make the http file transfer plugin retry on certain errors\">#5886</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-18 11:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50506\">[50506]</a></span>: Removed exit(0) on python not found (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5886\" onclick=\"get_ticket_and_populate_wrapper('5886'); return false;\" title=\"make the http file transfer plugin retry on certain errors\">#5886</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-18 10:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50505\">[50505]</a></span>: Cleaned up test, trying on Windows 8 again, hope path issues are resolved (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5886\" onclick=\"get_ticket_and_populate_wrapper('5886'); return false;\" title=\"make the http file transfer plugin retry on certain errors\">#5886</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-17 14:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50498\">[50498]</a></span>: Added extra python binary check (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5886\" onclick=\"get_ticket_and_populate_wrapper('5886'); return false;\" title=\"make the http file transfer plugin retry on certain errors\">#5886</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-17 14:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50497\">[50497]</a></span>: Added TLOG statements to test output for Windows debugging (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5886\" onclick=\"get_ticket_and_populate_wrapper('5886'); return false;\" title=\"make the http file transfer plugin retry on certain errors\">#5886</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-17 12:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50495\">[50495]</a></span>: Debugging Windows 8 failures, removed regex on python binary path (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5886\" onclick=\"get_ticket_and_populate_wrapper('5886'); return false;\" title=\"make the http file transfer plugin retry on certain errors\">#5886</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-17 12:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50494\">[50494]</a></span>: Hopefully fixed problem with bogus curl_plugin return codes (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5886\" onclick=\"get_ticket_and_populate_wrapper('5886'); return false;\" title=\"make the http file transfer plugin retry on certain errors\">#5886</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-13 10:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50465\">[50465]</a></span>: Added curl_plugin.c and CMakeLists.txt, forgotten in last commit (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5886\" onclick=\"get_ticket_and_populate_wrapper('5886'); return false;\" title=\"make the http file transfer plugin retry on certain errors\">#5886</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-12 17:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=50464\">[50464]</a></span>: Added basic curl retry functionality + tests running against a flaky web server (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5886\" onclick=\"get_ticket_and_populate_wrapper('5886'); return false;\" title=\"make the http file transfer plugin retry on certain errors\">#5886</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Sep-21 14:10", "status": "resolved", "created": "2016-Sep-07 11:11", "fixed_version": "2016-Sep-07 11:11", "broken_version": "v080600", "priority": "3", "subsystem": "FileTransfer", "assigned_to": "coatsworth", "derived_from": "", "creator": "zmiller", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "zmiller@cs.wisc.edu, tannenba@cs.wisc.edu, tim@cs.wisc.edu", "due_date": ""}