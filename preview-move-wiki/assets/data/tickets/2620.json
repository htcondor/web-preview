{"id": 2620, "title": "Ticket #2620: crondor job misfired due to daylight saving change", "description": "<blockquote>\nWe run a daily crondor job at 00:15am to report usage of GLOW.  On 2011-11-06, the day time changed back to normal time from daylight savings time, the crondor job ran twice in one day: once at 00:15am and once at 23:15pm.  It behaved as though the extra hour was not taken into account when computing the next time to run on 2011-11-06.  After the extra run on 2011-11-06, the crondor job ran as normal at 00:15am the next day, 2011-11-07.\n\n<p>The above problem happened to a crondor job on glow.cs.wisc.edu.  Strangely, this same problem did not affect an identically configured crondor job on cm.chtc.wisc.edu.  The condor version is close but not identical between these machines, but I don't know if that is the cause of the different behavior.\n\n</p><p></p><pre>   glow.cs.wisc.edu:\n      $CondorVersion: 7.7.2 Aug 23 2011 BuildID: 363342 PRE-RELEASE-UWCS $\n      $CondorPlatform: x86_64_rhas_3 $\n   cm.chtc.wisc.edu:\n      $CondorVersion: 7.7.2 Sep 27 2011 BuildID: 372978 PRE-RELEASE-UWCS $\n      $CondorPlatform: x86_64_rhas_3 $\n</pre>\n\n<p>The cron-related attributes in the jobs are:\n\n</p><p></p><pre>   CronMinute = \"15\"\n   CronHour = \"0\"</pre>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Nov-08 11:19:52 by danb:</em> <br/>\n\nThe following code in condor_crontab.cpp seems relevant:\n\n<p></p><pre>   // We also use the same daylight saving time\n   // attribute from when got the time struct up above\n   ...\n   matchTime.tm_isdst  = tm-&gt;tm_isdst;\n</pre>\n\n<p>I do not understand why we use the same daylight saving time setting from the current time when calculating the next time.  The man-page for mktime() in linux says that if tm_isdst is set to -1, it will figure out what daylight savings time setting is applicable for the specified time.  Why aren't we using that?\n\n</p><p></p><hr/>\n<em>2011-Nov-08 11:26:08 by danb:</em> <br/>\n\nI think the reason cm.chtc.wisc.edu was not affected is that there was a reconfig at 21:05pm on 2011-11-06.  A reconfig causes recalculation of cron schedules.  Since this reconfig happened after the daylight savings shift, it used the correct value for tm_isdst.  There was no reconfig on glow.cs.wisc.edu on 2011-11-06.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Nov-08 12:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5932c652495174237c26521fa8f62119571903c0\">[28171]</a></span>: quick edit of new 7.7.5 version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2620\" onclick=\"get_ticket_and_populate_wrapper('2620'); return false;\" title=\"crondor job misfired due to daylight saving change\">#2620</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Nov-08 11:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1bc35c1484eaf9209a039c0a29c8a9b34c5bda8d\">[28166]</a></span>: Documented fix for crondor scheduling and daylight savings time. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2620\" onclick=\"get_ticket_and_populate_wrapper('2620'); return false;\" title=\"crondor job misfired due to daylight saving change\">#2620</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Nov-08 11:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/29c9759090ae70b81b99d1f58771f6ba41bc89c5\">[28165]</a></span>: Fixed a bug in scheduling of crondor jobs across daylight savings shifts. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2620\" onclick=\"get_ticket_and_populate_wrapper('2620'); return false;\" title=\"crondor job misfired due to daylight saving change\">#2620</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Aug-04 15:03", "status": "resolved", "created": "2011-Nov-08 10:59", "fixed_version": "2011-Nov-08 10:59", "broken_version": "v070000", "priority": "4", "subsystem": "", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "dan@hep.wisc.edu", "due_date": ""}