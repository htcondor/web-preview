{"id": 4273, "title": "Ticket #4273: Issues with large ClassAds in new query protocol", "description": "<blockquote>\nWhen testing the new condor_q protocol on a CMS schedd, I noticed there are a few CEDAR bugs related to the combination of job <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> larger than a CEDAR buffer (4091 bytes) and blocking on the send TCP socket.\n\n<p>Patches forthcoming; assigning to TimT as this really should be considered before the 8.1.5 release.</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Mar-22 19:10:00 by bbockelm:</em> <br/>\n\nAh crap - I had originally intended to squash everything together to make it easier to backport, but forgot about this when adding 5b1cc9ae9fcdeafc0ebdffe91aca1a862011117d.\n\n<p>ToddT - note the commit message for the second commit.  Buffer::seek has an off-by-one error when reading the last byte in a buffer; rather than fixing this error (due to limited available time), I cowardly just increased the buffer size by one.  I think this bug in CEDAR is very old, but has never been hit because of how messages have been constructed up until now.\n\n</p><p></p><hr/>\n<em>2014-Mar-24 12:15:54 by tannenba:</em> <br/>\n\nI don't see 5b1cc9ae9fcdeafc0ebdffe91aca1a862011117d in our repo, so not following your first remark above.  Could you please reference (now and forever in the future) using gittrac square-brakets notation so readers can jump directly to a commit?  Thanks.\n\n<p>Also, please, please... a few more comments sprinkled in the code?  This commit has zero comments, which is becoming an unwelcome pattern. Comments do not belong in commit messages, they belong in the source code.  CEDAR was pretty obtuse before; now with misc return codes (retval 2 at least has one comment line, retval 3 has zero comments anywhere) being added with no comments or enums, conditionals being added without even a one-line comment about the high level control flow... it is getting far too difficult to follow, review, or long-term maintain.  This info is in your head now. Please take 10 min to add comments.  You cannot overdue it.  Thanks!\n\n</p><p></p><hr/>\n<em>2014-Apr-02 09:23:46 by smoler:</em> <br/>\n\nTicket changed back to docpending state, as it was resolved without any documentation.  It minimally needs a version history item.\n\n<p></p><hr/>\n<em>2014-Apr-02 11:04:42 by smoler:</em> <br/>\n\nThis ticket fixes a bug introduced within 8.1.5.  No version history is needed, as the bug was never in a release.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-25 14:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39716\">[39716]</a></span>: Grow buffer to be one byte larger than what we need. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4273\" onclick=\"get_ticket_and_populate_wrapper('4273'); return false;\" title=\"Issues with large ClassAds in new query protocol\">#4273</a></span> It's apparently impossible to seek() to the end of a buffer due to an off-by-one error in Buffer::seek(); this was never trigger-able before because of the fixed size of buffers.\u00a0[...]\n (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-25 14:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39715\">[39715]</a></span>: Small bugfixes in CEDAR for non-blocking mode. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4273\" onclick=\"get_ticket_and_populate_wrapper('4273'); return false;\" title=\"Issues with large ClassAds in new query protocol\">#4273</a></span> Committer: Greg Thain  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-22 15:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39691\">[39691]</a></span>: Grow buffer to be one byte larger than what we need. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4273\" onclick=\"get_ticket_and_populate_wrapper('4273'); return false;\" title=\"Issues with large ClassAds in new query protocol\">#4273</a></span> It's apparently impossible to seek() to the end of a buffer due to an off-by-one error in Buffer::seek(); this was never trigger-able before because of the fixed size of buffers.\u00a0[...]\n (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-22 15:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39690\">[39690]</a></span>: Small bugfixes in CEDAR for non-blocking mode. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4273\" onclick=\"get_ticket_and_populate_wrapper('4273'); return false;\" title=\"Issues with large ClassAds in new query protocol\">#4273</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Apr-02 11:04", "status": "resolved", "created": "2014-Mar-22 15:25", "fixed_version": "2014-Mar-22 15:25", "broken_version": "v080105", "priority": "2", "subsystem": "DaemonsSubmitNode", "assigned_to": "gthain", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "bbockelm@cse.unl.edu, tannenba@cs.wisc.edu, gthain@cs.wisc.edu", "due_date": ""}