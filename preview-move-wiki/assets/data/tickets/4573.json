{"id": 4573, "title": "Ticket #4573: Migrate HTCondor-CE classad function userHome to HTCondor proper", "description": "<blockquote>\nHTCondor-CE contains two additional classad functions we need for things to actually work:\n<ul>\n<li><strong>eval_rsl</strong>: This takes a Globus RSL expression and evaluates to a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>.\n</li><li><strong>user_home</strong>: This takes a username and returns the corresponding home directory name (equivalent to expanding ~).\n</li></ul>\n\n<p>These need to be migrated to the core HTCondor codebase due to the lack of versioning for plugins (causing potentials for crashes if a site uses a version of libclassad different from what we compiled against).  I'll file a separate ticket for plugins.</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Sep-17 11:20:18 by tannenba:</em> <br/>\n\nSeems like an OSG software packaging issue... why would the version of the classad plugin be different/version-skewed from the version of the rest of HTCondor CE?\n\n<p>Is the idea that sites can use their pre-existing HTCondor local site scheduler binaries for running their OSG HTCondor CE?  Is that a good idea?  Seems like that configuration should not be supported.\n\n</p><p></p><hr/>\n<em>2014-Sep-17 13:44:32 by bbockelm:</em> <br/>\n\nHi Todd,\n\n<p>The problem is that it is not possible to detect problems or potential versioning clashes.\n\n</p><p>There's also a \"finding a good home\" issue here - we'd like to keep HTCondor-CE simply a \"configuration wrapper\" for HTCondor.  I don't want to end up like glideinWMS, which is a pretty thick layer on top of HTCondor.  These are definitely code, so I really would like to find a good home for them in condor_compat.\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2014-Sep-29 14:04:02 by tannenba:</em> <br/>\n\nOk, we can add these into the compat layer code, <em>assuming</em> that the RSL function does not bring in yet another Globus GRAM dependency. Currently GRAM libs are only linked into the gahp, I wanna keep it that way...\n\n<p></p><hr/>\n<em>2014-Sep-29 14:51:08 by bbockelm:</em> <br/>\n\nI'm fine with that!\n\n<p></p><hr/>\n<em>2015-Feb-25 19:43:27 by bbockelm:</em> <br/>\n\nTalking with Jaime and Todd today - we plan on upstreaming only user_home as eval_rsl will be dropped in the long term.\n\n<p>I will submit a patch.\n\n</p><p></p><hr/>\n<em>2015-Apr-08 15:52:17 by bbockelm:</em> <br/>\n\nUpdate from OSG/HTCondor call.  This was supposed to be assigned to Brian, but didn't get done.  Will tackle this for 8.3.6.\n\n<p></p><hr/>\n<em>2015-May-09 09:33:47 by bbockelm:</em> <br/>\n\nPushed a new version of this patch.\n\n<p>In this version, CLASSAD_ENABLE_USER_HOME must be set to true for the function to actually return the home directory.\n\n</p><p>This protection is added because of the potential for abuse - <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserHome\" title=\"User Home\">UserHome</a></span> may always cause a LDAP lookup to get the information on some misconfigured hosts.  We want to make sure no one accidentally puts this in an expression in an auto cluster attribute!\n\n</p><p>Sent to batlab for testing...\n\n</p><p></p><hr/>\n<em>2015-Jun-05 14:24:39 by tim:</em> <br/>\n\nNot documenting this because of potential for abuse.\n\n<p></p><hr/>\n<em>2015-Jun-05 14:33:28 by tim:</em> <br/>\n\nNeeds to have CLASSAD_ENABLE_USER_HOME added to the param table.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-26 11:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=45688\">[45688]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4573\" onclick=\"get_ticket_and_populate_wrapper('4573'); return false;\" title=\"Migrate HTCondor-CE classad function userHome to HTCondor proper\">#4573</a></span>) param table entry for CLASSAD_ENABLE_USER_HOME  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-13 21:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44856\">[44856]</a></span>: Add <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserHome\" title=\"User Home\">UserHome</a></span> directory for looking up a user's home. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4573\" onclick=\"get_ticket_and_populate_wrapper('4573'); return false;\" title=\"Migrate HTCondor-CE classad function userHome to HTCondor proper\">#4573</a></span> This is an upstreamed version of the HTCondor-CE's equivalent function. It is disabled by default as this may be a heavy call (invoking a LDAP lookup). Includes unittest; no Windows support.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-10 22:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44816\">[44816]</a></span>: Add <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserHome\" title=\"User Home\">UserHome</a></span> directory for looking up a user's home. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4573\" onclick=\"get_ticket_and_populate_wrapper('4573'); return false;\" title=\"Migrate HTCondor-CE classad function userHome to HTCondor proper\">#4573</a></span> This is an upstreamed version of the HTCondor-CE's equivalent function. It is disabled by default as this may be a heavy call (invoking a LDAP lookup). Includes unittest; no Windows support.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-10 13:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44815\">[44815]</a></span>: Fix compilation error on windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4573\" onclick=\"get_ticket_and_populate_wrapper('4573'); return false;\" title=\"Migrate HTCondor-CE classad function userHome to HTCondor proper\">#4573</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-09 09:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44813\">[44813]</a></span>: Add <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserHome\" title=\"User Home\">UserHome</a></span> directory for looking up a user's home. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4573\" onclick=\"get_ticket_and_populate_wrapper('4573'); return false;\" title=\"Migrate HTCondor-CE classad function userHome to HTCondor proper\">#4573</a></span> This is an upstreamed version of the HTCondor-CE's equivalent function. It is disabled by default as this may be a heavy call (invoking a LDAP lookup). Includes unittest; no Windows support.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-24 08:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=44715\">[44715]</a></span>: Upstream <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserHome\" title=\"User Home\">UserHome</a></span> classad function extension <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4573\" onclick=\"get_ticket_and_populate_wrapper('4573'); return false;\" title=\"Migrate HTCondor-CE classad function userHome to HTCondor proper\">#4573</a></span> Original code from the HTCondor-CE. Includes unit test case.  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Sep-09 15:24", "status": "resolved", "created": "2014-Sep-05 08:19", "fixed_version": "2014-Sep-05 08:19", "broken_version": "", "priority": "3", "subsystem": "ClassAd", "assigned_to": "tim", "derived_from": "#4555", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu, tannenba@cs.wisc.edu, blin@cs.wisc.edu, marian.zvada@cern.ch", "due_date": ""}