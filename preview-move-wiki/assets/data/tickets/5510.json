{"id": 5510, "title": "Ticket #5510: Schedd needs an \"internal\" SetAttribute() for SECURE attributes", "description": "<blockquote>\nWith the new concept of \"Immutable\" and \"Protected\" attributes, we actually need a third class \"Secure\" to implement <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5064\" onclick=\"get_ticket_and_populate_wrapper('5064'); return false;\" title=\"Set x509 job attributes from authenticated socket\">#5064</a></span> correctly.  In this case, we want only the SchedD to be able to change these attributes.  For Immutable and Protected, the user can set them initially and so would be allowed to put them in their submit file rather than having the SchedD insert them.\n\n<p>As such, I propose adding <code>SetSecureAttribute()</code>, <code>SetSecureAttributeInt()</code>, and <code>SetSecureAttributeRawString()</code> which are only callable from within the SchedD, not over a socket.  My code will then be updated to use those internal calls.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Mar-10 08:18:25 by tannenba:</em> <br/>\n\nI would like to code review this patch when completed</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-22 16:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49306\">[49306]</a></span>: Minor changes to schedd setting of X509 job attributes. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5064\" onclick=\"get_ticket_and_populate_wrapper('5064'); return false;\" title=\"Set x509 job attributes from authenticated socket\">#5064</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5510\" onclick=\"get_ticket_and_populate_wrapper('5510'); return false;\" title='Schedd needs an \"internal\" SetAttribute() for SECURE attributes'>#5510</a></span> * Remove \"Raw\" from SetAttributeString() functions. * Optimize early returns in AddSessionAttributes(). * Always set X509 attributes when a proxy is present, preventing bleed-through of old values if new proxy doesn't have voms attributes.\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-22 15:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49301\">[49301]</a></span>: Revert \"Revert \"Implement and use an \"internal\" <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SetAttribute\" title=\"Set Attribute\">SetAttribute</a></span> for x509 attrs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5510\" onclick=\"get_ticket_and_populate_wrapper('5510'); return false;\" title='Schedd needs an \"internal\" SetAttribute() for SECURE attributes'>#5510</a></span>\"\" This reverts commit d36ca279cb8bb395e4c5f111c1c9651c85a0f072.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-May-03 01:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48346\">[48346]</a></span>: Revert \"Implement and use an \"internal\" <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SetAttribute\" title=\"Set Attribute\">SetAttribute</a></span> for x509 attrs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5510\" onclick=\"get_ticket_and_populate_wrapper('5510'); return false;\" title='Schedd needs an \"internal\" SetAttribute() for SECURE attributes'>#5510</a></span>\" This reverts commit 34e4952ac91110d052a315eadbcdb59969bda60a.  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-23 17:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48098\">[48098]</a></span>: now that all the pieces are finally in place, make x509 attrs secure. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5064\" onclick=\"get_ticket_and_populate_wrapper('5064'); return false;\" title=\"Set x509 job attributes from authenticated socket\">#5064</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5510\" onclick=\"get_ticket_and_populate_wrapper('5510'); return false;\" title='Schedd needs an \"internal\" SetAttribute() for SECURE attributes'>#5510</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-23 16:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48094\">[48094]</a></span>: Implement and use an \"internal\" <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SetAttribute\" title=\"Set Attribute\">SetAttribute</a></span> for x509 attrs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5510\" onclick=\"get_ticket_and_populate_wrapper('5510'); return false;\" title='Schedd needs an \"internal\" SetAttribute() for SECURE attributes'>#5510</a></span>  (By zmiller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Dec-05 13:52", "status": "resolved", "created": "2016-Feb-11 15:50", "fixed_version": "2016-Feb-11 15:50", "broken_version": "v080500", "priority": "2", "subsystem": "Security", "assigned_to": "tannenba", "derived_from": "#5064", "creator": "zmiller", "rust": "", "customer_group": "cern", "visibility": "public", "notify": "tannenba@cs.wisc.edu, zmiller@cs.wisc.edu", "due_date": "20160215"}