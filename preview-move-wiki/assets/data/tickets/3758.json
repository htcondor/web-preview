{"id": 3758, "title": "Ticket #3758: collector becomes useless if condor view collector is unreachable", "description": "<blockquote>\nDiscussed in the Condor-LIGO call in July 2013.\n\n<p>This just happened again a month later.  The condor view collector IP became unreachable (its server went down), and the Collector lost track of 99% of our pool, in turn causing most of our cores to go idle (it reports ~30 cores of the ~4000 in our pool).  The <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CollectorLog\" title=\"Collector Log\">CollectorLog</a></span> is here: <a class=\"external\" href=\"https://www.dropbox.com/s/ad2xjvjy5jx9d7u/CollectorLog.2013-08-08.gz\">https://www.dropbox.com/s/ad2xjvjy5jx9d7u/CollectorLog.2013-08-08.gz</a></p></blockquote>", "remarks": "<blockquote>\n<em>2013-Aug-09 13:37:56 by tannenba:</em> <br/>\n\nProblem described above occurs when i) updates to the view collector are performed via UDP and 2) the view collector is down when the main collector is first started, or the view collector is down so long that the session key expires (i.e. a full day).\n\n<p>Even though the collector code has long used a Timeslice instance ( <code>view_sock_timeslice</code> ) to guard against frequest time-consuming view server reconnect attempts, the problem is the code only safeguarded against reconnects if updating via TCP.  The case of UDP updates blocking the collector when the UDP update needs to use TCP to get a session key was not taken into account.\n\n</p><p>Patch incoming for stable series...\n\n</p><p><strong>CODE REVIEW</strong>  Zach Miller reviewed and approved of my incoming patch.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-14 11:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/abdcebc65d632dc0164ff1a6e5dfb181d54c4541\">[37215]</a></span>: minor 8.0.2 version history item edit ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3758\" onclick=\"get_ticket_and_populate_wrapper('3758'); return false;\" title=\"collector becomes useless if condor view collector is unreachable\">#3758</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-09 13:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/49feb59a31daf98903ba2d731fc2d91d2f854c71\">[37153]</a></span>: Fix bug where collector can hang if condor_view_host dies. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3758\" onclick=\"get_ticket_and_populate_wrapper('3758'); return false;\" title=\"collector becomes useless if condor view collector is unreachable\">#3758</a></span>  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Jan-28 13:44", "status": "resolved", "created": "2013-Jul-09 16:24", "fixed_version": "2013-Jul-09 16:24", "broken_version": "v070800", "priority": "5", "subsystem": "DaemonsCM", "assigned_to": "tannenba", "derived_from": "", "creator": "pfc", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pfcouvar@syr.edu,pcouvare@caltech.edu", "due_date": ""}