{"id": 5854, "title": "Ticket #5854: dprintf_failure.SCHEDD file created if MAIL doesn't exist.", "description": "<blockquote>\nThe schedd fork()s and closes all of its FDs -- including those used by dprintf (without telling it) and then calls dprintf() if the execve() fails.  We probably should have checked to make sure MAIL exists and is executable first, and we should certainly have let dprintf() know not to use its FDs.  Or maybe we should just not attempt to log anything for this kind of failure?  I don't know if the dprintf code is expected / can be made to work in this sort of situation.\n\n<p>Initially observed in the V8_5-gt5767-branch branch, but verified to occur in master.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Aug-19 13:41:44 by tlmiller:</em> <br/>\n\nThe function email_open_implementation() in condor_utils/email.cpp (line 323) doesn't use DaemonCore::Create_Process() and maybe should.\n\n<p>The EXCEPT() that causes the dprint_failure.SCHEDD to file to be created is on line 448.\n\n</p><p></p><hr/>\n<em>2016-Aug-25 16:45:44 by jfrey:</em> <br/>\n\nI'd say email_open() should be changed to use my_popen(). It deals appropriately with dprintf()/EXCEPT(). It can return a FILE* for stdin and there's a variant where you can supply an environment for the child process.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-08 16:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7e0735d4553d0208fda4f0e061d5ca54002943fe\">[49151]</a></span>: Docs for dprintf_failure.SCHEDD email bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5854\" onclick=\"get_ticket_and_populate_wrapper('5854'); return false;\" title=\"dprintf_failure.SCHEDD file created if MAIL doesn't exist.\">#5854</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Aug-26 15:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7e9cda3d7fc8b8c0507b95c2582f093164729aa4\">[49086]</a></span>: email_open() and friends now use my_popen() on unix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5854\" onclick=\"get_ticket_and_populate_wrapper('5854'); return false;\" title=\"dprintf_failure.SCHEDD file created if MAIL doesn't exist.\">#5854</a></span> These functions used to have their own manual form of my_popen(). One problem was that they could try to write to the daemon log after closing the fd, resulting in a dprintf_failure.&lt;SUBSYS&gt; file. Now they use my_popen(), removing mostly-redundant\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Sep-08 16:01", "status": "resolved", "created": "2016-Aug-19 13:30", "fixed_version": "2016-Aug-19 13:30", "broken_version": "v080506", "priority": "4", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}