{"id": 5747, "title": "Ticket #5747: Blahp escapes double-quotes to arguments", "description": "<blockquote>\nHTCondor's blahp adds escaped double-quotes to the executable arguments, causing jobs to fail. For example, here's a snippet from Slurm submit script generated by an HTCondor-CE-Bosco:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">/home/bosco/bosco/sandbox/dcf4/dcf40857/fermicloud012.fnal.gov_9619_fermicloud012.fnal.gov#60.0#1466703381/condor_exec.exe \"-e\\\" \\\"foo\\\" \\\"bar\\\" \\\"baz\"\n</pre></div>\n\n\n<p>And here's a snippet from a HTCondor-CE/Slurm setup using the OSG's blahp:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">/var/lib/condor-ce/spool/43/0/cluster43.proc0.subproc0/echo \"-e\" \"foo\" \"bar\" \"baz\"\n</pre></div>\n\n\n<p>This does not appear to be a difference in the blahp scripts and I didn't notice any obvious differences that would cause this in server.c.\n{endcode}</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Jun-29 15:56:37 by bbockelm:</em> <br/>\n\nThere's a patch for this that I did in the OSG blahp; ping me when you get back from vacation and we can go git history diving.\n\n<p></p><hr/>\n<em>2016-Jul-05 15:27:20 by blin:</em> <br/>\n\nBrianB believes that this commit was the OSG's solution to escaped double quotes in the arguments:\n\n<p><a class=\"external\" href=\"https://github.com/osg-bosco/BLAH/commit/6c08440dcc2a2f61916488e6c5144258c59e07d3\">https://github.com/osg-bosco/BLAH/commit/6c08440dcc2a2f61916488e6c5144258c59e07d3</a>\n\n</p><p></p><hr/>\n<em>2016-Jul-06 14:29:16 by jfrey:</em> <br/>\n\nIf I apply this patch to our blahp, then all arguments are enclosed in double quotes that the application sees.\n\n<p></p><hr/>\n<em>2016-Jul-06 14:34:31 by jfrey:</em> <br/>\n\nIn a related problem, if the HTCondor submit file uses the old arguments syntax, then any single quotes in the arguments causes the blahp submission to fail. The blahp slaps single quotes around the entire arguments string, which wordexp() doesn't like.\n\n<p></p><hr/>\n<em>2016-Jul-06 15:29:46 by jfrey:</em> <br/>\n\nSome more problems with the patch applied:\n\n<p></p><ul>\n<li>Spaces that should be part of an argument end up as argument separators.\n</li><li>Single quotes that should be part of an argument vanish.\n</li></ul>\n\n<p>There are probably equivalent problems without the patch.\n\n</p><p>I used the following example from the HTCondor Manual:\n</p><div class=\"code\">\n<pre class=\"code\">arguments = \"one \"\"two\"\" 'spacey ''quoted'' argument'\"\n</pre></div>\n\n\n<p></p><hr/>\n<em>2016-Jul-07 14:14:38 by jfrey:</em> <br/>\n\nThe OSG's blahp doesn't exhibit the problems I'm seeing. I'm guessing that's due to it being based on a newer version of the blahp code.\n\n<p>I think I have a fix for the UW build's blahp. I need to run a few more tests, though.\n\n</p><p></p><hr/>\n<em>2016-Aug-15 16:28:17 by blin:</em> <br/>\n\nAny word on how those tests turned out, Jaime?\n\n<p></p><hr/>\n<em>2016-Aug-16 08:31:48 by jfrey:</em> <br/>\n\nThe checkin I made for this ticket fixes most of the quoting problems. It'll be part of 8.5.7.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-08 16:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49155\">[49155]</a></span>: Docs for improving argument escaping in the blahp. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5747\" onclick=\"get_ticket_and_populate_wrapper('5747'); return false;\" title=\"Blahp escapes double-quotes to arguments\">#5747</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jul-08 15:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48755\">[48755]</a></span>: Fix blahp's handling of job arguments in new HTCondor syntax. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5747\" onclick=\"get_ticket_and_populate_wrapper('5747'); return false;\" title=\"Blahp escapes double-quotes to arguments\">#5747</a></span> These patches fix the most prominent issues with how the blahp handles the Arguments job attribute. Some issues remain, but we may wait until we update to the latest blahp code to deal with those.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Sep-08 16:25", "status": "resolved", "created": "2016-Jun-23 13:08", "fixed_version": "2016-Jun-23 13:08", "broken_version": "", "priority": "2", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "#5045", "creator": "blin", "rust": "", "customer_group": "other", "visibility": "public", "notify": "blin@cs.wisc.edu dweitzel@unl.edu", "due_date": ""}