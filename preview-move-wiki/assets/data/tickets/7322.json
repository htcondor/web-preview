{"id": 7322, "title": "Ticket #7322: Container Port Forwarding", "description": "<blockquote>\nAllow users to specify that some host port must forward to a particular container port.\n\n<p><a href=\"design\">doc https://docs.google.com/document/d/1laIjAizeO3HxWYea0k73NaDqZS2MVAS84DrV7Vj04NY</a></p></blockquote>", "remarks": "<blockquote>\n<em>2019-Oct-17 17:11:57 by tlmiller:</em> <br/>\n\nShould probably worry about the potential memory leak FIXME.  Should fix up networking on my Docker host and actually test the port forwarding.  Compare current implementation to design doc and consider addressing the differences.\n\n<p></p><hr/>\n<em>2019-Nov-11 10:45:49 by tannenba:</em> <br/>\n\nOn commit msg <span class=\"chng\"><a href=\"chngview?cn=58197\">[58197]</a></span>, what does \"Tracking commit\" mean?\n\n<p>What does commit <span class=\"chng\"><a href=\"chngview?cn=58337\">[58337]</a></span> have to do with this ticket? Shouldn't this be a different ticket?\n\n</p><p>Thanks\n\n</p><p></p><hr/>\n<em>2019-Nov-11 12:38:47 by tlmiller:</em> <br/>\n\n<div class=\"code\">\n<pre class=\"code\">&gt; On commit msg [58197], what does \"Tracking commit\" mean?\n\nThat the changes were not \"complete\" in some sense, but for whatever reason, I wanted them in version control anyway.  In this case, the changes were basically complete, but I hadn't been able to test them on the machine they were developed on, so I made a commit to aid transfer and in expectation of further changes.\n\n&gt; What does commit [58337] have to do with this ticket? Shouldn't this be a\n&gt; different ticket?\n\nIt didn't seem worth the trouble of writing a new ticket for a code clarification.  (It was coded wrong, but as I noted, the mistakes was not having any actual effect.)\n\n</pre></div>\n\n\n<p></p><hr/>\n<em>2019-Nov-12 11:17:06 by tlmiller:</em> <br/>\n\nDocker port forwarding verified to work on Dumbo.  Merged master again, checking for a clean build.\n\n<p></p><hr/>\n<em>2019-Nov-12 11:20:42 by tlmiller:</em> <br/>\n\n<ul>\n<li>Should still investigate the potential memory leak.\n</li><li>Need to think about if the job should go on hold if the port-forwarding specification is incomplete.\n</li></ul>\n\n<p></p><hr/>\n<em>2019-Nov-12 16:17:10 by tlmiller:</em> <br/>\n\nTest run <a class=\"external\" href=\"http://submit-3.batlab.org/results/run-details.php?runid=489026\">http://submit-3.batlab.org/results/run-details.php?runid=489026</a> looks good.\n\n<p>GregT points out that we need to remove the port forwarding information from the job ad when the starter exits; it will either be confusing (while the job isn't running) or stale (after it restarts somewhere else, but before the job ad in the schedd gets updated).\n\n</p><p>That will be a priority for this ticket (8.9.5 release), but reporting an error all the way back to the user if the port-forwarding attributes in their job ad aren't right is now follow-up ticket <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=7375\" onclick=\"get_ticket_and_populate_wrapper('7375'); return false;\" title=\"Jobs with malformed port-forwarding attributes should go on hold\">#7375</a></span>.\n\n</p><p>I also still need to review for the possible memory leak.\n\n</p><p></p><hr/>\n<em>2019-Nov-13 14:35:23 by tlmiller:</em> <br/>\n\nPotentially-leaking code reviewed and found to be dry.\n\n<p></p><hr/>\n<em>2019-Nov-16 19:25:16 by tlmiller:</em> <br/>\n\nDon't forget to add the submit file commands at some point.\n\n<p></p><hr/>\n<em>2019-Nov-18 11:04:47 by tlmiller:</em> <br/>\n\n.. still need to add submit commands.\n\n<p></p><hr/>\n<em>2019-Nov-20 15:46:49 by tlmiller:</em> <br/>\n\nDocs pending test run, ID 490076.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=7375\" onclick=\"get_ticket_and_populate_wrapper('7375'); return false;\" title=\"Jobs with malformed port-forwarding attributes should go on hold\">#7375</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nJobs with malformed port-forwarding attributes should go on hold</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Nov-21 12:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58532\">[58532]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7322\" onclick=\"get_ticket_and_populate_wrapper('7322'); return false;\" title=\"Container Port Forwarding\">#7322</a></span>) Coverity found a real bug! (Check to see if the dynamically-casted pointer is NULL, not if the original has spontaneously been NULLed out.)  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Nov-21 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58529\">[58529]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7322\" onclick=\"get_ticket_and_populate_wrapper('7322'); return false;\" title=\"Container Port Forwarding\">#7322</a></span>) Documentation and release note.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Nov-20 15:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58522\">[58522]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7322\" onclick=\"get_ticket_and_populate_wrapper('7322'); return false;\" title=\"Container Port Forwarding\">#7322</a></span>) Add container_service_names and &lt;name&gt;_container_port submit commands.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Nov-18 11:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58493\">[58493]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7322\" onclick=\"get_ticket_and_populate_wrapper('7322'); return false;\" title=\"Container Port Forwarding\">#7322</a></span>) Set the host ports to undefined when the container terminates.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Nov-13 14:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58449\">[58449]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7322\" onclick=\"get_ticket_and_populate_wrapper('7322'); return false;\" title=\"Container Port Forwarding\">#7322</a></span>) TJ and I both think this code won't leak.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Nov-03 21:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58338\">[58338]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7322\" onclick=\"get_ticket_and_populate_wrapper('7322'); return false;\" title=\"Container Port Forwarding\">#7322</a></span>) Fix Windows builds (again). Remove a bunch of dead code.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Nov-03 17:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58337\">[58337]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7322\" onclick=\"get_ticket_and_populate_wrapper('7322'); return false;\" title=\"Container Port Forwarding\">#7322</a></span>) Fix bug where we were trying (but failing) to write ToE tags for non-job processes.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Nov-03 16:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58336\">[58336]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7322\" onclick=\"get_ticket_and_populate_wrapper('7322'); return false;\" title=\"Container Port Forwarding\">#7322</a></span>) Fix Windows build.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-17 17:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58197\">[58197]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7322\" onclick=\"get_ticket_and_populate_wrapper('7322'); return false;\" title=\"Container Port Forwarding\">#7322</a></span>) Allow users to specify ports in the container to forward from the host. Tracking commit.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Nov-21 12:46", "status": "resolved", "created": "2019-Oct-12 20:56", "fixed_version": "2019-Oct-12 20:56", "broken_version": "", "priority": "3", "subsystem": "DaemonsExecNode", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}