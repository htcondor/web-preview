{"id": 544, "title": "Ticket #544: Allow all the Condor daemons to the traverse the Windows Firewall", "description": "<blockquote>\nHave each Condor daemon register with the Windows Firewall.  This will make it easier for administrators, as they will no longer need to open global port ranges on each Windows machine that has the Windows Firewall enabled.\n\n<p>New implementation: The Condor Master will check if the Windows Firewall is enabled and keep a record of its state (possibly updated at some interval?).  Then, calls to <code>Create_Process()</code>, with a priv state of either <code>condor</code> or <code>root</code>, will be added to the Windows Firewall as a \"safe\" application.\nThe <code>Create_Process()</code> call will take the following steps:\n</p><ol>\n<li>Check that we are at the correct priv state; if we are not, then we are done;\n</li><li>Check that we are a daemon; if we're not, then we're done;\n</li><li>Do a quick local table look-up to see if we have already added this application; if so, we're done;\n</li><li>Otherwise, the daemon doing the executing will ping the Master and ask if the Windows Firewall is enabled (and cache the results); if it is not on, we're done;\n</li><li>If the Windows Firewall is on, then request that the given executable be added to the Firewall's exception list.</li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2009-Jun-05 13:38:08 by tannenba:</em> <br/>\n\na) why was this ticket initially entered as private?\n\n<p>b) why is the already-released default behavior of the master telling the Windows firewall to allow Condor daemons insufficient?  From the v7.2.x Condor Manual:\n</p><div class=\"verbatim\">\n<pre>ADD_WINDOWS_FIREWALL_EXCEPTION\n    When set to False, the condor_master will not automatically add Condor to\nthe Windows Firewall list of trusted applications. Such trusted applications can\naccept incoming connections without interference from the firewall. This only\naffects machines running Windows XP SP2 or higher. The default is True.\n</pre></div>\n\n\n<p></p><hr/>\n<em>2009-Jun-09 13:00:51 by tannenba:</em> <br/>\n\nanswers to my own questions above: (a) who knows, i made this public; (b) the problem is that the condor_master fails to register all the required daemons w/ the firewall... for instance, it is missing the gridmanager right now.\n\n<p></p><hr/>\n<em>2009-Jun-09 16:13:25 by tannenba:</em> <br/>\n\nUntil this ticket is resolved in the developer series: To fix the immediate problems in the stable series (like Condor-C on Windows being b0rked), I am just gonna follow suite and push a patch to hard-code into the master to open the firewall for the daemons we are forgetting.\n\n<p></p><hr/>\n<em>2009-Jun-09 16:48:28 by zmiller:</em> <br/>\n\ni did a quick code review, looks fine.\n\n<p></p><hr/>\n<em>2009-Jun-09 17:39:40 by matt:</em> <br/>\n\nA quick thought, you essentially hardcoded the set of programs the master will create exceptions for. Wouldn't it be better to just process the DAEMON_LIST, thus catching cases where HAD is added to the list or HDFS or multiple startds, e.g. STARTD1 STARTD2, are used?\n\n<p></p><hr/>\n<em>2009-Oct-21 15:28:53 by psilord:</em> <br/>\n\nBen Burnett has left the Condor Project. This ticket is being unassigned.\n\n<p></p><hr/>\n<em>2010-Oct-18 15:25:22 by gthain:</em> <br/>\n\nI'm assigning this to TJ.  Note that there's a related problem where the hole in the firewall is interface-specific, and there's no way to specify which interface to poke.  Perhaps it should pay attention to NETWORK_INTERFACE?  Or default to all if BIND_ALL_INTERFACES is true?\n<hr/>\n<em>2010-Oct-20 15:59:08 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.\n<hr/>\n<em>2011-Jan-27 14:21:33 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 14:49:30 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jun-09 16:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e23c9a06d3426af8e5cbc7dd81458810d5961ede\">[14867]</a></span>: Fix Windows firewall interference w/ some Condor services such as Condor-C. The bug was not all Condor daemons were being registered as trusted to the Windows firewall by the master. This patch to the stable series adds the ones that were missing, and simplifies the code path a bit. (<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=544\" onclick=\"get_ticket_and_populate_wrapper('544'); return false;\" title=\"Allow all the Condor daemons to the traverse the Windows Firewall\">#544</a></span>)  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jun-09 16:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1d8008201c9cf547e9ddf03ad0e86951d1c9e4a9\">[14868]</a></span>: Fix Windows firewall interference w/ some Condor services such as Condor-C. The bug was not all Condor daemons were being registered as trusted to the Windows firewall by the master. This patch to the stable series adds the ones that were missing, and simplifies the code path a bit. (<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=544\" onclick=\"get_ticket_and_populate_wrapper('544'); return false;\" title=\"Allow all the Condor daemons to the traverse the Windows Firewall\">#544</a></span>)  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Jan-28 15:39", "status": "new", "created": "2009-Jun-05 12:14", "fixed_version": "2009-Jun-05 12:14", "broken_version": "v070300", "priority": "5", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "burnett", "rust": "a19367", "customer_group": "other", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}