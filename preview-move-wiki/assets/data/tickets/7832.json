{"id": 7832, "title": "Ticket #7832: condor_annex -check-setup ignoring -aws-region flag?", "description": "<blockquote>\nThe check-setup command of condor_annex was never updated to handle multiple regions.  Additionally, the setup command was not setting the default region.  I decided that setup command should set the default region if it weren't already set by the configuration, so that\n\n<p></p><div class=\"term\">\n<pre class=\"term\">$ condor_annex -aws-region us-east-2 -setup\n$ condor_annex -check-setup\n</pre></div>\n\n\n<p>would work properly, but not change the user's default region if they setup more than one.\n\n</p><p></p><hr/>\n<em>original description</em>\n\n<p>A user reports that condor_annex -check-setup was failing because it couldn't find the configuration bucket:\n\n</p><p></p><div class=\"verbatim\">\n<pre>$ condor_annex -aws-region us-west-2 -setup ~/.condor/publicKeyFile\n$ condor_annex -check-setup\n</pre></div>\n\n\n<p>Adding '-aws-region us-west-2' to the second line didn't solve the problem.\n\n</p><p>The user was able to successfully check their set-up when not specifying the AWS region at all, so the problem is likely that -check-setup is ignoring ANNEX_DEFAULT_AWS_REGION and/or the -aws-region flag (since the user had ANNEX_DEFAULT_AWS_REGION set to 'us-west-2' in their user_config file) and the user implicitly confirmed that the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CloudFormation\" title=\"Cloud Formation\">CloudFormation</a></span> stacks were created in us-west-2.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Sep-01 12:59:12 by tlmiller:</em> <br/>\n\n<div class=\"term\">\n<pre class=\"term\">$ condor_annex -aws-region us-west-2 -setup\nCreating configuration bucket (this takes less than a minute).. complete.\nCreating Lambda functions (this takes about a minute).. complete.\nCreating instance profile (this takes about two minutes).. complete.\nCreating security group (this takes less than a minute).. complete.\nSetup successful.\n\n$ condor_annex -check-setup\nYour setup is incomplete:\n        ANNEX_DEFAULT_ACCESS_KEY_FILE is unset.\n        ANNEX_DEFAULT_SECRET_KEY_FILE is unset.\n        ANNEX_DEFAULT_S3_BUCKET is unset.\n        ANNEX_DEFAULT_ODI_SECURITY_GROUP_IDS is unset.\n        ANNEX_DEFAULT_ODI_LEASE_FUNCTION_ARN is unset.\n        ANNEX_DEFAULT_SFR_LEASE_FUNCTION_ARN is unset.\n        ANNEX_DEFAULT_ODI_INSTANCE_PROFILE_ARN is unset.\nSecret key file must be accessible only by owner.  Please verify that your user owns the file and that the file permissons are restricted to the owner.\n</pre></div>\n\n\n<p>Adding\n</p><div class=\"snip\">\n<pre class=\"sniplabel\">~/.condor/user_config </pre>\n<pre class=\"snip\">ANNEX_DEFAULT_AWS_REGION = us-west-2\n</pre></div>\n\n\n<p>reproduced the user's problem.\n\n</p><p></p><hr/>\n<em>2020-Sep-01 13:07:33 by tlmiller:</em> <br/>\n\nShould we set ANNEX_DEFAULT_AWS_REGION when -setup is executed with a -aws-region flag?  Even if it's already set?\n\n<p></p><hr/>\n<em>2020-Sep-03 17:14:15 by tlmiller:</em> <br/>\n\nYes and no, respectively.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-03 17:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61222\">[61222]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7832\" onclick=\"get_ticket_and_populate_wrapper('7832'); return false;\" title=\"condor_annex -check-setup ignoring -aws-region flag?\">#7832</a></span>) Release note.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-03 17:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61221\">[61221]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7832\" onclick=\"get_ticket_and_populate_wrapper('7832'); return false;\" title=\"condor_annex -check-setup ignoring -aws-region flag?\">#7832</a></span>) condor_annex -setup should ANNEX_DEFAULT_AWS_REGION if it isn't set already.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-03 17:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61220\">[61220]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7832\" onclick=\"get_ticket_and_populate_wrapper('7832'); return false;\" title=\"condor_annex -check-setup ignoring -aws-region flag?\">#7832</a></span>) Add param_defined_by_config().  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-03 17:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61216\">[61216]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7832\" onclick=\"get_ticket_and_populate_wrapper('7832'); return false;\" title=\"condor_annex -check-setup ignoring -aws-region flag?\">#7832</a></span>) condor_annex -setup should ANNEX_DEFAULT_AWS_REGION if it isn't set already.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-03 17:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61215\">[61215]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7832\" onclick=\"get_ticket_and_populate_wrapper('7832'); return false;\" title=\"condor_annex -check-setup ignoring -aws-region flag?\">#7832</a></span>) Add param_defined_by_config().  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-01 16:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61185\">[61185]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7832\" onclick=\"get_ticket_and_populate_wrapper('7832'); return false;\" title=\"condor_annex -check-setup ignoring -aws-region flag?\">#7832</a></span>) condor_annex -check-setup now respects -aws-region and ANNEX_DEFAULT_AWS_REGION. Committer: Tim Theisen  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-01 13:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61182\">[61182]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7832\" onclick=\"get_ticket_and_populate_wrapper('7832'); return false;\" title=\"condor_annex -check-setup ignoring -aws-region flag?\">#7832</a></span>) condor_annex -check-setup now respects -aws-region and ANNEX_DEFAULT_AWS_REGION.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Sep-23 10:29", "status": "resolved", "created": "2020-Aug-31 20:23", "fixed_version": "2020-Aug-31 20:23", "broken_version": "", "priority": "3", "subsystem": "Annex", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}