{"id": 3336, "title": "Ticket #3336: Networking not fully started before HTCondor startup.", "description": "<blockquote>\nIt looks like on exec-7 (and possibly on the Debian 6 machine, see below),\n<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NetworkManager\" title=\"Network Manager\">NetworkManager</a></span> is forking into the background before it actually configures\nthe network (see logs below).  I don't know if this is because it's horribly\nbroken (probable) or if there's something wrong with our switches, where\nthey don't turn their ports on \"fast enough\" -- it takes\nthree seconds for the link to come up, and another second for DHCP, but\nCondor starts two seconds after <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=NetworkManager\" title=\"Network Manager\">NetworkManager</a></span> tries to bring the device up.\n\n<p>NTPd has a similar problem, but works around it; see below.\n\n</p><p>(I ran into this problem on the Debian 6 VM I installed for run-as-root\ntesting, and added a 'sleep 5' to the condor initscript to work around it;\nI didn't do any more analysis.)\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">--------------------------------------------------------------------------------\n\n11/16/12 01:11:46 Sent SIGHUP to STARTD (pid 15213)\n11/16/12 01:49:35 Enumerating interfaces: lo 127.0.0.1 up\n11/16/12 01:49:35 Setting maximum accepts per cycle 8.\n11/16/12 01:49:35 ******************************************************\n11/16/12 01:49:35 ** condor_master (CONDOR_MASTER) STARTING UP\n11/16/12 01:49:35 ** /usr/sbin/condor_master\n11/16/12 01:49:35 ** SubsystemInfo: name=MASTER type=MASTER(2) class=DAEMON(1)\n11/16/12 01:49:35 ** Configuration: subsystem:MASTER local:&lt;NONE&gt; class:DAEMON\n11/16/12 01:49:35 ** $CondorVersion: 7.9.1 Oct 15 2012 BuildID: 70216 $\n11/16/12 01:49:35 ** $CondorPlatform: x86_64_rhap_6.3 $\n11/16/12 01:49:35 ** PID = 1892\n11/16/12 01:49:35 ** Log last touched 11/16 01:46:21\n11/16/12 01:49:35 ******************************************************\n11/16/12 01:49:35 Using config source: /etc/condor/condor_config\n11/16/12 01:49:35 Using local config sources:\n11/16/12 01:49:35    /etc/condor/config.d/batlab-exec.conf\n11/16/12 01:49:35    /etc/condor/config.d/batlab-hawkeye.conf\n11/16/12 01:49:35    /etc/condor/config.d/batlab-slot_dirs.conf\n11/16/12 01:49:35    /etc/condor/config.d/batlab-slot_users.conf\n11/16/12 01:49:35    /etc/condor/condor_config.local\n11/16/12 01:49:35 DaemonCore: command socket at &lt;127.0.0.1:9686&gt;\n11/16/12 01:49:35 DaemonCore: private command socket at &lt;127.0.0.1:9686&gt;\n11/16/12 01:49:35 WARNING: Condor is running on the loopback address (127.0.0.1)\n\nNov 16 01:49:33 exec-7 NetworkManager[1560]: &lt;info&gt; (em1): bringing up device.\n...\nNov 16 01:49:33 exec-7 kernel: [   42.776370] ADDRCONF(NETDEV_UP): em1: link is not ready\n...\nNov 16 01:49:36 exec-7 systemd[1]: Startup finished in 1s 780ms 249us (kernel) + 29s 872ms 281us (initrd) + 14s 229ms 561us (userspace) = 45s\nNov 16 01:49:36 exec-7 ntpd[1502]: Listen normally on 4 virbr0 192.168.122.1 UDP 123\nNov 16 01:49:36 exec-7 ntpd[1502]: peers refreshed\nNov 16 01:49:36 exec-7 kernel: [   46.173152] bnx2 0000:02:00.0: em1: NIC Copper Link is Up, 1000 Mbps full duplex\nNov 16 01:49:36 exec-7 NetworkManager[1560]: &lt;info&gt; (em1): carrier now ON (device state 20)\nNov 16 01:49:36 exec-7 NetworkManager[1560]: &lt;info&gt; (em1): device state change: unavailable -&gt; disconnected (reason 'carrier-changed') [20 30 40]\nNov 16 01:49:36 exec-7 kernel: [   46.175421] ADDRCONF(NETDEV_CHANGE): em1: link becomes ready\nNov 16 01:49:36 exec-7 NetworkManager[1560]: &lt;info&gt; Auto-activating connection 'System em1'.\nNov 16 01:49:36 exec-7 NetworkManager[1560]: &lt;info&gt; Activation (em1) starting connection 'System em1'\nNov 16 01:49:36 exec-7 NetworkManager[1560]: &lt;info&gt; (em1): device state change: disconnected -&gt; prepare (reason 'none') [30 40 0]\n...\nNov 16 01:49:36 exec-7 NetworkManager[1560]: &lt;info&gt; dhclient started with pid 2085\nNov 16 01:49:37 exec-7 dhclient[2085]: bound to 128.104.103.7 -- renewal in 109465 seconds.\n\n--------------------------------------------------------------------------------\n\nNov 16 01:49:33 exec-7 kernel: [   42.076332] ntpd[1502]: Deferring DNS for ntp1.cs.wisc.edu 1\n...\nNov 16 01:49:34 exec-7 ntpd_intres[1504]: host name not found: ntp1.cs.wisc.edu\n...\nNov 16 01:49:38 exec-7 ntpd_intres[1504]: host name not found: ntp1.cs.wisc.edu\n...\nNov 16 01:49:59 exec-7 ntpd_intres[1504]: DNS ntp1.cs.wisc.edu -&gt; 128.105.39.11\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Nov-26 16:34:43 by tlmiller:</em> <br/>\n\nI spoke with Moate, and it's possible that this is a problem with our networking configuration.  This would be more likely if the host in question were a VM, but it's possible for the problem to occur with physical hardware as well.\n\n<p>I've added him to the notify list so that he can report here, as well.\n\n</p><p></p><hr/>\n<em>2014-Dec-09 16:19:26 by tlmiller:</em> <br/>\n\nTom Downes writes:\n\n<p></p><div class=\"verbatim\">\n<pre>Todd / Condor Team:\n\nI strongly suspect that this problem is a result of Debian's default value\nof allow-hotplug in the /etc/network/interfaces file. I think that causes\nthe boot-time networking startup scripts to allow backgrounding of the dhcp\nclient. The right thing to do is \"auto eth0\" (or \"auto lo eth0 eth#....\").\n\nHard to prove a negative but it works empirically and seems to be what one\nought to expect given the networking script's interpretation of what\nhotplug means.\n\nI would not describe it as the most intuitive consequence of allowing\nhotplugging but there you are.\n</pre></div>\n\n\n<p></p><hr/>\n<em>2014-Dec-09 16:19:47 by tlmiller:</em> <br/>\n\nSee also <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=3506\" onclick=\"get_ticket_and_populate_wrapper('3506'); return false;\" title=\"Master should restart all daemons when network address changes\">#3506</a></span>.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "incident", "last_change": "2014-Dec-09 16:19", "status": "new", "created": "2012-Nov-26 16:31", "fixed_version": "2012-Nov-26 16:31", "broken_version": "", "priority": "5", "subsystem": "Unknown", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "tstclair@redhat.com moate@cs.wisc.edu", "due_date": ""}