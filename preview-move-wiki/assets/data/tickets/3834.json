{"id": 3834, "title": "Ticket #3834: DAG hung at LIGO", "description": "<blockquote>\nSee the \"Socket between submit and execute hosts closed unexpectedly\" emails on the LIGO list, starting July 24, 2013.\n\n<p>Note:  at first glance, I'm not sure whether this is really a DAGMan problem or a problem in some other part of HTCondor.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Aug-07 17:06:35 by wenger:</em> <br/>\n\nOkay, here's the problem:\n\n<p></p><pre>  07/24/13 06:45:45 Number of idle job procs: 22\n  07/24/13 06:45:45 Of 2236 nodes total:\n  07/24/13 06:45:45  Done     Pre   Queued    Post   Ready   Un-Ready   Failed\n  07/24/13 06:45:45   ===     ===      ===     ===     ===        ===      ===\n  07/24/13 06:45:45  1363       0        0       0     250        609       14\n</pre>\n\n<p>Note that 22 jobs procs are supposedly idle when there are no jobs in the queue!!\n\n</p><p>The idle count clearly got goofed up somehow.  I'll try to figure that out, but I'm also thinking that, as a failsafe, when the number of queued jobs hits 0, we should also set the number of idle job procs to 0.  (Note that the idle count is job <strong>procs</strong>, not just jobs, so it is possible for the idle count to be greater than the \"jobs in the queue\" count.)\n\n</p><p></p><hr/>\n<em>2013-Aug-07 17:36:22 by wenger:</em> <br/>\n\nAh, here's the problem:\n\n<p></p><pre>  07/23/13 11:02:17 Number of idle job procs: 16\n  07/23/13 11:02:17 Event: ULOG_JOB_TERMINATED for Condor Node 9565424f3cb7e9e7af84554e3e30f4a1 (3577562.0.0)\n  07/23/13 11:02:17 Number of idle job procs: 16\n  07/23/13 11:02:17 Event: ULOG_SHADOW_EXCEPTION for Condor Node 9565424f3cb7e9e7af84554e3e30f4a1 (3577562.0.0)\n  07/23/13 11:02:17 Number of idle job procs: 17\n</pre>\n\n<p>We get the shadow exception <strong>after</strong> the terminated event, which goofs\nthings up because we still increment the idle count...  So when we get an event that would normally mark a job as idle, we need to make sure the job hasn't already finished!\n\n</p><p></p><hr/>\n<em>2013-Aug-13 10:22:36 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This change looks good.\n\n</p><p></p><hr/>\n<em>2013-Aug-13 13:31:11 by wenger:</em> <br/>\n\nFixes have been merged to V8_0-branch and master, so I'm going to resolve this.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/787/condor_barayoga_20130724.tgz\">condor_barayoga_20130724.tgz</a>\n340578 bytes added by wenger on 2013-Aug-06 20:21:40 UTC.\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-19 09:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37268\">[37268]</a></span>: 8.0.2 version history item edit ===GT=== <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3834\" onclick=\"get_ticket_and_populate_wrapper('3834'); return false;\" title=\"DAG hung at LIGO\">#3834</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-13 13:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37188\">[37188]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=37181\">[37181]</a></span>, Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3834\" onclick=\"get_ticket_and_populate_wrapper('3834'); return false;\" title=\"DAG hung at LIGO\">#3834</a></span>: Fixed conflict in merging to master.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-13 11:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37180\">[37180]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3834\" onclick=\"get_ticket_and_populate_wrapper('3834'); return false;\" title=\"DAG hung at LIGO\">#3834</a></span>: Fixed comments as per code review by Jaime.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-12 17:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=37176\">[37176]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3834\" onclick=\"get_ticket_and_populate_wrapper('3834'); return false;\" title=\"DAG hung at LIGO\">#3834</a></span>: We now make sure a job is queued before changing its idle status and the overall idle count. Also, we do a sanity check to make sure that the idle count is zero when there are no jobs in the queue.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Aug-20 14:34", "status": "defer", "created": "2013-Aug-06 15:20", "fixed_version": "2013-Aug-06 15:20", "broken_version": "v080000", "priority": "5", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "wenger@cs.wisc.edu, pfcouvar@syr.edu,pcouvare@caltech.edu", "due_date": ""}