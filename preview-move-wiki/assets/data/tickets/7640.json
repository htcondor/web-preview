{"id": 7640, "title": "Ticket #7640: net stop condor should not fail because of ALLOW_ADMIN config", "description": "<blockquote>\nThe Windows way to shut down a service is <code>net stop condor</code>.  This will fail if the <code>ALLOW_ADMINISTRATOR</code> configuration does not authorize any user on the local machine to send admin commands to the master.\n\n<p>This is because of this code in the condor_master </p><div class=\"code\">\n<pre class=\"code\">VOID StopService()\n{\n\tif( daemonCore-&gt;Send_Signal(daemonCore-&gt;getpid(), SIGQUIT) ) {\n\t\trunningService=FALSE;\n\t}\n}</pre></div>\n\n\n<p>Send_Signal actually ends up opening a socket and sending a command on Windows, since signals are not a thing.  This command then goes through the whole security layer, so it can fail  <em>even though the origination of the command is known to be authorized</em>\n\n</p><p>There is code in Send_Signal to short circuit and call the signal handler directly when the destination is the current process and the caller is the main thread.  But when the Windows service manager sends notifications, it does not guarantee to use the main thread for them, so the short circuit can be bypassed.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "defect", "last_change": "2020-Nov-09 12:20", "status": "new", "created": "2020-May-12 12:42", "fixed_version": "2020-May-12 12:42", "broken_version": "", "priority": "2", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "users", "visibility": "public", "notify": "", "due_date": ""}