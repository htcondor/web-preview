{"id": 2196, "title": "Ticket #2196: Run same classad daemon hook (hawkeye/cron) once per slot", "description": "<blockquote>\nA user might want to run a classad daemon hook once per slot on a multi-slot startd.  At the moment this requires copying the hook configuration repeatedly, once per slot.  This is a nuisance, creates a possibility of the various copies accidentally diverging.\n\n<p>For example, a user might be using classad daemon hooks to advertise the presence of GPUs.  Each slot should only advertise a single single GPU, so slot 1 advertises GPU ID # 0, slot 2 GPU ID # 1 and so on. You can do this today (see <span class=\"wiki\"><a href=\"wiki?p=HowToManageGpus\" title=\"How To Manage Gpus\">HowToManageGpus</a></span>), but it could be better.\n\n</p><p>Proposal:\n\n</p><p>Add \"STARTD_CRON_&lt;HOOK NAME&gt;_SLOTS_INDIVIDUALLY\" to the configuration.  Boolean, defaults FALSE.  If TRUE, the hook will be executed once for each slot available (or once for each slot named in \"STARTD_CRON_&lt;HOOK NAME&gt;_SLOTS\" if present).  Each slot will advertise the output only for the instantiation associated with it.\n\n</p><p>Of course, the hook will need to know which slot it is reporting for.  Since hooks are highly Condor specific anyway, put the slot number in an environment variable named \"SLOT_ID\".\n\n</p><p><span class=\"subsection\"></span></p><h3>Before </h3>\n\n<p>This only works for machines with up to 4 GPUs.  For machines with more, just keep copying, pasting, and editing.  Be sure to not make any mistakes!\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">STARTD_CRON_JOBLIST = $(STARTD_CRON_JOBLIST) GPUINFO1\nSTARTD_CRON_GPUINFO1_MODE = OneShot\nSTARTD_CRON_GPUINFO1_RECONFIG_RERUN = FALSE\nSTARTD_CRON_GPUINFO1_PREFIX = GPU_\nSTARTD_CRON_GPUINFO1_EXECUTABLE = $(MODULES)/get-gpu-info\nSTARTD_CRON_GPUINFO1_ENV = SLOT_ID=0\nSTARTD_CRON_GPUINFO1_SLOTS = 1\n\nSTARTD_CRON_JOBLIST = $(STARTD_CRON_JOBLIST) GPUINFO2\nSTARTD_CRON_GPUINFO2_MODE = OneShot\nSTARTD_CRON_GPUINFO2_RECONFIG_RERUN = FALSE\nSTARTD_CRON_GPUINFO2_PREFIX = GPU_\nSTARTD_CRON_GPUINFO2_EXECUTABLE = $(MODULES)/get-gpu-info\nSTARTD_CRON_GPUINFO2_ENV = SLOT_ID=1\nSTARTD_CRON_GPUINFO2_SLOTS = 2\n\nSTARTD_CRON_JOBLIST = $(STARTD_CRON_JOBLIST) GPUINFO3\nSTARTD_CRON_GPUINFO3_MODE = OneShot\nSTARTD_CRON_GPUINFO3_RECONFIG_RERUN = FALSE\nSTARTD_CRON_GPUINFO3_PREFIX = GPU_\nSTARTD_CRON_GPUINFO3_EXECUTABLE = $(MODULES)/get-gpu-info\nSTARTD_CRON_GPUINFO3_ENV = SLOT_ID=2\nSTARTD_CRON_GPUINFO3_SLOTS = 3\n\nSTARTD_CRON_JOBLIST = $(STARTD_CRON_JOBLIST) GPUINFO4\nSTARTD_CRON_GPUINFO4_MODE = OneShot\nSTARTD_CRON_GPUINFO4_RECONFIG_RERUN = FALSE\nSTARTD_CRON_GPUINFO4_PREFIX = GPU_\nSTARTD_CRON_GPUINFO4_EXECUTABLE = $(MODULES)/get-gpu-info\nSTARTD_CRON_GPUINFO4_ENV = SLOT_ID=3\nSTARTD_CRON_GPUINFO4_SLOTS = 4\n</pre></div>\n\n\n<p><span class=\"subsection\"></span></p><h3>After </h3>\n\n<p></p><div class=\"code\">\n<pre class=\"code\">STARTD_CRON_JOBLIST = $(STARTD_CRON_JOBLIST) GPUINFO\nSTARTD_CRON_GPUINFO_MODE = OneShot\nSTARTD_CRON_GPUINFO_RECONFIG_RERUN = FALSE\nSTARTD_CRON_GPUINFO_PREFIX = GPU_\nSTARTD_CRON_GPUINFO_EXECUTABLE = $(MODULES)/get-gpu-info\nSTARTD_CRON_GPUINFO_SLOTS_INDIVIDUALLY = TRUE\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2011-May-26 16:47", "status": "new", "created": "2011-May-26 16:42", "fixed_version": "2011-May-26 16:42", "broken_version": "v070600", "priority": "4", "subsystem": "Daemons", "assigned_to": "nleroy", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}