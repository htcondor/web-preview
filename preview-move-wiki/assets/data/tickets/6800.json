{"id": 6800, "title": "Ticket #6800: Fix job priority sorting to have a well-defined ordering of jobs", "description": "<blockquote>\nWhen the schedd sorts a user's jobs based on their priority, it actually uses an 8-part sort key of the these job attributes (strongest is first):\n<ul>\n<li><code>PreJobPrio1</code> (higher is better)\n</li><li><code>PreJobPrio2</code> (higher is better)\n</li><li><code>JobPrio</code> (higher is better)\n</li><li><code>PostJobPrio1</code> (higher is better)\n</li><li><code>PostJobPrio2</code> (higher is better)\n</li><li><code>QDate</code> (lower is better)\n</li><li><code>ClusterId</code> (lower is better)\n</li><li><code>ProcId</code> (lower is better)\n</li></ul>\n\n<p>The <code>Pre</code> and <code>Post</code> attributes are undefined by default. When comparing two jobs, if a given <code>Pre</code> or <code>Post</code> attribute is undefined in either job ad, then they are considered equal and the next part of the sort key is examined. This can result in sets of jobs where there's no clear ordering.\n\n</p><p>Consider the following set of jobs:\n<table border=\"1\" cellspacing=\"0\">\n<tbody><tr>\n<td>\nJob ID</td>\n<td>\nPreJobPrio1</td>\n<td>\n<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobPrio\" title=\"Job Prio\">JobPrio</a></span></td>\n</tr>\n\n<tr>\n<td>\n12.0</td>\n<td>\n2</td>\n<td>\n1</td>\n</tr>\n\n<tr>\n<td>\n13.0</td>\n<td>\nUndefined</td>\n<td>\n2</td>\n</tr>\n\n<tr>\n<td>\n14.0</td>\n<td>\n1</td>\n<td>\n3</td>\n</tr>\n\n</tbody></table>\n</p><p>Job 12.0 sorts before 14.0 (both have PreJobPrio1 and 12.0's value is larger). Job 13.0 sorts both before 12.0 and after 14.0 (13.0 doesn't have PreJobPrio1 defined, so <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobPrio\" title=\"Job Prio\">JobPrio</a></span> is used for the sort comparison). There's no clear ordering.\n\n</p><p>The sorting algorithm should be changed so that an undefined attribute is treated as the value <code>0</code>.</p></blockquote>", "remarks": "<blockquote>\n<strong>CODE_REVIEW</strong>: change looks good.\n\n<p>as a side note, we should probably drop one of the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=PreJob\" title=\"Pre Job\">PreJob</a></span> prios and one of the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=PostJob\" title=\"Post Job\">PostJob</a></span> prios.  this is insanely overdesigned....</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-17 15:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d84f5087baee5f2c5e2f9d979e30682d4f90951e\">[55581]</a></span>: Docs for bug fix in sorting jobs in priority order. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6800\" onclick=\"get_ticket_and_populate_wrapper('6800'); return false;\" title=\"Fix job priority sorting to have a well-defined ordering of jobs\">#6800</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-17 10:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4a7143b58dd4ab88ed7ab139993e6326cc11f456\">[55578]</a></span>: Fix job priority sorting to have a well-defined ordering of jobs <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6800\" onclick=\"get_ticket_and_populate_wrapper('6800'); return false;\" title=\"Fix job priority sorting to have a well-defined ordering of jobs\">#6800</a></span> If the (Pre|Post)JobPrio(1|2) attributes are undefined in a job ad, use the value 0 for sorting purposes. The old behavior of skipping these sort keys if undefined in either ad lead to cases where there was no correct sort order.\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2018-Oct-23 09:17", "status": "resolved", "created": "2018-Oct-16 16:06", "fixed_version": "2018-Oct-16 16:06", "broken_version": "", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}