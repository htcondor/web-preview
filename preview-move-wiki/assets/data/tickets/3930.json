{"id": 3930, "title": "Ticket #3930: Allow better specification of DAGMan default/workflow log file path", "description": "<blockquote>\nIn DAGMAN_DEFAULT_NODE_LOG, we should be able to usefully specify something in the <strong>global</strong> config file.  For example,  something like\n\n<p></p><pre>  DAGMAN_DEFAULT_NODE_LOG = $(SPOOL)/$(DAG).$(PROCESS).node_log\n</pre>\n\n<p>and maybe the default should be\n\n</p><p></p><pre>  DAGMAN_DEFAULT_NODE_LOG = $(DAG).$(PROCESS).node_log\n</pre>\n\n<p>That would reduce the chance of log file collisions, which will goof things up...\n\n</p><p>Note:  We should check whether macro substitution <strong>already</strong> works, given that DAGMan uses the daemoncore param code.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Nov-12 13:09:29 by wenger:</em> <br/>\n\nI just tried this, and $(cluster) in the default log file macro doesn't work...\n\n<p></p><hr/>\n<em>2013-Nov-12 13:29:31 by wenger:</em> <br/>\n\n$(spool) <strong>does</strong> work, though.  Although that's not very useful without some kind of way to keep the log files from different runs from colliding.  We probably need at least $(dag) (where that's just the DAG file, not the full path) and maybe something like $(cluster) to be safe...\n\n<p></p><hr/>\n<em>2013-Nov-12 14:32:36 by wenger:</em> <br/>\n\nAs per LIGO phone call today -- if these files end up in the spool directory, will condor_preen eventually garbage collect them?  Need to check about this...\n\n<p></p><hr/>\n<em>2013-Nov-20 14:07:33 by wenger:</em> <br/>\n\nNote: VALID_SPOOL_FILES allows a single \"*\" in each specification, so I guess the workflow log files could go into the spool directory if you're really careful in your VALID_SPOOL_FILES setting and how you structure the file names.  Probably the log directory would be a better place, though, because in that directory files are assumed to be okay, as opposed to the spool directory, where they're assumed to be not okay.\n\n<p></p><hr/>\n<em>2013-Nov-20 17:37:59 by wenger:</em> <br/>\n\nCreated branch V8_1-gittrac_3930-branch for this.\n\n<p></p><hr/>\n<em>2013-Nov-21 12:52:38 by wenger:</em> <br/>\n\nI've started working on this, and I've run into some complications.\n\n<p>First of all, I was hoping to allow something like this:\n\n</p><p></p><pre>  DAGMAN_DEFAULT_NODE_LOG = $(LOG)/$(DAG_FILE).nodes_log\n</pre>\n\n<p>or\n\n</p><p></p><pre>  DAGMAN_DEFAULT_NODE_LOG = $(SPOOL)/$(DAG_FILE).nodes_log\n</pre>\n\n<p>But there are a few problems:\n</p><ul>\n<li>$(SPOOL) probably isn't a great place for the log files, because condor_preen will delete them unless you change its configuration.\n</li><li>$(LOG) does not work in this expression because the command-line argument to condor_dagman sets LOG to \".\".\n</li><li>$(DAG_FILE) gets substituted with \"\" by the param system before DAGMan ever sees it.\n</li></ul>\n\n<p>It turns out you can do $(LOCAL_DIR)/log instead of $(LOG) to stick the files in the log directory, so I guess that's a way to deal with it.\n\n</p><p>As far as the $(DAG_FILE) problem, the main idea I've thought of so far is to use a different character instead of \"$\" -- maybe \"@\".  So you'd get something like this:\n\n</p><p></p><pre>  DAGMAN_DEFAULT_NODE_LOG = $(LOCAL_DIR)/log/@(DAG_FILE).nodes.log\n</pre>\n\n<p>I don't really like this business of having two different symbols for dereferencing the macros, but I also haven't thought of a good alternative so far...\n\n</p><p></p><hr/>\n<em>2013-Nov-22 13:35:44 by wenger:</em> <br/>\n\nJust a note on this -- if condor_preen removes the workflow log during a run, all kinds of problems will result...\n\n<p></p><hr/>\n<em>2013-Nov-25 11:15:54 by wenger:</em> <br/>\n\nAs per Friday's LIGO phone call, I'm going to just go ahead and implement this as I have it now.  I'll also create a derived ticket for possibly cleaning things up, so that we can prioritize that separately.\n\n<p></p><hr/>\n<em>2013-Nov-26 11:35:50 by wenger:</em> <br/>\n\nThis is fixed for 8.1.3, so I'm going to resolve this ticket.  (Also note derived ticket <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=4099\" onclick=\"get_ticket_and_populate_wrapper('4099'); return false;\" title=\"Clean up DAGMan default/workflow log file path implementation\">#4099</a></span>.)</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=4099\" onclick=\"get_ticket_and_populate_wrapper('4099'); return false;\" title=\"Clean up DAGMan default/workflow log file path implementation\">#4099</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nClean up DAGMan default/workflow log file path implementation</td></tr>\n</tbody></table>", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Dec-13 15:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39022\">[39022]</a></span>: edit doc for 8.1.3 change to DAGMAN_DEFAULT_NODE_LOG <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3930\" onclick=\"get_ticket_and_populate_wrapper('3930'); return false;\" title=\"Allow better specification of DAGMan default/workflow log file path\">#3930</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Dec-03 09:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=38909\">[38909]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3930\" onclick=\"get_ticket_and_populate_wrapper('3930'); return false;\" title=\"Allow better specification of DAGMan default/workflow log file path\">#3930</a></span>: Fixed some typos in the manual changes for this ticket. Committer: Karen Miller  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Dec-02 18:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=38903\">[38903]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3930\" onclick=\"get_ticket_and_populate_wrapper('3930'); return false;\" title=\"Allow better specification of DAGMan default/workflow log file path\">#3930</a></span>: Fixed some typos in the manual changes for this ticket.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Nov-26 11:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=38846\">[38846]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3930\" onclick=\"get_ticket_and_populate_wrapper('3930'); return false;\" title=\"Allow better specification of DAGMan default/workflow log file path\">#3930</a></span>: Improvements to documentation.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Nov-25 18:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=38845\">[38845]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3930\" onclick=\"get_ticket_and_populate_wrapper('3930'); return false;\" title=\"Allow better specification of DAGMan default/workflow log file path\">#3930</a></span>: Documented this.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Nov-25 17:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=38844\">[38844]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3930\" onclick=\"get_ticket_and_populate_wrapper('3930'); return false;\" title=\"Allow better specification of DAGMan default/workflow log file path\">#3930</a></span>: Cleaned up code and test (of initial implementation -- may need further cleanup after LIGO tries it).  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Nov-21 13:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=38792\">[38792]</a></span>: Gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=3930\" onclick=\"get_ticket_and_populate_wrapper('3930'); return false;\" title=\"Allow better specification of DAGMan default/workflow log file path\">#3930</a></span>: Initial partial implementation -- I'm not sure if this is exactly how we want to do it (see remarks in ticket). Also no documentation yet.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Nov-26 11:36", "status": "defer", "created": "2013-Sep-17 18:20", "fixed_version": "2013-Sep-17 18:20", "broken_version": "v080003", "priority": "5", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "wenger@cs.wisc.edu, tannenba@cs.wisc.edu, pfcouvar@syr.edu, tpdownes@gravity.phys.uwm.edu,pcouvare@caltech.edu", "due_date": ""}