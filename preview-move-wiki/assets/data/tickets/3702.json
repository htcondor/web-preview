{"id": 3702, "title": "Ticket #3702: Cannot preempt recently started jobs?", "description": "<blockquote>\nThe logic for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3539\" onclick=\"get_ticket_and_populate_wrapper('3539'); return false;\" title=\"change recommended configuration for disabling preemption\">#3539</a></span> looks incorrect.\n\n<p><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RetirementTimeRemaining\" title=\"Retirement Time Remaining\">RetirementTimeRemaining</a></span> is <strong>always</strong> advertised by the starter, regardless of the state.  When the job has just started, this is set to:\n\n</p><p>MAX_JOB_RETIREMENT_TIME - (Job Age)\n\n</p><p>If this attribute is positive, then the job will not be preempted.\n\n</p><p>So, if MAX_JOB_RETIREMENT_TIME is 1 hour, it is not possible to preempt jobs within the first hour of running.\n\n</p><p>Looking at <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3539\" onclick=\"get_ticket_and_populate_wrapper('3539'); return false;\" title=\"change recommended configuration for disabling preemption\">#3539</a></span>, this doesn't seem to be the desired behavior.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Jun-17 15:11:55 by danb:</em> <br/>\n\nHi Brian,\n\n<p>If MAX_JOB_RETIREMENT_TIME is 1 hour, it has always been the case that you could not preempt the job in the first hour of running.  You could preempt the claim during that time, which would allow you to sit in line on the startd until the job finished or the retirement time expired.\n\n</p><p>What has changed is that the negotiator no longer will even let you preempt the claim by default.  This can be overridden by setting NEGOTIATOR_CONSIDER_EARLY_PREEMPTION=True.\n\n</p><p>Are you seeing some broken behavior that does not agree with my statements above?\n\n</p><p>--Dan\n\n</p><p></p><hr/>\n<em>2013-Jun-17 17:02:58 by bbockelm:</em> <br/>\n\nNope - just that it's all very hard to grok.\n\n<p>So, what happens at 1 hour, 1 minute?  The job can be preempted, and then has another hour of MAX JOB RETIREMENT TIME?\n\n</p><p></p><hr/>\n<em>2013-Jun-17 17:14:11 by danb:</em> <br/>\n\nAfter 1 hour, the job may be preempted at any time for the rest of its life.  Perhaps a point of confusion is that <code>MaxJobRetirementTime</code> starts counting from the start of the job, not from the start of preemption.  It is the amount of time a job is promised to be able to run.  <code>MachineMaxVacateTime</code>, on the other hand, starts counting from the moment the job is sent a kill signal.\n\n<p></p><hr/>\n<em>2013-Jun-17 19:54:26 by bbockelm:</em> <br/>\n\nOh.  I guess I never figured that one out.  From the startd policy page:\n\n<p>An expression giving the maximum time in seconds that the startd will wait for the job to finish before kicking it off if it needs to do so. This is evaluated in the context of the job <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>, so it may refer to job attributes as well as machine attributes.\n\n</p><p>Can we improve this?  Maybe \"Jobs will not be preempted if they have been running for less than <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxJobRetirementTime\" title=\"Max Job Retirement Time\">MaxJobRetirementTime</a></span>.\"  To me, \"wait for the job to finish\" implies <strong>after</strong> it has gone into retirement state.\n\n</p><p></p><hr/>\n<em>2013-Jun-18 09:48:36 by danb:</em> <br/>\n\nThanks for pointing that out.  I was not aware of the inconsistencies in the various descriptions of <code>MaxJobRetirementTime</code> in the manual.  Some of them were more misleading than others.  I've checked in an improvement.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jun-18 09:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=36601\">[36601]</a></span>: Improve documentation of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MaxJobRetirementTime\" title=\"Max Job Retirement Time\">MaxJobRetirementTime</a></span>. <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=3702\" onclick=\"get_ticket_and_populate_wrapper('3702'); return false;\" title=\"Cannot preempt recently started jobs?\">#3702</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Jun-18 09:48", "status": "new", "created": "2013-Jun-15 17:33", "fixed_version": "2013-Jun-15 17:33", "broken_version": "v070906", "priority": "4", "subsystem": "DaemonsCM", "assigned_to": "danb", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "", "due_date": ""}