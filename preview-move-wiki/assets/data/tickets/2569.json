{"id": 2569, "title": "Ticket #2569: Submit event not written for spooled jobs when running as root", "description": "<blockquote>\nWhen a job is submitted with a user log and spooled input files to a schedd running as root, the schedd fails to write the submit event to the user log (in the spool directory). The schedd writes to the user log as the job owner. When it writes the submit event, the spool directory (if there is one) is owned by condor, so the write fails.\n\n<p>We can either chown the spool directory just before writing the submit event (at transaction commit time), or write the submit event as condor if the user log is in the spool directory.\n\n</p><p>This wasn't detected in previous changes in how the submit event is logged because testing was done with personal Condors (i.e. non-root).</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Oct-21 14:44:07 by jfrey:</em> <br/>\n\nI've attached a patch for this bug. If the schedd fails to open the user log as the user and the log is in the job's spool directory, the schedd will then try to open the log as user condor.\n\n<p></p><hr/>\n<em>2011-Oct-21 16:17:22 by zmiller:</em> <br/>\n\n<strong>PATCH REVIEWED, LOOKS GOOD</strong></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/483/log_as_condor.patch\">log_as_condor.patch</a>\n1050 bytes added by jfrey on 2011-Oct-21 19:43:05 UTC.\n<br/>\nAllow user logs in the spool directory to be written to as user Condor.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-21 16:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3f95f35e3749f8bca2c45b911fc8905d49a95311\">[27942]</a></span>: Fix typo in previous commit for submit event logging bugfix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2569\" onclick=\"get_ticket_and_populate_wrapper('2569'); return false;\" title=\"Submit event not written for spooled jobs when running as root\">#2569</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-21 16:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7c9b738b2407177f8cd2e3e2bb5c66972118a0e4\">[27941]</a></span>: Submit event not written for spooled jobs when running as root <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2569\" onclick=\"get_ticket_and_populate_wrapper('2569'); return false;\" title=\"Submit event not written for spooled jobs when running as root\">#2569</a></span> When a job's files are first spooled to the schedd, they are owned by the condor user. Since the user log is usually written to as the user, logging of the submit event fails when files are spooled.\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Oct-24 13:06", "status": "resolved", "created": "2011-Oct-21 13:51", "fixed_version": "2011-Oct-21 13:51", "broken_version": "v070600", "priority": "3", "subsystem": "Daemons", "assigned_to": "jfrey", "derived_from": "#1985", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}