{"id": 7488, "title": "Ticket #7488: Dataflow jobs should also check executables and standard input", "description": "<blockquote>\nIn <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7231\" onclick=\"get_ticket_and_populate_wrapper('7231'); return false;\" title=\"Add dataflow jobs to HTCondor\">#7231</a></span> we introduced dataflow jobs to HTCondor, defined as a job with declared input files and output files where the output files are more recent than the inputs. This implies that the job has already been run. When the <code>condor_shadow</code> detects a dataflow job, it has the option of skipping it rather than running it again.\n\n<p>We now want to extend the definition of a dataflow job, so it not only compares the timestamps of input and output files, but also executables and shared libraries.\n\n</p><p>Before we start, an important question for the LIGO team: do we want to compare the executables + shared libraries on the submit machine, or on the execute machines? We're assuming it's on the submit side because we don't know where the jobs are going to land. If you want to compare with files on the execute machines, how are we going to find them? Are they in a shared file system somewhere?</p></blockquote>", "remarks": "<blockquote>\nAfter further thought, any shared libraries would either be part of transfer_input_files, or pre-installed on the execute machines, so we don't need to check them.  We do need to check the standard input, if specified in the job ad.\n\n<p></p><hr/>\n<em>2020-Feb-18 11:36:05 by coatsworth:</em> <br/>\n\nI'm looking through my notes now and seeing a few more requirements for this ticket which are not indicated here. These will make it unlikely to complete in time for the 8.9.6 release. Details as follows:\n\n<p></p><ul>\n<li>Currently, the decision to skip dataflow jobs is controlled by the <code>SHADOW_SKIP_DATAFLOW_JOBS</code> configuration knob. We don't want this to be a system-wide option, rather it should be set in the job submit file. I'll add a new submit attribute called <code>skip_dataflow</code> which defaults to <code>false</code>. This will be called <code>SkipIfDataflow</code> in the job ad.\n\n<p></p></li><li>We also want the job ad to indicate if it was skipped due to being a dataflow job, such that this information appears in <code>condor_history</code>. I'll call this attribute to <code>DataflowJobSkipped</code>, it will have possible values <code>true</code> or <code>false</code>, and will only appear if <code>SkipIfDataflow</code> is set to true.\n\n<p></p></li><li>We want to add a new event that appears in the log, indicating if a dataflow job was skipped. I'll plan to call this <code>ULOG_JOB_DATAFLOW_SKIPPED</code>.\n\n<p></p></li><li>In addition to checking the timestamp of the executable file, we also want to check the timestamp of a standard input file if this was specified.\n\n<p></p></li><li>One final clarification. We're comparing the timestamps of the input files to 1) output files, 2) executable file, 3) standard input file. In order for this to be considered a dataflow job (and hence skipped) do these <strong>all</strong> need to be newer than the input files? Or does it suffice for <strong>any</strong> of them to be newer?\n</li></ul>\n\n<p>Please let me know if I'm confused about any of the above items. Also, as always naming things is a challenge, so if anybody has better suggestions for attribute names feel free to share them here.\n\n</p><p></p><hr/>\n<em>2020-Mar-10 10:17:28 by pfc:</em> <br/>\n\nThe ball is in Condor's court to release in 8.9.7 (ETA mid/late April), then it will be in LIGO's court to test.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-25 14:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59205\">[59205]</a></span>: Added documentation + version history (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7488\" onclick=\"get_ticket_and_populate_wrapper('7488'); return false;\" title=\"Dataflow jobs should also check executables and standard input\">#7488</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-06 14:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59088\">[59088]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=59086\">[59086]</a></span>, Merge master and recent dataflow updates (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7488\" onclick=\"get_ticket_and_populate_wrapper('7488'); return false;\" title=\"Dataflow jobs should also check executables and standard input\">#7488</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-05 11:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59083\">[59083]</a></span>: Impleted correct dataflow logic, job ad updates (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7488\" onclick=\"get_ticket_and_populate_wrapper('7488'); return false;\" title=\"Dataflow jobs should also check executables and standard input\">#7488</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-03 11:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59074\">[59074]</a></span>: Improved dataflow logic, added event plumbing (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7488\" onclick=\"get_ticket_and_populate_wrapper('7488'); return false;\" title=\"Dataflow jobs should also check executables and standard input\">#7488</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-02 11:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59070\">[59070]</a></span>: Added new event type, plumbing for dataflow jobs (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7488\" onclick=\"get_ticket_and_populate_wrapper('7488'); return false;\" title=\"Dataflow jobs should also check executables and standard input\">#7488</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Apr-16 14:47", "status": "resolved", "created": "2020-Feb-03 17:12", "fixed_version": "2020-Feb-03 17:12", "broken_version": "v080906", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "coatsworth", "derived_from": "#7231", "creator": "coatsworth", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "coatsworth@cs.wisc.edu, tannenba@cs.wisc.edu, pcouvare@caltech.edu, sba@caltech.edu", "due_date": ""}