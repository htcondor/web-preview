{"id": 2460, "title": "Ticket #2460: RFE: option to disable prepending of paths to executable", "description": "<blockquote>\nCurrently the condor_starter, in OsProc::StartJob, will always either\nprefix the executable with the working directory or iwd:\n<div class=\"code\">\n<pre class=\"code\">Cmd attribute:\nexec \\ xfer     |     true *   |      false\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\ncmd             | $PWD/cmd     | cmd\n../cmd          | $PWD/../cmd  | ../cmd\n/cmd            | /cmd         | /cmd\n\nStarter execs:\nexec \\ xfer     |     true *   |      false\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\ncmd             | EXECUTE/exec | Iwd/cmd\n../cmd          | EXECUTE/exec | Iwd/../cmd\n/cmd            | EXECUTE/exec | /cmd\n\nEXECUTE is the EXECUTE param plus /dir_PID\n\nIwd is the job's Iwd attribute\n\n* must specify when_to_transfer_output and exec must exist\n</pre></div>\n\n\n<p>An additional option is desired to allow non-absolute paths to remain unmodified (i.e. let the shell/PATH resolve the final path), when <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TransferExecutable\" title=\"Transfer Executable\">TransferExecutable</a></span> is false.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Sep-15 16:40:45 by eje:</em> <br/>\n\nAdded new attribute on job ads:  <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=PreserveRelativeExecutable\" title=\"Preserve Relative Executable\">PreserveRelativeExecutable</a></span>, which defaults to False.   When set to True (and when <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TransferExecutable\" title=\"Transfer Executable\">TransferExecutable</a></span> is False), an executable with a relative path name will be left relative, instead of prepending IWD to it.\n\n<p>Here is the new table of behavior for 'starter', when <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=PreserveRelativeExecutable\" title=\"Preserve Relative Executable\">PreserveRelativeExecutable</a></span> is True.  When it is false (the default) the behavior is backward-compatible.\n</p><div class=\"code\">\n<pre class=\"code\">Starter execs when PreserveRelativeExecutable = True\nexec \\ xfer     |     true *   |      false\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\ncmd             | EXECUTE/exec | cmd\n../cmd          | EXECUTE/exec | ../cmd\n/cmd            | EXECUTE/exec | /cmd\n</pre></div>\n\n\n<p></p><hr/>\n<em>2011-Sep-15 16:52:07 by eje:</em> <br/>\n\nREPRO/TEST:\n\n<p>Requires a user job wrapper to be configured:\n</p><div class=\"code\">\n<pre class=\"code\"># set path to wherever you put the 'wrap' script\nUSER_JOB_WRAPPER = /your/path/to/wrap\n</pre></div>\n\n\n<p>Here is the wrapper script (which should be named 'wrap' to match above)\n</p><div class=\"code\">\n<pre class=\"code\">#!/bin/sh\n\n# Run the command and args, as given.\n# non-qualified commands will be resolved via PATH env\n# e.g. 'sleep' will resolve as /bin/sleep\nexec \"$@\"\n</pre></div>\n\n\n<p>The job submission file:\n</p><div class=\"code\">\n<pre class=\"code\">universe = vanilla\n# cmd is relative:\ncmd = echo\nargs = success\niwd = /tmp\ntransfer_executable = false\nrun_as_owner = true\ngetenv = true\noutput = /tmp/echo.out.$(cluster).$(process)\nerror = /tmp/echo.err.$(cluster).$(process)\n# Enable new feature:\n+PreserveRelativeExecutable = True\nqueue 1\n</pre></div>\n\n\n<p>Before fix/rfe: The job submission above will not work correctly.  The starter will prepend iwd = \"/tmp\" to \"echo\", and you will see this:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\"># submit the job\n$ condor_submit t.jsub\nSubmitting job(s).\n1 job(s) submitted to cluster 8.\n\n# after job runs, 'out' will be empty, because 'echo' did not run:\n$ cat /tmp/echo.out.8.0\n\n# 'err' output shows it could not find bogus \"/tmp/echo\":\n$ more /tmp/echo.err.8.0\n/usr/local/src/condor/repro/bz610265-preserve-rel-exe/wrap: line 6: /tmp/echo: No such file or directory\n/usr/local/src/condor/repro/bz610265-preserve-rel-exe/wrap: line 6: exec: /tmp/echo: cannot execute: No such file or directory\n</pre></div>\n\n\n<p>After the new feature, the job will work as desired:\n</p><div class=\"code\">\n<pre class=\"code\">$ condor_submit t.jsub\nSubmitting job(s).\n1 job(s) submitted to cluster 1.\n\n# the 'out' file has the expected output from echo: 'success'\n$ cat /tmp/echo.out.1.0\nsuccess\n\n# the 'err' file is empty:\n$ cat /tmp/echo.err.1.0\n</pre></div>\n\n\n<p></p><hr/>\n<em>2011-Oct-12 11:38:35 by jfrey:</em> <br/>\n\nI don't like this new feature.\nIts purpose appears to be to allow the PATH to be searched for the job's\nexecutable on the execute machine when not transferring it from the\nsubmit machine.\nBut it requires that the execute machine be using a user job wrapper\nwhich has a sensible PATH set and which invokes the user job in a way\nthat the PATH is searched.\nOtherwise, it doesn't appear to work. And the benefit? The user can give\ntheir executable as 'echo' instead of '/bin/echo'.\n\n<p></p><hr/>\n<em>2011-Oct-17 16:29:31 by eje:</em> <br/>\n\nThe main benefits from requesting customer's POV were\n<ol>\n<li>allow their users to say \"app\" instead of \"/some/very/long/path/to/app\"\n</li><li>enable users to supply their individual PATH (via getenv = true), which I assume lets them customize and/or alter which \"app\" gets run from a submit file by altering PATH, as opposed to editing the submit file itself\n</li></ol>\n\n<p></p><hr/>\n<em>2011-Oct-19 15:16:28 by jfrey:</em> <br/>\n\nYou can get these same benefits using the USER_JOB_WRAPPER (which is already required for this new feature to work correctly):\n<div class=\"code\">\n<pre class=\"code\">#!/bin/sh\ncmd=$1\nshift\nif [ ! -x $cmd ] ; then\n  cmd=`basename $cmd`\nfi\nexec $cmd \"$@\"\n</pre></div>\n\n\n<p></p><hr/>\n<em>2011-Oct-19 15:30:41 by eje:</em> <br/>\n\nI agree this RFE is technically redundant since there are existing ways to achieve the same behavior.\n\n<p>Allowing the executable path to be resolved via PATH and \"getenv = true\" makes things operate more like a traditional shell, where users are accustomed to just invoking a command and letting PATH resolve it.  I gather that is why they made this RFE.\n\n</p><p></p><hr/>\n<em>2011-Oct-19 16:05:10 by eje:</em> <br/>\n\nOne issue with using \"basename\" in the wrapper -- it is less flexible in the sense that it will be applied to user jobs always.  Supporting <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=PreserveRelativeExecutable\" title=\"Preserve Relative Executable\">PreserveRelativeExecutable</a></span> allows other existing behaviors to be invoked or not, as the user prefers.\n\n<p>Matt also pointed out that using \"basename\" requires the admin to be involved to a greater degree with user submissions.\n\n</p><p></p><hr/>\n<em>2011-Oct-19 17:31:16 by jfrey:</em> <br/>\n\nThe admin is already involved; they have to ensure the USER_JOB_WRAPPER is configured on all machines in a way that that PATH is searched for the executable.\n\n<p>In my proposed alternative, the job wrapper could consult an environment variable to decide whether to use basename, which the user could set in their submit file.\n\n</p><p>I'd be happier if this attribute caused the starter to perform the equivalent of execvp() when a user job wrapper isn't configured.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-10 16:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/efafabaf27038ed84dff0c5ed7fd9a9c341dd6f5\">[27765]</a></span>: minor edits ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2460\" onclick=\"get_ticket_and_populate_wrapper('2460'); return false;\" title=\"RFE: option to disable prepending of paths to executable\">#2460</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-15 16:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9e0cdade8bf40948d64711d55703463beeb9839b\">[27236]</a></span>: Added +PreserveRelativeExecutable attribute for job ads to prevent prepending of path info. ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2460\" onclick=\"get_ticket_and_populate_wrapper('2460'); return false;\" title=\"RFE: option to disable prepending of paths to executable\">#2460</a></span>  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-15 16:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3feb6c02461e7182cf4e4e06a2feccebf6872ee6\">[27237]</a></span>: Documentation for job attribute <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=PreserveRelativeExecutable\" title=\"Preserve Relative Executable\">PreserveRelativeExecutable</a></span>. ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2460\" onclick=\"get_ticket_and_populate_wrapper('2460'); return false;\" title=\"RFE: option to disable prepending of paths to executable\">#2460</a></span>  (By Erik Erlandson )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-15 16:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9eccb1a6a84c6c0e16da8decff172ab6f0797686\">[27238]</a></span>: Version history entry for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=PreserveRelativeExecutable\" title=\"Preserve Relative Executable\">PreserveRelativeExecutable</a></span>. ===VersionHistory:Complete=== ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2460\" onclick=\"get_ticket_and_populate_wrapper('2460'); return false;\" title=\"RFE: option to disable prepending of paths to executable\">#2460</a></span>  (By Erik Erlandson )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Jan-10 13:32", "status": "resolved", "created": "2011-Sep-13 11:57", "fixed_version": "2011-Sep-13 11:57", "broken_version": "", "priority": "3", "subsystem": "Daemons", "assigned_to": "jfrey", "derived_from": "", "creator": "eje", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com, eje@cs.wisc.edu", "due_date": ""}