{"id": 575, "title": "Ticket #575: gt2 gahp memory leak at BNL", "description": "<blockquote>\nXin Zhao reports that gahp_server processes on their submit nodes are growing to over 1GB in memory usage. There's no reason for a gahp_server to use this much memory, so this is pretty clearly a memory leak.</blockquote>", "remarks": "<blockquote>\n<em>2009-Jun-17 14:35:30 by jfrey:</em> <br/>\n\nEmail from Xin Zhao:\n\n<p>Also we observe that the memory usage of gahp server increases gradually as time goes by.  Today the gahp server for BNL gridgk04 grew to 1.5G, I killed it and the new restarted gahp process uses &lt; 50MB memory. There are still some other gahp servers that have been running for a while and are consuming a good amount of memory. For example process 2585 on gridui07 is using 1G memory now, it serves a Tier3 site that normally runs &lt;5 jobs.\n\n</p><p></p><hr/>\n<em>2009-Jul-01 15:23:41 by jfrey:</em> <br/>\n\nExtensive valgrinding of the gahp_server has revealed a leak in gsi each time an incoming connection is authenticated. We've opened a bugzilla ticket with Globus: <a class=\"external\" href=\"http://bugzilla.globus.org/bugzilla/show_bug.cgi?id=6787\">http://bugzilla.globus.org/bugzilla/show_bug.cgi?id=6787</a>\n\n<p></p><hr/>\n<em>2009-Jul-01 15:24:38 by jfrey:</em> <br/>\n\nWe have found and fixed a couple minor memory leaks due to using an old version of the Globus gass server library.\n\n<p></p><hr/>\n<em>2009-Jul-30 18:57:52 by jfrey:</em> <br/>\n\nJoe Bester has provided a patch for the memory leak. A quick test with valgrind shows the leak is gone. I've provided a binary to Xin Zhao to try on BNL's machines.\n\n<p></p><hr/>\n<em>2009-Jul-30 18:58:30 by jfrey:</em> <br/>\n\nThe patched gahp_server is here: <a class=\"external\" href=\"ftp://ftp.cs.wisc.edu/condor/temporary/forbnl/2009-07-30/gahp_server\">ftp://ftp.cs.wisc.edu/condor/temporary/forbnl/2009-07-30/gahp_server</a>\n\n<p></p><hr/>\n<em>2009-Aug-03 10:32:11 by jfrey:</em> <br/>\n\nThe BNL submit machines have been using the new gahp_server binary since July 30. So far, the memory leak appears to be gone. The patch is committed to the master branch for the next 7.3 release.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jul-30 18:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/daf4bbbfc3e5293912f351fa29a10c62c861a948\">[15218]</a></span>: Fix gsi memory leak affecting the gahp_server (gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=575\" onclick=\"get_ticket_and_populate_wrapper('575'); return false;\" title=\"gt2 gahp memory leak at BNL\">#575</a></span>)  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Nov-19 11:19", "status": "resolved", "created": "2009-Jun-17 14:34", "fixed_version": "2009-Jun-17 14:34", "broken_version": "", "priority": "4", "subsystem": "Grid", "assigned_to": "xzhao", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "atlas", "visibility": "public", "notify": "", "due_date": ""}