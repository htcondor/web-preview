{"id": 2261, "title": "Ticket #2261: dprintf() not outputting for condor_preen", "description": "<blockquote>\nAccording to documentation condor tools are expected to emit dprintf() log messages to stderr:\n\n<p><a class=\"external\" href=\"http://www.cs.wisc.edu/condor/manual/v7.6/3_3Configuration.html#15993\">http://www.cs.wisc.edu/condor/manual/v7.6/3_3Configuration.html#15993</a>\n\n</p><p>However, dprintf() calls from condor_preen (and other tools?) don't appear to be output anywhere.\n\n</p><p>This can be made extra clear by applying the attached patch \"preen_dprintf_test.patch\", which <strong>should</strong> output:\n</p><div class=\"verbatim\">\n<pre>$ condor_preen\nright before my dprintf test\nEJE: testing dprintf, yo\nright after my dprintf test\n</pre></div>\n\n\n<p>However, it <strong>actually</strong> only outputs this:\n</p><div class=\"verbatim\">\n<pre>$ condor_preen\nright before my dprintf test\nright after my dprintf test\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Jun-21 16:15:14 by jrt:</em> <br/>\n\nIt's missing dprintf_config (\"TOOL\");\n\n<p>and needs config like\n\n</p><p>TOOL_DEBUG = D_ALL\nTOOL_LOG = /var/log/condor/tool.log\n\n</p><p></p><hr/>\n<em>2011-Jun-21 17:15:37 by eje:</em> <br/>\n\nrepro/test:\n\n<p>to repro, invoke condor_preen with no pool running (will cause dprintf() to be invoked in the code)\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\"># With no pool running\n$ condor_preen -debug\nUsage: condor_preen [-mail] [-remove] [-verbose]\n</pre></div>\n\n\n<p>After fix, -debug properly allows dprintf() output to stderr:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\"># With no pool running\n$ condor_preen -debug\n06/21/11 15:09:31 Reading from /proc/cpuinfo\n06/21/11 15:09:31 Found: Physical-IDs:True; Core-IDs:True\n06/21/11 15:09:31 Analyzing 2 processors using IDs...\n06/21/11 15:09:31 Looking at processor #0 (PID:0, CID:0):\n06/21/11 15:09:31 Comparing P#0   and P#1  : pid:0!=0 or  cid:0!=1 (match=No)\n06/21/11 15:09:31 ncpus = 1\n06/21/11 15:09:31 P0: match-&gt;1\n06/21/11 15:09:31 Looking at processor #1 (PID:0, CID:1):\n06/21/11 15:09:31 ncpus = 2\n06/21/11 15:09:31 P1: match-&gt;1\n06/21/11 15:09:31 Using IDs: 2 processors, 2 CPUs, 0 HTs\n06/21/11 15:09:31 Ignoring config file based on LOCAL_CONFIG_DIR_EXCLUDE_REGEXP, '/usr/local/condor/config.d/90.eje.config~'\n06/21/11 15:09:31 Will use UDP to update collector localhost.localdomain &lt;127.0.0.1:9618&gt;\n06/21/11 15:09:31 Will use UDP to update collector rorschach.localdomain &lt;127.0.0.1:9618&gt;\n06/21/11 15:09:31 Trying to query collector &lt;127.0.0.1:9618&gt;\n06/21/11 15:09:31 attempt to connect to &lt;127.0.0.1:9618&gt; failed: Connection refused (connect errno = 111).\n06/21/11 15:09:31 Trying to query collector &lt;127.0.0.1:9618&gt;\n06/21/11 15:09:31 attempt to connect to &lt;127.0.0.1:9618&gt; failed: Connection refused (connect errno = 111).\n06/21/11 15:09:31 Can't find address of local queue manager\n06/21/11 15:09:31 Not cleaning spool directory: Can't contact schedd\n06/21/11 15:09:31 Will use UDP to update collector localhost.localdomain &lt;127.0.0.1:9618&gt;\n06/21/11 15:09:31 Will use UDP to update collector rorschach.localdomain &lt;127.0.0.1:9618&gt;\n06/21/11 15:09:31 Trying to query collector &lt;127.0.0.1:9618&gt;\n06/21/11 15:09:31 attempt to connect to &lt;127.0.0.1:9618&gt; failed: Connection refused (connect errno = 111).\n06/21/11 15:09:31 Trying to query collector &lt;127.0.0.1:9618&gt;\n06/21/11 15:09:31 attempt to connect to &lt;127.0.0.1:9618&gt; failed: Connection refused (connect errno = 111).\n06/21/11 15:09:31 Can't find local startd address.\n06/21/11 15:09:31 Error getting startd state, not cleaning execute directory.\n06/21/11 15:09:31 Can't open directory \"/usr/local/condor/local/log/daemon_sock\" as PRIV_UNKNOWN, errno: 2 (No such file or directory)\n</pre></div>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2060\" onclick=\"get_ticket_and_populate_wrapper('2060'); return false;\" title=\"Enhance condor_preen output\">#2060</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nEnhance condor_preen output</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/385/gt2261-preen-dprintf.patch\">gt2261-preen-dprintf.patch</a>\n410 bytes added by eje on 2011-Jun-21 22:11:26 UTC.\n<br/>\nPatch to enable condor_preen to adhere to convention that -debug causes dprintf() logging to stderr.\n<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jun-21 17:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3a2a79b3f2268451faac56c3e4d928bcbaa9f48e\">[22251]</a></span>: ===VersionHistory=== condor_preen now properly respects the convention that -debug causes dprintf() logging to stderr. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2261\" onclick=\"get_ticket_and_populate_wrapper('2261'); return false;\" title=\"dprintf() not outputting for condor_preen\">#2261</a></span>  (By Erik Erlandson )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Aug-08 11:41", "status": "resolved", "created": "2011-Jun-21 15:28", "fixed_version": "2011-Jun-21 15:28", "broken_version": "v070600", "priority": "2", "subsystem": "Tools", "assigned_to": "eje", "derived_from": "", "creator": "eje", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu, jthomas@redhat.com, eje@cs.wisc.edu, tstclair@redhat.com", "due_date": ""}