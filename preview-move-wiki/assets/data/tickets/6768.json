{"id": 6768, "title": "Ticket #6768: Changes to defaults for end of 8.7 series", "description": "<blockquote>\nThis ticket is for tracking proposed changes to the default values of configuration parameters before the 8.8 stable series.\n\n<p>Append your ideas below with your name by each item.\n\n</p><p><span class=\"subsection\"></span></p><h3>HTCondor Param Table Changes</h3>\n\n<p>Here are proposed changes that likely just involve settings in the param table.\n\n</p><p></p><ol>\n<li>Incorporate settings from CMS global pool (Jaime) <strong>[Done]</strong>\n<ul>\n<li><div class=\"strike\">\n<strike>=COLLECTOR_MAX_FILE_DESCRIPTORS=81920= (currently 10240)</strike></div>\n Higher limit fails in macOS tests\n</li><li><code>NEGOTIATOR_MAX_TIME_PER_SUBMITTER=60</code> (currently 31536000)\n</li><li><code>NEGOTIATOR_MAX_TIME_PER_PIESPIN=120</code> (currently 31536000)\n</li><li><div class=\"strike\">\n<strike>=NEGOTIATOR_TIMEOUT=5= (currently 30)</strike></div>\n consider for 8.9\n</li><li><code>NEGOTIATOR_MAX_TIME_PER_CYCLE=1200</code> (currently (31536000)\n</li><li><code>NEGOTIATOR_MAX_TIME_PER_SCHEDD=120</code> (currently 31536000)\n</li><li><code>FILE_TRANSFER_DISK_LOAD_THROTTLE=2.0</code> (currently unset)\n</li><li><code>MAX_CONCURRENT_UPLOADS=100</code> (currently 10)\n</li><li><code>MAX_CONCURRENT_DOWNLOADS=100</code> (currently 10)\n</li><li><code>CURB_MATCHMAKING=(ShadowsRunning &gt; .97*$(MAX_JOBS_RUNNING)) ||\n  (<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RecentDaemonCoreDutyCycle\" title=\"Recent Daemon Core Duty Cycle\">RecentDaemonCoreDutyCycle</a></span> &gt; 0.98)</code> (currently unset)\n-- See also <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=5192\" onclick=\"get_ticket_and_populate_wrapper('5192'); return false;\" title=\"Sane defaults for CURB_MATCHMAKING\">#5192</a></span> (group recommends dropping MAX_JOBS_RUNNING portion)\n</li></ul>\n</li><li>Enable negotiator prefetch (Jaime) <strong>[Done]</strong>\n<ul>\n<li><code>NEGOTIATOR_PREFETCH_REQUESTS=TRUE</code>\n</li><li><code>NEGOTIATOR_RESOURCE_REQUEST_LIST_SIZE=200</code>\n</li><li><code>NEGOTIATOR_PREFETCH_REQUESTS_MAX_TIME=60</code>\n</li></ul>\n</li><li>Set <code>SCHEDD_ALLOW_LATE_MATERIALIZE=True</code> (TJ) <strong>[Done]</strong>\n</li><li>Set <code>MOUNT_UNDER_SCRATCH=\"/tmp,/var/tmp\"</code> -- note the double quotes! (ToddT) <strong>[Done]</strong>\n</li><li>Set <code>USE_PID_NAMESPACES=True</code> (ToddT)\n<ul>\n<li>This should be an 8.9 change\n</li></ul>\n</li><li>Set <code>WARN_ON_UNUSED_SUBMIT_FILE_MACROS=True</code> (ToddT) <strong>[Done]</strong>\n</li><li>Set a reasonable default for <code>RESERVED_MEMORY</code>, <code>RESERVED_SWAP</code>, and <code>RESERVED_DISK</code>.  Zero is not a reasonable default. :)  (ToddT)\n<ul>\n<li>RESERVED_DISK=0 is reasonable when EXECUTE is on its own partition\n</li><li>Deferred to 8.9. The group had no idea what a reasonable default would be, and any non-zero default for memory would confuse admins looking at condor_status.\n</li></ul>\n\n<p></p></li><li><div class=\"strike\">\n<strike>Set =MAX_JOBS_RUNNING=MIN({2*$(DETECTED_MEMORY), 10000})= Recent observations show shadow PSS of 500kB (Jaime)</strike></div>\n Committing all of memory to shadows is overly aggressive\n</li><li><div class=\"strike\">\n<strike>Set =SENDMAIL=/usr/sbin/sendmail= (Jaime)</strike></div>\n  ToddT disagrees with this suggestion, since the code calls param_with_full_path() on the value of the SENDMAIL knob\n</li><li>Set <code>HISTORY_HELPER_MAX_CONCURRENCY=50</code>.  Current default is 2.  Why?  The schedd calls Create_Process() to handle this, and the default is to clone, so why such a crazy low limit??? (ToddT) <strong>[Done]</strong>\n</li><li>DAGMan and Scheduler Universe changes (Mark) <strong>[Done]</strong>\n<ul>\n<li><code>DAGMAN_MAX_SUBMITS_PER_INTERVAL=100</code>\n</li><li><code>MAX_RUNNING_SCHEDULER_JOBS_PER_OWNER=200</code>\n</li><li><code>START_SCHEDULER_UNIVERSE=TotalSchedulerJobsRunning &lt; 500</code>\n</li></ul>\n</li><li><div class=\"strike\">\n<strike>=USE_PSS=True= (Jaime)</strike></div>\n -- Group objected to PSS value being reported for job's <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MemoryUsage\" title=\"Memory Usage\">MemoryUsage</a></span>\n</li><li>Reduce default for <code>DEFAULT_JOB_MAX_RETRIES</code> (currently 10) <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6787\" onclick=\"get_ticket_and_populate_wrapper('6787'); return false;\" title=\"Default value for DEFAULT_JOB_MAX_RETRIES too high\">#6787</a></span>\n</li></ol>\n\n<p><span class=\"subsection\"></span></p><h3>Add metaknobs</h3>\n<ol>\n<li><code>StaticSlots(&lt;min_cpus&gt;[,&lt;min_memory&gt;])</code> (TJ)\n<ul>\n<li>Defer to 8.9\n</li></ul>\n</li></ol>\n\n<p><span class=\"subsection\"></span></p><h3>Remove Cruft</h3>\n\n<p></p><ol>\n<li>Get rid of condor_history_helper binary (ToddT) Already done <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6247\" onclick=\"get_ticket_and_populate_wrapper('6247'); return false;\" title=\"Remove History Helper\">#6247</a></span>\n</li><li>Get rid of condor_lease_manager binary and documentation (ToddT) (TimT) <strong>[Done]</strong>\n</li><li>Get rid of all the #pragma messages littering the build output (ToddT) (TJ) <strong>[Done]</strong>\n</li><li>Get rid of stork (TimT) <strong>[Done]</strong>\n</li></ol>\n\n<p><span class=\"subsection\"></span></p><h3>Slightly more involved HTCondor changes</h3>\n\n<p>Here are proposed changes that may involve more than just setting defaults in the param table. These are all deferred to 8.9.\n\n</p><p></p><ol>\n<li>Change <code>ENABLE_USERLOG_FSYNC</code> default to False, unless it is the job event log specified for use by condor_dagman, in which case default to True. (ToddT)\n</li><li>Have condor_dagman write its workflow event log into the SPOOL directory for the dagman job. (ToddT)\n</li><li>Keep only dagman event logs in the schedd userlog cache and have <code>USERLOG_FILE_CACHE_MAX</code> default to something much larger than zero?!? (ToddT)\n</li></ol>\n\n<p><span class=\"subsection\"></span></p><h3>Optional configuration</h3>\n\n<p></p><ol>\n<li>When installing <code>condor-small-shadow</code>, drop a config.d file to automatically use it. <strong>[Done]</strong></li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2018-Sep-24 14:59:09 by tlmiller:</em> <br/>\n\nI have no actual suggestions; my observations follow.\n\n<p><strong>daemoncore/utils</strong>\n\n</p><p>A look through the param() calls in these sections codes revealed the following knobs of interest:\n\n</p><p></p><ul>\n<li>WANT_UDP_COMMAND_SOCKET\n</li></ul>\n\n<p>This seems like it should be off for everything except for collectors in a collector tree, but making that change will break existing collector tree setups.  Maybe we could knob this off in the general case but back on for collectors in general?  Not sure about the consequences here.\n\n</p><p></p><ul>\n<li>MAX_ACCEPTS_PER_CYCLE\n</li></ul>\n\n<p>I have no idea why this is 8.  IIRC, there as a big stink about this several years ago; it was intended to improve latency, I believe?\n\n</p><p></p><ul>\n<li>COLLECTOR_SOCKET_BUFSIZE\n</li></ul>\n\n<p>This is set to 10,000 k.  That sounds awfully arbitrary, and it's unclear that there's a good reason (on Linux) for not looking it up in /proc/sys/net/core/rmem_max and just using that (unless the limit there is like, all of system memory, maybe).\n\n</p><p><em>2018-Sep-25 16:38:09 by coatsworth:</em> <br/>\n\nI've proposed increasingly a few DAGMan and Scheduler Universe limits. I did some profiling and found that while a small (single job) DAGMan has a higher memory footprint than expected (~8 MB), much of this memory is shared between processes and subsequent small DAGMans only cost ~2 MB. Also increasing the number of jobs is relatively cheap (&lt;1 KB/job) so a DAG with 10,000 jobs doesn't cost much more than a single job.\n\n</p><p>The numbers I've proposed are somewhat arbitrary and generally just a doubling of the existing defaults. Open for discussion if anyone disagrees with them.</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=6780\" onclick=\"get_ticket_and_populate_wrapper('6780'); return false;\" title=\"Changes to defaults for start of 8.9 series\">#6780</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nChanges to defaults for start of 8.9 series</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6787\" onclick=\"get_ticket_and_populate_wrapper('6787'); return false;\" title=\"Default value for DEFAULT_JOB_MAX_RETRIES too high\">#6787</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDefault value for DEFAULT_JOB_MAX_RETRIES too high</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Nov-08 13:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55693\">[55693]</a></span>: Disable yet more pragma reminds <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-22 16:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55604\">[55604]</a></span>: Update docs for config default changes for 8.7.10. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6787\" onclick=\"get_ticket_and_populate_wrapper('6787'); return false;\" title=\"Default value for DEFAULT_JOB_MAX_RETRIES too high\">#6787</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-29 22:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55500\">[55500]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span>) Fix up broken build  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-29 21:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55499\">[55499]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span>) Automatically configure the small shadow when installed  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-28 13:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55490\">[55490]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span>) Kill Stork  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-28 11:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55489\">[55489]</a></span>: Undo increase in collector file description limit. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span> File descriptor limit can't be larger than 10240 on macOS.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-28 07:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55487\">[55487]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span>) Remove condor_lease_manager  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-27 16:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55486\">[55486]</a></span>: Fix some invalid param table changes. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-27 16:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55485\">[55485]</a></span>: Increase default limits on DAGMan instances and submission rate. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-27 16:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55484\">[55484]</a></span>: Change HISTORY_HELPER_MAX_CONCURRENCY default to 50. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-27 15:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55481\">[55481]</a></span>: Change config defaults taken from CMS global pool. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span> These settings affect time limits in the negotiator, file transfer throttles in the schedd, and when the schedd will stop looking for new matches.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-27 10:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55479\">[55479]</a></span>: default value for MOUNT_UNDER_SCRATCH param knob is now /tmp, /var/tmp <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-26 09:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55467\">[55467]</a></span>: change default value of SCHEDD_ALLOW_LATE_MATERIALIZE to true, and update tests accordingly. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-25 15:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55465\">[55465]</a></span>: remove dead code and disable pragma reminds, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-24 15:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55457\">[55457]</a></span>: Enable negotiator prefetch by default. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6768\" onclick=\"get_ticket_and_populate_wrapper('6768'); return false;\" title=\"Changes to defaults for end of 8.7 series\">#6768</a></span> Also increase the number of RRLs fetched by default.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-Oct-22 16:02", "status": "resolved", "created": "2018-Sep-14 14:45", "fixed_version": "2018-Sep-14 14:45", "broken_version": "", "priority": "3", "subsystem": "", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}