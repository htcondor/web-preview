{"id": 5189, "title": "Ticket #5189: $CHOICE() macro should allow empty items", "description": "<blockquote>\nWhile trying to use condor_submit foreach to do some transcoding.  I discovered that the $CHOICE() macro doesn't allow empty entries in the list.  There are cases where it would be very useful if it did.\n\n<p>In the following example a comparison produces a 0 or 1 which is used to choose\neither no argument, or an argument.\n\n</p><p></p><pre>    mixdown = $(Channels) &gt; 2\n    audio_arg = $CHOICE(mixdown,,-ac 2)\n    shrink = $(Width) &gt; 800\n    shrink_arg = $CHOICE(shrink,,-s 800x450)\n    args = $(shrink_arg) $(audio_arg)\n</pre>\n\n<p>This currently doesn't work because the ,, in choice is discarded and when the expression(s) evaluate to 1 we get an out-of-range on the choice.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-26 20:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=45715\">[45715]</a></span>: correct formatting of 8.3.8 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5188\" onclick=\"get_ticket_and_populate_wrapper('5188'); return false;\" title=\"$REAL() macro substitution doesn't evaluate\">#5188</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5189\" onclick=\"get_ticket_and_populate_wrapper('5189'); return false;\" title=\"$CHOICE() macro should allow empty items\">#5189</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-25 14:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=45669\">[45669]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5159\" onclick=\"get_ticket_and_populate_wrapper('5159'); return false;\" title=\"condor_submit should allow an empty file transfer list.\">#5159</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5210\" onclick=\"get_ticket_and_populate_wrapper('5210'); return false;\" title=\"condor_kbdd should not report transient mouse movement as 'activity'\">#5210</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5127\" onclick=\"get_ticket_and_populate_wrapper('5127'); return false;\" title=\"make condor_userprio -long output easier to process\">#5127</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5155\" onclick=\"get_ticket_and_populate_wrapper('5155'); return false;\" title=\"condor_q -better -reverse output confusing when expr uses CurrentTime\">#5155</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4836\" onclick=\"get_ticket_and_populate_wrapper('4836'); return false;\" title=\"Enable python bindings in windows\">#4836</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5132\" onclick=\"get_ticket_and_populate_wrapper('5132'); return false;\" title=\"fix problems with SLOT_TYPE_n_* params\">#5132</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5171\" onclick=\"get_ticket_and_populate_wrapper('5171'); return false;\" title=\"DetectedCpus and DetectedMemory is stuffed into ALL ads\">#5171</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5172\" onclick=\"get_ticket_and_populate_wrapper('5172'); return false;\" title=\"condor_q tries to parse usernames starting with digits as job ids\">#5172</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5188\" onclick=\"get_ticket_and_populate_wrapper('5188'); return false;\" title=\"$REAL() macro substitution doesn't evaluate\">#5188</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5189\" onclick=\"get_ticket_and_populate_wrapper('5189'); return false;\" title=\"$CHOICE() macro should allow empty items\">#5189</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-04 16:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=45460\">[45460]</a></span>: fix bugs in $REAL() and $CHOICE() macros, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5188\" onclick=\"get_ticket_and_populate_wrapper('5188'); return false;\" title=\"$REAL() macro substitution doesn't evaluate\">#5188</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5189\" onclick=\"get_ticket_and_populate_wrapper('5189'); return false;\" title=\"$CHOICE() macro should allow empty items\">#5189</a></span>. The bug in $REAL() also results in param calls that fetch computed float values returning the wrong value.  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Sep-18 08:40", "status": "resolved", "created": "2015-Aug-02 16:18", "fixed_version": "2015-Aug-02 16:18", "broken_version": "v080307", "priority": "3", "subsystem": "Libs", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}