{"id": 1612, "title": "Ticket #1612: VM gahp invokes scripts as wrong user with priv-sep", "description": "<blockquote>\nWhen the vm universe is used with privilege separation, the vm files spend some of their lives owned by Condor. The vm gahp chowns them to and from the job user just before starting the vm and just after it shuts down. Before and after that, it creates or modifies some the files.\n\n<p>Some callouts to the helper script occur when the vm files are owned by Condor, but for VMWare, the script is always run as the user. Those invocations need to be changed to occur as the Condor user. Here are some instances where the callout fails due to file ownership:\n</p><ul>\n<li>The attempt to stop a vm via the standard interface fails because the vm description file can't be opened.\n</li><li>Creation of a CD-ROM image containing input files fails due to permissions.\n</li><li>Unregistering a vm image fails due to file permissions on the .vmx file.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Aug-26 15:56:01 by jfrey:</em> <br/>\n\nPushed changes to V7_4-branch for 7.4.4.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Aug-27 11:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18886\">[18886]</a></span>: Remove get_condor_uid() call for Windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1612\" onclick=\"get_ticket_and_populate_wrapper('1612'); return false;\" title=\"VM gahp invokes scripts as wrong user with priv-sep\">#1612</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Aug-26 15:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18878\">[18878]</a></span>: Fix vm gahp script callouts when using priv-sep. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1612\" onclick=\"get_ticket_and_populate_wrapper('1612'); return false;\" title=\"VM gahp invokes scripts as wrong user with priv-sep\">#1612</a></span> When the vm universe is used with privilege separation, the vm files spend some of their lives owned by condor and some time owned by the job user. When the files are owned by condor, any callouts to the vm gahp's helper script need to be done as\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Aug-26 15:56", "status": "resolved", "created": "2010-Aug-26 15:12", "fixed_version": "2010-Aug-26 15:12", "broken_version": "v070400", "priority": "4", "subsystem": "VM", "assigned_to": "jfrey", "derived_from": "#1554", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}