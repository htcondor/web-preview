{"id": 1247, "title": "Ticket #1247: Isolate the Quill job_queue.log reader", "description": "<blockquote>\nThe Quill code has made its way into condor_c++_util as classadlogparser, classadlogentry, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobLogReader\" title=\"Job Log Reader\">JobLogReader</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobLogMirror\" title=\"Job Log Mirror\">JobLogMirror</a></span>. It is nearly independent of Condor, but performs some actions a library should rarely or never do, e.g. rarely: log and never: exit (EXCEPT).\n\n<p>The goal here is to cleanup the job_queue.log reading code so it can behave as a library independent of Condor.\n\n</p><p>Todo:\n</p><ul>\n<li>Name files and classes consistently, ClassAdLogXYZ <strong>[DONE]</strong>\n</li><li>Pass error codes instead of EXCEPTing <strong>[DONE]</strong>\n</li><li>Enable compilation outside Condor's build system <strong>[DONE: -D_NO_CONDOR_]</strong></li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-24 15:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1e82ca7153eb720892ad7d0cb6556eb50484c6b4\">[17333]</a></span>: Avoid PCH issues for ClassAdLogEntry,Parser,Prober (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-24 09:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/94e8af32fc3348ed38885fd12c974bc2453e7551\">[17324]</a></span>: Added syslog alternative to ClassAdLogReader.cpp when <em>NO_CONDOR</em> (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-24 08:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f3db0ea6007dcf277fda5cba76dc8c8bcb11d764\">[17323]</a></span>: Added syslog alternative to ClassAdLogProber.cpp when <em>NO_CONDOR</em> (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-24 08:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/75a7ec960606ba9f25796e5f57797d38b6133eb7\">[17322]</a></span>: Added syslog alternative to ClassAdLogParser.cpp when <em>NO_CONDOR</em> (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-24 08:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/00637d78db1fc83ddbf76592359c1033a2dc7316\">[17321]</a></span>: Added <em>NO_CONDOR</em> to ClassAdLog*.{h,cpp} controlling #includes (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-24 07:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c8b02737678861d23a44317ccf8bcc6c7953fa58\">[17320]</a></span>: Updated code that used <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=QuillErrCode\" title=\"Quill Err Code\">QuillErrCode</a></span> and now needs to use <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ParserErrCode\" title=\"Parser Err Code\">ParserErrCode</a></span> (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-24 07:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7265a647c50e2d6b8b71cafd1dfd3b9c51d96620\">[17319]</a></span>: Created <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ParserErrCode\" title=\"Parser Err Code\">ParserErrCode</a></span> in place of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=QuillErrCode\" title=\"Quill Err Code\">QuillErrCode</a></span> and pruned it to just SUCCESS&amp;FAILURE codes, all that were used (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 20:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f1cae88a3ea0630ec8d39bd163662a08fa31fde1\">[17317]</a></span>: Moved <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileOpErrCode\" title=\"File Op Err Code\">FileOpErrCode</a></span> from quill_enums.h to ClassAdLogParser.h (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 20:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4d2c669aa33deb722be18761d423dbf5309fdcd5\">[17316]</a></span>: Moved <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ProbeResultType\" title=\"Probe Result Type\">ProbeResultType</a></span> out of quill_enums.h and into ClassAdLogProber.h (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 20:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/635844544293195457d1409dbb7fa6322ae969e3\">[17314]</a></span>: Updated some dead code with new names for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAdLog\" title=\"Class Ad Log\">ClassAdLog</a></span> Prober and Parser (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 18:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8d2cb4aa6010226696f20320ee88137e8c21e837\">[17313]</a></span>: Avoid leak from readline (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 17:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b9363d38e0b8bf336b15868b039de89ba8002bde\">[17311]</a></span>: Parse without using MyString::readLine, there is already a readline() (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 17:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8f8fb0c5f66fd8e77e6f625694866f10977ef499\">[17310]</a></span>: Some defensive programming around st tests (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 17:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0b7ec313747b23c748105ce0c3d78877571b9c9d\">[17309]</a></span>: Updated <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobLogMirror\" title=\"Job Log Mirror\">JobLogMirror</a></span> to assert when it sees a POLL_ERROR, which used to be an EXCEPT (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 17:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/745573c61b61361364cd01edebb24c1187094420\">[17307]</a></span>: Made all code, which depended on readLogEntry to EXCEPT, assert on FILE_FATAL_ERROR (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 17:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/370c23a7df731271bc11568a810b912347d3065e\">[17308]</a></span>: Changed ClassAdLogReader::Poll to return <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=PollResultType\" title=\"Poll Result Type\">PollResultType</a></span>, including POLL_ERROR for what used to be EXCEPT errors (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 17:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/911bc570c3c27fac4d00583d6eb84632f58d49bf\">[17306]</a></span>: Made <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAdLogReader\" title=\"Class Ad Log Reader\">ClassAdLogReader</a></span> assert on FILE_FATAL_ERROR (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 16:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6fec322dc10d648e60b6f4314c53983888e84b63\">[17305]</a></span>: Catch FILE_FATAL_ERROR code from <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAdLogParser\" title=\"Class Ad Log Parser\">ClassAdLogParser</a></span> and transform it into PROBE_FATAL_ERROR (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 16:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8b9c323504beb1d8ccf9ff4cfda99ff5ef3e005c\">[17304]</a></span>: Turned <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAdLogParser\" title=\"Class Ad Log Parser\">ClassAdLogParser</a></span> EXCEPTs into passing FILE_FATAL_ERROR up the stack (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 16:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9e023c7934bec0b3aeda2a624b85980fbd43533a\">[17302]</a></span>: Updated imake and vcproj builds to recognize new ClassAdLog* names (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 16:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fb2c7df4c38c2377c6e6186104a9dc0c7355e7f7\">[17303]</a></span>: Updated code dependent on ClassAdLog* (#1247_  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-23 16:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f3690a649dbdf9734147ff03e320c8eed6c108ad\">[17301]</a></span>: Renamed the Quill <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> Log parsing code to ClassAdLog* (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1247\" onclick=\"get_ticket_and_populate_wrapper('1247'); return false;\" title=\"Isolate the Quill job_queue.log reader\">#1247</a></span>)  (By Matthew Farrellee )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Feb-24 09:29", "status": "resolved", "created": "2010-Feb-23 15:19", "fixed_version": "2010-Feb-23 15:19", "broken_version": "", "priority": "4", "subsystem": "Libs", "assigned_to": "matt", "derived_from": "", "creator": "matt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu", "due_date": ""}