{"id": 5872, "title": "Ticket #5872: Unneccessary EXCEPT()ion in starter.", "description": "<blockquote>\nThe following EXCEPT()ion occurs in FileTransfer::abortActiveTransfer().  It appears that the sequence is:\n\n<p>CStarter::~CStarter() -&gt; JICShadow::~JICShadow() -&gt; FileTransfer::~FileTransfer()\n\n</p><p>where the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> destructor of course tries to abort the active transfer.  The problem being that, since we've already gone through DC_Exit(), daemonCore is NULL.\n\n</p><p>This may imply that we're not cleaning up properly in transferOutput(); if we've successfully completed file transfer, why do we (think we) have an active transfer?\n\n</p><p></p><div class=\"verbatim\">\n<pre>08/24/16 09:55:26 (pid:834634) ** $CondorVersion: 8.5.6 Jul 15 2016 BuildID: 375046 $\n....\n08/24/16 10:32:56 (pid:834634) Completed DC_CHILDALIVE to daemon at &lt;128.105.245.132:9618&gt;\n08/24/16 10:45:39 (pid:834634) Got SIGTERM. Performing graceful shutdown.\n08/24/16 10:45:39 (pid:834634) Started timer to call main_shutdown_fast in 1800 seconds\n08/24/16 10:45:39 (pid:834634) ShutdownGraceful all jobs.\n08/24/16 10:45:39 (pid:834634) Got ShutdownGraceful when no jobs running.\n08/24/16 10:45:39 (pid:834634) HOOK_JOB_EXIT not configured.\n08/24/16 10:45:39 (pid:834634) Initializing Directory: curr_dir = /var/lib/condor/execute/slot1/dir_834634\n08/24/16 10:45:39 (pid:834634) Entering JICShadow::updateShadow()\n08/24/16 10:45:39 (pid:834634) Sent job ClassAd update to startd.\n08/24/16 10:45:39 (pid:834634) Leaving JICShadow::updateShadow(): success\n08/24/16 10:45:39 (pid:834634) Inside JICShadow::transferOutput(void)\n08/24/16 10:45:39 (pid:834634) JICShadow::transferOutput(void): Transferring...\n08/24/16 10:45:39 (pid:834634) Inside JICShadow::transferOutputMopUp(void)\n08/24/16 10:45:39 (pid:834634) dirscat: dirpath = /\n08/24/16 10:45:39 (pid:834634) dirscat: subdir = /var/lib/condor/execute/slot1\n08/24/16 10:45:39 (pid:834634) Initializing Directory: curr_dir = /var/lib/condor/execute/slot1/\n08/24/16 10:45:39 (pid:834634) Removing /var/lib/condor/execute/slot1/dir_834634\n08/24/16 10:45:39 (pid:834634) Attempting to remove /var/lib/condor/execute/slot1/dir_834634 as SuperUser (root)\n08/24/16 10:45:39 (pid:834634) **** condor_starter (condor_STARTER) pid 834634 EXITING WITH STATUS 0\n08/24/16 10:45:39 (pid:834634) ERROR \"Assertion ERROR on (daemonCore)\" at line 3857 in file /slots/02/dir_1789184/userdir/.tmpJTHhOd/BUILD/condor-8.5.6/src/condor_utils/file_transfer.cpp\n08/24/16 10:45:39 (pid:834634) ShutdownFast all jobs.\n08/24/16 10:45:39 (pid:834634) Got ShutdownFast when no jobs running.\n08/24/16 10:45:39 (pid:834634) Inside JICShadow::transferOutput(void)\n08/24/16 10:45:39 (pid:834634) Inside JICShadow::transferOutputMopUp(void)\nStack dump for process 834634 at timestamp 1472053539 (22 frames)\n/usr/lib64/libcondor_utils_8_5_6.so(dprintf_dump_stack+0x12d)[0x36fc9c747d]\n/usr/lib64/libcondor_utils_8_5_6.so(_Z18linux_sig_coredumpi+0x40)[0x36fcadd640]\n/lib64/libpthread.so.0[0x31f840f7e0]\ncondor_starter(_ZN8CStarter20removeTempExecuteDirEv+0x66)[0x458396]\ncondor_starter(exception_cleanup+0x4a)[0x43c24a]\n/usr/lib64/libcondor_utils_8_5_6.so(_EXCEPT_+0x11e)[0x36fc9924ce]\n/usr/lib64/libcondor_utils_8_5_6.so[0x36fc8fd1eb]\n/usr/lib64/libcondor_utils_8_5_6.so(_ZN12FileTransfer10stopServerEv+0x20)[0x36fc8fd210]\n/usr/lib64/libcondor_utils_8_5_6.so(_ZN12FileTransferD1Ev+0x245)[0x36fc901685]\n/usr/lib64/libcondor_utils_8_5_6.so(_ZN12FileTransferD0Ev+0x9)[0x36fc901859]\ncondor_starter(_ZN9JICShadowD2Ev+0x93)[0x42c6e3]\ncondor_starter(_ZN9JICShadowD0Ev+0x9)[0x42c8f9]\ncondor_starter(_ZN8CStarterD2Ev+0x45)[0x455d75]\n/lib64/libc.so.6(exit+0xe2)[0x31f7c35b22]\n/usr/lib64/libcondor_utils_8_5_6.so(__wrap_exit+0x75)[0x36fcab8e05]\n/usr/lib64/libcondor_utils_8_5_6.so(_Z7DC_ExitiPKc+0x219)[0x36fcae04a9]\ncondor_starter[0x457cdd]\n/usr/lib64/libcondor_utils_8_5_6.so(_Z17handle_dc_sigtermP7Servicei+0x97)[0x36fcadc927]\n/usr/lib64/libcondor_utils_8_5_6.so(_ZN10DaemonCore6DriverEv+0x94e)[0x36fcac722e]\n/usr/lib64/libcondor_utils_8_5_6.so(_Z7dc_mainiPPc+0x1799)[0x36fcadf7d9]\n/lib64/libc.so.6(__libc_start_main+0xfd)[0x31f7c1ed5d]\ncondor_starter[0x422429]\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "incident", "last_change": "2016-Aug-25 17:25", "status": "new", "created": "2016-Aug-25 17:20", "fixed_version": "2016-Aug-25 17:20", "broken_version": "", "priority": "4", "subsystem": "DaemonsExecNode", "assigned_to": "zmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "wiscmoate@gmail.com", "due_date": ""}