{"id": 3334, "title": "Ticket #3334: DAGMan default node log code and documentation need cleanup", "description": "<blockquote>\nIn the course of looking at <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3311\" onclick=\"get_ticket_and_populate_wrapper('3311'); return false;\" title=\"DAGManNodesMask is not working correctly\">#3311</a></span>, I found some issues with the DAGMan default node log code and documentation.  Before I go into the details, I want to give some high-level explanation.  I think the problem is basically that the \"old\" and \"new\" default log functionality has been overloaded into a single file.  (Just to clarify: the \"old\" default log is when the default log is used as the \"normal\" log file, for jobs that don't specify their own log file (passed to condor_submit as '-a log = &lt;file&gt;'); the \"new\" default log is used in addition to the \"normal\" log file (passed to condor_submit as '-a dagman_log = &lt;file&gt;').  The \"new\" default log is affected by the DAGManNodesMask attribute; the \"old\" one is not.)\n\n<p>I think the fundamental question is whether we fix this by actually splitting out the \"old\" and \"new\" functionality into separate files, and having the code and documentation reflect that, or whether we just clean up the code by giving things better names, etc., and make the documentation match the current functionality.  At this point, I think my preference would be to split things out into separate files -- I think it won't be that much work to do, and I think it will be conceptually cleaner going forward.\n\n</p><p>If we split this up into separate files, we need to come up with a name for the \"new\" one -- maybe the \"workflow log\" or something like that?\n\n</p><p>Some of the specific issues:\n</p><ul>\n<li>The default log can have some jobs for which DAGManNodesMask is in force, and some for which it is not (\"old\" and \"new\" functionality mixed together).\n</li><li>The Job class has member functions UseDefaultLog() and UsingDefaultLog(), and member variables _useDefaultLog and _append_default_log.\n</li><li>In general I think the code is not clear, because the naming of things implementing the \"old\" and \"new\" functionality are not clearly distinct.\n</li><li>Some places in the documentation refer to the \"default\" log and some to the \"auxiliary\" log.\n</li><li>The documentation of DAGMAN_DEFAULT_NODE_LOG is not up-to-date with the current functionality.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Dec-27 11:53:26 by wenger:</em> <br/>\n\nAlso, the \"Submit Description File Contents and Usage of Log Files\" section of the manual doesn't seem to reflect the default/workflow log file changes at all.\n\n<p></p><hr/>\n<em>2012-Dec-27 12:24:48 by wenger:</em> <br/>\n\nTodd T just suggested adding the DAGMan cluster ID to the default/workflow log file name, so that we could have multiple instances of the same DAG running at the same time.  I want to think a bit about this -- I'm not 100% sure there wouldn't be other problems, but if not it's probably worth doing...\n\n<p></p><hr/>\n<em>2013-Feb-04 17:07:11 by wenger:</em> <br/>\n\nCreated V7_9-gittrac_3334-branch for working on this.\n\n<p></p><hr/>\n<em>2013-Sep-17 15:24:47 by wenger:</em> <br/>\n\nAs per discussion today with ToddT, at some point the \"old\" default log functionality should just go away, and the \"new\"/\"workflow log\" functionality should remain.  This would mean that you couldn't recover a pre-7.9.1 DAG anymore, but at some point that should no longer be an issue.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3591\" onclick=\"get_ticket_and_populate_wrapper('3591'); return false;\" title=\"DAGMan doesn't truncate workflow log file\">#3591</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDAGMan doesn't truncate workflow log file</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Feb-04 19:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/109b51d38bf9f58da2d5ecbda92b4309eee4d1ea\">[34849]</a></span>: Gittrac <span class=\"ticket\"><a class=\"stalled\" href=\"/tickets?ticket=3334\" onclick=\"get_ticket_and_populate_wrapper('3334'); return false;\" title=\"DAGMan default node log code and documentation need cleanup\">#3334</a></span>: partway to fixing default log/workflow log confusion.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Feb-04 16:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7d4766dec2acf047ed10ae7caa46731f1660de5a\">[34842]</a></span>: Gittrac <span class=\"ticket\"><a class=\"stalled\" href=\"/tickets?ticket=3334\" onclick=\"get_ticket_and_populate_wrapper('3334'); return false;\" title=\"DAGMan default node log code and documentation need cleanup\">#3334</a></span>: fixed minor typos in the job_dagman_dont_use_default_node_log test.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Feb-04 16:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dc0d239308a051499ca131f9237000cbc129e0e6\">[34840]</a></span>: Gittrac <span class=\"ticket\"><a class=\"stalled\" href=\"/tickets?ticket=3334\" onclick=\"get_ticket_and_populate_wrapper('3334'); return false;\" title=\"DAGMan default node log code and documentation need cleanup\">#3334</a></span>: added an explicitly-defined log file using a macro in the file name to the job_dagman_default_log test, to make sure that doesn't goof things up (because you should be able to have a macro in the user-specified log file name if you're using the workflow log file for DAGMan).  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-May-19 16:26", "status": "stalled", "created": "2012-Nov-20 15:08", "fixed_version": "2012-Nov-20 15:08", "broken_version": "v070902", "priority": "3", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}