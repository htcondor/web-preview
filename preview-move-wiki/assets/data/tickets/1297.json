{"id": 1297, "title": "Ticket #1297: Kbdd messages could be ignored due to bad authorization defaults", "description": "<blockquote>\nSomewhat related to <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=714\" onclick=\"get_ticket_and_populate_wrapper('714'); return false;\" title=\"Idle system checking is broken on Vista and higher\">#714</a></span>.\n\n<p>In order for keyboard/mouse activity to be detected on several important platforms (aka Windows Vista and above, or Linux w/ 2.6 kernel and USB keyboards), X_EVENT_NOTIFICATION messages from the kbdd must make it to the startd.  Unfortunately, the startd currently registers the X_EVENT_NOTIFICATION command as authorization level DAEMON, which can be overly restrictive in some installations because the kbdd needs to run as the end-user and therefore may not have access to required credentials.  The result is keyboard activity may not detected because the startd will dump notifications from the kbdd if the authorization check fails.\n\n</p><p>Proposed fix: have the startd register X_EVENT_NOTIFICATION as level ALLOW, and then confirm (by inspecting the source address of the message) that the incoming message originated from the same machine.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-22 10:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17677\">[17677]</a></span>: Fixed a foible with Sock::peer_is_local from 4f6767f2759d3f80b4c640914e15f647cb6c3ff3 <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1297\" onclick=\"get_ticket_and_populate_wrapper('1297'); return false;\" title=\"Kbdd messages could be ignored due to bad authorization defaults\">#1297</a></span> where the hashtable object wasn't included into the stduniv libraries in order to resolve the hash table use in Sock.  (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-18 22:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17670\">[17670]</a></span>: Allow the kbdd to send console activity events to the startd running on the same machine. Previously, DAEMON level authentication was required, which wouldn't work in some environments considering the kbdd may need to run as the user. (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1297\" onclick=\"get_ticket_and_populate_wrapper('1297'); return false;\" title=\"Kbdd messages could be ignored due to bad authorization defaults\">#1297</a></span>)  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-18 22:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17669\">[17669]</a></span>: Add peer_is_local() method to CEDAR to determine if connection originatated from a process on the same machine. (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1297\" onclick=\"get_ticket_and_populate_wrapper('1297'); return false;\" title=\"Kbdd messages could be ignored due to bad authorization defaults\">#1297</a></span>)  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Mar-18 22:33", "status": "resolved", "created": "2010-Mar-18 12:01", "fixed_version": "2010-Mar-18 12:01", "broken_version": "v070200", "priority": "4", "subsystem": "Daemons", "assigned_to": "tannenba", "derived_from": "#714", "creator": "tannenba", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}