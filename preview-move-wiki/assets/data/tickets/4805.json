{"id": 4805, "title": "Ticket #4805: putClassAd non-blocking mode doesn't work", "description": "<blockquote>\nThe refactor of putClassAd in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4448\" onclick=\"get_ticket_and_populate_wrapper('4448'); return false;\" title=\"Improve performance of putClassAd with projection\">#4448</a></span> contains a small bug which breaks the non-blocking mode.  <code>BlockingModeGuard</code> is used as following:\n\n<p></p><div class=\"verbatim\">\n<pre>BlockingModeGuard(rsock, true);\n</pre></div>\n\n\n<p>However, this causes the object to be destroyed immediately.  We really want this to stay in scope until the end of the code block.  For that:\n\n</p><p></p><div class=\"verbatim\">\n<pre>BlockingModeGuard guard(rsock, true);\n</pre></div>\n\n\n<p>In particular, this prevents the V3 query protocol to actually be non-blocking (probably not a big deal in 8.3.2, as the query protocol forks a child in most cases).</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Jan-05 13:41:51 by bbockelm:</em> <br/>\n\nNote - as it's a one-liner, I committed straight to master.  Keeping in review state just so TJ can ACK that I'm not completely nuts.\n\n<p></p><hr/>\n<em>2015-Jan-06 08:08:56 by johnkn:</em> <br/>\n\nCODE_REVIEW: change looks good.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-06 10:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cbab5f73e5bb9b861e7807f14c7479c2037d359b\">[42116]</a></span>: edit 8.3.3 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4805\" onclick=\"get_ticket_and_populate_wrapper('4805'); return false;\" title=\"putClassAd non-blocking mode doesn't work\">#4805</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-06 08:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0f2d873633a2f6bff51431303dbcbd7340941ead\">[42114]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4805\" onclick=\"get_ticket_and_populate_wrapper('4805'); return false;\" title=\"putClassAd non-blocking mode doesn't work\">#4805</a></span>.  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jan-02 16:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dd1a63e1199b475bcdc48cd3a4c88e17b0dbedc2\">[42077]</a></span>: Keep blocking mode guard in scope. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4805\" onclick=\"get_ticket_and_populate_wrapper('4805'); return false;\" title=\"putClassAd non-blocking mode doesn't work\">#4805</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Feb-16 14:57", "status": "resolved", "created": "2015-Jan-02 16:15", "fixed_version": "2015-Jan-02 16:15", "broken_version": "v080300", "priority": "2", "subsystem": "Daemons", "assigned_to": "johnkn", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bbockelm@cse.unl.edu", "due_date": ""}