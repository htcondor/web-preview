{"id": 1721, "title": "Ticket #1721: COUNT_HYPERTHREAD_CPUS=False isn't working", "description": "<blockquote>\nTurning off Condor's counting of hyperthread CPUs no longer seems to work when running on a Windows operating system. I have set:\n\n<p></p><pre>   COUNT_HYPERTHREAD_CPUS = False\n</pre>\n\n<p>in condor_config and have completely stopped and started Condor on the machine. And it still reports 2x the number of physical CPUs/cores in the machine. I have confirmed that hyperthreading is turned on the box.\n\n</p><p>Processors are Intel Xeon E5630 @ 2.53 -- there are 2 in the machine. See: <a class=\"external\" href=\"http://ark.intel.com/Product.aspx?id=47924\">http://ark.intel.com/Product.aspx?id=47924</a>\n\n</p><p>Machine is running Windows 7 Professional edition.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Apr-11 07:28:55 by matt:</em> <br/>\n\n<div class=\"verbatim\">\n<pre>$ grep -B3 -A1 COUNT_HYPERTHREAD_CPUS src/condor_sysapi/reconfig.cpp\n#ifdef LINUX\n    /* Should we count hyper threads? */\n    _sysapi_count_hyperthread_cpus =\n        param_boolean_int(\"COUNT_HYPERTHREAD_CPUS\", 1);\n#endif\n</pre></div>\n\n\n<p></p><hr/>\n<em>2012-Apr-20 12:23:44 by ziliang:</em> <br/>\n\nAdded patch to count CPUs while working around stupid CPU issue.  Strangely enough, SYSTEM_LOGICAL_PROCESSOR_INFORMATION seems to be defined in the headers even if WINVER is set to XP, though we need to check if this is just the case for VS2010.  Bumped to TJ for review.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/554/hyper.diff\">hyper.diff</a>\n5121 bytes added by ziliang on 2012-Apr-20 17:20:35 UTC.\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-30 12:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/badd72a7b63b68e1a58199887c37c3550ad50645\">[31860]</a></span>: Also remember to free the buffer we allocate for storing processor info. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1721\" onclick=\"get_ticket_and_populate_wrapper('1721'); return false;\" title=\"COUNT_HYPERTHREAD_CPUS=False isn't working\">#1721</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-30 12:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4a2e6024a25b8eaa2a86845b60d29f5802817bdf\">[31859]</a></span>: Modify exception message to indicate which config knob controls hyperthread detection on Windows. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1721\" onclick=\"get_ticket_and_populate_wrapper('1721'); return false;\" title=\"COUNT_HYPERTHREAD_CPUS=False isn't working\">#1721</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-27 14:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/785ec3151cf4ec23854c52d1313bb752a8ba521b\">[31845]</a></span>: corrected fix for detecting hyperthread CPUs on windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1721\" onclick=\"get_ticket_and_populate_wrapper('1721'); return false;\" title=\"COUNT_HYPERTHREAD_CPUS=False isn't working\">#1721</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-27 09:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/92783192f5c7c28537be5f6ef96436ca3bb8c690\">[31833]</a></span>: Revert \"Fix CPU core count when hyperthreading is enabled on Windows. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1721\" onclick=\"get_ticket_and_populate_wrapper('1721'); return false;\" title=\"COUNT_HYPERTHREAD_CPUS=False isn't working\">#1721</a></span>.\" This reverts commit a3566b611b5f40d6bcacd0f90759b8042b2bd8f1.  (By Scot Kronenfeld )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-26 15:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a3566b611b5f40d6bcacd0f90759b8042b2bd8f1\">[31830]</a></span>: Fix CPU core count when hyperthreading is enabled on Windows. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1721\" onclick=\"get_ticket_and_populate_wrapper('1721'); return false;\" title=\"COUNT_HYPERTHREAD_CPUS=False isn't working\">#1721</a></span>.  (By Ziliang Guo )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-May-08 09:49", "status": "resolved", "created": "2010-Oct-20 09:37", "fixed_version": "2010-Oct-20 09:37", "broken_version": "v070404", "priority": "3", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "ichesal", "rust": "", "customer_group": "other", "visibility": "public", "notify": "ichesal@cyclecomputing.com tannenba@cs.wisc.edu johnkn@cs.wisc.edu", "due_date": ""}