{"id": 1643, "title": "Ticket #1643: Review new code paths for TRANSFERRING_OUTPUT", "description": "<blockquote>\nLook at the bits of code that care about the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobStatus\" title=\"Job Status\">JobStatus</a></span> (searching for RUNNING and STAGING_OUT is a good way). Currently the STAGING_OUT code path should match the RUNNING code path.   Verify that this is actually what we want, change it in places where we should.\n\n<p>This is per the work on <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1641\" onclick=\"get_ticket_and_populate_wrapper('1641'); return false;\" title=\"Add new job status TRANSFERRING_OUTPUT\">#1641</a></span> and should be done on that branch, V7_5-stageout_status-branch at the moment, but <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1641\" onclick=\"get_ticket_and_populate_wrapper('1641'); return false;\" title=\"Add new job status TRANSFERRING_OUTPUT\">#1641</a></span> is canonical.\n\n</p><p>Quick and dirty list to start from\n\n</p><p><a class=\"file\" href=\"rlog?f=src/condor_gridmanager/condorjob.cpp\">/src/condor_gridmanager/condorjob.cpp</a>\n</p><ul>\n<li>OKAY: 1309:   if ( new_remote_state == RUNNING || new_remote_state == STAGING_OUT ) {\n<ul>\n<li>This is the remote state for a Condor-C job. From the local side, what does it mean if the remote side is STAGING_OUT.  Probably that it's still \"RUNNING\" locally (meaning \"the remote side is busy getting stuff done\").  That way we preserve STAGING_OUT to actually mean \"pulling results back to the the original submit machine.\")\n</li></ul>\n</li></ul>\n\n<p><a class=\"file\" href=\"rlog?f=src/condor_gridmanager/gridftpmanager.cpp\">/src/condor_gridmanager/gridftpmanager.cpp</a>\n</p><ul>\n<li>OKAY 907:    case STAGING_OUT:\n<ul>\n<li>This code manages the FTP server for GT4 jobs.  It really only cares that the job is \"active\" (\"CONDITION_ACTIVE\") which it is in this case.\n</li></ul>\n</li></ul>\n\n<p><a class=\"file\" href=\"rlog?f=src/classad_analysis/analysis.cpp\">/src/classad_analysis/analysis.cpp</a>\n</p><ul>\n<li>OKAY 111:  case STAGING_OUT:\n<ul>\n<li>This code only cares if a job is matched or not.\n</li></ul>\n</li></ul>\n\n<p><a class=\"file\" href=\"rlog?f=src/condor_c%2B%2B_util/user_error_policy.cpp\">/src/condor_c++_util/user_error_policy.cpp</a>\n</p><ul>\n<li>247:                case STAGING_OUT:\n</li></ul>\n\n<p><a class=\"file\" href=\"rlog?f=src/condor_c%2B%2B_util/history_utils.h\">/src/condor_c++_util/history_utils.h</a>\n</p><ul>\n<li>231:          case STAGING_OUT:\n</li></ul>\n\n<p><a class=\"file\" href=\"rlog?f=src/condor_q.V6/queue.cpp\">/src/condor_q.V6/queue.cpp</a>\n</p><ul>\n<li>1199:                    ATTR_JOB_STATUS, STAGING_OUT );\n</li><li>1348:   if ( ( job_status == RUNNING || job_status == STAGING_OUT ) &amp;&amp; shadow_bday ) {\n</li><li>1618:   if ((job_status == RUNNING || job_status == STAGING_OUT) &amp;&amp;\n</li><li>1641:   if ((job_status == RUNNING || job_status == STAGING_OUT) &amp;&amp; shadow_bday &amp;&amp; last_ckpt &gt; shadow_bday) {\n</li><li>2167:       case STAGING_OUT: running++;   break;\n</li><li>2682:   if( jobState == RUNNING || jobState == STAGING_OUT ) {\n</li><li>3268:       if( status != RUNNING &amp;&amp; status != STAGING_OUT ) {\n</li></ul>\n\n<p><a class=\"file\" href=\"rlog?f=src/condor_job_router/VanillaToGrid.cpp\">/src/condor_job_router/VanillaToGrid.cpp</a>\n</p><ul>\n<li>335:        case STAGING_OUT:\n</li></ul>\n\n<p><a class=\"file\" href=\"rlog?f=src/condor_job_router/JobRouter.cpp\">/src/condor_job_router/JobRouter.cpp</a>\n</p><ul>\n<li>1696:   job-&gt;is_running = (job_status == RUNNING || job_status == STAGING_OUT);\n</li></ul>\n\n<p><a class=\"file\" href=\"rlog?f=src/condor_schedd.V6/schedd.cpp\">/src/condor_schedd.V6/schedd.cpp</a>\n</p><ul>\n<li>1284:       cur_hosts = ((status == RUNNING || status == STAGING_OUT) ? 1 : 0);\n</li><li>1340:           if (status == IDLE || status == RUNNING || status == STAGING_OUT) {\n</li><li>1348:           if (status == IDLE || status == RUNNING || status == STAGING_OUT) {\n</li><li>1436:   if (status == IDLE || status == RUNNING || status == STAGING_OUT) {\n</li><li>4134:                     RUNNING, ATTR_JOB_STATUS, STAGING_OUT );\n</li><li>4297:               if( status != RUNNING &amp;&amp; status != STAGING_OUT ) {\n</li><li>6172:       cur_hosts = ((status == RUNNING || status == STAGING_OUT) ? 1 : 0);\n</li><li>6184:       (status == IDLE || status == RUNNING || status == STAGING_OUT) ) {\n</li><li>6743:   case STAGING_OUT:\n</li><li>8402:       if (status == RUNNING || status == STAGING_OUT) {\n</li><li>8715:   if (status == RUNNING || status == STAGING_OUT) {\n</li><li>9028:           if (status != RUNNING &amp;&amp; status != STAGING_OUT &amp;&amp;\n</li><li>9905:   case STAGING_OUT: {\n</li><li>12035:      else if (job_status != RUNNING &amp;&amp; job_status != STAGING_OUT) {\n</li><li>12071:      else if (job_status != RUNNING &amp;&amp; job_status != STAGING_OUT) {\n</li><li>13221:  if ( status == RUNNING || status == STAGING_OUT ) {\n</li></ul>\n\n<p><a class=\"file\" href=\"rlog?f=src/condor_schedd.V6/qmgmt.cpp\">/src/condor_schedd.V6/qmgmt.cpp</a>\n</p><ul>\n<li>3643:        cur_hosts = ((job_status == RUNNING || job_status == STAGING_OUT) ? 1 : 0);\n</li><li>3792:   else if ( status == RUNNING || status == STAGING_OUT || hosts &gt; 0 ) {</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Sep-22 15:05:17 by jfrey:</em> <br/>\n\nThe name of the new job status has been changed from STAGING_OUT to TRANSFERRING_OUTPUT.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2011-Nov-21 15:55", "status": "resolved", "created": "2010-Sep-03 17:31", "fixed_version": "2010-Sep-03 17:31", "broken_version": "", "priority": "4", "subsystem": "Daemons", "assigned_to": "adesmet", "derived_from": "#1641", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}