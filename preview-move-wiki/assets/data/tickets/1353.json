{"id": 1353, "title": "Ticket #1353: New DaemonCore::Register_Timer: take param name for repeat rate", "description": "<blockquote>\nWhen you DaemonCore::Register_Timer a timer, you can set a one-off time, or a repeating timer.  Repeating timers have a fixed repeat interval.\n\n<p>Many timers are set based on param_integer(\"SOME_NAME\", default_val).  You could pass this value into Register_Timer as the repeat rate, but then you'd need to pay attention to reconfig requests and DaemonCore::Reset_Timer it.  This can be a nuisance if your code isn't already fretting about the reconfig request.  As a result, there is a lot of code that sets one-off timers and upon firing immediately re-adds itself.  For example, dc_touch_log_file in <a class=\"file\" href=\"rlog?f=src/condor_daemon_core.V6/daemon_core_main.cpp\">/src/condor_daemon_core.V6/daemon_core_main.cpp</a> :\n</p><div class=\"code\">\n<pre class=\"code\">int\ndc_touch_log_file( Service* )\n{\n\tdprintf_touch_log();\n\n\tdaemonCore-&gt;Register_Timer( param_integer( \"TOUCH_LOG_INTERVAL\", 60 ),\n\t\t\t\t(TimerHandler)dc_touch_log_file, \"dc_touch_log_file\" );\n\n\treturn TRUE;\n}</pre></div>\n\n\n<p>This is redundant.  Instead we should offer a Register_Timer that takes a param name and default and automatically does this for us.  The interface might look something like:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">//                                Param name            default val if no param\ndaemonCore-&gt;Register_Timer_param( \"TOUCH_LOG_INTERVAL\", 60\n            (TimerHandler)dc_touch_log_file, \"dc_touch_log_file\" );\n</pre></div>\n\n\n<p>This would eliminate some redundancy.  It can also eliminate complexity where code watches for the reconfig and Reset_Timers itself.  Reduced complexity will hopefully lead to fewer bugs, especially when people are working on related tasks (see <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1337\" onclick=\"get_ticket_and_populate_wrapper('1337'); return false;\" title=\"condor_kbdd 100% cpu usage\">#1337</a></span> for an example of how a minor mistake in the timer system can trash the entire entire system)</p></blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2010-Oct-20 16:03:30 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.\n<hr/>\n<em>2011-Jan-27 14:46:04 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 16:08:44 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2012-Oct-17 12:25", "status": "new", "created": "2010-Apr-15 11:45", "fixed_version": "2010-Apr-15 11:45", "broken_version": "v070400", "priority": "4", "subsystem": "Daemons", "assigned_to": "", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}