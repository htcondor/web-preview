{"id": 6318, "title": "Ticket #6318: Update HTCondor-managed AFS creds when new jobs are submitted or run", "description": "<blockquote>\nAll of this is assuming you are using the SEC_CREDENTIAL_DIRECTORY, SEC_CREDENTIAL_PRODUCER, CREDMON, etc. to manage creds (krb5 tickets, AFS tokens, whatever) for jobs.\n\n<p>Currently, when a job is submitted it sends a \"cred\" which is opaque to HTCondor to the credd before actually submitting the job.  If the credd already has a cred for that user stored in the SEC_CREDENTIAL_DIRECTORY, it simply discards the new cred rather than update them.  Instead we should update them every X minutes.  We shouldn't update them every time, as then the CREDMON will likely make a fresh call to the KDC and the KDC could become overwhelmed.\n\n</p><p>Likewise, on the execute side, if a job from a user is about to run, and a cred for that user already exists, we currently don't bother updating it.  Again, if the existing credential is more than X minutes old, we should update it.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Jun-28 17:48:19 by zmiller:</em> <br/>\n\nI'm proposing to add a configuration variable called SEC_CREDENTIAL_REFRESH_INTERVAL.\n\n<p></p><ul>\n<li>If it the value is negative, HTCondor will never update the credential if it already exists. (Current behavior, and will remain the default)\n</li><li>If the value is zero, HTCondor will always update the credential.\n</li><li>Any positive integer then is the number of seconds in which we say the credential is \"fresh enough\" and doesn't need to be updated.  So for one hour you would say:\n<div class=\"code\">\n<pre class=\"code\">SEC_CREDENTIAL_REFRESH_INTERVAL = 3600\n</pre></div>\n\n</li></ul>\n\n<p>Any comments on the name or behavior?</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jul-07 11:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/508e1868602c8d0c4d79b1950cdd6894bf1cb61a\">[51834]</a></span>: Add a knob, SEC_CREDENTIAL_REFRESH_INTERVAL, that controls if and when we update credentials in the SEC_CREDENTIAL_DIRECTORY. <span class=\"ticket\"><a class=\"review\" href=\"/tickets?ticket=6318\" onclick=\"get_ticket_and_populate_wrapper('6318'); return false;\" title=\"Update HTCondor-managed AFS creds when new jobs are submitted or run\">#6318</a></span>  (By zmiller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Jul-07 13:40", "status": "review", "created": "2017-Jun-26 11:29", "fixed_version": "2017-Jun-26 11:29", "broken_version": "", "priority": "2", "subsystem": "Security", "assigned_to": "tannenba", "derived_from": "", "creator": "zmiller", "rust": "", "customer_group": "cern", "visibility": "public", "notify": "zmiller@cs.wisc.edu, tannenba@cs.wisc.edu, christoph.beyer@desy.de", "due_date": ""}