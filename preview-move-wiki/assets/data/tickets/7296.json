{"id": 7296, "title": "Ticket #7296: Starter should export more vars than just OMP_NUM_THREADS", "description": "<blockquote>\nSince HTCondor v8.3.4, the condor_starter currently sets a job environment variable OMP_NUM_THREADS equal to the number of CPU cores in the slot if the user did not explicitly set it (see <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4884\" onclick=\"get_ticket_and_populate_wrapper('4884'); return false;\" title=\"Starter should export OMP_NUM_THREADS to job environment\">#4884</a></span>).\n\n<p>Turns out there are many similar environment variables we should be setting that are referenced by popular computing applications, like JULIA_NUM_THREADS and NUMEXPR_NUM_THREADS.\n\n</p><p>This patch will create an HTCondor configuration knob, STARTER_NUM_THREADS_ENV_VARS, that allows an admin to list the names of job environment variables to set equal to the number of provisioned cores.  Based upon the wisdom <a class=\"external\" href=\"https://indico.cern.ch/event/817927/contributions/3570384/attachments/1912462/3160555/HTCondor_Bonn.pdf\">in slide 14 of this talk</a>, this knob will default to the following:\n\n</p><p></p><pre>   STARTER_NUM_THREADS_ENV_VARS = OMP_NUM_THREADS NUMEXPR_NUM_THREADS MKL_NUM_THREADS CUBACORES JULIA_NUM_THREADS</pre>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7418\" onclick=\"get_ticket_and_populate_wrapper('7418'); return false;\" title=\"Add GOMAXPROCS to STARTER_NUM_THREADS_ENV_VARS\">#7418</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd GOMAXPROCS to STARTER_NUM_THREADS_ENV_VARS</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-04 13:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/43a03bb7218f061c7b4e1b87f4f5e6ebe2397bee\">[58037]</a></span>: Added documentation and version blurb for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7296\" onclick=\"get_ticket_and_populate_wrapper('7296'); return false;\" title=\"Starter should export more vars than just OMP_NUM_THREADS\">#7296</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-02 06:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/934258dd7d0b5f3cd4a929929c961a4fd73491d7\">[58005]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7296\" onclick=\"get_ticket_and_populate_wrapper('7296'); return false;\" title=\"Starter should export more vars than just OMP_NUM_THREADS\">#7296</a></span>) Appease Fedora's picky compiler  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-01 17:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3a08ea76bb100a818883c85874800a0a659fe90f\">[57998]</a></span>: Add knob STARTER_NUM_THREADS_ENV_VARS with a decent default value. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7296\" onclick=\"get_ticket_and_populate_wrapper('7296'); return false;\" title=\"Starter should export more vars than just OMP_NUM_THREADS\">#7296</a></span> This allows the starter to set more than just OMP_NUM_THREADS in the job environment.  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Oct-04 13:51", "status": "resolved", "created": "2019-Oct-01 17:03", "fixed_version": "2019-Oct-01 17:03", "broken_version": "", "priority": "3", "subsystem": "DaemonsExecNode", "assigned_to": "tannenba", "derived_from": "#4884", "creator": "tannenba", "rust": "", "customer_group": "other", "visibility": "public", "notify": "freyermuth@physik.uni-bonn.de", "due_date": ""}