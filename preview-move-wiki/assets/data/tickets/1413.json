{"id": 1413, "title": "Ticket #1413: Condor Cron on Windows is no longer functioning", "description": "<blockquote>\nThis problem was reported to Cycle Computing by Hartford Life. They have a more complicated setup but Doug was able to reproduce the failure with a pretty simple .bat file.\n\n<p>Pre 7.0.5 everything was fine. This cron job caused no issues and ran successfully on Windows. With a switch to 7.4.2 Hartford is unable to run the cron job. Doug confirmed this was still working as of 7.2.x.\n\n</p><p>Here are the details for recreating the problem using a simple .bat file:\n\n</p><p>In your config file:\n\n</p><p></p><div class=\"verbatim\">\n<pre>STARTD_CRON_NAME = SYSCAPS\nSYSCAPS_JOBLIST = PRTDIAG\nSYSCAPS_PRTDIAG_EXECUTABLE = C:/Condor/test.bat\nSYSCAPS_PRTDIAG_PERIOD = 1m\n</pre></div>\n\n\n<p>The file used is a simple batch file:\n\n</p><p></p><div class=\"verbatim\">\n<pre>echo %TIME% &gt; c:\\condor\\test.out\n</pre></div>\n\n\n<p>We get the following output in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StartLog\" title=\"Start Log\">StartLog</a></span>:\n\n</p><p></p><div class=\"verbatim\">\n<pre>05/14 15:33:47 Create_Process(): executable: 'C:/Condor/test.bat'\n05/14 15:33:47 Executable is a batch file, running: \"C:\\WINDOWS\\system32\\cmd.exe\" /Q /C \"C:/Condor/test.bat\" PRTDIAG\n05/14 15:33:47 GetBinaryType() returned 0\n05/14 15:33:47 Create_Process: CreateProcess failed, errno=267\n05/14 15:33:47 Cron: Error running job 'PRTDIAG'\n</pre></div>\n\n\n<p>In 7.2 we got this output:\n\n</p><p></p><div class=\"verbatim\">\n<pre>5/14 12:34:25 Executable is a batch script, so executing C:\\WINDOWS\\system32\\cmd.exe  /Q /C \"C:/Condor/test.bat\"  PRTDIAG\n5/14 12:34:25 GetBinaryType() returned 0\n5/14 12:34:25 Cron: STDOUT closed for 'PRTDIAG'\n5/14 12:34:25 Cron: STDERR closed for 'PRTDIAG'\n5/14 12:34:25 Cron: 'PRTDIAG' (pid 448) exit_status=0\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Jun-02 19:49:08 by ichesal:</em> <br/>\n\nHey guys: any updates on this? This is a feature used heavily in some enterprise client accounts.\n\n<p>Thanks!\n\n</p><p>- Ian C.\n\n</p><p></p><hr/>\n<em>2010-Jun-08 16:17:05 by tannenba:</em> <br/>\n\nHmmmm... in the above log snippet, errno is 267 from Create_Process, which on Win32 means: \"The directory name is invalid\".\n\n<p>I am going to assign this ticket to Pete, and he'll check and see if this problem is specific to Windows or also can be reproduced on Linux.  If the latter, Pete will work on a patch; if the former, he'll reassign to Cathrin.\n\n</p><p></p><hr/>\n<em>2010-Jun-09 11:15:47 by psilord:</em> <br/>\n\nUsing 7.4.2, I attempted to reproduce this on unix with this config file setup:\n\n<p></p><div class=\"verbatim\">\n<pre>STARTD_CRON_NAME = SYSCAPS\nSYSCAPS_JOBLIST = PRTDIAG\nSYSCAPS_PRTDIAG_EXECUTABLE = /tmp/foobar\nSYSCAPS_PRTDIAG_PERIOD = 1m\n</pre></div>\n\n\n<p>It worked as expected.\n\n</p><p>I found this <a class=\"external\" href=\"http://tinyurl.com/2f543x7\">forum thread</a> which talks about unexpected conditions one may get an invalid directory when trying to exec a process under windows. Search for \"invalid\". It may be of help to Cathrin.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-09 15:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18423\">[18423]</a></span>: This commit fixes broken cron on Windows (see <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1413\" onclick=\"get_ticket_and_populate_wrapper('1413'); return false;\" title=\"Condor Cron on Windows is no longer functioning\">#1413</a></span>). The problem was caused by replacing MyString::getCStr() with MyString::Value() for the CWD argument of Create_Process. The later never returns NULL but the empty string instead. Since no checks were included in the Windows part, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CreateProcess\" title=\"Create Process\">CreateProcess</a></span> was\u00a0[...]\n (By Cathrin Weiss )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jun-09 15:57", "status": "resolved", "created": "2010-May-19 16:37", "fixed_version": "2010-May-19 16:37", "broken_version": "v070402", "priority": "2", "subsystem": "Win32", "assigned_to": "cweiss", "derived_from": "", "creator": "ichesal", "rust": "", "customer_group": "other", "visibility": "public", "notify": "ichesal@cyclecomputing.com matt@cs.wisc.edu ialderman@cyclecomputing.com", "due_date": ""}