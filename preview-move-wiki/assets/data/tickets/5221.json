{"id": 5221, "title": "Ticket #5221: condor_q treats -name differently than other tools", "description": "<blockquote>\ncondor_q and condor_rm handle their -name command-line argument differently, which can lead to them talking to difference schedds. condor_rm uses the -name argument value to create a DCSchedd object and uses that object to communicate with the schedd. condor_q uses the -name argument value to query the collector for the given schedd's ad, uses the sinful string from that ad to create a DCSchedd, and uses that object to communicate with the schedd.\n\n<p>When the DCSchedd object is given a name but not an address or pool, it may decide that the named schedd is local and look for its information in a local address file instead of querying the collector. It will do this if the given name matches the SCHEDD_NAME parameter in the config file. If the address file can't read, it falls back to querying the collector.\n\n</p><p>These divergent paths for locating the schedd are causing problems for Fermilab, which runs multiple schedds on a single machine. They have situations where condor_q -name and condor_rm -name contact different schedds, leading to confusion when condor_rm says jobs don't exist.\n\n</p><p>One workaround is to disable the writing of the schedd address and ad files. This would require that all tools be used with -name and they would always query the collector to locate the schedd. Another workaround is to always use -pool, which forces a query of the collector.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Aug-14 13:58:07 by jfrey:</em> <br/>\n\nThis problem arises when the following config parameters don't refer to the same schedd (in the client's configuration):\n\n<p></p><ul>\n<li>SCHEDD_NAME\n</li><li>SCHEDD_SUPER_ADDRESS_FILE\n</li><li>SCHEDD_ADDRESS_FILE\n</li><li>SCHEDD_DAEMON_AD_FILE\n</li></ul>\n\n<p></p><hr/>\n<em>2016-Nov-16 11:08:17 by johnkn:</em> <br/>\n\nI'm leary of getting rid of the address files, I think the solution here is to have the use of the -name argument always contact the collector for all of the tools - just like condor_q does now.\n\n<p></p><hr/>\n<em>2016-Dec-05 15:24:17 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>If this change makes Fermi happy in the short term, then we can release it.\n\n</p><p>But it's the wrong solution. If we're going to change how a client locates a schedd, that should occur in the Daemon client object (maybe specific to the DCSchedd object).\n\n</p><p></p><hr/>\n<em>2016-Dec-07 11:32:30 by jfrey:</em> <br/>\n\nNo version history for this change. It is an incomplete fix intended for a specific user (Fermilab) that won't affect most other users. We will inform Fermi directly about the change.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=6041\" onclick=\"get_ticket_and_populate_wrapper('6041'); return false;\" title=\"Simplify how the Daemon client object locates the daemon\">#6041</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nSimplify how the Daemon client object locates the daemon</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Nov-18 11:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49598\">[49598]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5221\" onclick=\"get_ticket_and_populate_wrapper('5221'); return false;\" title=\"condor_q treats -name differently than other tools\">#5221</a></span>, have condor_rm find the schedd the same was as condor_q does when -name is passed, but not -pool. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "incident", "last_change": "2016-Dec-07 11:32", "status": "resolved", "created": "2015-Aug-13 16:13", "fixed_version": "2015-Aug-13 16:13", "broken_version": "v080200", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "fermi", "visibility": "public", "notify": "zmiller@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}