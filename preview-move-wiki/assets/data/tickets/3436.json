{"id": 3436, "title": "Ticket #3436: Batch status update requests for EC2 resources.", "description": "<blockquote>\nUse VM_STATUS_ALL instead of VM_STATUS when polling for instance status.  Use the framework in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=BaseResource\" title=\"Base Resource\">BaseResource</a></span> to handle the polling intervals.  Because <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=OpenStack\" title=\"Open Stack\">OpenStack</a></span> doesn't report client tokens in its status updates, maintain a per-resource hashtable using only the instance IDs.  (The global hashtable of jobs uses the remote job ID as the key, but that includes the client token.)  Update each job's status.\n\n<p>Alter the state machine so that it only transitions out of GM_SUBMITTED and into GM_PROBE_JOB if a flag is set.  Set that flag if and only the job's status changes, with the exception that an initial probe of the job, immediately after discovering its instance ID, is permissible, because it doing so is the only way we find out the VM's hostname.\n\n</p><p>Repeat for spot instances.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Feb-20 16:37:34 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p></p><ul>\n<li>In EC2Resource::StartBatchStatus(), you make a copy of several items\nfrom the status results that then go unused. Why not just call\nreturnStatus.next() and ignore the result value for those items?\n(amiID and clientToken for regular status; launchGroup and instanceID\nfor spot status)\n</li></ul>\n\n<p></p><hr/>\n<em>2013-Feb-21 13:24:36 by tlmiller:</em> <br/>\n\nI've commented out the superfluous copies; I like having the documentation right there as to what we're expecting.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Feb-21 13:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=34992\">[34992]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3436\" onclick=\"get_ticket_and_populate_wrapper('3436'); return false;\" title=\"Batch status update requests for EC2 resources.\">#3436</a></span>) Remove some superflous string copies.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Feb-06 15:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=34868\">[34868]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3477\" onclick=\"get_ticket_and_populate_wrapper('3477'); return false;\" title=\"Keypairs of EC2 jobs may not be cleaned up.\">#3477</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3436\" onclick=\"get_ticket_and_populate_wrapper('3436'); return false;\" title=\"Batch status update requests for EC2 resources.\">#3436</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3367\" onclick=\"get_ticket_and_populate_wrapper('3367'); return false;\" title=\"Condor thinks VMs in OpenStack's &quot;SHUTOFF&quot; state are running\">#3367</a></span>) Document bug fixes and feature.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Feb-06 14:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=34863\">[34863]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3436\" onclick=\"get_ticket_and_populate_wrapper('3436'); return false;\" title=\"Batch status update requests for EC2 resources.\">#3436</a></span>) Fix concurrency problem in curl exposed by batching updates.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Feb-05 14:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=34865\">[34865]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3436\" onclick=\"get_ticket_and_populate_wrapper('3436'); return false;\" title=\"Batch status update requests for EC2 resources.\">#3436</a></span>) Fix concurrency problem in curl exposed by batching updates.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jan-29 15:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=34786\">[34786]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3436\" onclick=\"get_ticket_and_populate_wrapper('3436'); return false;\" title=\"Batch status update requests for EC2 resources.\">#3436</a></span>) Batch status update requests for dedicated instances and spot requests.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Feb-21 13:25", "status": "resolved", "created": "2013-Jan-11 15:59", "fixed_version": "2013-Jan-11 15:59", "broken_version": "v070900", "priority": "2", "subsystem": "Grid", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "fermi", "visibility": "public", "notify": "tiradani@fnal.gov, tstclair@redhat.com", "due_date": "2013-02-01"}