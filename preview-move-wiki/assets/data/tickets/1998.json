{"id": 1998, "title": "Ticket #1998: Perform RHEL 6 full port of Condor", "description": "<blockquote>\nPerform a full port of Condor to the x86 and x86_64 platform for RHEL 6.\n\n<p>Milestones:\n\n</p><p></p><ol>\n<li><strong>DONE</strong> Does RHEL 5 port work out of the box? Answer: <strong>YES</strong> I informed NMI to install it on the rhel6 machine for now.\n</li><li><strong>DONE</strong> Clipped port of Condor code to RHEL 6, skipping externals that do not build.\n</li><li><strong>DONE</strong> Run cross-test of binaries built on RHEL 5 on RHEL 6. ~2 days\n</li><li><strong>SKIP</strong> Make certain a condor_compile occurs on the RHEL 6 machine. <strong>~?</strong> days. <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=2071\" onclick=\"get_ticket_and_populate_wrapper('2071'); return false;\" title=\"Cross stduniv tests aren't flexible enough\">#2071</a></span> <strong>[rat hole--skipping]</strong>\n</li><li><strong>[DONE]</strong> Get all externals building (5-ish days)\n<ul>\n<li><strong>[DONE]</strong> Get coredumper building. 1 day\n</li><li><strong>[DONE]</strong> Get blahp building. 1 day\n</li><li><strong>[DONE]</strong> Get cream building. 1 day (thanks Jamie!)\n</li><li><strong>[DONE]</strong> Get krb5 building. 1 day\n</li></ul>\n</li><li><strong>[DONE]</strong> Testing of clipped port, fixing discovered problems. ~2 days.\n</li><li><strong>[ON HOLD-no x86 rhel 6 machine in the BatLab]</strong> Port/test to x86. 2 days.\n</li><li><strong>[DONE]</strong> Porting standard universe. 2 months.\n</li></ol>\n\n<p>Record of porting:\n</p><ul>\n<li><strong>Goal</strong> Try and get clipped port to compile\n<ul>\n<li>Using PATH <code>/prereq/autoconf-2.59/bin:/prereq/gzip-1.3.3/bin:/prereq/perl-5.8.5/bin:/prereq/m4-1.4.1/bin:/prereq/wget-1.9.1/bin:/prereq/bison-1.25/bin:/prereq/byacc-1.9/bin:/prereq/make-3.80/bin:/prereq/flex-2.5.4a/bin:/prereq/cmake-2.8.3/bin:/prereq/patch-2.5.4/bin:/prereq/tar-1.14/bin:/usr/local/bin:/bin:/usr/bin:/bin:/usr/bin:/home/condor/execute/dir_27024/userdir:/sw/bin:/sw/sbin:/usr/kerberos/bin:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:/usr/bin/X11:/usr/X11R6/bin:/usr/local/condor/bin:/usr/local/condor/sbin:/usr/local/bin:/bin:/usr/bin:/usr/X11R6/bin:/usr/ccs/bin:/usr/lib/java/bin</code>\n</li><li>These externals failed to build so I turned them off\n<ul>\n<li>Kerberos\n</li><li>Google Coredumper\n</li><li>BLAHP\n</li><li>Cream\n</li></ul>\n</li><li>Finally, it built.\n</li><li>Fixing externals to compile.</li></ul>\n</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Apr-05 16:16:03 by psilord:</em> <br/>\n\nGot preempted by figuring out why compressed checkpoints are failing. So, this got moved a week into the future.\n\n<p></p><hr/>\n<em>2011-Apr-12 10:20:29 by psilord:</em> <br/>\n\nStalled until I finished <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2013\" onclick=\"get_ticket_and_populate_wrapper('2013'); return false;\" title=\"Check 32-bit standalone checkpointing for 7.6.0\">#2013</a></span> and derived tickets.\n\n<p></p><hr/>\n<em>2011-Apr-13 16:21:05 by psilord:</em> <br/>\n\nI finished the preemption and am back on this task now.\n\n<p></p><hr/>\n<em>2011-Apr-26 13:49:17 by psilord:</em> <br/>\n\nThe schedule for this is slipping as I figure out <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=2071\" onclick=\"get_ticket_and_populate_wrapper('2071'); return false;\" title=\"Cross stduniv tests aren't flexible enough\">#2071</a></span> and other work I need doing. So I'm stalling it.\n\n<p></p><hr/>\n<em>2011-May-10 10:42:18 by psilord:</em> <br/>\n\nNow that Condor Week is done, this is back to active. Any by active, I mean stalled, since I have to finish <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=2071\" onclick=\"get_ticket_and_populate_wrapper('2071'); return false;\" title=\"Cross stduniv tests aren't flexible enough\">#2071</a></span> first.\n\n<p></p><hr/>\n<em>2011-May-24 15:51:58 by psilord:</em> <br/>\n\nTo make the coredumper external work, I had to move to revision 31 of the\ncoredumper repo head on 2011/05/24. The non-compile problem I encountered is fixed, just not yet in a released version of that library.\n\n<p></p><hr/>\n<em>2011-May-24 16:37:19 by psilord:</em> <br/>\n\nOk, I pushed the google coredumper fix into V7_6-branch, moving onto the blahp.\n\n<p></p><hr/>\n<em>2011-May-25 13:41:24 by psilord:</em> <br/>\n\nThe blahp seems to build on its own, so we pass that and move on.\n\n<p></p><hr/>\n<em>2011-May-26 14:40:24 by psilord:</em> <br/>\n\nOk, while making krb5 compile, I ran into two issues:\n\n<p></p><ol>\n<li><strong>EAI_NODATA</strong> isn't defined when compiling krb5. It turns out that this is because =getaddrinfo()='s description in distro's header files changed from RFC 2553 to RFC 3943 and didn't provide any backwards compatibility. I'm using code found <a class=\"external\" href=\"http://osdir.com/ml/encryption.kerberos.devel/2005-02/msg00025.html\">here</a> as a workaround. It shouldn't disturn platforms which correctly define EAI_NODATA, and hopfully work on platforms where it isn't defined.\n</li><li>It turns out that source files in &lt;krb5&gt;/src/appl/gssftp/ftpd define and use their own getline() function. It turns out glibc has a definition now uses that name and it has a different prototype. So, I changed the function name and the calling of it in that directory.\n</li></ol>\n\n<p>Fixing these generated two patch files for this external.\n\n</p><p></p><hr/>\n<em>2011-May-26 14:54:01 by psilord:</em> <br/>\n\nJamie hacked upon cream to get it to build and supplied me with a patch, Now I'm just getting it all together and checking it in.\n\n<p></p><hr/>\n<em>2011-May-26 16:27:14 by psilord:</em> <br/>\n\nI organized and committed the patches for the building of krb5 and jamie's cream patch. They've been committed to V7_6-branch and merged to master.\n\n<p></p><hr/>\n<em>2011-May-27 16:36:11 by psilord:</em> <br/>\n\nI've added the clipped port of RHEL 6 x86_64 to the official port list of the V7_6-branch and master.\n\n<p></p><hr/>\n<em>2011-May-31 16:12:51 by psilord:</em> <br/>\n\nI cannot perform the x86 port since there is no x86 rhel 6 machine in batlab. I sent a request to nmi-support to get one. It is [nmi-support #9336].\n\n<p></p><hr/>\n<em>2011-Jun-14 16:37:02 by psilord:</em> <br/>\n\nOk, after some hackery with getting some required packages installed on nmi-v031 which the x86_64 rhel 6 machine, I have gotten rpmbuild -bp to produce a patched version of glibc and rpmbuild -bc to build it. Now I have to extract the configure line and whatnot out of the output of those commands and ensure I can build the glibc package by hand.\n\n<p></p><hr/>\n<em>2011-Jul-12 14:41:22 by psilord:</em> <br/>\n\nCurrent status update for the rhel6 x86_64 port:\n\n<p></p><ol>\n<li>I finished downloading, building, and patching glibc. I left the --enable-static-nss patch is, but left the turn of nscd patch out (until I can figure out if I need it or not). Glibc now builds as an external.\n</li><li>Sprinkled GLIBC212 around in the sources until condor compiled with 'make install'.\n</li><li>Hacked our ld program until 'make tests' worked. I found some likely distro bugs in that 'gcc -static foo.c -lm' doesn't compile and the same problem exists with -lcrypt. At this point the test suite now builds too.\n</li></ol>\n\n<p>I haven't started testing everything though to see if any of it works. :)\n\n</p><p></p><hr/>\n<em>2011-Jul-13 15:38:42 by psilord:</em> <br/>\n\nIt seems that I don't need the nscd glibc patch as all of the checkpoints happened\nproperly and were never deferred.\n\n<p>I fixed up the version mismatch hold reason in the job ad since it bit me that it\nwas so vague.\n\n</p><p>At this time, the x86_64 RHEL 6.1 full port is code complete and passes all of\nthe stduniv tests.\n\n</p><p></p><hr/>\n<em>2011-Jul-14 13:52:13 by psilord:</em> <br/>\n\nI checked it into the V7_6-branch, merged it to V7_7_0-branch, and then to master.\n\n<p>It broke in the nmi bulid, but for reasons that did not originate with me.\nHopefully, those will be resolved soon. When the build goes green, I'll resolve\nthis ticket.\n\n</p><p></p><hr/>\n<em>2011-Jul-27 11:49:56 by psilord:</em> <br/>\n\nThe port is done, the tests pass, this ticket is finished.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=2071\" onclick=\"get_ticket_and_populate_wrapper('2071'); return false;\" title=\"Cross stduniv tests aren't flexible enough\">#2071</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nCross stduniv tests aren't flexible enough</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-19 10:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7481bd0266a917edfcbaa3583f30282009445fda\">[22538]</a></span>: ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1998\" onclick=\"get_ticket_and_populate_wrapper('1998'); return false;\" title=\"Perform RHEL 6 full port of Condor\">#1998</a></span> Converted argument format to what is required on the master.  (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-19 10:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/00a812ace564fa69b76116c5005c82a25d3661ac\">[22536]</a></span>: ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1998\" onclick=\"get_ticket_and_populate_wrapper('1998'); return false;\" title=\"Perform RHEL 6 full port of Condor\">#1998</a></span> Enable our nightlies to build the full port of rhel6 x86_64.  (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-13 15:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dedcf42bfd4eb2c6cfc4ea490d31784bfba1227f\">[22474]</a></span>: ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1998\" onclick=\"get_ticket_and_populate_wrapper('1998'); return false;\" title=\"Perform RHEL 6 full port of Condor\">#1998</a></span> The x86_64_rhap_6.0-updated machine updated itself into x86_64_rhap_6.1-updated. :) So, I fixed up this file to add it to the official ports. I removed the comment about the CLIPPED port for this paltform since A) cmake fgures it out if it needs, and B) the full port now actually exists.\u00a0[...]\n (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-13 15:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/245b35de7d44862749d54b3054ca4cdcd338694d\">[22472]</a></span>: ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1998\" onclick=\"get_ticket_and_populate_wrapper('1998'); return false;\" title=\"Perform RHEL 6 full port of Condor\">#1998</a></span> Increased the detail of the hold reason for a standard universe job whose shadow doesn't want to act on behalf of it since the versions don't match.\u00a0[...]\n (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-13 15:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6d4f654c90dc6f80757640c84c6a1b4117fd88cc\">[22471]</a></span>: ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1998\" onclick=\"get_ticket_and_populate_wrapper('1998'); return false;\" title=\"Perform RHEL 6 full port of Condor\">#1998</a></span> Fixed Condor's ld script to ignore -ldl, --as-needed, --no-as-needed, and -dynamic-linker &lt;arg&gt; since we do not produce any dynamically linked executables. It is ok that these are elided for all environments that condor_compile may execute in [such as rhel3, rhel5, rhel6, etc].\u00a0[...]\n (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-11 17:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/22f6bc32e3b33107b41c4ffe8af145c3297906e7\">[22469]</a></span>: Went to all places where GLIBC27 was being used and saw if GLIBC212 could be used there too. It turns out that this is true (to the best of my knowledge of the rhel 6 x86_64 full port at this time). At this checkin, the full port of Condor RHEL 6 x86_64 franks. However, I have not tested to see if the\u00a0[...]\n (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-11 17:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/afada8ed4d248524946693563416da12c1afac77\">[22468]</a></span>: Added x86_64 glibc external for full port compilation of RHEL 6 x86_64. I got it and figured out how it built like this:\u00a0[...]\n (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-27 16:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c962b613876b58123e2ec2ac8b2769a7923e35e7\">[22010]</a></span>: Adding the clipped build of the RHEL 6 x86_64 port into the offical ports of Condor. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1998\" onclick=\"get_ticket_and_populate_wrapper('1998'); return false;\" title=\"Perform RHEL 6 full port of Condor\">#1998</a></span>  (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-27 10:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4c24033440f0a197c5b2493ae642258c9f52be83\">[22005]</a></span>: While I need the 2011/05.24-r31 coredumper external to compile on rhel6, it turns out it doesn't compile on rhel 3 x86_64. And the 0.2 version rhel 3 was compiling doesn't compile on rhel 6. So I need both. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1998\" onclick=\"get_ticket_and_populate_wrapper('1998'); return false;\" title=\"Perform RHEL 6 full port of Condor\">#1998</a></span>  (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-26 16:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/562f8e0acd743811820c7e1dec0cb5b0eb83ba3f\">[22000]</a></span>: A patch file was created which implements a minor change to get the creamsoap external for compilation on RHEL 6. It turns out that gcc 4.4 doesn't allow a strchr() of a const char* function to be assigned to just a char *. This is for ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1998\" onclick=\"get_ticket_and_populate_wrapper('1998'); return false;\" title=\"Perform RHEL 6 full port of Condor\">#1998</a></span>. Committer: Peter Keller  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-26 16:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8a9a578ad4c67ceb3ebcbb13de66fdb56bc51b8e\">[21999]</a></span>: When compiling this ancient crusty version of krb5 (1.4.3-p0) on RHEL 6, there were two problems: Problem 1: It seems that the RHEL 6 header file for getaddrinfo changed from RFC 2553 to RFC 3943 and didn't provide any backwards compatibility. So this meant that EAI_NODATA ceased to be defined. I searched\u00a0[...]\n (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-26 11:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4b114c0d5f8210b986337938f06b3b7633cab31c\">[21987]</a></span>: Updated the google coredumper external to the head of the coredumper repo on 05/24/2011, svn revision 31. This fixes a compilation bug on RHEL 6. Sadly, there wasn't a released version of the coredumper which included this fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1998\" onclick=\"get_ticket_and_populate_wrapper('1998'); return false;\" title=\"Perform RHEL 6 full port of Condor\">#1998</a></span>  (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-24 16:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7a7123c33a54575219bd2e2d5c45e9dabf5551c6\">[21974]</a></span>: Updated the google coredumper external to the head of the coredumper repo on 05/24/2011, svn revision 31. This fixes a compilation bug on RHEL 6. Sadly, there wasn't a released version of the coredumper which included this fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1998\" onclick=\"get_ticket_and_populate_wrapper('1998'); return false;\" title=\"Perform RHEL 6 full port of Condor\">#1998</a></span>  (By Peter Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-21 11:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b0362703466db0c8727b03ab681c377d36adc3b4\">[21471]</a></span>: Renamed the rhel 6 keys to be their real names. I messed it up due to a perfectly coincidental formatting error when I read the output of another tool. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1998\" onclick=\"get_ticket_and_populate_wrapper('1998'); return false;\" title=\"Perform RHEL 6 full port of Condor\">#1998</a></span>  (By Pete Keller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-19 14:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/73467f6f49bba21839b33bc6ddfd21b7b2ec653d\">[21445]</a></span>: Add basic entries for RHEL 6. We cross test rhel5 onto it too. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1998\" onclick=\"get_ticket_and_populate_wrapper('1998'); return false;\" title=\"Perform RHEL 6 full port of Condor\">#1998</a></span>  (By Pete Keller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Jul-27 11:52", "status": "resolved", "created": "2011-Mar-24 14:48", "fixed_version": "2011-Mar-24 14:48", "broken_version": "", "priority": "2", "subsystem": "", "assigned_to": "psilord", "derived_from": "", "creator": "psilord", "rust": "", "customer_group": "other", "visibility": "public", "notify": "psilord@cs.wisc.edu", "due_date": "20110815"}