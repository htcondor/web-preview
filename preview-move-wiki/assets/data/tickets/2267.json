{"id": 2267, "title": "Ticket #2267: RFE: earlier spin halting when zero pie left", "description": "<blockquote>\nthere looks like a performance tweak can be made in the pieleft logic.\nIn negotiateWithGroup, we enter the do{ negotiate() } while (pieleft..) loop\nand calculate pieleft at the top of the loop. We continue within this loop and\neventually hit negotiate even if pieleft==0 &amp;&amp; ConsiderPreemption==false. The\ntweak would be break on (pieleft==0 &amp;&amp; ConsiderPreemption==false).</blockquote>", "remarks": "<blockquote>\n<em>2011-Jul-12 18:16:24 by eje:</em> <br/>\n\nrepro/test\n\n<p>Using following configuration (no group quotas):\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">CLAIM_WORKLIFE = 0\nNEGOTIATOR_CONSIDER_PREEMPTION = FALSE\nNEGOTIATOR_DEBUG = D_FULLDEBUG\n\nNEGOTIATOR_INTERVAL = 30\nSCHEDD_INTERVAL = 15\n\nNUM_CPUS = 5\n</pre></div>\n\n\n<p>Before fix:  Spool up a condor pool.  No job submissions are required.  Observe output of negotiator log, see that loop proceeds when pie left is zero:\n</p><div class=\"code\">\n<pre class=\"code\">$ tail -f NegotiatorLog | grep -e 'Started.*Cycle' -e 'Phase 4' -e 'pieLeft ='\n07/12/11 15:31:18 ---------- Started Negotiation Cycle ----------\n07/12/11 15:31:18 Phase 4.1:  Negotiating with schedds ...\n07/12/11 15:31:18     pieLeft = 0.000\n07/12/11 15:31:48 ---------- Started Negotiation Cycle ----------\n07/12/11 15:31:48 Phase 4.1:  Negotiating with schedds ...\n07/12/11 15:31:48     pieLeft = 0.000\n</pre></div>\n\n\n<p>After fix: see that loop halts early:\n</p><div class=\"code\">\n<pre class=\"code\">$ tail -f NegotiatorLog | grep -e 'Started.*Cycle' -e 'Phase 4' -e 'pieLeft ='\n07/12/11 15:35:14 ---------- Started Negotiation Cycle ----------\n07/12/11 15:35:44 ---------- Started Negotiation Cycle ----------\n07/12/11 15:36:14 ---------- Started Negotiation Cycle ----------\n</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/408/gt2267.patch\">gt2267.patch</a>\n494 bytes added by tstclair on 2011-Jul-07 18:55:14 UTC.\n<br/>\npatch made based on comments. <br/>\n</li><li><a href=\"../files/411/gt2267-zero-pie-halt.patch\">gt2267-zero-pie-halt.patch</a>\n572 bytes added by eje on 2011-Jul-12 23:12:07 UTC.\n<br/>\nAdds earlier halt on zero pie left condition.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Jul-12 18:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bbd449d4f2082a77d37f15f1fd58dd9efb525717\">[22433]</a></span>: ===VersionHistory=== Added logic for earlier halting of negotiation loop on zero pie-left condition. ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2267\" onclick=\"get_ticket_and_populate_wrapper('2267'); return false;\" title=\"RFE: earlier spin halting when zero pie left\">#2267</a></span>  (By Erik Erlandson )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Jul-12 18:20", "status": "resolved", "created": "2011-Jun-24 13:26", "fixed_version": "2011-Jun-24 13:26", "broken_version": "v070600", "priority": "3", "subsystem": "Daemons", "assigned_to": "eje", "derived_from": "", "creator": "eje", "rust": "", "customer_group": "other", "visibility": "public", "notify": "eje@cs.wisc.edu, dan@hep.wisc.edu, jthomas@redhat.com, tstclair@redhat.com", "due_date": ""}