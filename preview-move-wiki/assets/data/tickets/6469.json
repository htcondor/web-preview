{"id": 6469, "title": "Ticket #6469: condor_q batch mode reports incorrect value for DONE", "description": "<blockquote>\nWhen displaying -batch mode (the default) for a set of non-dag jobs in which more than a single cluster shares a batch-name, the value reported in the DONE column will sometimes be incorrect.  It appears the the total for a single cluster is being used for the calculation of the done quantity.\n\n<p></p><div class=\"term\">\n<pre class=\"term\">[johnkn@submit-4 sleep]$ condor_q -job bad.ads\n\n\n-- Jobads: bad.ads @ 10/31/17 12:20:36\nOWNER  BATCH_NAME         SUBMITTED   DONE   RUN    IDLE  TOTAL JOB_IDS\njohnkn CMD: /bin/sleep  10/31 12:17      1      6      _     10 4556393.1 ... 4556394.4\n\nTotal for query: 6 jobs; 0 completed, 0 removed, 0 idle, 6 running, 0 held, 0 suspended\n\n[johnkn@submit-4 sleep]$ condor_q -job bad.ads 4556394\n\n\n-- Jobads: bad.ads @ 10/31/17 12:20:36\nOWNER  BATCH_NAME         SUBMITTED   DONE   RUN    IDLE  TOTAL JOB_IDS\njohnkn CMD: /bin/sleep  10/31 12:17      2      3      _      5 4556394.1-4\n\nTotal for query: 3 jobs; 0 completed, 0 removed, 0 idle, 3 running, 0 held, 0 suspended\n\n[johnkn@submit-4 sleep]$ condor_q -job bad.ads 4556393\n\n\n-- Jobads: bad.ads @ 10/31/17 12:20:36\nOWNER  BATCH_NAME         SUBMITTED   DONE   RUN    IDLE  TOTAL JOB_IDS\njohnkn CMD: /bin/sleep  10/31 12:17      2      3      _      5 4556393.1-4\n\nTotal for query: 3 jobs; 0 completed, 0 removed, 0 idle, 3 running, 0 held, 0 suspended\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2017-Dec-20 12:08:43 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>: Looks good.  Note: The DONE column can still be \"incorrect\", because it is calculated using the information available from the SchedD at the time condor_q was run.  Once a cluster of jobs leaves the queue, we no longer have information about it.  So while we still won't necessarily have exact information for the DONE column, this change makes the displayed value better reflect the available information, so I sign off on it.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Dec-13 09:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52989\">[52989]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6469\" onclick=\"get_ticket_and_populate_wrapper('6469'); return false;\" title=\"condor_q batch mode reports incorrect value for DONE\">#6469</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Nov-02 10:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52751\">[52751]</a></span>: fix <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6469\" onclick=\"get_ticket_and_populate_wrapper('6469'); return false;\" title=\"condor_q batch mode reports incorrect value for DONE\">#6469</a></span>. condor_q done amount wrong when multiple clusters share a batch name. ===VersionHistory:Done===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Dec-20 12:09", "status": "resolved", "created": "2017-Nov-01 11:06", "fixed_version": "2017-Nov-01 11:06", "broken_version": "", "priority": "3", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "", "due_date": ""}