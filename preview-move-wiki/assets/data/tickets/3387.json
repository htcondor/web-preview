{"id": 3387, "title": "Ticket #3387: Can't remove EC2 jobs with invalid authentication.", "description": "<blockquote>\nAttempts to remove a job with invalid authentication will fail, as the job will go back on hold when RunInstances() or DescribeInstances() is called during recovery.  Jaime suggests recording in the resource object, which can already tell if a ping failed because of an authentication failure, when such has happened, and, in the EC2 job object, checking before even entering the state machine [or at least before creating the client token] (but after waiting for the first ping to complete) if an authentication failure has occurred.  If so, by never calling RunInstances() (and never creating a client token), we know that no instance could have been started, and it's safe not to record anything about the job -- allowing the schedd to remove it on its own.</blockquote>", "remarks": "<blockquote>\n<em>2013-Jan-10 14:01:01 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p></p><ul>\n<li>Whether or not the first ping for a resource is done is already\navailable to job objects via BaseJob::resourceStateKnown.\nWe could replace resourceStateKnown with didFirstPing(), which is more\nspace-efficient and easier to understand.\n\n<p></p></li><li>You don't need to set <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=HoldReason\" title=\"Hold Reason\">HoldReason</a></span> in the job ad in the GM_INIT state.\nIn GM_HOLD, the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=HoldReason\" title=\"Hold Reason\">HoldReason</a></span> will be taken from errorString if it's\nnon-empty.\n\n<p></p></li><li>In the GM_INIT state, I don't believe you can go to GM_DELETE for\nall REMOVED jobs. We can end up orphaning instances and ssh keypairs.</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jan-15 11:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b84ab3b6c9f7076f7bcca5f2b445637b5dcaa9fa\">[34648]</a></span>: minor edits to 3 7.9.3 version history items ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3287\" onclick=\"get_ticket_and_populate_wrapper('3287'); return false;\" title=\"Invalid submissions to EC2 can't be removed.\">#3287</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3387\" onclick=\"get_ticket_and_populate_wrapper('3387'); return false;\" title=\"Can't remove EC2 jobs with invalid authentication.\">#3387</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3369\" onclick=\"get_ticket_and_populate_wrapper('3369'); return false;\" title=\"glexec fails in 7.9.2\">#3369</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jan-14 16:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d7e44170fd6e2a0e79babaf358fc306a75091683\">[34637]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3287\" onclick=\"get_ticket_and_populate_wrapper('3287'); return false;\" title=\"Invalid submissions to EC2 can't be removed.\">#3287</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3387\" onclick=\"get_ticket_and_populate_wrapper('3387'); return false;\" title=\"Can't remove EC2 jobs with invalid authentication.\">#3387</a></span>) Version history entries.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jan-14 16:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/201dbc25e5187b46cfc02ee55cfe6b78e2ad33c3\">[34636]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3287\" onclick=\"get_ticket_and_populate_wrapper('3287'); return false;\" title=\"Invalid submissions to EC2 can't be removed.\">#3287</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3387\" onclick=\"get_ticket_and_populate_wrapper('3387'); return false;\" title=\"Can't remove EC2 jobs with invalid authentication.\">#3387</a></span>) Add version history items.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jan-14 16:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bea602e54d5378a9b1684031a709a0738fc1b1b9\">[34635]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3387\" onclick=\"get_ticket_and_populate_wrapper('3387'); return false;\" title=\"Can't remove EC2 jobs with invalid authentication.\">#3387</a></span>) Don't set the hold message superfluously; only delete jobs without any remote identifiers.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Dec-19 15:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0a78ab3be60ee7cfa9fb22bef8106ff52397866f\">[34441]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3387\" onclick=\"get_ticket_and_populate_wrapper('3387'); return false;\" title=\"Can't remove EC2 jobs with invalid authentication.\">#3387</a></span>) Permit jobs with invalid authentication to be removed.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Jan-14 16:43", "status": "resolved", "created": "2012-Dec-18 11:47", "fixed_version": "2012-Dec-18 11:47", "broken_version": "", "priority": "2", "subsystem": "Grid", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}