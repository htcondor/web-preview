{"id": 5253, "title": "Ticket #5253: Blahp thread limit can kill gridmanager", "description": "<blockquote>\nThe blahp has a limit on the number of non-trivial commands that can be in active at a time. The limit is set via the parameter blah_max_threaded_cmds in the blah config file. The default is 500. The gridmanager has a limit on the number of commands it will issue to the blahp at a time. This limit is set via the parameter GRIDMANAGER_MAX_PENDING_REQUESTS in the HTCondor config file. The default is 50. If the blahp's limit is set lower than the gridmanager's limit, then a command to the blahp can fail with the message \"Threads limit reached\". The failure occurs in the immediate response to the command, not the eventual result line. This is a fatal error in the gridmanager, which immediately exits.\n\n<p>The system needs to deal with conflicting values for these limits more gracefully. When the gridmanager receives the \"Threads limit reached\" error, it could retry the command some time later. When the blahp receives a command that would exceed its limit, it could queue up the additional command(s) in memory until some active commands complete.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Oct-22 14:03:59 by tlmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Looks good.  I'm excited that GahpOverloadError() is its own function, since it means we could define other rate-limiting responses for other GAHPs easily...</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-22 10:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=46070\">[46070]</a></span>: Gridmanager should react gracefully to overloaded gahp server. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5253\" onclick=\"get_ticket_and_populate_wrapper('5253'); return false;\" title=\"Blahp thread limit can kill gridmanager\">#5253</a></span> If a gahp rejects a request because it is overloaded, the gridmanager now lowers its limit on pending requests for that gahp instance and retries the request when some previous requests complete. At present, the gridmanager recognizes\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-22 10:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=46071\">[46071]</a></span>: Docs for retry of blahp requests in the gridmanager. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5253\" onclick=\"get_ticket_and_populate_wrapper('5253'); return false;\" title=\"Blahp thread limit can kill gridmanager\">#5253</a></span>  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "incident", "last_change": "2015-Oct-22 14:06", "status": "resolved", "created": "2015-Sep-09 14:59", "fixed_version": "2015-Sep-09 14:59", "broken_version": "v080200", "priority": "2", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "#5045", "creator": "jfrey", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "blin@cs.wisc.edu", "due_date": ""}