{"id": 5205, "title": "Ticket #5205: Sinfuls in HOST_[ALLOW|DENY] lists don't work.", "description": "<blockquote>\nMoate reports:\n\n<p></p><div class=\"verbatim\">\n<pre>The crux of the issue seemed to be the following string that was\nadded to FLOCK_TO on submit-3:\n\nrccf-osg.ci-connect.net:11012?sock=collector\n</pre></div>\n\n...\n<div class=\"verbatim\">\n<pre>ALLOW_NEGOTIATOR_SCHEDD included the FLOCK_TO strings, but\n\"rccf-osg.ci-connect.net:11012?sock=collector\" didn't make\nany sense to this setting (the hostname alone would have, or\nthe principal of the OSG Connect certificate).  I corrected\nit to include the principal of the certificate for\nrccf-osg.ci-connect.net.\n</pre></div>\n\n\n<p>We should make two fixes: first, in our DNS wrapper, check to see if the string we're looking up includes a ? or is otherwise a valid sinful; and second, to explicitly recognize sinfuls in security lists and treat them appropriately.\n\n</p><p>IIRC, ? is never a legal character in a domain, so it will never hurt to assume the string is a sinful instead.  If the sinful is valid, we can then extract IP addresses from it.  (Obviously, if the host portion of the string isn't an IP literal, we return all of those IPs; should we also return the sinful's addrs IPs, the private network IP, the tcp_forwarding_host?  Probably?)\n\n</p><p>There is not a (safe) host-based solution for private-address machines behind CCB, so we can safely ignore that complication for now.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Aug-10 15:16:36 by tlmiller:</em> <br/>\n\nAfter extensive discussion, what we're going to do is detect Sinfuls, warn about them, and do nothing with them -- in both the security code and the DNS code.  In 8.4, you won't need to specify to shared port ID anyway.\n\n<p></p><hr/>\n<em>2015-Sep-30 10:43:06 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>: Looks good.  Since we found this problem ourselves and fixed it before anyone else was affected I would argue we don't need any version history.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-11 13:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=45575\">[45575]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5205\" onclick=\"get_ticket_and_populate_wrapper('5205'); return false;\" title=\"Sinfuls in HOST_[ALLOW|DENY] lists don't work.\">#5205</a></span>) Reject Sinfuls if looked up as hostnames or included in security lists.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Sep-30 10:43", "status": "resolved", "created": "2015-Aug-06 16:06", "fixed_version": "2015-Aug-06 16:06", "broken_version": "", "priority": "4", "subsystem": "Libs", "assigned_to": "zmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, tannenba@cs.wisc.edu, moate@cs.wisc.edu, nyehle@cs.wisc.edu", "due_date": ""}