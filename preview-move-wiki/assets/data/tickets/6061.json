{"id": 6061, "title": "Ticket #6061: fd_set bounds checking can cause abort in Selector class", "description": "<blockquote>\nIn recent versions of linux, the FORTIFY_SOURCE compiler flag adds a run-time array bounds check that causes an abort if a call to FD_SET() and friends would index past the end of a single fd_set. This is causing problems in our Selector class, which uses an array of fd_sets with FD_SET() to support file descriptor values too large to fit in a single fd_set (default limit of 1024).\n\n<p>In HTCondor 8.2, we removed the FORTIFY_SOURCE flag for the Selector class's source file. We want a better fix that lets us keep the flag enabled. We can define a modified form of FD_SET() (and related macros) that calculates the address of the desired fd_set within the array of fd_sets and the offset within that fd_set, and invokes the real FD_SET() with those values.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Jan-20 11:25:53 by tim:</em> <br/>\n\n<strong>CODE REVIEW:</strong> Looks fine</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Dec-20 13:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/35ebf09382afbdcf5e14ec985dc449ae2ff636d4\">[49849]</a></span>: Re-enable FORTIFY_SOURCE for the Selector class. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6061\" onclick=\"get_ticket_and_populate_wrapper('6061'); return false;\" title=\"fd_set bounds checking can cause abort in Selector class\">#6061</a></span> Now that we have a tailored solution to avoid triggering the bounds array check in FD_SET(), we can re-enable FORTIFY_SOURCE for its other benefits.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Dec-20 13:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c75efbbe82f9f2a40833257dc01673c296623d6b\">[49848]</a></span>: fd_set bounds checking can cause abort in Selector class <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6061\" onclick=\"get_ticket_and_populate_wrapper('6061'); return false;\" title=\"fd_set bounds checking can cause abort in Selector class\">#6061</a></span> On some configurations of linux, FD_SET() will abort if given a file descriptor value that will index past the end of one fd_set structure. We do this safely in the Selector class by using any array of fd_sets. To avoid triggering the bounds\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Jan-20 11:26", "status": "resolved", "created": "2016-Dec-20 09:30", "fixed_version": "2016-Dec-20 09:30", "broken_version": "v080400", "priority": "2", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "#5240", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}