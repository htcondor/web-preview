{"id": 6957, "title": "Ticket #6957: Schedd on Windows restarts with \"fd_set is full\" message", "description": "<blockquote>\nA customer reports that their Schedd restarted with the message:\n\n<p></p><div class=\"snip\">\n<pre class=\"sniplabel\">ScheddLog fragment</pre>\n<pre class=\"snip\">SchedLog:\n03/13/19 11:54:26 (pid:50392) Started shadow for job 360443.0 on &lt;172.18.6.202:9618?addrs=172.18.6.202-9618&amp;noUDP&amp;sock=2848_48f4_3&gt; for szymonk, (shadow pid = 24824)\n03/13/19 11:54:26 (pid:50392) ERROR \"Selector::add_fd(): read fd_set is full\" at line 208 in file C:\\condor\\execute\\dir_5536\\sources\\src\\condor_utils\\selector.cpp\n03/13/19 11:54:26 (pid:50392) Cron: Killing all jobs\n03/13/19 11:54:26 (pid:50392) CronJobList: Deleting all jobs\n03\n</pre></div>\n\n\n<p>We believe that this is a bug specific to Windows, caused by a change to remove the 20% headroom that we used to reserve in the fd_set on Windows.  This much headroom is not needed, since the fd_set is <strong>only</strong> used for sockets on Windows.  But we changed the amount of headroom to 0, which appears to be causing problems because not all code in condor checks the limit.  And also because we may need to account for the special socket we use to do <code>WakeUpSelect</code>.\n\n</p><p>We should change the <code>FileDescriptorSafetyLimit</code> on Windows to have a small amount of headroom, perhaps 10.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Mar-25 14:37:49 by tim:</em> <br/>\n\n<strong>CODE REVIEW</strong>: Trival change, LGTM</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Apr-08 16:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56521\">[56521]</a></span>: Version history for several issues with Windows restart, reconfig and shutdown. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6952\" onclick=\"get_ticket_and_populate_wrapper('6952'); return false;\" title=\"shared port + procd on Windows causes the master to fail to restart\">#6952</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6957\" onclick=\"get_ticket_and_populate_wrapper('6957'); return false;\" title='Schedd on Windows restarts with \"fd_set is full\" message'>#6957</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6960\" onclick=\"get_ticket_and_populate_wrapper('6960'); return false;\" title=\"shared port on Windows can make damons slow to notice signals\">#6960</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Mar-19 09:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56382\">[56382]</a></span>: Add some headroom to the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileDescriptorSafetyLimit\" title=\"File Descriptor Safety Limit\">FileDescriptorSafetyLimit</a></span> on Windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6957\" onclick=\"get_ticket_and_populate_wrapper('6957'); return false;\" title='Schedd on Windows restarts with \"fd_set is full\" message'>#6957</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Apr-08 16:43", "status": "resolved", "created": "2019-Mar-14 15:07", "fixed_version": "2019-Mar-14 15:07", "broken_version": "v080800", "priority": "2", "subsystem": "", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "s96479", "customer_group": "support", "visibility": "public", "notify": "", "due_date": ""}