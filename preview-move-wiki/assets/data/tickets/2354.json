{"id": 2354, "title": "Ticket #2354: Statistics in DaemonCore", "description": "<blockquote>\nImplement the following statistics in Daemon Core\n\n<p>The following will always be published.\n</p><div class=\"verbatim\">\n<pre>DaemonCoreDutyCycle      double   ratio of time spent in select verses elapsed time over the lifetime of the daemon\nRecentDaemonCoreDutyCycle      double   ratio of time spent in select verses elapsed time over the recent time window\n</pre></div>\n\n\n<p>The following will be enabled when the Daemon Core publishing level declared in <code>STATISTICS_TO_PUBLISH</code> is &gt;= 1\n</p><div class=\"verbatim\">\n<pre>DCStatsLifetime           RelTime   total time the daemon has been collecting statistics. (uptime)\nDCRecentStatsLifetime     RelTime   time represented by statics values who's names begin with RecentDC (recent window)\nDCSelectWaittime          RelTime   total time spent waiting in select\nDCSignalRuntime           RelTime   total time spent handling signals\nDCTimerRuntime            RelTime   total time spent handling timers\nDCSocketRuntime           RelTime   total time spent handling socket messages\nDCPipeRuntime             RelTime   total time spent handling pipe messages\nDCSignals                 int       number of signals handlers called\nDCTimersFired             int       number of timer handlers called\nDCSockMessages            int       number of socket handlers called\nDCPipeMessages            int       number of pipe handlers called\n</pre></div>\n\n\n<p>The following will be enabled when the Daemon Core publishing level declared in <code>STATISTICS_TO_PUBLISH</code> is &gt;= 2\n</p><div class=\"verbatim\">\n<pre>DCStatsLastUpdateTime     AbsTime   time of last update of DCxxxx statistics values\nDCRecentStatsTickTime     AbsTime   time of last update of RecentDCxxxx statistics values\nDCRecentWindowMax         RelTime   maximum size of Recent Window\nDCDebugOuts               int       number of dprintf calls that were written to output.\nDCPumpCycleCount          int       numer of times the Daemon core main loop has cycled.\nDCPumpCycleSum            double    Total number of seconds spent in the daemon core main loop.\nDCPumpCycleMin            double    Minimum number of seconds of a single cycle of the daemon core pump\nDCPumpCycleMin            double    Maximum number of seconds of a single cycle of the daemon core pump\nDCPumpCycleAvg            double    Average number of seconds of a single cycle of the daemon core pump\n</pre></div>\n\n\n<p>each registering Daemon Core handler will have 2 statistics values with an overall and Recent for each.\n\n</p><p></p><div class=\"verbatim\">\n<pre>DC{Type}_{handler}        int       number of times the handler has been called\nDC{Type}_{handler}Runtime double    seconds that the handler spent running\n</pre></div>\n\n\n<p><code>{Type}</code> can be \"Signal\" \"Socket\" \"Pipe\" or \"Timer\" (Timer not yet implemented).\n<code>{handler}</code> is the handler_descrip string passed at registration.\n\n</p><p>Each counter will have a corresponding <code>Recent</code> timer that shows the counts from the latest <code>DCRecentStatsLifetime</code> seconds.\n\n</p><p>For instance the master typically has the following two dynamic statistics\n</p><div class=\"verbatim\">\n<pre>DCSignal_handle_dc_sigquit = 0\nDCSignal_handle_dc_sigquitRuntime = 0.0\nRecentDCSignal_handle_dc_sigquit = 0\nRecentDCSignal_handle_dc_sigquitRuntime = 0.0\nDCSocket_DCCommandHandler = 216\nDCSocket_DCCommandHandlerRuntime = 0.155999\nRecentDCSocket_DCCommandHandler = 0\nRecentDCSocket_DCCommandHandlerRuntime = 0.0\n</pre></div>\n\nand several others.\n\n<p>the following are desired, but too much work to implement at this time\n</p><div class=\"verbatim\">\n<pre>DCSockBytes               int       number of bytes passed though the socket\nDCPipeBytes               int       number of bytes passed though the socket\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=2454\" onclick=\"get_ticket_and_populate_wrapper('2454'); return false;\" title=\"Daemon Core Handler Statistics need better names\">#2454</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDaemon Core Handler Statistics need better names</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-11 13:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/57dcba4a8402f2035c195a3ec2ea892ff450b234\">[27769]</a></span>: add placeholders for where definitions of new attributes need to placed. Documentation not yet done! ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-30 10:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/834065cac3b00bee00d8f13b373526d4f51a4f22\">[27539]</a></span>: Fix bug in Unpublish for stats_recent_counter_timer and stats_entry_recent&lt;Probe&gt; that left some verbose-mode <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> statistics behind after an unpublish. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span> ===VersionHistory:Pending=== Note: bug shipped in 772 but verbose statistics are not on by default and bug does not harm proper\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-22 09:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8ed48625dac609931593ded1593d6b08249e00a0\">[27325]</a></span>: Fix bug in Unpublish for stats_recent_counter_timer and stats_entry_recent&lt;Probe&gt; that left some verbose-mode <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> statistics behind after an unpublish. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span> ===VersionHistory:Pending=== Note: bug shipped in 772 but verbose statistics are not on by default and bug does not harm proper\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-19 12:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0b8ff829203dc1cb2e13f0766f9215baa52c15d1\">[27288]</a></span>: Add <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCoreDutyCycle\" title=\"Daemon Core Duty Cycle\">DaemonCoreDutyCycle</a></span> to daemon core stats <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span>. and change default publishing flags for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> stats so that it is the only one published by default. Also add a new verbose daemon core statistic DCPumpCycle which is a full Probe of the daemon core pump with min/max/avg/std time for each cycle\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-16 14:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a2d705c84d7a23aedf5e994fe8a4fdcd9862cbe8\">[27262]</a></span>: Add per-handler runtime statistics for daemon core timers <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span> ===VersionHistory:None=== this is part of general daemon core stats, no separate Version History  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-13 13:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/82808768e25619b6eb71b1467f61757cc793a583\">[27232]</a></span>: disable <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=PublishDebug\" title=\"Publish Debug\">PublishDebug</a></span> for DC Statistics (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span>) and change default window size for schedd statistics (<span class=\"ticket\"><a class=\"stalled\" href=\"/tickets?ticket=2197\" onclick=\"get_ticket_and_populate_wrapper('2197'); return false;\" title=\"General statistics architecture for Condor\">#2197</a></span>) from 5 min to 20 min. ===VersionHistory:None=== code has not yet shipped  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-09 11:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5dc96da67b9e0478fa25f19b43e5d354bd0b095a\">[27145]</a></span>: Fix bug in dynamic DC statistics <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span> where <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SetRecentMax\" title=\"Set Recent Max\">SetRecentMax</a></span> was never called ===VersionHistory:None=== bug never shipped.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-08 16:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/42b448a6a4343ac8e05bebcc755b807b71624ab8\">[27130]</a></span>: fix bug in daemon core statistics <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span> where probes of type stats_recent_counter_timer did not advance when placed in a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StatisticsPool\" title=\"Statistics Pool\">StatisticsPool</a></span> ===VersionHistory:None=== the bug has never shipped.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-07 14:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/00cbef705aae9ca193f784edba24cb8d2fe96b2f\">[27116]</a></span>: Created generic <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StatisticsPool\" title=\"Statistics Pool\">StatisticsPool</a></span> class (<span class=\"ticket\"><a class=\"stalled\" href=\"/tickets?ticket=2197\" onclick=\"get_ticket_and_populate_wrapper('2197'); return false;\" title=\"General statistics architecture for Condor\">#2197</a></span>) and modifed schedd_stats and daemoncore stats (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span>) to use it. removed code made obsolete as a result.\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-07 12:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/326ee34552cc7fb57db8303f0963d07ccbf5a893\">[27113]</a></span>: remove dead code for static publishing tables from generic statistics <span class=\"ticket\"><a class=\"stalled\" href=\"/tickets?ticket=2197\" onclick=\"get_ticket_and_populate_wrapper('2197'); return false;\" title=\"General statistics architecture for Condor\">#2197</a></span> move experimental Probe class from daemon core to generic statistics <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Sep-06 13:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8f9a87bbeb778df574d061fc58b1db044052f2c9\">[27099]</a></span>: remove dead code for daemon core stats <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span> and move code to clean a string for use as an attrib name to classad_helpers.cpp. ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-31 16:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b2ad873dc178cec27733057c9d7b8f76a9c78134\">[27047]</a></span>: remove dead code from generic stats <span class=\"ticket\"><a class=\"stalled\" href=\"/tickets?ticket=2197\" onclick=\"get_ticket_and_populate_wrapper('2197'); return false;\" title=\"General statistics architecture for Condor\">#2197</a></span> and Daemon Core stats <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-30 20:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e714eefa34c14f9f8296dc814c77dc40c7aa8e9f\">[27036]</a></span>: create a generic statistics pool class <span class=\"ticket\"><a class=\"stalled\" href=\"/tickets?ticket=2197\" onclick=\"get_ticket_and_populate_wrapper('2197'); return false;\" title=\"General statistics architecture for Condor\">#2197</a></span> and refactor DC statistics to use it. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-29 12:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f11f1997ce3873e8a12e466a269767addba25b89\">[27011]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span> ===VersionHistory=== Attributes added to all daemons to publish statstics about timers, signals, etc.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-25 15:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/89e34e487de4daad4763ea1a735e14afb92a7848\">[26984]</a></span>: rearranged code and runtime variables from time_t to double to make stats code build on rhel3 <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-24 16:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fd3b1f857c9c99705e05a7933879186fb1ca23b5\">[26964]</a></span>: Add pool of dynamic named statistics entries to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span> also refactor generic statistics (<span class=\"ticket\"><a class=\"stalled\" href=\"/tickets?ticket=2197\" onclick=\"get_ticket_and_populate_wrapper('2197'); return false;\" title=\"General statistics architecture for Condor\">#2197</a></span>) to allow greater flexibilty and type safety in support of dynamic named statistics. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-17 16:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fd2fc36e0ddc9576d3cb3c5eeb417917e25a0274\">[26832]</a></span>: fixes for DC statistics <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span> so that the code builds in linux. also fix some indenting in condor_daemon_core.h. ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-17 12:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f88ad9789c512fa7d6104c2993f5949244855368\">[26825]</a></span>: Add statistics for the main loop of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2354\" onclick=\"get_ticket_and_populate_wrapper('2354'); return false;\" title=\"Statistics in DaemonCore\">#2354</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Jan-29 13:59", "status": "resolved", "created": "2011-Aug-04 12:33", "fixed_version": "2011-Aug-04 12:33", "broken_version": "", "priority": "3", "subsystem": "Daemons", "assigned_to": "nwp", "derived_from": "#2197", "creator": "nwp", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com", "due_date": "20110930"}