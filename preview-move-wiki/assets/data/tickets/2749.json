{"id": 2749, "title": "Ticket #2749: Any condor tool or daemon can get into an infinite loop on startup", "description": "<blockquote>\nFrom time to time in new batlab, we see the cgahp-worker-thread stuck in an infinite loop consuming memory.\n\n<p>strace shows:\n\n</p><p>rename(\"/tmp/CGAHPWorkerLog.slot1.old\", \"/tmp/CGAHPWorkerLog.slot9.old\") = -1 EPERM (Operation not permitted)\n\n</p><p>over and over again, even though this is running as slot9\n\n</p><p>Part of the problem is an off-by-one error in isLogFilename() in log_rotate.cpp. The third argument to the strncmp() is one too small. So when looking for log files of the form <code>CGAHPLog.slot9.*</code>, <code>CGAHPLog.slot1.*</code> will match.\n\n</p><p>Another part of the problem is that cleanUp() in log_rotate.cpp tries to eliminate extra old log files via calls to rotate_file(). If the rotate fails, cleanUp() loops indefinitely, calling dprintf() each time.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-19 14:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0bb3f05680f4b654c97fbea60085450121be8375\">[29161]</a></span>: edit version history item. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2749\" onclick=\"get_ticket_and_populate_wrapper('2749'); return false;\" title=\"Any condor tool or daemon can get into an infinite loop on startup\">#2749</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-19 13:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ae5e08b1779d145ba03e4022a512a62be17a38c5\">[29159]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2749\" onclick=\"get_ticket_and_populate_wrapper('2749'); return false;\" title=\"Any condor tool or daemon can get into an infinite loop on startup\">#2749</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-08 18:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cb999f499a2ab39e5265b7c9d1a38602856c124e\">[29032]</a></span>: Fix off-by-one error in log rotation code <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2749\" onclick=\"get_ticket_and_populate_wrapper('2749'); return false;\" title=\"Any condor tool or daemon can get into an infinite loop on startup\">#2749</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-07 22:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8465772f5e3ce697316588b2e567a54aafb565d7\">[29031]</a></span>: Fix off-by-one error in log rotation code <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2749\" onclick=\"get_ticket_and_populate_wrapper('2749'); return false;\" title=\"Any condor tool or daemon can get into an infinite loop on startup\">#2749</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Jan-10 10:45", "status": "resolved", "created": "2012-Jan-06 17:57", "fixed_version": "2012-Jan-06 17:57", "broken_version": "v070600", "priority": "2", "subsystem": "", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": "20120110"}