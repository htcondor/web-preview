{"id": 6581, "title": "Ticket #6581: condor_submit should not always read from stdin if no submit file", "description": "<blockquote>\nMichael Pelletier points out that it is possible to provide a valid submit hash on the command line of condor_submit, but that there is no way to tell condor_submit not to read from stdin in that case.\n\n<p>For example\n\n</p><p></p><pre>    condor_submit executable=/bin/sleep arguments=300 -queue 1\n</pre>\n\n<p>Is a complete and valid submit description, but if you run this command, condor_submit will wait forever trying to read the \"submit file\" from stdin.\n\n</p><p>we need to rethink this behavior.  The proposed fix is to\n\n</p><p></p><ol>\n<li>add a new (optional) command line argument for explicitly specifying a submit file. This argument will allow - as the filename, and read from stdin in that case.\n</li><li>change the behavior of the -queue command line argument so that condor_submit will only read from explicitly specified submit files when it is used.\n</li></ol>\n\n<p>So, for example\n\n</p><p></p><pre>   condor_submit executable=/bin/sleep arguments=300 -queue 1\n</pre>\n\n<p>Will submit a 300 second sleep job, and <strong>not</strong> read from stdin.\n\n</p><p></p><pre>   condor_submit executable=/bin/sleep arguments=300 -submit foo -queue 1\n</pre>\n\n<p>Will read submit statements from foo, insert executable and args from the command line, and the submit a single job.  And\n\n</p><p></p><pre>   condor_submit -submit - -queue 1\n</pre>\n\n<p>Will read submit statements from stdin, and queue a single job using those statements.\n\n</p><p>As is currently the case, it will be an error to have a queue statement in the submit file/stdin and also on the command line.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-23 11:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55609\">[55609]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6581\" onclick=\"get_ticket_and_populate_wrapper('6581'); return false;\" title=\"condor_submit should not always read from stdin if no submit file\">#6581</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6752\" onclick=\"get_ticket_and_populate_wrapper('6752'); return false;\" title=\"ReadUserLog::readEvent() broken on Windows?\">#6752</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6784\" onclick=\"get_ticket_and_populate_wrapper('6784'); return false;\" title=\"there should be a knob to set the default for should_transfer_files\">#6784</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6698\" onclick=\"get_ticket_and_populate_wrapper('6698'); return false;\" title=\"Provide the ability to identify black hole slots\">#6698</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6737\" onclick=\"get_ticket_and_populate_wrapper('6737'); return false;\" title=\"Accounting and Defrag adtypes missing from python bindings\">#6737</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6723\" onclick=\"get_ticket_and_populate_wrapper('6723'); return false;\" title=\"Late Materialization jobs handle getenv=true incorrectly\">#6723</a></span>, and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6732\" onclick=\"get_ticket_and_populate_wrapper('6732'); return false;\" title=\"speed up the schedd check for a change in an autoclustered attribute\">#6732</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-23 11:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55610\">[55610]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6581\" onclick=\"get_ticket_and_populate_wrapper('6581'); return false;\" title=\"condor_submit should not always read from stdin if no submit file\">#6581</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6752\" onclick=\"get_ticket_and_populate_wrapper('6752'); return false;\" title=\"ReadUserLog::readEvent() broken on Windows?\">#6752</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6784\" onclick=\"get_ticket_and_populate_wrapper('6784'); return false;\" title=\"there should be a knob to set the default for should_transfer_files\">#6784</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6698\" onclick=\"get_ticket_and_populate_wrapper('6698'); return false;\" title=\"Provide the ability to identify black hole slots\">#6698</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6737\" onclick=\"get_ticket_and_populate_wrapper('6737'); return false;\" title=\"Accounting and Defrag adtypes missing from python bindings\">#6737</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6723\" onclick=\"get_ticket_and_populate_wrapper('6723'); return false;\" title=\"Late Materialization jobs handle getenv=true incorrectly\">#6723</a></span>, and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6732\" onclick=\"get_ticket_and_populate_wrapper('6732'); return false;\" title=\"speed up the schedd check for a change in an autoclustered attribute\">#6732</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-20 13:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55446\">[55446]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6581\" onclick=\"get_ticket_and_populate_wrapper('6581'); return false;\" title=\"condor_submit should not always read from stdin if no submit file\">#6581</a></span>, add -file argument to man page and usage of condor_submit  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Sep-19 10:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55436\">[55436]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6581\" onclick=\"get_ticket_and_populate_wrapper('6581'); return false;\" title=\"condor_submit should not always read from stdin if no submit file\">#6581</a></span>, condor_submit will not try and read stdin if it is given a queue statement and at least one key=value on the commmand line. This commit also adds code to verify that the late materialize item data is located in spool, and adds more test cases to the python late materialize test. ===VersionHistory:Pending===\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-Oct-23 11:51", "status": "resolved", "created": "2018-Feb-26 11:32", "fixed_version": "2018-Feb-26 11:32", "broken_version": "", "priority": "3", "subsystem": "", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "90126", "customer_group": "support", "visibility": "public", "notify": "", "due_date": ""}