{"id": 1751, "title": "Ticket #1751: DAGMan fails on two-deep splices in a SOAR workflow", "description": "<blockquote>\nBill has a SOAR workflow in which he tried to use two-deep splices in combination with DIR settings, and DAGMan fails when trying to parse this:\n\n<p></p><pre>  11/03 08:38:03 movieruns.dag (line 5): Missing Parent Job names\n</pre>\n\n<p>When the SPLICE keywords were changed to SUBDAG EXTERNAL, everything worked, so it's definitely something going wrong with SPLICE as opposed to a typo or something like that.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Nov-03 10:16:48 by wenger:</em> <br/>\n\nOkay, I've tracked this down some -- it turns out that the failure has nothing to do with the DIR specifications.  The problem is that the first-level splice DAG has only another splice in it, with no actual JOB nodes.  If you add a JOB node to that splice DAG, everything works.\n\n<p>I think that maybe fixing this should include the addition of the \"socket nodes\" we've talked about that would enable splices to have PRE and POST scripts.  It seems like if we added the socket nodes, it would pretty much automatically fix this problem.\n\n</p><p></p><hr/>\n<em>2010-Nov-03 12:01:16 by wenger:</em> <br/>\n\nAdded the job_dagman_splice-P test which tests this bug (currently commented out until we actually fix the problem).\n\n<p></p><hr/>\n<em>2010-Nov-04 11:35:40 by wenger:</em> <br/>\n\nAlso see the new job_dagman_splice-Q test -- if the splice is the child rather than the parent, DAGMan core dumps...\n\n<p></p><hr/>\n<em>2011-Mar-30 10:59:19 by psilord:</em> <br/>\n\nStalled due to starvation.\n\n<p></p><hr/>\n<em>2011-Nov-30 16:11:27 by wenger:</em> <br/>\n\nI'm assigning this to Nathan -- to be worked on after the brain dump from Pete tomorrow.\n\n<p></p><hr/>\n<em>2011-Dec-06 09:49:05 by nwp:</em> <br/>\n\nLooking at the code to deal with this, I think it should be rewritten so that splices and nodes use C++ inheritance to treat nodes and splices symmetrically in the code.  But that is probably too ambitious a fix at this point.\n\n<p></p><hr/>\n<em>2011-Dec-09 15:15:25 by wenger:</em> <br/>\n\nOkay, I've looked at this and it all looks good.  Nathan -- you can merge this to V6-branch now.\n\n<p></p><hr/>\n<em>2011-Dec-09 16:23:17 by nwp:</em> <br/>\n\nVersion history is complete, so I am resolving this ticket.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-12 11:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e928f2e615a06b1eec1120cabb03fbc3ba99ecd3\">[28717]</a></span>: rewrite of the rewrite of the bug fix dealing with condor_dagman and nested splices ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1751\" onclick=\"get_ticket_and_populate_wrapper('1751'); return false;\" title=\"DAGMan fails on two-deep splices in a SOAR workflow\">#1751</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-09 15:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/89b714af70f6a769aafcbadb148dd4ae73a75bb4\">[28699]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1751\" onclick=\"get_ticket_and_populate_wrapper('1751'); return false;\" title=\"DAGMan fails on two-deep splices in a SOAR workflow\">#1751</a></span>: slightly re-worded the version history entry to make it (hopefully) more clear.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-09 13:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0e4defb71a50f95038e6600c2bdcd3c4c01e7490\">[28692]</a></span>: Delete a spurious assignment ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1751\" onclick=\"get_ticket_and_populate_wrapper('1751'); return false;\" title=\"DAGMan fails on two-deep splices in a SOAR workflow\">#1751</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-09 10:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f0626ee94a51374b37c4d8c21691738c3e72f53d\">[28690]</a></span>: Fix two-deep splice ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1751\" onclick=\"get_ticket_and_populate_wrapper('1751'); return false;\" title=\"DAGMan fails on two-deep splices in a SOAR workflow\">#1751</a></span> The important thing to remember when you use recursion is that conditions for each inductive step need to be the same.  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-25 16:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/82af3fdf52d9bc2d86a5e97acf7b6ff7b26ce11e\">[25932]</a></span>: Documented gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1751\" onclick=\"get_ticket_and_populate_wrapper('1751'); return false;\" title=\"DAGMan fails on two-deep splices in a SOAR workflow\">#1751</a></span> in the 7.5.6 version history.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Nov-05 11:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/02044c8d68fc2f6902fc7cb59ddf5bdfd3e22fca\">[19340]</a></span>: Fix disabling of tests job_dagman_splice-P/Q. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1751\" onclick=\"get_ticket_and_populate_wrapper('1751'); return false;\" title=\"DAGMan fails on two-deep splices in a SOAR workflow\">#1751</a></span> In an Imakefile, you use C-style comments, not script-style.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Nov-04 11:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a9ac703c232b2c4302785d735e748b7d67206d00\">[19330]</a></span>: More for gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1751\" onclick=\"get_ticket_and_populate_wrapper('1751'); return false;\" title=\"DAGMan fails on two-deep splices in a SOAR workflow\">#1751</a></span>: added the job_dagman_splice-Q test (commented out in the Imakefile).  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Nov-03 12:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a9d65bd4c3f6eac2410bf2cbf5e12c2b70ce15ec\">[19329]</a></span>: Added a new test (job_dagman_splice-P) to test the bug noted in gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1751\" onclick=\"get_ticket_and_populate_wrapper('1751'); return false;\" title=\"DAGMan fails on two-deep splices in a SOAR workflow\">#1751</a></span>. Note that this test is currently commented out in the Imakefile because the underlying bug hasn't been fixed yet.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Dec-09 16:23", "status": "resolved", "created": "2010-Nov-03 08:41", "fixed_version": "2010-Nov-03 08:41", "broken_version": "v070404", "priority": "1", "subsystem": "Dag", "assigned_to": "nwp", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu,psilord@cs.wisc.edu, bt@cs.wisc.edu", "due_date": "20111207"}