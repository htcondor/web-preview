{"id": 7370, "title": "Ticket #7370: ClassAd.setdefault default argument doesn't work", "description": "<blockquote>\n<code>ClassAd</code> nominally supports the <code>setdefault</code> method of Python mutable mappings (<a class=\"external\" href=\"https://docs.python.org/3/library/stdtypes.html#dict.setdefault\">https://docs.python.org/3/library/stdtypes.html#dict.setdefault</a>). It works as expected when <code>default</code> is given and is not <code>None</code>.\n\n<p>However, when <code>default</code> is not given, or is given as <code>None</code> (which are supposed to be equivalent), we get an error:\n</p><div class=\"code\">\n<pre class=\"code\">c = classad.ClassAd()\nsd = c.setdefault('key')\n</pre></div>\n\n<div class=\"code\">\n<pre class=\"code\">TypeError: Unable to convert Python object to a ClassAd expression.\n</pre></div>\n\n\n<p>The obvious problem is that <code>None</code> doesn't have a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> expression equivalent. If we can decide on one, that should be the default argument. If we can't, then the default argument of this method should be changed to whatever we think is most reasonable (<code>Undefined</code>?).</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Nov-13 17:00:15 by tlmiller:</em> <br/>\n\nThe fix actually changes the general from Python to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTree\" title=\"Expr Tree\">ExprTree</a></span> routine to handle None as undefined, which may not be sane in the general case.\n\n<p>Also, why didn't anybody ever document classad.Value.undefined and classad.Value.error?\n\n</p><p></p><hr/>\n<em>2019-Nov-14 08:08:13 by karpel:</em> <br/>\n\nThat seems like a reasonable semantic equivalency to me.\n\n<p>I created <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7377\" onclick=\"get_ticket_and_populate_wrapper('7377'); return false;\" title=\"Document Python classad.Value enum\">#7377</a></span> for documenting <code>classad.Value</code></p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7377\" onclick=\"get_ticket_and_populate_wrapper('7377'); return false;\" title=\"Document Python classad.Value enum\">#7377</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDocument Python classad.Value enum</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Nov-13 16:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58458\">[58458]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7370\" onclick=\"get_ticket_and_populate_wrapper('7370'); return false;\" title=\"ClassAd.setdefault default argument doesn't work\">#7370</a></span>) Treat 'None' as 'undefined' when converting from Python to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ExprTree\" title=\"Expr Tree\">ExprTree</a></span>.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Nov-14 08:08", "status": "resolved", "created": "2019-Nov-13 13:02", "fixed_version": "2019-Nov-13 13:02", "broken_version": "", "priority": "4", "subsystem": "PythonBinding", "assigned_to": "tlmiller", "derived_from": "", "creator": "karpel", "rust": "", "customer_group": "other", "visibility": "public", "notify": "karpel@wisc.edu tlmiller@cs.wisc.edu", "due_date": ""}