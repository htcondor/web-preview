{"id": 6497, "title": "Ticket #6497: starter never deletes the sandbox directory on Windows", "description": "<blockquote>\nWhen the chroot code was added to the <code>condor_starter</code>, the normal sandbox deletion was broken for Windows.  This has been masked by the fact that starter fails delete the sandbox silently, and by the fact that the STARTD will normally delete it after the starter exits.  (I say normally, because there is a race condition in the STARTD where the claim can be released before the starter is reaped, In that case it will not do the cleanup.</blockquote>", "remarks": "<blockquote>\n<em>2017-Dec-13 13:09:28 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p></p><ul>\n<li>Remove commented-out debugging statement in Starter::~Starter()\n</li><li>The comments in Starter::reallykill() seem to confuse SIGTERM and SIGKILL.</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Dec-15 13:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=53019\">[53019]</a></span>: Revert \"As part of <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6497\" onclick=\"get_ticket_and_populate_wrapper('6497'); return false;\" title=\"starter never deletes the sandbox directory on Windows\">#6497</a></span>, On Windows, the STARTD should not send a SIGTERM to a starter that is already processing a SIGQUIT,\" This reverts commit 91d330886d4943fff8498fc545b8347653026f22.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Dec-15 13:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=53018\">[53018]</a></span>: Revert \"for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6497\" onclick=\"get_ticket_and_populate_wrapper('6497'); return false;\" title=\"starter never deletes the sandbox directory on Windows\">#6497</a></span>, fix comments in the starter based on code review.\" This reverts commit 02955fe54da1fdff82a4ffc644aedba18a4c750e.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Dec-13 14:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52999\">[52999]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6497\" onclick=\"get_ticket_and_populate_wrapper('6497'); return false;\" title=\"starter never deletes the sandbox directory on Windows\">#6497</a></span>, fix comments in the starter based on code review.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Dec-12 16:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52987\">[52987]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6497\" onclick=\"get_ticket_and_populate_wrapper('6497'); return false;\" title=\"starter never deletes the sandbox directory on Windows\">#6497</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Dec-12 16:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52986\">[52986]</a></span>: As part of <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6497\" onclick=\"get_ticket_and_populate_wrapper('6497'); return false;\" title=\"starter never deletes the sandbox directory on Windows\">#6497</a></span>, On Windows, the STARTD should not send a SIGTERM to a starter that is already processing a SIGQUIT, since that will just hang the STARTD. this is a bit of a hack, but makes it far more likely that a STARTD will be able to reap the starter before the claim is relinquished - which is\u00a0[...]\n (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Dec-05 15:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52934\">[52934]</a></span>: fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6497\" onclick=\"get_ticket_and_populate_wrapper('6497'); return false;\" title=\"starter never deletes the sandbox directory on Windows\">#6497</a></span>. condor_starter never deletes the sandbox directory on Windows, leaving the STARTD to do the cleanup ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Dec-13 14:35", "status": "resolved", "created": "2017-Dec-05 12:06", "fixed_version": "2017-Dec-05 12:06", "broken_version": "v080600", "priority": "2", "subsystem": "DaemonsExecNode", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "support", "visibility": "public", "notify": "", "due_date": ""}