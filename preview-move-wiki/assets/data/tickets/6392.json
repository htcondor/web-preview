{"id": 6392, "title": "Ticket #6392: Build on Windows with Visual Studio 2015 fails", "description": "<blockquote>\nThe attached series of patches fixes the build with Visual Studio 2015 for me.</blockquote>", "remarks": "<blockquote>\n<em>2017-Sep-12 09:17:57 by johnkn:</em> <br/>\n\nI wish I had seen these earlier.  All but the first are alternate versions of fixes that I made to the master branch on 27 July. The first patch I don't understand the reason for.\n\n<p></p><hr/>\n<em>2017-Sep-12 09:38:33 by quintinhill:</em> <br/>\n\nI saw some changes in this direction had been made but it seems that the changes in the patches are not yet available in git master currently (I rebased to a267563e9e and still see a diff).  Could you point me to the relevant commits?\n\n<p>In terms of the first patch condor_pre_external sets ${_TARGET}_VER (CondorPreExternal.cmake:35) but before the patch we were using ${_TARGET}_VER} to set another ${TARGET_DOWNLOAD} on the line before condor_pre_external.  The patch changes things so that we use ${_TARGET}_VER after it has been set.  This made downloading OpenSSL work for me.\n\n</p><p></p><hr/>\n<em>2017-Sep-12 09:54:20 by quintinhill:</em> <br/>\n\nI see I should drop one hunk of the fifth patch and also the drop patch 4 and 6.  I'll attach new patches.\n\n<p></p><hr/>\n<em>2017-Sep-12 11:19:24 by johnkn:</em> <br/>\n\npatches 1 and 2 applied to master.  I think patch 3 is a better fix than what we currently have in the code base - looking into it.\n\n<p></p><hr/>\n<em>2017-Sep-12 11:25:14 by johnkn:</em> <br/>\n\nrelevant commits are in  e47d52bb35baeb0.\n\n<p></p><hr/>\n<em>2017-Sep-12 11:34:21 by quintinhill:</em> <br/>\n\nThanks.  I managed to find the commit eventually.  What about the new patch 4, I dropped one of the hunks from the first version of the patch but the others seem to still be required even after e47d52bb35 (git grep doesn't show the _WINSOCK_DEPRECATED_NO_WARNINGS macro to be defined elsewhere).\n\n<p></p><hr/>\n<em>2017-Sep-21 10:18:13 by johnkn:</em> <br/>\n\n<div class=\"code\">\n<pre class=\"code\">C:\\Users\\johnkn\\condor\\MASTER&gt;git grep WINSOCK_DEPRECATED\nsrc/condor_includes/condor_sys_nt.h:#define _WINSOCK_DEPRECATED_NO_WARNINGS 1\n</pre></div>\n\n\n<p></p><hr/>\n<em>2017-Oct-25 16:33:49 by tim:</em> <br/>\n\n<strong>Doc Review:</strong> No docs needed.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/996/0001-externals-cmake-correct-Windows-build.patch\">0001-externals-cmake-correct-Windows-build.patch</a>\n3889 bytes added by quintinhill on 2017-Aug-30 15:45:47 UTC.\n</li><li><a href=\"../files/997/0002-includes-fix-compilation-with-Visual-Studio-2013.patch\">0002-includes-fix-compilation-with-Visual-Studio-2013.patch</a>\n988 bytes added by quintinhill on 2017-Aug-30 15:45:56 UTC.\n</li><li><a href=\"../files/998/0003-condor_snutils-Visual-Studio-2015-has-correct-snprin.patch\">0003-condor_snutils-Visual-Studio-2015-has-correct-snprin.patch</a>\n1239 bytes added by quintinhill on 2017-Aug-30 15:46:05 UTC.\n</li><li><a href=\"../files/999/0004-defrag-explicitly-include-iterator.patch\">0004-defrag-explicitly-include-iterator.patch</a>\n677 bytes added by quintinhill on 2017-Aug-30 15:46:16 UTC.\n</li><li><a href=\"../files/1000/0005-condor_includes-silence-deprecation-winsock-warnings.patch\">0005-condor_includes-silence-deprecation-winsock-warnings.patch</a>\n1933 bytes added by quintinhill on 2017-Aug-30 15:46:24 UTC.\n</li><li><a href=\"../files/1001/0006-condor_utils-fix-build-with-newer-Visual-Studio.patch\">0006-condor_utils-fix-build-with-newer-Visual-Studio.patch</a>\n893 bytes added by quintinhill on 2017-Aug-30 15:46:32 UTC.\n</li><li><a href=\"../files/1003/0001-externals-cmake-correct-Windows-build.patch\">0001-externals-cmake-correct-Windows-build.patch</a>\n3889 bytes added by quintinhill on 2017-Sep-12 14:55:03 UTC.\n</li><li><a href=\"../files/1004/0002-includes-fix-compilation-with-Visual-Studio-2013.patch\">0002-includes-fix-compilation-with-Visual-Studio-2013.patch</a>\n988 bytes added by quintinhill on 2017-Sep-12 14:55:18 UTC.\n</li><li><a href=\"../files/1005/0003-condor_snutils-Visual-Studio-2015-has-correct-snprin.patch\">0003-condor_snutils-Visual-Studio-2015-has-correct-snprin.patch</a>\n1239 bytes added by quintinhill on 2017-Sep-12 14:55:30 UTC.\n</li><li><a href=\"../files/1006/0004-condor_includes-silence-deprecation-winsock-warnings.patch\">0004-condor_includes-silence-deprecation-winsock-warnings.patch</a>\n1327 bytes added by quintinhill on 2017-Sep-12 14:55:40 UTC.\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Sep-12 11:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=52320\">[52320]</a></span>: Correctness fixes for build on Windows with Visual Studio 2015 <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6392\" onclick=\"get_ticket_and_populate_wrapper('6392'); return false;\" title=\"Build on Windows with Visual Studio 2015 fails\">#6392</a></span> Committer: John (TJ) Knoeller  (By Quintin Hill )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Oct-25 16:33", "status": "resolved", "created": "2017-Aug-30 10:45", "fixed_version": "2017-Aug-30 10:45", "broken_version": "", "priority": "4", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "quintinhill", "rust": "", "customer_group": "other", "visibility": "public", "notify": "quintin.hill@arqiva.com", "due_date": ""}