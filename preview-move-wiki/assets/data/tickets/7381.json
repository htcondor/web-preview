{"id": 7381, "title": "Ticket #7381: condor should tell users what output files were NOT transferred back", "description": "<blockquote>\n<a class=\"external\" href=\"https://docs.google.com/document/d/1xdjWe8bl2rFxlw1idpqxWNvVlcYHMM1iPXcHhBQ6kA8/edit?usp=sharing\">Design document</a>.\n\n<p>If <strong>manifest</strong> or <strong>manifest_dir</strong> is set in the submit file, write a file containing the names of the files and directories of the top level of the sandbox immediately after file transfer in, and a different file for the same immediately after file transfer out.  These files will be <strong>manifest_dir</strong>, if it is specified, or in <em>&lt;cluster&gt;_&lt;proc&gt;_manifest</em> if not.  Transfer this directory, if created, automatically.\n\n</p><p><span class=\"section\"></span></p><h2>original description</h2>\n<hr/>\n#usability\n\n<p>One of the most common user errors when constructing new jobs and workflows with Condor file transfer is an output file not existing.  Often this is because the output wasn't named what the user expected.\n\n</p><p>Another common user error when constructing new jobs and workflows is a job failing with no indication of why in stderr, and no way to see what unanticipated output files, core files, etc. may have been written on the execute node and not sent back.\n\n</p><p>One of the most common wrapper scripts Condor forces users who use Condor file xfer to write, in order to debug jobs, is one that runs \"ls -l\" before and after a job.\n\n</p><p>All of this could be helped if Condor simply told the user what files were there.  I'm agnostic as to how/where Condor communicates this info, but please let's not force everyone to do it themselves, when Condor is perfectly positioned to do it for them.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Nov-19 10:57:58 by tlmiller:</em> <br/>\n\nConsider including the job's environment, too.\n\n<p></p><hr/>\n<em>2019-Dec-10 10:42:57 by tlmiller:</em> <br/>\n\nPFC rather likes the idea.\n\n<p></p><hr/>\n<em>2020-May-12 10:23:48 by tlmiller:</em> <br/>\n\nIt seems this would be best implemented along with ToddT's manifest file.\n\n<p></p><hr/>\n<em>2020-Jun-09 10:08:14 by pfc:</em> <br/>\n\nToddT suggests that if his work isn't done in 6-8 weeks, ToddM should proceed via other means.\n\n<p></p><hr/>\n<em>2020-Jul-21 10:20:12 by pfc:</em> <br/>\n\nWe agreed today that Todd M. should proceed on his own.\n\n<p></p><hr/>\n<em>2020-Aug-15 02:22:04 by tlmiller:</em> <br/>\n\n<a class=\"external\" href=\"https://docs.google.com/document/d/1xdjWe8bl2rFxlw1idpqxWNvVlcYHMM1iPXcHhBQ6kA8/edit?usp=sharing\">Design document</a>.\n\n<p>Unanswered questions:\n\n</p><p></p><ul>\n<li>Is requesting a manifest good enough reason to restrict the job to running only\n   on starters that know how to produce them?\n</li><li>The current manifest is 'ls' before and after the job.  Does it need to be\n   'ls -l' to be useful?  What about 'find .'?\n</li></ul>\n\n<p></p><hr/>\n<em>2020-Aug-17 11:21:54 by tlmiller:</em> <br/>\n\nGregT and I agree that this isn't important-enough a feature to prevent jobs from running.\n\n<p></p><hr/>\n<em>2020-Aug-25 10:36:51 by tlmiller:</em> <br/>\n\nThe consensus on the LIGO call was that this feature isn't important enough to match-make on; and that the current set of information is certainly enough to get started.\n\n<p></p><hr/>\n<em>2020-Aug-25 13:24:18 by tlmiller:</em> <br/>\n\nMerged to master for 8.9.9.  Requires a Windows implementation, tests, documentation.\n\n<p></p><hr/>\n<em>2020-Sep-08 15:14:11 by pfc:</em> <br/>\n\nThis is just to confirm that the current limitation, where the manifest only lists the top-level files and does not recurse into subdirectories, is okay for now -- we will open a new feature request if/when more is ever needed.\n\n<p></p><hr/>\n<em>2020-Sep-10 16:58:53 by tlmiller:</em> <br/>\n\nWindows implementation deferred to next release, <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=7854\" onclick=\"get_ticket_and_populate_wrapper('7854'); return false;\" title=\"Make manifest and manifest_dir work on Windows\">#7854</a></span>.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=7854\" onclick=\"get_ticket_and_populate_wrapper('7854'); return false;\" title=\"Make manifest and manifest_dir work on Windows\">#7854</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nMake manifest and manifest_dir work on Windows</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-18 08:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61309\">[61309]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7381\" onclick=\"get_ticket_and_populate_wrapper('7381'); return false;\" title=\"condor should tell users what output files were NOT transferred back\">#7381</a></span>) Refactor the tests to remove code duplication.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-11 15:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61307\">[61307]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7381\" onclick=\"get_ticket_and_populate_wrapper('7381'); return false;\" title=\"condor should tell users what output files were NOT transferred back\">#7381</a></span>) First pass at test_manifest.py.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-10 16:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61272\">[61272]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7381\" onclick=\"get_ticket_and_populate_wrapper('7381'); return false;\" title=\"condor should tell users what output files were NOT transferred back\">#7381</a></span>) Documentation.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-25 14:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60545\">[60545]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7381\" onclick=\"get_ticket_and_populate_wrapper('7381'); return false;\" title=\"condor should tell users what output files were NOT transferred back\">#7381</a></span>) Try to fix the Windows build.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-19 10:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60490\">[60490]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7381\" onclick=\"get_ticket_and_populate_wrapper('7381'); return false;\" title=\"condor should tell users what output files were NOT transferred back\">#7381</a></span>) Record the environment in the manifest.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-17 11:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60489\">[60489]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7381\" onclick=\"get_ticket_and_populate_wrapper('7381'); return false;\" title=\"condor should tell users what output files were NOT transferred back\">#7381</a></span>) Implement manifest and manifest_dir submit-file commands.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-17 11:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60488\">[60488]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7381\" onclick=\"get_ticket_and_populate_wrapper('7381'); return false;\" title=\"condor should tell users what output files were NOT transferred back\">#7381</a></span>) Bug fix: don't skip a directory if it's in the dynamic output files list.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-14 15:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60487\">[60487]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7381\" onclick=\"get_ticket_and_populate_wrapper('7381'); return false;\" title=\"condor should tell users what output files were NOT transferred back\">#7381</a></span>) Switch to a manifest directory scheme. Get the manifest directory name (and if the manifest directory is desired) from the job ad.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-14 13:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60486\">[60486]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7381\" onclick=\"get_ticket_and_populate_wrapper('7381'); return false;\" title=\"condor should tell users what output files were NOT transferred back\">#7381</a></span>) Record the contents of the top level of the sandbox just after transfer-in and just before transfer-out.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Sep-18 08:58", "status": "resolved", "created": "2019-Nov-15 11:19", "fixed_version": "2019-Nov-15 11:19", "broken_version": "", "priority": "2", "subsystem": "FileTransfer", "assigned_to": "tlmiller", "derived_from": "", "creator": "pfc", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "stuart.anderson@ligo.org, james.clark@ligo.org, gregory.mendell@ligo.org, emfajardohernandez@physics.ucsd.edu", "due_date": ""}