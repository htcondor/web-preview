{"id": 4369, "title": "Ticket #4369: SubmitterUserPrio does not work in PREEMPTION_REQUIREMENTS|RANK", "description": "<blockquote>\n<a class=\"external\" href=\"http://research.cs.wisc.edu/htcondor/manual/v8.0/3_4User_Priorities.html#SECTION00443000000000000000\">The Manual in section 3.4.3</a> lists attributes that can be used in <code>PREEMPTION_REQUIREMENTS</code> and <code>PREEMPTION_RANK</code> expressions.  One such attribute documented is <code>SubmitterUserPrio</code>.  Unfortunately, this is broken due to a typo in the source code! From file <a class=\"file\" href=\"rlog?f=src/condor_includes/condor_attributes.h\">/src/condor_includes/condor_attributes.h</a> - behold the misspelling of the attribute:\n<div class=\"code\">\n<pre class=\"code\">#define ATTR_SUBMITTER_USER_PRIO  \"SubmittorUserPrio\"\n</pre></div>\n\n\n<p>Looks safe to simply correct the spelling so HTCondor operates as documented, as the code still uses <code>SubmittorPrio</code> internally (for backwards compatibilities when <code>SubmitterUserPrio</code> was first introduced). However, I am putting this into v8.2.0 because 1) v8.2.0 is imminent and v8.0.x is about to be declared dead except for security fixes, and 2) I want be sure semantics don't change in the middle of a stable series, even 'broken' semantics.\n\n</p><p>A work-around for older versions of HTCondor is to use <code>SubmittorPrio</code> instead, as <code>SubmitterUserPrio</code> was from the get-go just a more aesthetically pleasing/consistent synonym name for <code>SubmittorPrio</code>.</p></blockquote>", "remarks": "<blockquote>\n<em>2014-May-19 13:21:08 by tannenba:</em> <br/>\n\nBesides this typo causing issues for folks who want to believe the documentation, note that HTCondor's defaults also assume the correct spelling:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">C:\\home\\tannenba\\condor\\CONDOR_SRC\\src&gt;git grep SubmitterUserPrio\ncondor_examples/condor_config.annotated:        &amp;&amp; (RemoteUserPrio &gt; TARGET.SubmitterUserPrio * 1.2)) \\\ncondor_examples/condor_config.generic.redhat:   &amp;&amp; (RemoteUserPrio &gt; TARGET.SubmitterUserPrio * 1.2)) \\\ncondor_utils/param_info.in:default=((SubmitterGroup =?= RemoteGroup) &amp;&amp; ($(StateTimer) &gt; (1 * $(HOUR))) &amp;&amp; (RemoteUserPrio &gt; TARGET.SubmitterUserPrio * 1.2)) || (MY.NiceUser == True)\n</pre></div>\n\n\n<p>Also note that <code>SubmittorPrio</code> cannot go away anytime soon as it is referenced in places that <code>SubmitterUserPrio</code> is not - for instance:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">C:\\home\\tannenba\\condor\\CONDOR_SRC\\src&gt;git grep ATTR_SUBMITT | grep PRIO\nclassad_analysis/analysis.cpp:  preempt_prio &lt;&lt; \"MY.\" &lt;&lt; ATTR_REMOTE_USER_PRIO &lt;&lt; \" &gt; TARGET.\" &lt;&lt; ATTR_SUBMITTOR_PRIO &lt;&lt; \"\n + \" &lt;&lt; PriorityDelta;\ncondor_includes/condor_attributes.h:#define ATTR_SUBMITTOR_PRIO  \"SubmittorPrio\"   // old-style for ATTR_SUBMITTER_USER_PR\nIO\ncondor_includes/condor_attributes.h:#define ATTR_SUBMITTER_USER_PRIO  \"SubmittorUserPrio\"   // old-style for ATTR_SUBMITTE\nR_USER_PRIO\ncondor_negotiator.V6/matchmaker.cpp:    external_references.remove_anycase(ATTR_SUBMITTOR_PRIO);\ncondor_negotiator.V6/matchmaker.cpp:    external_references.remove_anycase(ATTR_SUBMITTER_USER_PRIO);\ncondor_negotiator.V6/matchmaker.cpp:            // first insert old-style ATTR_SUBMITTOR_PRIO\ncondor_negotiator.V6/matchmaker.cpp:            request.Assign(ATTR_SUBMITTOR_PRIO , (float)priority );\ncondor_negotiator.V6/matchmaker.cpp:            // next insert new-style ATTR_SUBMITTER_USER_PRIO\ncondor_negotiator.V6/matchmaker.cpp:            request.Assign(ATTR_SUBMITTER_USER_PRIO , (float)priority );\ncondor_q.V6/queue.cpp:                  ATTR_SUBMITTOR_PRIO, PriorityDelta );\ncondor_q.V6/queue.cpp:                  request-&gt;Assign(ATTR_SUBMITTOR_PRIO, prioTable[ixSubmittor].prio);\ncondor_tools/give_interactive.cpp:      requestAd.Assign(ATTR_SUBMITTOR_PRIO, priority);\ncondor_utils/compat_classad.cpp:        ATTR_SUBMITTER_USER_PRIO,\ncondor_utils/compat_classad.cpp:        ATTR_SUBMITTOR_PRIO,\n</pre></div>\n\n\n<p></p><hr/>\n<em>2014-Jun-05 12:47:48 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong> by zmiller.  Looks good.\n\n<p></p><hr/>\n<em>2014-Jun-23 11:25:33 by tannenba:</em> <br/>\n\nAlso <a class=\"external\" href=\"http://goo.gl/Jt97XN\">reported on htcondor-users by Alexey</a>... so embarrassing.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jun-24 11:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=40497\">[40497]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=40495\">[40495]</a></span>, Fix merge conflict documenting <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=4369\" onclick=\"get_ticket_and_populate_wrapper('4369'); return false;\" title=\"SubmitterUserPrio does not work in PREEMPTION_REQUIREMENTS|RANK\">#4369</a></span> Conflicts: doc/version-history/8-2.history.tex  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jun-24 11:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=40496\">[40496]</a></span>: documentation for <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=4369\" onclick=\"get_ticket_and_populate_wrapper('4369'); return false;\" title=\"SubmitterUserPrio does not work in PREEMPTION_REQUIREMENTS|RANK\">#4369</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-May-19 13:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=40171\">[40171]</a></span>: Fix problems with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SubmitterUserPrio\" title=\"Submitter User Prio\">SubmitterUserPrio</a></span>. <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=4369\" onclick=\"get_ticket_and_populate_wrapper('4369'); return false;\" title=\"SubmitterUserPrio does not work in PREEMPTION_REQUIREMENTS|RANK\">#4369</a></span> The manual documents <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SubmitterUserPrio\" title=\"Submitter User Prio\">SubmitterUserPrio</a></span>, but the source code had it misspelled as <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SubmittorUserPrio\" title=\"Submittor User Prio\">SubmittorUserPrio</a></span>. Sigh.  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Jun-24 11:05", "status": "defer", "created": "2014-May-19 13:14", "fixed_version": "2014-May-19 13:14", "broken_version": "v080000", "priority": "5", "subsystem": "DaemonsCM", "assigned_to": "tannenba", "derived_from": "", "creator": "tannenba", "rust": "s8420", "customer_group": "ligo", "visibility": "public", "notify": "tannenba@cs.wisc.edu,pcouvare@caltech.edu", "due_date": ""}