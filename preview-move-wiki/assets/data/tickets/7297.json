{"id": 7297, "title": "Ticket #7297: pytest-based tests succeed when schedd fails to start", "description": "<blockquote>\nIf the schedd fails to launch, then pytest-based tests will fail due to being unable to find the local schedd object.  See:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">01/10/19 21:01:21 PersonalCondor environment started successfully!\n01/10/19 21:01:21 Test 1: Attempting a valid HTTP transfer, expecting success\n01/10/19 21:01:21 Submitting job with arguments: {'should_transfer_files': 'YES', 'output': 'cmd_curl_plugin-success.out', 'executable': '/home/cse496/bbockelm/projects/condor-build/src/condor_tests/cmd_curl_plugin_ctest/cmd_curl_plugin-success.py', 'transfer_input_files': 'http://127.0.0.1:29827/success', 'log': 'test-2999340.log'}\nTraceback (most recent call last):\n  File \"cmd_curl_plugin.run\", line 210, in &lt;module&gt;\n    main()\n  File \"cmd_curl_plugin.run\", line 128, in main\n    success_job.Submit()\n  File \"/home/cse496/bbockelm/projects/condor-build/src/condor_tests/cmd_curl_plugin_ctest/pytest/CondorCluster.py\", line 51, in Submit\n    self._schedd = htcondor.Schedd()\nRuntimeError: Unable to locate local daemon\n01/10/19 21:01:22 [PC: cmd_curl_plugin] Shutting down PersonalCondor with condor_off -master\n01/10/19 21:01:22 Waiting for personal condor(s) to finish stopping...\n01/10/19 21:01:27 [PC: cmd_curl_plugin] Master exited\n</pre></div>\n\n\n<p>Unfortunately, in the current test configuration, this results in the test case exiting with exit code 0 (i.e., succeeding!).</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Oct-02 15:30:24 by tlmiller:</em> <br/>\n\nThat sounds two problems:\n\n<p></p><ol>\n<li>Why do we think (we shouldn't) that the personal condor environment started successfully if the schedd fails to launch?\n</li><li>The test harness(es) need to either explicitly detect exceptions and fail the test as a result, or we need to switch from 'success unless' to 'failure unless' in harness(es).\n</li></ol>\n\n<p><span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/26aa4c7187039c0195914117cd3defc429b90876\">[58012]</a></span> may be of interest or relevance.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2019-Oct-02 15:31", "status": "new", "created": "2019-Oct-01 23:44", "fixed_version": "2019-Oct-01 23:44", "broken_version": "", "priority": "3", "subsystem": "Tests", "assigned_to": "tlmiller", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bbockelman@morgridge.org, coatsworth@cs.wisc.edu, tlmiller@cs.wisc.edu", "due_date": ""}