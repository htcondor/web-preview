{"id": 7221, "title": "Ticket #7221: Client tools use local daemon instead of failing for nonhostnames", "description": "<blockquote>\nMat asks:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">$ condor_submit -remote foo foo4.sub\nSubmitting job(s).\n1 job(s) submitted to cluster 69.\n</pre></div>\n\n<div class=\"blockquote\">\n<table width=\"95%\"><tbody><tr><td>\u00a0</td><td>\n  \nshouldn't that have failed since there's no schedd named foo?\n</td></tr></tbody></table></div>\n\n\n<p><code>condor_submit -remote</code> calls <code>get_daemon_name()</code> and checks the return value for <code>NULL</code>.  What <code>get_daemon_name()</code> <em>actually</em> returns if its argument does not contain an '@' or a '.', and is not resolvable, is the empty string.  This is only checked for correctly in <code>condor_config_val</code> and <code>condor_status</code>.\n\n</p><p>This unconventional arrangement arises because <code>get_fqdn_from_hostname()</code> returns an empty <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyString\" title=\"My String\">MyString</a></span> on failure.  (The no-DNS case also only works if we assume that the argument will never accidentally contain an FQDN.)  This function, luckily, is only called from <code>get_daemon_name()</code> and <code>build_valid_daemon_name()</code>, so this can readily be changed.\n\n</p><p>The smallest workable patch for stable would be add a check in <code>get_daemon_name()</code> for empty FQDNs.\n\n</p><p>For the dev series, I'd like to remove both functions entirely (to make sure I didn't miss any calls) and replace them with functions with saner calling conventions.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Aug-28 14:24:00 by tlmiller:</em> <br/>\n\nNote that the daemon client Daemon class also uses <code>get_daemon_name()</code> in one place.  It appears to assume the exact same logic that all of the command-line tools do, so this change should not make anything any worse.\n\n<p>We could also just punt on the stable-series change entirely.\n\n</p><p></p><hr/>\n<em>2019-Oct-11 09:56:58 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong> change looks good.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Oct-11 11:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58133\">[58133]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7221\" onclick=\"get_ticket_and_populate_wrapper('7221'); return false;\" title=\"Client tools use local daemon instead of failing for nonhostnames\">#7221</a></span>) Release note.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-28 13:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57737\">[57737]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7221\" onclick=\"get_ticket_and_populate_wrapper('7221'); return false;\" title=\"Client tools use local daemon instead of failing for nonhostnames\">#7221</a></span>) Return NULL from get_daemon_name() if get_fqdn_from_hostname() fails.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Oct-11 11:14", "status": "resolved", "created": "2019-Aug-28 13:52", "fixed_version": "2019-Aug-28 13:52", "broken_version": "", "priority": "2", "subsystem": "Tools", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu", "due_date": ""}