{"id": 7064, "title": "Ticket #7064: Make queue_with_itemdata easier to user", "description": "<blockquote>\nThe <code>queue_with_itemdata</code> method has the right approach but there are two big annoyances:\n\n<p></p><ol>\n<li>The keyword argument <code>from</code> is literally impossible to use as this is a reserved keyword.  This should be renamed to <code>data</code>.\n</li><li>The <code>from</code> (<code>data</code>) keyword argument should accept iterables in addition to iterators.</li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2019-May-22 12:00:58 by bbockelm:</em> <br/>\n\nOther items:\n\n<p></p><ol>\n<li>We decided to use <code>itemdata</code> instead of <code>data</code> for the keyword.\n</li><li>We should cast values in the <code>itemdata</code> to string.\n</li></ol>\n\n<p></p><hr/>\n<em>2019-May-22 13:18:29 by bbockelm:</em> <br/>\n\nPR posted: <a class=\"external\" href=\"https://github.com/htcondor/htcondor/pull/43\">https://github.com/htcondor/htcondor/pull/43</a>\n\n<p></p><hr/>\n<em>2019-Aug-05 15:24:55 by karpel:</em> <br/>\n\nThis is currently broken on 8.9.3\n\n<p>If you pass in <code>None</code> for the itemdata, as either the default or explicitly, this change tries to turn it into an iterator, which obviously fails. See example below. Both calls work as expected on 8.9.2.\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">In [1]: import htcondor\n\nIn [2]: s = htcondor.Submit(executable = '/bin/sleep', arguments = '1m')\n\nIn [3]: s\nOut[3]: 'executable = /bin/sleep\\narguments = 1m\\n'\n\nIn [4]: print(s)\nexecutable = /bin/sleep\narguments = 1m\n\n\nIn [5]: schedd = htcondor.Schedd()\n\nIn [7]: with schedd.transaction() as txn:\n   ...:     s.queue_with_itemdata(txn, 5, None)\n   ...:\n\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n&lt;ipython-input-7-f13df81dd280&gt; in &lt;module&gt;\n      1 with schedd.transaction() as txn:\n----&gt; 2     s.queue_with_itemdata(txn, 5, None)\n      3\n\nTypeError: 'NoneType' object is not iterable\n\nIn [8]: with schedd.transaction() as txn:\n   ...:     s.queue_with_itemdata(txn, 5)\n   ...:\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n&lt;ipython-input-8-c06e7ce7970a&gt; in &lt;module&gt;\n      1 with schedd.transaction() as txn:\n----&gt; 2     s.queue_with_itemdata(txn, 5)\n      3\n\nTypeError: 'NoneType' object is not iterable\n</pre></div>\n\n\n<p></p><hr/>\n<em>2019-Aug-05 22:49:29 by bbockelm:</em> <br/>\n\nOk, fixed in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bbfe7ea8700c5cabe73cd74d17a225870aef55d7\">[57600]</a></span>\n\n<p>Josh, can you please re-test and confirm the regression is fixed?\n\n</p><p></p><hr/>\n<em>2019-Aug-05 22:52:11 by karpel:</em> <br/>\n\nI can test it manually, but I'd prefer something that actually checks this function in the test suite.\n\n<p></p><hr/>\n<em>2019-Aug-05 23:04:08 by bbockelm:</em> <br/>\n\n<div class=\"blockquote\">\n<table width=\"95%\"><tbody><tr><td>\u00a0</td><td>\n  \nI can test it manually, but I'd prefer something that actually checks this function in the test suite.\n</td></tr></tbody></table></div>\n\n\n<p>Certainly!\n\n</p><p>However, in the spirit of \"first one, then the other\", can you verify your manual test work, then file a follow-up ticket on doing the tests?  I don't want to add too much stuff to a ticket this late in the 8.9.3 release process.\n\n</p><p></p><hr/>\n<em>2019-Aug-06 11:20:08 by karpel:</em> <br/>\n\nI tested this locally and it works. Will make a ticket for the test.\n\n<p></p><hr/>\n<em>2019-Sep-16 21:50:26 by tim:</em> <br/>\n\nWe have reverted part of the commits for this ticket. We retained renaming \"from\" to \"itemdata\". The change to accept Iterables introduced regressions and will be addressed in a follow on ticket.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=7187\" onclick=\"get_ticket_and_populate_wrapper('7187'); return false;\" title=\"Add tests for queue_with_itemdata\">#7187</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd tests for queue_with_itemdata</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Sep-16 21:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b94ebe7a8e4f039695f6adf130254779db22d6ae\">[57844]</a></span>: Adjust version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7064\" onclick=\"get_ticket_and_populate_wrapper('7064'); return false;\" title=\"Make queue_with_itemdata easier to user\">#7064</a></span>  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Sep-16 16:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5022f149ace88939a7840de15dae865e548e0f61\">[57841]</a></span>: Undo <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7064\" onclick=\"get_ticket_and_populate_wrapper('7064'); return false;\" title=\"Make queue_with_itemdata easier to user\">#7064</a></span>  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Sep-13 14:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/763ff4eac4ffb6ff32c88eea4c754ff15b999c86\">[57835]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7064\" onclick=\"get_ticket_and_populate_wrapper('7064'); return false;\" title=\"Make queue_with_itemdata easier to user\">#7064</a></span>) Fixup memory references to avoid seg faults  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-05 22:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bbfe7ea8700c5cabe73cd74d17a225870aef55d7\">[57600]</a></span>: Fix regression in handling of the default argument. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7064\" onclick=\"get_ticket_and_populate_wrapper('7064'); return false;\" title=\"Make queue_with_itemdata easier to user\">#7064</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-02 09:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ff7b502a95f56d471640942a13eef3419afe8f28\">[57554]</a></span>: Add version history for queue_with_itemdata improvements. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7064\" onclick=\"get_ticket_and_populate_wrapper('7064'); return false;\" title=\"Make queue_with_itemdata easier to user\">#7064</a></span>  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-22 12:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/780d38716bd166199779aab29d0620933ff96993\">[56941]</a></span>: Improve usability of `queue_with_itemdata`. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7064\" onclick=\"get_ticket_and_populate_wrapper('7064'); return false;\" title=\"Make queue_with_itemdata easier to user\">#7064</a></span> - Rename keyword argument from `from` to `itemdata`. - Accept iterables in addition to iterators. - Values provided to the method are converted to strings where possible.  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Sep-16 21:50", "status": "resolved", "created": "2019-May-22 08:19", "fixed_version": "2019-May-22 08:19", "broken_version": "", "priority": "4", "subsystem": "", "assigned_to": "karpel", "derived_from": "#7063", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bbockelman@morgridge.org, karpel@wisc.edu", "due_date": ""}