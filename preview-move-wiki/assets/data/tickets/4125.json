{"id": 4125, "title": "Ticket #4125: Separate log file for POST script terminated events?", "description": "<blockquote>\nIt might make sense to have DAGMan write and read the POST script terminated events to/from a separate log file (separate from either the overall workflow log or the individual log files specified in node job submit files).  That would avoid having DAGMan writing to a log file that other Condor processes are also writing to (probably especially helpful if we do <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=963\" onclick=\"get_ticket_and_populate_wrapper('963'); return false;\" title=\"Have a Condor event logging daemon that does all log file writing\">#963</a></span>: Have a Condor event logging daemon that does all log file writing).\n\n<p>Also see <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3994\" onclick=\"get_ticket_and_populate_wrapper('3994'); return false;\" title=\"Require DAGMan to run in workflow log mode?\">#3994</a></span>: Require DAGMan to run in workflow log mode?, <span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=4059\" onclick=\"get_ticket_and_populate_wrapper('4059'); return false;\" title=\"DAG-level NOOP jobs shouldn't need submit file if using workflow log\">#4059</a></span>: DAG-level NOOP jobs shouldn't need submit file if using workflow log.\n\n</p><p>Sadly, I guess if we do this we'd need another knob to allow the user to specify the path for this log file...  (Unless we just say it has to be the workflow log with some fixed extra extension added.)</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Feb-06 09:52:30 by wenger:</em> <br/>\n\nDo this only after checking with Miron that it's okay, and only after doing <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4550\" onclick=\"get_ticket_and_populate_wrapper('4550'); return false;\" title=\"Eliminate DAGMan support for Stork jobs\">#4550</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4528\" onclick=\"get_ticket_and_populate_wrapper('4528'); return false;\" title=\"Remove old DAGMan per-job log file code\">#4528</a></span>.\n\n<p></p><hr/>\n<em>2015-Feb-06 10:11:07 by wenger:</em> <br/>\n\nOh, yeah -- if we do <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=4809\" onclick=\"get_ticket_and_populate_wrapper('4809'); return false;\" title=\"Write event to workflow log if all node job submit attempts fail\">#4809</a></span>, the \"submit failed\" events would obviously go into this log.  (The main idea of this is to have DAGMan <strong>not</strong> write to the \"main\" workflow log that the schedd knows about.)\n\n<p></p><hr/>\n<em>2015-Feb-09 16:23:26 by wenger:</em> <br/>\n\nDesign document:\n\n<p><a class=\"external\" href=\"https://docs.google.com/a/wisc.edu/document/d/1I-nk2ZbxFC9m1T1azEi-XDy73XobV5mTG0jfhjLZ5a4/edit?pli=1\">https://docs.google.com/a/wisc.edu/document/d/1I-nk2ZbxFC9m1T1azEi-XDy73XobV5mTG0jfhjLZ5a4/edit?pli=1</a>\n\n</p><p></p><hr/>\n<em>2015-Feb-17 12:34:09 by wenger:</em> <br/>\n\nNote that this log will also have to contain the \"fake\" events for DAG-level NOOP nodes.\n\n<p></p><hr/>\n<em>2015-Feb-17 13:02:01 by wenger:</em> <br/>\n\nProbably make a WriteEvent() method in the Dag class that takes care of stuff like filling in the CondorID in the event and properly initializing the log writer (e.g., not XML).\n\n<p></p><hr/>\n<em>2015-Jun-23 11:11:15 by wenger:</em> <br/>\n\nHmm -- another reason to do this is that if we do it we won't have to implement TJ's fix to get atomic writes on Windows in file append mode.\n\n<p></p><hr/>\n<em>2015-Dec-18 15:40:44 by wenger:</em> <br/>\n\nMiron wants a report on why/whether we actually need to log POST script terminated events before we do this.  (Also see <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=4809\" onclick=\"get_ticket_and_populate_wrapper('4809'); return false;\" title=\"Write event to workflow log if all node job submit attempts fail\">#4809</a></span> and <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=4727\" onclick=\"get_ticket_and_populate_wrapper('4727'); return false;\" title=\"Submit failures + retries + final node + rescue + recov = hung DAGMan\">#4727</a></span> and report about those.)\n\n<p></p><hr/>\n<em>2015-Dec-23 11:18:47 by wenger:</em> <br/>\n\nAh, we also need this log file for the \"fake\" events that DAGMan writes for NOOP nodes.  (Hmm -- maybe if we implement <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=5445\" onclick=\"get_ticket_and_populate_wrapper('5445'); return false;\" title=\"Add support for workflow log to be on SSD\">#5445</a></span> splitting off the log isn't so critical?)\n\n<p>I think that one thing that Miron is concerned about is that if we do this there are two separate log files the user has to worry about...</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2016-May-03 11:27", "status": "reviewdesign", "created": "2013-Dec-16 17:59", "fixed_version": "2013-Dec-16 17:59", "broken_version": "v080102", "priority": "3", "subsystem": "Dag", "assigned_to": "tannenba", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, tannenba@cs.wisc.edu, zmiller@cs.wisc.edu", "due_date": ""}