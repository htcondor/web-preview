{"id": 6092, "title": "Ticket #6092: Job Router job event writing bugs", "description": "<blockquote>\nThe Job Router's handling of job event logs has several bugs. These don't affect typical usage of the HTCondor-CE, but do affect other users (any time jobs are submitted by an avenue other than Condor-C).\n\n<p>Here are the issues:\n</p><ul>\n<li>The Job Router assumes that the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserLog\" title=\"User Log\">UserLog</a></span> and DAGManNodesLog job attributes contain full pathnames to files. If a value is a relative filename, it attempts to open the wrong file.\n</li><li>The Job Router copies the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserLog\" title=\"User Log\">UserLog</a></span> and DAGManNodesLog job attributes from the source job to the routed job. In non-sandbox mode, this means events for the routed job show up in the source job's event log files. In sandbox mode, this means that the source job's event log files are overwritten by event log files for the routed job when it completes.\n</li><li>The Job Router writes Terminate, Abort, and Hold events for the source job, but nothing else. Execute and Evict events are desired by some CMS folks.\n</li><li>If <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UserLog\" title=\"User Log\">UserLog</a></span> and DAGManNodesLog are undefined in the source job ad, then no events are written to the global event log.\n</li></ul>\n\n<p>Generally, the Job Router should handle job event logging similar to how Condor-C does it. It should remove event log file attributes from the destination job ad, and write a fuller set of events for the source job.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Mar-01 15:20:21 by gthain:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>All is good.  Can we get some notes in this ticket about <strong>why</strong> the job router should be responsible for logging, and the religion behind it?</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Feb-28 13:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/53a1b32828784b43d5c9b4cdb7543d2316ef3218\">[50229]</a></span>: Docs for job router event log bug fixes. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6092\" onclick=\"get_ticket_and_populate_wrapper('6092'); return false;\" title=\"Job Router job event writing bugs\">#6092</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jan-20 11:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/642ec5ac1f8195b0ecbed48d84f0304684cc82ca\">[50024]</a></span>: Add dummy functions for job_router_info tool. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6092\" onclick=\"get_ticket_and_populate_wrapper('6092'); return false;\" title=\"Job Router job event writing bugs\">#6092</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jan-20 10:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0ec7e6f91dd015714b17c27183c1ed01f4059bdc\">[50023]</a></span>: Write Execute and Evict events for jobs claimed by the Job Router. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6092\" onclick=\"get_ticket_and_populate_wrapper('6092'); return false;\" title=\"Job Router job event writing bugs\">#6092</a></span> The Job Router now writes Execute and Evict events when it changes the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobStatus\" title=\"Job Status\">JobStatus</a></span> between IDLE and RUNNING. For the Execute event, the \"host\" is the job id of the routed job.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jan-19 13:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/118ae0fe9aab235eeb10076a619e87f7e50b7c65\">[50012]</a></span>: Fix Job Router's handling of job event logs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6092\" onclick=\"get_ticket_and_populate_wrapper('6092'); return false;\" title=\"Job Router job event writing bugs\">#6092</a></span> Events for the routed job are no longer written to the event logs of the source job, nor is the source job's event logs overwritten when the routed job completes. The Job Router now correctly handles relative pathnames when writing events. The global\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Jan-19 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/33b556baeedc81397060bcf447d04377d7df855f\">[50011]</a></span>: Change getPathToUserLog() API so that Job Router can use it. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6092\" onclick=\"get_ticket_and_populate_wrapper('6092'); return false;\" title=\"Job Router job event writing bugs\">#6092</a></span> The Job Router doesn't use compat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>, so adjust getPathToUserLog() to not require a compat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span>.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Mar-01 15:20", "status": "resolved", "created": "2017-Jan-18 16:18", "fixed_version": "2017-Jan-18 16:18", "broken_version": "v080400", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "gthain", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}