{"id": 1964, "title": "Ticket #1964: Transfer data on evict sporadically fails", "description": "<blockquote>\nSince the upgrade to 7.5.6 in CHTC I've seen job transfers on evict fail, i.e. not happen. This leads to jobs relying on their own checkpointing after the 24 hour evict getting caught in an infinite loop.\n\n<p>It does not seem to be reliably reproducible. However, I have one job which has been evicted twice so far and each time the data did not get transferred back to spool. I am currently trying to catch this behavior live in order to collect some log information.\n\n</p><p>Maybe more information on this matter:\n\n</p><p>I see <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ShadowLog\" title=\"Shadow Log\">ShadowLog</a></span> output such as\n</p><div class=\"verbatim\">\n<pre>03/12/11 15:09:12 (2429403.0) (1894): Failed to remove /var/condor/spool/9403/0/\ncluster2429403.proc0.subproc0.swap: Permission denied (errno 13)\n...\n03/12/11 15:09:17 (2408019.0) (20653): Directory::setOwnerPriv() -- failed to fi\nnd owner of /var/condor/spool/8019/0/cluster2408019.proc0.subproc0\n03/12/11 15:09:17 (2408019.0) (20653): Directory::Rewind(): failed to find owner\n of \"/var/condor/spool/8019/0/cluster2408019.proc0.subproc0\"\n</pre></div>\n\n\n<p>Looking into recent code changes (warning squashing, etc) I see various initializations with\n</p><div class=\"verbatim\">\n<pre>priv_state saved_priv=PRIV_UNKNOWN;\n</pre></div>\n\n\n<p>However, the only code path that ever leads to \"failed to find owner\" is Directory::getIds() returning false. Since it happens quietly, the only way this can happen is StatInfo::stat(path) returning error SINoFile.\n\n</p><p>While I am investigating further, I am not entirely sure why I've only seen sporadic failures and why it doesn't happen all the time. (It being: spool tmp directory cannot be deleted and therefore the shadow fails to write to it -- so my current assumption). More info as I have it.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Mar-13 23:33:10 by cweiss:</em> <br/>\n\nThe above <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ShadowLog\" title=\"Shadow Log\">ShadowLog</a></span> errors already occurred in 7.5.5 as I verified -- so this seems to be a red herring. Trying fairly hard over the weekend, I have not been able to observe this problem again. Let's hope it was a three-off.\n\n<p></p><hr/>\n<em>2011-Mar-14 09:39:04 by zmiller:</em> <br/>\n\ntodd asked me to see if this might be related to CEDPS (i.e. filetransfer hooks) changes i made.  i'm pretty sure not, since 1) doesn't seem to be in related code, and 2) the bug was in 7.5.5 and CEDPS changes were not.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "incident", "last_change": "2013-May-28 15:49", "status": "abandoned", "created": "2011-Mar-11 18:31", "fixed_version": "2011-Mar-11 18:31", "broken_version": "v070506", "priority": "2", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "cweiss", "rust": "", "customer_group": "other", "visibility": "public", "notify": "gthain@cs.wisc.edu,tannenba@cs.wisc.edu,cweiss@cs.wisc.edu", "due_date": ""}