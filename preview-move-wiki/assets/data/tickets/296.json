{"id": 296, "title": "Ticket #296: Get PrivSep running on all execute-only machines in the CS pool", "description": "<blockquote>\nThere are two pieces to this:\n\n<p></p><ul>\n<li>Use the CSL's tool that deploys files from AFS to local disk to deploy the PrivSep-related files that need to be local. Such files include the privsep_config file, condor_root_switchboard (which must be root-owned and setuid), and the condor_procd (which needs to be in a \"trusted\" location according to Jim's trusted path algorithm.)\n</li><li>When Condor is restarted, make sure that the above mentioned files are in sync with what is in AFS. If we didn't make this assurance and files in AFS and on local disk were allowed to get out of sync, we might get bitten by version skew if/when changes are made to the ProcD and/or Switchboard's interface.\n</li></ul>\n\n<p>The first of these two is done. The AFS files /s/what/xml/groups/condor-arch-&lt;sysname&gt;.xml describe how the files are copied from AFS to local disk.\n\n</p><p>The second item will involve writing a tool that we can call from the condor_perl_master script any time Condor restarts. The tool will be root-owned and setuid, and will simply run the lab's tool to make sure the local PrivSep-related files are in sync with what's in AFS. This should be pretty easy to do.\n\n</p><p>The following e-mail gives a bit of background and indicates how things were left off with the CSL:\n\n</p><p></p><div class=\"verbatim\">\n<pre>On Mon, 14 Jul 2008 13:40:06 -0500\nGreg Quinn &lt;gquinn@cs.wisc.edu&gt; wrote:\n\n&gt; &gt; On Wed, 2008-07-09 at 15:49 -0500, Tim Czerwonka wrote:\n&gt; &gt;\n&gt;&gt; &gt; &gt; =&gt; &gt; As soon as you give me the go-ahead, I can apply the updated condor\n&gt;&gt; &gt; &gt; =&gt; &gt; config on this host for you to check.\n&gt;&gt; &gt; &gt; =&gt;\n&gt;&gt; &gt; &gt; =&gt; Sure thing, go ahead.\n&gt;&gt; &gt; &gt; =&gt;\n&gt;&gt; &gt; &gt;\n&gt;&gt; &gt; &gt; f48 is running with the new config files.\n&gt; &gt;\n&gt; &gt; Tim,\n&gt; &gt;\n&gt; &gt; The new arrangement seems to be right. I won't be able to say for\n&gt; &gt; certain until I've tested Condor running in PrivSep mode.\n&gt; &gt;\n&gt; &gt; Do you have any idea how long it might take to provide us with a tool\n&gt; &gt; that allows us to trigger an update to the files in /etc/condor\n&gt; &gt; and /usr/condor? If it's not too long, I'll hold off on setting up\n&gt; &gt; Condor on f48 until it is available.\n\n\nNot at the moment, it should just be a setuid 0 wrapper that runs:\n\n/s/what/bin/what apply /s/what/xml/groups/condor-arch-&lt;sysname&gt;.xml\n\nYour process would call the wrapper to update only the files referenced in\ncondor-arch-&lt;sysname&gt;.xml.  Our 4 a.m. daily scripts reference this same thing;\ncalling in this fashion only updates the files in which you're interested.\n\n\n\nBut first, some notes on the above:\n\n'condor-take-3.xml' contains only the most recent tweaks to 'condor-take-2.xml'.\n\nThe following are what are really included on a per-host basis and are symlinks\nto condor-take-2.xml:\n\nlrwxr-xr-x 1 thomas thomas   17 Jan 18 14:37 /s/what/xml/groups/condor-arch-amd64_cent40.xml -&gt; condor-take-2.xml\nlrwxr-xr-x 1 thomas thomas   17 Jan 18 14:12 /s/what/xml/groups/condor-arch-amd64_rhel5.xml -&gt; condor-take-2.xml\nlrwxr-xr-x 1 thomas thomas   17 Jan 18 14:35 /s/what/xml/groups/condor-arch-i386_cent40.xml -&gt; condor-take-2.xml\nlrwxr-xr-x 1 thomas thomas   17 Jan 18 14:08 /s/what/xml/groups/condor-arch-i386_rhel5.xml -&gt; condor-take-2.xml\n\nThese are included by groups/condor-linux.xml.  You probably don't want to run\nthat every time there's an update.\n\nOnce it's been decided that condor-take-3.xml does the right thing and includes\neverything necessary, I can change the symlinks above from -take-2 to -take-3.\n\nIf you have more time to whip up a setuid wrapper, let me know.\n\n--Tim\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2019-Apr-18 15:43:15 by jfrey:</em> <br/>\n\n<span class=\"wiki\"><a href=\"wiki?p=PrivSep\" title=\"Priv Sep\">PrivSep</a></span> is no longer supported. Abandoning this ticket.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "todo", "last_change": "2019-Apr-18 15:43", "status": "abandoned", "created": "2009-Mar-04 15:13", "fixed_version": "2009-Mar-04 15:13", "broken_version": "", "priority": "4", "subsystem": "Security", "assigned_to": "", "derived_from": "", "creator": "gquinn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}