{"id": 7695, "title": "Ticket #7695: custom machine resource monitors untestable", "description": "<blockquote>\nThanks to JoshK's relentless pestering about test_custom_machine_resources.py, we've discovered three problems:\n\n<p></p><ol>\n<li>The helper function in CustomMachineResource.pm is buggy: it doesn't check to see if it saw <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UptimeResourceSeconds\" title=\"Uptime Resource Seconds\">UptimeResourceSeconds</a></span> numbers, just that if it did, they were OK.\n</li><li>The <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> iterator continues to frustrate; you may encounter attributes you inserted while iterating (even though you can't delete attributes while iterating).\n</li><li>The code that added <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DeviceResourceAverageUsage\" title=\"Device Resource Average Usage\">DeviceResourceAverageUsage</a></span> replaced <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=UptimeResourceSeconds\" title=\"Uptime Resource Seconds\">UptimeResourceSeconds</a></span>.  TJ and I have a slight preference for not sending the latter to the collector -- it's an internal implementation detail -- but I have an equally slight dislike for including it conditionally based on configuration.</li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2020-Jun-22 07:51:49 by tlmiller:</em> <br/>\n\nSince the diff turned out to be literally one line, I'm comfortable knobbing it.\n\n<p>This was a change to the test suite, and as such, doesn't need to be documented.  I'm deliberately not documenting the test-suite-specific knob.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jun-19 11:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59924\">[59924]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7695\" onclick=\"get_ticket_and_populate_wrapper('7695'); return false;\" title=\"custom machine resource monitors untestable\">#7695</a></span>) Fix cmr-* tests to fail if Uptime[Resource]Seconds isn't advertised.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jun-19 11:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59923\">[59923]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7695\" onclick=\"get_ticket_and_populate_wrapper('7695'); return false;\" title=\"custom machine resource monitors untestable\">#7695</a></span>) Don't delete Uptime[Resource]Seconds if ADVERTISE_CMR_UPTIME_SECONDS is configured.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Jun-22 07:51", "status": "resolved", "created": "2020-Jun-19 10:23", "fixed_version": "2020-Jun-19 10:23", "broken_version": "", "priority": "2", "subsystem": "DaemonsExecNode", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, karpel@wisc.edu, johnkn@cs.wisc.edu", "due_date": ""}