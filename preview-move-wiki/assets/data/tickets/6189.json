{"id": 6189, "title": "Ticket #6189: add result limit to collector queries", "description": "<blockquote>\nThe collector handles locate queries by scanning the entire hashtable for an adtype, it would speed things up if the locate query indicated that it wants only a single result, then the collector could stop scanning as soon as it gets a hit.\n\n<p>To make this a big more general, the query add for collector queries should have a <code>LimitResults</code> attribute that indicates the maximum number of a results desired (just like -limit in condor_history).  The collector should honor this.\n\n</p><p>Also, when the deamon client does a locate query, it should always set the result limit to 1.\n\n</p><p>Finally, a new argument should be added to condor_status so that the result limit can be set explicitly.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Mar-27 16:08:17 by tannenba:</em> <br/>\n\nFor some reason, the commits to implement the result limit in the collector itself were committed as part of unrelated ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6191\" onclick=\"get_ticket_and_populate_wrapper('6191'); return false;\" title=\"collector should have a knob to set what queries are handled in-proc\">#6191</a></span>\n\n<p></p><hr/>\n<em>2017-Apr-11 14:20:01 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>I feel that if the collector receives a query that has ATTR_LOCATION_QUERY, then the result limit should be set to one.\n\n</p><p><em>This default should be implemented in the collector itself</em>, for two reasons:\n\n</p><p></p><ol>\n<li>so that older v8.6 clients that actually set ATTR_LOCATION_QUERY correctly but fail to set ATTR_LIMIT_RESULTS still have a result limit of one, and\n\n<p></p></li><li>so that even in the current code, all the location query call sites that this ticket failed to set a result limit upon (i.e. python bindings, several others) also will result in a default result limit of one.\n</li></ol>\n\n<p>Is there some reason to not have the collector set a result limit of one for all location queries?</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-20 12:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b0ea0bc617964f39fa61ceae9fa3117db2d0386c\">[50517]</a></span>: doc and version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6189\" onclick=\"get_ticket_and_populate_wrapper('6189'); return false;\" title=\"add result limit to collector queries\">#6189</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-14 10:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/db0e36209c07ccc694aa6cc028ac2836b79ea4e3\">[50312]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6189\" onclick=\"get_ticket_and_populate_wrapper('6189'); return false;\" title=\"add result limit to collector queries\">#6189</a></span>, add <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ResultLimit\" title=\"Result Limit\">ResultLimit</a></span> to collector query ad, and have locate queries always request a limit of 1. Also add -limit argument to condor_status. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Apr-20 12:08", "status": "resolved", "created": "2017-Mar-14 10:40", "fixed_version": "2017-Mar-14 10:40", "broken_version": "", "priority": "4", "subsystem": "DaemonsCM", "assigned_to": "johnkn", "derived_from": "#6093", "creator": "johnkn", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "bbockelm@cse.unl.edu tannenba@cs.wisc.edu", "due_date": ""}