{"id": 1203, "title": "Ticket #1203: new classads does not coerce numbers to bools", "description": "<blockquote>\nExpressions such as the following are illegal in new classads:\n\n<p>0 || 1\n\n</p><p>0 &amp;&amp; 1\n\n</p><p>This is likely to create backward compatibility problems, because in old classads, integers and reals were treated as boolean values (non-zero is true, otherwise false).  There are prominent examples where we have taken advantage of this existing behavior.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Feb-24 16:30:01 by danb:</em> <br/>\n\nAfter further consideration, we decided to revert this change.  We are not aware of common or even occasional use of coercion of numbers to booleans, so it seems best not to mess with new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> for this case.\n\n<p></p><hr/>\n<em>2010-Apr-23 13:24:57 by jfrey:</em> <br/>\n\nWe've discovered that a major Condor user uses the coercion of numbers to booleans in old <span class=\"quote\">ClassAds</span> and had a tough time discovering why their system broke after upgrading to Condor 7.5.1+. Their Start expression starting evaluating to ERROR, so jobs would fail to start, with little/no explanation why.\n\n<p>We will re-introduce the coercion of numbers to booleans as an optional behavior that's disabled by default, but which Condor will enable. This behavior will be removed along with other old ClassAd-emulation code in the 7.7 series and can be disabled before that with the STRICT_CLASSAD_EVALUATION config param.\n\n</p><p></p><hr/>\n<em>2010-Apr-26 15:10:27 by jfrey:</em> <br/>\n\nPushed commits for the changes described above to master branch for Condor 7.5.3.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4785\" onclick=\"get_ticket_and_populate_wrapper('4785'); return false;\" title=\"Finish coercion of numbers to booleans in new ClassAds\">#4785</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nFinish coercion of numbers to booleans in new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span></td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jun-14 14:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25515\">[25515]</a></span>: edits of new 7.5.3 version history items; removed duplicate item (for gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1203\" onclick=\"get_ticket_and_populate_wrapper('1203'); return false;\" title=\"new classads does not coerce numbers to bools\">#1203</a></span>)  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Apr-26 15:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25443\">[25443]</a></span>: Document change in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> evaluation behavior. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1203\" onclick=\"get_ticket_and_populate_wrapper('1203'); return false;\" title=\"new classads does not coerce numbers to bools\">#1203</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Apr-26 15:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17916\">[17916]</a></span>: Allow conversions of numerics to booleans in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> compat layer. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1203\" onclick=\"get_ticket_and_populate_wrapper('1203'); return false;\" title=\"new classads does not coerce numbers to bools\">#1203</a></span> Expressions such as '0 || 1' are illegal in new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> but legal in old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. We have some users who use this coercion from numeric to boolean values.\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Apr-26 15:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17915\">[17915]</a></span>: Allow new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> to convert numerics to booleans in expressions. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1203\" onclick=\"get_ticket_and_populate_wrapper('1203'); return false;\" title=\"new classads does not coerce numbers to bools\">#1203</a></span> Expressions such as '0 || 1' are illegal in new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> but legal in old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. We have some users who use this coercion from numeric to boolean values.\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-25 10:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17338\">[17338]</a></span>: Revert \"Made new classads convert numerics to boolean in boolean expressions. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1203\" onclick=\"get_ticket_and_populate_wrapper('1203'); return false;\" title=\"new classads does not coerce numbers to bools\">#1203</a></span>\" After further consideration, it seems wise not to muddy the crisp clean semantics of new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> until we find evidence that this really is a major problem. Therefore, we are reverting this change.\u00a0[...]\n (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-24 16:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17334\">[17334]</a></span>: Revert \"Made new classads convert numerics to boolean in boolean expressions. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1203\" onclick=\"get_ticket_and_populate_wrapper('1203'); return false;\" title=\"new classads does not coerce numbers to bools\">#1203</a></span>\" After further consideration, it seems wise not to muddy the crisp clean semantics of new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> until we find evidence that this really is a major problem. Therefore, we are reverting this change.\u00a0[...]\n (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-10 17:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=17193\">[17193]</a></span>: Made new classads convert numerics to boolean in boolean expressions. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1203\" onclick=\"get_ticket_and_populate_wrapper('1203'); return false;\" title=\"new classads does not coerce numbers to bools\">#1203</a></span> This is to avoid backward compatibility problems with old classad expressions that assume this behavior.  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Apr-26 15:11", "status": "resolved", "created": "2010-Feb-10 17:50", "fixed_version": "2010-Feb-10 17:50", "broken_version": "v070501", "priority": "4", "subsystem": "Daemons", "assigned_to": "jfrey", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}