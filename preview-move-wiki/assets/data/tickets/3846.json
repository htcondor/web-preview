{"id": 3846, "title": "Ticket #3846: Round trip per attribute for remote condor_submit", "description": "<blockquote>\nCERN testers reported that remote condor_submit had unexpectedly poor performance.\n\n<p>Looking into things, it appears remote condor_submit does a ACK after each <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SetAttribute\" title=\"Set Attribute\">SetAttribute</a></span>.  We removed this in HTCondor-C; I think it's time to remove this for submits too.  CERN reported a 3x performance increase in remote-submits-per-second.\n\n</p><p></p><div class=\"strike\">\n<strike> Pushed as branch V8_1-submit-no-ack; needs review. </strike></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2014-Mar-22 21:57:49 by bbockelm:</em> <br/>\n\nSeems to have gotten lost in the noise.  Pinging ticket.\n\n<p></p><hr/>\n<em>2014-Jun-10 15:43:27 by tannenba:</em> <br/>\n\nThe V8_1-submit-no-ack did not get rid of all the ack round trips, and it also left misleading error messages (without an ack, submit cannot actually tell the user which specific setattribute had a failure because with no ack roundtrip the schedd will simply close the tcp socket which may not be detected right away), so I rewrote the patch.\n\n<p>The patch pushed below handles the issues mentioned above.  It can also be disabled at runtime via condor_config setting\n    SUBMIT_NOACK_ON_SETATTRIBUTE = False\n(the default value is True).  There is no need to document this knob, end-users should never care to change it.  It is just there to aid in any debugging by developers.\n\n</p><p>Failure to parse an attribute expression would be the primary culprit for setattribute to fail. Because condor_submit already checks that input from the user parses before sending anything to the schedd, it is not clear when a setattribute would actually ever fail.  Thus there is really no disadvantage to the user of the default of SUBMIT_NOACK_ON_SETATTRIBUTE = True.  Note we still check the return code from the schedd on a transaction commit (via <code>DisconnectQ()</code>), so ultimately the return code from condor_submit will still be the same as before the patch.\n\n</p><p>On my own laptop (Windows 7, SSD drive) with a personal condor, before the patch it took 4.02 seconds to submit 200 job clusters (about 15k setattribute calls).  After the patch it took 2.97 seconds, or an ~25% improvement even when submitting to a local schedd.  Obviously with a remote submit, the improvement would be substantially better.\n\n</p><p></p><hr/>\n<em>2014-Jun-11 09:23:26 by johnkn:</em> <br/>\n\nCODE_REVIEW: code patch and version history both look good!</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jun-11 13:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/93acf04bda66aa4129a36ecdd87620922a281521\">[40391]</a></span>: minor 8.2.0 version history item edit. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3846\" onclick=\"get_ticket_and_populate_wrapper('3846'); return false;\" title=\"Round trip per attribute for remote condor_submit\">#3846</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jun-10 15:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/654bf2b6b24dfb2159d13b82dd2d0c07e703e19d\">[40385]</a></span>: Documentation for removal of round trips in condor_submit. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3846\" onclick=\"get_ticket_and_populate_wrapper('3846'); return false;\" title=\"Round trip per attribute for remote condor_submit\">#3846</a></span> Note we are purposefully not documenting the config knob SUBMIT_NOACK_ON_SETATTRIBUTE. Thus just a version history entry is needed.  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Jun-10 15:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1fded6bdec316c4e2873763fa18a62c8a46824f9\">[40383]</a></span>: Get rid of round trips for each setattribute in condor_submit. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3846\" onclick=\"get_ticket_and_populate_wrapper('3846'); return false;\" title=\"Round trip per attribute for remote condor_submit\">#3846</a></span>  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Sep-16 08:26", "status": "resolved", "created": "2013-Aug-11 20:10", "fixed_version": "2013-Aug-11 20:10", "broken_version": "", "priority": "2", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "cern", "visibility": "public", "notify": "", "due_date": ""}