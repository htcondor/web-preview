{"id": 2118, "title": "Ticket #2118: Infinite loop in evaluating classad expression", "description": "<blockquote>\nFound an infinite loop on malformed input when evaluating a $$ expression.  As long as write access is required to get a Condor daemon to evaluate $$, I don't think this is a security hole.  See submit file:\n\n<p></p><div class=\"verbatim\">\n<pre>Universe = vanilla\nNotification = Never\nExecutable = script.sh\n+Foo = \"]) $$([\"\nshould_transfer_files = YES\nwhen_to_transfer_output = ON_EXIT\ntransfer_output = true\nOutput = stuck.out\nError = stuck.out\nqueue 1\n</pre></div>\n\n\n<p>Backtrace:\n\n</p><p></p><div class=\"verbatim\">\n<pre>(gdb) bt\n#0  0x000000000063f8b5 in get_var (value=0x24bb286 \"([\\\"\", leftp=0x7fffba19b6f8, namep=0x7fffba19b6f0, rightp=0x7fffba19b6e8, self=0x0, getdollardollar=true, search_pos=0) at /usr/src/debug/condor-7.6.1/src/condor_utils/config.cpp:943\n#1  0x00000000004dcc06 in dollarDollarExpand (cluster_id=109, proc_id=0, ad=0x245cf50, startd_ad=0x2543cb0, persist_expansions=false) at /usr/src/debug/condor-7.6.1/src/condor_schedd.V6/qmgmt.cpp:3374\n#2  0x00000000004de070 in GetJobAd (cluster_id=109, proc_id=0, expStartdAd=true, persist_expansions=false) at /usr/src/debug/condor-7.6.1/src/condor_schedd.V6/qmgmt.cpp:3980\n#3  0x00000000004c4bb8 in Scheduler::contactStartd (this=0x974840, args=0x24cd690) at /usr/src/debug/condor-7.6.1/src/condor_schedd.V6/schedd.cpp:5214\n#4  0x00000000004c4fdf in Scheduler::checkContactQueue (this=0x974840) at /usr/src/debug/condor-7.6.1/src/condor_schedd.V6/schedd.cpp:5396\n#5  0x0000000000551055 in TimerManager::Timeout (this=0x9753a0) at /usr/src/debug/condor-7.6.1/src/condor_daemon_core.V6/timer_manager.cpp:419\n#6  0x0000000000543018 in DaemonCore::Driver (this=0x23e4c40) at /usr/src/debug/condor-7.6.1/src/condor_daemon_core.V6/daemon_core.cpp:3091\n#7  0x0000000000532ca7 in main (argc=1, argv=0x7fffba19c308) at /usr/src/debug/condor-7.6.1/src/condor_daemon_core.V6/daemon_core_main.cpp:2377\n\n</pre></div>\n\n\n<p>(NOTE: Original post had wrong backtrace; fixed)</p></blockquote>", "remarks": "<blockquote>\n<em>2011-May-06 11:40:41 by adesmet:</em> <br/>\n\nReviewed. Looks good to me.\n\n<p></p><hr/>\n<em>2011-May-06 11:43:03 by adesmet:</em> <br/>\n\nUpon second thought (and <span class=\"wiki\"><a href=\"wiki?p=PerformingCodeReviews\" title=\"Performing Code Reviews\">PerformingCodeReviews</a></span>), this really should have a regression test.\n\n<p></p><hr/>\n<em>2011-May-10 16:20:43 by adesmet:</em> <br/>\n\nNeed for regression test moved to <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=2151\" onclick=\"get_ticket_and_populate_wrapper('2151'); return false;\" title=\"Test broken $$ handling in classads4\">#2151</a></span>. Closing.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=2151\" onclick=\"get_ticket_and_populate_wrapper('2151'); return false;\" title=\"Test broken $$ handling in classads4\">#2151</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nTest broken $$ handling in classads4</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Apr-29 17:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b8d948bbb7e1dbedb5c60fe74663a93fe21fc3b6\">[21628]</a></span>: Fixed infinite loop in $$([ ]) expansion. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2118\" onclick=\"get_ticket_and_populate_wrapper('2118'); return false;\" title=\"Infinite loop in evaluating classad expression\">#2118</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2118\" onclick=\"get_ticket_and_populate_wrapper('2118'); return false;\" title=\"Infinite loop in evaluating classad expression\">#2118</a></span> ===VersionHistory=== Fixed a bug that caused the schedd to become unresponsive until killed when trying to run a job containing an attribute consisting of a string containing the characters $$([ but no closing ]).  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-May-10 16:20", "status": "resolved", "created": "2011-Apr-28 20:30", "fixed_version": "2011-Apr-28 20:30", "broken_version": "v070506", "priority": "2", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}