{"id": 6389, "title": "Ticket #6389: Support spaces in paths in DAG files", "description": "<blockquote>\nDAG files are not able to have spaces in paths as the current token parser chokes on these.  For use in a environment where users can choose path names and where an existing there are existing directory names with spaces it should be possible to use spaces in file names if they are quoted.  A fix to condor_submit is also required as issue will be hit here if the SUBDAG path contains whitespace.  I attach a series of patches to allow quoted paths with spaces in DAG files.\n\n<p>Note I'm happy to respin the patches following review.  (I was unsure about whether to have the constuctor for dag_tokener in the header file or in cpp file for example.)</p></blockquote>", "remarks": "<blockquote>\n<em>2018-Jan-05 10:25:48 by quintinhill:</em> <br/>\n\nIs there any way I can help to progress this?\n\n<p></p><hr/>\n<em>2018-Jan-05 13:31:04 by coatsworth:</em> <br/>\n\nHi Quintin, sorry for lack of updates about this :( I've been meaning to get around to this but other things keep coming up. I'll bring it up in our weekly meeting on Monday, and run your changes against our test suite to make sure nothing breaks. Stay tuned.\n\n<p></p><hr/>\n<em>2018-Jan-09 16:28:06 by coatsworth:</em> <br/>\n\nI brought this up in our meeting yesterday, now it's officially added to my to-do list.\n\n<p>First thing I tried was taking your patches and applying them to our most recent codebase. Fortunately everything seemed to apply correctly.\n\n</p><p>Next I tried building it locally on my CentOS 7 workstation -- also worked fine.\n\n</p><p>Last step was to try running it against our test suite. It worked fine everywhere except for the Windows machines, where the builds failed spectacularly with over 100 errors. There was nothing obvious in the error output (which I'll include below) that corresponded to your changes. Also my Windows test VMs are unavailable due to an OS upgrade, so I can't debug this right now.\n\n</p><p>If you could help me figure this out, that would definitely help speed things up! Our next release isn't until mid-February so there isn't a major rush. Let me know, if you don't have access to a Windows environment then I'll try to get mine fixed soon.\n\n</p><p>Here's the link to the error output (this link will expire in a week or so):\n\n</p><p><a class=\"external\" href=\"http://submit-3.batlab.org//nmi-runs/coatsworth/2018/01/coatsworth_submit-3.batlab.org_1515503564_1791501/userdir/nmi:x86_64_Windows10/remote_task.build.out\">http://submit-3.batlab.org//nmi-runs/coatsworth/2018/01/coatsworth_submit-3.batlab.org_1515503564_1791501/userdir/nmi:x86_64_Windows10/remote_task.build.out</a>\n\n</p><p></p><hr/>\n<em>2018-Jan-12 06:45:37 by quintinhill:</em> <br/>\n\nI have added two further patchs to correct the issue and was able to compile this using Visual Studio 2015 without encountering any errors.\n\n<p></p><hr/>\n<em>2018-Jan-19 10:11:22 by coatsworth:</em> <br/>\n\nThanks Quintin! I just applied your latest patches and tried again in our test suite. Everything is looking good this time.\n\n<p>I'm going to do a quick code review and then check this into our master branch. Expect to see it in our 8.7.7 release, which is scheduled for mid February. I'll update this ticket to confirm when it's in.\n\n</p><p></p><hr/>\n<em>2018-Feb-06 10:53:49 by coatsworth:</em> <br/>\n\nAlright, this code is merged in and will part of our 8.7.7 release in mid-late February. I made a couple small changes to the #include headers to make them consistent with existing Condor conventions, but otherwise added your code unchanged.\n\n<p>There's one big question that came up though. You made a change to the src/condor_utils/submit_utils.cpp file, where you removed whitespace checks from submit file parsing. Why did you take this out? This affects many components of the job pipeline. In theory allowing spaces shouldn't matter, but I'm worried about weird side effects or bugs we may not be noticing yet. Unless there's a compelling use case I'm hesitant to include this.\n\n</p><p></p><hr/>\n<em>2018-Feb-06 11:13:12 by quintinhill:</em> <br/>\n\nThis is necessary if a DAG file is in a directory with spaces in as the condor-submit of the dag job would fail with invalid error and output paths.  Currently the log and executable paths are able to contain spaces with no issue, it seems unnecessary to be stricter for the output paths. The intention of this guard is to prevent two arguments being passed for these options so the worst outcome seems to be that an incorrect path would be used but this path would be literally what is written in the file so that is not too bad.\n\n<p></p><hr/>\n<em>2018-Feb-06 14:00:40 by coatsworth:</em> <br/>\n\nHi Quintin, thanks for clarifying. I was a bit confused about how output files worked in the case of absolute paths, but discussed this with some of our other devs this morning, everybody is in agreement that the whitespace guard is unnecessary. So I'll leave your change as-is.\n\n<p>I'm going to document your change in our version history and then resolve this ticket. Thanks again for contributing!!</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6642\" onclick=\"get_ticket_and_populate_wrapper('6642'); return false;\" title=\"Support spaces in remapped file paths\">#6642</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nSupport spaces in remapped file paths</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7196\" onclick=\"get_ticket_and_populate_wrapper('7196'); return false;\" title=\"DAGMan parser segfaults when certain tokens are missing\">#7196</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDAGMan parser segfaults when certain tokens are missing</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/986/0001-dagman-parse-handle-quoted-paths.patch\">0001-dagman-parse-handle-quoted-paths.patch</a>\n1724 bytes added by quintinhill on 2017-Aug-30 13:48:37 UTC.\n</li><li><a href=\"../files/987/0002-submit-add-detail-to-error-message.patch\">0002-submit-add-detail-to-error-message.patch</a>\n1074 bytes added by quintinhill on 2017-Aug-30 13:49:02 UTC.\n</li><li><a href=\"../files/988/0003-submit-allow-whitespace-in-Output-and-Error-paths.patch\">0003-submit-allow-whitespace-in-Output-and-Error-paths.patch</a>\n1323 bytes added by quintinhill on 2017-Aug-30 13:49:11 UTC.\n</li><li><a href=\"../files/989/0004-condor_utils-add-include-for-NULL-in-list.h.patch\">0004-condor_utils-add-include-for-NULL-in-list.h.patch</a>\n664 bytes added by quintinhill on 2017-Aug-30 13:49:25 UTC.\n</li><li><a href=\"../files/990/0005-condor_utils-add-include-for-YourString-in-tokener.h.patch\">0005-condor_utils-add-include-for-YourString-in-tokener.h.patch</a>\n718 bytes added by quintinhill on 2017-Aug-30 13:49:36 UTC.\n</li><li><a href=\"../files/991/0006-dagman-allow-quoted-tokens-with-whitespace.patch\">0006-dagman-allow-quoted-tokens-with-whitespace.patch</a>\n6236 bytes added by quintinhill on 2017-Aug-30 13:49:47 UTC.\n</li><li><a href=\"../files/1011/0001-condor_includes-add-includes-to-condor_fix_assert.h.patch\">0001-condor_includes-add-includes-to-condor_fix_assert.h.patch</a>\n936 bytes added by quintinhill on 2018-Jan-12 12:43:39 UTC.\n<br/>\nI see it is an issue with the order of includes.  Please apply the two patches I am attaching to the issue before the sixth patch of the original set.<br/>\n</li><li><a href=\"../files/1012/0002-condor_utils-add-Windows-specific-define-to-MyString.patch\">0002-condor_utils-add-Windows-specific-define-to-MyString.patch</a>\n755 bytes added by quintinhill on 2018-Jan-12 12:44:15 UTC.\n<br/>\nSecond patch to fix compilation issue<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Mar-12 11:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54485\">[54485]</a></span>: Fixed documentation notes (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6389\" onclick=\"get_ticket_and_populate_wrapper('6389'); return false;\" title=\"Support spaces in paths in DAG files\">#6389</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-26 16:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54364\">[54364]</a></span>: Added documentation (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6389\" onclick=\"get_ticket_and_populate_wrapper('6389'); return false;\" title=\"Support spaces in paths in DAG files\">#6389</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-08 10:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54240\">[54240]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=54231\">[54231]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54232\">[54232]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54235\">[54235]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54236\">[54236]</a></span>, Merging master with DAGMan support spaces in paths (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6389\" onclick=\"get_ticket_and_populate_wrapper('6389'); return false;\" title=\"Support spaces in paths in DAG files\">#6389</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-06 11:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54239\">[54239]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=54191\">[54191]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54192\">[54192]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54197\">[54197]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54198\">[54198]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54199\">[54199]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54203\">[54203]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54204\">[54204]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54205\">[54205]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54206\">[54206]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54211\">[54211]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54212\">[54212]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54213\">[54213]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54218\">[54218]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54219\">[54219]</a></span>, Merging master with DAG support spaces in paths (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6389\" onclick=\"get_ticket_and_populate_wrapper('6389'); return false;\" title=\"Support spaces in paths in DAG files\">#6389</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Feb-06 11:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54238\">[54238]</a></span>: Rearranged include headers (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6389\" onclick=\"get_ticket_and_populate_wrapper('6389'); return false;\" title=\"Support spaces in paths in DAG files\">#6389</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jan-31 14:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54237\">[54237]</a></span>: Revised header files for Windows builds (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6389\" onclick=\"get_ticket_and_populate_wrapper('6389'); return false;\" title=\"Support spaces in paths in DAG files\">#6389</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jan-30 13:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54189\">[54189]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=54185\">[54185]</a></span>, Re-merge master + DAGMan support spaces in paths (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6389\" onclick=\"get_ticket_and_populate_wrapper('6389'); return false;\" title=\"Support spaces in paths in DAG files\">#6389</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jan-29 13:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54188\">[54188]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=52529\">[52529]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52530\">[52530]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52548\">[52548]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52551\">[52551]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52552\">[52552]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52553\">[52553]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52554\">[52554]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52556\">[52556]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52557\">[52557]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52558\">[52558]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52564\">[52564]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52565\">[52565]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52571\">[52571]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52572\">[52572]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52573\">[52573]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52574\">[52574]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52575\">[52575]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52577\">[52577]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52579\">[52579]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52580\">[52580]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52584\">[52584]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52586\">[52586]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52587\">[52587]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52589\">[52589]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52594\">[52594]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52596\">[52596]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52597\">[52597]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52598\">[52598]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52602\">[52602]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52603\">[52603]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=52610\">[52610]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54151\">[54151]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=54152\">[54152]</a></span>,\u00a0[...]\n (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jan-29 13:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54187\">[54187]</a></span>: Patched DAGMan code to support spaces in paths in DAG files (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6389\" onclick=\"get_ticket_and_populate_wrapper('6389'); return false;\" title=\"Support spaces in paths in DAG files\">#6389</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-Feb-26 16:52", "status": "resolved", "created": "2017-Aug-30 08:47", "fixed_version": "2017-Aug-30 08:47", "broken_version": "v010000", "priority": "4", "subsystem": "Dag", "assigned_to": "coatsworth", "derived_from": "", "creator": "quintinhill", "rust": "", "customer_group": "other", "visibility": "public", "notify": "quintin.hill@arqiva.com", "due_date": ""}