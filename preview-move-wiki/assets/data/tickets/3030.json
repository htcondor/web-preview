{"id": 3030, "title": "Ticket #3030: JobRouter should be able to route between multiple schedd's", "description": "<blockquote>\nFor the Condor-CE, it would be very useful if the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> could route between two schedd's on the same host.\n\n<p>Having everything run in one schedd is difficult because:\n</p><ul>\n<li>Writing a generic authz policy that merges the local authz and the remote authz is difficult to automate.\n</li><li>Creating a merged condor_mapfile and GSI_AUTHZ_CONF may not be possible from a packaging standpoint.\n</li><li>Detecting the location of the local site's configuration files so we can reliably \"drop in\" configs (as there are a huge number of variations of what sites have setup).\n</li><li>Sites will be eager to hard separate \"nasty grid users\" from their local schedd.  The site may not want to expose their main collector / schedd to remote users to prevent against denial of service attacks.\n</li></ul>\n\n<p>Dan has provided me with a draft patch that I've been using.  The biggest known issue is that <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SuperUserAllowedToSetOwnerTo\" title=\"Super User Allowed To Set Owner To\">SuperUserAllowedToSetOwnerTo</a></span> in qmgmt.cpp prevents the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> from submitting jobs for users that have not run directly.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Jun-13 17:17:18 by danb:</em> <br/>\n\nI attached a patch that adds a new config knob QUEUE_SUPER_USER_MAY_IMPERSONATE.  It is a regular expression that matches the owner names the queue super user is allowed to impersonate.  It could be set to .* in the config of the target schedd to allow routing of jobs owned by anyone.\n\n<p></p><hr/>\n<em>2012-Jul-13 14:56:50 by danb:</em> <br/>\n\nThe two-schedd mode has been committed to the trunk.  This ticket may be resolved, but I'll leave it in review status in case Zach wants to check over the security-related QUEUE_SUPER_USER_MAY_IMPERSONATE patch, which is needed for two-schedd routing.</blockquote>", "derived_tickets": "", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/571/condor-jr-2schedds.patch\">condor-jr-2schedds.patch</a>\n20757 bytes added by bbockelm on 2012-Jun-04 18:00:50 UTC.\n<br/>\nPatch from danb, with a slight tweak from me.<br/>\n</li><li><a href=\"attach_get/574/queue_super_user_may_impersonate.patch\">queue_super_user_may_impersonate.patch</a>\n2573 bytes added by danb on 2012-Jun-13 22:15:08 UTC.\n<br/>\nPatch to add QUEUE_SUPER_USER_MAY_IMPERSONATE.<br/>\n</li><li><a href=\"attach_get/575/condor-jr-2schedds-fix1.patch\">condor-jr-2schedds-fix1.patch</a>\n983 bytes added by danb on 2012-Jun-14 14:49:15 UTC.\n<br/>\nFix to be applied on top of condor-jr-2schedds.patch<br/>\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-15 14:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33080\">[33080]</a></span>: little corrections to defns of new Job Router config knobs ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3030\" onclick=\"get_ticket_and_populate_wrapper('3030'); return false;\" title=\"JobRouter should be able to route between multiple schedd's\">#3030</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-14 14:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=33047\">[33047]</a></span>: first pass LaTeX/labels/references fixes to make 7.9.1 version history appear right in html. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3030\" onclick=\"get_ticket_and_populate_wrapper('3030'); return false;\" title=\"JobRouter should be able to route between multiple schedd's\">#3030</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2993\" onclick=\"get_ticket_and_populate_wrapper('2993'); return false;\" title=\"Allow draining to be cancelled\">#2993</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-13 14:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32782\">[32782]</a></span>: Improved job_router two-schedd docs to mention when QUEUE_SUPER_USER_MAY_IMPERSONATE needs to be set. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3030\" onclick=\"get_ticket_and_populate_wrapper('3030'); return false;\" title=\"JobRouter should be able to route between multiple schedd's\">#3030</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-13 14:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32781\">[32781]</a></span>: Documented JobRouter's new two-schedd mode. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3030\" onclick=\"get_ticket_and_populate_wrapper('3030'); return false;\" title=\"JobRouter should be able to route between multiple schedd's\">#3030</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-13 14:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32780\">[32780]</a></span>: New feature: job_router can have different source and target schedds. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3030\" onclick=\"get_ticket_and_populate_wrapper('3030'); return false;\" title=\"JobRouter should be able to route between multiple schedd's\">#3030</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-13 11:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32768\">[32768]</a></span>: edit related to new knob QUEUE_SUPER_USER_MAY_IMPERSONATE ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3030\" onclick=\"get_ticket_and_populate_wrapper('3030'); return false;\" title=\"JobRouter should be able to route between multiple schedd's\">#3030</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-12 17:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32767\">[32767]</a></span>: Documented QUEUE_SUPER_USER_MAY_IMPERSONATE. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3030\" onclick=\"get_ticket_and_populate_wrapper('3030'); return false;\" title=\"JobRouter should be able to route between multiple schedd's\">#3030</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-12 16:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32766\">[32766]</a></span>: Added QUEUE_SUPER_USER_MAY_IMPERSONATE, a regex that controls which accounts the queue super user may \"own\". <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3030\" onclick=\"get_ticket_and_populate_wrapper('3030'); return false;\" title=\"JobRouter should be able to route between multiple schedd's\">#3030</a></span>\u00a0[...]\n (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-Oct-22 14:55", "status": "resolved", "created": "2012-Jun-04 12:47", "fixed_version": "2012-Jun-04 12:47", "broken_version": "", "priority": "2", "subsystem": "Daemons", "assigned_to": "zmiller", "derived_from": "#1376", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu tannenba@cs.wisc.edu dan@hep.wisc.edu jfrey@cs.wisc.edu", "due_date": ""}