{"id": 714, "title": "Ticket #714: Idle system checking is broken on Vista and higher", "description": "<blockquote>\nCondor uses the function <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GetLastInputInfo\" title=\"Get Last Input Info\">GetLastInputInfo</a></span> on Windows to check if the system is idle.  However, due to a change in how services run on Windows, this function no longer has access to the current running context and will not see any user input.  This was also noticed by the Marquette people and they are using the same function.  The only way to work around this that I have found is to start up a separate process under the current running user's context and have it check for any input using <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GetLastInputInfo\" title=\"Get Last Input Info\">GetLastInputInfo</a></span> and report back to the parent the values.  Currently waiting for access to MSDN to doublecheck if this is the only option and whether this will cause problems in the future.</blockquote>", "remarks": "<blockquote>\n<em>2009-Sep-04 10:57:50 by burnett:</em> <br/>\n\nYeah, this is the new Windows world order, services have their own window station that is separate from the interactive user's station.  I suspect we will see the same type of problem with the mouse idle code.  Maybe try something like the code bellow.  It assumes you have a great deal of privileges (which you will in Condor), and prints the the idle time for each.  It uses <code>WTSEnumerateSessions()</code> which  \"retrieves a list of sessions on a specified terminal server,\" so that we can check all sessions, even the interactive one. We use this because Vista simply uses the Terminal Services framework to provide support for multiple logins and privilege separation between the interactive desktop and the services' \"desktop\".\n\n<p></p><pre>  void\n  printSessionIdleTimes() {\n  \tDWORD\t\t\tcount\t\t= 0,\n  \t\t\t\tidle\t\t= 0;\n  \tHANDLE\t\t\ttoken\t\t= INVALID_HANDLE_VALUE,\n  \t\t\t\tsession_token\t= INVALID_HANDLE_VALUE;\n  \tWTS_SESSION_INFO\t*session_info\t= NULL;\n  \t__try{\n  \t\tif(!WTSEnumerateSessions(WTS_CURRENT_SERVER_HANDLE, 0, 1, &amp;session_info, &amp;count)){\n  \t\t\tcout &lt;&lt; \"WTSEnumerateSessions failed!\\n\";\n  \t\t\t__leave;\n  \t\t}\n  \t\tfor(DWORD i = 0; i &lt; count; ++i){\n  \t\t\tif(WTSActive == session_info[i].State){\n  \t\t\t\tif(!WTSQueryUserToken(session_info[i].SessionId, &amp;token)){\n  \t\t\t\t\tcout &lt;&lt; \"WTSQueryUserToken failed!\\n\";\n  \t\t\t\t\t__leave;\n  \t\t\t\t}\n  \t\t\t\tif(!DuplicateToken(token, SecurityImpersonation, &amp;session_token)){\n  \t\t\t\t\tcout &lt;&lt;\t\"DuplicateToken failed!\\n\";\n  \t\t\t\t\t__leave;\n  \t\t\t\t}\n  \t\t\t\tif(!ImpersonateLoggedOnUser(session_token)){\n  \t\t\t\t\tcout &lt;&lt; \"ImpersonateLoggedOnUser failed!\\n\";\n  \t\t\t\t\t__leave;\n  \t\t\t\t}\n  \t\t\t\tLASTINPUTINFO input_info;\n  \t\t\t\tGetLastInputInfo(&amp;input_info);\n  \t\t\t\tidle = GetTickCount() - input_info.dwTime;\n  \t\t\t\tRevertToSelf();\n  \t\t\t\tcout &lt;&lt; \"Idle time: \" &lt;&lt; idle &lt;&lt; \"\\n\";\n  \t\t\t}\n  \t\t}\n  \t} __finally {\n  \t\tRevertToSelf();\n  \t\tif(INVALID_HANDLE_VALUE != session_token){\n  \t\t\tCloseHandle(session_token);\n  \t\t}\n  \t\tif(INVALID_HANDLE_VALUE != token){\n  \t\t\tCloseHandle(token);\n  \t\t}\n  \t\tWTSFreeMemory(session_info);\n  \t}\n  }\n</pre>\n\n<p></p><hr/>\n<em>2009-Sep-04 11:02:12 by burnett:</em> <br/>\n\nAlso, when you say you need access to the MSDN, do you mean the disks, newsgroups, documentation, ..., magazines?  I'm not quite sure from our statement; let me know what you need and I'll do my best to point you in the right direction.\n\n<p></p><hr/>\n<em>2009-Sep-04 11:07:47 by ziliang:</em> <br/>\n\nAccess to the newsgroups.\n\n<p></p><hr/>\n<em>2009-Sep-11 09:47:15 by david.herzfeld:</em> <br/>\n\nI don't believe the proposed solution will work since the !ImpersonateLoggedOnUser() function does not allow the application to run in the session of the impersonated user (rather, it merely impersonates the \"security context\" of the requested user). Therefore, getLastInputInfo() will still return the information for session 0 (the service session) rather than for the session of the logged on user.\n\n<p>Also, as I understand it, impersonating a logged on user is rather expensive - especially if you need to perform this impersonation for each logged on user at regular intervals.\n\n</p><p>I think a better solution might be to register for changes (logon, etc) with Terminal Services via !WTSRegisterSesssionNotification(). Once a logon occurs, duplicate the user token (duplicateTokenEx()) and use CreateProcessWithToken() to start a new executable in the desired session. This executable would then have to communicate back to the Windows service - probably via a named pipe - at regular intervals.  Care would need to be taken to ensure that the named pipe maintained adequate security between session 0 and session 1-n.\n\n</p><p>Much of this could be accomplished with modification of the code that burnett proposed.\n\n</p><p></p><hr/>\n<em>2009-Oct-01 14:08:16 by ziliang:</em> <br/>\n\nAfter investigating having the master monitoring and starting up keyboard daemons on demand, it turns out that if the timing is just right, a user could log out, effectively killing the daemon, and log back in, before the master is aware of the log out, so the next time the master checks to see if there are any new logins it will not know that the logged on user had just logged in again.  So I'm going with modifying the installer to dump the daemon into the startup Registry.\n\n<p></p><hr/>\n<em>2009-Oct-02 12:27:01 by david.herzfeld:</em> <br/>\n\nI will attach the Marquette implementation of the service that I referenced above. Note: there is a fair amount of code specific to POVB, which can be ignored. Also, the code is written in VB.NET, but it should be trivial to convert it to C++/C#, etc.\n\n<p>The main points about the implementation:\n</p><ol>\n<li>When the service starts, it enumerates all of the active sessions. For each active session it finds, it duplicates the user token, and starts a daemon process in the user's session.\n</li><li>Every time Windows notes a session change (Logon/Logoff/Fast User Switch/System Lock, etc) the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=OnSessionChange\" title=\"On Session Change\">OnSessionChange</a></span> subroutine in the service is called. This checks to see if the event was a new logon, in which case it performs the same process as in (1) with the new session.\n</li><li>Idle information is sent back to the service from every daemon via a Named Pipe every 5 seconds. Results from all sessions are saved by the service and the lowest value is taken to be the \"system idle time.\"\n</li><li>For every daemon that the service starts, it notes the PID. When the service stops, all of these daemon processes are killed (although, some may no longer be around due to a log off).\n</li></ol>\n\n<p>It would be possible (and perhaps convenient) to change the security context of the running daemon processes, which would prevent users from killing them except in the case of a logout.\n\n</p><p>This service should work in the case that you described above (fast user logon/logoff -&gt; as the service is event driven not polling) as well as user switching (as opposed to logoff/logon), multiple sessions, remote desktop connections, etc. I have performed very preliminary testing on the application on Windows 7 (x86_64) and Windows Vista (x86/x86_64) although it \"should\" work on all Windows versions 2000 - 7.\n\n</p><p>Feel free to disregard if you feel a different direction is more appropriate.\n\n</p><p>David\n\n</p><p></p><hr/>\n<em>2009-Oct-02 12:32:20 by david.herzfeld:</em> <br/>\n\nSorry, can't attach the file as it is over the 300KB limit. I would be happy to email it to you.\n\n<p></p><hr/>\n<em>2009-Oct-02 20:56:57 by ziliang:</em> <br/>\n\nFrom a practical perspective, what is the advantage of having Condor/whatever monitor user logins and inject applications into the user session instead of having the application be set to automatically start up on user login?  I ask mainly because doing the monitoring does require a bit more invasive of a change to Condor, so I'd be reluctant to make it unless we gain something from it.\n\n<p></p><hr/>\n<em>2009-Oct-04 10:30:10 by david.herzfeld:</em> <br/>\n\nA number of points come to mind - but as I am rather unfamiliar with the logon scripts you mentioned, it is hard to offer anything concert.\n\n<p>However, perhaps you can answer a concern that I have regarding the logon script usage: can you confirm that the addition of a logon script to a system attached to a domain (eg, actively controlled by a domain controller) will run your script for domain users without some GPO?\n\n</p><p></p><hr/>\n<em>2009-Oct-04 10:35:30 by ziliang:</em> <br/>\n\nIt's not a login script, it's a registry key that you can add things to to tell Windows to start that application at user login.\n\n<p><a class=\"external\" href=\"http://social.msdn.microsoft.com/Forums/en/winformssetup/thread/7d728ee5-6bb8-409c-9f13-35b4c05bdd6d\">http://social.msdn.microsoft.com/Forums/en/winformssetup/thread/7d728ee5-6bb8-409c-9f13-35b4c05bdd6d</a>\n\n</p><p>The registry key itself is HKEY_LOCAL_MACHINE/Software/Microsoft/Windows/CurrentVersion/Run and I presume it's what keeps getting changed whenever an application like Adobe Reader tries to start up with the user login.\n\n</p><p></p><hr/>\n<em>2009-Oct-04 10:50:09 by ziliang:</em> <br/>\n\nThat said, I do not know exactly how this will come into play with an active directory domain without actual testing.  I don't think it will since this is in the local machine hive and not user, but depending on how draconian the group policy is set up, there may be a conflict.\n\n<p></p><hr/>\n<em>2009-Oct-04 16:00:55 by david.herzfeld:</em> <br/>\n\nYou may also want to look into the effect of some virus software on registry key. This location seems to be a fairly prevalent place for worms and trojans to attack. It is possible that some pretty standard virus software would remove your Condor key.\n\n<p></p><hr/>\n<em>2009-Oct-16 13:56:48 by zmiller:</em> <br/>\n\nthis has been committed to the V7_4_0-branch and merged appropriately.  i'm resolving this ticket.\n\n<p></p><hr/>\n<em>2010-Aug-23 14:34:59 by ziliang:</em> <br/>\n\nThat commit about reenabling kbdd registry was by me.  I was again committing from a machine I had never committed from.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=881\" onclick=\"get_ticket_and_populate_wrapper('881'); return false;\" title=\"Windows kbdd needs firewall exception\">#881</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nWindows kbdd needs firewall exception</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1031\" onclick=\"get_ticket_and_populate_wrapper('1031'); return false;\" title=\"condor_kbdd is unable to write to the log file and excepting\">#1031</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\ncondor_kbdd is unable to write to the log file and excepting</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1297\" onclick=\"get_ticket_and_populate_wrapper('1297'); return false;\" title=\"Kbdd messages could be ignored due to bad authorization defaults\">#1297</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nKbdd messages could be ignored due to bad authorization defaults</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1595\" onclick=\"get_ticket_and_populate_wrapper('1595'); return false;\" title=\"Insert kbdd startup to registry if not present\">#1595</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nInsert kbdd startup to registry if not present</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Aug-23 16:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/146f9fb7e49e148693b2c1195bbd38fb2263cffd\">[18863]</a></span>: Re-enable insertion of kbdd startup at login registry key, with correct git name. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=714\" onclick=\"get_ticket_and_populate_wrapper('714'); return false;\" title=\"Idle system checking is broken on Vista and higher\">#714</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Aug-23 15:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2c1dcca98a0b22c5c8a46d63b9ac5f4e07cb30fd\">[18862]</a></span>: Revert \"Re-enable registry insertion of kbdd startup at login. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=714\" onclick=\"get_ticket_and_populate_wrapper('714'); return false;\" title=\"Idle system checking is broken on Vista and higher\">#714</a></span>.\" Reverted because the committer information is \"unknown\". No pushing from anonymous git installs will be kept. This reverts commit 9d697a7bb87346dfe13914ecc82e70eb840e2106.  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Aug-23 14:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9d697a7bb87346dfe13914ecc82e70eb840e2106\">[18860]</a></span>: Re-enable registry insertion of kbdd startup at login. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=714\" onclick=\"get_ticket_and_populate_wrapper('714'); return false;\" title=\"Idle system checking is broken on Vista and higher\">#714</a></span>.  (By unknown )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Apr-19 12:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/75677392ab401c5b95f91a48c6fd6a0131829c6c\">[17881]</a></span>: Fix use of uninitialized variable causing kbdd to go haywire and chew up 100% CPU. Bug introduced in 7.4.0 <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=714\" onclick=\"get_ticket_and_populate_wrapper('714'); return false;\" title=\"Idle system checking is broken on Vista and higher\">#714</a></span>. Bug identified in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1337\" onclick=\"get_ticket_and_populate_wrapper('1337'); return false;\" title=\"condor_kbdd 100% cpu usage\">#1337</a></span>.  (By Alan De Smet )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Apr-15 17:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/04f25d8aa0a005346b75ba2ca149fbd45b3300cd\">[17871]</a></span>: Fix use of uninitialized variable causing kbdd to go haywire and chew up 100% CPU. Bug introduced in 7.4.0 <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=714\" onclick=\"get_ticket_and_populate_wrapper('714'); return false;\" title=\"Idle system checking is broken on Vista and higher\">#714</a></span>. Bug identified in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1337\" onclick=\"get_ticket_and_populate_wrapper('1337'); return false;\" title=\"condor_kbdd 100% cpu usage\">#1337</a></span>.  (By Alan De Smet )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-16 16:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fcf9e43860c64adffe2b82d2c8c6118d90f34009\">[16109]</a></span>: only define <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=WinMain\" title=\"Win Main\">WinMain</a></span> when actually compiling on windows (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=714\" onclick=\"get_ticket_and_populate_wrapper('714'); return false;\" title=\"Idle system checking is broken on Vista and higher\">#714</a></span>)  (By Zach Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-16 13:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1671ca31e6ba022638a9a9c571d30756d31768b7\">[16097]</a></span>: Make some minor corrections to defining variables across platform. Now all platforms treat _sysapi_last_x_event as a time_t. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=714\" onclick=\"get_ticket_and_populate_wrapper('714'); return false;\" title=\"Idle system checking is broken on Vista and higher\">#714</a></span>. Committer: Zach Miller  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-16 13:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b35be0920b0fdfc7479ccffc3e6269e1cb56fcf4\">[16098]</a></span>: Make condor_kbdd a win32 app instead of console and also modify daemon core to only call <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AllocConsole\" title=\"Alloc Console\">AllocConsole</a></span> if it isn't KBDD. This makes this daemon run invisible. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=714\" onclick=\"get_ticket_and_populate_wrapper('714'); return false;\" title=\"Idle system checking is broken on Vista and higher\">#714</a></span> Committer: Zach Miller  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-16 13:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9053036f150c44b74522827627aea7a2e8b44b9b\">[16100]</a></span>: Add condor_kbdd.exe to the correct registry key so it auto-starts on login. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=714\" onclick=\"get_ticket_and_populate_wrapper('714'); return false;\" title=\"Idle system checking is broken on Vista and higher\">#714</a></span> Committer: Zach Miller  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-16 13:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ca1f79a1e1e4051183708d9d9459783a932eef42\">[16096]</a></span>: Modify the kbdd to run as a daemon on Windows within the user account. It will then use <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GetLastInputInfo\" title=\"Get Last Input Info\">GetLastInputInfo</a></span> to check keyboard input every five seconds or so and send an update to the startd if it actually detects a change in the input. The idle checking code in the startd has also been modified to not bother\u00a0[...]\n (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-14 15:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3f193076722aee1542269e95260dd85892ae616c\">[16055]</a></span>: Add condor_kbdd.exe to the correct registry key so it auto-starts on login. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=714\" onclick=\"get_ticket_and_populate_wrapper('714'); return false;\" title=\"Idle system checking is broken on Vista and higher\">#714</a></span>  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-14 13:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/da7a21c29714aab0a124b1e97e15a5c0ba7904ca\">[16049]</a></span>: Make condor_kbdd a win32 app instead of console and also modify daemon core to only call <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=AllocConsole\" title=\"Alloc Console\">AllocConsole</a></span> if it isn't KBDD. This makes this daemon run invisible. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=714\" onclick=\"get_ticket_and_populate_wrapper('714'); return false;\" title=\"Idle system checking is broken on Vista and higher\">#714</a></span>  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-02 11:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c096f970bee44cc789b06dfd1c594df8d8bde5a7\">[15889]</a></span>: Make some minor corrections to defining variables across platform. Now all platforms treat _sysapi_last_x_event as a time_t. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=714\" onclick=\"get_ticket_and_populate_wrapper('714'); return false;\" title=\"Idle system checking is broken on Vista and higher\">#714</a></span>.  (By Ziliang Guo )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Oct-01 14:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ef3c7ff02ea0dff9dd7c42d1cf32350461a9ec06\">[15839]</a></span>: Modify the kbdd to run as a daemon on Windows within the user account. It will then use <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GetLastInputInfo\" title=\"Get Last Input Info\">GetLastInputInfo</a></span> to check keyboard input every five seconds or so and send an update to the startd if it actually detects a change in the input. The idle checking code in the startd has also been modified to not bother\u00a0[...]\n (By Ziliang Guo )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Aug-23 14:34", "status": "resolved", "created": "2009-Sep-03 21:04", "fixed_version": "2009-Sep-03 21:04", "broken_version": "v070300", "priority": "1", "subsystem": "Win32", "assigned_to": "ziliang", "derived_from": "", "creator": "ziliang", "rust": "", "customer_group": "other", "visibility": "public", "notify": "burnett@cs.wisc.edu, tannenba@cs.wisc.edu,pmackinn@redhat.com,david.herzfeld@marquette.edu, zmiller@cs.wisc.edu", "due_date": ""}