{"id": 7547, "title": "Ticket #7547: stream out or err fails for large files on 32 bit shadows", "description": "<blockquote>\nLIGO reports that stream_out and stream_err fail when appending to a file &gt; 32 bits worth.  Investigation shows that we aren't setting O_LARGEFILE in the shadow and chirp remote system calls.\n\n<p>Investigation reveals that ligo @ cardiff may have been streaming to a file on NFS.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Mar-20 17:08:14 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This change looks ok, but won't solve all large file problems with the 32-bit shadow. read(), write(), and lseek() calls all have a 32-bit offset/size value.\n\n</p><p></p><hr/>\n<em>2020-Apr-06 21:56:35 by gthain:</em> <br/>\n\nAfter getting a login at Cardiff and seeing the problem live, we determined that it isn't a problem with NFS or 32 bit shadows.  Rather, when user level checkpointing is on, an a job restarts, and stream output is on, the starter issues a remote system call to the shadow to seek to the end of the standard out or err.\n\n<p>Turns out there was a bug since time immemorial where the REMOTE_CONDOR_lseek remote system call always returns an int, not.an off_t or a long or a 64 bit quantity.  And that causes problems when the file is &gt; 32 bits long.\n\n</p><p></p><hr/>\n<em>2020-Apr-07 13:37:53 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>I agree with Jaime (code looks good but incomplete), but since this fixes a real problem, let's not hold it up.\n\n</p><p>You should probably update the release note to reflect the second patch.\n</p><hr/>\n<em>2020-Apr-10 07:43:03 by tim:</em> <br/>\n\nBulk change of target version from v080808 to v080809 using ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-06 22:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59243\">[59243]</a></span>: Allow stream stdout and stderr to work with files &gt; 32 bits <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7547\" onclick=\"get_ticket_and_populate_wrapper('7547'); return false;\" title=\"stream out or err fails for large files on 32 bit shadows\">#7547</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-10 13:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59119\">[59119]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7547\" onclick=\"get_ticket_and_populate_wrapper('7547'); return false;\" title=\"stream out or err fails for large files on 32 bit shadows\">#7547</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-10 13:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59118\">[59118]</a></span>: Allow chirp and stream_out to work with large files with 32 bit shadow <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7547\" onclick=\"get_ticket_and_populate_wrapper('7547'); return false;\" title=\"stream out or err fails for large files on 32 bit shadows\">#7547</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Apr-27 08:13", "status": "resolved", "created": "2020-Mar-10 13:46", "fixed_version": "2020-Mar-10 13:46", "broken_version": "v080800", "priority": "2", "subsystem": "", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "", "due_date": ""}