{"id": 7125, "title": "Ticket #7125: Publish HTCondor-CE build artifacts from Travis", "description": "<blockquote>\nWe would like to enhance the HTCondor-CE (<a class=\"external\" href=\"https://github.com/htcondor/htcondor-ce\">https://github.com/htcondor/htcondor-ce</a>) Travis CI so that it can deploy build artifacts upon a release. We'll start with pushing the UW-build source/binary RPMs, which TimT can then sign (<a class=\"external\" href=\"https://wiki.debian.org/Creating%20signed%20GitHub%20releases\">https://wiki.debian.org/Creating%20signed%20GitHub%20releases</a>), and place into the CHTC Yum repository.\n\n<p>(we'll continue to build the OSG HTCondor-CE in our own Koji)</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Jun-24 08:38:10 by matyas:</em> <br/>\n\nAutomatically deploying them to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitHub\" title=\"Git Hub\">GitHub</a></span> releases is easy enough.  Pushing to the HTCondor yum repos is not so easy because the deployment script won't have an AFS token.  We can scp them to local disk on moria and have a cron job move it to AFS.\n\n<p></p><hr/>\n<em>2019-Jun-24 09:19:28 by blin:</em> <br/>\n\nThat's fine, the signing and yum repo upload don't have to be automated.\n\n<p></p><hr/>\n<em>2019-Jun-25 18:22:48 by matyas:</em> <br/>\n\nI got this working on my fork: <a class=\"external\" href=\"https://github.com/matyasselmeci/htcondor-ce/releases\">https://github.com/matyasselmeci/htcondor-ce/releases</a>\n\n<p>Unfortunately the release contains 25 RPMs (one SRPM plus binary RPMs for the el6 and el7 uw builds).  Having to individually download, sign, and reupload all of those seems like a pain.  Having binary RPMs on Github releases is suboptimal anyway since it doesn't create a yum repo so people would have to resolve dependencies manually.\n\n</p><p>My advice is to only upload the SRPM to Github, and instead scp or rsync the binary RPMs to moria where Tim can sign them and put them in the yum repos.\n\n</p><p></p><hr/>\n<em>2019-Jun-26 13:32:02 by matyas:</em> <br/>\n\nCan someone give me a host and a login that I can use for scping the build products to? I'd rather not use matyas@moria...\n\n<p></p><hr/>\n<em>2019-Jun-28 10:55:26 by blin:</em> <br/>\n\nTim, would you like us to copy the binary RPMs over to a CS host or would you prefer to rebuild HTCondor-CE locally using the SRPM? If the former, is there aa specific user/host/location that we should use?\n\n<p></p><hr/>\n<em>2019-Jun-28 11:43:14 by tim:</em> <br/>\n\nI prefer Mat's suggestion of scping the build results to a local machine. I think we should create an account on submit-3.batlab.org for that purpose. I talked to Moate. This would an interim solution. We would have a different host for this function in the future.\n\n<p></p><hr/>\n<em>2019-Jul-02 19:52:33 by matyas:</em> <br/>\n\nIn the meantime, I created a \"download-build-products\" script that downloads all the files in a Github release (except the auto-created source tarball and zip file).\n\n<p></p><pre>  Usage: download-build-products matyasselmeci/htcondor-ce --tag=v3.2.2.3matyas\n</pre>\n\n<p>or leave off the --tag argument to download the \"latest release\".\n\n</p><p>I put the script in the opensciencegrid/tools repo - there's a checkout at /p/condor/workspaces/vdt/tools/github/download-build-products\n\n</p><p>Since the repo got moved from the opensciencegrid org to the htcondor org, I no longer have write access so I can't set up the deployment or the CI there.  Can someone give me write/admin access to htcondor/htcondor-ce?\n\n</p><p></p><hr/>\n<em>2019-Aug-09 15:30:37 by matyas:</em> <br/>\n\nAn update:\n\n<p>We decided against pushing the build artifacts to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GitHub\" title=\"Git Hub\">GitHub</a></span> since you can't make a yum repo.  Instead, the RPMs get scp'ed to <code>ci-xfer.chtc.wisc.edu</code>, into <code>/var/tmp/travis/htcondor/htcondor-ce-$TAG</code>, and Tim T can copy them to the proper location in AFS.\n\n</p><p></p><hr/>\n<em>2020-Jun-11 11:41:39 by matyas:</em> <br/>\n\nWe're considering this done. If we want to increase the automation, that can be a separate ticket.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2020-Jun-11 11:41", "status": "resolved", "created": "2019-Jun-21 14:38", "fixed_version": "2019-Jun-21 14:38", "broken_version": "", "priority": "1", "subsystem": "Packaging", "assigned_to": "matyas", "derived_from": "", "creator": "blin", "rust": "4555", "customer_group": "osg", "visibility": "public", "notify": "matyas@cs.wisc.edu blin@cs.wisc.edu bbockelman@morgridge.org tim@cs.wisc.edu", "due_date": ""}