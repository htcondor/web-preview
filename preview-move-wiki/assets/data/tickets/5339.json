{"id": 5339, "title": "Ticket #5339: TCP_FORWARDING_HOST disregarded.", "description": "<blockquote>\nBecause TCP_FORWARDING_HOST is present only in the original Sinful, and not in the addrs parameter, recent versions of HTCondor will correctly advertise the forwarding host but completely ignore it.  This causes us grief in the cloud, where it's fairly common for instances to have public IP addresses that aren't actually present on any interface in the instance.\n\n<p>(This applies to EC2, where we recommend using TCP_FORWARDING_HOST rather than CCB; but Jan Balewski was having trouble using TCP_FORWARDING_HOST as early as 8.3.6 in an <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=OpenStack\" title=\"Open Stack\">OpenStack</a></span> VM setup, where the internal[ly-reported] IP is different than the external IP.)</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Oct-26 11:18:18 by tlmiller:</em> <br/>\n\nThe patch permits TCP_FORWARDING_HOST to be either an IPv4 or an IPv6 address, but preserves the other protocol in the addrs entry.  This is arguably a semantic change, given the manual definition, but since the manual's definition can be obtained by turning off the offending protocol, Alan and I decided that the flexibility was probably worth it.\n\n<p>This patch does not support setting TCP_FORWARDING_HOST with a hostname (unless from_ip_string() is more ambitious than is probably wise).  (The existing, backwards-compability code however, will; on the other hand, it could also return an IPv6 address, so who knows.)  Do we want to support this moving forward?\n\n</p><p></p><hr/>\n<em>2015-Oct-26 13:45:52 by adesmet:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>Needs change to documentation and an entry in the version history gotcha if we're going to change behavior to no longer accept hostnames.\n\n</p><p>if fa.from_ip_string fails (that is, fa.is_valid() == false), we should log a warning that we're ignoring TCP_FORWARDING_HOST.\n\n</p><p></p><hr/>\n<em>2015-Oct-26 14:17:16 by tlmiller:</em> <br/>\n\nDuplicated the existing bad logic for hostname resolution, as this was easier than (a) documenting the change or (b) figuring out something sane and documenting /that/.\n\n<p></p><hr/>\n<em>2015-Oct-26 17:18:37 by adesmet:</em> <br/>\n\n<strong>Code Review</strong> Approved.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-26 14:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=46115\">[46115]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5339\" onclick=\"get_ticket_and_populate_wrapper('5339'); return false;\" title=\"TCP_FORWARDING_HOST disregarded.\">#5339</a></span>) Add a known-bug message to the 8.4.1 manual.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-26 14:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=46112\">[46112]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5339\" onclick=\"get_ticket_and_populate_wrapper('5339'); return false;\" title=\"TCP_FORWARDING_HOST disregarded.\">#5339</a></span>) Duplicate existing bad logic to avoid changing broken semantics about hostnames in TCP_FORWARDING_HOST. Update comments. Add version history item.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-25 16:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=46107\">[46107]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5339\" onclick=\"get_ticket_and_populate_wrapper('5339'); return false;\" title=\"TCP_FORWARDING_HOST disregarded.\">#5339</a></span>) When determining the public Sinful, use TCP_FORWARDING_HOST in the addrs parameter instead of the most-public interface address.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Oct-26 17:28", "status": "resolved", "created": "2015-Oct-23 10:37", "fixed_version": "2015-Oct-23 10:37", "broken_version": "v080400", "priority": "2", "subsystem": "Libs", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, adesmet@cs.wisc.edu", "due_date": ""}