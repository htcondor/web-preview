{"id": 5500, "title": "Ticket #5500: linux kernel tuning script should set dirty_bytes for cgroups", "description": "<blockquote>\nWhen Linux kernels of a rhel6 vintage are running starters configured to use cgroups to limit memory usage, and the cgroup memory policy is set to hard, the kernel will incorrectly OOM kill the cgroup when the cgroup has hit the memory limit, including the memory used by the kernel to buffer file system writes.  Usually, the kernel will simply flush this memory, but under some conditions, it doesn't, and OOM kills the cgroup.\n\n<p>To work around this problem, condor should limit the amount of memory used by the kernel for file system caching.  By default, it is 40 percent of all physical memory, which is way too much, especially on large-memory systems.\n\n</p><p>HTCondor's linux_kernel_tuning script will set /proc/sys/vm/dirty_bytes to 100Mb if cgroups is enabled.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Feb-22 13:07:07 by tim:</em> <br/>\n\nThis should be back ported to stable.\n\n<p></p><hr/>\n<em>2016-Mar-21 17:44:34 by tim:</em> <br/>\n\n<strong>CODE REVIEW</strong>: Looks good</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-21 17:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48072\">[48072]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5500\" onclick=\"get_ticket_and_populate_wrapper('5500'); return false;\" title=\"linux kernel tuning script should set dirty_bytes for cgroups\">#5500</a></span> Minor version history edits. Set release date in the manual and set RPM build for final release.  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Feb-25 11:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47649\">[47649]</a></span>: Constraint /proc/sys/vm/dirty_bytes to 100mb if cgroups on <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5500\" onclick=\"get_ticket_and_populate_wrapper('5500'); return false;\" title=\"linux kernel tuning script should set dirty_bytes for cgroups\">#5500</a></span> This works around problems where the kernel sends OOM when the cgroup isn't really otherwise out of memory. Committer: Tim Theisen  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Feb-02 14:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47543\">[47543]</a></span>: Constraint /proc/sys/vm/dirty_bytes to 100mb if cgroups on <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5500\" onclick=\"get_ticket_and_populate_wrapper('5500'); return false;\" title=\"linux kernel tuning script should set dirty_bytes for cgroups\">#5500</a></span> This works around problems where the kernel sends OOM when the cgroup isn't really otherwise out of memory.  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Mar-21 17:48", "status": "resolved", "created": "2016-Feb-02 13:47", "fixed_version": "2016-Feb-02 13:47", "broken_version": "v080400", "priority": "3", "subsystem": "", "assigned_to": "tim", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": "20160202"}