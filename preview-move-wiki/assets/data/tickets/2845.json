{"id": 2845, "title": "Ticket #2845: schedd and negotiator fail to exchange claim id", "description": "<blockquote>\nBen Cotton reports a configuration that results in the following error in the <code>ScheddLog</code>:\n\n<p></p><pre>    Can't receive ClaimId from negotiator\n</pre>\n\n<p>The negotiator reports this:\n\n</p><p></p><pre>    Sending SEND_JOB_INFO/eom\n    condor_write(): Socket closed when trying to write 13 bytes to schedd bcotton@rcac.purdue.edu, fd is 7\n</pre>\n\n<p>I can reproduce the problem with the following configuration in a personal condor in which GSI authentication always fails:\n\n</p><p></p><div class=\"verbatim\">\n<pre>SCHEDD.SEC_NEGOTIATOR_AUTHENTICATION_METHODS = GSI\nSCHEDD.SEC_NEGOTIATOR_AUTHENTICATION = PREFERRED\n</pre></div>\n\n\n<p>I believe the problem happens when authentication fails but was not required.  Here is the schedd log with D_NETWORK:\n\n</p><p></p><div class=\"verbatim\">\n<pre>DC_SECURITY: authentication of 128.105.48.170 failed but was not required, so continuing.\n...\nencrypting secret\nStream::get(int) incorrect pad received: ffffff94\nCan't receive ClaimId from negotiator\n</pre></div>\n\n\n<p>Notice \"encrypting secret\" in the log.  This does not appear in the negotiator log.  The two sides are supposed to be symmetric with respect to choice of whether to encrypt secrets or not.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Mar-19 17:26:15 by tannenba:</em> <br/>\n\nFYI, <a class=\"external\" href=\"https://lists.cs.wisc.edu/archive/condor-users/2012-February/msg00146.shtml\">here is the original problem report</a> on condor-users.\n\n<p></p><hr/>\n<em>2012-Mar-19 17:42:54 by zmiller:</em> <br/>\n\n<strong>REVIEWED BY ZMILLER</strong> -- looks good!</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Feb-24 17:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=30708\">[30708]</a></span>: Documented fix for get/put_secret bug. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2845\" onclick=\"get_ticket_and_populate_wrapper('2845'); return false;\" title=\"schedd and negotiator fail to exchange claim id\">#2845</a></span> ===VersionHistory:Complete===  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Feb-24 16:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=30707\">[30707]</a></span>: Fix for bug in get/put_secret(). <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2845\" onclick=\"get_ticket_and_populate_wrapper('2845'); return false;\" title=\"schedd and negotiator fail to exchange claim id\">#2845</a></span> When authentication failed but was not required, the server side incorrectly behaved as though encryption was possible. This resulted in failure to communicate when get/put_secret() were used.  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Mar-19 17:43", "status": "resolved", "created": "2012-Feb-24 12:25", "fixed_version": "2012-Feb-24 12:25", "broken_version": "v070600", "priority": "4", "subsystem": "", "assigned_to": "zmiller", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "purdue", "visibility": "public", "notify": "dan@hep.wisc.edu, tstclair@redhat.com", "due_date": ""}