{"id": 5548, "title": "Ticket #5548: per-job history file contains the same attribute multiple times", "description": "<blockquote>\nWhen writing the per-job history file, attributes that were updated while the job is running appear twice.f\n\n<p>This is because we serialize the Cluster and per-proc chained classads into the file.  We need to merge these in-memory before writing to the file.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Mar-16 15:07:28 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>In <code>sPrintAd()</code>, the argument to <code>LookupIgnoreChain()</code> can be <code>itr-&gt;first</code> (without the call to <code>c_str()</code> ). That will eliminate a possible copy of the attribute name.\n\n</p><p>Otherwise, this looks good.\n\n</p><p></p><hr/>\n<em>2016-Mar-16 16:59:03 by tannenba:</em> <br/>\n\nCode review issue addressed in commit <span class=\"chng\"><a href=\"chngview?cn=48043\">[48043]</a></span>\n\n<p>Resolving.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-16 16:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48043\">[48043]</a></span>: Eliminate unneeded deep-copy of a string. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5548\" onclick=\"get_ticket_and_populate_wrapper('5548'); return false;\" title=\"per-job history file contains the same attribute multiple times\">#5548</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-15 18:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48035\">[48035]</a></span>: Added version history blurb for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5548\" onclick=\"get_ticket_and_populate_wrapper('5548'); return false;\" title=\"per-job history file contains the same attribute multiple times\">#5548</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-15 17:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48031\">[48031]</a></span>: Avoid duplicated attributes in serialized <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5548\" onclick=\"get_ticket_and_populate_wrapper('5548'); return false;\" title=\"per-job history file contains the same attribute multiple times\">#5548</a></span> This patch changes sPrintAd() to avoid printing out the same attribute multiple times when the ad has a chained parent. This was causing users grief in, for instance, per-job history files.  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Mar-16 16:59", "status": "resolved", "created": "2016-Mar-04 03:13", "fixed_version": "2016-Mar-04 03:13", "broken_version": "v080200", "priority": "3", "subsystem": "Libs", "assigned_to": "tannenba", "derived_from": "", "creator": "zmiller", "rust": "", "customer_group": "atlas", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}