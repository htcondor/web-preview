{"id": 3602, "title": "Ticket #3602: RPM upgrade changes permissions, breaks privsep", "description": "<blockquote>\nCurrently, the CHTC pool uses privsep in its HTCondor configuration (though this may change soon).   The CHTC pool is also configured to use slot directories located in /var/lib/condor/execute.  HTcondor will throw errors in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StarterLog\" title=\"Starter Log\">StarterLog</a></span>, if privsep is enabled and directory ownership/mode <strong>does not</strong> reflect the following (these are the correct privsep permissions):\n\n<p>drwxr-xr-x.  4 root root 4096 Jan 14 17:36 /var/lib/condor\ndrwxr-xr-x. 43 root root 4096 Apr 29 17:20 /var/lib/condor/execute\n\n</p><p>The error that shows up is:\n\n</p><p>04/29/13 17:09:39 privsep_reap_switchboard: error received: exited with non-zero status (1) and message (unsafe permissions in directory parent (/var/lib/condor/execute)\n)\n04/29/13 17:09:39 ERROR \"CondorPrivSepHelper::initialize_sandbox: privsep_create_dir error on /var/lib/condor/execute/dir_53591\" at line 101 in file /slots/02/dir_14487/userdir/src/condor_starter.V6.1/condor_privsep_helper.UNIX.cpp\n\n</p><p>The UW HTcondor rpm sets directory ownership/mode to:\n\n</p><p>drwxr-xr-x. 4 condor condor 4096 Jan 14 17:36 /var/lib/condor\ndrwxrwxrwt. 3 condor condor 18 Jan 14 17:36 /var/lib/condor/execute/\n\n</p><p>This breaks privsep with the error seen above.  It may be sensible for a newly-insalled HTCondor instance to have these ownership/modes as a default configurion;  However, doing a \"yum update condor\" results in the the ownership/modes reverting to the default, which is privsep-incompatible.  I don't really think it's good for a package to change directory ownership/mode without explicit administrator authorization, much like it's not good for a package to change configuration files without authorization.  It may behoove us to alter the UW HTcondor RPM to leave directory ownership/mode alone in the case of an update.  It would certainly help anybody who uses privsep (if there is anybody).\n\n</p><p>This issue is probably older than 7.8.3;  That's just the oldest HTcondor in the repository we use.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Apr-29 21:09:10 by nwp:</em> <br/>\n\nAdd condor to the valid-user-ids, as documented in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3573\" onclick=\"get_ticket_and_populate_wrapper('3573'); return false;\" title=\"Execute directories left behind when privsep is in use\">#3573</a></span>\n\n<p></p><hr/>\n<em>2020-Jun-08 10:04:40 by tannenba:</em> <br/>\n\nAs privsep is deprecated, marking this ticket as abandoned.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2020-Jun-08 10:04", "status": "abandoned", "created": "2013-Apr-29 17:27", "fixed_version": "2013-Apr-29 17:27", "broken_version": "v070803", "priority": "4", "subsystem": "Packaging", "assigned_to": "edquist", "derived_from": "", "creator": "moate", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "moate@cs.wisc.edu", "due_date": ""}