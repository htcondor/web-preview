{"id": 559, "title": "Ticket #559: SOAP requests are authorized as though from IP 0.0.0.0", "description": "<blockquote>\nBecky observed in Condor 7.1.4 in NMI that SOAP requests to the schedd are checked for authorization as though originating from IP address 0.0.0.0.\n\n<p>I reproduced this behavior in the current master and verified that the following patch appears to solve the problem.  This patch should probably be applied to 7.2 branch, but note that in 7.2, peer_addr() is called endpoint().\n\n</p><p>Could one of the SOAP gurus please review?\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">diff --git a/src/condor_daemon_core.V6/daemon_core.cpp b/src/condor_daemon_core.V6/daemon_core.cpp\nindex 5707b43..601f8c2 100644\n--- a/src/condor_daemon_core.V6/daemon_core.cpp\n+++ b/src/condor_daemon_core.V6/daemon_core.cpp\n@@ -4033,6 +4033,7 @@ int DaemonCore::HandleReq(Stream *insock, Stream* asock)\n                        //   3. increase size of send and receive buffers\n                        //   4. set SO_KEEPALIVE [done automatically by CEDAR accept()]\n                cursoap-&gt;socket = ((Sock*)stream)-&gt;get_file_desc();\n+               cursoap-&gt;peer = *((Sock*)stream)-&gt;peer_addr();\n                cursoap-&gt;recvfd = soap-&gt;socket;\n                cursoap-&gt;sendfd = soap-&gt;socket;\n                if ( cursoap-&gt;recv_timeout &gt; 0 ) {\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2009-Jun-15 11:33:54 by tannenba:</em> <br/>\n\nYep, patch looks good, thanks.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jun-15 14:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b069c42c5a7c640e028596e5fe6102d459183a56\">[14912]</a></span>: SOAP operations were being authorized with peer IP 0.0.0.0. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=559\" onclick=\"get_ticket_and_populate_wrapper('559'); return false;\" title=\"SOAP requests are authorized as though from IP 0.0.0.0\">#559</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Jun-12 15:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/918bf04976981da9d2a63b1f724ca89a3a4d26d8\">[14893]</a></span>: SOAP operations were being authorized with peer IP 0.0.0.0. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=559\" onclick=\"get_ticket_and_populate_wrapper('559'); return false;\" title=\"SOAP requests are authorized as though from IP 0.0.0.0\">#559</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-31 13:40", "status": "resolved", "created": "2009-Jun-11 17:50", "fixed_version": "2009-Jun-11 17:50", "broken_version": "v070200", "priority": "4", "subsystem": "Daemons", "assigned_to": "tannenba", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "tannenba@cs.wisc.edu,bgietzel@cs.wisc.edu,matt@cs.wisc.edu,danb@cs.wisc.edu", "due_date": ""}