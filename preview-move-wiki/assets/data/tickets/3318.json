{"id": 3318, "title": "Ticket #3318: job log doesn't show resources used when machine ad is referenced", "description": "<blockquote>\nIf you use an expression that references the machine ad for <code>RequestCpus</code>, <code>RequestMemory</code>, etc.  The requested value will not be written into the job log in the job terminate event.\n\n<p>for example  </p><div class=\"verbatim\">\n<pre>RequestCpus = TotalCpus</pre></div>\n causes the Cpu's line to be entirely missing from the termnate event:<div class=\"verbatim\">\n<pre>005 (081.000.000) 11/12 10:20:36 Job terminated.\n        (1) Normal termination (return value 0)\n                Usr 0 00:00:00, Sys 0 00:00:00  -  Run Remote Usage\n                Usr 0 00:00:00, Sys 0 00:00:00  -  Run Local Usage\n                Usr 0 00:00:00, Sys 0 00:00:00  -  Total Remote Usage\n                Usr 0 00:00:00, Sys 0 00:00:00  -  Total Local Usage\n        10133  -  Run Bytes Sent By Job\n        1296  -  Run Bytes Received By Job\n        10133  -  Total Bytes Sent By Job\n        1296  -  Total Bytes Received By Job\n        Partitionable Resources :    Usage  Request\n           Disk (KB)            :      171      171\n           Memory (MB)          :       10       10\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Nov-14 16:48:15 by johnkn:</em> <br/>\n\nNote: there is code to print out Allocated resources, but it can't work because those attributes are in the machine ad, which is not available at the point where we create the terminate event.\n\n<p>The proposed solution is to propagate Cpus, Disk, Memory, etc from the machine ad to the job ad when the SCHEDD expands the job ad.  At this time we will also evaluate RequestXXX attributes and, if they evaluate to a constant value, write the resulting constant back into the job ad.  This solves the problem of\n</p><div class=\"verbatim\">\n<pre>RequestCpus = TotalCpus</pre></div>\n not generating any useful output in the event log.\n\n<p></p><hr/>\n<em>2012-Nov-15 15:31:16 by jfrey:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p></p><ul>\n<li>In set_usageAd() and dollarDollarExpand(), you copy over integers,\n  reals, booleans, and Error, but nothing else. If the attribute\n  evalutes to an unexpected value, is it better to print 'Error' or\n  'Undefined' in the terminate event, or to leave that entry blank?\n  The behavior is inconsistent.\n\n<p></p></li><li>In comment at qmgmt.cpp:3662, <span class=\"quote\">DiskProvisionedDisk</span> should be\n  <span class=\"quote\">DiskProvisioned</span>?</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Dec-04 10:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/51c870b3f6d6a0e79da4cf2489e338207b7a170d\">[34258]</a></span>: version history item spelling correction ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3318\" onclick=\"get_ticket_and_populate_wrapper('3318'); return false;\" title=\"job log doesn't show resources used when machine ad is referenced\">#3318</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Nov-15 13:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dc8a60eaec844a4cd8694de713f7df6fdc177317\">[34126]</a></span>: Add version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3314\" onclick=\"get_ticket_and_populate_wrapper('3314'); return false;\" title=\"condor_who truncates program name\">#3314</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3318\" onclick=\"get_ticket_and_populate_wrapper('3318'); return false;\" title=\"job log doesn't show resources used when machine ad is referenced\">#3318</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Nov-14 18:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d3734158be0d1430c443e7a2f495766ff19c26ae\">[34123]</a></span>: propagate provisioned resources from machine ad into job ad when job ad is expanded, also evaluate <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestCpus\" title=\"Request Cpus\">RequestCpus</a></span>, etc against machine ad at this time so that we know the actual values to print out in the job log in the terminate event <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3318\" onclick=\"get_ticket_and_populate_wrapper('3318'); return false;\" title=\"job log doesn't show resources used when machine ad is referenced\">#3318</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Aug-04 11:43", "status": "resolved", "created": "2012-Nov-13 08:42", "fixed_version": "2012-Nov-13 08:42", "broken_version": "v070902", "priority": "4", "subsystem": "", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "johnkn@cs.wisc.edu, tstclair@redhat.com", "due_date": ""}