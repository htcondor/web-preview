{"id": 2968, "title": "Ticket #2968: submit should modify requirements when request_cpus is non-zero", "description": "<blockquote>\ncondor_submit should add <div class=\"code\">\n<pre class=\"code\">(TARGET.Cpus &gt;= RequestCpus)</pre></div>\n when the submit file defines a value for request_cpus.</blockquote>", "remarks": "<blockquote>\n<em>2012-May-02 20:29:48 by johnkn:</em> <br/>\n\nnote: the checkin for this fix also fixes the problem reported by igor\n\n<p></p><ul>\n<li>too many/undesired warnings about Memory in Requirements\n</li><li>no way to disable having <code>RequestMemory</code> added to Requirements.\n</li></ul>\n\n<p>there is now a config knob (not yet added to param_info.in) ENABLE_DEPRECATION_WARNINGS\n\n</p><p>Also, </p><div class=\"code\">\n<pre class=\"code\">RequestMemory = undefined</pre></div>\n no longer results in a explicit <code>RequestMemory</code> attribute with a value of undefined being added to the job ad. And also, this disables the adding of <code>RequestMemory</code> to <code>Requirements</code>.  Setting the value of <code>RequestMemory</code> to 0 also disables adding to <code>Requirements</code>   The same logic also applies to <code>RequestDisk</code> and <code>RequestCpus</code>\n\n<p>-tj\n\n</p><p></p><hr/>\n<em>2012-May-03 09:57:26 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p></p><ul>\n<li>In <code>SetMachineCount()</code>, if <code>RequireCpus</code> is set to undefined or if no value can be found for it, the previous contents of <code>buffer</code> (if any) is inserted a second time. To avoid this, move the <code>InsertJobExpr()</code> call at the end of the function up to each place <code>buffer</code> is set.\n\n<p></p></li><li>In <code>SetImageSize()</code>, <code>request_memory</code> in the submit file can be fancy (e.g. <code>2.2G</code>), but <code>JOB_DEFAULT_REQUESTMEMORY</code> cannot. The same is true for <code>request_disk</code> and <code>JOB_DEFAULT_REQUESTDISK</code>). This is likely to be confusing to users.\n\n<p></p></li><li>Adding a <code>(TARGET.Cpus&gt;=RequestCpus)</code> clause to <code>Requirements</code> breaks scheduler and local universes (Nathan tripped over this this morning). We should add a <code>Cpus</code> attribute to the schedd ad used to match these jobs.\n</li></ul>\n\n<p></p><hr/>\n<em>2012-May-03 10:55:38 by jfrey:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>It looks like your new changes fix the <code>RequestCpus</code> requirements problem and the <code>InsertJobExpr()</code> problem.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-23 14:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/35fc82240a7a74c0197c7a10dc685b834fced670\">[32098]</a></span>: document ENABLE_DEPRECATION_WARNINGS. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2968\" onclick=\"get_ticket_and_populate_wrapper('2968'); return false;\" title=\"submit should modify requirements when request_cpus is non-zero\">#2968</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-14 12:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c09f9c77e0e37d7da075d484f63431440836555a\">[32036]</a></span>: add ENABLE_DEPRECATION_WARNINGS to default param table <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2968\" onclick=\"get_ticket_and_populate_wrapper('2968'); return false;\" title=\"submit should modify requirements when request_cpus is non-zero\">#2968</a></span>, default value is false ===VersionHistory:Complete=== completed in a previous commmit.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-03 12:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ed3bae4a7c6e4a8875b10be1ecee9b1935977967\">[31916]</a></span>: Add Cpus attribute to schedd ad used for matching local jobs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2968\" onclick=\"get_ticket_and_populate_wrapper('2968'); return false;\" title=\"submit should modify requirements when request_cpus is non-zero\">#2968</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-03 10:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/88422fca38c0e5ef7d730742183518abaaf2130b\">[31911]</a></span>: fix bug in submit where <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestCpus\" title=\"Request Cpus\">RequestCpus</a></span> may not be set into the job ad correctly. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2968\" onclick=\"get_ticket_and_populate_wrapper('2968'); return false;\" title=\"submit should modify requirements when request_cpus is non-zero\">#2968</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-02 20:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/548a81aed3638ff23712ef8fade60d722b47609b\">[31899]</a></span>: submit should add <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RequestCpus\" title=\"Request Cpus\">RequestCpus</a></span> to Requirements when it is specified. (because Todd already told people that it does... oops). <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2968\" onclick=\"get_ticket_and_populate_wrapper('2968'); return false;\" title=\"submit should modify requirements when request_cpus is non-zero\">#2968</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-May-14 12:27", "status": "resolved", "created": "2012-May-02 20:15", "fixed_version": "2012-May-02 20:15", "broken_version": "v070706", "priority": "1", "subsystem": "", "assigned_to": "johnkn", "derived_from": "#2842", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}