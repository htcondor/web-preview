{"id": 4944, "title": "Ticket #4944: New $macro expansion functions for submit", "description": "<blockquote>\nThe config/submit macro expander should be extended with functions to allow\n\n<p></p><ul>\n<li>expanding only parts of a filename\n</li><li>expanding an integer with a specified field with (optionally with leading zeros)\n</li><li>expanding a substring\n</li><li>evaluating integer/real expression at expansion time\n</li><li>expanding a single item from a list\n</li></ul>\n\n<p>new functions\n\n</p><p></p><ul>\n<li><code>$CHOICE(index,listname)</code> or <code>$CHOICE(index,item1,item2,...)</code>\n</li><li><code>$SUBSTR(name,start)</code> or <code>$SUBSTR(name,start,length)</code>\n</li><li><code>$INT(name)</code> or <code>$INT(name,format-specifier)</code>\n</li><li><code>$REAL(name)</code> or <code>$REAL(name,format-specifier)</code>\n</li><li><code>$F[pdnxq](name)</code> or <code>$BASENAME(name)</code> or <code>$DIRNAME(name)</code>\n</li></ul>\n\n<p><code>$CHOICE(index,listname)</code> <br/>\n  Expands to the N'th item in $(listname). if $(index) is found, it is expanded and evaluated to determine N, otherwise \"index\" is evaluated to determine N.\n\n</p><p><code>$CHOICE(index,item1,item2,...)</code> <br/>\n  Expands the the N+1'th item in the $CHOICE argument list. if $(index) is found, it is expanded and evaluated to determine N, otherwise \"index\" is evaluated to determine N.\n\n</p><p><code>$SUBSTR(name,start[,length])</code> <br/>\n  Expands $(name) and returns length characters from the string starting with start. if $(start) is found, it is expanded and evaluated otherwise \"start\" is evaluated. if $(length) is found it is expanded and evaluated, otherwise \"length\" is evaluated. If start &lt; 0, then start is treated as and offset from the end of the string rather than from the beginning. if length is not specified, the everything from start to the end of the string is returned. if length &lt; 0, then it is added to the actual string length to the the number of characters returned, so $SUBSTR(name,0,-2) returns all but the last 2 characters of the expanded name.\n\n</p><p><code>$INT(name[,print-specifier])</code> <br/>\n If $(name) exists, it is expanded and evaluated, otherwise \"name\" is evaluated.  The resulting <code>long long</code> value is converted to a string using the printf format specifier. If no format is specified \"%d\" is used.\n\n</p><p><code>$REAL(name[,print-specifier])</code> <br/>\n If $(name) exists, it is expanded and evaluated, otherwise \"name\" is evaluated.  The resulting <code>double</code> value is converted to a string using the printf format specifier. If no format is specified \"%.16G\" is used.  \".0\" is appended if the resulting string has no \".\"\n\n</p><p><code>$F[pdnxq](name)</code> <br/>\n $(name) is expanded, then parsed as a filename and parts are returned based on the characters specified after $F. $BASENAME is the same as $Fnx.  $DIRNAME is the same is $Fp.  But $Fp is more expressive because the letters can be combined in arbitrary ways.\n\n</p><p></p><ul>\n<li>p - print the entire directory portion if any. with trailing /\n</li><li>d - print the last segment of the directory if any, with trailing /\n</li><li>n - print the filename without extension\n</li><li>x - print the file extension including leading .\n</li><li>q - print double quotes around the entire output.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-22 17:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/85087fda02715bb4cb1b7c0e08c1879ac08d2f02\">[44705]</a></span>: documentation corrections to definitions of function macros <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4944\" onclick=\"get_ticket_and_populate_wrapper('4944'); return false;\" title=\"New $macro expansion functions for submit\">#4944</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-21 11:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3b2979cf4dbf00110d67ac9d936a3aa4caf02e2f\">[44691]</a></span>: Added 3 examples of submit description file contents that use the new function macros. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4944\" onclick=\"get_ticket_and_populate_wrapper('4944'); return false;\" title=\"New $macro expansion functions for submit\">#4944</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-15 16:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f064ac94d161bab0d32fe5f3f7526d5630713d6e\">[44627]</a></span>: New features for queuing jobs are grouped together in the 8.3.5 version history, and a <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4944\" onclick=\"get_ticket_and_populate_wrapper('4944'); return false;\" title=\"New $macro expansion functions for submit\">#4944</a></span> version history item is added <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4913\" onclick=\"get_ticket_and_populate_wrapper('4913'); return false;\" title=\"submit files should support if/else and include like config files\">#4913</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4819\" onclick=\"get_ticket_and_populate_wrapper('4819'); return false;\" title='\"queue\" for multiple files'>#4819</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-14 15:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/29ab8b808e0b20e16abcf90a7a8ff4b547ef51e9\">[44610]</a></span>: all new function macros now have definitions <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4944\" onclick=\"get_ticket_and_populate_wrapper('4944'); return false;\" title=\"New $macro expansion functions for submit\">#4944</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-08 16:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b42516713d51fa948f8e5ab2c081ecc7551a50ac\">[44571]</a></span>: Most of the new macro functions have definitions. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4944\" onclick=\"get_ticket_and_populate_wrapper('4944'); return false;\" title=\"New $macro expansion functions for submit\">#4944</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Apr-07 16:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/eb88cfc89687fb01cba232abe6e566fceb170d2f\">[44558]</a></span>: organization and initial prose for new macro functions in submit or configuration files <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4944\" onclick=\"get_ticket_and_populate_wrapper('4944'); return false;\" title=\"New $macro expansion functions for submit\">#4944</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Mar-25 12:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/10c9153bcaf2d481a7fea0a20d87d80474627827\">[43720]</a></span>: improve reporting of misuse of $macro expansion in submit files <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4944\" onclick=\"get_ticket_and_populate_wrapper('4944'); return false;\" title=\"New $macro expansion functions for submit\">#4944</a></span> condor_submit now reports the EXCEPT thown in macro_expand and shows submit file and line number.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Mar-24 15:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3a7a11aab2fea2110d620ef6996be12f4c778f15\">[43699]</a></span>: error message for invalid format specifier for $INT() and $REAL(), <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4944\" onclick=\"get_ticket_and_populate_wrapper('4944'); return false;\" title=\"New $macro expansion functions for submit\">#4944</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Mar-19 11:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5a95cc006330e99bfa7eb0a7f82e2e7654e411d5\">[43624]</a></span>: new $macro expansion functions for use in submit/config files. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4944\" onclick=\"get_ticket_and_populate_wrapper('4944'); return false;\" title=\"New $macro expansion functions for submit\">#4944</a></span> this commit adds: $CHOICE(), $SUBSTR(), $INT(), $REAL(), $F[pnxdq](), $BASENAME(), $DIRNAME() and improves $RANDOM_CHOICE().  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Apr-16 20:26", "status": "resolved", "created": "2015-Mar-19 11:41", "fixed_version": "2015-Mar-19 11:41", "broken_version": "", "priority": "3", "subsystem": "Libs", "assigned_to": "johnkn", "derived_from": "#4899", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}