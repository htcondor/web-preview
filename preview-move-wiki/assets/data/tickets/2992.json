{"id": 2992, "title": "Ticket #2992: Have Condor manage OOM", "description": "<blockquote>\nWhen a job runs inside a cgroup, it basically has its own personal virtual memory subsystem.  Part of this includes its own OOM-killer.  As a part of cgroups, we can actually have the OOM-killer for inside the container be subservient to the procd.\n\n<p>I propose two changes:\n</p><ul>\n<li>If using the memory controller, the procd should manage the OOM-killer for the job.  In the event the kernel detects the OOM-killer needs to run, the procd should hard kill the entire job.\n</li><li>If the procd is managing the OOM-killer, it should disable itself from being considered from OOM itself.  This prevents some potentially nasty issues where it is unable to manage the jobs.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-May-14 13:18:56 by bbockelm:</em> <br/>\n\nPer the #distcomp conversation, it would be very useful if the starter could also know/understand the OOM notifications so it could tell the user why their job died.\n<hr/>\n<em>2013-Mar-05 10:58:27 by johnkn:</em> <br/>\n\nBulk change of target version from v070904 to v070905 using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/564/condor_oom.patch\">condor_oom.patch</a>\n17179 bytes added by bbockelm on 2012-May-14 14:16:32 UTC.\n<br/>\nProposed patch.<br/>\n</li><li><a href=\"../files/616/condor_oom_v2.patch\">condor_oom_v2.patch</a>\n10458 bytes added by bbockelm on 2012-Aug-06 02:51:56 UTC.\n<br/>\nRe-implementation of the patch, moving the logic to the starter per mattf's advice.\n\n<p>Now, when the job hits an OOM event and the memory limit is set, it should get a hold message along the following lines:\n\n</p><p>\"Error from slot1@rcf-bockelman.unl.edu: Job has gone over memory limit of 243 megabytes\"\n\n</p><p>This patch also implements gt403.<br/>\n</p></li><li><a href=\"../files/664/oom_design_doc.docx\">oom_design_doc.docx</a>\n126611 bytes added by bbockelm on 2012-Dec-23 17:44:48 UTC.\n<br/>\nDesign document for the patchset.  The patch itself is kept in the \"oom\" branch of git@github.com:bbockelm/htcondor.git .<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-11 15:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6fb98082a19d25a2d71714282059af2fc1530185\">[35383]</a></span>: Incorrect ticket number identified in version history. Was <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2944\" onclick=\"get_ticket_and_populate_wrapper('2944'); return false;\" title=\"condor_hold of a parallel job causes it to go away\">#2944</a></span>, and is now corrected to be <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2992\" onclick=\"get_ticket_and_populate_wrapper('2992'); return false;\" title=\"Have Condor manage OOM\">#2992</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-05 15:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/45b718ed0b1f0a5d96de99ab2868700638c2bd80\">[35343]</a></span>: Fix error condition in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2992\" onclick=\"get_ticket_and_populate_wrapper('2992'); return false;\" title=\"Have Condor manage OOM\">#2992</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-02 09:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b8d660eb990c8e2f5cc6f7ed613963be62540b0d\">[35302]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2992\" onclick=\"get_ticket_and_populate_wrapper('2992'); return false;\" title=\"Have Condor manage OOM\">#2992</a></span> in the version history  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Apr-02 09:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9495a0722d68f7d5ab5f0fca47d478ae283382f6\">[35301]</a></span>: Make HTCondor manage OOM killer, put job on hold instead <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2992\" onclick=\"get_ticket_and_populate_wrapper('2992'); return false;\" title=\"Have Condor manage OOM\">#2992</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Apr-11 15:07", "status": "resolved", "created": "2012-May-14 09:14", "fixed_version": "2012-May-14 09:14", "broken_version": "v070900", "priority": "1", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bbockelm@cse.unl.edu, tstclair@redhat.com", "due_date": ""}