{"id": 2455, "title": "Ticket #2455: CREAM leases set in the past", "description": "<blockquote>\nRod Walker reports instances where the gridmanager calculates a job lease for CREAM jobs that's in the past. The CREAM server rejects this lease expiration time and job submissions fail.\n\n<p><span class=\"subsection\"></span></p><h3>Milestones </h3>\n<ul>\n<li>Diagnose when this behavior occurs</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2011-Oct-24 13:55:41 by jfrey:</em> <br/>\n\nWe need more information to debug this further. I've been unable to reproduce this problem and it hasn't reoccurred on Rod Walker's machines. I'm deferring this ticket until we have more information.\n\n<p></p><hr/>\n<em>2011-Dec-01 15:30:01 by jfrey:</em> <br/>\n\nI now understand why this bug occurs. When a lease update attempt fails, the gridmanager sets LastJobLeaseRenewalFailed=True in the job ad. On subsequent update attempts, the expiration time from the first failed attempted is used until there's a successful update, even if that expiration time elapses. When a lease is shared across multiple jobs, this poisons all of the jobs, as the earliest expiration time is used.\n\n<p>The lease management code in the gridmanager needs to be overhauled. As a short-term fix, we can ignore <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LastJobLeaseRenewalFailed\" title=\"Last Job Lease Renewal Failed\">LastJobLeaseRenewalFailed</a></span> and always base the new lease expiration time on the current time.\n\n</p><p></p><hr/>\n<em>2011-Dec-05 14:00:38 by jfrey:</em> <br/>\n\nI've pushed a patch to V7_6-branch and posted a pre-release binary for Rod Walker, Xin Zhao and Igor Sfiligoi to try: <a class=\"external\" href=\"ftp://ftp.cs.wisc.edu/condor/temporary/forrod/2011-12-01/condor_gridmanager\">ftp://ftp.cs.wisc.edu/condor/temporary/forrod/2011-12-01/condor_gridmanager</a>\n\n<p></p><hr/>\n<em>2012-Jan-06 14:32:40 by jfrey:</em> <br/>\n\nRod Walker reports that lease problems have not reoccurred since installing the patched binary.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jan-06 14:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8ce41fb668d811b85eb52b4dff282f3ef35eac41\">[29018]</a></span>: Add CREAM lease fixes to version history. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2351\" onclick=\"get_ticket_and_populate_wrapper('2351'); return false;\" title=\"Ensure CREAM lease exists before submitting job in gridmanager\">#2351</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2455\" onclick=\"get_ticket_and_populate_wrapper('2455'); return false;\" title=\"CREAM leases set in the past\">#2455</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-01 15:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/93fd684344af7cb8128e07de65ab874c5ec513c2\">[28532]</a></span>: Disable use of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LastJobLeaseRenewalFailed\" title=\"Last Job Lease Renewal Failed\">LastJobLeaseRenewalFailed</a></span> in CalculateJobLease(). <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2455\" onclick=\"get_ticket_and_populate_wrapper('2455'); return false;\" title=\"CREAM leases set in the past\">#2455</a></span> When a job lease update fails, this attribute causes subsequent update attempts to use the same expiration time, even if that time has since elapsed. For cream grid jobs, this causes all jobs going to a given resource to fail, as\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Jan-06 14:32", "status": "resolved", "created": "2011-Sep-12 13:23", "fixed_version": "2011-Sep-12 13:23", "broken_version": "v070600", "priority": "2", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "atlas", "visibility": "public", "notify": "", "due_date": "20110916"}