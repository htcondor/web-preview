{"id": 6695, "title": "Ticket #6695: condor_transfer_data writes user log to wrong directory", "description": "<blockquote>\nWhen a job with a user log is submitted with the -spool option, the user log is written in the spool directory. When condor_transfer_data is called, the user log is transferred along with the job's output files back to the client. The user log always written in the job's initialdir, even if another directory is specified in the submit file (and resulting job ad). This is wrong and needs to be fixed.\n\n<p>The proper behavior can be obtained by adding a file transfer remap, like so:\n</p><div class=\"verbatim\">\n<pre>transfer_output_remaps = \"job.log=/data/me/job.log\"\n</pre></div>\n\n\n<p>A bugfix could do that same thing. We already add remaps for stdout and stderr when spooling.</p></blockquote>", "remarks": "<blockquote>\n<em>2018-Jun-07 16:33:53 by coatsworth:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p></p><ul>\n<li>You don't error check if <code>Ad-&gt;LookupString(ATTR_JOB_IWD, full_name)</code> sets values correctly. Is it safe to assume at this point in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> dance that if this isn't set, something would have already blown up? If not then add a check here.\n</li><li>I feel like using the same string object (remap_fname) for different <code>Ad-&gt;LookupString()</code> requests is confusing, would rather see a different object for IWD lookup.\n</li></ul>\n\n<p></p><hr/>\n<em>2018-Jun-14 16:21:24 by jfrey:</em> <br/>\n\nFileTransfer::SimpleInit() will fail if ATTR_JOB_IWD is missing from the job ad and assumes it will be an absolute path. Thus I think the assumption in InitDownloadFilenameRemaps() is fine.\n\n<p>I'll add a new string variable for the user log filename.\n\n</p><p></p><hr/>\n<em>2018-Jul-30 12:22:00 by coatsworth:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Looks good to me.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jun-14 16:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55066\">[55066]</a></span>: Add new local variable for second ad attribute lookup. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6695\" onclick=\"get_ticket_and_populate_wrapper('6695'); return false;\" title=\"condor_transfer_data writes user log to wrong directory\">#6695</a></span> Recommended in code review.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jun-05 16:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55012\">[55012]</a></span>: Add missing std:: prefix to string declarations. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6695\" onclick=\"get_ticket_and_populate_wrapper('6695'); return false;\" title=\"condor_transfer_data writes user log to wrong directory\">#6695</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jun-05 14:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55010\">[55010]</a></span>: Docs for condor_transfer_data user log in wrong directory bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6695\" onclick=\"get_ticket_and_populate_wrapper('6695'); return false;\" title=\"condor_transfer_data writes user log to wrong directory\">#6695</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jun-05 14:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55009\">[55009]</a></span>: condor_transfer_data writes user log to wrong directory. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6695\" onclick=\"get_ticket_and_populate_wrapper('6695'); return false;\" title=\"condor_transfer_data writes user log to wrong directory\">#6695</a></span> When condor_transfer_data fetches a job's files, the schedd sends just the basename for the user log file. This results in the client always writing the file in the job's IWD, even if the original job ad said to write the file in another\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2018-Jul-30 12:22", "status": "resolved", "created": "2018-Jun-04 16:33", "fixed_version": "2018-Jun-04 16:33", "broken_version": "", "priority": "3", "subsystem": "FileTransfer", "assigned_to": "coatsworth", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "atlas", "visibility": "public", "notify": "", "due_date": ""}