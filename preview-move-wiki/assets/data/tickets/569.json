{"id": 569, "title": "Ticket #569: Expand Executable/Cmd in condor_starter, not condor_submit", "description": "<blockquote>\nAssuming a job is submitted from /home/adesmet...\n<table border=\"1\" cellspacing=\"0\">\n<tbody><tr>\n<td>\n<strong>Submit file</strong>         </td>\n<td>\n <strong>Job ad</strong> </td>\n</tr>\n\n<tr>\n<td>\nExecutable = /foo     </td>\n<td>\n Cmd = \"/foo\" </td>\n</tr>\n\n<tr>\n<td>\nExecutable = foo      </td>\n<td>\n Cmd = \"/home/adesmet/foo\" </td>\n</tr>\n\n<tr>\n<td>\nExecutable = $$(EXE)  </td>\n<td>\n Cmd = \"/home/adesmet/$$(EXE)\" </td>\n</tr>\n\n<tr>\n<td>\nExecutable = /$$(EXE) </td>\n<td>\n Cmd = \"/$$(EXE)\" </td>\n</tr>\n\n</tbody></table>\n<p>This makes sense if instead of $$(EXE) we say something like\n\n</p><p></p><pre>  Executable = $$(OpSys)/$$(Arch)/myjob.exe\n</pre>\n\n<p>which turns into\n\n</p><p></p><pre>  Cmd = \"/home/adesmet/$$(OpSys)/$$(Arch)/myjob.exe\"\n</pre>\n\n<p>In which case the path is relative to our submit point.  However, if you're using the machine attribute to find the absolute path to a binary, it's surprising:\n\n</p><p></p><pre>  Executable = $$(PATH_TO_MATLAB)\n</pre>\n\n<p>turning into\n\n</p><p></p><pre>  Cmd = \"/home/adesmet/$$(PATH_TO_MATLAB)\"\n</pre>\n\n<p>Since PATH_TO_MATLAB will be things like \"/opt/matlab/bin/matlab\", prepending the submit point would be very wrong, generating silliness like \"/home/adesmet/opt/matlab/bin/matlab\".\n\n</p><p><a class=\"external\" href=\"http://www.cs.wisc.edu/condor/manual/v7.2/condor_submit.html#67280\">The manual says,</a> \"If no path or a relative path is used, then the executable file is presumed to be relative to the current working directory of the user as the condor_submit command is issued.\"  While the current behavior arguably conforms, it seems reasonable that a user would expect the relative path to be checked after $$ expansion.  The current situation is surprising.\n\n</p><p>This is all a side effect of the absolute-or-relative resolution happening at condor_submit time.\n\n</p><p>Proposal 1: delay the absolute-or-relative resolution until the last possible moment, just before the condor_startd/starter needs it.  At this point $$WHATEVER is known and can be expanded, and the resulting expanded Cmd tested for absoluteness. If it's a relative path, prepend Iwd (already in the job ad) to it.\n\n</p><p>Complications: not all paths go via the startd/starter.  The grid and schedule universes are the most obvious examples.  They would either need to be taught to handle Iwd themselves, or condor_submit would need to conditionally do absolute-or-relative resolution.\n\n</p><p>Proposal 2: If Executable contains \"$$\", defer expansion until \"later\". Pretty much all of the work in Proposal 1 still needs to be done, but for the default case where there is no $$ in the submit file nothing changes nor needs to change.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Oct-02 08:38:01 by matt:</em> <br/>\n\nFor (1) the job_router should be considered, e.g. jobs that aren't submitted to the grid uni but end up in it. (2) sounds fairly reasonable. Maybe (1) is ok and it can be stated that this feature only works when Condor is the entire pipe from user to exec node.\n<hr/>\n<em>2010-Oct-20 15:59:08 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.\n<hr/>\n<em>2011-Jan-27 14:21:33 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 14:49:30 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "", "type": "enhance", "last_change": "2011-Feb-02 06:13", "status": "new", "created": "2009-Jun-16 16:20", "fixed_version": "2009-Jun-16 16:20", "broken_version": "", "priority": "2", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "adesmet", "rust": "a19394", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu", "due_date": ""}