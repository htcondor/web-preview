{"id": 429, "title": "Ticket #429: Grid monitor improvements for BNL ATLAS", "description": "<blockquote>\nThe BNL ATLAS group has been encountering problems with the grid monitor, particularly when failures are encountered. Our investigation has revealed a number of improvements that can be made to the grid monitor which would benefit both them and other users.\n\n<p>The proposed changes are summarized here. Many of them can be made independently of each other. As changes are made, test binaries can be made available for BNL to try. As changes are tested and more debugging of failures collected, this list may change.\n\n</p><p></p><ul>\n<li>Grid monitor retry interval made configurable. <strong>DONE</strong>\n</li><li>Gridmanager receives callbacks on grid monitor job status from jobmanager. <strong>DONE</strong>\n</li><li>On startup, grid monitor reads last status file of previous grid monitor and caches completed jobs. <strong>DONE</strong>\n</li><li>Grid monitor lives longer, lifetime configurable?\n</li><li>Grid monitor clears cache of completed jobs which no longer have state files. (important if grid monitor lives longer or reads older status file) <strong>DONE</strong>\n</li><li>Don't give up on grid monitor job after 5 minutes. <strong>DONE</strong>\n</li><li>Cancel grid monitor job when gridmanager gives up on it. <strong>DONE</strong>\n</li><li>Don't leave jobmanagers alive when grid monitor is down.\n</li><li>Better globus-url-copy error handling\n<ul>\n<li>Retry failed g-u-c with altered X509_CERT_DIR only on first attempt. <strong>DONE</strong>\n</li><li>Retry all all failures, not just timeout. <strong>DONE</strong>\n</li><li>Make timeout shorter.\n</li><li>Log output of g-u-c.\n</li><li>Kill hanging g-u-c processes. <strong>DONE</strong>\n</li></ul>\n</li><li>Grid monitor outer script sends heartbeat more reliably. Eliminate blocking calls that may delay it significantly. <strong>DONE</strong>\n</li><li>Improve retention of grid monitor log by gridmanager.\n</li><li>Backup retrieval of grid monitor log after job completion/failure?\n</li><li>The gridmanager classad should include grid monitor statistics, last time we heard from the gridmonitor (is it running?) <strong>and</strong> the last time it successfully read job information from the remote scheduler (is it successfully getting job status info?)</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<hr/>\n<em>2010-Oct-20 15:59:08 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.\n<hr/>\n<em>2011-Jan-27 14:21:33 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 14:49:30 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-May-28 16:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=14788\">[14788]</a></span>: Improve timeout handling for grid monitor GRID_MONITOR_HEARTBEAT_TIMEOUT: Only applies to grid monitors from which at least one heartbeat has already been received. If this timeout is triggered, a new job submission is attempted. GRID_MONITOR_RETRY_DURATION: Applies to time before first heartbeat is\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-May-28 15:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=14787\">[14787]</a></span>: Receive and log callbacks of grid monitor job status (gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=429\" onclick=\"get_ticket_and_populate_wrapper('429'); return false;\" title=\"Grid monitor improvements for BNL ATLAS\">#429</a></span>)  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Apr-30 18:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=14615\">[14615]</a></span>: Improve how the grid monitor invokes globus-url-copy and inner script * Continue to send OK messages while globus-url-copy is running. * Kill globus-url-copy when timeout occurs. * Guarantee we have the inner script's pid stored before it can be reaped.\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Apr-30 15:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=14614\">[14614]</a></span>: In grid monitor, retry all g-u-c failures. gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=429\" onclick=\"get_ticket_and_populate_wrapper('429'); return false;\" title=\"Grid monitor improvements for BNL ATLAS\">#429</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Apr-29 14:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=14595\">[14595]</a></span>: Cached completed jobs in grid monitor between incarnations. When a grid monitor starts up, it will attempt to seed its cache of completed jobs by reading the last job status file written by its predecessor.\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Apr-29 11:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=14585\">[14585]</a></span>: Add new config knob GRID_MONITOR_DISABLE_TIME. This knob controls how long the gridmanager waits after a grid monitor failure before trying a new grid monitor job submission. The units are seconds and the default is one hour. gittrac <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=429\" onclick=\"get_ticket_and_populate_wrapper('429'); return false;\" title=\"Grid monitor improvements for BNL ATLAS\">#429</a></span>  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Feb-01 14:50", "status": "defer", "created": "2009-Apr-28 16:25", "fixed_version": "2009-Apr-28 16:25", "broken_version": "v070300", "priority": "3", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "atlas", "visibility": "public", "notify": "", "due_date": ""}