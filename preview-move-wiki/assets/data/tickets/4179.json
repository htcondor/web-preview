{"id": 4179, "title": "Ticket #4179: IPv4/IPv6 mixed-mode collector end-to-end test", "description": "<blockquote>\nMiron requested a test showing that a mixed-mode IPv4/IPv6 collector can receive ads and respond to queries from condor_advertise and condor_status running on an IPv4 host, an IPv6 host, and a mixed-mode host.\n\n<p>The test has been run, and it works.  A build from the master-ipv6-mixed-mode branch was used.  A <code>condor_collector</code> was set up on a host supporting both protocols.  Ads were successfully advertised using <code>condor_advertise</code> from the collector host (both IPv4 and IPv6), an IPv6-only host, an IPv4-only host, and a mixed mode host (using both IPv4 and IPv6).  Ads were successfully retrieved using <code>condor_status</code> from the same set of hosts using the same protocols.\n\n</p><p>Conclusion: the condor_collector can successfully serve clients over IPv4 and IPv6.\n\n</p><p>The full report follow.\n\n</p><p></p><hr/>\nCommands are sorted by time.  The command prompt shows which host each command was run on.\n\n<p></p><ul>\n<li>debian-00 has IPv4 and IPv6 connectivity. It is the collector in these tests\n</li><li>debian-01 only has IPv6 connectivity.\n</li><li>debian-02 only has IPv4 connectivity.\n</li><li>debian-03 has IPv4 and IPv6 connectivity.\n</li></ul>\n\n<p><span class=\"section\"></span></p><h2>Setup </h2>\n\n<p>For the sake of simplicity, the output from \"<code>./condor_install --make-personal-condor</code>\" has been omitted.\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">debian-00$ tar xzf condor-8.1.3-219620-x86_64_Debian7-unstripped.tar.gz\ndebian-00$ cd condor-8.1.3-219620-x86_64_Debian7-unstripped/\ndebian-00$ ./condor_install --make-personal-condor\ndebian-00$ source condor.sh\ndebian-00$ ROOT=`pwd`\ndebian-00$ cat  &gt;&gt; etc/condor_config &lt;&lt;END\n&gt; # Turn on IPv6 support. (IPv4 support defaults to on.)\n&gt; ENABLE_IPV6 = TRUE\n&gt;\n&gt; # IPv6 still doesn't work with DNS. Turn it off.\n&gt; NO_DNS      = TRUE\n&gt; DEFAULT_DOMAIN_NAME=example.com\n&gt;\n&gt; # LOCAL_DIR defaults to using HOSTNAME, which doesn't work\n&gt; # with NO_DNS.\n&gt; LOCAL_DIR   = $ROOT/local\n&gt; LOCAL_CONFIG_FILE =\n&gt;\n&gt; # Simple security.\n&gt; ALLOW_WRITE_COLLECTOR = *\n&gt; ALLOW_READ_COLLECTOR = *\n&gt; END\ndebian-00$ mv local.`hostname` local\ndebian-00$ source condor.sh\ndebian-00$ condor_collector -f -p 9618\n</pre></div>\n\n\n<p>At this point this debian-00 session is busy running the collector.  A new debian-00 session is started for further interactive testing\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">debian-00$ cd condor-8.1.3-219620-x86_64_Debian7-unstripped/\ndebian-00$ source condor.sh\ndebian-00$ cat &gt; condor_config.ipv4  &lt;&lt;END\n&gt; ENABLE_IPV4=TRUE\n&gt; ENABLE_IPV6=FALSE\n&gt; NO_DNS=TRUE\n&gt; DEFAULT_DOMAIN_NAME=example.com\n&gt; END\ndebian-00$ cat &gt; condor_config.ipv6  &lt;&lt;END\n&gt; ENABLE_IPV4=FALSE\n&gt; ENABLE_IPV6=TRUE\n&gt; NO_DNS=TRUE\n&gt; DEFAULT_DOMAIN_NAME=example.com\n&gt; END\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-01$ tar xzf condor-8.1.3-219620-x86_64_Debian7-unstripped.tar.gz\ndebian-01$ cd condor-8.1.3-219620-x86_64_Debian7-unstripped/\ndebian-01$ ./condor_install --make-personal-condor\ndebian-01$ source condor.sh\ndebian-01$ cat &gt; condor_config.ipv6  &lt;&lt;END\n&gt; ENABLE_IPV4=FALSE\n&gt; ENABLE_IPV6=TRUE\n&gt; NO_DNS=TRUE\n&gt; DEFAULT_DOMAIN_NAME=example.com\n&gt; END\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-02$ tar xzf condor-8.1.3-219620-x86_64_Debian7-unstripped.tar.gz\ndebian-02$ cd condor-8.1.3-219620-x86_64_Debian7-unstripped/\ndebian-02$ ./condor_install --make-personal-condor\ndebian-02$ source condor.sh\ndebian-02$ cat &gt; condor_config.ipv4  &lt;&lt;END\n&gt; ENABLE_IPV4=TRUE\n&gt; ENABLE_IPV6=FALSE\n&gt; NO_DNS=TRUE\n&gt; DEFAULT_DOMAIN_NAME=example.com\n&gt; END\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-03$ tar xzf condor-8.1.3-219620-x86_64_Debian7-unstripped.tar.gz\ndebian-03$ cd condor-8.1.3-219620-x86_64_Debian7-unstripped/\ndebian-03$ ./condor_install --make-personal-condor\ndebian-03$ source condor.sh\ndebian-03$ cat &gt; condor_config.ipv4  &lt;&lt;END\n&gt; ENABLE_IPV4=TRUE\n&gt; ENABLE_IPV6=FALSE\n&gt; NO_DNS=TRUE\n&gt; DEFAULT_DOMAIN_NAME=example.com\n&gt; END\ndebian-03$ cat &gt; condor_config.ipv6  &lt;&lt;END\n&gt; ENABLE_IPV4=FALSE\n&gt; ENABLE_IPV6=TRUE\n&gt; NO_DNS=TRUE\n&gt; DEFAULT_DOMAIN_NAME=example.com\n&gt; END\n</pre></div>\n\n\n<p><span class=\"section\"></span></p><h2>Submitting ads</h2>\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-00$ CONDOR_CONFIG=condor_config.ipv4 condor_advertise  -pool 192-168-122-105.example.com UPDATE_STARTD_AD &lt;&lt;END\n&gt; _CONDOR_ENABLE_IPV6=FALSE condor_advertise  -pool 192-168-122-105.example.com UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"1 test\"\n&gt; Name = \"IPv4 localhost\"\n&gt; END\nSent 1 of 1 ad to 192-168-122-105.example.com.\ndebian-00$ CONDOR_CONFIG=condor_config.ipv6 condor_advertise  -pool fc00--5054-ff-fef9-a254.example.com UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"2 test\"\n&gt; Name = \"IPv6 localhost\"\n&gt; END\nSent 1 of 1 ad to fc00--5054-ff-fef9-a254.example.com.\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-01$ CONDOR_CONFIG=condor_config.ipv6 condor_advertise -pool fc00--5054-ff-fef9-a254.example.com UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"3 test\"\n&gt; Name = \"IPv6 remote\"\n&gt; END\nSent 1 of 1 ad to fc00--5054-ff-fef9-a254.example.com.\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-02$ CONDOR_CONFIG=condor_config.ipv4 condor_advertise -pool 192-168-122-105.example.com UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"4 test\"\n&gt; Name = \"IPv4 remote\"\n&gt; END\nSent 1 of 1 ad to 192-168-122-105.example.com.\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-03$ CONDOR_CONFIG=condor_config.ipv4 condor_advertise -pool 192-168-122-105.example.com UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"5 test\"\n&gt; Name = \"IPv4(6) remote\"\n&gt; END\nSent 1 of 1 ad to 192-168-122-105.example.com.\ndebian-03$ CONDOR_CONFIG=condor_config.ipv6 condor_advertise -pool fc00--5054-ff-fef9-a254.example.com UPDATE_STARTD_AD &lt;&lt;END\n&gt; MyType = \"Machine\"\n&gt; Machine = \"6 test\"\n&gt; Name = \"IPv6(4) remote\"\n&gt; END\nSent 1 of 1 ad to fc00--5054-ff-fef9-a254.example.com.\n</pre></div>\n\n\n<p><span class=\"section\"></span></p><h2>Query ads</h2>\n\n<p><code>condor_status</code> reports \"(Omitted 6 malformed ads in computed attribute totals)\".  This is expected and harmless; the ads passed to <code>condor_advertise</code> were incomplete for the sake of brevity.\n\n</p><p>Each call should (and does) return 6 ads for:\n</p><ul>\n<li>IPv4 localhost\n</li><li>IPv6 localhost\n</li><li>IPv6 remote\n</li><li>IPv4 remote\n</li><li>IPv4(6) remote\n</li><li>IPv6(4) remote\n</li></ul>\n\n<p>If some of the ads had been missing, it would indicate that some of the calls to <code>condor_advertise</code> had not worked correctly.  If any other error message was returned, it would indicate that calls to <code>condor_status</code> were not working correctly.  All calls worked as expected.\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">debian-00$ CONDOR_CONFIG=condor_config.ipv4 condor_status -pool 192-168-122-105.example.com\nName               OpSys      Arch   State     Activity LoadAv Mem   ActvtyTime\n\nIPv4 localhost     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6 localhost     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6 remote        undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv4 remote        undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv4(6) remote     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6(4) remote     undefined  undefi undefined undefine [????] ?   [Unknown]\n                     Total Owner Claimed Unclaimed Matched Preempting Backfill\n\n\n               Total     0     0       0         0       0          0        0\n\n                    (Omitted 6 malformed ads in computed attribute totals)\n\ndebian-00$ CONDOR_CONFIG=condor_config.ipv6 condor_status -pool fc00--5054-ff-fef9-a254.example.com\nName               OpSys      Arch   State     Activity LoadAv Mem   ActvtyTime\n\nIPv4 localhost     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6 localhost     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6 remote        undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv4 remote        undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv4(6) remote     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6(4) remote     undefined  undefi undefined undefine [????] ?   [Unknown]\n                     Total Owner Claimed Unclaimed Matched Preempting Backfill\n\n\n               Total     0     0       0         0       0          0        0\n\n                    (Omitted 6 malformed ads in computed attribute totals)\n\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-01$ CONDOR_CONFIG=condor_config.ipv6 condor_status -pool fc00--5054-ff-fef9-a254.example.com\nName               OpSys      Arch   State     Activity LoadAv Mem   ActvtyTime\n\nIPv4 localhost     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6 localhost     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6 remote        undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv4 remote        undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv4(6) remote     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6(4) remote     undefined  undefi undefined undefine [????] ?   [Unknown]\n                     Total Owner Claimed Unclaimed Matched Preempting Backfill\n\n\n               Total     0     0       0         0       0          0        0\n\n                    (Omitted 6 malformed ads in computed attribute totals)\n\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-02$ CONDOR_CONFIG=condor_config.ipv4 condor_status -pool 192-168-122-105.example.com\nName               OpSys      Arch   State     Activity LoadAv Mem   ActvtyTime\n\nIPv4 localhost     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6 localhost     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6 remote        undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv4 remote        undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv4(6) remote     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6(4) remote     undefined  undefi undefined undefine [????] ?   [Unknown]\n                     Total Owner Claimed Unclaimed Matched Preempting Backfill\n\n\n               Total     0     0       0         0       0          0        0\n\n                    (Omitted 6 malformed ads in computed attribute totals)\n\n</pre></div>\n\n\n<p></p><div class=\"code\">\n<pre class=\"code\">debian-03$ CONDOR_CONFIG=condor_config.ipv4 condor_status -pool 192-168-122-105.example.com\nName               OpSys      Arch   State     Activity LoadAv Mem   ActvtyTime\n\nIPv4 localhost     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6 localhost     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6 remote        undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv4 remote        undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv4(6) remote     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6(4) remote     undefined  undefi undefined undefine [????] ?   [Unknown]\n                     Total Owner Claimed Unclaimed Matched Preempting Backfill\n\n\n               Total     0     0       0         0       0          0        0\n\n                    (Omitted 6 malformed ads in computed attribute totals)\n\ndebian-03$ CONDOR_CONFIG=condor_config.ipv6 condor_status -pool fc00--5054-ff-fef9-a254.example.com\nName               OpSys      Arch   State     Activity LoadAv Mem   ActvtyTime\n\nIPv4 localhost     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6 localhost     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6 remote        undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv4 remote        undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv4(6) remote     undefined  undefi undefined undefine [????] ?   [Unknown]\nIPv6(4) remote     undefined  undefi undefined undefine [????] ?   [Unknown]\n                     Total Owner Claimed Unclaimed Matched Preempting Backfill\n\n\n               Total     0     0       0         0       0          0        0\n\n                    (Omitted 6 malformed ads in computed attribute totals)\n\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "todo", "last_change": "2014-Jan-24 11:57", "status": "resolved", "created": "2014-Jan-24 11:24", "fixed_version": "2014-Jan-24 11:24", "broken_version": "", "priority": "2", "subsystem": "", "assigned_to": "adesmet", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}