{"id": 3772, "title": "Ticket #3772: Nested ads can't be printed in old ClassAd syntax", "description": "<blockquote>\nNested <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> aren't printed properly when unparsed in the old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> syntax.\nA nested ad can be represented in the old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> syntax like so:\n<div class=\"code\">\n<pre class=\"code\">B = [ Y = true; Z = \"Foo\"; X = 3 ]\n</pre></div>\n\n\n<p>However, when this gets parsed and unparsed in the old syntax, it ends up looking like this:\n</p><div class=\"code\">\n<pre class=\"code\">B = Y = true\nZ = \"Foo\"\nX = 3\n</pre></div>\n\n\n<p>Attributes Z and X end up in the top-level ad and attribute B won't parse correctly, since \"Y = true\" isn't a valid attribute value.\n\n</p><p>The unparser should be modified so that when in old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> mode, any nested ads are printed using the new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> syntax. That is, enclosing the ad in square brackets and using semicolons to separate attributes.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Jul-16 15:37:17 by jfrey:</em> <br/>\n\nA proper fix for this bug requires adding a boolean to the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAdUnParser\" title=\"Class Ad Un Parser\">ClassAdUnParser</a></span> class, so that it can track whether it's in a nested ad during unparsing. Normally, this would change the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> API in a way requiring a bump in the SO version, which we shouldn't do in a stable series. But in this case, we can add the bool without changing the size of the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAdUnParser\" title=\"Class Ad Un Parser\">ClassAdUnParser</a></span> object or the layout of existing data members. The class currently contains 3 one-byte members. Memory alignment results in at least one more byte of unused space. It should be safe to fix this bug in the 8.0 stable series without changing the so library version.\n\n<p></p><hr/>\n<em>2014-Mar-04 19:55:02 by bbockelm:</em> <br/>\n\nHi,\n\n<p>Can this be backported to stable series?  This one broke HTCondor-CE, which uses sub-classads :(\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2014-Apr-17 14:40:41 by jfrey:</em> <br/>\n\nThe fix has been back-ported to 8.0.7.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/784/nested_ad.patch\">nested_ad.patch</a>\n6665 bytes added by jfrey on 2013-Jul-16 20:39:44 UTC.\n<br/>\nPatch for unparsing nested ads in old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> format.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-05 13:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ff3ab58c93f1b882d33d86ac47efd3b84e18c22c\">[39527]</a></span>: Docs for proper printing of nest <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> in version 8.0.x. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3772\" onclick=\"get_ticket_and_populate_wrapper('3772'); return false;\" title=\"Nested ads can't be printed in old ClassAd syntax\">#3772</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-05 11:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e0d7f30822b4cd74296b5fcffc61cb2733687e1d\">[39526]</a></span>: Fix printing of nested <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> in Condor. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3772\" onclick=\"get_ticket_and_populate_wrapper('3772'); return false;\" title=\"Nested ads can't be printed in old ClassAd syntax\">#3772</a></span> Use new ClassAdUnParser::SetOldClassAd() method, which lets us print nested <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> properly in the old syntax.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-05 11:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/065e35ba993c7e3e576b9644dbdf343771e27f2d\">[39525]</a></span>: Fix printing of nested ads in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAdUnParser\" title=\"Class Ad Un Parser\">ClassAdUnParser</a></span> for old ad syntax. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3772\" onclick=\"get_ticket_and_populate_wrapper('3772'); return false;\" title=\"Nested ads can't be printed in old ClassAd syntax\">#3772</a></span> When unparsing an ad in old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> syntax, any nested ads should be delimited in new syntax (enclose in square brackets, seperate attributes with semicolon), though other aspects of the old syntax should be retained (string escaping,\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-09 10:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/17e7a6a549e3b862019ad7dc06d69d4af2ae4976\">[37142]</a></span>: minor edit of 8.1.1 version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3772\" onclick=\"get_ticket_and_populate_wrapper('3772'); return false;\" title=\"Nested ads can't be printed in old ClassAd syntax\">#3772</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-01 15:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/db613f60c44da824b230f3f43f2e89dc9ff23cea\">[37069]</a></span>: Version history for nested ad printing bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3772\" onclick=\"get_ticket_and_populate_wrapper('3772'); return false;\" title=\"Nested ads can't be printed in old ClassAd syntax\">#3772</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-01 15:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0222c71b4a7cf5946ab9d5caf5ecca0ca8c75539\">[37068]</a></span>: Fix printing of nested <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> in Condor. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3772\" onclick=\"get_ticket_and_populate_wrapper('3772'); return false;\" title=\"Nested ads can't be printed in old ClassAd syntax\">#3772</a></span> Use new ClassAdUnParser::SetOldClassAd() method, which lets us print nested <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> properly in the old syntax.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Aug-01 15:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/60700f5f9a3ddc8e841077b681558f8ca71694b7\">[37067]</a></span>: Fix printing of nested ads in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAdUnParser\" title=\"Class Ad Un Parser\">ClassAdUnParser</a></span> for old ad syntax. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3772\" onclick=\"get_ticket_and_populate_wrapper('3772'); return false;\" title=\"Nested ads can't be printed in old ClassAd syntax\">#3772</a></span> When unparsing an ad in old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> syntax, any nested ads should be delimited in new syntax (enclose in square brackets, seperate attributes with semicolon), though other aspects of the old syntax should be retained (string escaping,\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Apr-17 14:40", "status": "resolved", "created": "2013-Jul-11 18:14", "fixed_version": "2013-Jul-11 18:14", "broken_version": "v070800", "priority": "4", "subsystem": "ClassAd", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com", "due_date": ""}