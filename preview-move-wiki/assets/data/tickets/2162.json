{"id": 2162, "title": "Ticket #2162: Condor-C and file transfer plugins", "description": "<blockquote>\nI'm using Condor-C with file transfer plugins.  I'd like the file transfer plugin to be executed on the worker node.\n\n<p>However, it does not seem this is possible.  If you give the following input file:\n\n</p><p>+remote_TransferInput = \"srm://srm.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/dropfiles/condorc-test-hda.raw\"\n\n</p><p>it gets transformed into\n\n</p><p><span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TransferInput\" title=\"Transfer Input\">TransferInput</a></span> = \"srm://srm.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/dropfiles/condorc-test-hda.raw\"\n\n</p><p>on the remote schedd.  Then, Condor-C will spool to the remote schedd.  The spool process will transform the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TransferInput\" title=\"Transfer Input\">TransferInput</a></span> to:\n\n</p><p>SUBMIT_TransferInput = \"srm://srm.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/dropfiles/condorc-test-hda.raw\"\n<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=TransferInput\" title=\"Transfer Input\">TransferInput</a></span> = \"condorc-test-hda.raw\"\n\n</p><p>Hence, the file transfer plugin gets called on the remote schedd (a blocking operation, stopping the machinery of the schedd) and the file is transferred from remote schedd to remote worker node using condor file transfer.\n\n</p><p>My preferred way of fixing this is to have any URL get ignored when spooling and passed to the worker node.</p></blockquote>", "remarks": "<blockquote>\n<em>2011-May-16 21:34:07 by bbockelm:</em> <br/>\n\nActually, this affects more than Condor-C: the same thing happens on condor_submit with spooling.  Try the below submit file with \"condor_submit -spool\"; the URL plugin gets invoked by the schedd for the srm:// file and the other file is spooled, then the schedd does condor file transfer of both files to the worker node.\n\n<p>I'm pretty sure this is not the intended behavior, especially as it defeats one of the purposes of the URL plugins (scalability) if everything goes through the schedd.\n\n</p><p></p><div class=\"verbatim\">\n<pre>universe = vanilla\nexecutable = test.sh\noutput = test_local.out\nerror = test_local.err\nlog = test_local.log\n\nShouldTransferFiles = YES\nWhenToTransferOutput = ON_EXIT\n\ntransfer_input_files = condor-7.5.4-1.rhel5.x86_64.rpm, srm://srm.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/dropfiles/condorc-test-hda.raw\n\nqueue 1\n</pre></div>\n\n\n<p></p><hr/>\n<em>2011-May-18 16:09:59 by psilord:</em> <br/>\n\nOk, I reviewed the patch and it looks good. I've committed it into V7_6_1-branch, merged to V7_6-branch, and merged to master.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/344/fix_attributes.patch\">fix_attributes.patch</a>\n4445 bytes added by bbockelm on 2011-May-17 02:29:36 UTC.\n<br/>\nThe following patch fixes this issue, I believe.  Will deploy it tomorrow on one of our schedd's.<br/>\n</li><li><a href=\"../files/345/fix_attributes_v2.patch\">fix_attributes_v2.patch</a>\n4444 bytes added by bbockelm on 2011-May-17 15:47:02 UTC.\n<br/>\nThis patch corrects a logic error in the previous patch that was introduced during patch cleanup.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-May-18 16:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2c5d76bbcc877807327b13e605326d533f5b109a\">[21898]</a></span>: ===GT:Fixed=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2162\" onclick=\"get_ticket_and_populate_wrapper('2162'); return false;\" title=\"Condor-C and file transfer plugins\">#2162</a></span> This patch fixes a problem where when a client like condor_submit or the C-GHAP tries to spool files to the schedd, the file transfer object fires up the plugins and grabs all the URLS into the spool. While the actual behavior needs a little bit of debate, it is pretty sure that\u00a0[...]\n (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-May-03 09:18", "status": "resolved", "created": "2011-May-16 15:12", "fixed_version": "2011-May-16 15:12", "broken_version": "", "priority": "1", "subsystem": "Daemons", "assigned_to": "psilord", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "", "due_date": "20110518"}