{"id": 1028, "title": "Ticket #1028: CCB and DC_NOP not happy under Windows", "description": "<blockquote>\nIn Windows, when pidWatcherThread tries to wake up the main select, it tries to send a DC_NOP command to the daemon's command socket.  When the daemon has a CCB address, this causes the check for UDP-to-self to get the wrong answer, which causes the command to try to do security negotiation, which results in blocking until a timeout occurs.  This has been observed to make the schedd performance fall to pieces.\n\n<p>Several things should be fixed:\n\n</p><p></p><ul>\n<li>Register DC_NOP as ALLOW instead of READ and send it using the raw command protocol (never do security negotiation).  There is no point in security for this command because all it does it wake up select.  Anybody can wake up select, regardless of how we register this command.\n\n<p></p></li><li>Always use the daemon's private address when sending DC_NOP.\n\n<p></p></li><li>Fix the check for UDP-to-self so that it can correctly detect connections to the private and public addresses.  Since from now on we are forcing the use of the raw command protocol, this should check will not be important for DC_NOP, but it could be important for other things.\n\n<p></p></li><li>If the daemon does not have a UDP command port, send DC_NOP via TCP.  This still should not block since we are using the raw command protocol.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2009-Dec-14 12:29:10 by danb:</em> <br/>\n\nI pushed a fix for this to 7.4.1 branch.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Dec-14 12:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=25181\">[25181]</a></span>: Documented CCB windows fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1028\" onclick=\"get_ticket_and_populate_wrapper('1028'); return false;\" title=\"CCB and DC_NOP not happy under Windows\">#1028</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Dec-14 12:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=16657\">[16657]</a></span>: Fix for CCB in windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1028\" onclick=\"get_ticket_and_populate_wrapper('1028'); return false;\" title=\"CCB and DC_NOP not happy under Windows\">#1028</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Jan-29 12:53", "status": "resolved", "created": "2009-Dec-08 14:50", "fixed_version": "2009-Dec-08 14:50", "broken_version": "v070100", "priority": "4", "subsystem": "Daemons", "assigned_to": "danb", "derived_from": "", "creator": "danb", "rust": "a19969", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}