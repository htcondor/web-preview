{"id": 1292, "title": "Ticket #1292: Calling append_to_list(\"\") on a non-empty MyString still adds a comma", "description": "<blockquote>\nappend_to_list(\"\") still adds a comma to a non-empty <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyString\" title=\"My String\">MyString</a></span>\n<div class=\"code\">\n<pre class=\"code\">MyString a(\"ABC\");\na.append_to_list(\"\");\n</pre></div>\n\na is now \"ABC,\" instead of \"ABC\"\n\n<p>The unit test output:\n</p><div class=\"verbatim\">\n<pre>TEST:  Test append_to_list() on a non-empty MyString when passed an empty string\n.\nINPUT:\n    STRING:\nEXPECTED OUTPUT:\n    RETURN:  ABC\nACTUAL OUTPUT:\n    RETURN:  ABC,\nRESULT:  FAILURE, test failed at line 2946\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Mar-23 15:28:59 by adesmet:</em> <br/>\n\nI believe the current behavior is correct. I expect a series of calls like\n<div class=\"code\">\n<pre class=\"code\">MyString s = \"arg1\";\ns.append_to_list(\"\");\ns.append_to_list(\"arg3\");\n</pre></div>\n\nto yield a string of \"arg1,,arg3\".\n\n<p></p><hr/>\n<em>2010-Mar-23 15:34:09 by psilord:</em> <br/>\n\nIf this is true, then change the unit tests to test for that behavior and\ne.emit_comment(\"We looked at this semantic and expect the result of foo,,bar\");\nin the unit test, cause we can make arguments each way.\n\n<p></p><hr/>\n<em>2010-Mar-23 20:18:37 by psilord:</em> <br/>\n\nJust so you know, from my review of this work Josh did:\n\n<p></p><div class=\"verbatim\">\n<pre>append_to_list_string_non_empty_empty\nappend_to_list_mystring_non_empty_empty\n    Appending an empty string to a mystring in reality appends a comma to it?\n    I'd definitely mark that as a problem, and a probable bug.\n    Especially since append_to_list_mystring_empty_empty or\n    append_to_list_mystring_empty_non_empty didn't do the same\n    behavior with an empty string.\n</pre></div>\n\n\n<p>So, the behavior is inconsistent and you're initial intuition might be wrong.\n\n</p><p></p><hr/>\n<em>2010-Mar-25 15:47:39 by adesmet:</em> <br/>\n\nMyString::append_to_list now treats an argument of \"\" or NULL as a no-op.\n\n<p>The logic is that we might be appending another <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyString\" title=\"My String\">MyString</a></span> \"list\", and thus an empty string is an empty list.  An empty list doesn't need a comma, since it's empty.\n\n</p><p>Ultimately, this is ambiguous.  In the long run code should instead use something like <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StringList\" title=\"String List\">StringList</a></span> to manage the list, then join the list elements into a single string at the end.  Unfortunately <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StringList\" title=\"String List\">StringList</a></span> itself is flawed enough that we really need a new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=StringList\" title=\"String List\">StringList</a></span> (probably \"class StringList2 : public std::vector&lt;MyString&gt; {... }\").  But that's a project for another day.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-25 16:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5b9db85183758dac18d5a069e2a55d501a160a19\">[17702]</a></span>: Mean 0, not NULL <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1292\" onclick=\"get_ticket_and_populate_wrapper('1292'); return false;\" title='Calling append_to_list(\"\") on a non-empty MyString still adds a comma'>#1292</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1293\" onclick=\"get_ticket_and_populate_wrapper('1293'); return false;\" title=\"Calling append_to_list() with an empty MyString still adds a comma\">#1293</a></span>.  (By Alan De Smet )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-25 15:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/719e10c6c608c025edf6f4145409990d9b840974\">[17701]</a></span>: Note fixes. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1292\" onclick=\"get_ticket_and_populate_wrapper('1292'); return false;\" title='Calling append_to_list(\"\") on a non-empty MyString still adds a comma'>#1292</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1293\" onclick=\"get_ticket_and_populate_wrapper('1293'); return false;\" title=\"Calling append_to_list() with an empty MyString still adds a comma\">#1293</a></span>  (By Alan De Smet )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-25 15:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e6a51e56f52b2f5ebdfd6fb2befeef95aec8250e\">[17700]</a></span>: MyString::append_to_list(\"\") now treats the right hand side as a list, with \"\" meaning \"an empty list\". This is similar to how it treats the left hand side. More simply: s.append_to_list(\"\") is now a no-op, it used to append \",\". Added a big comment warning about these unusual edge-cases and the inability\u00a0[...]\n (By Alan De Smet )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-17 17:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/35da2efd0e3c5a5484b1f7a8a50e221f167291b2\">[17656]</a></span>: Added an emitted comment in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyString\" title=\"My String\">MyString</a></span> unit test to identify a ticket. <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=1239\" onclick=\"get_ticket_and_populate_wrapper('1239'); return false;\" title=\"Condor needs more condor_unit_tests\">#1239</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1292\" onclick=\"get_ticket_and_populate_wrapper('1292'); return false;\" title='Calling append_to_list(\"\") on a non-empty MyString still adds a comma'>#1292</a></span>  (By Josh Slauson )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Mar-25 15:47", "status": "resolved", "created": "2010-Mar-17 16:33", "fixed_version": "2010-Mar-17 16:33", "broken_version": "v070500", "priority": "3", "subsystem": "Libs", "assigned_to": "adesmet", "derived_from": "#1239", "creator": "slauson", "rust": "", "customer_group": "other", "visibility": "public", "notify": "jslauson@wisc.edu psilord@cs.wisc.edu adesmet@cs.wisc.edu", "due_date": ""}