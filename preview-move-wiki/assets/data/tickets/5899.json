{"id": 5899, "title": "Ticket #5899: Job router UPDATE_JOB_INFO hook output bugs", "description": "<blockquote>\nIf the Job Router's UPDATE_JOB_INFO hook prints out attributes to be applied to the routed job, they aren't always handled properly.\n\n<p>First, UpdateRoutedJobStatus() assumes that the routed job is visible in the mirror of the job queue log, which is not true for a newly-submitted job. It's very likely not to be there the first time the UPDATE_JOB_INFO hook is called.\nIn FinishCheckSubmittedJobStatus(), we handle this situation, with an upper limit on how long the job can absent from the job queue mirror set by MAX_JOB_MIRROR_UPDATE_LAG.\n\n</p><p>Second, UpdateRoutedJobStatus() attempts to modify the routed job ad in the queue of the source schedd. If routed jobs go to a separate schedd, this will fail.\n\n</p><p>Both of these situations lead to the routed job being aborted. The router can easily end up in a loop of routing the same job repeatedly.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Sep-19 11:25:57 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong>: looks good.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-13 15:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/45cd39671e0515278bf8a36fdeca7a223913467b\">[49192]</a></span>: Docs for job router UPDATE_JOB_INFO hook bug fixes. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5899\" onclick=\"get_ticket_and_populate_wrapper('5899'); return false;\" title=\"Job router UPDATE_JOB_INFO hook output bugs\">#5899</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-13 14:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/884526af51242f42260a6410c5d2e8a25b3e6c8c\">[49187]</a></span>: Delay when job router invokes JOB_UPDATE_INFO hook. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5899\" onclick=\"get_ticket_and_populate_wrapper('5899'); return false;\" title=\"Job router UPDATE_JOB_INFO hook output bugs\">#5899</a></span> Have the job router defer calling the JOB_UPDATE_INFO hook until it has seen the routed job in its job queue mirror. Until then, there's no useful information to report. Also, the dest_ad of the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RoutedJob\" title=\"Routed Job\">RoutedJob</a></span> doesn't have the ClusterId,ProcId of the\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-13 14:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1f8636f14cc5ccf87de75271aa246568a299916f\">[49186]</a></span>: Push job router JOB_UPDATE_INFO hook output to correct schedd. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5899\" onclick=\"get_ticket_and_populate_wrapper('5899'); return false;\" title=\"Job router UPDATE_JOB_INFO hook output bugs\">#5899</a></span> When the JOB_UPDATE_INFO hook outputs attributes to be set, the job router was contacting the schedd containing the source job to push the updates to the routed job. When routed jobs go to another schedd, it needs to contact that schedd\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2016-Sep-23 15:52", "status": "resolved", "created": "2016-Sep-13 10:58", "fixed_version": "2016-Sep-13 10:58", "broken_version": "v080400", "priority": "4", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "atlas", "visibility": "public", "notify": "", "due_date": ""}