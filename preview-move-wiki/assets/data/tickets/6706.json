{"id": 6706, "title": "Ticket #6706: cmd_drain_scavenging intermittent failures", "description": "<blockquote>\nInitial analysis indicates that that cmd_drain_scavenging is failing intermittently on Windows because we send WM_CLOSE when we would send SIGTERM on Linux, and perl doesn't (and can't?) convert that to SIGTERM internally, meaning that the job actually exits when requested, and HTCondor never transitions to preempting/killing, which is something the test is checking for.\n\n<p>TJ can provide a (tiny) 'sleepw.exe' binary that is a sleep command with a window, and have it ignore WM_CLOSE messages.  This should enable us to actually test MAX_VACATE_TIME after draining on Windows, but may require nontrivial rewrites of the test, whose perl script sleeps but can be interrupted via a file.</p></blockquote>", "remarks": "<blockquote>\n<em>2018-Aug-14 12:47:59 by tlmiller:</em> <br/>\n\nFirst commit on this ticket is to fix (work-around; see commit message) a global problem with the test.  Then we can get back to fixing the Windows-specific problem(s).\n\n<p></p><hr/>\n<em>2018-Sep-19 13:39:07 by tlmiller:</em> <br/>\n\nSplitting off a subticket because this won't be done for 8.7.10.\n\n<p></p><hr/>\n<em>2018-Sep-19 13:45:49 by tlmiller:</em> <br/>\n\nThis only changed the test suite, so no documentation is necessary.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6774\" onclick=\"get_ticket_and_populate_wrapper('6774'); return false;\" title=\"cmd_drain_scavenging intermittent failures on Windows\">#6774</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\ncmd_drain_scavenging intermittent failures on Windows</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Aug-14 12:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55285\">[55285]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6706\" onclick=\"get_ticket_and_populate_wrapper('6706'); return false;\" title=\"cmd_drain_scavenging intermittent failures\">#6706</a></span>) When we started respecting individual max job retirement times in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6697\" onclick=\"get_ticket_and_populate_wrapper('6697'); return false;\" title=\"coordinated retirement while draining breaks HOLD_IF_MEMORY_EXCEEDED\">#6697</a></span>, we broke an assumption about what constitutes a backfill job in this test. The real fix has been folded into <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=6739\" onclick=\"get_ticket_and_populate_wrapper('6739'); return false;\" title=\"Implement long-term fixes for policy-while-retiring problems\">#6739</a></span>.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2018-Sep-19 13:45", "status": "resolved", "created": "2018-Jun-27 16:50", "fixed_version": "2018-Jun-27 16:50", "broken_version": "", "priority": "3", "subsystem": "Tests", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, johnkn@cs.wisc.edu", "due_date": ""}