{"id": 7083, "title": "Ticket #7083: Job attribute CommittedTime can over-count job runtime", "description": "<blockquote>\nWhen a job completes, the shadow updates <code>CommittedTime</code> and <code>CommittedSlotTime</code> in the job ad to include the most recent interval of execution and pushes the changes to the schedd. This happens in the function <code>BaseShadow::terminateJob()</code>. If the shadow fails to connect to the schedd, it will retry later. The retry includes running <code>BaseShadow::terminateJob()</code> again, which will add more time to <code>CommittedTime</code> and <code>CommittedSlotTime</code>. This results in double- or triple-counting the job's most recent execution time.\n\n<p>We need to add a flag that ensures the updating of these attributes is only done once in <code>BaseShadow::terminateJob()</code>.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Jun-19 12:18:39 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong> changes look good.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-30 13:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57010\">[57010]</a></span>: Docs for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CommittedTime\" title=\"Committed Time\">CommittedTime</a></span> over-count bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7083\" onclick=\"get_ticket_and_populate_wrapper('7083'); return false;\" title=\"Job attribute CommittedTime can over-count job runtime\">#7083</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-30 13:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57009\">[57009]</a></span>: Job attribute <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CommittedTime\" title=\"Committed Time\">CommittedTime</a></span> can over-count job runtime. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7083\" onclick=\"get_ticket_and_populate_wrapper('7083'); return false;\" title=\"Job attribute CommittedTime can over-count job runtime\">#7083</a></span> Add a flag so that BaseShadow::terminateJob() updates <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CommittedTime\" title=\"Committed Time\">CommittedTime</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CommittedSlotTime\" title=\"Committed Slot Time\">CommittedSlotTime</a></span> only once on job termination. Previously, failure to talk to the schedd would result in multiple updates, over-counting the most recent execution interval.\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2019-Jun-19 12:19", "status": "resolved", "created": "2019-May-30 13:23", "fixed_version": "2019-May-30 13:23", "broken_version": "", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}