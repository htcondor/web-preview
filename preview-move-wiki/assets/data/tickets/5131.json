{"id": 5131, "title": "Ticket #5131: sort hosts/slots numerically in condor_status", "description": "<blockquote>\nThe default output of condor_status apparently sorts by OPSYS, ARCH, MACHINE, NAME.  If you have &gt;= 10 slots, you end up with a funny-looking sort:\n\n<p></p><div class=\"verbatim\">\n<pre>Name               OpSys      Arch   State     Activity LoadAv Mem   ActvtyTime\n\nslot10@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:16\nslot11@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:17\nslot12@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:18\nslot13@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:19\nslot14@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:20\nslot15@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:21\nslot16@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:14\nslot17@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:15\nslot18@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:16\nslot19@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:17\nslot1@itb-host-2.c LINUX      X86_64 Unclaimed Idle      0.000 2011  0+04:10:47\nslot20@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:18\nslot21@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:19\nslot22@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:20\nslot23@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:21\nslot24@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:14\nslot25@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:15\nslot26@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:16\nslot27@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:17\nslot28@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:18\nslot29@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:19\nslot2@itb-host-2.c LINUX      X86_64 Unclaimed Idle      0.040 2011  0+10:05:16\nslot30@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:20\nslot31@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:21\nslot32@itb-host-2. LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:14\nslot3@itb-host-2.c LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:17\nslot4@itb-host-2.c LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:18\nslot5@itb-host-2.c LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:19\nslot6@itb-host-2.c LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:20\nslot7@itb-host-2.c LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:21\nslot8@itb-host-2.c LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:14\nslot9@itb-host-2.c LINUX      X86_64 Unclaimed Idle      0.000 2011  0+10:05:15\n</pre></div>\n\n\n<p>The very-low-hanging fruit I'm eyeing up here is just to change the sorting for the default output of condor_status (not messing with aggregates or custom sorting), by changing the comparison for the MACHINE and NAME fields from the current strcmp(3) to strverscmp(3), where available.  (It's a gnu extension, so it has to be #ifdef'd.)  The result is the natural-looking sort of the slots (1,2,...,9,10,11,...).\n\n</p><p>I discussed this with Zach, who recommended just making it the new default rather than making an option for it.\n\n</p><p>Tim T gave the go-ahead to check the small change into master.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Jul-06 15:45:36 by edquist:</em> <br/>\n\nSo, TJ wanted to hold off on making this the default until we can do it everywhere (that is, on non-linux too), and asked that I make an option for it, and suggested the option name <code>-natural</code> with a min prefix of <code>-nat</code> ...\n\n<p>TJ was talking about implementing strverscmp in condor so that the natural sort output can be used in Windows, and, at that point maybe for other tool outputs.\n\n</p><p>Anyway, there's now an option for it, <code>-natural</code>, and the default is false.\n\n</p><p></p><hr/>\n<em>2015-Aug-26 09:18:38 by tim:</em> <br/>\n\nWe will make this work over all platforms for 8.4.0, default off. For 8.5.0, the default changes to on.\n\n<p></p><hr/>\n<em>2015-Aug-27 16:42:05 by edquist:</em> <br/>\n\nWith a go-ahead from TJ and TimT, I checked in a new <code>natural_cmp()</code> function in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/45b77767e418a2ced5bc124bc22a03f21e07db09\">[45738]</a></span> under <code>condor_utils</code>, in a new <code>V8_3_8-gt5131-natural_cmp</code> branch.  It's a drop in replacement for <code>strcmp(3)</code>, written from scratch based on the specifications laid out in the <code>strverscmp(3)</code> man page.  My tests show identical function results for various inputs, and nearly identical performance.\n\n<p>For <code>condor_status</code>, I took out the <code>GLIBC</code> ifdefs, since this doesn't use any gnu extensions, but I left the option default off.\n\n</p><p>TimT, you can merge this into whatever branches become relevant (8_3_8, 8_4, 8_5, master, ...).\n\n</p><p></p><hr/>\n<em>2015-Aug-31 15:56:38 by edquist:</em> <br/>\n\nMerged branch <code>V8_3_8-gt5131-natural_cmp</code> into <code>V8_4-branch</code> per TJ.  (Haven't merged into <code>master</code> yet -- but you should be able to whenever.)\n\n<p>The option in <code>condor_status</code> is still off by default.\n\n</p><p></p><hr/>\n<em>2015-Aug-31 16:23:52 by tim:</em> <br/>\n\n<strong>CODE REVIEW</strong>: This looks very good\n\n<p></p><hr/>\n<em>2015-Sep-25 11:42:10 by edquist:</em> <br/>\n\nI chatted with TJ about turning the <code>-natural</code> option on by default in 8.5.x; he suggested for now just switching the default to be on and supporting a <code>-nat[ural]:off</code> in case anybody really wants to disable it and get the old behavior.\n\n<p>I checked this into master in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2c3c2c0aabc00119b9410e1617f4b7ff99531c7c\">[45891]</a></span>.\n\n</p><p></p><hr/>\n<em>2015-Sep-25 11:48:19 by edquist:</em> <br/>\n\nAttaching sample output with -nat on by default.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"abandoned\" href=\"/tickets?ticket=5409\" onclick=\"get_ticket_and_populate_wrapper('5409'); return false;\" title=\"Document natural sorting option for condor_status\">#5409</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDocument natural sorting option for condor_status</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/902/8.5.1-output.txt\">8.5.1-output.txt</a>\n5820 bytes added by edquist on 2015-Sep-25 16:46:17 UTC.\n<br/>\nsample output for 8.5.1 with -nat on by default.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-26 17:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5bf5708a9a39b676326a184346625f303055c207\">[46116]</a></span>: Fix typo in manual for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5326\" onclick=\"get_ticket_and_populate_wrapper('5326'); return false;\" title=\"*_EXPRS should be uniformly replaced with *_ATTRS\">#5326</a></span>. Add version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5343\" onclick=\"get_ticket_and_populate_wrapper('5343'); return false;\" title=\"Add SELinux rules for NFS access\">#5343</a></span>. Update version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5131\" onclick=\"get_ticket_and_populate_wrapper('5131'); return false;\" title=\"sort hosts/slots numerically in condor_status\">#5131</a></span>. Set release date in manual. Update RPM build script for final release.  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-23 14:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/af9a27fe8f6ebccb7c4d2a74c9176927c52493c7\">[46088]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5131\" onclick=\"get_ticket_and_populate_wrapper('5131'); return false;\" title=\"sort hosts/slots numerically in condor_status\">#5131</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5261\" onclick=\"get_ticket_and_populate_wrapper('5261'); return false;\" title=\"condor_mips reports different value on CHTC\">#5261</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5286\" onclick=\"get_ticket_and_populate_wrapper('5286'); return false;\" title=\"condor_install for personal condor should set NETWORK_INTERFACE\">#5286</a></span> <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5273\" onclick=\"get_ticket_and_populate_wrapper('5273'); return false;\" title=\"condor_submit queue foreach with a slice will not parse 3 digits\">#5273</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Sep-25 11:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2c3c2c0aabc00119b9410e1617f4b7ff99531c7c\">[45891]</a></span>: turn on -natural sort for condor_status by default <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5131\" onclick=\"get_ticket_and_populate_wrapper('5131'); return false;\" title=\"sort hosts/slots numerically in condor_status\">#5131</a></span> In 8.5.x the natural sort order is on by default, for the default output. To disable this and get the old behavior, ascii sorting by (MACHINE, NAME), you can specify -nat[ural]:off  (By Carl Edquist )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-31 22:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/eeaa9ff7a1262bd109429d9ee0d2f056b06edad9\">[45780]</a></span>: further optimization; can do without strcmp <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5131\" onclick=\"get_ticket_and_populate_wrapper('5131'); return false;\" title=\"sort hosts/slots numerically in condor_status\">#5131</a></span> we already know where the first mismatch is, so strcmp is only comparing the first mismatch character anyway. no change to the function output.  (By Carl Edquist )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-26 23:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/45b77767e418a2ced5bc124bc22a03f21e07db09\">[45738]</a></span>: add natural_cmp; a fresh strverscmp(3) implementation <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5131\" onclick=\"get_ticket_and_populate_wrapper('5131'); return false;\" title=\"sort hosts/slots numerically in condor_status\">#5131</a></span> based on the specification found in the manpage; identical output but completely different implementation than the gnu one.  (By Carl Edquist )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-06 15:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/891e87ee51eb7f382a95ce3811a5c71d34a0d922\">[45218]</a></span>: one missing ifdef for non-glibc case (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5131\" onclick=\"get_ticket_and_populate_wrapper('5131'); return false;\" title=\"sort hosts/slots numerically in condor_status\">#5131</a></span>)  (By Carl Edquist )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-06 12:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/616d37b30866f65466c4cd7643cc86ac54840594\">[45216]</a></span>: make -natural option for strverscmp sorting (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5131\" onclick=\"get_ticket_and_populate_wrapper('5131'); return false;\" title=\"sort hosts/slots numerically in condor_status\">#5131</a></span>)  (By Carl Edquist )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-02 18:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/aebd42abe3881c0e09698f173a9793c457e52907\">[45207]</a></span>: have condor_status sort with strverscmp where appropriate. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5131\" onclick=\"get_ticket_and_populate_wrapper('5131'); return false;\" title=\"sort hosts/slots numerically in condor_status\">#5131</a></span>  (By Carl Edquist )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Oct-26 17:40", "status": "resolved", "created": "2015-Jul-02 18:14", "fixed_version": "2015-Jul-02 18:14", "broken_version": "", "priority": "4", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "", "creator": "edquist", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "edquist@cs.wisc.edu", "due_date": ""}