{"id": 4593, "title": "Ticket #4593: Use Miron probes for DC runtime statistics", "description": "<blockquote>\nThe DC statistics that keep track of the amount of time spent at various things should optionally be full Miron style probes with min/max/avg/std as well as the current count &amp; accumulated runtime.</blockquote>", "remarks": "<blockquote>\n<em>2014-Nov-12 14:58:05 by tannenba:</em> <br/>\n\nChanging status of this ticket from docpending back to active, as beta testing in CHTC shows it is broken.\n\n<p>I attached below a schedd classad from submit machine e142.chtc with full statistics from a schedd running version 8.3.2 release candidate for almost 7 days in the cms global test pool.  Note from this ad we see:\n\n</p><p></p><pre>   CondorVersion = \"$CondorVersion: 8.3.2 Nov 03 2014 BuildID: 280257 $\"\n   MonitorSelfAge = 591032\n</pre>\n\n<p>However, there are many statistics that claim impossibly long Runtime values, i.e. much longer than the daemon has been alive!  Just a couple of examples grepping from the schedd classad attached to this ticket:\n\n</p><p></p><pre>  C:\\utils&gt;grep Reschedule e142\n  DCTimer_SchedulersendRescheduleRuntimeMin = 1412964464.788676\n  DCTimer_SchedulersendRescheduleRuntimeMax = 1412964464.788676\n  DCTimer_SchedulersendRescheduleRuntimeAvg = 1412964464.788676\n  DCTimer_SchedulersendRescheduleRuntime = 1412964464.788676\n  DCTimer_SchedulersendReschedule = 1\n  DCTimer_SchedulersendRescheduleRuntimeStd = 1412964464.788676\n</pre>\n\n<p></p><pre>  C:\\utils&gt;grep DaemonCorerefreshDNS e142\n  DCTimer_DaemonCorerefreshDNSRuntime = 28259289106.17169\n  DCTimer_DaemonCorerefreshDNSRuntimeStd = 0.0\n  DCTimer_DaemonCorerefreshDNSRuntimeAvg = 1412964455.308585\n  DCTimer_DaemonCorerefreshDNSRuntimeMin = 1412964433.891749\n  DCTimer_DaemonCorerefreshDNSRuntimeMax = 1412964476.704736\n  DCTimer_DaemonCorerefreshDNS = 20\n</pre>\n\n<p>I think the bug with these crazy Runtime stat values regressed with the commit in this ticket, since the Runtime values seemed sane in v8.3.1.\n\n</p><p></p><hr/>\n<em>2014-Nov-17 14:50:40 by tannenba:</em> <br/>\n\nAlso we are now getting ridiculous <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RecentDaemonCoreDutyCycle\" title=\"Recent Daemon Core Duty Cycle\">RecentDaemonCoreDutyCycle</a></span> numbers with 8.3.2 rc1. We are getting numbers like 20 Giga %.  Guessing this regression is also related to the patches made for this ticket.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/853/e142\">e142</a>\n35798 bytes added by tannenba on 2014-Nov-12 20:59:30 UTC.\n<br/>\nschedd classad demonstrating broken statistic values for gt4593<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-22 10:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/29abb24b02e9b88bae0c496c271cedfdba793f64\">[42001]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4645\" onclick=\"get_ticket_and_populate_wrapper('4645'); return false;\" title=\"Stats publication should be configurable using a whitelist\">#4645</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4593\" onclick=\"get_ticket_and_populate_wrapper('4593'); return false;\" title=\"Use Miron probes for DC runtime statistics\">#4593</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4595\" onclick=\"get_ticket_and_populate_wrapper('4595'); return false;\" title=\"Add DC stats for fsync, DNS &amp; prio-rec array runtime\">#4595</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4660\" onclick=\"get_ticket_and_populate_wrapper('4660'); return false;\" title=\"Add sub-second accurate timestamps to dprintf logs\">#4660</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-16 16:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f51ea2c62c15940e025bfe499b365d39b37d61ff\">[41943]</a></span>: Fix timebase mismatch for DCCommand_* attributes in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4593\" onclick=\"get_ticket_and_populate_wrapper('4593'); return false;\" title=\"Use Miron probes for DC runtime statistics\">#4593</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-18 13:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2974f94b4ae1e24d862ce1d9b8696ddac82cbd98\">[41667]</a></span>: fix mismatched timebase problem that caused huge runtime values for some stats probes <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4593\" onclick=\"get_ticket_and_populate_wrapper('4593'); return false;\" title=\"Use Miron probes for DC runtime statistics\">#4593</a></span> ===VersionHistory:None===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Sep-17 13:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/47c76e019c8f4a9bbd97102004a6d34079bf8acc\">[41176]</a></span>: Change DC runtime statistics to use Miron style probes (min/max/avg/std) <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4593\" onclick=\"get_ticket_and_populate_wrapper('4593'); return false;\" title=\"Use Miron probes for DC runtime statistics\">#4593</a></span> ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Dec-23 16:31", "status": "resolved", "created": "2014-Sep-16 16:22", "fixed_version": "2014-Sep-16 16:22", "broken_version": "", "priority": "1", "subsystem": "Daemons", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tannenba@cs.wisc.edu tim@cs.wisc.edu", "due_date": ""}