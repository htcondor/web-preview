{"id": 5439, "title": "Ticket #5439: Add event timestamp to dagman.out and jobstate.log", "description": "<blockquote>\nKaran (from Pegasus) wants the dagman.out file and jobstate.log file to show the actual time an event was logged, not just the time that DAGMan saw the event.  So a format something like this:\n\n<p></p><pre>  12/02/15 16:45:35 Event: ULOG_SUBMIT for HTCondor Node NODERET (136.0.0 (12/02/15 16:45:32)\n</pre>\n\n<p>(Event timestamp in parens at the end.)</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Dec-13 15:29:36 by wenger:</em> <br/>\n\nThis should be pretty easy to actually implement, but I think it will probably break some tests that look for specific lines in the dagman.out file...\n\n<p></p><hr/>\n<em>2015-Dec-13 15:32:30 by zmiller:</em> <br/>\n\nLooks like there's a parenthesis missing in:  <div class=\"code\">\n<pre class=\"code\">(136.0.0 (12/02/15 16:45:32)</pre></div>\n\n\n<p></p><hr/>\n<em>2015-Dec-14 14:42:12 by wenger:</em> <br/>\n\nCreated V8_5-gittrac_5439-branch for this.\n\n<p></p><hr/>\n<em>2015-Dec-14 15:11:04 by wenger:</em> <br/>\n\nHmm -- another question is whether we need to/want to change dagman.out, or just jobstate.log.\n\n<p>Currently, the jobstate.log lines look like this:\n\n</p><p></p><pre>  1450126747 NodeB SUBMIT 257.0 viz - 2\n</pre>\n\n<p>So I'm thinking to change the format to this:\n\n</p><p></p><pre>  1450126747 NodeB SUBMIT 257.0 viz - 2 [1450126745]\n</pre>\n\n<p>I guess the alternative would be something like:\n\n</p><p></p><pre>  1450126747 [1450126745] NodeB SUBMIT 257.0 viz - 2\n</pre>\n\n<p>but I figure that's more likely to break existing code that's reading this.\n\n</p><p></p><hr/>\n<em>2015-Dec-14 15:25:40 by wenger:</em> <br/>\n\nHmm -- looking at the code, it looks like the event timestamps in the jobstate.log file are from the event itself, not from DAGMan, so we may be able to just leave that alone.\n\n<p></p><hr/>\n<em>2015-Dec-14 15:27:01 by wenger:</em> <br/>\n\nAh, I need to document the timestamps in the jobstate.log section of the DAGMan manual chapter.\n\n<p></p><hr/>\n<em>2015-Dec-16 11:58:31 by wenger:</em> <br/>\n\nI decided to go with curly braces for the event timestamp, like this:\n\n<p></p><pre>  12/15/15 14:26:52 Event: ULOG_SUBMIT for HTCondor Node NODERET (359.0.0) {12/15 14:26:52}\n</pre>\n\n<p>since we don't have anything else in curly braces in those lines, so it should be easier to parse.\n\n</p><p></p><hr/>\n<em>2016-Jan-06 15:08:08 by wenger:</em> <br/>\n\nKind of a scary thing that I noticed when working on this:  the ULogEvent class has both a time_t and a struct tm.  I don't know why we have both.  But the really scary thing is that (when reading events, at least) (in DAGMan) they don't <strong>always</strong> correspond to the same time.  Most of the time they do, but sometimes they're a few seconds off...\n\n<p></p><hr/>\n<em>2016-Jan-11 13:20:35 by wenger:</em> <br/>\n\nHmm -- should some of the fixes to the event timestamps go into 8.4??\n\n<p></p><hr/>\n<em>2016-Jan-11 13:22:53 by zmiller:</em> <br/>\n\nRegarding putting changes in 8.4.X:  What happens if the timestamps don't match?  Does it impact the behavior, or cause DAGs to get stuck or anything?  Or is it just a matter of logging incorrect informatioin?\n\n<p></p><hr/>\n<em>2016-Jan-14 13:59:44 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>:  Suggestions:\n<ol>\n<li>The new timestamp put in curly braces is meant to be parsed by pegasus, and as such should not be subject to the <code>D_TIMESTAMP</code> debug system flag and should always be printed in the same format.\n</li><li>In <code>condor_dagman/debug.cpp:time_to_str()</code>, the code here can be rewritten to both do the above and simplify the code.\n</li></ol>\n\n<p></p><hr/>\n<em>2016-Jan-14 15:30:50 by wenger:</em> <br/>\n\nDealt with minor issues from the code review; I'm merging this to master.</blockquote>", "derived_tickets": "", "attachments": "<blockquote>\n<ul>\n<li><a href=\"attach_get/922/gt5439.dif\">gt5439.dif</a>\n30041 bytes added by wenger on 2016-Jan-13 20:45:51 UTC.\n<br/>\nThis is a diff of the branch in total -- the intermediate commits have lots of stuff that was eventually taken out.<br/>\n</li></ul>\n</blockquote>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-14 15:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47458\">[47458]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=47415\">[47415]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=47425\">[47425]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=47448\">[47448]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=47450\">[47450]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=47452\">[47452]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=47453\">[47453]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=47454\">[47454]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=47457\">[47457]</a></span>, Merge branch 'V8_5-gittrac_5439-branch' Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5439\" onclick=\"get_ticket_and_populate_wrapper('5439'); return false;\" title=\"Add event timestamp to dagman.out and jobstate.log\">#5439</a></span>: Merged to master for 8.5.2. Added ticket number to version history.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-14 15:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47457\">[47457]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5439\" onclick=\"get_ticket_and_populate_wrapper('5439'); return false;\" title=\"Add event timestamp to dagman.out and jobstate.log\">#5439</a></span>: Dealt with minor issues from code review.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-13 12:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47453\">[47453]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5439\" onclick=\"get_ticket_and_populate_wrapper('5439'); return false;\" title=\"Add event timestamp to dagman.out and jobstate.log\">#5439</a></span>: Changed timestamp in version history example to make gap more realistic.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-13 11:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47452\">[47452]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5439\" onclick=\"get_ticket_and_populate_wrapper('5439'); return false;\" title=\"Add event timestamp to dagman.out and jobstate.log\">#5439</a></span>: Removed temporary code; added version history item.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-12 08:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47450\">[47450]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5439\" onclick=\"get_ticket_and_populate_wrapper('5439'); return false;\" title=\"Add event timestamp to dagman.out and jobstate.log\">#5439</a></span>: Fixed test_log_reader for ULogEvent class changes.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-11 15:02</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47448\">[47448]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5439\" onclick=\"get_ticket_and_populate_wrapper('5439'); return false;\" title=\"Add event timestamp to dagman.out and jobstate.log\">#5439</a></span>: Did a bunch of cleanup of the ULogEvent class timestamps (eventTime and eventclock are now private, with accessor methods; eventclock is now getting set everywhere eventTime is set); lots of temporary code left in until I do a workspace build/test and make sure everything works.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-06 14:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47425\">[47425]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5439\" onclick=\"get_ticket_and_populate_wrapper('5439'); return false;\" title=\"Add event timestamp to dagman.out and jobstate.log\">#5439</a></span>: Various cleanups to the timestamp-printing code ; added new test to appropriate lists, which I forgot to do before.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-05 12:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47415\">[47415]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5439\" onclick=\"get_ticket_and_populate_wrapper('5439'); return false;\" title=\"Add event timestamp to dagman.out and jobstate.log\">#5439</a></span>: Added a test for this functionality.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-04 15:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47413\">[47413]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5439\" onclick=\"get_ticket_and_populate_wrapper('5439'); return false;\" title=\"Add event timestamp to dagman.out and jobstate.log\">#5439</a></span>: Added year to event timestamp in dagman.out; also forcing month, day and year to always have two digits.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Dec-28 13:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=47402\">[47402]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5439\" onclick=\"get_ticket_and_populate_wrapper('5439'); return false;\" title=\"Add event timestamp to dagman.out and jobstate.log\">#5439</a></span>: Committing a bunch of temporary stuff that needs to be cleaned up (see TEMPTEMP comments).  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Dec-15 14:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=46593\">[46593]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5439\" onclick=\"get_ticket_and_populate_wrapper('5439'); return false;\" title=\"Add event timestamp to dagman.out and jobstate.log\">#5439</a></span>: First version -- added event time string to dagman.out, but needs lots of checking/cleanup...  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Jan-25 11:30", "status": "resolved", "created": "2015-Dec-13 15:28", "fixed_version": "2015-Dec-13 15:28", "broken_version": "v080501", "priority": "1", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, zmiller@cs.wisc.edu, vahi@isi.edu", "due_date": ""}