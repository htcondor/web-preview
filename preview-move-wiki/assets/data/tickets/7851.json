{"id": 7851, "title": "Ticket #7851: procd inefficiencies on macOS in 8.8", "description": "<blockquote>\nTaking a snapshot of all processes in procapi is highly inefficient on macOS, and can be made much better. This was originally fixed in 8.9.8 (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7708\" onclick=\"get_ticket_and_populate_wrapper('7708'); return false;\" title=\"procd inefficiencies on macOS\">#7708</a></span>). The problem is bad enough in the batlab that we need the fix in the 8.8 series as well, so we're back-porting the changes in <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7708\" onclick=\"get_ticket_and_populate_wrapper('7708'); return false;\" title=\"procd inefficiencies on macOS\">#7708</a></span>.</blockquote>", "remarks": "<blockquote>\n<em>2020-Oct-13 17:04:38 by tlmiller:</em> <br/>\n\n<strong>Code Review</strong>\n\n<p>This looks good to me.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-28 16:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61356\">[61356]</a></span>: Docs for macOS procapi efficiency improvements. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7851\" onclick=\"get_ticket_and_populate_wrapper('7851'); return false;\" title=\"procd inefficiencies on macOS in 8.8\">#7851</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-10 10:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61261\">[61261]</a></span>: Remove redundant sysctl() calls in procapi for macos. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7851\" onclick=\"get_ticket_and_populate_wrapper('7851'); return false;\" title=\"procd inefficiencies on macOS in 8.8\">#7851</a></span> (This was back-ported from <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7708\" onclick=\"get_ticket_and_populate_wrapper('7708'); return false;\" title=\"procd inefficiencies on macOS\">#7708</a></span> in 8.9.8) Save information from initial sysctl() call that returns information about all processes, to avoid subsequent per-process calls of sysctl(). Similar to Windows, this involves a custom buildProcInfoList()\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-10 10:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61262\">[61262]</a></span>: Remove redundant sysctl() call in procapi for macos single-pid query <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7851\" onclick=\"get_ticket_and_populate_wrapper('7851'); return false;\" title=\"procd inefficiencies on macOS in 8.8\">#7851</a></span> (This was back-ported from <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7708\" onclick=\"get_ticket_and_populate_wrapper('7708'); return false;\" title=\"procd inefficiencies on macOS\">#7708</a></span> in 8.9.8) When calling sysctl() for a single pid, we know the size of the data structure, so we don't need an extra call to find it out.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Sep-10 10:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61263\">[61263]</a></span>: Remove remaining buildPidList() calls on macOS. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7851\" onclick=\"get_ticket_and_populate_wrapper('7851'); return false;\" title=\"procd inefficiencies on macOS in 8.8\">#7851</a></span> (This was back-ported from <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7708\" onclick=\"get_ticket_and_populate_wrapper('7708'); return false;\" title=\"procd inefficiencies on macOS\">#7708</a></span> in 8.9.8)  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Oct-13 17:04", "status": "resolved", "created": "2020-Sep-09 16:33", "fixed_version": "2020-Sep-09 16:33", "broken_version": "", "priority": "3", "subsystem": "DaemonProcD", "assigned_to": "jfrey", "derived_from": "#7708", "creator": "jfrey", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "", "due_date": ""}