{"id": 5417, "title": "Ticket #5417: Erratic startup ASSERTs with shared port on Windows", "description": "<blockquote>\nSometimes on Windows a daemon (master?) will fail to start up.  The system is using shared ports.\n\n<p>Failure is probably in DaemonCore::InfoCommandSinfulStringMyself; one of the ASSERT(X.hasAddrs()) is failing.  Probably because the shared port daemon wrote a sinful to file that lacks the addrs field.\n\n</p><p>However, the sinful the shared port daemon writes is itself from DaemonCore::InfoCommandSinfulStringMyself.  All exit paths from DC:ICSSM ASSERT(X.hasAddrs) or return NULL. The only path that doesn't is inside of if(shared_port_endpoint), which should <em>never</em> run on the shared port daemon itself.\n\n</p><p>So, that's fun.\n\n</p><p>TJ believes that it works if the first call to DC:ICSSM in the master(?) is inside of a timeout firing.  Fiddling with the timing causes DC:ICSSM to return NULL, which is probably expected and doesn't cause the problem.\n\n</p><p>Current list to investigate:\n\n</p><p></p><ul>\n<li>SharedPortEndpoint::UseSharedPort <a class=\"file\" href=\"rlog?f=src/condor_io/shared_port_endpoint.cpp\">/src/condor_io/shared_port_endpoint.cpp</a> :1176 - Hypothesis: this code is erroneously returning true for the shared port daemon itself, which kinda works, but creates a race condition where we can hit the bad code.\n</li></ul>\n\n<p>Long shot investigations, all in the shared port daemon:\n\n</p><p></p><ul>\n<li>SharedPortServer::PublishAddress() <a class=\"file\" href=\"rlog?f=src/condor_io/shared_port_server.cpp\">/src/condor_io/shared_port_server.cpp</a> :116\n</li><li>DaemonCore::InfoCommandSinfulStringMyself /src/condor_daemon_core.V6 :1086\n</li><li>SharedPortEndpoint::GetMyRemoteAddress <a class=\"file\" href=\"rlog?f=src/condor_io/shared_port_endpoint.cpp\">/src/condor_io/shared_port_endpoint.cpp</a>\n</li><li>SharedPortEndpoint::GetMyLocalAddress <a class=\"file\" href=\"rlog?f=src/condor_io/shared_port_endpoint.cpp\">/src/condor_io/shared_port_endpoint.cpp</a> :865\n</li><li>DaemonCore::InitSharedPort /src/condor_daemon_core.V6 :3118</li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2015-Nov-25 15:58", "status": "new", "created": "2015-Nov-25 15:58", "fixed_version": "2015-Nov-25 15:58", "broken_version": "v080502", "priority": "4", "subsystem": "", "assigned_to": "adesmet", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}