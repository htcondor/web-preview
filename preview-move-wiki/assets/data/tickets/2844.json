{"id": 2844, "title": "Ticket #2844: glidein slots stay Claimed/Idle", "description": "<blockquote>\nWe are seeing bouts of unhealthy amounts of Claimed/Idle in the CHTC glidein pool.\n\n<p>When I investigated, all of these slots were claimed by BMRB.  The slots had been Claimed/Idle for about an hour.\n\n</p><p>About half of the claims are not listed in the schedd's list of claims that it is managing.  There is not enough history to know when the schedd removed them.  The other half still have a shadow, which has an open TCP connection to the starter.  Presumably this TCP connection was closed on the other side but the shadow never got the news.\n\n</p><p>The claim lease duration is 20 minutes.\n\n</p><p>In one case, I observed a shadow eventually notice the dead connection when the TCP keep-alive timed out:\n\n</p><p></p><div class=\"verbatim\">\n<pre>02/24/12 08:44:34 (1285005.0) (13850): Request to run on\nglidein_20399@uct2-c259.mwt2.org &lt;10.1.4.59:43916?CCBID=128.104.59.136:9642#263947&amp;noUDP&gt; was ACCEPTED\n02/24/12 10:44:33 (1285005.0) (13850): condor_read() failed: recv() returned\n-1, errno = 104 Connection reset by peer, reading 21 bytes from startd\nglidein_20399@uct2-c259.mwt2.org.\n02/24/12 10:44:33 (1285005.0) (13850): IO: Failed to read packet header\n02/24/12 10:44:33 (1285005.0) (13850): Can no longer talk to condor_starter &lt;128.135.158.241:6191&gt;\n02/24/12 10:44:33 (1285005.0) (13850): Trying to reconnect to disconnected job\n02/24/12 10:44:33 (1285005.0) (13850): LastJobLeaseRenewal: 1330094674 Fri Feb 24 08:44:34 2012\n02/24/12 10:44:33 (1285005.0) (13850): JobLeaseDuration: 1200 seconds\n02/24/12 10:44:33 (1285005.0) (13850): JobLeaseDuration remaining: EXPIRED!\n02/24/12 10:44:33 (1285005.0) (13850): Reconnect FAILED: Job disconnected too\n long: JobLeaseDuration (1200 seconds) expired\n02/24/12 10:44:33 (1285005.0) (13850): **** condor_shadow (condor_SHADOW) pid 13850 EXITING WITH STATUS 107\n</pre></div>\n\n\n<p>After that, the schedd successfully started another job on the same glidein.\n\n</p><p>From this, I conclude that at least some of the cases involved in this incident (probably about half) could benefit from an applicaton-level keep-alive on the shadow/starter connection.\n\n</p><p>Why did the connection to the starter go bad?  The starter failed an assertion when there was a communication error on the connection to the shadow.\n\n</p><p></p><div class=\"verbatim\">\n<pre>02/24/12 09:04:38 (pid:27400) condor_read(): timeout reading 21 bytes from &lt;144.92.167.254:9617&gt;.02/24/12 09:04:38 (pid:27400) IO: Failed to read packet header\n02/24/12 09:04:38 (pid:27400) ERROR \"Assertion ERROR on (result)\" at line 381 in file /home/condor/execute/dir_21121/userdir/src/condor_start\ner.V6.1/NTsenders.cpp\n</pre></div>\n\n\n<p>Line 381 in NTsenders is in <code>REMOTE_CONDOR_begin_execution()</code>.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "incident", "last_change": "2012-Feb-24 11:22", "status": "new", "created": "2012-Feb-24 10:58", "fixed_version": "2012-Feb-24 10:58", "broken_version": "v070606", "priority": "4", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "dan@hep.wisc.edu,tannenba@cs.wisc.edu,wenger@cs.wisc.edu", "due_date": ""}