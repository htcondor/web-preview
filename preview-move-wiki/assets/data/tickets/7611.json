{"id": 7611, "title": "Ticket #7611: Job hold during input transfer crashes the starter", "description": "<blockquote>\nIf the starter receives a STARTER_HOLD_JOB command while input transfer is active, the starter crashes. The CStarter class sees that there are no jobs running and assumes it can exit immediately. When the global destructors run, the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=FileTransfer\" title=\"File Transfer\">FileTransfer</a></span> object notices it has a child transfer process and tries to use <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DaemonCore\" title=\"Daemon Core\">DaemonCore</a></span> to kill it. But the daemonCore pointer is NULL, blowing an ASSERT().\n\n<p>Here's an excerpt from the daemon log:\n</p><div class=\"verbatim\">\n<pre>04/20/20 14:12:40 (pid:25567) (D_ALWAYS) **** condor_starter (condor_STARTER) pid 25567 EXITING WITH STATUS 0\n04/20/20 14:12:40 (pid:25567) (D_ALWAYS|D_FAILURE) ERROR \"Assertion ERROR on (daemonCore)\" at line 5151 in file /var/lib/condor/execute/slot10/dir_6518/userdir/.tmpFAn8zH/BUILD/condor-8.9.6/src/condor_utils/file_transfer.cpp\nCaught signal 6: si_code=4294967290, si_pid=25567, si_uid=0, si_addr=0x63DF\nStack dump for process 25567 at timestamp 1587409960 (34 frames)\n/usr/lib64/libcondor_utils_8_9_6.so(dprintf_dump_stack+0x24)[0x7ff348546474]\n/usr/lib64/libcondor_utils_8_9_6.so(_Z17unix_sig_coredumpiP9siginfo_tPv+0x69)[0x7ff348709099]\n/usr/lib64/libpthread.so.0(+0xf5f0)[0x7ff34679e5f0]\n/usr/lib64/libc.so.6(gsignal+0x37)[0x7ff3463f7337]\n/usr/lib64/libc.so.6(abort+0x148)[0x7ff3463f8a28]\n/usr/lib64/libcondor_utils_8_9_6.so(_EXCEPT_+0x128)[0x7ff34861a8d8]\n/usr/lib64/libcondor_utils_8_9_6.so(+0x19dccb)[0x7ff348506ccb]\n/usr/lib64/libcondor_utils_8_9_6.so(_ZN12FileTransfer10stopServerEv+0x16)[0x7ff348506ce6]\n/usr/lib64/libcondor_utils_8_9_6.so(_ZN12FileTransferD1Ev+0x212)[0x7ff34850a7f2]\n/usr/lib64/libcondor_utils_8_9_6.so(_ZN12FileTransferD0Ev+0x9)[0x7ff34850ac09]\ncondor_starter(_ZN9JICShadowD2Ev+0x90)[0x471860]\ncondor_starter(_ZN9JICShadowD0Ev+0x9)[0x471a09]\ncondor_starter(_ZN8CStarterD2Ev+0x42)[0x4469d2]\n/usr/lib64/libc.so.6(+0x39c99)[0x7ff3463fac99]\n/usr/lib64/libc.so.6(+0x39ce7)[0x7ff3463face7]\n/usr/lib64/libcondor_utils_8_9_6.so(__wrap_exit+0x65)[0x7ff3486e80e5]\n/usr/lib64/libcondor_utils_8_9_6.so(_Z7DC_ExitiPKc+0x1d9)[0x7ff34870a639]\ncondor_starter[0x447da3]\ncondor_starter(_ZN8CStarter11cleanupJobsEv+0x93)[0x446953]\ncondor_starter(_ZN8CStarter14transferOutputEv+0x1db)[0x44aafb]\ncondor_starter(_ZN8CStarter11allJobsDoneEv+0xa4)[0x446de4]\ncondor_starter(_ZN8CStarter17remoteHoldCommandEiP6Stream+0x14e)[0x445e7e]\n/usr/lib64/libcondor_utils_8_9_6.so(_ZN10DaemonCore18CallCommandHandlerEiP6Streambbff+0x2ca)[0x7ff3486f359a]\n/usr/lib64/libcondor_utils_8_9_6.so(_ZN21DaemonCommandProtocol11ExecCommandEv+0x19a)[0x7ff34871f39a]\n/usr/lib64/libcondor_utils_8_9_6.so(_ZN21DaemonCommandProtocol10doProtocolEv+0x135)[0x7ff3487210d5]\n/usr/lib64/libcondor_utils_8_9_6.so(_ZN21DaemonCommandProtocol14SocketCallbackEP6Stream+0x95)[0x7ff3487211d5]\n/usr/lib64/libcondor_utils_8_9_6.so(_ZN10DaemonCore24CallSocketHandler_workerEibP6Stream+0x590)[0x7ff3486f4a20]\n/usr/lib64/libcondor_utils_8_9_6.so(_ZN10DaemonCore35CallSocketHandler_worker_demarshallEPv+0x1d)[0x7ff3486f4abd]\n/usr/lib64/libcondor_utils_8_9_6.so(_ZN13CondorThreads8pool_addEPFvPvES0_PiPKc+0x35)[0x7ff3484d6595]\n/usr/lib64/libcondor_utils_8_9_6.so(_ZN10DaemonCore17CallSocketHandlerERib+0x167)[0x7ff3486f0747]\n/usr/lib64/libcondor_utils_8_9_6.so(_ZN10DaemonCore6DriverEv+0x1b1e)[0x7ff3486f94de]\n/usr/lib64/libcondor_utils_8_9_6.so(_Z7dc_mainiPPc+0x1652)[0x7ff34870d8c2]\n/usr/lib64/libc.so.6(__libc_start_main+0xf5)[0x7ff3463e3505]\ncondor_starter[0x424a6a]\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2020-Oct-12 10:07", "status": "new", "created": "2020-Apr-21 14:38", "fixed_version": "2020-Apr-21 14:38", "broken_version": "", "priority": "4", "subsystem": "DaemonsExecNode", "assigned_to": "zmiller", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}