{"id": 7829, "title": "Ticket #7829: Hardening of TOKEN support before next stable release", "description": "<blockquote>\nSeveral misc issues to be addressed before token support in HTCondor goes in production in a stable series:\n\n<p><span class=\"subsection\"></span></p><h3>Issues to resolve</h3>\n<ol>\n<li><strong>DONE</strong> Our JWT parsing code needs a copyright\n</li><li><strong>DONE</strong> Tokens with CRLF line endings, or any whitespace at all other than a single newline character, cannot be parsed.  Prolly happened with commit <span class=\"chng\"><a href=\"chngview?cn=56470\">[56470]</a></span>.\n</li><li>Daemons will read system tokens with PRIV_CONDOR (see <code>findTokens()</code> in condor_auth_passwd.cpp)... should it use PRIV_ROOT instead?\n</li><li><code>condor_token_fetch</code> should temporarily set SEC_DEFAULT_AUTHENTICATION=Required to prevent it from failing in typical configurations, even when a user can successfully authenticate to the schded.\n</li><li>Either get this tested/working on Windows / Mac or document that it is Linux only\n</li><li>Documentation: actual format of a token file sitting in tokens.d is not discussed; for instance, unclear that a single file in tokens.d can contain multiple tokens, or that a token file can have comments, or that a token follows the JWT standard.\n</li><li>Documentation: No SCITOKEN authentication method documentation (why was <span class=\"ticket\"><a class=\"docpending\" href=\"/tickets?ticket=7281\" onclick=\"get_ticket_and_populate_wrapper('7281'); return false;\" title=\"Exchange a SCITOKEN for a TOKEN\">#7281</a></span> resolved?)\n</li><li>Documentation: No documentation for knob TRUST_DOMAIN\n</li></ol>\n\n<p><span class=\"subsection\"></span></p><h3>Extra Credit</h3>\n<ol>\n<li>Perhaps it would be really nice if a token entry in a token file could end with a comment (a space followed by a pound-sign then comment)?  Like an ssh key?   Currently comments are only allowed on their own line.</li></ol>\n</blockquote>", "remarks": "<blockquote>\n<em>2020-Aug-28 14:57:49 by bbockelm:</em> <br/>\n\nFor the item about SCITOKEN documentation: this was on purpose because the approach was experimental.\n\n<p>However, I agree <em>now</em> things are in such a place we should get these documented.\n\n</p><p></p><hr/>\n<em>2020-Aug-28 15:39:50 by bbockelm:</em> <br/>\n\nNote: we gave a user a script to use tokens for remote-submit and failed to tell him to avoid Windows.\n\n<p>He dutifully ran it on Windows and, today, was able to get jobs running!\n\n</p><p>So, <code>IDTOKENS</code> are at least minimally functional on Windows.  I believe Todd has been finding lots of small issues though.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-28 13:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61150\">[61150]</a></span>: Allow CRLF line terminations in token files. <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=7829\" onclick=\"get_ticket_and_populate_wrapper('7829'); return false;\" title=\"Hardening of TOKEN support before next stable release\">#7829</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-28 13:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=61149\">[61149]</a></span>: Add copyright notice to JWT code. <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=7829\" onclick=\"get_ticket_and_populate_wrapper('7829'); return false;\" title=\"Hardening of TOKEN support before next stable release\">#7829</a></span> This code came from <a class=\"external\" href=\"https://github.com/Thalhammer/jwt-cpp\">https://github.com/Thalhammer/jwt-cpp</a>. It has the MIT license.  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Nov-09 12:06", "status": "active", "created": "2020-Aug-28 11:46", "fixed_version": "2020-Aug-28 11:46", "broken_version": "", "priority": "3", "subsystem": "Security", "assigned_to": "tannenba", "derived_from": "", "creator": "tannenba", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "bbockelman@morgridge.org tannenba@cs.wisc.edu zmiller@cs.wisc.edu tlmiller@cs.wisc.edu matyas@cs.wisc.edu", "due_date": ""}