{"id": 7475, "title": "Ticket #7475: Add a Getting Started section to the manual", "description": "<blockquote>\nOur manual lacks simple, clear instructions for how to get started with HTCondor. There are several different angles to consider: installing Condor, submitting your first job, setting up a basic Condor pool, possibly some basic management.\n\n<p>The most immediate need (and reason for this ticket) is a simple guide for setting up + administering a HTCondor pool. This will be focused towards smaller university campuses who are setting up new clusters and need basic, clear instructions. We want to provide a short, concise recipe that doesn't get bogged down by all the different options and flavors available.\n\n</p><p>Next, we'll add the existing Quick Start Guide (<a class=\"external\" href=\"https://research.cs.wisc.edu/htcondor/manual/quickstart.html\">https://research.cs.wisc.edu/htcondor/manual/quickstart.html</a>) directly into the manual.\n\n</p><p>We also eventually want an \"Easy Install\" page, describing how to set up a personal Condor with as few steps as possible. We already have a webpage with some basic install information (<a class=\"external\" href=\"https://research.cs.wisc.edu/htcondor/instructions/\">https://research.cs.wisc.edu/htcondor/instructions/</a>) but even this gets too bogged down with options and details. This should be one page maximum.\n\n</p><p>Once we have enough content ready, we'll publish this all under a new top-level section called <strong>Getting Started</strong>.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Apr-16 14:07:54 by coatsworth:</em> <br/>\n\nI've added a new page to the manual, \"Quick Start: Setting up an HTCondor Pool\" however still need to add the full Getting Started section. Bumping this to the next release.\n\n<p></p><hr/>\n<em>2020-Jun-24 18:40:55 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n... actually, doc review! :P ....\n\n<p>The initial Quick Start instructions as they stand as of commit <span class=\"chng\"><a href=\"chngview?cn=59391\">[59391]</a></span> could still use some work.\n\n</p><p>First, more steps are required in the instructions than needed.  We can reduce the number of steps and complexity.  For instance, the first steps of installing from the repository requires wget to be installed (it is not installed in the Centos 7 basic image btw), leaves garbage files behind, requires answering questions.  Why not instead just two commands:\n\n</p><p></p><pre>   $ sudo yum-config-manager --add-repo https://research.cs.wisc.edu/htcondor/yum/repo.d/htcondor-stable-rhel7.repo\n   $ sudo yum install -y condor\n</pre>\n\n<p>Note the easy install above is dependent on the one-line change to our RPM repos specified in <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=7710\" onclick=\"get_ticket_and_populate_wrapper('7710'); return false;\" title=\"Simplify our RPM install instructions\">#7710</a></span>.\n\n</p><p>Next, I think the suggested contents for security file <code>config.d/50-security</code> suffers from the following problems:\n\n</p><p></p><ol>\n<li>unnecessary reverse DNS requirements\n</li><li>no encryption, meaning private claim id information is being passed over the network in the clear\n</li><li>host-based authorization for administrator commands (like condor_userprio)\n</li><li>contains lines that are not needed like <code>SEC_PASSWORD_FILE</code>, which is already defined upon installation of the RPM\n</li><li>is not completely cut-n-paste and yet it seems like it could be; for instance, references \"condor-cm.mydomain.com\"....  could we replace this with <code>$(CONDOR_HOST)</code>, since earlier in the instructions we tell people to define that?\n</li><li>no comments in this config file... not a single one...\n</li></ol>\n\n<p>I suggest instead something like:\n\n</p><p></p><div class=\"file\">\n<pre class=\"filelabel\">config.d/50-security</pre>\n<pre class=\"file\"># Require authentication, encryption, integrity\nuse SECURITY: Strong\n\n# Set things up so authentication must happen  via the local filesystem\n# or a pool password.  The local file system will be used to authenticate\n# users submitting, removing, or editing jobs; this means we assume users will\n# be logged into submit nodes.  HTCondor daemons themselves will only trust\n# other daemons with the same pool password, a secret contained in file on each\n# node that requires root access to read.\nSEC_DEFAULT_AUTHENTICATION_METHODS = FS, PASSWORD\n\n# Allow READ level access (e.g. condor_status) with\n# ANONYMOUS authentication, since we do not want users to have to login\n# to the central manager just to see output from condor_status.\nSEC_READ_AUTHENTICATION_METHODS = \\\n  $(SEC_DEFAULT_AUTHENTICATION_METHODS), ANONYMOUS\nSEC_CLIENT_AUTHENTICATION_METHODS = \\\n $(SEC_DEFAULT_AUTHENTICATION_METHODS), ANONYMOUS\n\n# This is the file that will contain the secret; it should only\n# be readable by user root and will be created when you run\n# sudo condor_store_cred add -c -p &lt;password&gt;.\nSEC_PASSWORD_FILE = /etc/condor/passwords.d/POOL\n\nALLOW_DAEMON = condor_pool@*/*, condor@*/$(IP_ADDRESS)\nALLOW_NEGOTIATOR = condor_pool@*/$(CONDOR_HOST)\n# Allow admin command like condor_user_prio from user root on any machine in the pool\nALLOW_ADMINISTRATOR = condor_pool@*/*\n</pre></div>\n\n\n<p>Also, instructions should say something about the permissions on the 50-security file (chmod 644).\n\n</p><p>Finally, the above pool password config could be in the <code>examples</code> directory so that these Quick Start instructions could just state to copy it into config.d.  Even better, why not a \"condor_quick_pool_setup\" script that just takes three command-line arguments (one or more role arguments, address of central manager, pool password) and does everything this page says to do?\n\n</p><p></p><hr/>\n<em>2020-Jun-25 17:14:49 by coatsworth:</em> <br/>\n\nThanks Todd, this all looks good. A few follow up questions:\n\n<p></p><ul>\n<li>We talked about configuring security with a metaknob, but I'm pretty sure we eventually agreed this was not possible?\n</li><li>You mentioned we could drop this file in the /examples folder, but that doesn't ship with the yum package. Is wget-ing the file from github a suitable alternative? (I think it is)\n</li><li>I'm assuming you're going to wait a new tutorial video once this goes live?\n</li></ul>\n\n<p>Lastly, I can't remember if I was waiting on Zach to provide some updated security config? Or is this enough for me to start testing + updating the docs page?\n\n</p><p></p><hr/>\n<em>2020-Jun-25 18:06:37 by tim:</em> <br/>\n\nThe examples ship and are found in the <code>/usr/share/doc/condor-8.x.x/examples</code> directory\n\n<p></p><hr/>\n<em>2020-Jun-25 18:19:45 by tim:</em> <br/>\n\nActually, the version number is in the directory on CentOS 7. In CentOS 8, the directory is in <code>/usr/share/doc/condor/examples</code>\n\n<p></p><hr/>\n<em>2020-Jun-26 13:21:22 by johnkn:</em> <br/>\n\nShould never config <code>SEC_PASSWORD_FILE</code>, this is in the param table, and in any case, if you want a different directory the knob to change would be <code>SEC_PASSWORD_DIRECTORY</code> not <code>SEC_PASSWORD_FILE</code>.\n\n<p></p><div class=\"snip\">\n<pre class=\"sniplabel\">from the param table</pre>\n<pre class=\"snip\">[SEC_PASSWORD_FILE]\ndefault=$(SEC_PASSWORD_DIRECTORY)/POOL\ntype=string\ntags=store_cred\n\n[SEC_PASSWORD_DIRECTORY]\ndefault=/etc/condor/passwords.d\nwin32_default=\ntype=path\ntags=store_cred\n</pre></div>\n\n\n<p></p><hr/>\n<em>2020-Jun-26 13:42:54 by zmiller:</em> <br/>\n\nI might suggest setting <code>SEC_CLIENT_AUTHENTICATION_METHODS</code> to <strong>all</strong> methods.  The server will filter out anything it doesn't like.\n\n<p>The reason for this is if someone wanted to submit to a remote pool, for example, and that pool was set up with <code>SSL, FSREMOTE, IDTOKENS, KERBEROS, GSI</code>, etc.  If the user has a credential to be used with a remote pool, we shouldn't also force them to set an environment variable just to allow them to use it.\n\n</p><p>Same if a SchedD was going to flock to another pool using an SSL cert specifically installed by the admin. (Although this scenario probably has other config necessary so really the user/remote-submit example is the primary motivator.)\n\n</p><p>In general, because the server enforces the list and the order, the client should support as many things as it can for ease of use.\n\n</p><p></p><hr/>\n<em>2020-Jul-01 14:55:57 by zmiller:</em> <br/>\n\nAfter discussion with Todd, we are going to keep this config as compact as possible.  It's only meant to work with the stable series (8.8) and only with Linux. (hence no <code>NTSSPI</code>... the quickstart directions tell you to \"<code>yum install</code>\" anyways, so I think this is a fair assumption).\n\n<p>This differs slightly from the above config by adding \"<code>condor@*</code>\" to the <code>ALLOW</code> lists since that's what <code>FS</code> will map to, and then putting them in the same order as the authentication methods. (The latter makes no functional difference but reads a little nicer in my opinion)\n\n</p><p>Also not removing the explicit definition of <code>SEC_PASSWORD_FILE</code> because there is no entry in the stable series param table for that, or for <code>SEC_PASSWORD_DIRECTORY</code> either.\n\n</p><p></p><div class=\"file\">\n<pre class=\"filelabel\">config.d/50-security</pre>\n<pre class=\"file\"># Require authentication, encryption, integrity\nuse SECURITY: Strong\n\n# Set things up so authentication must happen  via the local filesystem\n# or a pool password.  The local file system will be used to authenticate\n# users submitting, removing, or editing jobs; this means we assume users will\n# be logged into submit nodes.  HTCondor daemons themselves will only trust\n# other daemons with the same pool password, a secret contained in file on each\n# node that requires root access to read.\nSEC_DEFAULT_AUTHENTICATION_METHODS = FS, PASSWORD\n\n# Allow READ level access (e.g. condor_status) with\n# ANONYMOUS authentication, since we do not want users to have to login\n# to the central manager just to see output from condor_status.\nSEC_READ_AUTHENTICATION_METHODS = \\\n  $(SEC_DEFAULT_AUTHENTICATION_METHODS), ANONYMOUS\nSEC_CLIENT_AUTHENTICATION_METHODS = \\\n $(SEC_DEFAULT_AUTHENTICATION_METHODS), ANONYMOUS\n\n# This is the file that will contain the secret; it should only\n# be readable by user root and will be created when you run:\n#\n#     sudo condor_store_cred add -c -p &lt;password&gt;\n#\nSEC_PASSWORD_FILE = /etc/condor/passwords.d/POOL\n\n# Allow principals that authenticated using FS (condor) or PASSWORD (condor_pool)\nALLOW_DAEMON = condor@*/*, condor_pool@*/*\nALLOW_NEGOTIATOR = condor@*/$(CONDOR_HOST), condor_pool@*/$(CONDOR_HOST)\n# Allow admin command like condor_user_prio from any machine in the pool\nALLOW_ADMINISTRATOR = condor@*/*, condor_pool@*/*\n</pre></div>\n\n\n<p></p><hr/>\n<em>2020-Jul-07 16:11:54 by coatsworth:</em> <br/>\n\nI was able to get this configuration working, with one catch: in my VM testbed the negotiator was unable to match jobs because of an ipv4 vs. ipv6 mismatch. I fixed it by disabling ipv6. Do we want to mention this in the manual page? It seems like a problem that is specific to my testbed, but if we are going to mention it then I don't think disabling ipv6 is the best approach. Any thoughts or suggestions?\n\n<p></p><hr/>\n<em>2020-Jul-27 12:23:15 by karpel:</em> <br/>\n\nJust gave this a read since it was linked on a Nikhef email. Thoughts:\n\n<p></p><ul>\n<li>I'd really like to see some more \"conversational\" text in this guide, describing what's going on instead of just puking out things to copy-paste. Each code block should have at least one sentence describing \"what and why\" for that block. This guide needs to teach just enough that they know where to go next, and right now I don't think it has that.\n</li><li>I'd prefer we don't <code>echo</code> text into files. Instead, do something like \"add this line &lt;example&gt; to &lt;this file&gt;. The current way obscures the fact that you're building up a configuration file, which is necessary context. No need to name a specific editor; I think we can safely assume people reading this know how to edit text files.\n</li><li>I think it would be useful to push all the way through to running a sleep job as a smoke test.\n</li><li>We should consider having an \"alternate track\" for what to do if you want all of this on the same host (probably some <code>.. note::</code> blocks placed throughout). Keep the three-machine setup as the \"default\" path.\n</li><li>This page should be prominently linked from the front page of the docs. It should be obvious where to go to learn how to set up a basic pool.\n</li><li>I think it needs to be explicitly stated that the hostnames of the three machines are placeholders. Yes, it's obvious to us, but not necessarily to random people on the internet.</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-20 09:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60157\">[60157]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7475\" onclick=\"get_ticket_and_populate_wrapper('7475'); return false;\" title=\"Add a Getting Started section to the manual\">#7475</a></span>) Unix line endings for 50-security  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-08 17:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=60102\">[60102]</a></span>: Added stable series Quick Start Cluster docs (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7475\" onclick=\"get_ticket_and_populate_wrapper('7475'); return false;\" title=\"Add a Getting Started section to the manual\">#7475</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jun-24 11:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59967\">[59967]</a></span>: Updated Quick Start Condor Pool with better instructions (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7475\" onclick=\"get_ticket_and_populate_wrapper('7475'); return false;\" title=\"Add a Getting Started section to the manual\">#7475</a></span>)  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-17 11:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59391\">[59391]</a></span>: Updated Quick Start Condor Pool with better instructions (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7475\" onclick=\"get_ticket_and_populate_wrapper('7475'); return false;\" title=\"Add a Getting Started section to the manual\">#7475</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jan-28 14:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58877\">[58877]</a></span>: Added Quick Start Condor Pool to admin manual (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7475\" onclick=\"get_ticket_and_populate_wrapper('7475'); return false;\" title=\"Add a Getting Started section to the manual\">#7475</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "doc", "last_change": "2020-Nov-21 08:03", "status": "resolved", "created": "2020-Jan-13 12:12", "fixed_version": "2020-Jan-13 12:12", "broken_version": "", "priority": "3", "subsystem": "", "assigned_to": "coatsworth", "derived_from": "", "creator": "coatsworth", "rust": "", "customer_group": "other", "visibility": "public", "notify": "coatsworth@cs.wisc.edu, tannenba@cs.wisc.edu zmiller@cs.wisc.edu johnkn@cs.wisc.edu tim@cs.wisc.edu", "due_date": ""}