{"id": 5097, "title": "Ticket #5097: Backport pslot preemption fixes to 8.2", "description": "<blockquote>\nWe've made significant changes to pslot preemption in the 8.3 serries, making it viable for most use cases. LIGO would like to see these fixes back-ported to the 8.2 series, since it likely be a while before they can deploy 8.4.</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-20 12:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c750b50f52d6c1203c287ac72690cbb8a1a3d504\">[45345]</a></span>: 8.3.7 version history item, defn of new knob, and defns of new machine <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> attributes for pslot preemption <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-02 12:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/80d11dca83e3a2c0316d081e5cf4a21265dc60a5\">[45200]</a></span>: edit of new doc describing pslot preemption <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-30 16:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8653ed4942945d808d9b0c1bc5e1cd35f06b3645\">[45181]</a></span>: Docs for ALLOW_PSLOT_PREEMPTION. <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/728685246fcea1e3e551b3a94ff9687886ba5559\">[45081]</a></span>: fix fedora warning for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span> Conflicts: src/condor_q.V6/queue.cpp Committer: Jaime Frey  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d901d2fbdbeb5d1abf923061bd2006951fb9817a\">[45080]</a></span>: Minor pslot preemption cleanup in the negotiator. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span> Ignore the extra claim ids when clearing entries in the claimIds map and sending MATCH_INFO to the startd.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/daa515005ee6317dc60094a3a0d27bafd93b629d\">[45079]</a></span>: Don't do pslot preemption when NEGOTIATOR_CONSIDER_PREEMPTION=False <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9222b7664f03b10aa58fdb965b56555ff1432b1a\">[45078]</a></span>: Make pslot preemption work with CONSUMPTION_POLICY. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span> When the pslot can be matched multiple times, ensure that we only hand out each dslot claim once. Only put pslot claims with complete child claim information into childClaimHash.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/59fd6d20ca87b0605dd5d810968a3e69a68d93d4\">[45077]</a></span>: Make pslot preemption work with match password authentication. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5094\" onclick=\"get_ticket_and_populate_wrapper('5094'); return false;\" title=\"More improvements for preemption of partitionable slots\">#5094</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span> Properly escape claim ids containing quotes in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ChildClaimIds\" title=\"Child Claim Ids\">ChildClaimIds</a></span>. The schedd can't determine the startd's version from the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ReliSock\" title=\"Reli Sock\">ReliSock</a></span>. Assume the startd is new enough to understand extra claim ids. The claim attempt will fail anyway\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/93b6f58b2a7af3f9469a0219409d32f10c6e82ff\">[45076]</a></span>: Fix compiler warnings in pslot preemption code. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4942\" onclick=\"get_ticket_and_populate_wrapper('4942'); return false;\" title=\"Improve RANK preeemption for partitionable slots\">#4942</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/98a69053cafdb6c229d421fb37742ef8f98c824d\">[45075]</a></span>: Improve pslot preemption in the startd. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4942\" onclick=\"get_ticket_and_populate_wrapper('4942'); return false;\" title=\"Improve RANK preeemption for partitionable slots\">#4942</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span> * Constrain <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RetirementTimeRemaining\" title=\"Retirement Time Remaining\">RetirementTimeRemaining</a></span> to be non-negative. * Roll-up <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=RetirementTimeRemaining\" title=\"Retirement Time Remaining\">RetirementTimeRemaining</a></span> of dslots into pslot. * Refuse to preempt dslots that have retirement time remaining. * Return <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CpuAttributes\" title=\"Cpu Attributes\">CpuAttributes</a></span> resources of preempted dslots to the pslot immediately,\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/33cef9468d2c80e4e66e89fc551cc8abe5c744e2\">[45074]</a></span>: Improve pslot preemption in the negotiator. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4942\" onclick=\"get_ticket_and_populate_wrapper('4942'); return false;\" title=\"Improve RANK preeemption for partitionable slots\">#4942</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span> * Disable direct preemption of dslots when ALLOW_PSLOT_PREEMPTION is True. * Simplify code to lookup values in rolled-up lists of dslot attributes in the pslot ad. * Ignore dslots that aren't eligible for preemption (due to retirement time or being\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jun-15 16:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a88ce9b32d1b44ea5deba181b95e0087dbef09ac\">[45073]</a></span>: Allow user prio preemption of partitionable slots <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4699\" onclick=\"get_ticket_and_populate_wrapper('4699'); return false;\" title=\"Allow user prio preemption to work on partitionable slots\">#4699</a></span> <span class=\"ticket\"><a class=\"defer\" href=\"/tickets?ticket=5097\" onclick=\"get_ticket_and_populate_wrapper('5097'); return false;\" title=\"Backport pslot preemption fixes to 8.2\">#5097</a></span> Committer: Jaime Frey  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Jul-07 15:15", "status": "defer", "created": "2015-Jun-15 16:18", "fixed_version": "2015-Jun-15 16:18", "broken_version": "v080208", "priority": "5", "subsystem": "Unknown", "assigned_to": "jfrey", "derived_from": "#3667", "creator": "jfrey", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pcouvare@caltech.edu", "due_date": ""}