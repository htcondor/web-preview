{"id": 7269, "title": "Ticket #7269: support an explicit list of checkpoint files", "description": "<blockquote>\nDuncan M wrote:\n\n<p>As I see it, an ideal outcome would be something like this:\n\n</p><p></p><div class=\"verbatim\">\n<pre>should_transfer_files = YES\nwhen_to_transfer_files = ON_SUCCESS\ntransfer_input_files = infile1.txt, infile2.txt\ntransfer_output_files = outfile1.txt, outfile2.txt\ncheckpoint_files = checkpoint.dat\n</pre></div>\n\n\n<p>(plus the current +SuccessCheckpointExitCode etc options to perform self-checkpointing)\n\n</p><p>Here checkpoint.dat is sent between the sandbox/spool as needed to follow the job around if it gets evicted (IF IT EXISTS - if it doesn't exist when the job gets evicted, that should not present an error, maybe a warning would be good, for debugging). Note that if I (the user) want to have the checkpoint as part of the output files I can (and should) specify it in transfer_output_files (as now).\n\n</p><p>Also, it would be great to have condor keep track of those elements of transfer_output_files that happen to exist when a job is evicted, and have those transferred to/from spool so that they exist in the sandbox of the restarted job. This means that if a job creates a file, then gets evicted and restarted in a new sandbox, the file is moved into that new sandbox so that it doesn't have to be regenerated again (which in general it wouldn't if the job restarts from a checkpoint) and transfer_output_files is complete when the job finally exits (successfully).</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Sep-18 13:51:02 by pfc:</em> <br/>\n\nThis is related to <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7270\" onclick=\"get_ticket_and_populate_wrapper('7270'); return false;\" title=\"when_to_transfer_output = ON_SUCCESS\">#7270</a></span>.\n\n<p></p><hr/>\n<em>2019-Sep-18 15:28:09 by tlmiller:</em> <br/>\n\nSo to summarize:\n\n<p></p><ul>\n<li>If <code>checkpoint_files</code> is specified, it's a list of optional (not existing is not an error) files to transfer whenever we do any file transfer other than the 'final' transfer.  This does not interact in any way with <code>when_to_transfer_output = ON_SUCCESS</code>, which governs the behavior of only the 'final' file transfer.  This use of 'final' hopefully coincides with the existing flag in the file transfer object, but for this specification means \"when the job exited of its own accord and that exit did not indicate a successful checkpoint\".\n\n<p></p></li><li>HTCondor should always act as if <code>checkpoint_files</code> included <code>$(transfer_output_files)</code>.\n</li></ul>\n\n<p></p><hr/>\n<em>2019-Sep-25 14:40:04 by pfc:</em> <br/>\n\nBumping to priority 2 since Josh Willis informed me that this is effectively blocking lalinference from using Condor file i/o.\n<hr/>\n<em>2020-Apr-10 07:46:37 by tim:</em> <br/>\n\nBulk change of target version from v080906 to v080907 using ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Mar-16 15:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59161\">[59161]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7270\" onclick=\"get_ticket_and_populate_wrapper('7270'); return false;\" title=\"when_to_transfer_output = ON_SUCCESS\">#7270</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7338\" onclick=\"get_ticket_and_populate_wrapper('7338'); return false;\" title=\"Input file transfer should preserve relative paths\">#7338</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7269\" onclick=\"get_ticket_and_populate_wrapper('7269'); return false;\" title=\"support an explicit list of checkpoint files\">#7269</a></span>) Release notes and documentation.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-24 18:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=59030\">[59030]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7269\" onclick=\"get_ticket_and_populate_wrapper('7269'); return false;\" title=\"support an explicit list of checkpoint files\">#7269</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7338\" onclick=\"get_ticket_and_populate_wrapper('7338'); return false;\" title=\"Input file transfer should preserve relative paths\">#7338</a></span>) Documentation.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-13 18:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58967\">[58967]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7269\" onclick=\"get_ticket_and_populate_wrapper('7269'); return false;\" title=\"support an explicit list of checkpoint files\">#7269</a></span>) Fix bug preventing UploadCheckpointFiles() from falling back to old specification.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-13 16:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58964\">[58964]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7338\" onclick=\"get_ticket_and_populate_wrapper('7338'); return false;\" title=\"Input file transfer should preserve relative paths\">#7338</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7269\" onclick=\"get_ticket_and_populate_wrapper('7269'); return false;\" title=\"support an explicit list of checkpoint files\">#7269</a></span>) Add ATTR_CONDOR_VERSION #define. Add preserve_relative_paths and transfer_checkpoint_files at submit commands; if either is specified, the submit utils will ad a requirement for version 8.9.6 or higher.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Feb-13 14:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=58961\">[58961]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7269\" onclick=\"get_ticket_and_populate_wrapper('7269'); return false;\" title=\"support an explicit list of checkpoint files\">#7269</a></span>) Allow the list of output files and the list of checkpoint files to be different.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Apr-10 07:46", "status": "resolved", "created": "2019-Sep-18 13:46", "fixed_version": "2019-Sep-18 13:46", "broken_version": "", "priority": "2", "subsystem": "FileTransfer", "assigned_to": "tlmiller", "derived_from": "", "creator": "pfc", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pcouvare@caltech.edu, MacLeodDM@cardiff.ac.uk, james.clark@physics.gatech.edu, tlmiller@cs.wisc.edu, joshua.willis@ligo.org", "due_date": ""}