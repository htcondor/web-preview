{"id": 6854, "title": "Ticket #6854: Add file transfer events to user log.", "description": "<blockquote>\nIt would be convenient for statistics gathering and for debugging if HTCondor wrote file-transfer related events to the user (job) log.  In particular:\n\n<p></p><ol>\n<li>input transfer queued\n</li><li>input transfer started\n</li><li>input transfer finished\n</li><li>output transfer queued\n</li><li>output transfer started\n</li><li>output transfer finished\n</li></ol>\n\n<p>For a first pass, the fact that these events happened (at a given time) is enough.  I'd like to add the enum-name of the event type, however, so that we can establish the presence of a readily machine-readable table of extra values early.\n\n</p><p>For a second pass, since it appears in-queued happens before the first mention of a job's execute host, it should maybe mention that.  Ditto in-started, in case the transfer hangs (and in-started and the execution event aren't always simultaneous).\n\n</p><p>A third pass should consider adding periodic events while transferring, although only if we can include useful information (e.g., which file is currently being transferred).</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Jan-11 16:25:13 by tlmiller:</em> <br/>\n\n<div class=\"code\">\n<pre class=\"code\">tlmiller@azaphrael:~/Work/condor/test$ condor_wait -echo ./bidir.log | grep 611.015\n000 (611.015.000) 01/11 14:10:52 Job submitted from host: &lt;69.130.241.97:38729?addrs=69.130.241.97-38729&amp;noUDP&amp;sock=5878_b62e_5&gt;\n040 (611.015.000) 01/11 14:11:14 File transfer in queued\n040 (611.015.000) 01/11 14:11:22 File transfer in started\n001 (611.015.000) 01/11 14:11:22 Job executing on host: &lt;69.130.241.97:38729?addrs=69.130.241.97-38729&amp;noUDP&amp;sock=5878_b62e_4&gt;\n040 (611.015.000) 01/11 14:11:24 File transfer in finished\n006 (611.015.000) 01/11 14:11:32 Image size of job updated: 18452\n040 (611.015.000) 01/11 14:11:37 File transfer out queued\n040 (611.015.000) 01/11 14:11:44 File transfer out started\n040 (611.015.000) 01/11 14:11:45 File transfer out finished\n005 (611.015.000) 01/11 14:11:46 Job terminated.\n</pre></div>\n\n\n<p></p><hr/>\n<em>2019-Jan-14 15:43:25 by tlmiller:</em> <br/>\n\nIf you have the (experimental) multi-file transfer knob turned on, the input transfer finished event (and job attribute) will be a lie, but ToddT intends to fix that (and still exit the transfer queue) in short order, so don't worry about it.\n\n<p></p><hr/>\n<em>2019-Jan-14 16:43:48 by tlmiller:</em> <br/>\n\nThe current code outputs six events: queued, started, and finished for both input and output.\n\n<p></p><ul>\n<li>The 'input queued' event should include the starter host (but doesn't yet) -- the event is written well before the job-executed event that is otherwise the first mention of the starter.  This may be troublesome when debugging a hung queue.  (In the future, when we have more than one, the event should mention which queue.)\n\n<p></p></li><li>The 'input started' event (so far) appears to always coincide with (but precede) the 'job executing on host' event.  Strictly speaking, this may make it redundant.  On the other hand, I don't like requiring that kind of implicit knowledge.  (We may want to add a 'starter forked' event to address the uncertainty there, as well.)  On the gripping hand, it also looks really strange to have the input transfer start, then the job, and then the input transfer finish, but since (I think) that's what actually happening, maybe that just means we should add a starter-forked event instead.\n\n<p></p></li><li>The 'seconds spent in queue' information in the 'input started' and 'output started' events is redundant if the 'input queued' and 'output queued' messages are retained, and arguably \"out of character\" of HTCondor.  OTOH, if remove the queued messages as generally uninteresting to the user (\"just clutter\", to quote an RCF), this data may become more interesting.  (Although it only appears after the queue is entered, which may make debugging harder...)\n</li></ul>\n\n<p>To be clear, I expect us to tweak what information is logged before release.\n\n</p><p></p><hr/>\n<em>2019-Jan-14 16:45:24 by tlmiller:</em> <br/>\n\nLikewise, as noted in the commit message, this code adds nine new job-ad attributes.  This is probably excessive.\n\n<p></p><hr/>\n<em>2019-Jan-18 16:04:35 by tlmiller:</em> <br/>\n\nJaime notes that\n\n<p></p><div class=\"code\">\n<pre class=\"code\">040 (617.014.000) 01/14 13:17:58 Started transferring input files\n001 (617.014.000) 01/14 13:17:58 Job executing on host: &lt;69.130.241.97:41561?addrs=69.130.241.97-41561&amp;noUDP&amp;sock=5111_9d0a_4&gt;\n040 (617.014.000) 01/14 13:17:58 Finished transferring input files\n</pre></div>\n\n\n<p>may be caused by a bias in the shadow towards handling sockets before pipes (that is, the starter didn't actually notify the shadow that it was starting before it finished transferring files).  This seems less likely given the log included above, however....\n\n</p><p></p><hr/>\n<em>2019-Jan-19 20:22:05 by tlmiller:</em> <br/>\n\nAdded in-queued host.  Should probably still add in-started host.\n\n<p></p><hr/>\n<em>2019-Jan-25 11:39:50 by tlmiller:</em> <br/>\n\nAdded started-in host in the case where the transfer wasn't queued (because it is otherwise unnecessary).</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Feb-11 13:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0508450350e86315b0add285fb2e47d068101d46\">[56164]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6854\" onclick=\"get_ticket_and_populate_wrapper('6854'); return false;\" title=\"Add file transfer events to user log.\">#6854</a></span>) Release note, document job ad attributes, add event type to table.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-25 11:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1c77356731602228030a5a08fc3b8adb85b96fa1\">[56085]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6854\" onclick=\"get_ticket_and_populate_wrapper('6854'); return false;\" title=\"Add file transfer events to user log.\">#6854</a></span>) Write the transferring-to host in the input transfer event if we didn't already specify it in the input queued event.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-19 20:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8adea0e1ba57942d67de5e25fa4a5304acc8e716\">[56032]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6854\" onclick=\"get_ticket_and_populate_wrapper('6854'); return false;\" title=\"Add file transfer events to user log.\">#6854</a></span>) Add the starter's (HTCondor) address to the transfer-queued event, since you don't otherwise know it, yet.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-18 16:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2b6c3d1fae153c7d18411764887ea07fb036f627\">[56031]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6854\" onclick=\"get_ticket_and_populate_wrapper('6854'); return false;\" title=\"Add file transfer events to user log.\">#6854</a></span>) Correct an important copypasta error.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-16 14:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/66f3b0ffe358ef9b96189fd63b3cbeddf1398feb\">[56028]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6854\" onclick=\"get_ticket_and_populate_wrapper('6854'); return false;\" title=\"Add file transfer events to user log.\">#6854</a></span>) Update Python test bindings to ignore file transfer events.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-14 17:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/aef7f41dd2e7e36ff964de1d1b65586a0c9f3445\">[56026]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6854\" onclick=\"get_ticket_and_populate_wrapper('6854'); return false;\" title=\"Add file transfer events to user log.\">#6854</a></span>) Fix a stupid bug and work around a build failure (hopefully).  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-14 15:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d59e726c8293c8645911c6a9de666cf2593f5236\">[56023]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6854\" onclick=\"get_ticket_and_populate_wrapper('6854'); return false;\" title=\"Add file transfer events to user log.\">#6854</a></span>) Add <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobCurrentFinishTransferOutputDate\" title=\"Job Current Finish Transfer Output Date\">JobCurrentFinishTransferOutputDate</a></span> and JobCurrent[Start|Finish]TransferInputDate to the job ad; these are the old, deceptive times, but complete the set. Add Transfer[In|Out][Queued|Started|Finished], which are the new (good) event times. Change the transfer event text, hopefully for the\u00a0[...]\n (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-12 19:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b1e7adc5f59b0bd9aacdf788ff782e83943496dc\">[56022]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6854\" onclick=\"get_ticket_and_populate_wrapper('6854'); return false;\" title=\"Add file transfer events to user log.\">#6854</a></span>) Most of the first pass of a file transfer event series.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Feb-11 13:51", "status": "resolved", "created": "2019-Jan-11 14:46", "fixed_version": "2019-Jan-11 14:46", "broken_version": "v080900", "priority": "3", "subsystem": "Libs", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, lmichael@wisc.edu", "due_date": ""}