{"id": 3221, "title": "Ticket #3221: negotiator ASSERTs", "description": "<blockquote>\nthe negotiator will ASSERT if it finds a duplicate ad keyed on (Name,StartdIpAddr).\n\n<p>however, since 7.5.0 ads now contain <span class=\"quote\">MyAddress</span> instead of <span class=\"quote\">StartdIpAddr</span>, and the collector keys ads using (Name,MyAddress).\n\n</p><p>so, in 7.5.0 and beyond, it's possible for the collector to give a list of ads to the negotiator that from the collector's perspective are unique, but from the negotiator's perspective contain duplicate keys, and it asserts.\n\n</p><p>i propose two changes:\n\n</p><p>1) the negotiator should use the same key as the collector\n\n</p><p>2) if the negotiator sees a duplicate key, discard that ad instead of ASSERTing.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Sep-06 17:13:31 by danb:</em> <br/>\n\nWhat about using the same function the collector does: makeStartdAdHashKey?\n\n<p></p><hr/>\n<em>2012-Sep-06 17:26:16 by zmiller:</em> <br/>\n\nyes, makeStartdAdHashKey is what i used in the proposed patch to solve item 1.  so i think we agree there.  i'm going to commit this to V7_8-branch so i appreciate the extra scrutiny.\n\n<p></p><hr/>\n<em>2012-Sep-07 10:03:09 by danb:</em> <br/>\n\nCode review: looks good to me!\n<hr/>\n<em>2012-Sep-19 16:15:53 by zmiller:</em> <br/>\n\nBulk change of target version from v070804 to v070805 using ./ticket-target-mover.\n\n<p></p><hr/>\n<em>2012-Sep-26 12:00:00 by jfrey:</em> <br/>\n\nInstructions for working around the bug in 7.8.4: <span class=\"wiki\"><a href=\"wiki?p=NegotiatorAssertWorkaround\" title=\"Negotiator Assert Workaround\">NegotiatorAssertWorkaround</a></span></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3237\" onclick=\"get_ticket_and_populate_wrapper('3237'); return false;\" title=\"Negotiator writes malformed Accountnew.log\">#3237</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nNegotiator writes malformed Accountnew.log</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Oct-03 12:03</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ff28e2207bb52f30942bfd35ac6e35d0d5b68c50\">[33574]</a></span>: editing of 7.8.5 version history items ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3221\" onclick=\"get_ticket_and_populate_wrapper('3221'); return false;\" title=\"negotiator ASSERTs\">#3221</a></span> ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3227\" onclick=\"get_ticket_and_populate_wrapper('3227'); return false;\" title=\"JobsAccumPostExecuteTime is incorrect - much too large\">#3227</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Oct-02 16:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1eae27dba881a866235638751ba696972deb6b43\">[33561]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3221\" onclick=\"get_ticket_and_populate_wrapper('3221'); return false;\" title=\"negotiator ASSERTs\">#3221</a></span> (also <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3237\" onclick=\"get_ticket_and_populate_wrapper('3237'); return false;\" title=\"Negotiator writes malformed Accountnew.log\">#3237</a></span>). negotiator would write corrupt resource entries into Accountantnew.log, which will crash 7.9.0 negotiator  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-26 16:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/61150679fa4eb007b150ed323e597a574d7cd8cc\">[33508]</a></span>: accountant_log_fixer fixes corrupt Accountantlog.new files created by <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3221\" onclick=\"get_ticket_and_populate_wrapper('3221'); return false;\" title=\"negotiator ASSERTs\">#3221</a></span> (This fix is part of <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3237\" onclick=\"get_ticket_and_populate_wrapper('3237'); return false;\" title=\"Negotiator writes malformed Accountnew.log\">#3237</a></span>)  (By Alan De Smet )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-25 16:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3bef06de3b3d73989209ec0ccc8293b93a7ce601\">[33488]</a></span>: have the negotiator not ASSERT if it detects duplicates. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3221\" onclick=\"get_ticket_and_populate_wrapper('3221'); return false;\" title=\"negotiator ASSERTs\">#3221</a></span>  (By Zach Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-25 15:41</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/55af320056c279862e01cd0358a214952873c580\">[33482]</a></span>: Revert \"have the negotiator use the same unique key as the collector does, and not ASSERT if it detects duplicates. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3221\" onclick=\"get_ticket_and_populate_wrapper('3221'); return false;\" title=\"negotiator ASSERTs\">#3221</a></span>\" This reverts commit a8e0d4854cc8dfd0b806f4235c3648438f4550e0.  (By Zach Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-06 17:34</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a8e0d4854cc8dfd0b806f4235c3648438f4550e0\">[33298]</a></span>: have the negotiator use the same unique key as the collector does, and not ASSERT if it detects duplicates. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3221\" onclick=\"get_ticket_and_populate_wrapper('3221'); return false;\" title=\"negotiator ASSERTs\">#3221</a></span>  (By Zach Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-Oct-18 15:58", "status": "resolved", "created": "2012-Sep-06 16:05", "fixed_version": "2012-Sep-06 16:05", "broken_version": "v070600", "priority": "2", "subsystem": "Daemons", "assigned_to": "zmiller", "derived_from": "", "creator": "zmiller", "rust": "a23956", "customer_group": "fermi", "visibility": "public", "notify": "gthain@cs.wisc.edu,dan@hep.wisc.edu", "due_date": "20120912"}