{"id": 6868, "title": "Ticket #6868: scitokens: users cannot list or delete their own tokens", "description": "<blockquote>\nUsers need to have a way to list or delete their own tokens from the <code>SEC_CREDENTIAL_DIRECTORY</code> (KRB or OAUTH). The <code>condor_store_cred</code> tool already has a delete option, but it's not clear how to use it, or if it even works for this case.\n\n<p>Would be nice to have something like:\n</p><div class=\"verbatim\">\n<pre>$ condor_store_cred delete box\ncondor_store_cred: Removed box tokens for user jpatton\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2020-Jan-07 11:23:23 by jpatton:</em> <br/>\n\nBumping this. We don't necessarily need to piggyback off <code>condor_store_cred</code>. Maybe something following what Brian's done with the <code>condor_token</code> tools would be good here.\n<hr/>\n<em>2020-Apr-10 07:42:27 by tim:</em> <br/>\n\nBulk change of target version from v080808 to v080809 using ticket-target-mover.\n\n<p></p><hr/>\n<em>2020-Apr-22 10:24:02 by johnkn:</em> <br/>\n\ncondor_store_cred can sort of do this now,  does it need more work?\n\n<p></p><hr/>\n<em>2020-Apr-22 10:29:45 by zmiller:</em> <br/>\n\nYeah, that's true and that is cool.  Let me try it out before I see if we are \"done\" with it.  Maybe it does this already but it would be nice to display any meta-information we can.  However, since the creds are basically a black box, though, all I can really think of is \"last time updated\" from the file timestamp (and size, like anyone would really care?  md5sum? :)\n\n<p>Jason, is there a .meta file for each cred?  Or is that info only in the \"token request\" that gets cleaned up after acquiring?\n\n</p><p>Anyhow, like I said let me poke at it a bit.\n\n</p><p></p><hr/>\n<em>2020-Apr-22 10:32:23 by jpatton:</em> <br/>\n\nThe meta file is created by the credmon as a persistent store of metadata, and it does stick around. I think I have code in the credmon that deletes orphaned meta files, but I should check to be sure and add code if this doesn't exist. So I don't care if condor_store_cred deletes it or not.\n\n<p></p><hr/>\n<em>2020-Apr-26 11:32:02 by zmiller:</em> <br/>\n\nMaking this a code enhancement for 8.9.X series since that's where all TJ's new credential infrastucture changes for KRB/OAuth live.\n\n<p></p><hr/>\n<em>2020-Jun-29 11:21:44 by zmiller:</em> <br/>\n\nThis \"kind of\" exists now, in 8.9.7 and 8.9.8.\n\n<p>You can do the following:\n</p><div class=\"code\">\n<pre class=\"code\">condor_store_cred query-oauth\ncondor_store_cred delete-oauth\n</pre></div>\n\n\n<p>and those both work, but it's \"all or nothing\".  You can list all your OAuth tokens, and delete all your OAuth tokens.  However, to manage an individual token, you would want to use the <code>\"-s\"</code> flag to <code>condor_store_cred</code>, and after a quick test it seems that is not yet supported so a little more work is necessary there.\n\n</p><p>We would also like to display some data from the <code>\".meta\"</code> file associated with an OAuth token when the user does a query-oauth command (with or without specifying a particular service).\n\n</p><p>To better track where code lands, I made new tickets for the new items: <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=7775\" onclick=\"get_ticket_and_populate_wrapper('7775'); return false;\" title=\"Add finer control for condor_store_cred and OAuth tokens.\">#7775</a></span> and <span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=7776\" onclick=\"get_ticket_and_populate_wrapper('7776'); return false;\" title=\"Add better display of metadata for condor_store_cred and OAuth tokens.\">#7776</a></span>.</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=7775\" onclick=\"get_ticket_and_populate_wrapper('7775'); return false;\" title=\"Add finer control for condor_store_cred and OAuth tokens.\">#7775</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd finer control for condor_store_cred and OAuth tokens.</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"new\" href=\"/tickets?ticket=7776\" onclick=\"get_ticket_and_populate_wrapper('7776'); return false;\" title=\"Add better display of metadata for condor_store_cred and OAuth tokens.\">#7776</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd better display of metadata for condor_store_cred and OAuth tokens.</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Aug-03 13:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/163e7491b57cf5f2fe551e68732680eb68538c27\">[60324]</a></span>: Add note about condor_store_cred in version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6868\" onclick=\"get_ticket_and_populate_wrapper('6868'); return false;\" title=\"scitokens: users cannot list or delete their own tokens\">#6868</a></span>  (By zmiller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Aug-03 13:48", "status": "resolved", "created": "2019-Jan-17 09:52", "fixed_version": "2019-Jan-17 09:52", "broken_version": "v080900", "priority": "2", "subsystem": "Tools", "assigned_to": "zmiller", "derived_from": "#6513", "creator": "jpatton", "rust": "", "customer_group": "scitokens", "visibility": "public", "notify": "jpatton@cs.wisc.edu,tannenba@cs.wisc.edu,bbockelman@morgridge.org,zmiller@cs.wisc.edu", "due_date": ""}