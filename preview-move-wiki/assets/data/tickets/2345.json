{"id": 2345, "title": "Ticket #2345: gahp_server consumes 100% CPU", "description": "<blockquote>\ngahp_server.cpp contains the following at around line 1981:\n\n<p></p><div class=\"verbatim\">\n<pre>        for (;;) {\n                globus_poll_blocking();\n        }\n</pre></div>\n\n\n<p>In old globus versions, this would be somewhat equivalent to \"sleep\": the main thread would go off and handle whatever asynchronous event is in the queue.\n\n</p><p>For threaded flavors of Globus, this is equivalent to a spin-loop: globus_poll_blocking returns instantly as other threads handle asynchronous events.\n\n</p><p>Is it possible to detect the flavor at runtime?</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Aug-04 16:27:02 by jfrey:</em> <br/>\n\nIt appears we check for macro HAVE_PTHREAD. globus_config.h defines it only for threaded flavors, and I don't see any other places where it's defined.\n\n<p></p><hr/>\n<em>2011-Aug-04 16:28:36 by jfrey:</em> <br/>\n\nBrian, can you try the patch I've attached to the ticket?\n\n<p></p><hr/>\n<em>2011-Aug-09 10:45:46 by jfrey:</em> <br/>\n\nI have tested Brian's improved patch with both threaded and non-threaded Globus libraries.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3958\" onclick=\"get_ticket_and_populate_wrapper('3958'); return false;\" title=\"nordugrid_gahp consumes 100% CPU\">#3958</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nnordugrid_gahp consumes 100% CPU</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/427/gittrac-2345.patch\">gittrac-2345.patch</a>\n347 bytes added by jfrey on 2011-Aug-04 21:27:48 UTC.\n<br/>\nPatch that introduces a sleep() for threaded builds.<br/>\n</li><li><a href=\"../files/428/gahp_spinloop.patch\">gahp_spinloop.patch</a>\n613 bytes added by bbockelm on 2011-Aug-08 19:45:19 UTC.\n<br/>\nVery sorry, I thought I had already attached this one.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-09 10:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26684\">[26684]</a></span>: Document gahp_server busy loop bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2345\" onclick=\"get_ticket_and_populate_wrapper('2345'); return false;\" title=\"gahp_server consumes 100% CPU\">#2345</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-08 16:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26661\">[26661]</a></span>: Better fix for 100% cpu consumption by gahp_server. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2345\" onclick=\"get_ticket_and_populate_wrapper('2345'); return false;\" title=\"gahp_server consumes 100% CPU\">#2345</a></span> Committer: Jaime Frey  (By Brian Bockelman )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Aug-08 14:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=26657\">[26657]</a></span>: Prevent gahp_server from using 100% when using threaded libraries. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2345\" onclick=\"get_ticket_and_populate_wrapper('2345'); return false;\" title=\"gahp_server consumes 100% CPU\">#2345</a></span> When linking against threaded Globus libraries, globus_poll_blocking() doesn't actually block. Add a sleep(1) to keep main from spinning in a tight loop.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-May-07 15:13", "status": "resolved", "created": "2011-Aug-01 21:57", "fixed_version": "2011-Aug-01 21:57", "broken_version": "", "priority": "2", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu, roy@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": "20110810"}