{"id": 7738, "title": "Ticket #7738: Jobs on hold due to output and error files with permission ugo-rwx", "description": "<blockquote>\nWhen running with a shared filesystem under heavy load it has been repeatedly observed that jobs can end up on hold due to \"Permission denied (errno 13)\" for output and error files. For example,\n\n<p></p><div class=\"code\">\n<pre class=\"code\">[root@ldas-pcdev6 ~]# condor_q -hold\n...\n54612769.0   jelle.urk       7/16 18:44 Error from slot1_16@node2088.cluster.ldas.cit: Failed to open '/home/jelle.urk/Projects/iDQ/NoVeto/observing/3/a/C00/chunk22_1253318003_1254009618_noidq_rerank/logs/gstlal_inspiral_calc_likelihood_inj_06B7-54612769-0.out' as standard output: Permission denied (errno 13)\n\n[root@ldas-pcdev6 ~]# ls -l /home/jelle.urk/Projects/iDQ/NoVeto/observing/3/a/C00/chunk22_1253318003_1254009618_noidq_rerank/logs/gstlal_inspiral_calc_likelihood_inj_06B7-54612769-0.out\n\n---------- 1 jelle.urk jelle.urk 0 Jul 16 11:56 /home/jelle.urk/Projects/iDQ/NoVeto/observing/3/a/C00/chunk22_1253318003_1254009618_noidq_rerank/logs/gstlal_inspiral_calc_likelihood_inj_06B7-54612769-0.out\n</pre></div>\n\n\n<p>One way to reproduce this is by submitting a large number of Vanilla universe jobs that direct output= and error= to an overloaded NFS shared filesystem and run condor_hold after a large number of transition to the Run state. After waiting for \"watch pgrep -c -u XXX condor_shadow\" to drain down to 0 (10's of minutes if NFS really hammered), then remove the abusive load on the NFS server and run condor_release.\n\n</p><p>The code that manages the initial open() for output and error should be audited to make sure it uses O_CREAT with the appropriate mode argument, and not, e.g., open() with some random mode and then call chmod(). Or if every attempt has been made to perform atomic operations for file creation, then it could be considered to create a temporary file name with all the right permissions and then see if rename() is \"more\" atomic.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Jul-21 12:19:28 by anderson:</em> <br/>\n\nThe consensus proposal from the July 21 Condor-LIGO meeting is to add a knob (SUPPORT_BROKEN_NFS_SERVER, or similar) that if True triggers a chmod u+rw on output and error files before opening to append when they already exist.\n\n<p></p><hr/>\n<em>2020-Jul-23 14:42:46 by tim:</em> <br/>\n\nNo documentation for this hack.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-21 14:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/90458718f03d1b33dd11ea0aab8f26ef192a9e14\">[60177]</a></span>: Add LIGO-specific knob LIGO_NFS_SERVER_HACK <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=7738\" onclick=\"get_ticket_and_populate_wrapper('7738'); return false;\" title=\"Jobs on hold due to output and error files with permission ugo-rwx\">#7738</a></span> to work around stdout permissions issues  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "incident", "last_change": "2020-Sep-23 09:37", "status": "resolved", "created": "2020-Jul-16 21:02", "fixed_version": "2020-Jul-16 21:02", "broken_version": "v080809", "priority": "2", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "", "creator": "anderson", "rust": "", "customer_group": "ligo", "visibility": "public", "notify": "pcouvare@caltech.edu", "due_date": ""}