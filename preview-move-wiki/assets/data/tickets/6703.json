{"id": 6703, "title": "Ticket #6703: Use JobPrio to prioritize scheduler universe jobs", "description": "<blockquote>\nWe currently have no way to establish priorities between different scheduler universe jobs. If a user submits 5 different scheduler universe jobs at the same time, but MAX_RUNNING_SCHEDULER_JOBS_PER_OWNER is set to 3, there is no way for that user to prioritize which jobs run first. That user could use condor_qedit or condor_prio to set <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobPrio\" title=\"Job Prio\">JobPrio</a></span> on these jobs, but scheduler universe jobs are run directly from the schedd, which does not pay attention to the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobPrio\" title=\"Job Prio\">JobPrio</a></span> attribute.\n\n<p>To enable scheduler universe job prioritization, we'll need to do at least the following:\n\n</p><p></p><ul>\n<li>Change the way schedd handles scheduler universe jobs, so it runs them in priority order, not in random order\n</li><li>Update the schedd to write an event to the user log every time the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobPrio\" title=\"Job Prio\">JobPrio</a></span> of a schedule universe job is changed\n</li><li><div class=\"strike\">\n<strike>Update DAGMan to read in these \"priority changed\" events, and update the priorities of any remaining jobs accordingly</strike></div>\n\n</li><li><div class=\"strike\">\n<strike>Update DAGMan to use the JobPrio of its condor_dagman parent job as another factor for internal node priority</strike></div>\n\n</li></ul>\n\n<p>A design document is available here: <a class=\"external\" href=\"https://docs.google.com/document/d/1s82rFMOcY-WwrSfM5qN9qMD_V7AaBtVse8KPcbw8Ud0\">https://docs.google.com/document/d/1s82rFMOcY-WwrSfM5qN9qMD_V7AaBtVse8KPcbw8Ud0</a></p></blockquote>", "remarks": "<blockquote>\n<em>2018-Jun-27 14:48:36 by coatsworth:</em> <br/>\n\nI'm chopping anything DAGMan-related out of here, we'll deal with that in a future ticket. There is plenty to worry about here just with the schedd and scheduler universe job priority.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Feb-08 14:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=56156\">[56156]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>) Fix typo in version history  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-15 09:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55984\">[55984]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>) Fixup LaTeX breakage, add ticket number to version history  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-14 15:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55981\">[55981]</a></span>: Added documentation (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Jan-11 14:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55978\">[55978]</a></span>: Removed crufty debug code (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-03 16:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55826\">[55826]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=55313\">[55313]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55314\">[55314]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55315\">[55315]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55326\">[55326]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55327\">[55327]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55328\">[55328]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55335\">[55335]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55336\">[55336]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55337\">[55337]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55344\">[55344]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55345\">[55345]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55346\">[55346]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55348\">[55348]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55349\">[55349]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55361\">[55361]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55362\">[55362]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55369\">[55369]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55370\">[55370]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55371\">[55371]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55373\">[55373]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55376\">[55376]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55377\">[55377]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55378\">[55378]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55388\">[55388]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55389\">[55389]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55392\">[55392]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55414\">[55414]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55415\">[55415]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55416\">[55416]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55420\">[55420]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55421\">[55421]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55422\">[55422]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55423\">[55423]</a></span>,\u00a0[...]\n (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Dec-03 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55825\">[55825]</a></span>: Fixed tests for Windows (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Nov-30 11:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55824\">[55824]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=55713\">[55713]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55714\">[55714]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55715\">[55715]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55719\">[55719]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55720\">[55720]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55723\">[55723]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55725\">[55725]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55736\">[55736]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55745\">[55745]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55747\">[55747]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55751\">[55751]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55752\">[55752]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55770\">[55770]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55771\">[55771]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55772\">[55772]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55779\">[55779]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55780\">[55780]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55781\">[55781]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55786\">[55786]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55797\">[55797]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55805\">[55805]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55806\">[55806]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55812\">[55812]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=55815\">[55815]</a></span>, Merging master and scheduler priority code (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Nov-30 11:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55818\">[55818]</a></span>: Improved testing (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Nov-28 17:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55817\">[55817]</a></span>: Added first successful test (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-30 16:21</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55669\">[55669]</a></span>: Optimized removal of jobs from prio queue (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-30 10:49</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55652\">[55652]</a></span>: Refactored code path to run + start local jobs (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-19 10:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55588\">[55588]</a></span>: Refactored find_idle_local_jobs into start_local_job (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-15 13:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55569\">[55569]</a></span>: Local jobs priority queue now handles changes in priority (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-12 10:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55556\">[55556]</a></span>: Implemented priority ordering in <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LocalJobsPrioQueue\" title=\"Local Jobs Prio Queue\">LocalJobsPrioQueue</a></span> (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-09 14:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55541\">[55541]</a></span>: Minor bug fixes to scheduler universe job removal (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>)  (By Mark Coatsworth )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Oct-09 13:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55539\">[55539]</a></span>: Initial plumbing for scheduler priority (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Feb-11 13:14", "status": "resolved", "created": "2018-Jun-26 16:47", "fixed_version": "2018-Jun-26 16:47", "broken_version": "", "priority": "3", "subsystem": "LocalU", "assigned_to": "coatsworth", "derived_from": "#804", "creator": "coatsworth", "rust": "", "customer_group": "other", "visibility": "public", "notify": "coatsworth@cs.wisc.edu, tannenba@cs.wisc.edu,", "due_date": ""}