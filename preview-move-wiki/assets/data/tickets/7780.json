{"id": 7780, "title": "Ticket #7780: Starter can abort when handling chirp commands waiting for reconnect", "description": "<blockquote>\nA support user reports that then they restart the Schedd, some jobs do not reconnect that they think should.  The sent a log excerpt showing an example.\n\n<p></p><div class=\"verbatim\">\n<pre>2020-07-30T11:16:26 (pid:25456) Lost connection to shadow, waiting 2400 secs for reconnect\n2020-07-30T11:16:59 (pid:25456) condor_write() failed: select() returns -1, writing 624 bytes to .\n2020-07-30T11:16:59 (pid:25456) Buf::write(): condor_write() failed\n2020-07-30T11:16:59 (pid:25456) ERROR \"Assertion ERROR on (result)\" at line 906 in file C:\\condor\\execute\\dir_17432\\sources\\src\\condor_starter.V6.1\\NTsenders.cpp\n2020-07-30T11:16:59 (pid:25456) condor_write() failed: select() returns -1, writing 167 bytes to .\n2020-07-30T11:16:59 (pid:25456) Buf::write(): condor_write() failed\n2020-07-30T11:16:59 (pid:25456) ERROR \"Assertion ERROR on (result)\" at line 906 in file C:\\condor\\execute\\dir_17432\\sources\\src\\condor_starter.V6.1\\NTsenders.cpp\n</pre></div>\n\n\n<p>Line 906 in NTsenders is 'ulog'.  Since the Starter knows that it is waiting for a reconnect, it should not be aborting when it fails to do a ulog RPC.\n\n</p><p>Other potential asserts that we may not want to trigger while waiting for reconnect\n\n</p><p>in REMOTE_CONDOR_register_starter_info\n</p><div class=\"code\">\n<pre class=\"code\">    \"Assertion ERROR on (result)\" at line 69 in file C:\\condor\\execute\\dir_17432\\sources\\src\\condor_starter.V6.1\\NTsenders.cpp</pre></div>\n<div class=\"snip\">\n<pre class=\"sniplabel\">snip </pre>\n<pre class=\"snip\">\tsyscall_sock-&gt;encode();\n\tresult = syscall_sock-&gt;code(CurrentSysCall);\n\tON_ERROR_RETURN( result );\n\tresult = putClassAd(syscall_sock, *ad);\n\tON_ERROR_RETURN( result );</pre></div>\n\n\n<p>in REMOTE_CONDOR_get_job_info\n</p><div class=\"code\">\n<pre class=\"code\">    \"Assertion ERROR on (result)\" at line 162 in file C:\\condor\\execute\\dir_17432\\sources\\src\\condor_starter.V6.1\\NTsenders.cpp</pre></div>\n<div class=\"snip\">\n<pre class=\"sniplabel\">snip </pre>\n<pre class=\"snip\">\tsyscall_sock-&gt;encode();\n\tresult = syscall_sock-&gt;code(CurrentSysCall);\n\tON_ERROR_RETURN( result );\n\tresult = syscall_sock-&gt;end_of_message();\n\tON_ERROR_RETURN( result );</pre></div>\n\n\n<p>in REMOTE_CONDOR_get_job_info\n</p><div class=\"code\">\n<pre class=\"code\">    \"Assertion ERROR on (result)\" at line 167 in file C:\\condor\\execute\\dir_17432\\sources\\src\\condor_starter.V6.1\\NTsenders.cpp</pre></div>\n<div class=\"snip\">\n<pre class=\"sniplabel\">snip </pre>\n<pre class=\"snip\">\tsyscall_sock-&gt;decode();\n\tresult = syscall_sock-&gt;code(rval);\n\tON_ERROR_RETURN( result );</pre></div>\n\n\n<p>in REMOTE_CONDOR_begin_execution\n</p><div class=\"code\">\n<pre class=\"code\">    \"Assertion ERROR on (result)\" at line 385 in file C:\\condor\\execute\\dir_17432\\sources\\src\\condor_starter.V6.1\\NTsenders.cpp</pre></div>\n<div class=\"snip\">\n<pre class=\"sniplabel\">snip </pre>\n<pre class=\"snip\">\tsyscall_sock-&gt;encode();\n\tresult = syscall_sock-&gt;code(CurrentSysCall);\n\tON_ERROR_RETURN( result );</pre></div>\n\n\n<p>in REMOTE_CONDOR_ulog\n</p><div class=\"code\">\n<pre class=\"code\">    \"Assertion ERROR on (syscall_sock-&gt;code(rval))\" at line 986 in file C:\\condor\\execute\\dir_17432\\sources\\src\\condor_starter.V6.1\\NTsenders.cpp</pre></div>\n\n\n<p>Also this, which is probably not fixable.\n\n</p><p></p><pre>    \"Assertion ERROR on (daemonCore)\" at line 4026 in file C:\\condor\\execute\\dir_17432\\sources\\src\\condor_utils\\file_transfer.cpp\n</pre>\n\n<p>{endverbatim}\nThese are from the official condor 8.8.7 release</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2020-Oct-12 10:09", "status": "new", "created": "2020-Aug-04 10:55", "fixed_version": "2020-Aug-04 10:55", "broken_version": "v080000", "priority": "3", "subsystem": "", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "s101165", "customer_group": "support", "visibility": "public", "notify": "", "due_date": ""}