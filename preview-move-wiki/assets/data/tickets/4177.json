{"id": 4177, "title": "Ticket #4177: Add a config knob to take a GPU or other user resource offline", "description": "<blockquote>\nSometimes non-fungible resources (like GPUs) are detected, but are known by the administrator to not work correctly.  There should be a way to set an instance of that resource aside to that it cannot be assigned to a slot during configuration or dynamic slot creation.   the ICECUBE project (and likely others) would like to be able to do this while jobs are running without having to evict all of the jobs, so a solution that does not require restarting the STARTD is preferred.\n\n<p>A new knob <code>OFFLINE_MACHINE_RESOURCE_&lt;tag&gt;</code> will control the list of offline custom resources, so if GPU resources use the GPUs tag like this:\n\n</p><p></p><pre>    MACHINE_RESOURCE_INVENTORY_GPUs=$(LIBEXEC)/condor_gpu_discovery -properties\n    OFFLINE_MACHINE_RESOURCE_GPUs=CUDA2\n</pre>\n\n<p>Where the first line above does GPU detection and will create report a set of resource ids for resource type GPUs.  The second line indicates that if there is a resource of type GPUs with an resource id of CUDA2, that that resource is offline.  This will result in the attribute <code>OfflineGPUs=\"CUDA2\"</code> being reported in all of the slot ads on that startd.</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Feb-26 14:14:45 by johnkn:</em> <br/>\n\ntests still needed for this feature\n\n<p></p><hr/>\n<em>2014-Mar-28 16:16:55 by johnkn:</em> <br/>\n\ndocumentation for new <span class=\"quote\">ClassAd</span> attributes still needed.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Apr-03 14:29</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39854\">[39854]</a></span>: completion of doc for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4177\" onclick=\"get_ticket_and_populate_wrapper('4177'); return false;\" title=\"Add a config knob to take a GPU or other user resource offline\">#4177</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4294\" onclick=\"get_ticket_and_populate_wrapper('4294'); return false;\" title=\"condor_gpu_discovery Die Temperature is mislabled as Fahrenheit\">#4294</a></span>, GPUs and other custom resource's attributes  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-10 14:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39558\">[39558]</a></span>: partial completion and edit of docs for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4177\" onclick=\"get_ticket_and_populate_wrapper('4177'); return false;\" title=\"Add a config knob to take a GPU or other user resource offline\">#4177</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Feb-27 13:28</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39501\">[39501]</a></span>: fix foreach_param regex for MACHINE_RESOURCE_* so that it only matches at start <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4177\" onclick=\"get_ticket_and_populate_wrapper('4177'); return false;\" title=\"Add a config knob to take a GPU or other user resource offline\">#4177</a></span> ===VersionHistory:None=== bug never shipped.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Feb-26 14:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39485\">[39485]</a></span>: documentation and version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4177\" onclick=\"get_ticket_and_populate_wrapper('4177'); return false;\" title=\"Add a config knob to take a GPU or other user resource offline\">#4177</a></span> ===VersionHistory:Complete===  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Feb-26 10:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=39479\">[39479]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=4177\" onclick=\"get_ticket_and_populate_wrapper('4177'); return false;\" title=\"Add a config knob to take a GPU or other user resource offline\">#4177</a></span>) Add OFFLINE_MACHINE_RESOURCE_&lt;tag&gt; knob to take GPUs or other custom resource offline. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Apr-14 10:22", "status": "resolved", "created": "2014-Jan-24 09:55", "fixed_version": "2014-Jan-24 09:55", "broken_version": "v080000", "priority": "2", "subsystem": "DaemonsExecNode", "assigned_to": "johnkn", "derived_from": "#3386", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "johnkn@cs.wisc.edu", "due_date": ""}