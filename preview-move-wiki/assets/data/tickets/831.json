{"id": 831, "title": "Ticket #831: DAGMan can't handle macros in submit file", "description": "<blockquote>\ncondor_submit recognizes macros in the submit file, so I can do something like this in my submit file:\n<div class=\"code\">\n<pre class=\"code\">MYDIR=/home/adesmet/test\ninitialdir=$(MYDIR)\n</pre></div>\n\n\n<p>condor_dagman doesn't recognize or handle macros.  For example, given a submit file called \"submit\" that contains the following:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">universe=vanilla\nMYPATH=/scratch/adesmet/rust/admin-19790/alan-test\ninitialdir = $(MYPATH)\nexecutable = /bin/date\nlog =eraseme.log\nnotification=never\nqueue\n</pre></div>\n\n\n<p>and a DAG file called \"dag\" with the following:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">job A submit\n</pre></div>\n\n\n<p>I can \"condor_submit submit\" and the job will queue up. If I \"condor_submit_dag dag\", condor_dagman will fail.  dag.dagman.out will report:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">10/09 12:30:57 DAGMan::Job:8001:ERROR: Unable to monitor log file for node A|Re\\\nadMultipleUserLogs:9004:Error getting inode in monitorLogFile()|ReadMultipleUse\\\nrLogs:9004:Error initializing log file /scratch/adesmet/rust/admin-19790/minima\\\nl/$(MYPATH)/eraseme.log|MultiLogFiles:9001:Error (2, No such file or directory)\\\n opening file /scratch/adesmet/rust/admin-19790/minimal/$(MYPATH)/eraseme.log f\\\nor creation or truncation\n10/09 12:30:57 Of 1 nodes total:\n10/09 12:30:57  Done     Pre   Queued    Post   Ready   Un-Ready   Failed\n10/09 12:30:57   ===     ===      ===     ===     ===        ===      ===\n10/09 12:30:57     0       0        0       0       0          1        0\n10/09 12:30:57 ERROR: a cycle exists in the DAG\n10/09 12:30:57 ---------------------- Job ----------------------\n10/09 12:30:57       Node Name: A\n10/09 12:30:57          NodeID: 0\n10/09 12:30:57     Node Status: STATUS_ERROR\n10/09 12:30:57 Node return val: -1003\n10/09 12:30:57           Error: Unable to monitor node job log file\n10/09 12:30:57 Job Submit File: submit\n10/09 12:30:57   Condor Job ID: [not yet submitted]\n10/09 12:30:57       Q_PARENTS: &lt;END&gt;\n10/09 12:30:57       Q_WAITING: &lt;END&gt;\n10/09 12:30:57      Q_CHILDREN: &lt;END&gt;\n10/09 12:30:57 ---------------------------------------  &lt;END&gt;\n10/09 12:30:57 Aborting DAG...\n10/09 12:30:57 Writing Rescue DAG to dag.rescue001...\n10/09 12:30:57 Note: 0 total job deferrals because of -MaxJobs limit (0)\n10/09 12:30:57 Note: 0 total job deferrals because of -MaxIdle limit (0)\n10/09 12:30:57 Note: 0 total job deferrals because of node category throttles\n10/09 12:30:57 Note: 0 total PRE script deferrals because of -MaxPre limit (0)\n10/09 12:30:57 Note: 0 total POST script deferrals because of -MaxPost limit (0)\n10/09 12:30:57 **** condor_scheduniv_exec.104.0 (condor_DAGMAN) pid 27083 EXITING WITH STATUS 1\n</pre></div>\n\n\n<p>Expected behavior: Expand macros in the same way condor_submit does.  If that's not feasible, at least detect macros when scanning the submit file and give a better error message.</p></blockquote>", "remarks": "<blockquote>\n<em>2009-Oct-09 12:51:21 by adesmet:</em> <br/>\n\nThat dagman also erroneously reports a cycle is a separate ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=832\" onclick=\"get_ticket_and_populate_wrapper('832'); return false;\" title=\"DAGMan erroneously reports cycle when user log unreadable\">#832</a></span>\n\n<p></p><hr/>\n<em>2009-Oct-09 15:54:55 by psilord:</em> <br/>\n\nActually, the real issue is that you can't have anything other than a real or absolute path for your log file. This is a known issue with dagman.\n<hr/>\n<em>2010-Oct-20 15:59:08 by jfrey:</em> <br/>\n\nBulk change of target version from v070504 to v070505 using ./ticket-target-mover.\n<hr/>\n<em>2011-Jan-27 14:46:04 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 14:49:30 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-07 14:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0dcc8d81d4e91e31a42f1df5bf16ef0d37c430a7\">[31936]</a></span>: Filter check on macros in log file This fixes the following use case. The submit file is executable = /bin/echo mydir = bob initialdir = $(mydir) arguments = $(cluster) output = 0.$(cluster).out log = 0.$(cluster).log error = 0.$(cluster).err universe = vanilla should_transfer_files = yes when_to_transfer_output\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Jan-29 13:55", "status": "resolved", "created": "2009-Oct-09 12:38", "fixed_version": "2009-Oct-09 12:38", "broken_version": "", "priority": "5", "subsystem": "Dag", "assigned_to": "nwp", "derived_from": "", "creator": "adesmet", "rust": "a19790", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}