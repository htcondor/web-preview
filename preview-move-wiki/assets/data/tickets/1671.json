{"id": 1671, "title": "Ticket #1671: Detecting clock skew", "description": "<blockquote>\nA customer has been having problems with clock skew between his machines, especially virtual machines where that can be a problem.  Condor would seem to be a in a good position to detect serious clock skew and potentially alert administrators to the problem.  This might not be built into Condor, but might take the form of an external tool, perhaps doing something as simple as:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">condor_status -master -constraint '((MyCurrentTime-LastHeardFrom) &gt; 60) || ((MyCurrentTime-LastHeardFrom) &lt; -60)'\n</pre></div>\n\n\n<p>Some initial investigation:\n\n</p><p>The most promising existing <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> entries are <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyCurrentTime\" title=\"My Current Time\">MyCurrentTime</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LastHeardFrom\" title=\"Last Heard From\">LastHeardFrom</a></span>.  <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyCurrentTime\" title=\"My Current Time\">MyCurrentTime</a></span> is automatically added to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> on their way to the collector in DaemonCore::publish (<a class=\"file\" href=\"rlog?f=src/condor_daemon_core.V6/daemon_core.cpp\">/src/condor_daemon_core.V6/daemon_core.cpp</a>).   <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LastHeardFrom\" title=\"Last Heard From\">LastHeardFrom</a></span> is automatically added by the collector in CollectorEngine::updateClassAd (<a class=\"file\" href=\"rlog?f=src/condor_collector.V6/collector_engine.cpp\">/src/condor_collector.V6/collector_engine.cpp</a>).\n\n</p><p>Both values are based on time(), which should be relative to the epoch in UTC.  Quick testing confirms this.  As such, <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MyCurrentTime\" title=\"My Current Time\">MyCurrentTime</a></span> and <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LastHeardFrom\" title=\"Last Heard From\">LastHeardFrom</a></span> are appropriate as it.\n\n</p><p>How will the user discover the problem?  The above condor_status report run via crondor and sending email?  Should the collector itself detect the situation and complain?  We have developed systems in the past for monitoring <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> in the collector; is one appropriate here?  This requires further consideration.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Sep-22 16:42:13 by adesmet:</em> <br/>\n\nMy personal opinion is that 1 is too prone to confusing administrators and third party tools, and 3 is too clever for negligible payoff.  2 seems like the best balance of benefits.\n\n<p></p><hr/>\n<em>2010-Sep-22 22:50:19 by matt:</em> <br/>\n\ntime(2) should be independent of timezone\n\n<p></p><hr/>\n<em>2012-Feb-01 11:32:20 by tannenba:</em> <br/>\n\nThis <a class=\"external\" href=\"http://spinningmatt.wordpress.com/2011/06/08/detecting-clock-skew-with-condor/\">blog post</a> is perhaps of interest to anyone looking at this ticket.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2012-Feb-01 11:32", "status": "new", "created": "2010-Sep-22 16:41", "fixed_version": "2010-Sep-22 16:41", "broken_version": "", "priority": "4", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com", "due_date": ""}