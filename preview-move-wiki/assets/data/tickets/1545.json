{"id": 1545, "title": "Ticket #1545: Grid-type amazon can't submit to Eucalyptus", "description": "<blockquote>\nEucalyptus provides an EC2 interface. Thus, Condor-G should be able to interact with it via the amazon grid-type. However, several minor issues prevent this from working.\n\n<p>We're working with Brian Bockelman and others to get Condor to interact with the Magellan cluster at ANL (which uses Eucalyptus).\n\n</p><p><span class=\"subsection\"></span></p><h3>Tasks </h3>\n<ul>\n<li>Make SSL hostname check optional <strong>[DONE]</strong>\n</li><li>Update to newer EC2 WSDL <strong>[DONE]</strong>\n</li><li>Remove assumptions about image and instance names <strong>[DONE]</strong>\n</li><li>Fix SSL token names <strong>[DONE]</strong>\n</li></ul>\n\n<p><span class=\"subsection\"></span></p><h3>GSOAP SSL changes</h3>\n\n<p>The service credential for Magellan is a self-signed host certificate with a hostname of 'localhost'. This causes authentication to fail, as that doesn't match the name used by the amazon_gahp to connect to the server. This appears to be a default setup for Eucalyptus. To make interacting with such systems easier, we're adding a config parameter, SOAP_SSL_SKIP_HOST_CHECK. If set to True, then the amazon_gahp will instruct gsoap to skip the server hostname check. The default is False.\n\n</p><p>Brian Bockelman informs us that one of the security tokens in our soap messages has the wrong value. He suggests changing the call <code>soap_wsse_add_BinarySecurityTokenX509(m_soap, \"<span class=\"quote\">BinarySecurityToken</span>\", m_cert))</code> to <code>soap_wsse_add_BinarySecurityTokenX509(m_soap, \"X509Token\", m_cert))</code>.\n\n</p><p><span class=\"subsection\"></span></p><h3>WSDL Update</h3>\n\n<p>Condor is using an old revision of the EC2 WSDL, dated 2007-08-29. Brian Bockelman found that using that version doesn't work with Eucalyptus, but using the version from 2008-12-01 does. The differences are minor for the portions that Condor uses.\n\n</p><p><span class=\"subsection\"></span></p><h3>Naming Assumptions</h3>\n\n<p>The amazon_gahp checks whether image and instance ids match a particular pattern that Amazon's EC2 service is known to adhere to. Specifically, that image ids start with \"ami-\" and instance ids start with \"i-\". These patterns aren't part of the EC2 specificatoin, and Eucalyptus doesn't follow them. The checks should be removed.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Jul-29 16:25:30 by jfrey:</em> <br/>\n\nPushed fixes to master for 7.5.4.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jul-30 13:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18678\">[18678]</a></span>: Fix syntax error when checking for SOAP_SSL_SKIP_HOST_CHECK <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1545\" onclick=\"get_ticket_and_populate_wrapper('1545'); return false;\" title=\"Grid-type amazon can't submit to Eucalyptus\">#1545</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jul-29 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18670\">[18670]</a></span>: remove name format checks in amazon_gahp <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1545\" onclick=\"get_ticket_and_populate_wrapper('1545'); return false;\" title=\"Grid-type amazon can't submit to Eucalyptus\">#1545</a></span> The amazon_gahp used to check whether image and instance ids match a particular pattern that Amazon's EC2 service is known to adhere to. Specifically, that image ids start with \"ami-\" and instance ids start with \"i-\". These patterns aren't part of the EC2\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jul-29 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18668\">[18668]</a></span>: Add config param SOAP_SSL_SKIP_HOST_CHECK <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1545\" onclick=\"get_ticket_and_populate_wrapper('1545'); return false;\" title=\"Grid-type amazon can't submit to Eucalyptus\">#1545</a></span> Setting this parameter to True causes the amazon_gahp to set the gsoap flag SOAP_SSL_SKIP_HOST_CHECK when connecting to servers. This disables the check for the server's hostname matching that in its certificate. The default is False (don't disable the\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jul-29 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18669\">[18669]</a></span>: Fix gsoap <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=BinarySecurityToken\" title=\"Binary Security Token\">BinarySecurityToken</a></span> value in amazon_gahp <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1545\" onclick=\"get_ticket_and_populate_wrapper('1545'); return false;\" title=\"Grid-type amazon can't submit to Eucalyptus\">#1545</a></span> This change was suggested by Brian Bockelman. It makes Eucalyptus much happier. Amazon's EC2 service does't mind either way.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jul-29 16:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=18667\">[18667]</a></span>: Update EC2 WSDL in amazon_gahp <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1545\" onclick=\"get_ticket_and_populate_wrapper('1545'); return false;\" title=\"Grid-type amazon can't submit to Eucalyptus\">#1545</a></span> The EC2 WSDL we use is too old for Eucalyptus. Updating to the 2008-12-01 version make Eucalyptus much happier. The changes in the data types are minor for the parts we use and don't require any changes to our code (other than acknowledging that new fields exist).\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Aug-19 15:25", "status": "resolved", "created": "2010-Jul-29 15:49", "fixed_version": "2010-Jul-29 15:49", "broken_version": "v070400", "priority": "4", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "", "due_date": ""}