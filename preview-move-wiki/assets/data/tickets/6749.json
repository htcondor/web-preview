{"id": 6749, "title": "Ticket #6749: Check CURB_MATCHMAKING before building RRLs for negotiator", "description": "<blockquote>\nThe CURB_MATCHMAKING expression is a way to have the schedd stop soliciting new resources from the negotiator if it's getting too busy. Before sending each RRL (resource request list) ad to the negotiator, the schedd checks this expression. If it evaluates to True, then the schedd tells the negotiator it has no more jobs to give.\n\n<p>Recently, schedds in CMS's global pool came under heavy load due to, in part, the number of autoclusters growing out of control (one job per autocluster). The CURB_MATCHMAKING expression evaluated to True, but the schedd still built the full set of RRLs it would send before telling the negotiator \"I have no jobs for you\". Building the RRL set in memory took so long that the negotiator timed out waiting for the schedd to respond. CMS has negotiation prefetch enabled, so long waits by the negotiator for multiple affected schedds went in parallel. But it was still a big waste of time for all daemons involved.\n\n</p><p>When the negotiator sends a NEGOTIATE command to the schedd, the schedd should check CURB_MATCHMAKING before building the RRL sets and, if the expression evaluates to True, immediately tell the negotiator that it has no jobs for it.</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-20 13:55</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57708\">[57708]</a></span>: Docs for CURB_MATCHMAKING performance improvement in the schedd. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6749\" onclick=\"get_ticket_and_populate_wrapper('6749'); return false;\" title=\"Check CURB_MATCHMAKING before building RRLs for negotiator\">#6749</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Aug-07 15:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=57627\">[57627]</a></span>: Check shadowsSpawnLimit() before building RRLs for negotiator. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6749\" onclick=\"get_ticket_and_populate_wrapper('6749'); return false;\" title=\"Check CURB_MATCHMAKING before building RRLs for negotiator\">#6749</a></span> Before, shadowsSpawnLimit() was checked after building the RRLs, but before sending them to the negotiator. The building of the RRLs is a waste of time if it returns 0. This checks both the CURB_MATCHMAKING expreession and the schedd's\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-Aug-20 13:55", "status": "resolved", "created": "2018-Aug-29 14:43", "fixed_version": "2018-Aug-29 14:43", "broken_version": "", "priority": "4", "subsystem": "", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}