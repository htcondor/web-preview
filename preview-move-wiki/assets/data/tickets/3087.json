{"id": 3087, "title": "Ticket #3087: DAGMan on NFS problems", "description": "<blockquote>\nMessage on condor-staff:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">Hi,\n\nFor the OSG User school, we wanted the students to work out of NFS. I remembered that DAGMan may not work well when the job log files are on NFS. I talked it over with Todd, and he reminded me that this problem has been addressed because of CREATE_LOCKS_ON_LOCAL_DISK.\n\nhttp://research.cs.wisc.edu/condor/manual/v7.8/3_3Configuration.html#param:NewLocking\n\nRock on! We can use DAGMan when submitting from NFS. This is great, and it worked well for the school.\n\nThree things surprised me. Two are documentation issues (Karen) and one may be a problem with a d default configuration setting:\n\n1. The documentation for CREATE_LOCKS_ON_LOCAL_DISK says:\nWhen True, job user logs and the global job event log are written to a directory named condorLocks\n\nThat's not true, is it? The logs are still written where the user specified them, but the locks for those files are written on local disk, right?\n\n2. The documentation for DAGMan says:\n\nhttp://research.cs.wisc.edu/condor/manual/v7.8/2_10DAGMan_Applications.html#4668\nLog files for node jobs should not be placed on NFS. NFS file locking is not reliable, occasionally resulting in simultaneous acquisition of locks on a single log file by both the condor_schedd daemon and thecondor_dagman job.\n\nBy default, this isn't true anymore, right? At least on Unix, it's only true if someone disables CREATE_LOCKS_ON_LOCAL_DISK. I think this should be clarified\n\n3. The default for DAGMAN_LOG_ON_NFS_IS_ERROR is True which causes errors when I submit from NFS, even if CREATE_LOCKS_ON_LOCAL_DISK is True. This is broken, right? I shouldn't be getting an error if I'm putting locks on local disk, right?\n\n-alain\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2012-Jun-26 16:42:00 by nwp:</em> <br/>\n\nWould a solution be to remove DAGMAN_LOG_ON_NFS_IS_ERROR entirely?\n\n<p></p><hr/>\n<em>2012-Jun-28 22:01:28 by nwp:</em> <br/>\n\nI wrote a patch for this, but I am a bit unclear on what the solution is.\n<ul>\n<li>Is locking on NFS reliable now?  In which case we can remove the check entirely.\n</li><li>Is it reliable only if <code>CREATE_LOCKS_ON_LOCAL_DISK</code> is <code>True</code>?\n</li><li>Is logging on NFS unreliable if <code>ENABLE_USERLOG_LOCKING</code> is set to <code>False</code>?\n</li><li>Is logging on NFS unreliable if <code>ENABLE_USERLOG_LOCKING</code> is set to <code>True</code> and\n<code>CREATE_LOCKS_ON_LOCAL_DISK</code> is <code>False</code>?\n</li></ul>\n\n<p></p><hr/>\n<em>2012-Jul-19 09:08:40 by nwp:</em> <br/>\n\nI am noting here that Kent was working on log-locking code in <span class=\"ticket\"><a class=\"stalled\" href=\"/tickets?ticket=2650\" onclick=\"get_ticket_and_populate_wrapper('2650'); return false;\" title=\"Fix shortcomings of log file locking code\">#2650</a></span>\n\n<p></p><hr/>\n<em>2012-Jul-31 13:46:03 by tannenba:</em> <br/>\n\nI do not see a version history commit for this change, so setting ticket back to docpending status and assigning to Karen.\n<hr/>\n<em>2012-Aug-23 14:11:20 by zmiller:</em> <br/>\n\nBulk change of target version from v070802 to v070803 using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-01 14:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32937\">[32937]</a></span>: add version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3087\" onclick=\"get_ticket_and_populate_wrapper('3087'); return false;\" title=\"DAGMan on NFS problems\">#3087</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-16 10:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32784\">[32784]</a></span>: edits for DAGMan doc updates related to lock files on NFS ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3087\" onclick=\"get_ticket_and_populate_wrapper('3087'); return false;\" title=\"DAGMan on NFS problems\">#3087</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Jul-02 16:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=32570\">[32570]</a></span>: Do not check for NFS <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3087\" onclick=\"get_ticket_and_populate_wrapper('3087'); return false;\" title=\"DAGMan on NFS problems\">#3087</a></span>  (By Nathan W. Panike )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Jan-29 14:13", "status": "resolved", "created": "2012-Jun-26 09:44", "fixed_version": "2012-Jun-26 09:44", "broken_version": "v070800", "priority": "3", "subsystem": "Dag", "assigned_to": "smoler", "derived_from": "", "creator": "nwp", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}