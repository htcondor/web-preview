{"id": 2539, "title": "Ticket #2539: Alter rpath to support multiple Condor installations", "description": "<blockquote>\nNow that we're dynamically linking most of the libraries that Condor uses, we're encountered some situations where the Condor binaries find the wrong version of shared libraries.\n\n<p>Specifically, this can happen when there are multiple installations of Condor on a system, one of which is a native package. Glideins and the BaTLab are two particular instances. In a native package installation, the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> library is installed in /usr/lib[64]. In a non-native installation, /usr/lib[64] appears in the RPATH before the installation's lib directory. Thus, the non-native package Condor binaries can end up using the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> library from the native package installation.\n\n</p><p>Shared library versioning is a partial, but incomplete solution. Setting LD_LIBRARY_PATH isn't a solution, as it doesn't preempt searching of directories in the RPATH. We want to keep /lib and /usr/lib in the RPATH so that it's easy for users to use Condor on a different flavor of linux than it was compiled for, while still getting updated security libraries where available.\n\n</p><p>We propose making two changes to minimize the chance of using the wrong libraries within the constraints above:\n</p><ul>\n<li>Set RUNPATH instead of RPATH in the binaries. This allows LD_LIBRARY_PATH to over-ride the default search path.\n</li><li>Move $ORIGIN/../lib to the front of the RUNPATH. This will cause binaries to prefer the local copy of libclassad, but still prefer the OS copy of normal system libraries (openssl, krb5, etc).</li></ul>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-24 13:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/496b1a2efac0f37b0e26a2463ff876cfa2818ab9\">[27952]</a></span>: edit of 7.7.3 version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2539\" onclick=\"get_ticket_and_populate_wrapper('2539'); return false;\" title=\"Alter rpath to support multiple Condor installations\">#2539</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-11 15:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1854d045184d5349283b00f96006ce6fdd65d6bb\">[27775]</a></span>: Alter RPATH to support multiple Condor installations. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2539\" onclick=\"get_ticket_and_populate_wrapper('2539'); return false;\" title=\"Alter rpath to support multiple Condor installations\">#2539</a></span> When you have multiple Condor installations and at least one of them is a native-package install, the non-native installations can end up using the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> library from the native installation.\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Oct-11 15:09", "status": "resolved", "created": "2011-Oct-11 13:45", "fixed_version": "2011-Oct-11 13:45", "broken_version": "v070702", "priority": "1", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "#1135", "creator": "jfrey", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "", "due_date": "20111012"}