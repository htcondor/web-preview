{"id": 3725, "title": "Ticket #3725: Really fix gathering pid list on mac os x", "description": "<blockquote>\nOn Mac OS X, the sysctl() call is used to gather information for all pids on the system. This call can occasionally fail if the provided buffer is to small to hold the information. Ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3617\" onclick=\"get_ticket_and_populate_wrapper('3617'); return false;\" title=\"Gathering pid list on mac os x and bsd can cause crashes\">#3617</a></span> attempted to fix this by retrying the call several times. Unfortunately, that fix used inaccurate documentation. It assumed sysctl() would return -1 and set errno to ENOMEM when the buffer is too small. Experimentation showed that in this situation, the call returns 0 and sets the oldlenp pointer argument to 0.\n\n<p>We don't know if this same difference in behavior exists on the BSDs.</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Jul-08 16:42:45 by tlmiller:</em> <br/>\n\n<strong class=\"two\">CODE REVIEW</strong>\n\n<p>Looks good.\n\n</p><p>I don't know what the first system call is actually required to do, but because realloc( ptr, 0 ) is free( ptr ), at least on Linux, it wouldn't hurt to assert that bufSize is nonzero after the first system call.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jul-09 14:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=36818\">[36818]</a></span>: Add assert in mac os x proc list function. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3725\" onclick=\"get_ticket_and_populate_wrapper('3725'); return false;\" title=\"Really fix gathering pid list on mac os x\">#3725</a></span> Assert that size passed to realloc() is non-zero, as suggested in code review.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jul-01 17:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=36741\">[36741]</a></span>: Version history for procd exiting on mac fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3725\" onclick=\"get_ticket_and_populate_wrapper('3725'); return false;\" title=\"Really fix gathering pid list on mac os x\">#3725</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Jun-27 10:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=36698\">[36698]</a></span>: Really fix gathering pid list on mac os x. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=3725\" onclick=\"get_ticket_and_populate_wrapper('3725'); return false;\" title=\"Really fix gathering pid list on mac os x\">#3725</a></span> When sysctl() fails on mac os x due to the buffer being too small, retry several times. The previous attempt at this fix assumed that sysctl() returns -1 and sets errno=ENOMEM in this situation (as the man page says). In reality, it returns 0 and sets\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2013-Jul-09 09:55", "status": "resolved", "created": "2013-Jun-27 10:28", "fixed_version": "2013-Jun-27 10:28", "broken_version": "v080000", "priority": "3", "subsystem": "DaemonProcD", "assigned_to": "jfrey", "derived_from": "#3617", "creator": "jfrey", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "", "due_date": ""}