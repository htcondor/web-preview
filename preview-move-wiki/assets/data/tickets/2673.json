{"id": 2673, "title": "Ticket #2673: DAGman should use the \"hold claim\" functionality", "description": "<blockquote>\nWe have the \"hold onto schedd claim\" from <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2094\" onclick=\"get_ticket_and_populate_wrapper('2094'); return false;\" title=\"Schedd should hold onto claims for a short time w/no runnable jobs\">#2094</a></span>.  Let us have DAGman use this functionality by default.</blockquote>", "remarks": "<blockquote>\n<em>2011-Dec-06 16:42:21 by nwp:</em> <br/>\n\nIt looks as though there is a race condition that may cause the test for this functionality to fail sporadically.  Here is what can happen: The job finishes, and the schedd writes the termination in the userlog, before the claim is deactivated.  DAGman sees the termination event and submits a new job before the schedd deactivates the claim.  Then the job goes through a negotiation cycle, losing this optimization.  This is clearly seen in the results of the test, which had the following lines:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">&lt;128.104.103.1:14285&gt;#1322801972#9#3ae3b14ac2459b8879274f82d009bc573be395f8 job_dagman_use_hold_claim-A 30\n&lt;128.104.103.1:14285&gt;#1322801972#10#a997124ab72dfc4a5bf04458ebdaca943a77387f job_dagman_use_hold_claim-B 30\n&lt;128.104.103.1:14285&gt;#1322801972#9#3ae3b14ac2459b8879274f82d009bc573be395f8 job_dagman_use_hold_claim-C KeepClaimIdle undefined\n</pre></div>\n\n\n<p>You see that the claims for A and C are the same, but a different claim was used for B.  This is despite the fact that C is run after B (The jobs are so short that this is possible).</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-29 12:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28947\">[28947]</a></span>: edit and correct documentation of new DAGMAN_HOLD_CLAIM_TIME functionality and its usage by default for DAGMan jobs ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2673\" onclick=\"get_ticket_and_populate_wrapper('2673'); return false;\" title='DAGman should use the \"hold claim\" functionality'>#2673</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-16 11:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28832\">[28832]</a></span>: Be more verbose in job_dagman_use_hold_claim test Let's be more verbose so we can see what is broken. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2673\" onclick=\"get_ticket_and_populate_wrapper('2673'); return false;\" title='DAGman should use the \"hold claim\" functionality'>#2673</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-14 15:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28787\">[28787]</a></span>: Merged <span class=\"chng\"><a href=\"chngview?cn=28545\">[28545]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28549\">[28549]</a></span>, <span class=\"chng\"><a href=\"chngview?cn=28786\">[28786]</a></span>, Merge branch 'V7_7-dagman_hold_claim-branch' GT#2673 Conflicts: doc/version-history/7-7.history.tex  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-14 15:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28786\">[28786]</a></span>: Finish hold-claim for DAGman ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2673\" onclick=\"get_ticket_and_populate_wrapper('2673'); return false;\" title='DAGman should use the \"hold claim\" functionality'>#2673</a></span> ===VersionHistory=== Resolves the following comments from Kent:\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-02 13:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28549\">[28549]</a></span>: Fix small infelicity in the job_dagman_use_hold_claim.run test script ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2673\" onclick=\"get_ticket_and_populate_wrapper('2673'); return false;\" title='DAGman should use the \"hold claim\" functionality'>#2673</a></span>  (By Nathan W. Panike )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Dec-02 11:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=28545\">[28545]</a></span>: Take advantage of claim holding in the schedd for DAGman ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=2673\" onclick=\"get_ticket_and_populate_wrapper('2673'); return false;\" title='DAGman should use the \"hold claim\" functionality'>#2673</a></span> Condor DAGman will hold onto a claim for a short while before releasing it. The default hold time is 20 seconds, but this can be changed in the DAGman configuration file. The change is effected by using the DAGMAN_HOLD_CLAIM_TIME\u00a0[...]\n (By Nathan W. Panike )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Dec-16 11:46", "status": "resolved", "created": "2011-Nov-29 16:37", "fixed_version": "2011-Nov-29 16:37", "broken_version": "", "priority": "3", "subsystem": "Dag", "assigned_to": "nwp", "derived_from": "#2094", "creator": "nwp", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu,tannenba@cs.wisc.edu", "due_date": "20111206"}