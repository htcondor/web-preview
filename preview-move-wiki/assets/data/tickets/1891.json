{"id": 1891, "title": "Ticket #1891: condor_config_val -set/-rset need syntax validation", "description": "<blockquote>\n<div class=\"verbatim\">\n<pre>for i in x y z; do\ncondor_config_val -neg -set '$i_limit' 300\ndone\ncondor_reconfig -negotiator\n\nThis caused the negotiator to exit:\nConfiguration Error Line 0 while reading persistent config\nsource: /opt/condor/persist//.config.NEGOTIATOR.$i_limit\n\nReproduce with -\n\nconfig -\n\nALLOW_CONFIG = *\nSETTABLE_ATTRS_CONFIG = *\nENABLE_PERSISTENT_CONFIG = TRUE\nPERSISTENT_CONFIG_DIR = /tmp\n\ncommand -\n\ncondor_config_val -sched -set '$=1' ; condor_reconfig -sched\n\nAlso reproducible with -rset -\n\nconfig -\n\n(comment 2's and)\nENABLE_RUNTIME_CONFIG = TRUE\n\ncommand -\n\ncondor_config_val -sched -rset '$=1' ; condor_reconfig -sched\n\nSchedLog -\n\nConfiguration Error Line 0 while reading /tmp/cndrtmp8HTtzd, runtime config: $\n\nUsing 7.5.5 source -\n\ncondor_utils/config.cpp's Read_config validates param names with,\n\n /* Check that \"name\" is a legal identifier : only\n    alphanumeric characters and _ allowed*/\n ptr = name;\n while( *ptr ) {\n  char c = *ptr++;\n  if( !ISIDCHAR(c) ) {\n   fprintf( stderr,\n \"Configuration Error File &lt;%s&gt;, Line %d: Illegal Identifier: &lt;%s&gt;\\n\",\n    config_source, ConfigLineNo, name );\n   retval = -1;\n   goto cleanup;\n  }\n }\n\ncondor_daemon_core.V6/daemon_core_main.cpp has a handle_config() function that\nhandles both persistent and runtime configuration changes. It checks to see if\nthe param can be changed, but does not do any other validation. It could.\n\ncondor_tools/config_val.cpp's SetRemoteParam() does an incomplete validation of\nthe param,\n\n  // At this point, in either set or unset mode, param_name\n  // should hold a valid name, so do a final check to make sure\n  // there are no spaces.\n if( (tmp = strchr(param_name, ' ')) ) {\n  fprintf( stderr,\n     \"%s: Error: Configuration variable names cannot contain spaces\\n\",\n     MyName );\n  my_exit( 1 );\n }\n\nTo fix this both Daemon Core and condor_config_val should be changed. DC needs\nto protect itself from bad input, especially from unpatched condor_config_val.\ncondor_config_val needs to be patched to properly validate the param name,\nprimarily to give useful feedback to its user.\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-06 09:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/50cc17aeb8fe44d49173606ea108e95e85214fb4\">[20300]</a></span>: Fixed typo in previous commit, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1891\" onclick=\"get_ticket_and_populate_wrapper('1891'); return false;\" title=\"condor_config_val -set/-rset need syntax validation\">#1891</a></span>  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-06 09:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/45886a157570a714de1da92a4f301c6b0cb87167\">[20299]</a></span>: Fixed up incorrect parsing in param -set/-rset fix, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1891\" onclick=\"get_ticket_and_populate_wrapper('1891'); return false;\" title=\"condor_config_val -set/-rset need syntax validation\">#1891</a></span>  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-03 09:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4912dab3dce3894e5a6788be04ae7801553a416d\">[20235]</a></span>: Fixed DC's persistent and runtime config setting to reject invalid param names, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1891\" onclick=\"get_ticket_and_populate_wrapper('1891'); return false;\" title=\"condor_config_val -set/-rset need syntax validation\">#1891</a></span>  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-03 09:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7f719adf84f2a8bcf76d31b63142eeac310b7a5c\">[20236]</a></span>: Removed extra \\n on EXCEPT for recent config validation, <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1891\" onclick=\"get_ticket_and_populate_wrapper('1891'); return false;\" title=\"condor_config_val -set/-rset need syntax validation\">#1891</a></span>, changes  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-03 09:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/256297ee89f30af14b598ea85e7eac103ac3713f\">[20232]</a></span>: Introduced is_valid_param_name() in condor_config.h, useful for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1891\" onclick=\"get_ticket_and_populate_wrapper('1891'); return false;\" title=\"condor_config_val -set/-rset need syntax validation\">#1891</a></span>  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-03 09:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9afc5c258d384b3c59602894c98ce6a924a35a1c\">[20233]</a></span>: Fixed condor_config_val param name validation, for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1891\" onclick=\"get_ticket_and_populate_wrapper('1891'); return false;\" title=\"condor_config_val -set/-rset need syntax validation\">#1891</a></span>  (By Matthew Farrellee )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Feb-03 09:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/73966bc9e9393ee10f9e3f18f8f0eb56341f47e3\">[20234]</a></span>: Introduced parse_param_name_from_config() in condor_config.h, useful for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=1891\" onclick=\"get_ticket_and_populate_wrapper('1891'); return false;\" title=\"condor_config_val -set/-rset need syntax validation\">#1891</a></span>  (By Matthew Farrellee )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Feb-03 09:15", "status": "resolved", "created": "2011-Feb-03 08:24", "fixed_version": "2011-Feb-03 08:24", "broken_version": "v070000", "priority": "3", "subsystem": "Daemons", "assigned_to": "matt", "derived_from": "", "creator": "matt", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu", "due_date": ""}