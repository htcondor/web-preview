{"id": 3214, "title": "Ticket #3214: No easy way to extract forensic info from User/Event Log", "description": "<blockquote>\nWe are trying to prepare ourself to react to the event of one of our users turning malicious.<br/>\n\nOne of the basic things we would need to determine in such event is where the jobs of such a user have been running.\n\n<p>condor_history is of course not enough, since the job may have started several time due to preemption.\n\n</p><p>We are thus planning to rely on the EventLog.<br/>\n\nSince we have a portal Condor installation, we fully control user submission. So the submit node can be considered un-compromised.\n\n</p><p>The problem now is how to parse the information out of the EventLog.<br/>\n\n</p><div class=\"code\">\n<pre class=\"code\">condor_userlog</pre></div>\n\nseems the natural choice, but lacks two important features:\n<ol>\n<li>No support for -constraint\n</li><li>It only shows the hostname. Since we are a glidein shop, this information is not really useful; we would need to print out other information, like the GLIDEIN_Identity.\n</li></ol>\n\n<p>I thus propose to extend\n</p><div class=\"code\">\n<pre class=\"code\">condor_userlog</pre></div>\n\nto give us the information we need.</blockquote>", "remarks": "<blockquote>\n<em>2014-Jul-28 12:56:08 by bbockelm:</em> <br/>\n\nHi Igor,\n\n<p>Do we still run this patch in production?\n\n</p><p>Brian\n\n</p><p></p><hr/>\n<em>2014-Jul-30 12:18:29 by sfiligoi:</em> <br/>\n\nNot since we upgraded from 8.0.1.\n\n<p>We still have that build, though, in case we would need a forensic investigation at any time.\n\n</p><p></p><hr/>\n<em>2014-Aug-04 14:01:24 by tannenba:</em> <br/>\n\nNote - patch file created against v7.9.0 source code.  I think.\n\n<p></p><hr/>\n<em>2014-Aug-04 15:29:56 by tannenba:</em> <br/>\n\nSo above problem statement says\n<ol>\n<li>This is a portal environment, where job submission is controlled ans trusted, and\n</li><li>Like to know where the jobs of a user have been running, and condor_history is of course not enough, since the job may have started several time due to preemption.\n</li></ol>\n\n<p>So couldn't the job submit file simply use a very large <code>match_list_length</code> or <code>job_machine_attrs_history_length</code> along with condor_history be used?  Not that I have an issue with what the patch does (although patch appears to maybe be implemented using some boost libraries that are not allowed as per HTCondor coding standard...).\n\n</p><p></p><hr/>\n<em>2014-Aug-04 15:35:27 by sfiligoi:</em> <br/>\n\nPerhaps one could add a long match_list_length, but that would significantly increase the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> size. We do not really want to load the Schedd any more than needed.\n\n<p>Plus, one wants to preserve way more than just the machine name, making the cost even higher.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/629/condor_userlog.patch.3214\">condor_userlog.patch.3214</a>\n24693 bytes added by sfiligoi on 2012-Aug-29 22:49:12 UTC.\n<br/>\nSince we had urgent need for such a tool, I went ahead and patched condor_userlog accordingly.\n\n<p>I am attaching the patch (from master) I used.\n\n</p><p>Not claiming it is ready to be put in the official repository. But it does work ;)\n\n</p><p>Anything similar would be welcome.\n<br/>\n</p></li></ul>\n</blockquote></body></html>", "check_ins": "", "type": "enhance", "last_change": "2015-Nov-12 14:53", "status": "new", "created": "2012-Aug-28 16:42", "fixed_version": "2012-Aug-28 16:42", "broken_version": "v070800", "priority": "2", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "", "creator": "sfiligoi", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "isfiligoi@ucsd.edu,johnkn@cs.wisc.edu,tstclair@redhat.com, bbockelm@cse.unl.edu, tannenba@cs.wisc.edu", "due_date": ""}