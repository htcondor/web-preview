{"id": 5036, "title": "Ticket #5036: Make concurrency tests more stable", "description": "<blockquote>\nThe concurrency tests were a callback nightmare and kept breaking periodically on windows.\n\n<p>The decision was made to carefully make these no_wait tests which fork the jobs in Check:SimpleJob. When the testing was all done a call into that module would\nread the forked processes which did the jobs. Care was taken to do things like\nsaving the children pids as the parent after the fork.\n\n</p><p>The initial test(1 of 6) reused much of the existing test but with watch routine which loops until expectations are met or it has exhausted tries it is allowed. Once happy it looks in the negotiator log to see the start of another negotiation cycle to see that another job does not start. The events it expects to see are declared before SimpleJob::RunCheck is called. See ticket test infrastructure changes concerning callbacks and event registration. #xxxx</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Aug-11 08:52:55 by bt:</em> <br/>\n\nThe lastest changes to the concurrency tests removes the non-concurrency configuration and two runs of simple jobs. I am hoping to speed things up and work towards these not going red during active test and build times.\n\n<p>NOTE: These tests are just about the only use of the no_wait option to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=SimpleJob\" title=\"Simple Job\">SimpleJob</a></span>\nand that means these tests are forked and then watched. There is a situation where the simple job timer fires after <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=EndTest\" title=\"End Test\">EndTest</a></span> which should never happen. Obviously timer resets are not working correctly in at least the case of the forked test.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-11 11:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d04493c32329b377e061a64dd954cfa5b4bdb117\">[45560]</a></span>: dd an enaabled function for idlr test tolerence <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=5036\" onclick=\"get_ticket_and_populate_wrapper('5036'); return false;\" title=\"Make concurrency tests more stable\">#5036</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Aug-11 08:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/82eb8dbb9054776080312b6c486da0bc1c0cbbc1\">[45558]</a></span>: We have removed the non-concurrency configuration and testing <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=5036\" onclick=\"get_ticket_and_populate_wrapper('5036'); return false;\" title=\"Make concurrency tests more stable\">#5036</a></span> to speed up this test a bit and hopefully stop its red firing.  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-08 10:24</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/94210c5bff9bc4017eaea20bf6ad26a1c2ff553c\">[45252]</a></span>: Some this was stripping out prints. However the biggest <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=5036\" onclick=\"get_ticket_and_populate_wrapper('5036'); return false;\" title=\"Make concurrency tests more stable\">#5036</a></span> change was a staggering of when the first check was made for each subtest and how soon for the rest. Instead of immediately and then every 10 seconds, we wait 20 seconds and then repeat every 20 seconds.  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-07 14:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/253d7bc2d866e952ce1bc78f543087138c731d82\">[45243]</a></span>: In converting from system to runCondorTool and runToolNTimes <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=5036\" onclick=\"get_ticket_and_populate_wrapper('5036'); return false;\" title=\"Make concurrency tests more stable\">#5036</a></span> in somecases they needed <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CondorTest\" title=\"Condor Test\">CondorTest</a></span>:: before them,  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-07 12:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2463c211eaf4169d00840063dbcfdf594c3ea5f0\">[45235]</a></span>: Had added junk to first line <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=5036\" onclick=\"get_ticket_and_populate_wrapper('5036'); return false;\" title=\"Make concurrency tests more stable\">#5036</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-07 12:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/651c5984d40934d0cdf32ec706178fda30821ee0\">[45233]</a></span>: Place prints in common code for the six concurrency limit tests <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=5036\" onclick=\"get_ticket_and_populate_wrapper('5036'); return false;\" title=\"Make concurrency tests more stable\">#5036</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-12 11:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d6b883732a89e7d349f85e8187399736ef9c9690\">[44820]</a></span>: The other five concurrency which are also no longer callback based. base on changes made in first test. jo0b_concurrency_limtsS.run <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=5036\" onclick=\"get_ticket_and_populate_wrapper('5036'); return false;\" title=\"Make concurrency tests more stable\">#5036</a></span>  (By Bill Taylor )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-May-07 12:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/98647ec24a1aac57c92ce37273f1cd7964b81d4b\">[44801]</a></span>: Template for redo of all concurrency tests <span class=\"ticket\"><a class=\"active\" href=\"/tickets?ticket=5036\" onclick=\"get_ticket_and_populate_wrapper('5036'); return false;\" title=\"Make concurrency tests more stable\">#5036</a></span>  (By Bill Taylor )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2015-Aug-31 16:15", "status": "active", "created": "2015-May-04 12:09", "fixed_version": "2015-May-04 12:09", "broken_version": "", "priority": "4", "subsystem": "Tests", "assigned_to": "bt", "derived_from": "#5247", "creator": "bt", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "johnkn@cs.wisc.edu", "due_date": ""}