{"id": 6679, "title": "Ticket #6679: Add submit from foreach itemdata to python bindings", "description": "<blockquote>\nIt should be possible to use the full range of QUEUE statements when submitting using the python bindings.  In order to do this, it will be necessary to spool the itemdata because from python we cannot necessarily write it into the current working directory as we do now in condor_submit.\n\n<p>The python bindings will be changed as follows\n\n</p><p>The <code>Submit</code> class constructor will accept a string in addition to the current dictionary.  If a string is supplied, it will be parsed as a submit file and will allow a single QUEUE statement with all of the currently supported syntax.\n\n</p><p>When <code>Submit.queue()</code> is called without any arguments other than the transaction, it will use any arguments and itemdata supplied to the <code>Submit</code> constructor.  if a count argument is supplied and it is not the same as the count supplied to the constructor, an error will be thrown.\n\n</p><p>New methods and members will be added to the <code>Submit</code> class to allow the queue arguments to be set and queried, and to allow for the itemdata from the QUEUE statement of the submit file to be iterated.\n\n</p><p></p><pre>    Submit.getQArgs() return the arguments from the QUEUE statement\n    Submit.setQArgs(string) change the arguments for the QUEUE statement\n    Submit.itemdata() iterate the itemdata from the QUEUE statement\n</pre>\n\n<p>A new method will be added to <code>Submit</code> to allow the queue itemdata to be supplied by a python iterator\n\n</p><p></p><pre>    Submit.queue_with_itemdata(txn, count, iter)  submit jobs from iter\n</pre>\n\n<p>When this method is used <strong>count</strong> jobs will be queued for each item returned by <strong>iter</strong>.  The iterator may be any python iterator that returns either strings or dictionaries. If a dictionary is returned, then all dictionaries returned must use the same key names.\n\n</p><p>The iiterator returned by <code>Submit.itemdata()</code> may be used here.  So, for example\n</p><div class=\"snip\">\n<pre class=\"sniplabel\">python submit code fragment</pre>\n<pre class=\"snip\">sub = htcondor.Submit(\"\"\"\n  Executable = /bin/echo\n  QUEUE Args in (Wisconsin Nebraska Texas)\n\"\"\")\n\nwith schedd.transaction() as txn : sub.queue(txn)\n</pre></div>\n\nWill submit 3 jobs, one for each state. while this\n<div class=\"snip\">\n<pre class=\"sniplabel\">alternate submit using itemdata explicitly</pre>\n<pre class=\"snip\">with schedd.transaction() as txn :\n   sub.queue_with_itemdata(txn, 3, iter(sub.itemdata())\n</pre></div>\n\n\n<p>Will queue 9 jobs - 3 for each state</p></blockquote>", "remarks": "<blockquote>\n<em>2018-May-11 15:57:01 by johnkn:</em> <br/>\n\nnote that <span class=\"chng\"><a href=\"chngview?cn=54927\">[54927]</a></span> will do late materialization submit if the Submit object has <code>max_materialize</code> or <code>materialize_max_idle</code> set and the schedd supports late materialization.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6680\" onclick=\"get_ticket_and_populate_wrapper('6680'); return false;\" title=\"late materialization itemdata should be spooled\">#6680</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nlate materialization itemdata should be spooled</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jul-31 09:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55242\">[55242]</a></span>: version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6679\" onclick=\"get_ticket_and_populate_wrapper('6679'); return false;\" title=\"Add submit from foreach itemdata to python bindings\">#6679</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jul-27 11:45</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55228\">[55228]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6679\" onclick=\"get_ticket_and_populate_wrapper('6679'); return false;\" title=\"Add submit from foreach itemdata to python bindings\">#6679</a></span>) Fix up breakage in the manual  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Jul-25 16:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=55218\">[55218]</a></span>: Document additions to the Submit class of the python bindings, including submit_with_itemdata and associated changes. see <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6679\" onclick=\"get_ticket_and_populate_wrapper('6679'); return false;\" title=\"Add submit from foreach itemdata to python bindings\">#6679</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-30 13:37</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54980\">[54980]</a></span>: fix for possible divide by zero in previous commit to <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6679\" onclick=\"get_ticket_and_populate_wrapper('6679'); return false;\" title=\"Add submit from foreach itemdata to python bindings\">#6679</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-11 14:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=54927\">[54927]</a></span>: for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6680\" onclick=\"get_ticket_and_populate_wrapper('6680'); return false;\" title=\"late materialization itemdata should be spooled\">#6680</a></span>, spool the submit itemdata when doing late materialization and for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=6679\" onclick=\"get_ticket_and_populate_wrapper('6679'); return false;\" title=\"Add submit from foreach itemdata to python bindings\">#6679</a></span>, add support for submit with itemdata to the python bindings. ===VersionHistory:Pending===  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-Aug-06 13:35", "status": "resolved", "created": "2018-May-11 14:53", "fixed_version": "2018-May-11 14:53", "broken_version": "", "priority": "3", "subsystem": "Tools", "assigned_to": "johnkn", "derived_from": "", "creator": "johnkn", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}