{"id": 5579, "title": "Ticket #5579: have submit stop sending x509 attrs to schedds that set it themselves", "description": "<blockquote>\nNow that schedds securely set the x509 attributes in the job ad themselves, submit should stop sending them.  This needs to be done in a backward compatible way:\n\n<p>1) New schedds should fail if new tools attempt to update secure attributes.\n\n</p><p>2) New schedds should not allow secure attribute updates from old an submit, but should not treat it as a failure\n\n</p><p>3) New submit should continue to send the attributes to old schedds, but not to new ones.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Apr-22 16:02:33 by zmiller:</em> <br/>\n\nI need to temporarily remove this code in 8.5.4 due to problems in how I implemented <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5064\" onclick=\"get_ticket_and_populate_wrapper('5064'); return false;\" title=\"Set x509 job attributes from authenticated socket\">#5064</a></span>.  To reduce code churn and preserver ownership, rather than revert and recommit it, I'm simply going to comment it out and add a note, and then restore it for 8.5.5.\n\n<p></p><hr/>\n<em>2016-Dec-08 07:25:25 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>:  Looks good.\n\n<p></p><hr/>\n<em>2016-Dec-08 07:26:01 by zmiller:</em> <br/>\n\nNot adding version history since this is a sub-part of <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5064\" onclick=\"get_ticket_and_populate_wrapper('5064'); return false;\" title=\"Set x509 job attributes from authenticated socket\">#5064</a></span>.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Nov-15 16:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49591\">[49591]</a></span>: add knob IGNORE_ATTEMPTS_TO_SET_SECURE_JOB_ATTRS for <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Nov-08 13:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49558\">[49558]</a></span>: Update version check for submitter setting x509 job attributes. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-22 16:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49307\">[49307]</a></span>: Update version checks for client setting x509 job attributes. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-22 15:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49305\">[49305]</a></span>: Revert \"Revert \"c-gahp and job router stop setting x509 attributes with new schedds. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>\"\" This reverts commit 14cc8d1a9ebf9d790dcf88b32adc4af110a29ccc.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-22 15:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49304\">[49304]</a></span>: Revert \"Revert \"Do not dereference a null pointer if client didn't send ver info. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>\"\" This reverts commit a109ba0f2909ead2e93d380298832955629e9be9.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-22 15:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49303\">[49303]</a></span>: Revert \"Revert \"have the schedd tolerate (not fail) old submits attempting to send x509 attrs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>\"\" This reverts commit 6eba24e3b4e3f55767c352fc433918e6838b44ac.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Sep-22 15:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=49302\">[49302]</a></span>: Revert \"Revert \"have condor_submit be intelligent about whether or not to send x509 attrs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>\"\" This reverts commit 72eac9ce73f7f9401a05423caa7bd59fda8b5033.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-May-03 01:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48345\">[48345]</a></span>: Revert \"have condor_submit be intelligent about whether or not to send x509 attrs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>\" This reverts commit 0b0e411bcc0c677efa8f60f3b66cf5932bc793d2.  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-May-03 01:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48344\">[48344]</a></span>: Revert \"have the schedd tolerate (not fail) old submits attempting to send x509 attrs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>\" This reverts commit e97bd53a0d70b78af77d6a29cb6961cd3c68355c.  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-May-03 01:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48343\">[48343]</a></span>: Revert \"Do not dereference a null pointer if client didn't send ver info. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>\" This reverts commit 0ef7514adb04816916e6e01976f42347d66d3d98.  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-May-03 01:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48342\">[48342]</a></span>: Revert \"c-gahp and job router stop setting x509 attributes with new schedds. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>\" This reverts commit ef1239279630510b264bd870b2216c7511ba9ccd.  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Apr-21 14:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48269\">[48269]</a></span>: c-gahp and job router stop setting x509 attributes with new schedds. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span> New schedds set attributes about the proxy themselves and reject client attempts to set them. The c-gahp and job router need to filter these attributes out of the ads they submit when talking to these schedds.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-24 11:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48109\">[48109]</a></span>: Do not dereference a null pointer if client didn't send ver info. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-23 17:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48097\">[48097]</a></span>: have the schedd tolerate (not fail) old submits attempting to send x509 attrs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-23 17:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48096\">[48096]</a></span>: have condor_submit be intelligent about whether or not to send x509 attrs. <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Mar-23 17:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"chngview?cn=48095\">[48095]</a></span>: Add plumbing to get the peer version of the Q_SOCK <span class=\"ticket\"><a class=\"resolved\" href=\"/tickets?ticket=5579\" onclick=\"get_ticket_and_populate_wrapper('5579'); return false;\" title=\"have submit stop sending x509 attrs to schedds that set it themselves\">#5579</a></span>  (By zmiller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Dec-08 07:26", "status": "resolved", "created": "2016-Mar-23 17:45", "fixed_version": "2016-Mar-23 17:45", "broken_version": "v080500", "priority": "2", "subsystem": "Tools", "assigned_to": "zmiller", "derived_from": "#5064", "creator": "zmiller", "rust": "", "customer_group": "cern", "visibility": "public", "notify": "zmiller@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}