<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="HTCondor Homepage">
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How To Auto Retry Elsewhere</title>

    <script src="/web-preview/preview-move-wiki/assets/js/sitewide.js" type="text/javascript" defer></script>
    <script src="/web-preview/preview-move-wiki/assets/js/bootstrap.js" type="text/javascript"></script>
    

    

    <meta name="robots" content="noindex">

    

    <link href="/web-preview/preview-move-wiki/assets/css/style-v1.css" media="screen, tv, projection" title="Default" rel="stylesheet">

</head>
<body class="vh-100 d-flex flex-column">

<!-- For non-visual user agents: -->
<a id="skip-link" href="#main-copy">Skip to main content.</a>

<header id="header">
    <div class="mb-4 container">
        <div class="row">
            <div class="col-12">
                <nav class="navbar navBar navbar-expand-lg navbar-light w-100">
                    <a href="/web-preview/preview-move-wiki/index.html"><img height="75" alt="Condor High Throughput Computing" src="/web-preview/preview-move-wiki/assets/images/CondorTitle.png" style="border:0"></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mb-2 mb-lg-0 ms-auto mt-auto">
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-move-wiki/">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-move-wiki/new">News</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-move-wiki/downloads">Downloads</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-move-wiki/publications">Publications</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="mailto:htcondor-admin@cs.wisc.edu">Contact Us</a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        <div class="row">
            

<script async src="https://cse.google.com/cse.js?cx=1056a9a876b1d1474"></script>
<div class="gcse-searchbox-only"></div>


        </div>
    </div>
</header>
<main id="main-copy" tabindex="-1">
    <div class="container mb-4">
    <h1>How To Auto Retry Elsewhere</h1>
<div id="content">
 Imagine that you knew your job will never run for longer than 20 minutes, and if your job does run for more than 20 minutes, you want to presume something is wrong with the machine. Here is an example of a condor_submit file that tells HTCondor to restart the job on a different machine if the job ran for more than 20 minutes.
 <p>
 </p>
 <div class="code">
  <pre class="code"># Fill in executable and max expected runtime in minutes.
# If the job runs longer than expected, it will go on hold,
# and then will be restarted on a different machine.  After
# three restarts on three different machines, the job will
# stay on hold.
#
executable = foo.exe
expected_runtime_minutes = 20
#
# Should not need to change the below...
#
job_machine_attrs = Machine
job_machine_attrs_history_length = 4
requirements = target.machine =!= MachineAttrMachine1 &amp;&amp; \
   target.machine =!= MachineAttrMachine2 &amp;&amp; \
   target.machine =!= MachineAttrMachine3
periodic_hold = JobStatus == 2 &amp;&amp; \
   time() - EnteredCurrentStatus &gt; 60 * $(expected_runtime_minutes)
periodic_hold_subcode = 1
periodic_release = HoldReasonCode == 3 &amp;&amp; HoldReasonSubCode == 1 &amp;&amp; \
   JobRunCount &lt; 3
periodic_hold_reason = ifthenelse(JobRunCount&lt;3,"Ran too long, will retry","Ran too long")
queue
</pre>
 </div>
 <p>
  Note the technique is to put the job on hold via
  <code>
   periodic_hold
  </code>
  if it runs too long, resulting in the job going to the Held state.  Next the job is released via
  <code>
   periodic_release
  </code>
  , causing the job to go back to Idle and be rescheduled.  The
  <code>
   requirements
  </code>
  expression ensures the job runs on different machine entirely, not just a different slot on the same machine; see
  <span class="wiki">
   <a "AvoidingBlackHoles" title="Avoiding Black Holes">
    AvoidingBlackHoles
   </a>
  </span>
  .
 </p>
 <p>
  Also note that
  <code>
   periodic_release
  </code>
  expression only releases a job that was put on hold for a known cause, which we implement by utilizing the
  <code>
   periodic_hold_subcode
  </code>
  attribute.  After all, we don't want to release a job that was put on hold for a different reason, such as the user running
  <code>
   condor_hold
  </code>
  .  We also set
  <code>
   periodic_hold_reason
  </code>
  to something helpful, so typing
  <code>
   condor_q -hold
  </code>
  displays something informative.
 </p>
 <p>
  Finally, note that we limit the number of times a job goes through the hold/release cycle.
 </p>
 <p>
  All of the mechanisms used in the below submit file are described on
  <a class="external" href="http://research.cs.wisc.edu/htcondor/manual/current/condor_submit.html">
   the condor_submit manual page
  </a>
  .  Also may be useful to browse the
  <a class="external" href="http://research.cs.wisc.edu/htcondor/manual/current/12_Appendix_A.html">
   documented job classad attributes
  </a>
  .
 </p>
</div>

</div>
</main>
<div id="footer" class="border-top mt-auto">
    <div class="container py-4">
        <div class="row">
            <div class="col text-center">
                For comments or questions about this website, please email
                <a href="mailto:htcondor-admin@cs.wisc.edu">htcondor-admin@cs.wisc.edu</a><br />
                This work is supported by <a href="https://www.nsf.gov/div/index.jsp?div=OAC">NSF</a> under Cooperative Agreement <a href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=2030508">OAC-2030508</a> as part of the <a href="https://path-cc.io/">PATh Project</a>. <br />
                <script type="text/javascript">
                    document.write("Updated &raquo; "+lastMod(document.lastModified))
                </script>
            </div>
        </div>
    </div>
</div>



</body>
</html>
