{"id": 6382, "title": "Ticket #6382: Python bindings parse old ClassAds with new ClassAds escaping rules", "description": "<blockquote>\nThe python bindings understand both old and new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> syntax. But when parsing old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> format, they use the string escaping rules from new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. This causes string literals that contain a backslash to be parsed wrong, and some valid string values to result in a parse error.\n\n<p>In the python bindings, the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=OldClassAdIterator\" title=\"Old Class Ad Iterator\">OldClassAdIterator</a></span> class passes each name=value string to classad::ClassAd::Insert(const std::string&amp;), which doesn't know about old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> escaping rules.\n\n</p><p>This can be fixed fairly easily in 8.7 by using <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAdParser\" title=\"Class Ad Parser\">ClassAdParser</a></span> set to old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> mode. In 8.6, we'll need something equivalent to ConvertEscapingOldToNew() from the Condor util lib.\n\n</p><p>This was first reported at <a class=\"external\" href=\"https://ticket.opensciencegrid.org/34573\">https://ticket.opensciencegrid.org/34573</a></p></blockquote>", "remarks": "<blockquote>\n<em>2017-Sep-07 10:36:45 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Nice patch, just some minor comments:\n\n</p><p></p><ol>\n<li>Private helper functions introduced, like ConvertEscapingOldToNew(), should be declared as <code>static</code>.  Fixed this in commit <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5ca241c333d9b99e85603e3ba6a328f9e9658a49\">[52283]</a></span>.\n</li><li>Comment explaining why ConvertEscapingOldToNew() was copied out of the util lib and into the classad python binding would have been nice (ie because the python classad library purposefully avoids linking with libcondorutils), although I guess this is not such a big deal since this code clone is soon to be ripped out in the master branch.\n</li><li>Please create a ticket for re-implementing this patch in the master branch, and make it a child ticket of this one.\n</li></ol>\n\n<p>Resolving.</p></blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6397\" onclick=\"get_ticket_and_populate_wrapper('6397'); return false;\" title=\"Update parsing of old ClassAds strings in python bindings.\">#6397</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nUpdate parsing of old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> strings in python bindings.</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Sep-07 10:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5ca241c333d9b99e85603e3ba6a328f9e9658a49\">[52283]</a></span>: Declare helper function in classad python binding as static. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6382\" onclick=\"get_ticket_and_populate_wrapper('6382'); return false;\" title=\"Python bindings parse old ClassAds with new ClassAds escaping rules\">#6382</a></span>  (By Todd Tannenbaum )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-24 16:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b13b2a484c63aaf621c8fb8fc8276a7d52233a09\">[52176]</a></span>: Docs for old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> string escaping fix in python bindings. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6382\" onclick=\"get_ticket_and_populate_wrapper('6382'); return false;\" title=\"Python bindings parse old ClassAds with new ClassAds escaping rules\">#6382</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Aug-24 16:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dae684bf83b58a4db0cfc95e0881adc3c8008160\">[52175]</a></span>: Convert string escapes with old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> in python bindings. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6382\" onclick=\"get_ticket_and_populate_wrapper('6382'); return false;\" title=\"Python bindings parse old ClassAds with new ClassAds escaping rules\">#6382</a></span> When the python bindings are parsing old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>, they need to convert the string escaping syntax to new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> rules, since the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> library doesn't know how to parse old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Sep-07 10:37", "status": "resolved", "created": "2017-Aug-23 15:09", "fixed_version": "2017-Aug-23 15:09", "broken_version": "", "priority": "3", "subsystem": "PythonBinding", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}