{"id": 6172, "title": "Ticket #6172: daemoncore doesn't set the correct return value when IPVerify fails", "description": "<blockquote>\nIn the case where HTCondor is resuming a session, and it comes from an IP address that is not authorized (or in the <code>DENY</code> list), daemoncore fails to close the connection after IPVerify fails and instead continues on with the command handler.  This has two implications:\n\n<p>1) In the 8.4.X series, and 8.5.0, when using <code>MATCH_PASSWORD</code>, because the security code didn't automatically punch a hole in the authorization rules, this results in a spurious \"PERMISSION DENIED\" error in the logs when in fact it should succeed (and 8.5.1 and later, does so without the message).\n\n</p><p>2) If an administrator adds an IP addres to the <code>DENY_DAEMON</code> or <code>DENY_WRITE</code> list, they need to restart (and not just reconfig) the running daemons.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-Apr-21 14:43:51 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Code patch looks good, but manual needs a version history entry.  No documentation beyond the version history entry is required, however, as this is strictly a bug fix - no new functionality was introduced.\n\n</p><p></p><hr/>\n<em>2017-Apr-21 16:41:46 by tim:</em> <br/>\n\n<strong>DOC REVIEW:</strong> version history looks good.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Apr-21 16:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5da6717f4624cad4cd0f131acb49376dd4e803d2\">[50553]</a></span>: Add version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6172\" onclick=\"get_ticket_and_populate_wrapper('6172'); return false;\" title=\"daemoncore doesn't set the correct return value when IPVerify fails\">#6172</a></span>  (By zmiller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Mar-03 16:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/64241b2a9e7dd575196ed29ae40d3249452806fe\">[50274]</a></span>: Set result correctly and close connection after calling IPVerify() <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6172\" onclick=\"get_ticket_and_populate_wrapper('6172'); return false;\" title=\"daemoncore doesn't set the correct return value when IPVerify fails\">#6172</a></span>  (By zmiller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-Apr-21 16:41", "status": "resolved", "created": "2017-Mar-03 16:08", "fixed_version": "2017-Mar-03 16:08", "broken_version": "v080600", "priority": "2", "subsystem": "Security", "assigned_to": "zmiller", "derived_from": "", "creator": "zmiller", "rust": "", "customer_group": "users", "visibility": "public", "notify": "", "due_date": "20170303"}