{"id": 1089, "title": "Ticket #1089: Revert bad merges into V7_4-branch", "description": "<blockquote>\nThere was a bad rebase that essentially moved V7_4-branch onto master.  This is resolved in <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1091\" onclick=\"get_ticket_and_populate_wrapper('1091'); return false;\" title=\"undo bad rebase of V7_4-branch\">#1091</a></span>.\n\n<p>There was a bad merge of V7_4_1-spurious-spool-elimination into V7_4-branch; despite the name V7_4_1-spurious-spool-elimination is based off of master, not V7_4-branch.  zmiller is investigating.\n\n</p><p>Note that the repository immediately before Alan's recovery work from late December can be found at /p/condor/repository/CONDOR_SRC.git.pre-cream-merge-fix.tar.gz.\n\n</p><p><span class=\"section\"></span></p><h2>Next steps:</h2>\n<ul>\n<li>Are older versions damaged?\n<ul>\n<li>Get an old version (find on cndrutil:tonic/scratch.1/cvs-backup)\n</li><li>Check for damage\n</li></ul>\n</li><li>Can rebasing to the wrong version damage things?\n<ul>\n<li>Get an old version (find on cndrutil:tonic/scratch.1/cvs-backup)\n</li><li>Clone a copy of it.\n</li><li>Try doing bad rebases.  \"git checkout V7_4-branch; git fetch; git rebase origin/master\"\n</li><li>Check for similar damage\n</li></ul>\n</li></ul>\n\n<p><span class=\"section\"></span></p><h2>Possible remediation:</h2>\n\n<p><strong>This is just a wild idea, do not implement</strong>\n</p><ol>\n<li>Fall back to backup.\n</li><li>Collect work since backup as files of patches.\n</li><li>Replay patches onto backup.\n</li></ol>\n<ul>\n<li>How do we cope with local copies?  Can they be repaired?  Unpushed work saved?\n</li></ul>\n\n<p><span class=\"section\"></span></p><h2>Current hypothesis:</h2>\n\n<p>Git went insane.\n\n</p><p>In the pre-recovery CONDOR_SRC.git/logs/refs/heads/V7_4-branch, we have a list of every time the head of V7_4-branch changed.  The first field is the old SHA1 for the tag, the second field the new SHA1 for the tag. Search for the line that begins \"69de35\"; that represents a merge intended for V7_4-branch; things are okay to that point.\n\n</p><p>The next line (begins with \"c49eb9\") jumps to commit 946e17.  This is also intended for V7_4-branch.  <strong>Except</strong>, if you look at these commits in gitk 584e2bb18f4e038066e44b53cddd9945e0b9dbbb (from mattf) and\n80fc0a87a790657756aed97dd3d4bdc852e50081 (from jfrey) were made to V7_4-branch.  They were both intended to merge into master, not here.  The jfrey commit has been confirmed as being correctly done (using .git/logs/HEAD).  The V7_4-branch SHA1 was never set to these, yet there they are in the history between two known good commits.  584e2bb and 80fc0a8 <em>do</em> appear in in the master's head log, as they should.\n\n</p><p>Wild theory: What if I'm working on V7_4-branch, and \"git rebase origin/V7_5-branch\" or similar, then push?\n\n</p><p><span class=\"section\"></span></p><h2>Commits: </h2>\n\n<p></p><ul>\n<li>c49eb913f7c8aee2b9fb97bd63655806ae759c80 represents the last clean V7_4-branch commit\n</li><li>b1fed873e94c5dcecb5ee150daaffa2778f4687c represents master?\n</li><li>584e2bb18f4e038066e44b53cddd9945e0b9dbbb merges those V7_4-branch (c49) into master (b1f).  <em>V7_4-branch follows the merge</em>\n\n<p></p></li><li>7791fb1e59c503626c2c6f3f5403aa90d92e4308\n<ul>\n<li>First commit onto V7_4-branch\n</li></ul>\n\n<p></p></li><li>a62acadb8e59be6a45534827678312ec939186f4\n<ul>\n<li>master branch version string updated from 7.4.0 to 7.5.0\n</li></ul>\n\n<p></p></li><li>1a1a4277a812f9a8564390021bfeb598179bb0ca (Merge branch 'master' of /p/condor/repository/CONDOR_SRC)\n<ul>\n<li>May not be bad. Appears to be spurious merge from upstream master to local master.\n</li><li>wenger 2009-12-16 12:42:21\n</li><li>Parent: 7.3.3 7dec8ba5e7e0fe78b67f1d3455c33fe5c5136334 (Added the job_dagman_script_args test -- this test actually checks)\n</li><li>Parent: 7.5.0 057710a73933d32a615982cf7582aefc7caed128 (Merge branch 'V7_4-branch')\n</li><li>Child:  ce8aebb6e0057f51709b64ce941b2561ea0351d9 (Merge branch 'V7_4-branch')\n</li></ul>\n\n<p></p></li><li>c36ba64711f227570c5d5d06924a558bed85e2af\n<ul>\n<li>wenger  2009-12-16 16:17:16\n</li><li>Parent: 7.5.0 5735e7955389eae12809864e2597dd775b44991f (Added checking of macro substition ($JOB, $RETRY, $JOBID, $RETURN))\n</li><li>Parent: 7.5.0 f991f56595b885bac21c2a6bf36cedc33228bbe1 (Merge branch 'V7_4-branch')\n</li><li>Child: 2f09ea3d872ce919e4b18af9a4889fbacf61cb1d\n</li></ul>\n\n<p></p></li><li>73b0685da3ce537f289395b42905f3b3740815d1\n<ul>\n<li>Labelled as 7.5.0\n</li><li>Why is it in V7_4_1-branch?\n</li><li>Appears to actually be V7_4_1-spurious-spool-elimination\n</li><li>Appears to branch off of master! 98e483712c957215a56921ae27aaea98bf3b79c2 appears to be first member of this branch and its parent 772209abd8455ac9708b7791514a00de28d0aac4 appears to be master.\n</li><li>Merged into master at 8bc49556aa2481243e99b3be446d1b9998b944fc. That's okay.\n</li><li>Merged into V7_4-branch at 49b4156b790831145093ccc284493fc1550af9ba. ?!?! TODO CHECK</li></ul>\n</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2010-Jan-26 11:40:44 by adesmet:</em> <br/>\n\nClosing. My part is done. The older bad merge is in zmiller's hands.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-29 18:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3c7091265b981a5a6e6d4eb1fcb7aba1cb51d455\">[17047]</a></span>: Revert \"Comment out the line which skips the insertion of the param info\" This commit was accidentally merged into 7_4-branch. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1089\" onclick=\"get_ticket_and_populate_wrapper('1089'); return false;\" title=\"Revert bad merges into V7_4-branch\">#1089</a></span> It causes the shadow memory size to be about 200k bigger, so I am reverting it in 7_4-branch. This reverts commit 01cf48be85aee1c32cd9fbbabf92a1e518202979.  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Nov-19 07:11", "status": "resolved", "created": "2010-Jan-05 11:19", "fixed_version": "2010-Jan-05 11:19", "broken_version": "v070402", "priority": "1", "subsystem": "", "assigned_to": "adesmet", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}