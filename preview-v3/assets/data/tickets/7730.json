{"id": 7730, "title": "Ticket #7730: blahp temporary directories include hash character", "description": "<blockquote>\nTo prevent cross-talk between multiple jobs with the same initialdir, the blahp makes a temporary subdirectory for each job, in which the job is run. After the job exits, output files are moved to the initialdir and the temporary directory is removed. To avoid leaking the temporary directory on failure, the gridmanager picks the name of the directory and ensures it's removed after the blahp reports the job is done. To guarantee each job's temporary directory name is unique, the gridmanager uses the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GlobalJobId\" title=\"Global Job Id\">GlobalJobId</a></span> job attribute as part of the value. <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=GlobalJobId\" title=\"Global Job Id\">GlobalJobId</a></span> values include the <code>#</code> character. We have a report on htcondor-users that the <code>#</code> character in a directory name is causing problems for software at one site.\n\n<p>We should fix the gridmanager so that the directory name it gives to the blahp does not include the <code>#</code> character. Additionally, we should consider changing the blahp to allow disabling the creation of a temporary subdirectory. In a CE configuration, each job has its own initial dir, so the subdirectory is unnecessary.\n\n</p><p>As a workaround, the user or admin can put <code>Remote_JobDirectory=Undefined</code> in the job ad. This prevents the gridmanager from dictating the name of the temporary directory to the blahp, which falls back to picking a random name that doesn't contain any problematic characters.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Jul-09 11:05:41 by jfrey:</em> <br/>\n\nThe '@' character can also appear in <code>GlobalJobId</code> and should probably be sanitized.\n\n<p></p><hr/>\n<em>2020-Jul-16 09:18:25 by jfrey:</em> <br/>\n\nI don't plan to include a backwards-compatibility check with this fix. As a result, for jobs in the queue when Condor is upgraded, the gridmanager won't use the current filename when cleaning up a leaked blahp temporary directory. I'm not concerned about this for two reasons.\n\n<p>First, the cleanup in the gridmanager is a backstop for the blahp, which does the removal except in infrequent failure cases.\n\n</p><p>Second, in an HTCondor-CE or BOSCO setup, a leaked directory won't be transferred to the submitter and will be cleaned up with its parent directory when the job is ready to leave the queue.\n\n</p><p></p><hr/>\n<em>2020-Jul-28 10:38:12 by johnkn:</em> <br/>\n\n<strong>CODE_REVIEW</strong> looks good.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-16 09:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/d347a0a7456175a57c1ed4948d75d91904366fa3\">[60143]</a></span>: Docs for blahp temp directory name bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7730\" onclick=\"get_ticket_and_populate_wrapper('7730'); return false;\" title=\"blahp temporary directories include hash character\">#7730</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Jul-16 09:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c48586e9d2b2a21df46843622f0a570eab4f121f\">[60142]</a></span>: Remove special characters from blahp temporary directory name. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7730\" onclick=\"get_ticket_and_populate_wrapper('7730'); return false;\" title=\"blahp temporary directories include hash character\">#7730</a></span> The gridmanager now removes '#' and '@' characters from the name it tells the blahp to use for its temporary directory. These characters were causing problems for some users' software.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2020-Jul-28 10:38", "status": "resolved", "created": "2020-Jul-07 22:04", "fixed_version": "2020-Jul-07 22:04", "broken_version": "", "priority": "3", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "atlas", "visibility": "public", "notify": "", "due_date": ""}