{"id": 7722, "title": "Ticket #7722: NonNegotiated Security Sessions have bad Subsystem attribute", "description": "<blockquote>\nWhen creating a non-negotiated security session, the local process fills in its own subsystem for the <code>Subsystem</code> attribute of the security policy. For a negotiated security session, <code>Subsystem</code> is normally set to the the subsystem of the client in the initial security negotiation. This inconsistency is observable with the family security session when the negotiator connects to the collector to fetch ads. The collector queries its peer's subsystem from the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ReliSock\" title=\"Reli Sock\">ReliSock</a></span> (taken from the security session policy) and gets <code>Collector</code>. It then gives the connection a low priority for responding. If there's no family session, the peer's subsystem is <code>negotiator</code> and the query is given high priority.\n\n<p>Proposed solution: When a client is resuming an existing security session, it should include its subsystem in the request to the server. The server should use that value for the peer's subsystem for the connection.</p></blockquote>", "remarks": "<blockquote>\n<em>2020-Jul-07 10:35:15 by jfrey:</em> <br/>\n\nI thought I could use the session policy ad in the Sock object to store the real subsystem of the client for the connection. But that policy ad is only set when negotiating a new session. When resuming a session, it's left blank.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7729\" onclick=\"get_ticket_and_populate_wrapper('7729'); return false;\" title=\"Negotiator given low priority in collector when using family session\">#7729</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nNegotiator given low priority in collector when using family session</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2020-Jul-07 10:35", "status": "new", "created": "2020-Jul-01 15:45", "fixed_version": "2020-Jul-01 15:45", "broken_version": "", "priority": "3", "subsystem": "Security", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "cms", "visibility": "public", "notify": "", "due_date": ""}