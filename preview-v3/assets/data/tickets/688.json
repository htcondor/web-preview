{"id": 688, "title": "Ticket #688: VM-Gahp should make calls to libvirt instead of using a script", "description": "<blockquote>\nCurrently, the VM Gahp uses a shell script to interact with libvirt, by invoking the virsh program.  This prevents more detailed status and error reporting for VMs and creates some i18n issues.  I have attached a patch that modifies the VM Gahp to make direct libvirt calls instead of invoking the script.</blockquote>", "remarks": "<blockquote>\n<em>2009-Aug-24 11:38:56 by matt:</em> <br/>\n\nQuick skim of this patch reveals -lvirt, libvirt will need to be added as an external. libvirt.a can be built with ./autogen --prefix=/usr --disable-shared ; make, from <a class=\"external\" href=\"http://libvirt.org/sources/\">http://libvirt.org/sources/</a>. The version currently shipping with RHEL is 0.6.2.\n\n<p>Having a libvirt external is something that is already a whole in the old VMu, e.g. to enable Xen/KVM a user must install virsh out of band.\n\n</p><p></p><hr/>\n<em>2009-Aug-25 13:42:45 by jfrey:</em> <br/>\n\nWhen I try to build libvirt 0.6.2, I get this error from configure:\n<div class=\"code\">\n<pre class=\"code\">% ./autogen.sh --prefix=/tmp/libvirt --disable-shared\n...\nchecking for xs_read in -lxenstore... no\nconfigure: error: You must install the Xen development package to compile Xen driver with -lxenstore\n%\n</pre></div>\n\n\n<p></p><hr/>\n<em>2009-Aug-25 13:43:26 by jfrey:</em> <br/>\n\nI get the error above on a CSL x86 RHEL 5 machine.\n\n<p></p><hr/>\n<em>2009-Aug-25 14:59:45 by matt:</em> <br/>\n\n--without-xen should be fine. I was able to build pretty much just libvirt.a (and virsh it turns out) with ./configure --prefix=$PWD/install --disable-shared --without-xen --without-libvirtd --without-remote --without-test --without-uml --without-openvz --without-avahi --without-selinux --without-sasl\n\n<p></p><hr/>\n<em>2009-Sep-14 15:33:45 by jfrey:</em> <br/>\n\nPatch merged into V7_4-branch.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=874\" onclick=\"get_ticket_and_populate_wrapper('874'); return false;\" title=\"Xen support broken with libvirt library\">#874</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nXen support broken with libvirt library</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/85/libvirt_api.patch\">libvirt_api.patch</a>\n27351 bytes added by bkreuter on 2009-Aug-24 14:57:24 UTC.\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Sep-14 15:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/155e8217cf221cfa897783c7f0a54295740394ce\">[15692]</a></span>: vm-gahp now links to libvirt, rather than calling virsh (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=688\" onclick=\"get_ticket_and_populate_wrapper('688'); return false;\" title=\"VM-Gahp should make calls to libvirt instead of using a script\">#688</a></span>) Committer: Jaime Frey  (By Benjamin Kreuter )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Sep-14 15:09</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f4487d06f35584f2a22f396cfb31999e65c230a4\">[15691]</a></span>: Add libvirt external for use by the condor_vm-gahp (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=688\" onclick=\"get_ticket_and_populate_wrapper('688'); return false;\" title=\"VM-Gahp should make calls to libvirt instead of using a script\">#688</a></span>) Also add libxml2 external, needed by libvirt.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2009-Dec-23 12:20", "status": "resolved", "created": "2009-Aug-24 09:56", "fixed_version": "2009-Aug-24 09:56", "broken_version": "v070200", "priority": "2", "subsystem": "VM", "assigned_to": "bkreuter", "derived_from": "", "creator": "bkreuter", "rust": "", "customer_group": "other", "visibility": "public", "notify": "bkreuter@redhat.com, tstclair@redhat.com, matt@cs.wisc.edu, jfrey@cs.wisc.edu", "due_date": ""}