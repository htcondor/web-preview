{"id": 6967, "title": "Ticket #6967: Long DNS queries should trigger a log message", "description": "<blockquote>\nWhen a DNS query takes an unusually long time to complete, we should write a message to the daemon log.\n\n<p>This week, we had someone on htcondor-users report problems running jobs, partly due to 30-second intervals where the daemons weren't doing anything useful. It took a lot of back-and-forth to discover that this was because of long, blocking DNS queries.\n\n</p><p>We're already keeping stats on long DNS queries (with separate buckets for times greater and less than 2 seconds), so adding a dprintf() after a long query would be a simple addition.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-May-07 16:48:31 by gthain:</em> <br/>\n\n<strong>CODE REVIEW</strong>  Can we make the dprintf message jump out a bit more at the admin, something like \"WARNING: DNS query slow, and may impact entire system, getaddr info took %f seconds\".\n\n<p></p><hr/>\n<em>2019-May-15 14:27:21 by jfrey:</em> <br/>\n\nI made the recommended change in the log message text.</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6968\" onclick=\"get_ticket_and_populate_wrapper('6968'); return false;\" title=\"IpVerify initialization shouldn't happen in middle of new connection\">#6968</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\n<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=IpVerify\" title=\"Ip Verify\">IpVerify</a></span> initialization shouldn't happen in middle of new connection</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-15 12:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/90c494f3f8880cf7ccf52fb8e735666782aa456c\">[56888]</a></span>: Docs for logging on slow DNS queries. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6967\" onclick=\"get_ticket_and_populate_wrapper('6967'); return false;\" title=\"Long DNS queries should trigger a log message\">#6967</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-May-15 11:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8b4fa778f31d9141ab9fef4ab63507898e619586\">[56887]</a></span>: Make messages about slow DNS jump out more to admins. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6967\" onclick=\"get_ticket_and_populate_wrapper('6967'); return false;\" title=\"Long DNS queries should trigger a log message\">#6967</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2019-Mar-27 16:44</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b8cdc939e917c28e3e787efd6596814cc8714ed6\">[56454]</a></span>: Long DNS queries trigger a daemon log message. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6967\" onclick=\"get_ticket_and_populate_wrapper('6967'); return false;\" title=\"Long DNS queries should trigger a log message\">#6967</a></span> If getaddrinfo() or getnameinfo() takes longer than 2 seconds to complete, a message is now printed in the log.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2019-May-17 10:44", "status": "resolved", "created": "2019-Mar-27 16:01", "fixed_version": "2019-Mar-27 16:01", "broken_version": "", "priority": "3", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "users", "visibility": "public", "notify": "", "due_date": ""}