{"id": 6252, "title": "Ticket #6252: TIMER_NEVER broken on 32-bit systems", "description": "<blockquote>\nPassing TIMER_NEVER as a period is supposed to result in a timer that fires once and only once, but is not automatically destroyed later (because you know you'll need it again, just not when).\n\n<p><code>condor_timer_manager.h</code> defines TIMER_NEVER as\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\">const unsigned  TIMER_NEVER = 0xffffffff;\n</pre></div>\n\n\n<p>On systems where 'unsigned' is a 32-bit value, that results in all the code in <code>timer_manager.cpp</code> that adds <code>Timer.period</code> to <code>Timer.when</code> overflowing.  (<code>Timer.when</code> is a <code>time_t</code>, which is a 32-bit signed word on 32-bit systems).  Since this causes the timer to sort to the front of the timer list ('when' became a second smaller), it immediately gets called again; this causes an infinite loop.\n\n</p><p>The user-visible effect is, for instance, that condor_annex hangs.</p></blockquote>", "remarks": "<blockquote>\n<em>2017-May-09 16:34:12 by tlmiller:</em> <br/>\n\nAttached a patch to address just the specific issue.  A better patch would check for overflows everywhere, but this one seems to work.\n\n<p></p><hr/>\n<em>2017-May-09 17:15:17 by tannenba:</em> <br/>\n\n<strong>CODE REVIEW</strong>\n\n<p>Perhaps the attached patch is not comprehensive, but it is surgical, fixes the immediate problem, and should not regress anything.\n\n</p><p>Please commit to v8_6-branch, thanks!\n\n</p><p></p><hr/>\n<em>2017-May-14 15:42:30 by tlmiller:</em> <br/>\n\nSince we don't currently build <code>condor_annex</code> on any of the 32-bit platforms we release, and <code>condor_annex</code> was the only externally-visible problem we (or as far as we know, anyone else) had noticed, I'm thinking this doesn't need a version history item.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/985/specific-patch.diff\">specific-patch.diff</a>\n708 bytes added by tlmiller on 2017-May-09 21:33:46 UTC.\n<br/>\nA patch that addresses just the specific issue.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-09 17:27</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cd985238edeabee9b2c624934992ffe1444ea9b4\">[50634]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6252\" onclick=\"get_ticket_and_populate_wrapper('6252'); return false;\" title=\"TIMER_NEVER broken on 32-bit systems\">#6252</a></span>) Check for TIMER_NEVER periods and handle them correctly on 32-bit systems.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-May-09 16:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/27490a7a83d27f5667aa19d442c1fd9ec123b1df\">[50644]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6252\" onclick=\"get_ticket_and_populate_wrapper('6252'); return false;\" title=\"TIMER_NEVER broken on 32-bit systems\">#6252</a></span>) Check for TIMER_NEVER periods and handle them correctly on 32-bit systems.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2017-May-14 15:42", "status": "resolved", "created": "2017-May-09 16:31", "fixed_version": "2017-May-09 16:31", "broken_version": "v080000", "priority": "2", "subsystem": "Libs", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}