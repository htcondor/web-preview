{"id": 5488, "title": "Ticket #5488: master blows assert if old shared port ad in address file", "description": "<blockquote>\n<div class=\"verbatim\">\n<pre>&gt; 01/14/16 16:39:08 ERROR \"Assertion ERROR on (s.hasAddrs())\" at line 1147 in file /slots/03/dir_64906/userdir/src/condor_daemon_core.V6/daemon_core.cpp\n</pre></div>\n\n\n<p>The problem is that the master removes the old shared port address file if and only if the shared port daemon is in the daemon list.  The master adds the shared port daemon to the daemon list if shared port is turned on, but only after this check.  This didn't used to be a problem because the shared port ad was forward-compatible.</p></blockquote>", "remarks": "<blockquote>\n<em>2016-Jan-15 13:31:38 by tlmiller:</em> <br/>\n\nThis also bit Brian Candler, who reported the issue on HTCondor-users (\"Failing to start: Debian 8 (assertion error)\".\n\n<p></p><hr/>\n<em>2016-Jan-15 14:39:54 by tlmiller:</em> <br/>\n\nPatch testing as run ID 353884.\n\n<p></p><hr/>\n<em>2016-Jan-18 13:20:26 by johnkn:</em> <br/>\n\nCODE REVIEW: change looks good, and I merged it into V8_4-branch</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-29 11:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/55ebc72c0f82343004aacc44762a4d05b65accfc\">[47526]</a></span>: Minor version history edits for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5492\" onclick=\"get_ticket_and_populate_wrapper('5492'); return false;\" title=\"collector crashes while sending updates\">#5492</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5488\" onclick=\"get_ticket_and_populate_wrapper('5488'); return false;\" title=\"master blows assert if old shared port ad in address file\">#5488</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5466\" onclick=\"get_ticket_and_populate_wrapper('5466'); return false;\" title=\"Job policy reason strings contain extra junk\">#5466</a></span>  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-19 11:00</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dd2813eeded88101d5868f87c6481323bef5368e\">[47476]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5488\" onclick=\"get_ticket_and_populate_wrapper('5488'); return false;\" title=\"master blows assert if old shared port ad in address file\">#5488</a></span>) Move version history item to correct release. (<strong>sigh</strong>)  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-19 10:47</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/495ca26206ab8e8b07433e54d4a46ad7289eb7a4\">[47474]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5488\" onclick=\"get_ticket_and_populate_wrapper('5488'); return false;\" title=\"master blows assert if old shared port ad in address file\">#5488</a></span>) Version history entry.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Jan-15 14:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/83f3347985f41bd09e8b20f6beee435cf028131f\">[47459]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5488\" onclick=\"get_ticket_and_populate_wrapper('5488'); return false;\" title=\"master blows assert if old shared port ad in address file\">#5488</a></span>) Unconditionally try to remove the old shared port daemon address file. Do NOT except if the ad file isn't defined. Do NOT except if we can't remove the ad file, unless it's actually present.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "incident", "last_change": "2016-Jan-27 09:47", "status": "resolved", "created": "2016-Jan-15 13:25", "fixed_version": "2016-Jan-15 13:25", "broken_version": "v080402", "priority": "4", "subsystem": "DaemonMaster", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}