{"id": 4602, "title": "Ticket #4602: Clean up DAGMan VARS parsing", "description": "<blockquote>\nThere's some code in parse.cpp that allows a line with VARS definitions to come before the corresponding JOB, DATA, or SUBDAG EXTERNAL line.\n\n<p>There are a bunch of things I don't like about this:\n\n</p><p></p><ul>\n<li>The implementation is kind of weird -- it immediately tries to assign the value to a node, and if the node doesn't exist it sticks the VARS line into a special list to re-try after all the rest of the parsing is done.  If we're going to have this capability, why not just stuff all VARS lines into the list immediately, so we don't have two cases?\n\n<p></p></li><li>There isn't any comment in the code explaining what's going on (I'm going to change this soon).\n\n<p></p></li><li>I can't find any reference at all to this change in the version history or any gittrac ticket, so I don't know what the rationale for it was or when it was made.\n\n<p></p></li><li>I'm tempted to remove this code entirely, because I don't see a compelling reason for it, and I don't like that VARS is unlike every other command in this respect.\n\n<p></p></li><li>There doesn't seem to be a test for this functionality.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2016-Aug-04 17:08:35 by wenger:</em> <br/>\n\nHmm -- just disabling the varg stuff in parse_vars() breaks gittrac #1780/\njob_dagman_splice-R.  I think we could restore that functionality by\nparsing the VARS lines <strong>after</strong> we lift splices -- but right now I'm\nreally doubting whether that is worth is.\n\n<p>(Maybe send out an email on htcondor-users to see whether anyone uses\nthe functionality of <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1780\" onclick=\"get_ticket_and_populate_wrapper('1780'); return false;\" title=\"VARS values in top-level DAG should be able to be applied to splices\">#1780</a></span>).\n\n</p><p></p><hr/>\n<em>2016-Sep-20 16:44:01 by wenger:</em> <br/>\n\nActually, now I'm thinking that the ability to do\n\n<p></p><pre>  VARS A+Z dataset=\"5\"\n</pre>\n\n<p>is actually useful, if you re-use a given DAG file with different splice names.  For example:\n\n</p><p></p><pre>  SPLICE A my_splice.dag\n  SPLICE B my_splice.dag\n</pre>\n\n<p></p><hr/>\n<em>2016-Oct-13 14:45:58 by wenger:</em> <br/>\n\nNote:  There's more to do with this after adding ALL_NODES capability -- right now the code re-parses most of the VARS line for every node...</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Aug-05 09:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/13cc099b53790f8bd3afb29cd5eee70920900852\">[48953]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4602\" onclick=\"get_ticket_and_populate_wrapper('4602'); return false;\" title=\"Clean up DAGMan VARS parsing\">#4602</a></span>: Got rid of the VARS queuing code entirely.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Aug-04 17:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dabdb02323a79d32132fb9dc4c073ccbde38f4bb\">[48952]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4602\" onclick=\"get_ticket_and_populate_wrapper('4602'); return false;\" title=\"Clean up DAGMan VARS parsing\">#4602</a></span>: Disabling VARS queuing (essentially undoing gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1780\" onclick=\"get_ticket_and_populate_wrapper('1780'); return false;\" title=\"VARS values in top-level DAG should be able to be applied to splices\">#1780</a></span>), which means that job_dagman_splice-R fails.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2016-Aug-04 17:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/308d49d92ff264edf910417c991109a1a44290ea\">[48951]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4602\" onclick=\"get_ticket_and_populate_wrapper('4602'); return false;\" title=\"Clean up DAGMan VARS parsing\">#4602</a></span>: Disabling VARS queuing (essentially undoing gittrac  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Oct-19 15:45", "status": "resolved", "created": "2014-Sep-18 15:46", "fixed_version": "2014-Sep-18 15:46", "broken_version": "v080202", "priority": "3", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, zmiller@cs.wisc.edu,smoler@cs.wisc.edu", "due_date": ""}