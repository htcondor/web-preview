{"id": 5280, "title": "Ticket #5280: Need to set cgroup hard memory limit for memsw limit to work", "description": "<blockquote>\nIf an admin has set a soft memory limit for a cgroup-enabled slot, then setting the memory + swap limit often fails.  This is because the kernel prohibits setting memory + swap lower than the hard limit, and if we haven't set the hard limit, the default is often infinite.\n\n<p>So, when setting the memory + swap limit, if condor only has a soft limit, we will also set the hard limit to be memory + swap minus one page.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Oct-19 14:16:11 by johnkn:</em> <br/>\n\nCODE_REVIEW: need to protect against having the limit go negative.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-26 08:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ff510e0e27cfc653862987ee352e013a57093021\">[46105]</a></span>: Document <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5280\" onclick=\"get_ticket_and_populate_wrapper('5280'); return false;\" title=\"Need to set cgroup hard memory limit for memsw limit to work\">#5280</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-23 15:57</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/415d2231307bdff93dae130d7983dc69bdfb65bb\">[46093]</a></span>: Changes from code review <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5280\" onclick=\"get_ticket_and_populate_wrapper('5280'); return false;\" title=\"Need to set cgroup hard memory limit for memsw limit to work\">#5280</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Oct-23 15:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bbe21887aa1f60e3beba1f25d9cd24e50e390a33\">[46092]</a></span>: Changes from code review <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5280\" onclick=\"get_ticket_and_populate_wrapper('5280'); return false;\" title=\"Need to set cgroup hard memory limit for memsw limit to work\">#5280</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Sep-25 09:42</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/03b68f276fab1e495978317bf50e864b65d3dcda\">[45890]</a></span>: When setting cgroup memsw limit, also set hard limit if not already set <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5280\" onclick=\"get_ticket_and_populate_wrapper('5280'); return false;\" title=\"Need to set cgroup hard memory limit for memsw limit to work\">#5280</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2015-Oct-26 12:10", "status": "resolved", "created": "2015-Sep-25 09:41", "fixed_version": "2015-Sep-25 09:41", "broken_version": "v080400", "priority": "1", "subsystem": "DaemonsExecNode", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}