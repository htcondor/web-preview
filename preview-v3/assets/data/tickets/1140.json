{"id": 1140, "title": "Ticket #1140: Run old ClassAds tests on compatibility layer", "description": "<blockquote>\nCompile and run the old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> test suite using the new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> compatibility layer. Fix any test failures.\n\n<p><span class=\"section\"></span></p><h2>Milestones </h2>\n<ul>\n<li>Compile test program, fixing unsupported features [DONE]\n</li><li>Run test program and fix any failures [DONE]\n</li><li>Change the Condor test suite to call the new version of the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> test [DONE]</li></ul>\n</blockquote>", "remarks": "<blockquote>\nAfter fixing a bug that crashed the test program, the initial run has 197 of 282 tests passing.\n\n<p></p><hr/>\n<em>2010-Jan-27 09:24:24 by jfrey:</em> <br/>\n\nAll tests now pass (211 of 211). The other tests have been disabled because they test features not supported in new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>.\n\n<p></p><hr/>\n<em>2010-Jan-27 09:25:50 by jfrey:</em> <br/>\n\nThese old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> tests uncovered a few bugs in the compatibility layer and some bugs in new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> themselves.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-27 11:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/21d53df9fa9b2e6100066d6d45d89c00355abd13\">[16993]</a></span>: Add old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> test program to test suite for compat layer. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1140\" onclick=\"get_ticket_and_populate_wrapper('1140'); return false;\" title=\"Run old ClassAds tests on compatibility layer\">#1140</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-27 09:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c24394ade287adf8e3cceaef34a65045ba052299\">[16991]</a></span>: Fix erroneous evaluation errors in some <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> functions. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1140\" onclick=\"get_ticket_and_populate_wrapper('1140'); return false;\" title=\"Run old ClassAds tests on compatibility layer\">#1140</a></span> A few <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> functions would return an evaluation error if the wrong number or type of arguments was given to them. Evaluation should succeed in these cases, with a resulting value of Error.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-27 09:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9776031ac34d321abda754786c115b4d61ae91dc\">[16990]</a></span>: Fix bug in ifThenElse() new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> function <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1140\" onclick=\"get_ticket_and_populate_wrapper('1140'); return false;\" title=\"Run old ClassAds tests on compatibility layer\">#1140</a></span> If the first argument of ifThenElse() evaluated to a real, the code tried (and failed) to treat it as an integer, resulting in an evaluation error.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-27 09:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2ba570dddded1b4aaf1e973119031c2d068ffcaa\">[16989]</a></span>: Allow random() <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> function to take 0 arguments. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1140\" onclick=\"get_ticket_and_populate_wrapper('1140'); return false;\" title=\"Run old ClassAds tests on compatibility layer\">#1140</a></span> According to the documentation, the one argument to the random function is optional. If it's omitted, a default value of 1.0 is to be used. The code made the argument mandatory.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-27 09:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/7d035b0369b2d0bf7dd209374f62480ced32f287\">[16988]</a></span>: Fix bug with negative length argument to strsub() function. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1140\" onclick=\"get_ticket_and_populate_wrapper('1140'); return false;\" title=\"Run old ClassAds tests on compatibility layer\">#1140</a></span> When passing a negative length to the substr() new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> function, if the magnitude of the value is greater than the number of available characters following the starting point of the substring, reset the length to 0. This results in\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-27 09:04</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ae6450b419b7cbf83d043475312e0fe4302953fa\">[16986]</a></span>: Fix or remove some old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> tests for the compat layer. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1140\" onclick=\"get_ticket_and_populate_wrapper('1140'); return false;\" title=\"Run old ClassAds tests on compatibility layer\">#1140</a></span> * Use commas to separate function arguments. * formattime() can take a negative first argument. * Passing an undefined value to substr() results in an Undefined value on return, not an Error. * Operands to &amp;&amp; and || must be booleans. *\u00a0[...]\n (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-26 17:30</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a473325a5d3bfb5d2d22140fe6cf4e8c846c789a\">[16981]</a></span>: Fix up old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> tests for compat layer. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1140\" onclick=\"get_ticket_and_populate_wrapper('1140'); return false;\" title=\"Run old ClassAds tests on compatibility layer\">#1140</a></span> * size(undefined) returns undefined in new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. * stringlist functions aren't supported in new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. * 't' and 'f' aren't synonyms for 'true' and 'false'  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-26 14:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/33a2ac5700a5fe7f59fd4d08e2e658223ad25c16\">[16979]</a></span>: Fix dirty attribute tests for compat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1140\" onclick=\"get_ticket_and_populate_wrapper('1140'); return false;\" title=\"Run old ClassAds tests on compatibility layer\">#1140</a></span> Change ResetName() to ResetExpr().  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-26 14:23</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dda5732a79a36a4d2a0a8f79d12ebc4239112d0e\">[16978]</a></span>: Fix ad syntax in GetReferences() tests for <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> compat layer. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1140\" onclick=\"get_ticket_and_populate_wrapper('1140'); return false;\" title=\"Run old ClassAds tests on compatibility layer\">#1140</a></span> * Function call arguments are separated with a comma now, not a semicolon. * MY. scoping only works when using a <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MatchClassAd\" title=\"Match Class Ad\">MatchClassAd</a></span>.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-26 14:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8b769d5fa29f406afd21424395d4dd7f00ac29a7\">[16977]</a></span>: Fix bug in new ClassAd::GetInternalReferences(). <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1140\" onclick=\"get_ticket_and_populate_wrapper('1140'); return false;\" title=\"Run old ClassAds tests on compatibility layer\">#1140</a></span> In some cases, recursing through the expression tree would erroneously end early when an external reference was encountered.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-26 13:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/05ee2bebc1b7f8354ef8c9f4478f9509c4e51e2d\">[16976]</a></span>: Fix unparsing tests for compat <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1140\" onclick=\"get_ticket_and_populate_wrapper('1140'); return false;\" title=\"Run old ClassAds tests on compatibility layer\">#1140</a></span> * White-space and capitalization are slightly different with new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. * 't' and 'f' aren't synonyms for 'true' and 'false' in new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>. This \"feature\" of old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> will not be emulated.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-26 10:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8b1521080c51ca504d4f285c3cb060fb9ca3b6a2\">[16970]</a></span>: ClassAd::GetMy/TargetTypeName() should never return NULL. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1140\" onclick=\"get_ticket_and_populate_wrapper('1140'); return false;\" title=\"Run old ClassAds tests on compatibility layer\">#1140</a></span> The new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> compatibility layer was mistakenly returning NULL when the attribute wasn't set.  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Jan-26 10:53</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e82b1d8b069bc9c3ec476c620af47eddc7669d08\">[16969]</a></span>: Test compat layer with old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> test program. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1140\" onclick=\"get_ticket_and_populate_wrapper('1140'); return false;\" title=\"Run old ClassAds tests on compatibility layer\">#1140</a></span> This is a version of src/classad.old/test_classads.cpp, modified to work with the new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> compatibility layer. Some features of old <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> are not supported in the commpatibility layer (ones not used by Condor).  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Nov-19 07:10", "status": "resolved", "created": "2010-Jan-26 10:54", "fixed_version": "2010-Jan-26 10:54", "broken_version": "v070500", "priority": "4", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "#1109", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": "20100129"}