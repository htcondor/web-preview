{"id": 1962, "title": "Ticket #1962: win7 net stop condor == hard kill", "description": "<blockquote>\nIn testing we found that net stop condor under windows 7 which used to perform a softkill, hardkills the processes, which can leave errant forked processes on the system.\n\n<p>repro:\nrun some jobs\ntail -f <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MasterLog\" title=\"Master Log\">MasterLog</a></span> in one terminal\nnet stop condor in the other.\nThere are no logs.. Master-Tree goes poof</p></blockquote>", "remarks": "<blockquote>\n<em>2011-Mar-22 15:42:58 by johnkn:</em> <br/>\n\nWhat's actually happening is that <code>net stop condor</code> is crashing inside the service callback for Stop Service.  A simple de-ref of a pointer that <em>may</em> be null is the problem. this is an easy fix.\n\n<p>However, when you stop the master using <code>net stop condor</code> <strong>OR</strong> <code>condor_off -master</code> DaemonCore::Send_Signal is recursing in a way that does not appear to be intentional.   the recursion does stop after going about 7 levels but it is likely that there is still a bug in the way shutdown is handled.\n\n</p><p></p><hr/>\n<em>2011-Mar-23 09:19:23 by tstclair:</em> <br/>\n\nverified fix on 3/23/2011</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Mar-22 15:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e070ec657a5fd921077fdc2c83457e888ea1e4de\">[21116]</a></span>: fix for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1962\" onclick=\"get_ticket_and_populate_wrapper('1962'); return false;\" title=\"win7 net stop condor == hard kill\">#1962</a></span>, net stop condor command is crashing inside the handler for Service Stop. pidinfo is allowed to be NULL in DaemonCore::Send_Signal, but the test for child_session_id did not test pidinfo before using it.  (By John (TJ) Knoeller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Mar-23 09:19", "status": "resolved", "created": "2011-Mar-11 14:18", "fixed_version": "2011-Mar-11 14:18", "broken_version": "v070506", "priority": "2", "subsystem": "Win32", "assigned_to": "johnkn", "derived_from": "", "creator": "tstclair", "rust": "", "customer_group": "users", "visibility": "public", "notify": "tstclair@redhat.com, tannenba@cs.wisc.edu", "due_date": ""}