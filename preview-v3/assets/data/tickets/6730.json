{"id": 6730, "title": "Ticket #6730: DAGMan should coordinate with parent JobPrio", "description": "<blockquote>\nThere is almost no coordination between an active DAGMan instance and the scheduler universe job running it. The only time these ever talk to each other is when running the condor_submit_dag command, with the -Priority flag. For example,\n\n<p><code>condor_submit_dag -Priority 500 file.dag</code>\n\n</p><p>sets an internal DAGMan member variable such that all jobs under file.dag will get submitted with <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobPrio\" title=\"Job Prio\">JobPrio</a></span> = 500. It does not, however, set the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobPrio\" title=\"Job Prio\">JobPrio</a></span> of the scheduler universe job itself. Moreover, if we ever run condor_prio on the scheduler universe job running DAGMan, the change in priority does not trickle down into the nodes/jobs running under the DAG.\n\n</p><p>We want to make the following changes:\n\n</p><p></p><ul>\n<li>When calling condor_submit_dag -Priority N file.dag, we want to submit the scheduler universe job with priority = N\n\n<p></p></li><li>When calling condor_prio or condor_qedit on the scheduler universe job, we want to communicate that change to DAGMan, and update all unsubmitted jobs with the difference in priority. The schedd should write events to the user log to communicate the change.\n</li></ul>\n\n<p>To fully enable this functionality we need to do some additional work in the schedd to submit scheduler universe jobs in order of <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobPrio\" title=\"Job Prio\">JobPrio</a></span>. This is covered in  <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6703\" onclick=\"get_ticket_and_populate_wrapper('6703'); return false;\" title=\"Use JobPrio to prioritize scheduler universe jobs\">#6703</a></span>.\n\n</p><p>A design document is available here: <a class=\"external\" href=\"https://docs.google.com/document/d/1m6RG2Up2IqCT4Y2fKQYGD0KoPFSWqgIFgghi4WVouPE\">https://docs.google.com/document/d/1m6RG2Up2IqCT4Y2fKQYGD0KoPFSWqgIFgghi4WVouPE</a></p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Aug-02 15:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/176eb21c57cd46b9cc45ad02a209e3032306871e\">[55253]</a></span>: condor_submit_dag now outputs priority to .condor.sub file (<span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=6730\" onclick=\"get_ticket_and_populate_wrapper('6730'); return false;\" title=\"DAGMan should coordinate with parent JobPrio\">#6730</a></span>)  (By Mark Coatsworth )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2018-Aug-01 17:20", "status": "new", "created": "2018-Aug-01 17:18", "fixed_version": "2018-Aug-01 17:18", "broken_version": "", "priority": "3", "subsystem": "Dag", "assigned_to": "coatsworth", "derived_from": "", "creator": "coatsworth", "rust": "", "customer_group": "other", "visibility": "public", "notify": "coatsworth@cs.wisc.edu, tannenba@cs.wisc.edu", "due_date": ""}