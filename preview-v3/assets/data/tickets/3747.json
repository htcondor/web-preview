{"id": 3747, "title": "Ticket #3747: DMTCP checkpoints can't handle being moved", "description": "<blockquote>\nThe problem appears to be that when DMTCP restarts after a checkpoint, the next time it checkpoints it really want to write a checkpoint file (ckpt_BINNAME_CLUSTER_PROC_HEX-PID-HEX.dmtcp) into the old checkpoint location.  Other files involved in the checkpoint are written the new directory.\n\n<p>If you're on a single computer, running as yourself, this works fine as you probably didn't move the directory.  It even works if you move the directory because DMTCP will helpfully re-create the directory if necessary.\n\n</p><p>But under HTCondor running as another user (the usual \"run as root/condor\" configuration), you're doomed, because your job runs in a directory named $EXECUTE/dir_$PID, which (usually) changes when your job restarts.  DMTCP will try to recreate the directory, but assuming a typical configuration will be blocked by permissions.  DMTCP will exit with 99.\n\n</p><p>DMTCP is supposed to handle changed directories through the DMTCP_RESTART_DIR environment variable or the --restartdir/-d option to dmtcp_restart_script.sh.\n\n</p><p>I tracked this down with DMTCP 1.2.6.  The current release is 1.2.7.  (I moved back earlier trying to see if there was a regression.)\n\n</p><p>Reported to the DMTCP developers on June 11, 2013.  They replied hoping the head of SVN was fixed, but we needed to use the --ckptdir option or the DMTCP_CHECKPOINT_DIR environment variable set to ./\n\n</p><p>Testing...\n\n</p><p>Possible fix/workaround: <span class=\"ticket\"><a class=\"new\" href=\"/wiki-archive/tickets/?ticket=3749\" onclick=\"get_ticket_and_populate_wrapper('3749'); return false;\" title=\"Use filesystem namespaces to present non-changing execute directory\">#3749</a></span>: Use filesystem namespaces to present non-changing execute directory</p></blockquote>", "remarks": "<blockquote>\n<em>2013-Jul-11 15:33:12 by adesmet:</em> <br/>\n\nHead of DMTCP's 1.2 branch appears to work, although a new shim_dmtcp is required.  Packaging...\n\n<p></p><hr/>\n<em>2013-Jul-11 17:11:39 by adesmet:</em> <br/>\n\ndmtcp_condor_integration updated to 0.6.  Confirmed to work under HTCondor even when moving between hosts.  It can be downloaded from <span class=\"wiki\"><a href=\"wiki?p=DmtcpCondor\" title=\"Dmtcp Condor\">DmtcpCondor</a></span>.  This release requires the as-yet unreleased DMTCP 1.2.8; you'll need to get it from DMTCP's version control; probably using this command:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">svn checkout svn://svn.code.sf.net/p/dmtcp/code/branches/1.2 dmtcp-1.2</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "defect", "last_change": "2013-Nov-22 14:09", "status": "new", "created": "2013-Jul-09 14:44", "fixed_version": "2013-Jul-09 14:44", "broken_version": "", "priority": "4", "subsystem": "", "assigned_to": "", "derived_from": "", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}