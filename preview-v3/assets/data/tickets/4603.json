{"id": 4603, "title": "Ticket #4603: DAEMON_SOCKET_DIR=auto breaks partial use of shared port", "description": "<blockquote>\nThe new DAEMON_SOCKET_DIR=auto setting breaks configurations where shared port is used by children of the master, but not the master itself. Each child daemon ends up with a different CONDOR_PRIVATE_SHARED_PORT_COOKIE value, meaning the shared port daemon uses the wrong name for the daemon's abstract socket and can't connect.</blockquote>", "remarks": "<blockquote>\n<em>2014-Sep-18 16:38:32 by jfrey:</em> <br/>\n\nHaving a set of daemons where only some use shared port is inadvisable. It messes up how the master creates a command port to be inherited by a child daemon.\n\n<p></p><hr/>\n<em>2014-Nov-18 14:47:52 by jfrey:</em> <br/>\n\nIf USE_SHARED_PORT=False for the master, it shouldn't set CONDOR_PRIVATE_SHARED_PORT_COOKIE in environment of any child daemons. If they're configured to use shared port, they can fall back to using the daemon socket directory. This provides the same behavior as 8.2.x.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Dec-22 18:48</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/de84a4ee7e201e92b5a7d98322945d9d6e37754e\">[42020]</a></span>: Edit existing 8.3.2 version history items for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4603\" onclick=\"get_ticket_and_populate_wrapper('4603'); return false;\" title=\"DAEMON_SOCKET_DIR=auto breaks partial use of shared port\">#4603</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4657\" onclick=\"get_ticket_and_populate_wrapper('4657'); return false;\" title=\"Support EC2 block-device mapping.\">#4657</a></span>, and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4660\" onclick=\"get_ticket_and_populate_wrapper('4660'); return false;\" title=\"Add sub-second accurate timestamps to dprintf logs\">#4660</a></span>. Add new version history items for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=374\" onclick=\"get_ticket_and_populate_wrapper('374'); return false;\" title=\"dlopen Kerberos\">#374</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4735\" onclick=\"get_ticket_and_populate_wrapper('4735'); return false;\" title=\"Speed up V3 query protocol\">#4735</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4594\" onclick=\"get_ticket_and_populate_wrapper('4594'); return false;\" title=\"Fix time-slicing for ClassAd iterator\">#4594</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4491\" onclick=\"get_ticket_and_populate_wrapper('4491'); return false;\" title=\"Scalable claim keepalive protocol\">#4491</a></span>, and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4585\" onclick=\"get_ticket_and_populate_wrapper('4585'); return false;\" title=\"Detect SO version of libraries we dlopen() at compile time\">#4585</a></span>.  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-18 15:14</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4cff61476de22a29a8f9500196c1b2903359171a\">[41668]</a></span>: Fix partial use of shared port with DAEMON_SOCKET_DIR=auto. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4603\" onclick=\"get_ticket_and_populate_wrapper('4603'); return false;\" title=\"DAEMON_SOCKET_DIR=auto breaks partial use of shared port\">#4603</a></span> The new DAEMON_SOCKET_DIR=auto setting broke setups where the master doesn't use shared port but some of the other daemons do. Each daemon received a different CONDOR_PRIVATE_SHARED_PORT_COOKIE value, so the shared port daemon couldn't\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Nov-19 16:39", "status": "resolved", "created": "2014-Sep-18 16:03", "fixed_version": "2014-Sep-18 16:03", "broken_version": "v080301", "priority": "3", "subsystem": "DaemonSharedP", "assigned_to": "jfrey", "derived_from": "#4465", "creator": "jfrey", "rust": "s8481", "customer_group": "cms", "visibility": "public", "notify": "tannenba@cs.wisc.edu, jfrey@cs.wisc.edu, bbockelm@cse.unl.edu", "due_date": ""}