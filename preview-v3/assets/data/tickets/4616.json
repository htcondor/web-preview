{"id": 4616, "title": "Ticket #4616: DAGMan parse code doesn't always check for strtok() returning NULL", "description": "<blockquote>\nCoverity complained about it here, but there are other places, too (in parse.cpp);\n\n<p></p><pre>  -423static bool\n \u00a0-424parse_subdag(\u00a0Dag\u00a0*dag,\u00a0Job::job_type_t\u00a0nodeType,\n \u00a0-425\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0const\u00a0char*\u00a0nodeTypeKeyword,\n \u00a0-426\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0const\u00a0char*\u00a0dagFile,\u00a0int\u00a0lineNum,\n    const\u00a0char\u00a0*directory\u00a0)\n \u00a0-427{\n  CID 10533: Dereference null return value (NULL_RETURNS)Function \"strtok\"\n  returns null (checked 60 out of 75 times).\n  Assigning: \"inlineOrExt\" = null return value from \"strtok\".\n \u00a0-428\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0const\u00a0char\u00a0*inlineOrExt\u00a0=\u00a0strtok(\u00a0NULL,\u00a0DELIMITERS\u00a0);\n  Dereferencing a pointer that might be null \"inlineOrExt\" when calling\n  \"strcasecmp\". (The dereference is assumed on the basis of the 'nonnull'\n  parameter attribute.)\n \u00a0-429\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if\u00a0(\u00a0!strcasecmp(\u00a0inlineOrExt,\u00a0\"EXTERNAL\"\u00a0)\u00a0)\u00a0{\n  -430\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return\u00a0parse_node(\u00a0dag,\u00a0nodeType,\u00a0nodeTypeKeyword,\n\u00a0   dagFile,\n \u00a0-431\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lineNum,\u00a0directory,\n    \"\u00a0EXTERNAL\",\u00a0\"dagfile\"\u00a0);\n \u00a0-432\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n \u00a0-433\n \u00a0-434\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0debug_printf(\u00a0DEBUG_QUIET,\u00a0\"ERROR:\u00a0%s\u00a0(line\u00a0%d):\u00a0only\u00a0SUBDAG\u00a0\"\n \u00a0-435\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"EXTERNAL\u00a0is\u00a0supported\u00a0at\u00a0this\u00a0time\\n\",\n \u00a0  dagFile,\u00a0lineNum);\n \u00a0-436\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return\u00a0false;\n \u00a0-437}\n \u00a0-438\n</pre>\n\n<p>(Note: dashes in front of line numbers are needed to get gittrac formatting to work.)</p></blockquote>", "remarks": "<blockquote>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Nov-18 14:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b0df3aaf402d0be1142c031e773b70d20c819904\">[41670]</a></span>: edit 8.3.2 version history item <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4616\" onclick=\"get_ticket_and_populate_wrapper('4616'); return false;\" title=\"DAGMan parse code doesn't always check for strtok() returning NULL\">#4616</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-24 13:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e12f15703415eb04d1ef6129de49a6e37c20c625\">[41453]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4616\" onclick=\"get_ticket_and_populate_wrapper('4616'); return false;\" title=\"DAGMan parse code doesn't always check for strtok() returning NULL\">#4616</a></span>: Fixed this and documented the fix in the version history. Committer: Todd L Miller  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Oct-07 16:12</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/eb8266cc9a8ac4e3814324a2c172486fab6bcf16\">[41333]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4616\" onclick=\"get_ticket_and_populate_wrapper('4616'); return false;\" title=\"DAGMan parse code doesn't always check for strtok() returning NULL\">#4616</a></span>: Fixed this and documented the fix in the version history.  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Oct-08 09:29", "status": "resolved", "created": "2014-Sep-26 12:08", "fixed_version": "2014-Sep-26 12:08", "broken_version": "v080200", "priority": "2", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, zmiller@cs.wisc.edu", "due_date": ""}