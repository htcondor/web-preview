{"id": 6612, "title": "Ticket #6612: condor_submit fails on docker universe jobs without an executable line", "description": "<blockquote>\nDocker universe jobs can leave the executable= line blank in the condor submit file, if there is a CMD specified in the dockerfile.  The switch to submit_utils broke this functionality.</blockquote>", "remarks": "<blockquote>\n<strong>CODE_REVIEW</strong> : I have reverted the fix. its wrong to skip calling the check function in this case, we should never even get there.  I'm also not sure this is even a real stable branch bug because stable branch doesn't use submit_utils.\n\n<p>this is only a bug in the devel branch.  the proper fix is in submit.cpp.  in check_sub_file, change\n</p><div class=\"snip\">\n<pre class=\"sniplabel\">old code</pre>\n<pre class=\"snip\">\tif (pathname == NULL) {\n\t\tfprintf(stderr, \"\\nERROR: NULL filename\\n\");\n\t\treturn 1;\n\t}\n</pre></div>\n\nto\n<div class=\"snip\">\n<pre class=\"sniplabel\">new code</pre>\n<pre class=\"snip\">\tif (pathname == NULL &amp;&amp; role != SFR_PSEUDO_EXECUTABLE) {\n\t\tfprintf(stderr, \"\\nERROR: NULL filename\\n\");\n\t\treturn 1;\n\t}\n</pre></div>\n\n\n<p>and change this\n\n</p><p></p><div class=\"snip\">\n<pre class=\"sniplabel\">old code</pre>\n<pre class=\"snip\">\t} else if (role == SFR_EXECUTABLE || role == SFR_PSEUDO_EXECUTABLE) {\n\n\t\tconst char * ename = pathname;\n\t\tbool transfer_it = (flags &amp; 1) != 0;\n</pre></div>\n\nto\n<div class=\"snip\">\n<pre class=\"sniplabel\">old code</pre>\n<pre class=\"snip\">\t} else if (role == SFR_EXECUTABLE || role == SFR_PSEUDO_EXECUTABLE) {\n\n\t\tconst char * ename = pathname;\n\t\tbool transfer_it = (ename != NULL) &amp;&amp; ((flags &amp; 1) != 0);\n</pre></div>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-10 16:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6895f438c0a5bf209081bd4f4f9fc147f94dc04e\">[54911]</a></span>: Version history for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6612\" onclick=\"get_ticket_and_populate_wrapper('6612'); return false;\" title=\"condor_submit fails on docker universe jobs without an executable line\">#6612</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6619\" onclick=\"get_ticket_and_populate_wrapper('6619'); return false;\" title=\"Add support for schedd query options in Python bindings\">#6619</a></span>, <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6648\" onclick=\"get_ticket_and_populate_wrapper('6648'); return false;\" title=\"Remove gsoap from HTCondor\">#6648</a></span>  (By Tim Theisen )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-04 16:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fed1a9ab09be6ec0c0c08081637a4e74517daefb\">[54854]</a></span>: Re-allow docker universe jobs to have no executable entry <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6612\" onclick=\"get_ticket_and_populate_wrapper('6612'); return false;\" title=\"condor_submit fails on docker universe jobs without an executable line\">#6612</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-May-04 13:10</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3060fdfc2a0082e3622c22744d7fff26ba17f17c\">[54847]</a></span>: fix is wrong and probably not even needed. Revert \"Allow docker universe jobs to have empty executable lines <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6612\" onclick=\"get_ticket_and_populate_wrapper('6612'); return false;\" title=\"condor_submit fails on docker universe jobs without an executable line\">#6612</a></span>\" This reverts commit 9f5313fe4fbf46347a874e7caa44a7de3b1b0c89.  (By John (TJ) Knoeller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Apr-17 11:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/59a354b794ee51cb22c4f8c786667fee51bea88b\">[54745]</a></span>: Documnet <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6612\" onclick=\"get_ticket_and_populate_wrapper('6612'); return false;\" title=\"condor_submit fails on docker universe jobs without an executable line\">#6612</a></span>  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2018-Mar-19 14:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/9f5313fe4fbf46347a874e7caa44a7de3b1b0c89\">[54532]</a></span>: Allow docker universe jobs to have empty executable lines <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6612\" onclick=\"get_ticket_and_populate_wrapper('6612'); return false;\" title=\"condor_submit fails on docker universe jobs without an executable line\">#6612</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2018-May-09 13:57", "status": "resolved", "created": "2018-Mar-19 14:06", "fixed_version": "2018-Mar-19 14:06", "broken_version": "v080700", "priority": "2", "subsystem": "", "assigned_to": "gthain", "derived_from": "", "creator": "gthain", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}