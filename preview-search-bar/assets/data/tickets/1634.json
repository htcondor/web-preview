{"id": 1634, "title": "Ticket #1634: unexplained mass invalidation of ads in collector", "description": "<blockquote>\nThe UCSD glidein collector got into a state where many ads were getting invalidated within a few seconds to minutes after being inserted.  The stated reason in the collector log is that the ad was stale, but it could be because the ad matched the requirements of an invalidation query.\n\n<p>They are using a two-tier collector deployment.  The problem seems to be limited to the top-level collector, but it is difficult to tell for sure, due to the ambiguity in the way things are logged.\n\n</p><p>I attached to the top-level collector with gdb and confirmed that CollectorDaemon::ClassadLifetime was not corrupted (it was 900).  A restart of the top-level collector appeared to make things better, according to Igor.  However, I still see evidence of similar symptoms.  For example:\n\n</p><p></p><div class=\"verbatim\">\n<pre>top collector:\n08/31 13:15:32 StartdAd     : Inserting ** \"&lt; glidein_26950@grwn208.inr.troitsk.ru , 172.20.89.208 &gt;\"\n08/31 13:15:34         **** Removing stale ad: \"&lt; glidein_26950@grwn208.inr.troitsk.ru , 172.20.89.208 &gt;\"\n08/31 13:21:07 StartdAd     : Inserting ** \"&lt; glidein_26950@grwn208.inr.troitsk.ru , 172.20.89.208 &gt;\"\n\n\nsub-collector where the ad comes from:\n08/31 13:15:32 StartdAd     : Inserting ** \"&lt; glidein_26950@grwn208.inr.troitsk.ru , 172.20.89.208 &gt;\"\n08/31 13:32:13         **** Removing stale ad: \"&lt; glidein_26950@grwn208.inr.troitsk.ru , 172.20.89.208 &gt;\"\n\nsub-collector where the invalidation came from:\n08/31 13:15:34 Received UDP command 13 (INVALIDATE_STARTD_ADS) from glidein07@glidein-collector.t2.ucsd.edu &lt;129.93.239.148:56765&gt;,access level ADVERTISE_STARTD\n08/31 13:15:34 Calling HandleReq &lt;receive_invalidation&gt; (0)\n08/31 13:15:34 Got INVALIDATE_STARTD_ADS\n08/31 13:15:34          **** Removing stale ad: \"&lt; glidein_18621@wn130.lcg.cscs.ch , 148.187.66.130 &gt;\"\n08/31 13:15:34          **** Removing stale ad: \"&lt; glidein_10071@ccwl1207.in2p3.fr , 134.158.173.134 &gt;\"\n08/31 13:15:34          **** Removing stale ad: \"&lt; glidein_1690@wn067.indiacms.res.in , 192.168.2.76 &gt;\"\n08/31 13:15:34          **** Removing stale ad: \"&lt; glidein_9341@wn-b-33.local , 192.168.1.63 &gt;\"\n08/31 13:15:34          **** Removing stale ad: \"&lt; glidein_20527@heplnc196.pp.rl.ac.uk , 130.246.45.196 &gt;\"\n08/31 13:15:34          **** Removing stale ad: \"&lt; glidein_17287@wn166.lcg.cscs.ch , 148.187.66.166 &gt;\"\n08/31 13:15:34          **** Removing stale ad: \"&lt; glidein_9010@heplnc168.pp.rl.ac.uk , 130.246.45.168 &gt;\"\n08/31 13:15:34          **** Removing stale ad: \"&lt; glidein_28033@wn069.indiacms.res.in , 192.168.2.78 &gt;\"\n08/31 13:15:34          **** Removing stale ad: \"&lt; glidein_1805@heplnc150.pp.rl.ac.uk , 130.246.45.150 &gt;\"\n08/31 13:15:34 (Invalidated 9 ads)\n</pre></div>\n\n\n<p>To debug further, I am creating a patch for the collector to log more information.</p></blockquote>", "remarks": "<blockquote>\nThis problem was resolved in ticket <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1644\" onclick=\"get_ticket_and_populate_wrapper('1644'); return false;\" title=\"machine invalidation ads match ads from all machines\">#1644</a></span>.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Sep-01 17:46</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/86c98e17a402062e180b6cf004b3fb3f03e5b38f\">[18913]</a></span>: Improve logging when handling mass-invalidations. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1634\" onclick=\"get_ticket_and_populate_wrapper('1634'); return false;\" title=\"unexplained mass invalidation of ads in collector\">#1634</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2014-Aug-04 15:03", "status": "resolved", "created": "2010-Sep-01 17:45", "fixed_version": "2010-Sep-01 17:45", "broken_version": "v070401", "priority": "4", "subsystem": "", "assigned_to": "danb", "derived_from": "#1644", "creator": "danb", "rust": "s7949", "customer_group": "cms", "visibility": "public", "notify": "dan@hep.wisc.edu,tannenba@cs.wisc.edu", "due_date": ""}