{"id": 5107, "title": "Ticket #5107: Set DAGMan ClassAd attributes directly in DAG file", "description": "<blockquote>\nPhilip Papadopoulos wants to be able to set DAGMan <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> attributes directly in the DAG file (not via the DAGMAN_INSERT_SUB_FILE technique that's available now) and Miron agrees with him.\n\n<p>My initial thought is to do something like this:\n\n</p><p></p><pre>  SUBMIT_COMMAND +Attribute = Value\n</pre>\n\n<p>Then you could do things besides setting attributes if you wanted to.</p></blockquote>", "remarks": "<blockquote>\n<em>2015-Jun-21 20:40:33 by wenger:</em> <br/>\n\nHmm -- I'm wondering now whether we should call this DAG_SUBMIT_COMMAND, in case we want to have something that adds submit commands to node jobs...\n\n<p></p><hr/>\n<em>2015-Jun-21 21:05:39 by wenger:</em> <br/>\n\nSomething else to think about -- what if the user specifies multiple DAG files on the command line?  Should we use the submit commands from all of them?  What if commands in different DAGs (or different commands in the same DAG, for that matter) set the same attribute to different values?\n\n<p>I guess with the -append flag, we just append things in the order specified, so if you specify two values for the same attribute, the later one \"overwrites\" the earlier one.  I'm not quite so sure that that's the right thing to do if we have multiple DAGs, though...\n\n</p><p></p><hr/>\n<em>2015-Jun-21 21:17:12 by wenger:</em> <br/>\n\nI can think of several options for multiple DAGs:\n<ol>\n<li>Just go ahead and process all of the submit commands.\n</li><li>Only process the submit commands from the first DAG.\n</li><li>Process submit commands from the first DAG; if other DAGs have submit commands, it's an error.\n</li><li>Process submit commands from all DAGs, if they \"conflict\" it's an error.\n</li></ol>\n\n<p>Number 4 seems pretty complicated to implement, so I'm leaning away from that at this point...\n\n</p><p></p><hr/>\n<em>2015-Jun-21 21:49:16 by wenger:</em> <br/>\n\nNeed to think a bit more about syntax -- my current thought is that everything beyond DAG_SUBMIT_COMMAND and the whitespace immediately following that becomes the submit command.  One question is whether to allow line continuation characters.\n\n<p></p><hr/>\n<em>2015-Jul-01 12:06:47 by wenger:</em> <br/>\n\nCreated the branch V8_3-gittrac_5107-branch.  (Note:  this feature is almost certainly going to go into 8.5 rather than 8.3.)\n\n<p></p><hr/>\n<em>2015-Nov-30 15:53:07 by wenger:</em> <br/>\n\nJust created V8_5-gittrac_5107_2-branch for this -- off of 8.5 instead of 8.3, and I want to implement this without the \"string literal to named string constant\" changes I have in progress on V8_3-gittrac_5107-branch.\n\n<p></p><hr/>\n<em>2015-Dec-11 15:35:16 by wenger:</em> <br/>\n\nThis is all done except for documentation -- I'm going to assign it to Zach for code review.\n\n<p></p><hr/>\n<em>2015-Dec-22 16:27:21 by zmiller:</em> <br/>\n\n<strong>CODE REVIEW</strong>:  Set with Kent in person and did the review.  Looks good.\n\n<p></p><hr/>\n<em>2015-Dec-28 11:40:18 by wenger:</em> <br/>\n\nJust talked with Miron about this.  He wants several changes to simplify things and hide more of the condor_submit syntax from the DAG user:\n<ul>\n<li>The feature will be purely for setting <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> attributes.\n</li><li>The user should not have to add the \"+\" before the attribute name.\n</li><li>Change the command from DAG_SUBMIT_COMMAND to something like SET_JOB_ATTR.</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/920/gt5107.dif\">gt5107.dif</a>\n26712 bytes added by wenger on 2015-Dec-22 18:58:23 UTC.\n<br/>\nHere's a full diff of all the changes on the branch.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Dec-29 17:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3559109c27d9ef1b139383029f134ed36518bc0a\">[47405]</a></span>: Changed \"DAGMan input file\" to \"DAG input file\" (mainly in index entries) so that we're consistent (previously some places had it one way and some had it the other. (This change is committed on V8_5-gittrac_5107_2-branch, but is not really part of the gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span> fix.)  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Dec-29 17:06</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/91dc6bfefcf9702e7ed366811ed537e5d8670e8f\">[47404]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span>: Changed test to include quoted attribute value with a space; added SET_JOB_ATTR documentation to the DAGMan section of the manual, with a link from the relevant version history entry.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Dec-28 17:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a8422ff44eac17a8380453da1de3f2bc0170ee07\">[47403]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span>: Changes as per today's conversation with Miron: * No \"+\" before attribute names (this now <strong>only</strong> works for setting <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAd\" title=\"Class Ad\">ClassAd</a></span> attributes); + Changed command from DAG_SUBMIT_COMMAND to SET_JOB_ATTR. Modified the test accordingly.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Dec-11 14:16</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f1ca893e00e4c92cfa097de862cb238141203781\">[46581]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span>: job_dagman_set_attr fails on Windows, so I'm adding it to the skip list.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Dec-11 12:31</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/664788e7aa473a9205a9364e89ac067214469e0c\">[46580]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span>: Oops! Forgot to add job_dagman_set_attr.run.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Dec-11 12:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/90e03344098642169a179343869515bcc72b65da\">[46579]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span>: Finshed test; added version history item.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Dec-01 12:25</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ee6b98bf6e38ec3d8f31f9a11ea01d8ebd5ebdce\">[46316]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span>: More code cleanup.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Dec-01 11:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/229b3dc4f6a81508baa07d7ffba343d44bcf44e9\">[46315]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span>: Removed more dead code.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Dec-01 10:32</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/979c25ebf91317bfb65d0e3eb7b2d0d704bcde14\">[46314]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span>: Added to the test (not yet complete).  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Dec-01 09:33</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/26845bb6b973fbf562a1c11515289eddeb686f1a\">[46313]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span>: Brought over implementation (without \"literal strings to named constants\" changes from V8_3-gittrac_5107-branch.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Nov-25 14:01</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/acb1128e76ffe2d01c70c80b8c1596d5d191e9e3\">[46301]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span>: Slight code cleanup, started test.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-06 14:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6d0dae8cf2c1e52e5f752963deb025d2b9355049\">[45215]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span>: Added new header file with defines of DAG command names (to be sure we're consistent when we use them in multiple places).  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-02 14:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/34e18ce8af1d7c75854f5d5861c25c590590d32a\">[45206]</a></span>: Gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span>: Basic functionality is implemented, but the code still needs cleanup; we also need a test, and a version history entry.  (By Kent Wenger )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2015-Jul-01 14:56</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/563714af8a0163a39a0603a2c7bfbd901a3af558\">[45195]</a></span>: Removed more dead code (found while working on gittrac <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=5107\" onclick=\"get_ticket_and_populate_wrapper('5107'); return false;\" title=\"Set DAGMan ClassAd attributes directly in DAG file\">#5107</a></span>).  (By Kent Wenger )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2016-Jan-04 16:52", "status": "resolved", "created": "2015-Jun-19 09:34", "fixed_version": "2015-Jun-19 09:34", "broken_version": "v080306", "priority": "2", "subsystem": "Dag", "assigned_to": "wenger", "derived_from": "", "creator": "wenger", "rust": "", "customer_group": "other", "visibility": "public", "notify": "wenger@cs.wisc.edu, zmiller@cs.wisc.edu, miron@cs.wisc.edu, philip.papadopoulos@gmail.com", "due_date": ""}