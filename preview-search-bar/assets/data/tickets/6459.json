{"id": 6459, "title": "Ticket #6459: Submit shouldn't spool executable multiple times for same cluster", "description": "<blockquote>\nWhen <code>copy_to_spool</code> is set to <code>True</code> in the submit file, condor_submit tries to send the executable file over the network to the schedd once for each job in the cluster, when it only needs to do so once for the whole cluster. In 8.6 (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6454\" onclick=\"get_ticket_and_populate_wrapper('6454'); return false;\" title=\"copy_to_spool does useless extra copies of executable over the network\">#6454</a></span>), we changed the schedd to decline executable spooling RPCs if the executable has already been received. That removed most of the wasted effort, but submit's behavior still introduces an extra round trip over the network per job within a cluster. We should make submit more intelligent about this.\n\n<p>One wrinkle in how we implement this is how to treat a job cluster where the individual jobs have different values for <code>copy_to_spool</code>. The spooled executable is used by all jobs in the cluster. You can't use a spooled copy for only some of the jobs. I see a few ways to handle this:\n</p><ul>\n<li>The executable is spooled only if job proc 0 requests it. This is easier to code. This is also how late materialization has to work.\n</li><li>The executable is spooled if any job in the cluster requests it. This maintains the behavior of previous versions.\n</li><li>The submission is aborted and an error reported.</li></ul>\n</blockquote>", "remarks": "<blockquote>\n<em>2017-Oct-19 15:57:49 by jfrey:</em> <br/>\n\nCommit <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/50f59dbaa6a71bfbd522c8b86075e0cd9bb927bc\">[52615]</a></span> had the wrong ticket number in its commit message. It belongs under this ticket.\n\n<p></p><hr/>\n<em>2017-Dec-13 15:30:32 by jfrey:</em> <br/>\n\nWe decided to spool the executable only if proc 0 of the cluster sets copy_to_spool=true.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Dec-13 15:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/4377efc3ba761b4b48aa4f6420691045bd8c5b2d\">[53004]</a></span>: Docs for eliminating duplicate transfers of job executable by submit. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6459\" onclick=\"get_ticket_and_populate_wrapper('6459'); return false;\" title=\"Submit shouldn't spool executable multiple times for same cluster\">#6459</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2017-Oct-19 15:54</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/50f59dbaa6a71bfbd522c8b86075e0cd9bb927bc\">[52615]</a></span>: Submit should spool executable only once per cluster. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=6454\" onclick=\"get_ticket_and_populate_wrapper('6454'); return false;\" title=\"copy_to_spool does useless extra copies of executable over the network\">#6454</a></span> When copy_to_spool is set to True, condor_submit now sends the executable once per cluster, instead of once per job. Since a spooled executable is shared across a job cluster, sending it once per job is unnecessary and wasteful.  (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2017-Dec-13 15:37", "status": "resolved", "created": "2017-Oct-19 15:32", "fixed_version": "2017-Oct-19 15:32", "broken_version": "", "priority": "3", "subsystem": "Tools", "assigned_to": "jfrey", "derived_from": "#6454", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}