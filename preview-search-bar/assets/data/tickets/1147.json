{"id": 1147, "title": "Ticket #1147: Make tests more self contained / expand CondorTests.pm", "description": "<blockquote>\nToday a typical test consists of two or more files\n<ul>\n<li>the .run file - The brains of the test, usually written in Perl and using CondorTest.pm\n</li><li>the .cmd file - Used to submit a job as part of the test.  Tests that don't submit jobs won't have one.\n</li><li>\"other stuff\": .cc, .sh, .pm, .c, .h, etc - Test specific needs.\n</li></ul>\n\n<p>This has several problems:\n</p><ul>\n<li>condor_tests is a bit of a mess.  322 tests need about 1,205 files.\n</li><li>Many of the files, especially the .cmd files, are very similar and in some cases are identical.  If we want a change to how all of the test submit jobs, you'll be modifying a large number of .cmd files.\n</li></ul>\n\n<p>Solution:\n</p><ol>\n<li>Add functionality to <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=CondorUtils\" title=\"Condor Utils\">CondorUtils</a></span>:\n<ul>\n<li>Add WriteFile() will take a filename and contents (probably using &lt;&lt;HEREDOC syntax).  A script needing an external file can internalize the contents and write it on demade.  It may need a flag to indicate \"when you create this, make it executable.\"\n</li><li>Extend RunTest() to take either an entire .cmd file as an argument or a set of tweaks to a \"standard\" submit file.\n</li><li>Probably a lot more.\n</li></ul>\n</li><li>Document that new tests should use the new functionality.  If at all possible, a new test should consist of only a single file, the .run file.\n</li><li>A few existing tests should be updated to use the new functionality, largely as a proof of concept.\n</li><li>As time allows, convert old tests to new form.  This might make a good STUDENTTASK.\n</li></ol>\n\n<p>See also:\n</p><ul>\n<li><span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1148\" onclick=\"get_ticket_and_populate_wrapper('1148'); return false;\" title='Refactor \"report on test and exit\" code from test into CondorTest.pm'>#1148</a></span>: Refactor \"report on test and exit\" code from test into CondorTest.pm - A specific detail that should be refactored.\n</li><li><span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1149\" onclick=\"get_ticket_and_populate_wrapper('1149'); return false;\" title=\"Change bare system() calls to runcmd() in .run files in test suite\">#1149</a></span>: Tests should use CondorUtils.pm runcmd; not system and friends\n</li></ul>\n\n<p><span class=\"section\"></span></p><h2>Milestones </h2>\n\n<p></p><ul>\n<li>2010-03-22: (danb) [DONE] create examples of new tests (ccb and job_router) that use new personal condor management and 'check' modules that encourage greater code sharing</li></ul>\n</blockquote>", "remarks": "<blockquote>\nThe goals of this ticket are largely addressed, so I am resolving it.  See README.personal_condor and README.checks for more info.\n\n<p></p><hr/>\n<em>2010-May-14 16:51:19 by adesmet:</em> <br/>\n\nClaiming. I'm doing a bit of work to embed *.cmd and x_*.pl files directly into the run files.\n\n<p></p><hr/>\n<em>2010-Sep-28 16:49:34 by matt:</em> <br/>\n\nThis is marked as fixed in 7.5.2, released awhile ago. Should this be Resolved or Fixed Version of 7.5.4 or 7.5.5?\n<hr/>\n<em>2011-Jan-27 14:46:04 by danb:</em> <br/>\n\nBulk change of target version from v070505 to v070506 using ./ticket-target-mover.\n<hr/>\n<em>2011-Feb-01 14:49:30 by tannenba:</em> <br/>\n\nBulk change of target version from v070506 to NULL using ./ticket-target-mover.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-May-14 16:52</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/30f58c4bd662de0443b07ba0a7676f7b66346b53\">[18002]</a></span>: Making CondorTest::RunTest smarter; it can handle creating the submit (*.cmd) file and executable, allowing tests to have fewer input files. Converted cmd_q_shows-sub as a proof of concept. <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1147\" onclick=\"get_ticket_and_populate_wrapper('1147'); return false;\" title=\"Make tests more self contained / expand CondorTests.pm\">#1147</a></span>  (By Alan De Smet )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-29 14:59</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/58ef791c02a489273014bbd3c32db858eea0bd78\">[17738]</a></span>: Documented check modules. <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1147\" onclick=\"get_ticket_and_populate_wrapper('1147'); return false;\" title=\"Make tests more self contained / expand CondorTests.pm\">#1147</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-29 11:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dc8ab6f7445211f245c0f127cfdcfbd916299cb8\">[17737]</a></span>: Simplified condorc_abc test. <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1147\" onclick=\"get_ticket_and_populate_wrapper('1147'); return false;\" title=\"Make tests more self contained / expand CondorTests.pm\">#1147</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-29 11:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2da132141f1996cbb579569fa82de972881a7b49\">[17736]</a></span>: Made condor_name an optional argument to StartCondorWithParams(). <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1147\" onclick=\"get_ticket_and_populate_wrapper('1147'); return false;\" title=\"Make tests more self contained / expand CondorTests.pm\">#1147</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-29 11:08</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f75e39018284ee3d624e277b0d72b7d3d61b83f0\">[17735]</a></span>: Simplified job_condorc_ab_van test. <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1147\" onclick=\"get_ticket_and_populate_wrapper('1147'); return false;\" title=\"Make tests more self contained / expand CondorTests.pm\">#1147</a></span>  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Mar-29 10:07</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/3333242d0d7d5fa8a47900720df19dda3b635539\">[17730]</a></span>: Added named-argument interface for configuring personal condor in tests. <span class=\"ticket\"><a class=\"stalled\" href=\"/wiki-archive/tickets/?ticket=1147\" onclick=\"get_ticket_and_populate_wrapper('1147'); return false;\" title=\"Make tests more self contained / expand CondorTests.pm\">#1147</a></span> This is an alternative to specifying parameters in a separate file.\u00a0[...]\n (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2011-Mar-30 11:31", "status": "stalled", "created": "2010-Jan-28 13:46", "fixed_version": "2010-Jan-28 13:46", "broken_version": "", "priority": "4", "subsystem": "Tests", "assigned_to": "adesmet", "derived_from": "#1124", "creator": "adesmet", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": "20100329"}