{"id": 7603, "title": "Ticket #7603: Support builds and tests in Docker", "description": "<blockquote>\nBoth the build and test glue and the tests themselves need some tweaks to support running in CHTC Docker jobs.</blockquote>", "remarks": "<blockquote>\n<em>2020-Apr-17 20:24:13 by tlmiller:</em> <br/>\n\nThese are all internal changes to the Metronome glue, which we can be certain no one else uses.  There is therefore no needs for (further) review or (any other) documentation.\n\n<p>(There's also two changes to the tests, which are not (yet) public, either.)</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-17 13:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f1c6d00732d0c5932bf9aea40628c3f860070994\">[59408]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7603\" onclick=\"get_ticket_and_populate_wrapper('7603'); return false;\" title=\"Support builds and tests in Docker\">#7603</a></span>) For now, just request the same resources for all platforms.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-17 13:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/f1b19737b0b654edb49de50bf86baa00f3b33bbc\">[59407]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7603\" onclick=\"get_ticket_and_populate_wrapper('7603'); return false;\" title=\"Support builds and tests in Docker\">#7603</a></span>) Fix cmd_curl_plugin and job_ec2_basic to ignore HTTP_PROXY; it makes no sense in the latter's case anyway, and it breaks things in containers for both.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-17 13:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8269941488b4226cf3b3046057083f442526e4df\">[59406]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7603\" onclick=\"get_ticket_and_populate_wrapper('7603'); return false;\" title=\"Support builds and tests in Docker\">#7603</a></span>) Missed a case where we needed to use $platform_key instead of $platform_name to handle Docker platforms correctly; added abillity to submit tests for Docker platforms.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-17 13:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/0d4bb00367da74a4c57dc462405abff74e2cfff4\">[59405]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7603\" onclick=\"get_ticket_and_populate_wrapper('7603'); return false;\" title=\"Support builds and tests in Docker\">#7603</a></span>) Allow platforms to include docker:// URLs (URL basename is platform shortname). Add nmi-build:x86_64_Debian9 to SubmitInfo.pm for stupid technical reasons.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-16 11:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/dcfada9742d6314fcbe2c8560aae83838132ee91\">[59369]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7603\" onclick=\"get_ticket_and_populate_wrapper('7603'); return false;\" title=\"Support builds and tests in Docker\">#7603</a></span>) For now, just request the same resources for all platforms.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-16 11:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ff12fea1432e567d61f3f7180ebdaba681254efb\">[59368]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7603\" onclick=\"get_ticket_and_populate_wrapper('7603'); return false;\" title=\"Support builds and tests in Docker\">#7603</a></span>) Fix cmd_curl_plugin and job_ec2_basic to ignore HTTP_PROXY; it makes no sense in the latter's case anyway, and it breaks things in containers for both.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-16 11:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/2c5dfc74931144bb0a1f88ebb2990fe7cfd1dd8d\">[59367]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7603\" onclick=\"get_ticket_and_populate_wrapper('7603'); return false;\" title=\"Support builds and tests in Docker\">#7603</a></span>) Missed a case where we needed to use $platform_key instead of $platform_name to handle Docker platforms correctly; added abillity to submit tests for Docker platforms.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2020-Apr-16 11:35</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/275cee520feb1962befeed2998bd477ff3ce1b04\">[59366]</a></span>: (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7603\" onclick=\"get_ticket_and_populate_wrapper('7603'); return false;\" title=\"Support builds and tests in Docker\">#7603</a></span>) Allow platforms to include docker:// URLs (URL basename is platform shortname). Add nmi-build:x86_64_Debian9 to SubmitInfo.pm for stupid technical reasons.  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2020-Apr-17 20:25", "status": "resolved", "created": "2020-Apr-16 11:26", "fixed_version": "2020-Apr-16 11:26", "broken_version": "", "priority": "2", "subsystem": "Packaging", "assigned_to": "tlmiller", "derived_from": "", "creator": "tlmiller", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tlmiller@cs.wisc.edu, tim@cs.wisc.edu", "due_date": ""}