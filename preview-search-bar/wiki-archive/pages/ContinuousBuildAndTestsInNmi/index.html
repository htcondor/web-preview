<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="HTCondor Homepage">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="date" content="2021-10-20 21:43:27 +0000" />

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/web-preview/preview-search-bar/assets/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/web-preview/preview-search-bar/assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/web-preview/preview-search-bar/assets/images/favicons/favicon-16x16.png">
    <link rel="manifest" href="/web-preview/preview-search-bar/assets/images/favicons/site.webmanifest">
    <link rel="mask-icon" href="/web-preview/preview-search-bar/assets/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/web-preview/preview-search-bar/assets/images/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/web-preview/preview-search-bar/assets/images/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <!-- Primary Meta Tags -->
    <meta name="title" content="HTCondor">
    <meta name="description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://htcondor.org/">
    <meta property="og:title" content="HTCondor">
    <meta property="og:description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">
    <meta property="og:image" content="https://htcondor.org/assets/images/HTC.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://htcondor.org/">
    <meta property="twitter:title" content="HTCondor">
    <meta property="twitter:description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">
    <meta property="twitter:image" content="https://htcondor.org/assets/images/HTC.png">

    <title>Continuous Build And Tests In Nmi</title>

    <script src="/web-preview/preview-search-bar/assets/js/sitewide.js" type="text/javascript" defer></script>
    <script src="/web-preview/preview-search-bar/assets/js/bootstrap.js" type="text/javascript"></script>
    <script src="/web-preview/preview-search-bar/assets/js/lunr.js" type="text/javascript" async></script>
    <script src="/web-preview/preview-search-bar/assets/js/search_bar.js" type="text/javascript" async></script>
    <script src="/web-preview/preview-search-bar/assets/js/default.js" type="text/javascript" defer></script>

    

    

    <meta name="robots" content="noindex">

    

    <link href="/web-preview/preview-search-bar/assets/css/style-v1.css" media="screen, tv, projection" title="Default" rel="stylesheet">
    

</head>
<body class="vh-100 d-flex flex-column">

<!-- For non-visual user agents: -->
<a id="skip-link" href="#main-copy">Skip to main content.</a>

<header id="header">
    <div class="mb-4 container">
        <div class="row">
            <div class="col-12">
                <nav class="navbar navBar navbar-expand-lg navbar-light w-100">
                    <a href="/web-preview/preview-search-bar/index.html" class="d-none d-md-inline"><img height="75" alt="Condor High Throughput Computing" src="/web-preview/preview-search-bar/assets/images/CondorTitle.png" style="border:0"></a>
                    <a href="/web-preview/preview-search-bar/index.html" class="d-inline d-md-none"><img height="65" alt="Condor High Throughput Computing" src="/web-preview/preview-search-bar/assets/images/HTCondor_red_blk.svg" style="border:0"></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mb-2 mb-lg-0 ms-auto mt-auto">
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-search-bar/">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-search-bar/new">News</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-search-bar/downloads">Downloads</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-search-bar/publications">Publications</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="mailto:htcondor-admin@cs.wisc.edu">Contact Us</a>
                            </li>
                            <li class="nav-item">
                                <div id="main-search-bar" class="search-bar">
                                    <input type="text" class="form-control" placeholder="Loading..." aria-describedby="button-addon2">
                                    <div class="results-dropdown" class="results-dropdown w-100">
                                        <div class="search-results" ></div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</header>
<main id="main-copy" tabindex="-1">
    <div class="container mb-4">
    <h1>Continuous Build And Tests In Nmi</h1>
<div id="content">
 <span class="section">
  <h2>
   Overview
  </h2>
 </span>
 We build HTCondor and run the regression test suite on each push to the Git repository.  The reasons for these frequent builds are:
 <ul>
  <li>
   Provide quick feedback if a commit breaks the builds or tests
  </li>
  <li>
   Provide historical coverage to help trace back and find which commit broke tests/builds.  It is hard to track backwards from a broken test to the commit which broke the test if there are many commits between builds.  The more frequent the tests are, the smaller the commit windows is to find the guilty commit.
  </li>
  <li>
   Help spot race conditions in tests that fail sporadically, especially when subsequent runs of the test produce different results against the same code
  </li>
 </ul>
 <p>
  <span class="section">
  </span>
 </p>
 <h2>
  Current implementation
 </h2>
 <p>
  The per-commit runs are submitted from
  <code>
   batlab.chtc.wisc.edu
  </code>
  in the
  <code>
   /home/condorauto/per-commit
  </code>
  directory.  A single Crondor job exists which wakes up every few minutes and checks for new commits to build.  This job simply calls condor_nmi_submit to do the dirty work.  Occasionally, someone will condor_rm all of condorauto's jobs, forgetting about this Crondor job.  When that happens, the Crondor job will get removed too, stopping the per-commit builds from running (but don't worry - it won't lose state) and someone needs to re-submit the job (see below for instructions).
 </p>
 <p>
  Note that condor_nmi_submit sets the
  <span class="wiki">
   <a class="missing" href="/web-preview/preview-search-bar/wiki-archive/pages/JobPrio" title="Job Prio">
    JobPrio
   </a>
  </span>
  such that the most recently submitted build (and test) has the highest priority.  Because tests are slow, they usually fall behind in the course of a day, but the most recently submitted ones are started first.  Even if it takes overnight for a test run to finish, it can still be very valuable when tracking backwards to find what commit broke a test.
 </p>
 <p>
  <span class="section">
  </span>
 </p>
 <h2>
  Setting up the per-commit builds
 </h2>
 The per-commit build "code" is in Subversion at
 <code>
  /p/condor/software/svn/condor/per-commit-builds
 </code>
 Follow the README file found in that directory.
 <span class="comment">
  [[anonymous: TJ - I think it's in git now?]]
 </span>
 <p>
  <span class="section">
  </span>
 </p>
 <h2>
  Re-submitting the per-commit builds
 </h2>
 <ul>
  <li>
   Login to
   <code>
    batlab.chtc.wisc.edu
   </code>
   and sudo to the
   <code>
    condorauto
   </code>
   user
  </li>
  <li>
   <code>
    cd /home/condorauto/per-commit
   </code>
  </li>
  <li>
   <code>
    condor_submit submit
   </code>
  </li>
 </ul>
 <p>
  <span class="section">
  </span>
 </p>
 <h2>
  We-winding the per-commit builds for a branch
 </h2>
 <ul>
  <li>
   Login to
   <code>
    batlab.chtc.wisc.edu
   </code>
   and sudo to the
   <code>
    condorauto
   </code>
   user
  </li>
  <li>
   <code>
    cd /home/condorauto/per-commit
   </code>
  </li>
  <li>
   <code>
    git --git-dir=/home/condorauto/condor.git tag continuous-build-placeholder-tag-master --force master^
   </code>
  </li>
 </ul>
 <p>
  replace master with the name off the branch you want to rewind.
 </p>
 <p>
  <span class="section">
  </span>
 </p>
 <h2>
  Per-commit Native Package Repositories
 </h2>
 <p>
  The per-commit builds generate RPMs and Debian packages.  These are placed into repositories on mirror.batlab.org.
 </p>
 <p>
  <a class="external" href="http://mirror.batlab.org/yum">
   YUM repository
  </a>
  <a class="external" href="http://mirror.batlab.org/debian">
   Debian repository
  </a>
 </p>
 <p>
  As of this writing (2012-08-15) there are no known external users, although Peter Couvares has expressed interest in getting pre-releases from here.
 </p>
 <p>
  TODO list:
 </p>
 <ol>
  <li>
   Make this work for Debian - it only works for yum currently because I did not have time to research the Debian native package directory structure.
  </li>
  <li>
   Generate .repo files automatically for each YUM repo
  </li>
  <li>
   Make a nicer front page with all the .repo files?
  </li>
  <li>
   Decide how many RPMs and Debs to keep around at a time
  </li>
 </ol>
 <p>
  The repositories are kept up-to-date through a combination of the build glue which runs on the submit node (batlab.chtc.wisc.edu) and a script that runs on mirror.batlab.org.  The glue pushes all RPMs (and eventually Deb files too) to a well known directory on mirror.batlab.org.  The script on mirror.batlab.org runs out of cron and wakes up periodically, looks in the well known directory, moves files into their respective repo (creating the directories if needed), and re-runs createrepo (or the debian equivalent).
 </p>
 <p>
  The code is available in SVN at:
  <code>
   /p/condor/software/svn/condor/testing-repo-scripts
  </code>
 </p>
 <p>
  <span class="section">
  </span>
 </p>
 <h2>
  The Build and Test Dashboard
 </h2>
 <p>
  <a class="external" href="http://batlab.chtc.wisc.edu/results/">
   Build and Test dashboard
  </a>
 </p>
 <p>
  The code is in PHP.  It is available in the same SVN repository as the per-commit build scripts:
  <code>
   /p/condor/software/svn/build-dashboard/
  </code>
 </p>
 <p>
  Currently it is made available on batlab.chtc.wisc.edu by placing it in
  <code>
   /home/condorauto/public/html/results
  </code>
  and placing a symlink in
  <code>
   /var/www/html
  </code>
 </p>
 <p>
 </p>
 <div class="code">
  <pre class="code">[kronenfe@batlabsubmit0001 html]$ ll /var/www/html
...
lrwxrwxrwx 1 root         root            36 Sep  8  2011 results -&gt; /home/condorauto/public/html/results
lrwxrwxrwx 1 root         root            42 Sep 22  2011 results-devel -&gt; /home/condorauto/public/html/results-devel
...
</pre>
 </div>
</div>

</div>
</main>
<div id="footer" class="border-top mt-auto">
    <div class="container py-4">
        <div class="row">
            <div class="col text-center">
                For comments or questions about this website, please email
                <a href="mailto:htcondor-admin@cs.wisc.edu">htcondor-admin@cs.wisc.edu</a><br />
                This work is supported by <a href="https://www.nsf.gov/div/index.jsp?div=OAC">NSF</a> under Cooperative Agreement <a href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=2030508">OAC-2030508</a> as part of the <a href="https://path-cc.io/">PATh Project</a>. <br />
                <script type="text/javascript">
                    document.write("Updated &raquo; "+lastMod(document.lastModified))
                </script>
            </div>
        </div>
    </div>
</div>



</body>
</html>
