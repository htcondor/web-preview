<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="HTCondor Homepage">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="date" content="2021-10-20 20:49:32 +0000" />

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/web-preview/preview-search-bar/assets/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/web-preview/preview-search-bar/assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/web-preview/preview-search-bar/assets/images/favicons/favicon-16x16.png">
    <link rel="manifest" href="/web-preview/preview-search-bar/assets/images/favicons/site.webmanifest">
    <link rel="mask-icon" href="/web-preview/preview-search-bar/assets/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/web-preview/preview-search-bar/assets/images/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/web-preview/preview-search-bar/assets/images/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <!-- Primary Meta Tags -->
    <meta name="title" content="HTCondor">
    <meta name="description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://htcondor.org/">
    <meta property="og:title" content="HTCondor">
    <meta property="og:description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">
    <meta property="og:image" content="https://htcondor.org/assets/images/HTC.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://htcondor.org/">
    <meta property="twitter:title" content="HTCondor">
    <meta property="twitter:description" content="HTCondor is a specialized workload management system for compute-intensive jobs. Built to be flexible, expressive, and compatible with Grid and Cloud computing environments HTCondor made to increase your Computational Throughput.">
    <meta property="twitter:image" content="https://htcondor.org/assets/images/HTC.png">

    <title>Glexec Wisdom</title>

    <script src="/web-preview/preview-search-bar/assets/js/sitewide.js" type="text/javascript" defer></script>
    <script src="/web-preview/preview-search-bar/assets/js/bootstrap.js" type="text/javascript"></script>
    <script src="/web-preview/preview-search-bar/assets/js/lunr.js" type="text/javascript" async></script>
    <script src="/web-preview/preview-search-bar/assets/js/search_bar.js" type="text/javascript" async></script>
    <script src="/web-preview/preview-search-bar/assets/js/default.js" type="text/javascript" defer></script>

    

    

    <meta name="robots" content="noindex">

    

    <link href="/web-preview/preview-search-bar/assets/css/style-v1.css" media="screen, tv, projection" title="Default" rel="stylesheet">
    

</head>
<body class="vh-100 d-flex flex-column">

<!-- For non-visual user agents: -->
<a id="skip-link" href="#main-copy">Skip to main content.</a>

<header id="header">
    <div class="mb-4 container">
        <div class="row">
            <div class="col-12">
                <nav class="navbar navBar navbar-expand-lg navbar-light w-100">
                    <a href="/web-preview/preview-search-bar/index.html" class="d-none d-md-inline"><img height="75" alt="Condor High Throughput Computing" src="/web-preview/preview-search-bar/assets/images/CondorTitle.png" style="border:0"></a>
                    <a href="/web-preview/preview-search-bar/index.html" class="d-inline d-md-none"><img height="65" alt="Condor High Throughput Computing" src="/web-preview/preview-search-bar/assets/images/HTCondor_red_blk.svg" style="border:0"></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mb-2 mb-lg-0 ms-auto mt-auto">
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-search-bar/">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-search-bar/new">News</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-search-bar/downloads">Downloads</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/web-preview/preview-search-bar/publications">Publications</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="mailto:htcondor-admin@cs.wisc.edu">Contact Us</a>
                            </li>
                            <li class="nav-item">
                                <div id="main-search-bar" class="search-bar">
                                    <input type="text" class="form-control" placeholder="Loading..." aria-describedby="button-addon2">
                                    <div class="results-dropdown" class="results-dropdown w-100">
                                        <div class="search-results" ></div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</header>
<main id="main-copy" tabindex="-1">
    <div class="container mb-4">
    <h1>Glexec Wisdom</h1>
<div id="content">
 <span class="section">
  <h2>
   Introduction
  </h2>
 </span>
 <p>
  glexec is a tool that provides a sudo-like capability in a grid environment. glexec takes an X.509 proxy and a command to run as inputs, and maps the proxy to a local identity (that is, a Unix UID), which it then uses to execute the command. See
  <a class="external" href="http://www.nikhef.nl/grid/lcaslcmaps/glexec/">
   http://www.nikhef.nl/grid/lcaslcmaps/glexec/
  </a>
  for more information about glexec.
 </p>
 <p>
  HTCondor supports using glexec on the execute side to provide a sort of alternative form of
  <span class="wiki">
   <a href="/web-preview/preview-search-bar/wiki-archive/pages/PrivSep" title="Priv Sep">
    PrivSep
   </a>
  </span>
  (called GLEXEC_JOB mode). This is useful in a glide-in scenario for providing isolation between the glide-in and the jobs underneath it. Igor Sfiligoi uses HTCondor's glexec support in his glide-in setups for a number of HEP projects.
 </p>
 <p>
  A previous implementation of glexec integration in HTCondor had the StartD using glexec to spawn the Starter (called GLEXEC_STARTER mode). This implementation had a number of drawbacks and is now deprecated. The rest of this document will focus on details of the GLEXEC_JOB implementation. Specifically, changes made to the Starter and the ProcD to support GLEXEC_JOB mode will be described.
 </p>
 <p>
  <span class="section">
  </span>
 </p>
 <h2>
  Starter
 </h2>
 <p>
  In the Starter, there is a class called
  <span class="wiki">
   <a class="missing" href="/web-preview/preview-search-bar/wiki-archive/pages/GlexecPrivSepHelper" title="Glexec Priv Sep Helper">
    GlexecPrivSepHelper
   </a>
  </span>
  that encapsulates the use of glexec and behaves much in the same way as the
  <span class="wiki">
   <a class="missing" href="/web-preview/preview-search-bar/wiki-archive/pages/CondorPrivSepHelper" title="Condor Priv Sep Helper">
    CondorPrivSepHelper
   </a>
  </span>
  class does for
  <span class="wiki">
   <a href="/web-preview/preview-search-bar/wiki-archive/pages/PrivSep" title="Priv Sep">
    PrivSep
   </a>
  </span>
  . Although GLEXEC_JOB mode works similarly to
  <span class="wiki">
   <a href="/web-preview/preview-search-bar/wiki-archive/pages/PrivSep" title="Priv Sep">
    PrivSep
   </a>
  </span>
  mode, there are some important differences that stem from the fact that with glexec we can only execute things as the user and not take any other root-enabled actions (chowning the sandbox, for example).
 </p>
 <p>
  <span class="wiki">
   <a class="missing" href="/web-preview/preview-search-bar/wiki-archive/pages/GlexecPrivSepHelper" title="Glexec Priv Sep Helper">
    GlexecPrivSepHelper
   </a>
  </span>
  is really just an interface to a set of helper shell scripts that do the heavy lifting. These helper scripts are:
 </p>
 <p>
 </p>
 <ul>
  <li>
   condor_glexec_setup. This script is used in place of the
   <span class="wiki">
    <a href="/web-preview/preview-search-bar/wiki-archive/pages/PrivSep" title="Priv Sep">
     PrivSep
    </a>
   </span>
   chown-the-sandbox-from-condor-to-the-user operation. Since we can't chown, the sandbox is actually copied to achieve a similar effect. After this script runs, there are two directories. dir_&lt;pid&gt; is the job sandbox and is owned by the user at this point. dir_&lt;pid&gt;.condor is owned by the Condor user and contains a copy of the job's proxy. This is important since calls to glexec require the proxy as input so we need a keep a condor-owned copy that the job can't mess with.
   <p>
   </p>
  </li>
  <li>
   condor_glexec_run. This is used when it comes time to run the job. The main things this script does are set up the job's standard I/O and use the condor_glexec_job_wrapper program to pass the job its environment. (glexec provides no easy way to do this so we have to play some tricks. Check out glexec_job_wrapper.cpp for the gory details.)
   <p>
   </p>
  </li>
  <li>
   condor_glexec_cleanup. This is used in place of the
   <span class="wiki">
    <a href="/web-preview/preview-search-bar/wiki-archive/pages/PrivSep" title="Priv Sep">
     PrivSep
    </a>
   </span>
   chown-the-sandbox-from-the-user-back-to-condor operation. It essentially just undoes what condor_glexec_setup did before executing the job.
  </li>
 </ul>
 <p>
  <span class="section">
  </span>
 </p>
 <h2>
  ProcD
 </h2>
 <p>
  The ProcD required one pretty simple change to support GLEXEC_JOB mode. After the Starter registers a process family, it additionally sends over the name of the file that contains the job's proxy. This indicates to the ProcD that it cannot use the kill system call directly on processes in the new family. Instead, it will use the given proxy filename as an argument to the last of the helper scripts:
 </p>
 <p>
 </p>
 <ul>
  <li>
   condor_glexec_kill. This simply uses glexec to run /bin/kill with the arguments given by the caller.
  </li>
 </ul>
 <p>
  <span class="section">
  </span>
 </p>
 <h2>
  Testing
 </h2>
 <p>
  glexec used to be a real pain to set up for testing purposes though it is much easier now that it is a component of the VDT. In any case, there is a CentOS 3 VM that I made available in /scratch/glexec/VMware/mendota on nostos.cs.wisc.edu that has glexec installed in it. glexec is configured to map every proxy to the local account greg. The password for both the greg account and the root account is the same as the password for the CSL condor account (at least as of March 2009).
 </p>
</div>

</div>
</main>
<div id="footer" class="border-top mt-auto">
    <div class="container py-4">
        <div class="row">
            <div class="col text-center">
                For comments or questions about this website, please email
                <a href="mailto:htcondor-admin@cs.wisc.edu">htcondor-admin@cs.wisc.edu</a><br />
                This work is supported by <a href="https://www.nsf.gov/div/index.jsp?div=OAC">NSF</a> under Cooperative Agreement <a href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=2030508">OAC-2030508</a> as part of the <a href="https://path-cc.io/">PATh Project</a>. <br />
                <script type="text/javascript">
                    document.write("Updated &raquo; "+lastMod(document.lastModified))
                </script>
            </div>
        </div>
    </div>
</div>



</body>
</html>
