{"id": 1112, "title": "Ticket #1112: Fix mixed use of TARGET scope in expressions", "description": "<blockquote>\nWe need to use the <code>target</code> attribute scope correctly for the switch to new <span class=\"quote\">ClassAds</span>. All attributes in an expression that refer to the target ad need to have a 'target.' prefix. Currently, many don't. We will need to change expressions that Condor creates to use proper scoping. Condor daemons will need to correct expressions received from other (older) daemons and users to enforce proper scoping.\n\n<p><span class=\"section\"></span></p><h2>Milestones </h2>\n\n<p></p><ul>\n<li>Change behavior of EvalBool()\n</li><li>Improve methods to add/remove <code>target</code> scoping in attribute references\n</li><li>Enforce proper scoping in query constraints in the collector and its clients\n</li><li>Enforce proper scoping in job constraints in the schedd and its clients\n</li></ul>\n\n<p><span class=\"section\"></span></p><h2>Details </h2>\n\n<p>In old <span class=\"quote\">ClassAds</span>, attribute references in expressions with no scope (i.e. no 'target.' in front) are looked up in both the local scope and the target scope. In new <span class=\"quote\">ClassAds</span>, they are only looked up in the local scope. If you want to refer to an attribute in the target scope, you must put 'Target.' in front.\n\n</p><p>Due to old <span class=\"quote\">ClassAds</span>' looser scoping rules, many expressions have attribute references to the target ad that don't have a 'target.' prefix. These won't work as-is with new <span class=\"quote\">ClassAds</span>.\n\n</p><p>Any expressions that Condor itself writes can be corrected to use <code>target</code> correctly. But expressions that come from a user or an older version of Condor need to be accepted as well. For these expressions arriving from the outside, we need functions that will correct them, adding or removing <code>target</code> scopes where appropriate. Some of this already exists, but we need more.\n\n</p><p><span class=\"subsection\"></span></p><h3>EvalBool() </h3>\n\n<p>The stand-alone EvalBool() function is odd, as it evaluates an expression in the context of a target scope, but no local scope. In most places where it's used, the opposite appears to be expected (local scope provided, but no target scope) and the expressions never have attributes with a <code>target</code> scope. It could be simplified to have no target scope, with an interim check that strips <code>target</code> scopes in the places where they do occur.</p></blockquote>", "remarks": "<blockquote>\n<em>2010-Jan-15 11:24:53 by matt:</em> <br/>\n\nWhat about changing new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span> to not require explicit scoping?</blockquote>", "derived_tickets": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1114\" onclick=\"get_ticket_and_populate_wrapper('1114'); return false;\" title=\"Improve methods to add/remove Target scope in expressions\">#1114</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nImprove methods to add/remove Target scope in expressions</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1115\" onclick=\"get_ticket_and_populate_wrapper('1115'); return false;\" title=\"Remove Target scope from EvalBool() in new ClassAds\">#1115</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nRemove Target scope from EvalBool() in new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span></td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1122\" onclick=\"get_ticket_and_populate_wrapper('1122'); return false;\" title=\"Add methods for adding TARGET scope in expressions based on ad type\">#1122</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nAdd methods for adding TARGET scope in expressions based on ad type</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">\n<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1126\" onclick=\"get_ticket_and_populate_wrapper('1126'); return false;\" title=\"Deploy TARGET scope correcting functions\">#1126</a></span></td>\n<td align=\"center\" valign=\"center\" width=\"30\">\n<span class=\"icon ptr1\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\">\nDeploy TARGET scope correcting functions</td></tr>\n</tbody></table>", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-12 13:20</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/025937206b4dd935ce8b312055f3672b8e706762\">[17221]</a></span>: Add explicit TARGET scope in COD. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1112\" onclick=\"get_ticket_and_populate_wrapper('1112'); return false;\" title=\"Fix mixed use of TARGET scope in expressions\">#1112</a></span> After the switch to new <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ClassAds\" title=\"Class Ads\">ClassAds</a></span>, condor_cod no longer worked because of this.  (By Dan Bradley )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2010-Feb-12 13:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e679e523081659348b329f8cca1bd27c1ac177b0\">[17220]</a></span>: Add TARGET scope in query ad in BOINC manager. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1112\" onclick=\"get_ticket_and_populate_wrapper('1112'); return false;\" title=\"Fix mixed use of TARGET scope in expressions\">#1112</a></span> After the switch to new classads, BOINC backfill fails to start BOINC without this.  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2010-Feb-05 15:41", "status": "resolved", "created": "2010-Jan-15 11:18", "fixed_version": "2010-Jan-15 11:18", "broken_version": "v070500", "priority": "4", "subsystem": "Libs", "assigned_to": "jfrey", "derived_from": "#1109", "creator": "jfrey", "rust": "", "customer_group": "other", "visibility": "public", "notify": "matt@cs.wisc.edu", "due_date": ""}