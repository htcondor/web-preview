{"id": 801, "title": "Ticket #801: USE_VISIBLE_DESKTOP is broken again in V7.3.x", "description": "<blockquote>\nWhile trying to replicate the problem with USE_VISIBLE_DESKTOP in 7.2.4, I was using the 7.3.1 installer and ran into different problems.  I've tested 7.2.4 to and the job does run and cause the problems described by users but on 7.3.1 the job got weird.  It would seem to hang forever and the job either timed out or was forcibly terminated but the application never appeared on the desktop.  Will need considerably more digging to try and pin down this problem.</blockquote>", "remarks": "<blockquote>\n<em>2009-Oct-31 12:57:23 by ziliang:</em> <br/>\n\nI have a fix.  Essentially, comparing the SIDs won't work because we only have the first DWORD of it, which isn't enough to guarantee uniqueness apparently.  Right now my fix is based on the fact that we always add the new entries to the ACLs at the end of the list, so if we keep track of how many ACLs there originally were, we can only copy over the original number when we remove our entries.  This however is rather inelegent and might not work if the Windows machine has multiple slots on a USE_VISIBLE_DESKTOP machine.  So far however people seem to be using USE_VISIBLE_DESKTOP to debug jobs.  If they aren't using it in an actual production setting we could probably get away with it.  The proposed fix would at least resolve the immediate issue.\n\n<p></p><hr/>\n<em>2009-Nov-04 12:15:31 by ziliang:</em> <br/>\n\nFixed.  It seems that while the DWORD sidStart only has the first DWORD of a SID, it retains the rest of it continuously in memory after sidStart.  So the comparison using <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=EqualSid\" title=\"Equal Sid\">EqualSid</a></span> would work, but the logic Ben used for deciding to add on an ACL entry was a bit broken.  This has been corrected and confirmed to work on XP.  Will test on Vista shortly.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-04 12:18</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/6516799509e81b8e20d3f0087f5f6f22d247a26e\">[16229]</a></span>: Fix ACL cleanup when removing access to desktop for USE_VISIBLE_DESKTOP jobs. Tickets <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=745\" onclick=\"get_ticket_and_populate_wrapper('745'); return false;\" title=\"USE_VISIBLE_DESKTOP gone wrong?\">#745</a></span> and <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=801\" onclick=\"get_ticket_and_populate_wrapper('801'); return false;\" title=\"USE_VISIBLE_DESKTOP is broken again in V7.3.x\">#801</a></span>.  (By Ziliang Guo )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-31 13:40", "status": "resolved", "created": "2009-Sep-30 17:05", "fixed_version": "2009-Sep-30 17:05", "broken_version": "v070301", "priority": "2", "subsystem": "Win32", "assigned_to": "ziliang", "derived_from": "#745", "creator": "ziliang", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tannenba@cs.wisc.edu", "due_date": ""}