{"id": 1043, "title": "Ticket #1043: openssl 0.9.8l breaks GSI compatibility", "description": "<blockquote>\nWe have observed that the update of the openssl external from 0.9.8h-p1 to 0.9.8l breaks the gahp_server's ability to authenticate with some globus gatekeepers.  Jaime reproduced the same authentication failure with globusrun linked against the same version of openssl, so this problem is independent of condor.\n\n<p>Fails:\n</p><ul>\n<li>globusrun from VDT 1.10.1 using openssl 0.9.8l on rhel5 <strong>and</strong>\n</li><li>gatekeeper from VDT 2.0.0p10 using openssl-0.9.7a-43.17.el4_7.2.x86_64\n</li></ul>\n\n<p>Succeeds:\n</p><ul>\n<li>globusrun from VDT 1.10.1 using system openssl (0.9.8e) on rhel5 <strong>or</strong>\n</li><li>gatekeeper from VDT 2.0.0p10 using openssl-0.9.8e-12.el5\n</li></ul>\n\n<p>The error message visible in the gatekeeper logs looks like this:\n\n</p><p></p><div class=\"verbatim\">\n<pre>GSS authentication failure\nGSS Major Status: Authentication Failed\nGSS Minor Status Error Chain:\naccept_sec_context.c:gss_accept_sec_context:183:\nSSLv3 handshake problems\nglobus_i_gsi_gss_utils.c:globus_i_gsi_gss_handshake:917:\nUnable to verify remote side's credentials\nglobus_i_gsi_gss_utils.c:globus_i_gsi_gss_handshake:883:\nSSLv3 handshake problems: Couldn't do ssl handshake\nOpenSSL Error: s3_srvr.c:855: in library: SSL routines, function SSL3_GET_CLIENT_HELLO: length mismatch\nFailure: GSS failed Major:000a0000 Minor:00000003 Token:00000000\n</pre></div>\n\n\n<p>The error message visible from gahp_server is this:\n\n</p><p></p><div class=\"verbatim\">\n<pre>12/04 22:20:38 [28243] GAHP[28245] &lt;- 'GRAM_PING 4 cmsgrid02.hep.wisc.edu:2119'\n12/04 22:20:38 [28243] GAHP[28245] -&gt; 'S'\n12/04 22:20:38 [28243] GAHP[28245] &lt;- 'RESULTS'\n12/04 22:20:38 [28243] GAHP[28245] -&gt; 'R'\n12/04 22:20:38 [28243] GAHP[28245] -&gt; 'S' '1'\n12/04 22:20:38 [28243] GAHP[28245] -&gt; '4' '79'\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2009-Dec-11 11:56:28 by jfrey:</em> <br/>\n\nBack-porting the renegotiation security fix from openssl 0.9.8l to 0.9.8h removes this authentication problem.\n\n<p></p><hr/>\n<em>2009-Dec-12 17:26:40 by jfrey:</em> <br/>\n\nJust pushed a commit that reverts the openssl external to 0.9.8h, but including the patch for the renegotiation vulnerability. Pushed to V7_4_1-branch for 7.4.1.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Dec-13 14:43</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fcb69f169b54e9d5b7ead058f8a80bef5b41d9d8\">[16651]</a></span>: Fix patch arguments for openssl external on windows. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1043\" onclick=\"get_ticket_and_populate_wrapper('1043'); return false;\" title=\"openssl 0.9.8l breaks GSI compatibility\">#1043</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Dec-12 17:22</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/c8d04987a67c2ff40d8fa5c771cef7c4cd45f481\">[16650]</a></span>: Back-port openssl renegotiation fix to 0.9.8h. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=1043\" onclick=\"get_ticket_and_populate_wrapper('1043'); return false;\" title=\"openssl 0.9.8l breaks GSI compatibility\">#1043</a></span> To address the recent openssl session renegotiation vulnerability, we changed the openssl external to 0.9.8l. Then, we discovered that some change between 0.9.8h and 0.9.8l breaks gsi authentication to servers using openssl 0.9.7. So now, we're reverting\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2009-Dec-15 10:38", "status": "resolved", "created": "2009-Dec-10 16:28", "fixed_version": "2009-Dec-10 16:28", "broken_version": "v070401", "priority": "1", "subsystem": "Grid", "assigned_to": "jfrey", "derived_from": "", "creator": "danb", "rust": "", "customer_group": "other", "visibility": "public", "notify": "dan@hep.wisc.edu,jfrey@cs.wisc.edu,zmiller@cs.wisc.edu", "due_date": ""}