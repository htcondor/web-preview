{"id": 2945, "title": "Ticket #2945: standard universe breaks glob() on SL6", "description": "<blockquote>\nA 7-year-old standard universe glob() bug is back on SL6.  It is insidious, as we can only reproduce it in the LIGO inspiral code, and not yet in a simple test program.  The same LIGO inspiral code condor_compile'd on Centos 5 (or non-condor_compile'd on SL6) works fine.\n\n<p>The problem is likely related to the fact that the libc glob() code on SL6 internally calls newfstatat() which is failing, even though the files exist:\n\n</p><p>newfstatat(5, \"L-L1_LDAS_C02_L2-953081600-128.gwf\", 0x7fff8096ad20, 0) = -1 EBADF (Bad file descriptor)\n\n</p><p>...whereas the libc glob() on CentOS 5 calls stat(), which is working:\n\n</p><p>stat(\"/home/dbrown/projects/cbc/dax/ihope-4.1/953078343-953114343/full_data/./L-L1_LDAS_C02_L2-953102336-128.gwf\", {st_mode=S_IFREG|0644, st_size=16122709, ...}) = 0\n\n</p><p>Pete may have somehow special-cased stat() to deal with this (maybe to avoid remote io?), but the same may need to be done for newfstatat().\n\n</p><p>This is pretty urgent, since it means we can't compile a working LIGO inspiral workflow on SL6 -- we can only do so on Centos 5, which LIGO no longer supports.\n\n</p><p>This may be difficult to reproduce at UWCS given the complex software environment, but we can give an account to Todd or Alan or anyone else who needs one to reproduce this at Syracuse.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Apr-20 13:23:34 by tannenba:</em> <br/>\n\nBest guess here is the table that virtualizes file descriptors is getting out of whack because the new stat syscall is not being trapped.  This would explain why a toy program (that only has one file open) works, and yet the production program does not. Pfc will try enhancing the toy test program...\n\n<p></p><hr/>\n<em>2012-Apr-20 17:01:01 by tlmiller:</em> <br/>\n\nIt may be worth trying to run your toy program with the -_condor_aggravate_bugs flag.  This flag, by avoiding using FDs 3 to 31, should help \"to uncover bugs due to untrapped system calls.\"\n\n<p></p><hr/>\n<em>2012-Apr-23 11:20:42 by tlmiller:</em> <br/>\n\nThe test program from the referenced condor-admin ticket fails when run with -_condor_aggravate_bugs on SL6.x.  (Oddly enough, under Condor 7.7.5, it reports error: bad file descriptor; under 7.7.6, it reports error: success.)  Investigating...\n\n<p></p><hr/>\n<em>2012-Apr-24 13:40:24 by pfc:</em> <br/>\n\nRe: the differing errno, I believe it's is not being set by glob() itself, but rather is inherited from the last stat() call that glob() made.  So depending on how glob() is failing within the standard universe, the errno may not always be relevant or useful...\n\n<p></p><hr/>\n<em>2012-Apr-25 15:03:48 by tlmiller:</em> <br/>\n\nPatched in 7.8, but only for stand-alone checkpointing.  (GregT reviewed.)\n\n<p></p><hr/>\n<em>2012-Apr-25 15:18:18 by pfc:</em> <br/>\n\nAny chance we could get a pre-release RPM for SL6?  We're desperate to kill the Centos 5 machine that we're keeping around just to run these jobs... thanks!\n\n<p></p><hr/>\n<em>2012-Apr-25 15:29:22 by tlmiller:</em> <br/>\n\n<strong>cough</strong> s/for stand-alone checkpointing/without remote system calls/.  Sorry about that.\n\n<p></p><hr/>\n<em>2012-May-08 16:26:43 by pfc:</em> <br/>\n\nThanks for the quick turnaround on this, guys.  We really appreciate it, since it was blocking an urgent project.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-May-08 15:05</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/96883af30bd444f80c3dac6bc273e9753e501398\">[31950]</a></span>: Documentation for <span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2945\" onclick=\"get_ticket_and_populate_wrapper('2945'); return false;\" title=\"standard universe breaks glob() on SL6\">#2945</a></span>.  (By Todd L Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-25 14:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/bc8872f77df9ba4b513892bca6851db7d12e9d24\">[31821]</a></span>: Fix __fxstatat() in stand-alone mode. (<span class=\"ticket\"><a class=\"defer\" href=\"/wiki-archive/tickets/?ticket=2945\" onclick=\"get_ticket_and_populate_wrapper('2945'); return false;\" title=\"standard universe breaks glob() on SL6\">#2945</a></span>)  (By Todd L Miller )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2012-May-08 16:26", "status": "defer", "created": "2012-Apr-19 08:26", "fixed_version": "2012-Apr-19 08:26", "broken_version": "v070606", "priority": "5", "subsystem": "Std", "assigned_to": "tlmiller", "derived_from": "", "creator": "pfc", "rust": "a12159", "customer_group": "ligo", "visibility": "public", "notify": "dabrown@syr.edu pfcouvar@syr.edu tannenba@cs.wisc.edu adesmet@cs.wisc.edu,pcouvare@caltech.edu", "due_date": ""}