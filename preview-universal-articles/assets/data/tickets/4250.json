{"id": 4250, "title": "Ticket #4250: ScheddIpAddr in submitter ads not updated on change of schedd's sinful", "description": "<blockquote>\nIf the schedd is using a shared port daemon and the shared-port daemon's address changes, the resulting change in the schedd's sinful address isn't reflected in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ScheddIpAddr\" title=\"Schedd Ip Addr\">ScheddIpAddr</a></span> attribute of the submitter ads. This causes some other daemons to fail to contact the schedd, as they try to use an old address that no longer works. The <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ScheddIpAddr\" title=\"Schedd Ip Addr\">ScheddIpAddr</a></span> attribute in the scheduler ad is updated as expected.\n\n<p>We've seen this happen when a submit machine is using both a shared-port daemon and CCB, and the CCB_ADDRESS is changed. The <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ScheddIpAddr\" title=\"Schedd Ip Addr\">ScheddIpAddr</a></span> attribute is updated in the scheduler ad every time an update is sent to the collector, but the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ScheddIpAddr\" title=\"Schedd Ip Addr\">ScheddIpAddr</a></span> attribute in the submitter ads is only updated on a reconfig.\n\n</p><p>If the shared-port daemon's address changes on a reconfig, the schedd doesn't learn about the change immediately. It only learns about the change on its next periodic poll of the shared-port daemon's address (done every 5 minutes).</p></blockquote>", "remarks": "<blockquote>\n<em>2014-Mar-07 16:22:24 by jfrey:</em> <br/>\n\nA workaround for this bug is to send a reconfig to the affected schedd.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-13 10:26</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/177ab830f5ad59f5effe4b0fbc007e2f83eb8a0a\">[39610]</a></span>: minor version history item edit <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4250\" onclick=\"get_ticket_and_populate_wrapper('4250'); return false;\" title=\"ScheddIpAddr in submitter ads not updated on change of schedd's sinful\">#4250</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-07 16:15</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/8ee9bf2f41395c52ff44ed485d6a290e778c7579\">[39552]</a></span>: Docs for stale <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ScheddIpAddr\" title=\"Schedd Ip Addr\">ScheddIpAddr</a></span> in submitter ad bug fix. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4250\" onclick=\"get_ticket_and_populate_wrapper('4250'); return false;\" title=\"ScheddIpAddr in submitter ads not updated on change of schedd's sinful\">#4250</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2014-Mar-07 16:11</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/20778d400206e9287f7fdbcc97b04ac9d85d91ab\">[39551]</a></span>: et <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ScheddIpAddr\" title=\"Schedd Ip Addr\">ScheddIpAddr</a></span> on every submitter ad update. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=4250\" onclick=\"get_ticket_and_populate_wrapper('4250'); return false;\" title=\"ScheddIpAddr in submitter ads not updated on change of schedd's sinful\">#4250</a></span> When using a shared-port daemon, the schedd's sinful address can change unexpectedly (because the shared-port daemon's address changes). Therefore, we need to be aggressive about setting the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=ScheddIpAddr\" title=\"Schedd Ip Addr\">ScheddIpAddr</a></span> attribute in the submitter ads. Otherwise, the\u00a0[...]\n (By Jaime Frey )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Mar-07 16:22", "status": "resolved", "created": "2014-Mar-07 16:03", "fixed_version": "2014-Mar-07 16:03", "broken_version": "v080100", "priority": "3", "subsystem": "DaemonsSubmitNode", "assigned_to": "jfrey", "derived_from": "", "creator": "jfrey", "rust": "", "customer_group": "chtc", "visibility": "public", "notify": "", "due_date": ""}