{"id": 920, "title": "Ticket #920: Startd crash can leak VMs", "description": "<blockquote>\nWhen the Startd starts it removes everything under the EXECUTE directory, but\nfirst checks for .recover files. The .recover file contains the job ad of the\nrunning job. If the job was a VM job, the startd will invoke the condor_vm-gahp\nin \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=KillMode\" title=\"Kill Mode\">KillMode</a></span>\". <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=KillMode\" title=\"Kill Mode\">KillMode</a></span> eventually invokes VirshType::killVMFast to terminate\nthe VMs. However, on 26 Aug 09 (155e821), the killVMFast function was commented\nout. The result being the Startd's attempt is effectively ignored.  The end result is libvirt VMs are left running after a startd restart after a crash.</blockquote>", "remarks": "<blockquote>\n<em>2009-Nov-09 10:26:27 by jfrey:</em> <br/>\n\nSome related tickets:\n<ul>\n<li><span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=514\" onclick=\"get_ticket_and_populate_wrapper('514'); return false;\" title=\"Startd crash can leak VMs\">#514</a></span> Original ticket detailing leaking of VMs on startd crash\n</li><li><span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=688\" onclick=\"get_ticket_and_populate_wrapper('688'); return false;\" title=\"VM-Gahp should make calls to libvirt instead of using a script\">#688</a></span> Change of VM GAHP to link against libvirt</li></ul>\n</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/122/startd_crash_vm_cleanup.patch\">startd_crash_vm_cleanup.patch</a>\n6001 bytes added by rrati on 2009-Nov-09 16:16:42 UTC.\n<br/>\nThis patch moves the VM shutdown functionality out of killVM and back into killVMFast.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-09 10:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a93340b985858f7580ce9fa73c444831bf88439f\">[16264]</a></span>: Removed commented out version of killVMFast (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=920\" onclick=\"get_ticket_and_populate_wrapper('920'); return false;\" title=\"Startd crash can leak VMs\">#920</a></span>)  (By Robert Rati )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2009-Nov-09 10:40</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e6036683ea9791b447ac5c3c6baf799583670483\">[16263]</a></span>: Created XenType/KVMType::killVMFast, which will establish a connection to libvirt and call VirshType::killVMFast which now actually shutsdown a VM. This is more in line with how killVMFast originally worked before it was commented out and it's functionality moved to killVM (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=920\" onclick=\"get_ticket_and_populate_wrapper('920'); return false;\" title=\"Startd crash can leak VMs\">#920</a></span>).  (By Robert Rati )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2010-Jan-08 08:10", "status": "resolved", "created": "2009-Nov-09 10:11", "fixed_version": "2009-Nov-09 10:11", "broken_version": "v070400", "priority": "2", "subsystem": "Daemons", "assigned_to": "rrati", "derived_from": "", "creator": "rrati", "rust": "", "customer_group": "other", "visibility": "public", "notify": "jfrey@cs.wisc.edu, tstclair@redhat.com, matt@cs.wisc.edu", "due_date": ""}