{"id": 2822, "title": "Ticket #2822: Improve cleanup of chroot execute dirs", "description": "<blockquote>\nRight now, the chroot implementation has a few drawbacks:\n<ul>\n<li>It creates $CHROOT/var/lib/condor/execute with too-restrictive permissions if it doesn't already exist.\n</li><li>It implements the parsing of the NAMED_CHROOT param twice via the miracle of copy/paste\n</li><li>It bind-mounts /var/lib/condor/execute -&gt; $CHROOT/var/lib/condor/execute.  If we would instead bind-mount /var/lib/condor/execute/dir_12345 -&gt; $CHROOT/var/lib/condor/execute/dir_12345, the running jobs wouldn't be able to scribble in each other's sandbox, even if they are running as the same unix user.\n<ul>\n<li>This is an important isolation/security protection!\n</li></ul>\n</li><li>If (3) is implemented, we would need to cleanup the various dir_12345 directories in the starter and startd.\n</li></ul>\n\n<p>All simple things to fix; patch incoming.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Apr-10 14:57:26 by tstclair:</em> <br/>\n\nI've cherry-picked onto V7_8-branch, as there is no major functionality changes, they are minor cleanup fixes which I think would be nice to have in the next stable seeing how the 1st introduction of this feature is in the 7.7 series.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/532/chroot_sandbox_remap_v1.patch\">chroot_sandbox_remap_v1.patch</a>\n14821 bytes added by bbockelm on 2012-Feb-13 01:35:58 UTC.\n<br/>\nImplementation of all points mentioned above.<br/>\n</li><li><a href=\"../files/539/chroot_sandbox_remap_v2.patch\">chroot_sandbox_remap_v2.patch</a>\n12915 bytes added by bbockelm on 2012-Mar-10 18:05:22 UTC.\n<br/>\nVersion 2 of the patch, fixing permissions issues discovered in testing.\n\n<p>Greg - we've had this on about 1,000 cores for around a month.  Can you take a look at it?<br/>\n</p></li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-10 14:51</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/961122e712b0cf4edbc1bd3d83415f68e22be49f\">[31605]</a></span>: Cleanup of chroot management code <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2822\" onclick=\"get_ticket_and_populate_wrapper('2822'); return false;\" title=\"Improve cleanup of chroot execute dirs\">#2822</a></span> Committer: Timothy St. Clair  (By Greg Thain )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Apr-03 10:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/cfa3abe6edc713fc47520616227719aa5971dd70\">[31084]</a></span>: Cleanup of chroot management code <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2822\" onclick=\"get_ticket_and_populate_wrapper('2822'); return false;\" title=\"Improve cleanup of chroot execute dirs\">#2822</a></span>  (By Greg Thain )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2012-May-03 09:22", "status": "resolved", "created": "2012-Feb-12 19:31", "fixed_version": "2012-Feb-12 19:31", "broken_version": "", "priority": "4", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "tstclair@redhat.com, gthain@cs.wisc.edu", "due_date": ""}