{"id": 2894, "title": "Ticket #2894: Condor writes logfiles as root user", "description": "<blockquote>\nIt appears that the logrotation code and/or the stack-trace dumping code do not play well together.\n\n<p>About once-or-twice a week, when a daemon dies, it will cause the log file - or the rotated log file - to be owned by root instead of Condor.  When this happens, condor_master will continuously try to restart the daemon, which then fails immediately.  I suspect there's some badness in the stack-trace code.\n\n</p><p>Anyhow, this has taken down our T2's schedd twice in two weeks: I'd be really interested in having an expert take a crack at it.\n\n</p><p>This last time this happened had an interesting twist - SchedLog.old and job_queue.log both got owned by root.</p></blockquote>", "remarks": "<blockquote>\n<em>2012-Aug-29 19:42:54 by bbockelm:</em> <br/>\n\nI think this was caused by <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=183\" onclick=\"get_ticket_and_populate_wrapper('183'); return false;\" title=\"on linux an abort in glibc causes infinite loop with google coredumper\">#183</a></span> and commit c8265d1b33ca9059fe94a087f10b08447df56538, by danb.\n\n<p>If the daemon wants to do a stack dump and is not PRIV_CONDOR, it will switch to the real UID (root, in most cases), and open the logfile with O_CREAT.\n\n</p><p>I propose one of two things:\n</p><ol>\n<li>In this case, drop the O_CREAT flag.  We lose the stack trace.  Tough cookies.\n</li><li>The first time we compute the Condor UID, cache it in a global.  If this is set, use it.  If this is not set, go to case 1.\n</li></ol>\n\n<p>Reassigning to Dan.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Sep-11 11:39</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/089f5c7ba98045ec2c3e977b72e3557ba7779a7b\">[33312]</a></span>: minor format edit of 7.8.4 version history item ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2894\" onclick=\"get_ticket_and_populate_wrapper('2894'); return false;\" title=\"Condor writes logfiles as root user\">#2894</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-31 09:50</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e3ef050e431550156d161c93c9cbf07abf1d1667\">[33225]</a></span>: Fix warning about signed/unsigned comparison. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2894\" onclick=\"get_ticket_and_populate_wrapper('2894'); return false;\" title=\"Condor writes logfiles as root user\">#2894</a></span>  (By Jaime Frey )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2012-Aug-30 16:19</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/b11a0fb93acaa272bd8859c251fa1a2052151b39\">[33216]</a></span>: Fixed case where daemon could leave behind a log file owned by root. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2894\" onclick=\"get_ticket_and_populate_wrapper('2894'); return false;\" title=\"Condor writes logfiles as root user\">#2894</a></span>  (By Dan Bradley )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2014-Aug-04 12:09", "status": "resolved", "created": "2012-Mar-15 12:29", "fixed_version": "2012-Mar-15 12:29", "broken_version": "v070300", "priority": "2", "subsystem": "Daemons", "assigned_to": "gthain", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "bbockelm@cse.unl.edu, tstclair@redhat.com, dan@hep.wisc.edu", "due_date": ""}