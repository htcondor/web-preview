{"id": 490, "title": "Ticket #490: 7.3.1 condor_job_router cores on startup", "description": "<blockquote>\nThe 7.3.1 prerelease condor_job_router fails several seconds after startup. <br/>\n The last few lines of the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> log read as :<br/>\n<br/>\n\n\n<p>05/18 19:30:20 <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> (src=110639.0,route=nmi-s002.batlab.cs.wisc.edu-SITE): found candidate job<br/>\n\n05/18 19:30:20 <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span>: all routes are full (16 managed jobs).  Skipping further searches for candidate jobs.<br/>\n\n05/18 19:30:21 <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> (src=110939.0,route=nmi-s002.batlab.cs.wisc.edu-SITE): claimed job<br/>\n\nStack dump for process 22710 at timestamp 1242667821 (12 frames)<br/>\n\ncondor_job_router(dprintf_dump_stack+0xda)[0x815d2d9]<br/>\n\ncondor_job_router(_Z18linux_sig_coredumpi+0x23)[0x814feef]<br/>\n\n/lib/tls/libc.so.6[0xa59918]<br/>\n</p></blockquote>", "remarks": "<blockquote>\n<em>2009-May-18 13:27:07 by bgietzel:</em> <br/>\n\nThe OS this happens on is Scientific Linux 4.7\n\n<p></p><hr/>\n<em>2009-May-18 16:08:46 by bgietzel:</em> <br/>\n\nFull backtrace:\n<div class=\"verbatim\">\n<pre></pre></div>\n\n05/18 22:30:29 <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=JobRouter\" title=\"Job Router\">JobRouter</a></span> (src=110559.0,route=nmi-s002.batlab.cs.wisc.edu-SITE): claimed job\nStack dump for process 24561 at timestamp 1242678629 (12 frames)\ncondor_job_router(dprintf_dump_stack+0xda)[0x815d2d9]\ncondor_job_router(_Z18linux_sig_coredumpi+0x23)[0x814feef]\n/lib/tls/libc.so.6[0xa59918]\ncondor_job_router(_ZN16JobRouterHookMgr11getHookPathE8HookTypeN7classad7ClassAdE+0x134)[0x8130566]\ncondor_job_router(_ZN16JobRouterHookMgr16hookTranslateJobEP9RoutedJobRSs+0x46)[0x813081a]\ncondor_job_router(_ZN9JobRouter9SubmitJobEP9RoutedJob+0x150)[0x811a24e]\ncondor_job_router(_ZN9JobRouter4PollEv+0xbc)[0x8117040]\ncondor_job_router(_ZN12TimerManager7TimeoutEv+0x2a6)[0x8158cda]\ncondor_job_router(_ZN10DaemonCore6DriverEv+0x64b)[0x813dd2f]\ncondor_job_router(main+0x1831)[0x8152955]\n/lib/tls/libc.so.6(__libc_start_main+0xd3)[0xa46df3]\ncondor_job_router(dlopen+0x45)[0x810a111]\n<div class=\"verbatim\">\n<pre></pre></div>\n\n\n<p></p><hr/>\n<em>2009-May-18 16:33:48 by tannenba:</em> <br/>\n\nLooks like the core dump happens when JOB_ROUTER_HOOK_KEYWORD is undefined.  In that case, param(\"JOB_ROUTER_HOOK_KEYWORD\") returns NULL, and method JobRouterHookMgr::getHookPath() then tries to assign the NULL to an STL string.  And STL string doesn't like that.  ;)\n\n<p>Apparently commits <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/5fb45024b5d4a357884a29e843151c56895b9c27\">[14472]</a></span> and <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/e7492a3c3726515425a1260c60f780ab2dbe44b1\">[14473]</a></span> were never tested in the common case that JOB_ROUTER_HOOK_KEYWORD is not present in the config file?\n\n</p><p>Will commit a patch into V7_3_1-branch shortly.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/56/etics2-condor-configs.tar.gz\">etics2-condor-configs.tar.gz</a>\n27424 bytes added by bgietzel on 2009-May-18 18:26:03 UTC.\n<br/>\nCondor config files that produce the condor_job_router error in Condor 7.3.1 prerelease running on Scientific Linux 4.7 <br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2009-May-18 16:38</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/ba8bf275242e9c6af9ba6eb52e788de36d0cd993\">[14708]</a></span>: Fix job router core dump if JOB_ROUTER_HOOK_KEYWORD is not defined (<span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=490\" onclick=\"get_ticket_and_populate_wrapper('490'); return false;\" title=\"7.3.1 condor_job_router cores on startup\">#490</a></span>). Note it looks like this bug was never present in a released version of Condor (bug created after v7.3.0, and fixed on v7.3.1 release branch).  (By Todd Tannenbaum )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2009-Dec-26 20:15", "status": "resolved", "created": "2009-May-18 13:21", "fixed_version": "2009-May-18 13:21", "broken_version": "v070301", "priority": "2", "subsystem": "Unknown", "assigned_to": "tannenba", "derived_from": "", "creator": "bgietzel", "rust": "", "customer_group": "batlab", "visibility": "public", "notify": "bgietzel@cs.wisc.edu", "due_date": ""}