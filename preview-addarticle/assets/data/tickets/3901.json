{"id": 3901, "title": "Ticket #3901: Make draining attributes available to MAXJOBRETIREMENTTIME", "description": "<blockquote>\nCurrently, MAXJOBRETIREMENTTIME is evaluated before any draining attributes are inserted into the resource ad.\n\n<p>I'd like to implement the following policy:\n</p><ul>\n<li>If preemption is due to draining, allow the job an additional N hours to leave.\n</li><li>Otherwise, preempt immediately.\n</li></ul>\n\n<p>Right now, this appears to be relatively impossible due to the lack of the draining attributes.  The patch is straightforward - add the \"Draining\", \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=DrainingRequestId\" title=\"Draining Request Id\">DrainingRequestId</a></span>\", and \"<span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=LastDrainStartTime\" title=\"Last Drain Start Time\">LastDrainStartTime</a></span>\" attributes into the resource ads before the retirement time is calculated in ResMgr::startDraining.\n\n</p><p>With this, the following works to implement my policy:\n\n</p><p></p><div class=\"verbatim\">\n<pre>MAXJOBRETIREMENTTIME = ifThenElse(Draining =?= true, LastDrainStartTime - JobStart + 24*3600, 0))\n</pre></div>\n</blockquote>", "remarks": "<blockquote>\n<em>2013-Sep-10 08:19:22 by bbockelm:</em> <br/>\n\nFixed.  I think this is a very obscure use case and doesn't need documentation.\n\n<p>However, I placed the ticket into docpending in case if someone thinks I'm wrong.</p></blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Oct-30 16:58</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a2c3ea6160234d1a7ef2f5ffee24924f44255830\">[38035]</a></span>: add 8.1.2 version history item for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3901\" onclick=\"get_ticket_and_populate_wrapper('3901'); return false;\" title=\"Make draining attributes available to MAXJOBRETIREMENTTIME\">#3901</a></span>.  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2013-Sep-10 08:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/1ec04d4ac52fd474557e8b8fb98d3a68f0b159d8\">[37534]</a></span>: Add draining attributes to resource ad prior to evaluating MAXJOBRETIREMENTTIME. <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=3901\" onclick=\"get_ticket_and_populate_wrapper('3901'); return false;\" title=\"Make draining attributes available to MAXJOBRETIREMENTTIME\">#3901</a></span>  (By Brian Bockelman )</td></tr>\n</tbody></table>", "type": "enhance", "last_change": "2013-Oct-30 17:01", "status": "resolved", "created": "2013-Sep-10 08:13", "fixed_version": "2013-Sep-10 08:13", "broken_version": "", "priority": "4", "subsystem": "DaemonsExecNode", "assigned_to": "tim", "derived_from": "", "creator": "bbockelm", "rust": "", "customer_group": "other", "visibility": "public", "notify": "", "due_date": ""}