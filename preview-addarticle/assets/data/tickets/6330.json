{"id": 6330, "title": "Ticket #6330: Improve error message for missing /var/run/condor under systemd", "description": "<blockquote>\nOn a systemd host that has <code>/var/run/condor</code> and/or <code>/var/lock/condor</code> on tmpfs, we rely on systemd-tmpfiles-setup configuration to automatically create the relevant folders owned by the condor user/group. The problem occurs when a site has the condor user in LDAP (which is not recommended) and the systemd-tmpfiles-setup service cannot create the folders with the proper ownership. This shows up in the <span class=\"wiki\"><a class=\"missing\" href=\"wiki?p=MasterLog\" title=\"Master Log\">MasterLog</a></span> as the following:\n\n<p></p><div class=\"code\">\n<pre class=\"code\">06/30/17 16:43:29 error opening watchdog pipe /var/run/condor/procd_pipe.watchdog: No such file or directory (2)\n</pre></div>\n\n\n<p>We should be able to detect that the condor user exists and that the systemd-tmpfiles-setup service failed:\n\n</p><p></p><div class=\"code\">\n<pre class=\"code\"># systemctl status systemd-tmpfiles-setup\n\u25cf systemd-tmpfiles-setup.service - Create Volatile Files and Directories\n   Loaded: loaded (/usr/lib/systemd/system/systemd-tmpfiles-setup.service; static; vendor preset: disabled)\n   Active: failed (Result: exit-code) since Fri 2017-06-30 14:38:14 CDT; 4 days ago\n     Docs: man:tmpfiles.d(5)\n           man:systemd-tmpfiles(8)\n  Process: 429 ExecStart=/usr/bin/systemd-tmpfiles --create --remove --boot --exclude-prefix=/dev (code=exited, status=1/FAILURE)\n Main PID: 429 (code=exited, status=1/FAILURE)\n\nJun 30 14:38:14 fnalimage systemd[1]: Starting Create Volatile Files and Directories...\nJun 30 14:38:14 fnalimage systemd-tmpfiles[429]: [/usr/lib/tmpfiles.d/condor-ce.conf:1] Unknown user 'condor'.\nJun 30 14:38:14 fnalimage systemd-tmpfiles[429]: [/usr/lib/tmpfiles.d/condor-ce.conf:2] Unknown user 'condor'.\nJun 30 14:38:14 fnalimage systemd-tmpfiles[429]: [/usr/lib/tmpfiles.d/condor-ce.conf:3] Unknown user 'condor'.\nJun 30 14:38:14 fnalimage systemd-tmpfiles[429]: [/usr/lib/tmpfiles.d/condor.conf:2] Unknown user 'condor'.\nJun 30 14:38:14 fnalimage systemd-tmpfiles[429]: [/usr/lib/tmpfiles.d/condor.conf:4] Unknown user 'condor'.\nJun 30 14:38:14 fnalimage systemd[1]: systemd-tmpfiles-setup.service: main process exited, code=exited, status=1/FAILURE\nJun 30 14:38:14 fnalimage systemd[1]: Failed to start Create Volatile Files and Directories.\nJun 30 14:38:14 fnalimage systemd[1]: Unit systemd-tmpfiles-setup.service entered failed state.\nJun 30 14:38:14 fnalimage systemd[1]: systemd-tmpfiles-setup.service failed.\n</pre></div>\n\n\n<p>We should provide a more informative message saying that the proper dir doesn't exist and this can be caused by the <code>condor</code> user being in LDAP.</p></blockquote>", "remarks": "<blockquote>\n<em>2019-Jun-25 09:35:14 by tim:</em> <br/>\n\nThis has been made moot by <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=7101\" onclick=\"get_ticket_and_populate_wrapper('7101'); return false;\" title=\"condor_master should create needed directories\">#7101</a></span>. The master creates the necessary directories at startup if they are not there. This is in the 8.8.4 release.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body></body></html>", "check_ins": "", "type": "enhance", "last_change": "2019-Jun-25 09:35", "status": "abandoned", "created": "2017-Jul-05 14:04", "fixed_version": "2017-Jul-05 14:04", "broken_version": "", "priority": "4", "subsystem": "DaemonMaster", "assigned_to": "tim", "derived_from": "", "creator": "blin", "rust": "", "customer_group": "osg", "visibility": "public", "notify": "blin@cs.wisc.edu", "due_date": ""}