{"id": 2543, "title": "Ticket #2543: Failed job start causes starter to shutdown w/o completing exit hook", "description": "<blockquote>\nIf the starter has a problem running the executable for the job, it will perform a shutdown fast.  Part of this process invokes the exit hook as it should, but it\nshuts down without waiting for the exit hook to exit.  Anything using the job\nhooks that runs into this case will likely not be notified the job has exited\nand been evicted.  This could mean a job that is injected with the hooks (fetch hook) will lose track of what has happened to the job.</blockquote>", "remarks": "<blockquote>\n<em>2011-Oct-12 10:27:53 by tstclair:</em> <br/>\n\nreviewed, looks good.\n\n<p>Out of curiosity what is the debug statement when the hook times out?\n\n</p><p></p><hr/>\n<em>2011-Oct-12 15:36:39 by rrati:</em> <br/>\n\nUpdated to add a debug statement if the exit hook times out.</blockquote>", "derived_tickets": "", "attachments": "<html><head></head><body><blockquote>\n<ul>\n<li><a href=\"../files/475/starter_waits_for_hook.patch\">starter_waits_for_hook.patch</a>\n7551 bytes added by rrati on 2011-Oct-12 14:55:00 UTC.\n<br/>\nThis patch ensures the starter will wait for the exit hook to complete if it is configured.  The starter will wait &lt;keyword&gt;_HOOK_&lt;hook_type&gt;_TIMEOUT seconds, defaults to 30 for the exit hook, before the starter determines the hook is hung and continues with shutdown.<br/>\n</li></ul>\n</blockquote></body></html>", "check_ins": "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tbody><tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-17 14:36</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/27cb0094e1770a26cc222a52aa7026964b0b08ed\">[27864]</a></span>: Minor edit of defn of new config knob &lt;Keyword&gt;_HOOK_JOB_EXIT_TIMEOUT, as well as remove double 'is' from a whole bunch of definitions. ===GT=== <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2543\" onclick=\"get_ticket_and_populate_wrapper('2543'); return false;\" title=\"Failed job start causes starter to shutdown w/o completing exit hook\">#2543</a></span>  (By Karen Miller )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-13 12:17</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/a6b7331d9aae78f51326c9d37c8608a7d10921be\">[27799]</a></span>: Doc changes for <span class=\"ticket\"><a class=\"resolved\" href=\"/wiki-archive/tickets/?ticket=2543\" onclick=\"get_ticket_and_populate_wrapper('2543'); return false;\" title=\"Failed job start causes starter to shutdown w/o completing exit hook\">#2543</a></span>  (By Robert Rati )</td></tr>\n<tr><td align=\"right\" valign=\"top\" width=\"160\">2011-Oct-13 11:13</td>\n<td align=\"center\" valign=\"top\" width=\"30\">\n<span class=\"icon dot\">\u00a0</span></td>\n<td align=\"left\" valign=\"top\"> \nCheck-in <span class=\"chng\"><a href=\"https://github.com/htcondor/htcondor/commit/fd403bb5fc5a22511d93c4b6eef7132febb850cb\">[27797]</a></span>: The starter will wait for the exit hook to exit before shutting down even for a shutdown fast case. The starter will wait &lt;keyword&gt;_HOOK_&lt;hook_type&gt;_TIMEOUT seconds befoer deciding to move on and finish the shutdown process so an exit hook can not prevent the starter from shutting down. Currently only\u00a0[...]\n (By Robert Rati )</td></tr>\n</tbody></table>", "type": "defect", "last_change": "2011-Oct-13 11:18", "status": "resolved", "created": "2011-Oct-12 09:50", "fixed_version": "2011-Oct-12 09:50", "broken_version": "v070100", "priority": "2", "subsystem": "Daemons", "assigned_to": "rrati", "derived_from": "", "creator": "rrati", "rust": "", "customer_group": "other", "visibility": "public", "notify": "rrati@redhat.com tstclair@redhat.com gthain@cs.wisc.edu", "due_date": ""}